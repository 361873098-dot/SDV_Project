Table continued from the previous page...

| Field       | Function                                                                                                                                                                                                                                                                      | Function                                                                                                                                                                                                                                                                      | Function                                                                                                                                                                                                                                                                      |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|             | DMALW                                                                                                                                                                                                                                                                         | Number of 32-bit words transferred                                                                                                                                                                                                                                            | Last FIFO address                                                                                                                                                                                                                                                             |
|             | 0                                                                                                                                                                                                                                                                             | 1                                                                                                                                                                                                                                                                             | 2000h                                                                                                                                                                                                                                                                         |
|             | 1                                                                                                                                                                                                                                                                             | 2                                                                                                                                                                                                                                                                             | 2004h                                                                                                                                                                                                                                                                         |
|             | 2                                                                                                                                                                                                                                                                             | 3                                                                                                                                                                                                                                                                             | 2008h                                                                                                                                                                                                                                                                         |
|             | 3                                                                                                                                                                                                                                                                             | 4                                                                                                                                                                                                                                                                             | 200Ch                                                                                                                                                                                                                                                                         |
|             | 4                                                                                                                                                                                                                                                                             | 5                                                                                                                                                                                                                                                                             | 2010h                                                                                                                                                                                                                                                                         |
|             | 5                                                                                                                                                                                                                                                                             | 6                                                                                                                                                                                                                                                                             | 2014h                                                                                                                                                                                                                                                                         |
|             | 6                                                                                                                                                                                                                                                                             | 7                                                                                                                                                                                                                                                                             | 2018h                                                                                                                                                                                                                                                                         |
|             | 7                                                                                                                                                                                                                                                                             | 8                                                                                                                                                                                                                                                                             | 201Ch                                                                                                                                                                                                                                                                         |
|             | 8                                                                                                                                                                                                                                                                             | 9                                                                                                                                                                                                                                                                             | 2020h                                                                                                                                                                                                                                                                         |
|             | 9                                                                                                                                                                                                                                                                             | 10                                                                                                                                                                                                                                                                            | 2024h                                                                                                                                                                                                                                                                         |
|             | 10                                                                                                                                                                                                                                                                            | 11                                                                                                                                                                                                                                                                            | 2028h                                                                                                                                                                                                                                                                         |
|             | 11                                                                                                                                                                                                                                                                            | 12                                                                                                                                                                                                                                                                            | 202Ch                                                                                                                                                                                                                                                                         |
|             | 12                                                                                                                                                                                                                                                                            | 13                                                                                                                                                                                                                                                                            | 2030h                                                                                                                                                                                                                                                                         |
|             | 13                                                                                                                                                                                                                                                                            | 14                                                                                                                                                                                                                                                                            | 2034h                                                                                                                                                                                                                                                                         |
|             | 14                                                                                                                                                                                                                                                                            | 15                                                                                                                                                                                                                                                                            | 2038h                                                                                                                                                                                                                                                                         |
|             | 15                                                                                                                                                                                                                                                                            | 16                                                                                                                                                                                                                                                                            | 203Ch                                                                                                                                                                                                                                                                         |
|             | 16                                                                                                                                                                                                                                                                            | 17                                                                                                                                                                                                                                                                            | 2040h                                                                                                                                                                                                                                                                         |
|             | 17                                                                                                                                                                                                                                                                            | 18                                                                                                                                                                                                                                                                            | 2044h                                                                                                                                                                                                                                                                         |
|             | 18                                                                                                                                                                                                                                                                            | 19                                                                                                                                                                                                                                                                            | 2048h                                                                                                                                                                                                                                                                         |
|             | 19                                                                                                                                                                                                                                                                            | 20                                                                                                                                                                                                                                                                            | 204Ch                                                                                                                                                                                                                                                                         |
|             | Undefined DMALW values in the table are reserved and must not be used. NOTE                                                                                                                                                                                                   | Undefined DMALW values in the table are reserved and must not be used. NOTE                                                                                                                                                                                                   | Undefined DMALW values in the table are reserved and must not be used. NOTE                                                                                                                                                                                                   |
| 25-23 -     | Reserved                                                                                                                                                                                                                                                                      | Reserved                                                                                                                                                                                                                                                                      | Reserved                                                                                                                                                                                                                                                                      |
| 22-16 NEXIF | Number of Extended ID Filter Elements Defines the number of extended ID filter elements used during the Enhanced RX FIFO matching process. The value of this field must be less than or equal to NFE + 1. The number of standard ID filter elements is 2 × (NFE - NEXIF + 1). | Number of Extended ID Filter Elements Defines the number of extended ID filter elements used during the Enhanced RX FIFO matching process. The value of this field must be less than or equal to NFE + 1. The number of standard ID filter elements is 2 × (NFE - NEXIF + 1). | Number of Extended ID Filter Elements Defines the number of extended ID filter elements used during the Enhanced RX FIFO matching process. The value of this field must be less than or equal to NFE + 1. The number of standard ID filter elements is 2 × (NFE - NEXIF + 1). |

| Field   | Function                                                                                                                                   | Function                                                                                                                                   | Function                                                                                                                                   | Function                                                                                                                                   |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
|         | This table shows the number of extended ID filters and standard ID filters available for Enhanced RX FIFO if all filter elements are used. | This table shows the number of extended ID filters and standard ID filters available for Enhanced RX FIFO if all filter elements are used. | This table shows the number of extended ID filters and standard ID filters available for Enhanced RX FIFO if all filter elements are used. | This table shows the number of extended ID filters and standard ID filters available for Enhanced RX FIFO if all filter elements are used. |
|         | NEXIF                                                                                                                                      | NFE                                                                                                                                        | Number of Extended ID filter elements                                                                                                      | Number of Standard ID filter elements                                                                                                      |
|         | 0                                                                                                                                          | 63                                                                                                                                         | 0                                                                                                                                          | 128                                                                                                                                        |
|         | 1                                                                                                                                          | 63                                                                                                                                         | 1                                                                                                                                          | 126                                                                                                                                        |
|         | 2                                                                                                                                          | 63                                                                                                                                         | 2                                                                                                                                          | 124                                                                                                                                        |
|         | 3                                                                                                                                          | 63                                                                                                                                         | 3                                                                                                                                          | 122                                                                                                                                        |
|         | 4                                                                                                                                          | 63                                                                                                                                         | 4                                                                                                                                          | 120                                                                                                                                        |
|         | 5                                                                                                                                          | 63                                                                                                                                         | 5                                                                                                                                          | 118                                                                                                                                        |
|         | 6                                                                                                                                          | 63                                                                                                                                         | 6                                                                                                                                          | 116                                                                                                                                        |
|         | 7                                                                                                                                          | 63                                                                                                                                         | 7                                                                                                                                          | 114                                                                                                                                        |
|         | 8                                                                                                                                          | 63                                                                                                                                         | 8                                                                                                                                          | 112                                                                                                                                        |
|         | 9                                                                                                                                          | 63                                                                                                                                         | 9                                                                                                                                          | 110                                                                                                                                        |
|         | 10                                                                                                                                         | 63                                                                                                                                         | 10                                                                                                                                         | 108                                                                                                                                        |
|         | 11                                                                                                                                         | 63                                                                                                                                         | 11                                                                                                                                         | 106                                                                                                                                        |
|         | 12                                                                                                                                         | 63                                                                                                                                         | 12                                                                                                                                         | 104                                                                                                                                        |
|         | 13                                                                                                                                         | 63                                                                                                                                         | 13                                                                                                                                         | 102                                                                                                                                        |
|         | 14                                                                                                                                         | 63                                                                                                                                         | 14                                                                                                                                         | 100                                                                                                                                        |
|         | 15                                                                                                                                         | 63                                                                                                                                         | 15                                                                                                                                         | 98                                                                                                                                         |
|         | 16                                                                                                                                         | 63                                                                                                                                         | 16                                                                                                                                         | 96                                                                                                                                         |
|         | 17                                                                                                                                         | 63                                                                                                                                         | 17                                                                                                                                         | 94                                                                                                                                         |
|         | 18                                                                                                                                         | 63                                                                                                                                         | 18                                                                                                                                         | 92                                                                                                                                         |
|         | 19                                                                                                                                         | 63                                                                                                                                         | 19                                                                                                                                         | 90                                                                                                                                         |
|         | 20                                                                                                                                         | 63                                                                                                                                         | 20                                                                                                                                         | 88                                                                                                                                         |
|         | 21                                                                                                                                         | 63                                                                                                                                         | 21                                                                                                                                         | 86                                                                                                                                         |
|         | 22                                                                                                                                         | 63                                                                                                                                         | 22                                                                                                                                         | 84                                                                                                                                         |
|         | 23                                                                                                                                         | 63                                                                                                                                         | 23                                                                                                                                         | 82                                                                                                                                         |
|         | 24                                                                                                                                         | 63                                                                                                                                         | 24                                                                                                                                         | 80                                                                                                                                         |
|         | 25                                                                                                                                         | 63                                                                                                                                         | 25                                                                                                                                         | 78                                                                                                                                         |
|         | 26                                                                                                                                         | 63                                                                                                                                         | 26                                                                                                                                         | 76                                                                                                                                         |

Table continued from the previous page...

| Field   | Function   | Function   | Function                              | Function                              |
|---------|------------|------------|---------------------------------------|---------------------------------------|
|         | NEXIF      | NFE        | Number of Extended ID filter elements | Number of Standard ID filter elements |
|         | 27         | 63         | 27                                    | 74                                    |
|         | 28         | 63         | 28                                    | 72                                    |
|         | 29         | 63         | 29                                    | 70                                    |
|         | 30         | 63         | 30                                    | 68                                    |
|         | 31         | 63         | 31                                    | 66                                    |
|         | 32         | 63         | 32                                    | 64                                    |
|         | 33         | 63         | 33                                    | 62                                    |
|         | 34         | 63         | 34                                    | 60                                    |
|         | 35         | 63         | 35                                    | 58                                    |
|         | 36         | 63         | 36                                    | 56                                    |
|         | 37         | 63         | 37                                    | 54                                    |
|         | 38         | 63         | 38                                    | 52                                    |
|         | 39         | 63         | 39                                    | 50                                    |
|         | 40         | 63         | 40                                    | 48                                    |
|         | 41         | 63         | 41                                    | 46                                    |
|         | 42         | 63         | 42                                    | 44                                    |
|         | 43         | 63         | 43                                    | 42                                    |
|         | 44         | 63         | 44                                    | 40                                    |
|         | 45         | 63         | 45                                    | 38                                    |
|         | 46         | 63         | 46                                    | 36                                    |
|         | 47         | 63         | 47                                    | 34                                    |
|         | 48         | 63         | 48                                    | 32                                    |
|         | 49         | 63         | 49                                    | 30                                    |
|         | 50         | 63         | 50                                    | 28                                    |
|         | 51         | 63         | 51                                    | 26                                    |
|         | 52         | 63         | 52                                    | 24                                    |
|         | 53         | 63         | 53                                    | 22                                    |
|         | 54         | 63         | 54                                    | 20                                    |
|         | 55         | 63         | 55                                    | 18                                    |

Table continues on the next page...

Table continued from the previous page...

| Field    | Function                                                                                                                                                        | Function                                                                                                                                                        | Function                                                                                                                                                        | Function                                                                                                                                                        | Function                                                                                                                                                        |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|
|          | NEXIF                                                                                                                                                           | NFE                                                                                                                                                             | Number of Extended ID filter elements                                                                                                                           | Number of Extended ID filter elements                                                                                                                           | Number of Standard ID filter elements                                                                                                                           |
|          | 56                                                                                                                                                              | 63                                                                                                                                                              | 56                                                                                                                                                              | 56                                                                                                                                                              | 16                                                                                                                                                              |
|          | 57                                                                                                                                                              | 63                                                                                                                                                              | 57                                                                                                                                                              | 57                                                                                                                                                              | 14                                                                                                                                                              |
|          | 58                                                                                                                                                              | 63                                                                                                                                                              | 58                                                                                                                                                              | 58                                                                                                                                                              | 12                                                                                                                                                              |
|          | 59                                                                                                                                                              | 63                                                                                                                                                              | 59                                                                                                                                                              | 59                                                                                                                                                              | 10                                                                                                                                                              |
|          | 60                                                                                                                                                              | 63                                                                                                                                                              | 60                                                                                                                                                              | 60                                                                                                                                                              | 8                                                                                                                                                               |
|          | 61                                                                                                                                                              | 63                                                                                                                                                              | 61                                                                                                                                                              | 61                                                                                                                                                              | 6                                                                                                                                                               |
|          | 62                                                                                                                                                              | 63                                                                                                                                                              | 62                                                                                                                                                              | 62                                                                                                                                                              | 4                                                                                                                                                               |
|          | 63                                                                                                                                                              | 63                                                                                                                                                              | 63                                                                                                                                                              | 63                                                                                                                                                              | 2                                                                                                                                                               |
|          | 64                                                                                                                                                              | 63                                                                                                                                                              | 64                                                                                                                                                              | 64                                                                                                                                                              | 0                                                                                                                                                               |
| 15-14 -  | Reserved                                                                                                                                                        | Reserved                                                                                                                                                        | Reserved                                                                                                                                                        | Reserved                                                                                                                                                        | Reserved                                                                                                                                                        |
| 13-8 NFE | Number of Enhanced RX FIFO Filter Elements Defines the total number of filter elements used during the enhanced RXFIFO matching process according to the table. | Number of Enhanced RX FIFO Filter Elements Defines the total number of filter elements used during the enhanced RXFIFO matching process according to the table. | Number of Enhanced RX FIFO Filter Elements Defines the total number of filter elements used during the enhanced RXFIFO matching process according to the table. | Number of Enhanced RX FIFO Filter Elements Defines the total number of filter elements used during the enhanced RXFIFO matching process according to the table. | Number of Enhanced RX FIFO Filter Elements Defines the total number of filter elements used during the enhanced RXFIFO matching process according to the table. |
|          | NFE Maximum number of extended                                                                                                                                  | NFE Maximum number of extended                                                                                                                                  | NFE Maximum number of extended                                                                                                                                  | ID 1) Maximum number of standard ID filter elements (NEXIF = 0)                                                                                                 | ID 1) Maximum number of standard ID filter elements (NEXIF = 0)                                                                                                 |
|          | 0 1                                                                                                                                                             | 0 1                                                                                                                                                             | 0 1                                                                                                                                                             | 2                                                                                                                                                               | 2                                                                                                                                                               |
|          | 1 2                                                                                                                                                             | 1 2                                                                                                                                                             | 1 2                                                                                                                                                             | 4                                                                                                                                                               | 4                                                                                                                                                               |
|          | 2 3                                                                                                                                                             | 2 3                                                                                                                                                             | 2 3                                                                                                                                                             | 6                                                                                                                                                               | 6                                                                                                                                                               |
|          | 3 4                                                                                                                                                             | 3 4                                                                                                                                                             | 3 4                                                                                                                                                             | 8                                                                                                                                                               | 8                                                                                                                                                               |
|          | 4 5                                                                                                                                                             | 4 5                                                                                                                                                             | 4 5                                                                                                                                                             | 10                                                                                                                                                              | 10                                                                                                                                                              |
|          | 5 6                                                                                                                                                             | 5 6                                                                                                                                                             | 5 6                                                                                                                                                             | 12                                                                                                                                                              | 12                                                                                                                                                              |
|          | 6 7                                                                                                                                                             | 6 7                                                                                                                                                             | 6 7                                                                                                                                                             | 14                                                                                                                                                              | 14                                                                                                                                                              |
|          | 7 8                                                                                                                                                             | 7 8                                                                                                                                                             | 7 8                                                                                                                                                             | 16                                                                                                                                                              | 16                                                                                                                                                              |
|          | 8 9                                                                                                                                                             | 8 9                                                                                                                                                             | 8 9                                                                                                                                                             | 18                                                                                                                                                              | 18                                                                                                                                                              |
|          | 9 10                                                                                                                                                            | 9 10                                                                                                                                                            | 9 10                                                                                                                                                            | 20                                                                                                                                                              | 20                                                                                                                                                              |
|          | 10 11                                                                                                                                                           | 10 11                                                                                                                                                           | 10 11                                                                                                                                                           | 22                                                                                                                                                              | 22                                                                                                                                                              |
|          | 11 12                                                                                                                                                           | 11 12                                                                                                                                                           | 11 12                                                                                                                                                           | 24                                                                                                                                                              | 24                                                                                                                                                              |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function   | Function                                                        | Function                                                  |
|---------|------------|-----------------------------------------------------------------|-----------------------------------------------------------|
|         | NFE        | Maximum number of extended ID filter elements (NEXIF = NFE + 1) | Maximum number of standard ID filter elements (NEXIF = 0) |
|         | 12         | 13                                                              | 26                                                        |
|         | 13         | 14                                                              | 28                                                        |
|         | 14         | 15                                                              | 30                                                        |
|         | 15         | 16                                                              | 32                                                        |
|         | 16         | 17                                                              | 34                                                        |
|         | 17         | 18                                                              | 36                                                        |
|         | 18         | 19                                                              | 38                                                        |
|         | 19         | 20                                                              | 40                                                        |
|         | 20         | 21                                                              | 42                                                        |
|         | 21         | 22                                                              | 44                                                        |
|         | 22         | 23                                                              | 46                                                        |
|         | 23         | 24                                                              | 48                                                        |
|         | 24         | 25                                                              | 50                                                        |
|         | 25         | 26                                                              | 52                                                        |
|         | 26         | 27                                                              | 54                                                        |
|         | 27         | 28                                                              | 56                                                        |
|         | 28         | 29                                                              | 58                                                        |
|         | 29         | 30                                                              | 60                                                        |
|         | 30         | 31                                                              | 62                                                        |
|         | 31         | 32                                                              | 64                                                        |
|         | 32         | 33                                                              | 66                                                        |
|         | 33         | 34                                                              | 68                                                        |
|         | 34         | 35                                                              | 70                                                        |
|         | 35         | 36                                                              | 72                                                        |
|         | 36         | 37                                                              | 74                                                        |
|         | 37         | 38                                                              | 76                                                        |
|         | 38         | 39                                                              | 78                                                        |
|         | 39         | 40                                                              | 80                                                        |
|         | 40         | 41                                                              | 82                                                        |

Table continues on the next page...

Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                | Function                                                                                                                                                                                                | Function                                                                                                                                                                                                |
|-----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           | NFE                                                                                                                                                                                                     | Maximum number of extended ID filter elements (NEXIF = NFE + 1)                                                                                                                                         | Maximum number of standard ID filter elements (NEXIF = 0)                                                                                                                                               |
|           | 41                                                                                                                                                                                                      | 42                                                                                                                                                                                                      | 84                                                                                                                                                                                                      |
|           | 42                                                                                                                                                                                                      | 43                                                                                                                                                                                                      | 86                                                                                                                                                                                                      |
|           | 43                                                                                                                                                                                                      | 44                                                                                                                                                                                                      | 88                                                                                                                                                                                                      |
|           | 44                                                                                                                                                                                                      | 45                                                                                                                                                                                                      | 90                                                                                                                                                                                                      |
|           | 45                                                                                                                                                                                                      | 46                                                                                                                                                                                                      | 92                                                                                                                                                                                                      |
|           | 46                                                                                                                                                                                                      | 47                                                                                                                                                                                                      | 94                                                                                                                                                                                                      |
|           | 47                                                                                                                                                                                                      | 48                                                                                                                                                                                                      | 96                                                                                                                                                                                                      |
|           | 48                                                                                                                                                                                                      | 49                                                                                                                                                                                                      | 98                                                                                                                                                                                                      |
|           | 49                                                                                                                                                                                                      | 50                                                                                                                                                                                                      | 100                                                                                                                                                                                                     |
|           | 50                                                                                                                                                                                                      | 51                                                                                                                                                                                                      | 102                                                                                                                                                                                                     |
|           | 51                                                                                                                                                                                                      | 52                                                                                                                                                                                                      | 104                                                                                                                                                                                                     |
|           | 52                                                                                                                                                                                                      | 53                                                                                                                                                                                                      | 106                                                                                                                                                                                                     |
|           | 53                                                                                                                                                                                                      | 54                                                                                                                                                                                                      | 108                                                                                                                                                                                                     |
|           | 54                                                                                                                                                                                                      | 55                                                                                                                                                                                                      | 110                                                                                                                                                                                                     |
|           | 55                                                                                                                                                                                                      | 56                                                                                                                                                                                                      | 112                                                                                                                                                                                                     |
|           | 56                                                                                                                                                                                                      | 57                                                                                                                                                                                                      | 114                                                                                                                                                                                                     |
|           | 57                                                                                                                                                                                                      | 58                                                                                                                                                                                                      | 116                                                                                                                                                                                                     |
|           | 58                                                                                                                                                                                                      | 59                                                                                                                                                                                                      | 118                                                                                                                                                                                                     |
|           | 59                                                                                                                                                                                                      | 60                                                                                                                                                                                                      | 120                                                                                                                                                                                                     |
|           | 60                                                                                                                                                                                                      | 61                                                                                                                                                                                                      | 122                                                                                                                                                                                                     |
|           | 61                                                                                                                                                                                                      | 62                                                                                                                                                                                                      | 124                                                                                                                                                                                                     |
|           | 62                                                                                                                                                                                                      | 63                                                                                                                                                                                                      | 126                                                                                                                                                                                                     |
|           | 63                                                                                                                                                                                                      | 64                                                                                                                                                                                                      | 128                                                                                                                                                                                                     |
| 7-5 -     | Reserved                                                                                                                                                                                                | Reserved                                                                                                                                                                                                | Reserved                                                                                                                                                                                                |
| 4-0 ERFWM | Enhanced RX FIFO Watermark Defines the minimum number of CAN messages stored in the Enhanced RX FIFO. When that number is reached, ERFSR[ERFWMI] becomes 1. Minimum number of CAN messages = ERFWM + 1. | Enhanced RX FIFO Watermark Defines the minimum number of CAN messages stored in the Enhanced RX FIFO. When that number is reached, ERFSR[ERFWMI] becomes 1. Minimum number of CAN messages = ERFWM + 1. | Enhanced RX FIFO Watermark Defines the minimum number of CAN messages stored in the Enhanced RX FIFO. When that number is reached, ERFSR[ERFWMI] becomes 1. Minimum number of CAN messages = ERFWM + 1. |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                      |
|---------|-----------------------------------------------|
|         | If MCR[DMA] = 1, write 0h to this field. NOTE |

## 50.5.2.41 Enhanced RX FIFO Interrupt Enable (ERFIER)

## Offset

| Register   | Offset   |
|------------|----------|
| ERFIER     | C10h     |

## Function

Contains the interrupt enables for the Enhanced RX FIFO.

Soft reset does not affect this register.

## Diagram

<!-- image -->

| Bits   | 31     | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | ERFU   | ERFO | ERFW | ERFD | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      | FWIE   | VFIE | MIIE | AIE  |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15     | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | Reserv | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      | ed     |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field    | Function                                    |
|----------|---------------------------------------------|
| 31       | Enhanced RX FIFO Underflow Interrupt Enable |
| ERFUFWIE | Enables interrupt for ERFSR[ERFUFW].        |
|          | 0b - Disable                                |
|          | 1b - Enable                                 |
| 30       | Enhanced RX FIFO Overflow Interrupt Enable  |
| ERFOVFIE | Enables interrupt for ERFSR[ERFOVF].        |

Table continues on the next page...

## Table continued from the previous page...

| Field       | Function                                                                                                             |
|-------------|----------------------------------------------------------------------------------------------------------------------|
|             | 0b - Disable 1b - Enable                                                                                             |
| 29 ERFWMIIE | Enhanced RX FIFO Watermark Indication Interrupt Enable Enables interrupt for ERFSR[ERFWMI]. 0b - Disable 1b - Enable |
| 28 ERFDAIE  | Enhanced RX FIFO Data Available Interrupt Enable Enables interrupt for ERFSR[ERFDA]. 0b - Disable 1b - Enable        |
| 27-16 -     | Reserved                                                                                                             |
| 15 -        | Reserved                                                                                                             |
| 14-0 -      | Reserved                                                                                                             |

## 50.5.2.42 Enhanced RX FIFO Status (ERFSR)

## Offset

| Register   | Offset   |
|------------|----------|
| ERFSR      | C14h     |

## Function

Contains the status fields of the Enhanced RX FIFO including error indications and a clear FIFO field.

Soft reset does not affect this register.

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                                                                                                                                                                                                                                                                       |
|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 ERFUFW | Enhanced RX FIFO Underflow Flag Indicates whether an underflow condition occurred in the enhanced RX FIFO. If ERFIER[ERFUFWIE] = 1, this field generates an interrupt. 0b - No such occurrence 1b - Underflow                                                                                                                  |
| 30 ERFOVF | Enhanced RX FIFO Overflow Flag Indicates whether an overflow condition occurred in the Enhanced RX FIFO. If ERFIER[ERFOVFIE] = 1, this field generates an interrupt. 0b - No such occurrence 1b - Overflow                                                                                                                     |
| 29 ERFWMI | Enhanced RX FIFO Watermark Indication Flag Indicates whether the number of messages available in the Enhanced RX FIFO is greater than the watermark defined in ERFCR[ERFWM]. If ERFIER[ERFWMIIE] = 1, this field generates an interrupt. 0b - No such occurrence 1b - Number of messages in FIFO is greater than the watermark |
| 28 ERFDA  | Enhanced RX FIFO Data Available Flag Indicates whether there is at least one message stored in the ERX FIFO. If ERFIER[ERFDAIE] = 1, this field generates an interrupt. 0b - No such occurrence 1b - At least one message stored in Enhanced RX FIFO                                                                           |

Table continues on the next page...

CAN (FlexCAN)

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                      |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 27 ERFCLR | Enhanced RX FIFO Clear Writing one to this field during Freeze mode clears Enhanced RX FIFO content. Writing to this field outside Freeze mode, or writing 0 to this field, has no effect. 0b - No effect 1b - Clear enhanced RX FIFO content |
| 26-18 -   | Reserved                                                                                                                                                                                                                                      |
| 17 ERFE   | Enhanced RX FIFO Empty Flag Indicates whether Enhanced RX FIFO is empty. 0b - Not empty 1b - Empty                                                                                                                                            |
| 16 ERFF   | Enhanced RX FIFO Full Flag Indicates whether enhanced RX FIFO is full. 0b - Not full 1b - Full                                                                                                                                                |
| 15 -      | Reserved                                                                                                                                                                                                                                      |
| 14-6 -    | Reserved                                                                                                                                                                                                                                      |
| 5-0 ERFEL | Enhanced RX FIFO Elements Indicates the number of CAN messages stored in the Enhanced RX FIFO.                                                                                                                                                |

## 50.5.2.43 High-Resolution Timestamp (HR\_TIME\_STAMP0 - HR\_TIME\_STAMP127)

## Offset

For n = 0 to 127:

| Register       | Offset          |
|----------------|-----------------|
| HR_TIME_STAMPn | C30h + (n × 4h) |

## Function

Stores a copy of a 32-bit timer at the start or end of a CAN frame.

HR\_TIME\_STAMP0 stores the 32-bit timestamp associated with MB0, HR\_TIME\_STAMP1 stores the 32-bit timestamp associated with MB1, and so on.

Reset does not affect these registers.

## NOTE

Do not write to these registers outside Freeze mode.

Table 379. High-Resolution Timestamp register operation

| TSTAMPCAP   | Captured timebase                        | Capture point                                                                                                  |
|-------------|------------------------------------------|----------------------------------------------------------------------------------------------------------------|
| b00         | None                                     | None                                                                                                           |
| b01         | 32 bits of high-resolution on-chip timer | Seventh bit of the end-of-frame field for transmission and sixth bit of the end-of- frame field for reception. |
| b10         | 32 bits of high-resolution on-chip timer | Start of frame                                                                                                 |
| b11         | 32 bits of high-resolution on-chip timer | Start of frame for classical CAN frame format and res bit for CAN FD frame format                              |

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                             |
|---------|----------------------------------------------------------------------------------------------------------------------|
| 31-0    | High-Resolution Timestamp                                                                                            |
| TS      | Captures the copy of the timestamp of corresponding message buffer. This field always captures a 32-bit timer value. |

## 50.5.2.44 Enhanced RX FIFO Filter Element (ERFFEL0 - ERFFEL127)

## Offset

For n = 0 to 127:

| Register   | Offset           |
|------------|------------------|
| ERFFELn    | 3000h + (n × 4h) |

## Function

Stores the filter elements of the Enhanced RX FIFO.

For standard ID filtering, each ERFFEL register stores one filter element. For extended ID filtering, each pair of ERFFEL registers stores one filter element.

ERFFEL registers can be written only in Freeze mode; otherwise, the module blocks them. Reset does not affect these registers. They are located in RAM and must be explicitly initialized prior to any reception.

## Diagram

<!-- image -->

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|---------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W     |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset   | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R       |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W Reset | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    | u    |

## Fields

| Field   | Function                                                                                                                                                     |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Filter Element Bits                                                                                                                                          |
| FEL     | Stores filter elements. Each filter element is used during the match process. If the matching criteria are met, a message is stored in the Enhanced RX FIFO. |

## 50.5.3 Message buffer structure

The message buffer structure used by FlexCAN is represented in the following figure. Both extended (29-bit identifier) and standard (11-bit identifier) frames used in the CAN specification (Version 2.0 Part B) are represented. Each individual message buffer is 16, 24, 40, or 72 bytes, depending on the quantity of data bytes allocated for the message payload: 8, 16, 32, or 64 data bytes, respectively.

The memory area 80h-87Fh is used by the message buffers. When CAN FD is enabled, the exact address for each message buffer depends on the size of its payload. See FlexCAN memory partition for CAN FD.

When CAN FD is enabled, the memory area 1000h-17FFh can be used to implement up to 28 additional 64-byte message buffers. This additional region (enhanced message buffer memory) can be used partially or entirely only if the total number of message buffers configured by MCR[MAXMB] is less than 128. The maximum number of message buffers in the area 80h-87FH and area 1000h-17FFH is 128. See FlexCAN memory partition for CAN FD.

Table 380. Message buffer structure example with 64-byte payload

<!-- image -->

|    | 31   | 30   | 29   | 28   | 27                     | 24                     | 23                     | 22                     | 21                     | 20                     | 19                     | 18   | 17   | 16   | 15            | 8 7   | 0   |
|----|------|------|------|------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------|------|------|---------------|-------|-----|
| 0h | EDL  | BRS  | ESI  |      | CODE                   |                        | SRR                    |                        | IDE                    | RTR                    | DLC                    |      |      |      | TIMESTAMP     |       |     |
| 4h | PRIO | PRIO | PRIO |      | ID (standard/extended) | ID (standard/extended) | ID (standard/extended) | ID (standard/extended) | ID (standard/extended) | ID (standard/extended) | ID (standard/extended) |      |      |      | ID (extended) |       |     |

Table continues on the next page...

CAN (FlexCAN)

Table 380. Message buffer structure example with 64-byte payload (continued)

| 8h   | Data byte 0   | Data byte 1   | Data byte 2   | Data byte 3   |
|------|---------------|---------------|---------------|---------------|
| Ch   | Data byte 4   | Data byte 5   | Data byte 6   | Data byte 7   |
| 10h  | Data byte 8   | Data byte 9   | Data byte 10  | Data byte 11  |
| 14h  | Data byte 12  | Data byte 13  | Data byte 14  | Data byte 15  |
| 18h  | Data byte 16  | Data byte 17  | Data byte 18  | Data byte 19  |
| 1Ch  | Data byte 20  | Data byte 21  | Data byte 22  | Data byte 23  |
| 20h  | Data byte 24  | Data byte 25  | Data byte 26  | Data byte 27  |
| 24h  | Data byte 28  | Data byte 29  | Data byte 30  | Data byte 31  |
| 28h  | Data byte 32  | Data byte 33  | Data byte 34  | Data byte 35  |
| 2Ch  | Data byte 36  | Data byte 37  | Data byte 38  | Data byte 39  |
| 30h  | Data byte 40  | Data byte 41  | Data byte 42  | Data byte 43  |
| 34h  | Data byte 44  | Data byte 45  | Data byte 46  | Data byte 47  |
| 38h  | Data byte 48  | Data byte 49  | Data byte 50  | Data byte 51  |
| 3Ch  | Data byte 52  | Data byte 53  | Data byte 54  | Data byte 55  |
| 40h  | Data byte 56  | Data byte 57  | Data byte 58  | Data byte 59  |
| 44h  | Data byte 60  | Data byte 61  | Data byte 62  | Data byte 63  |

Table 381. Field descriptions

| Mnemonic   | Field                 | Description                                                                                                                                                                                                                |
|------------|-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| EDL        | Extended Data Length  | Distinguishes between CAN format and CAN FD format frames. EDL must not be 1 for message buffers configured to RANSWER with code field 1010b (see table below).                                                            |
| BRS        | Bit Rate Switch       | Defines whether the bit rate is switched inside a CAN FD format frame.                                                                                                                                                     |
| ESI        | Error State Indicator | Indicates whether the transmitting node is error-active or error-passive.                                                                                                                                                  |
| CODE       | Message Buffer Code   | Can be accessed (read or write) by the CPU and by the FlexCAN module itself, as part of the message buffer matching and arbitration process. The encoding is shown in Table 382 and Table 383. See Functional description. |

Table 382. Message buffer code for RX buffers

| CODE description                               | RX code BEFORE RX new frame   | SRV 1   | RX code AFTER successful reception 2   | RRS 3   | Comment                                                      |
|------------------------------------------------|-------------------------------|---------|----------------------------------------|---------|--------------------------------------------------------------|
| 0000b: INACTIVE. Message buffer is not active. | INACTIVE                      | -       | -                                      | -       | Message buffer does not participate in the matching process. |

Table continues on the next page...

Table 382. Message buffer code for RX buffers (continued)

| CODE description                                                        | RX code BEFORE RX new frame   | SRV 1   | RX code AFTER successful reception 2   | RRS 3   | Comment                                                                                                                                                                                                                                                                                                                       |
|-------------------------------------------------------------------------|-------------------------------|---------|----------------------------------------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0100b: EMPTY. Message buffer is active and empty.                       | EMPTY                         | -       | FULL                                   | -       | When a frame is received successfully (after Move-in), CODE is automatically updated to FULL.                                                                                                                                                                                                                                 |
| 0010b: FULL. Message buffer is full.                                    | FULL                          | Yes     | FULL                                   | -       | The act of reading the Control and Status word followed by unlocking the message buffer (SRV) does not make CODE return to EMPTY. It remains FULL. If a new frame is moved to the message buffer after the message buffer is serviced, the code remains FULL. See Matching process for matching details related to FULL code. |
| 0010b: FULL. Message buffer is full.                                    | FULL                          | No      | OVERRUN                                | -       | If the message buffer is FULL and a new frame is moved to this message buffer before the CPU services it, CODE is automatically updated to OVERRUN. See Matching process for details about overrun behavior.                                                                                                                  |
| 0110b: OVERRUN. Message buffer is being overwritten into a full buffer. | OVERRUN                       | Yes     | FULL                                   | -       | If CODE indicates OVERRUN and the CPU has serviced the message buffer, when a new frame is moved to the message buffer, CODE returns to FULL.                                                                                                                                                                                 |
| 0110b: OVERRUN. Message buffer is being overwritten into a full buffer. | OVERRUN                       | No      | OVERRUN                                | -       | If CODE already indicates OVERRUN, and another new frame must be moved, the message buffer is overwritten again, and CODE remains OVERRUN. See Matching process for                                                                                                                                                           |

Table continues on the next page...

Table 382. Message buffer code for RX buffers (continued)

| CODE description                                                                                                         | RX code BEFORE RX new frame   | SRV 1   | RX code AFTER successful reception 2   | RRS 3   | Comment                                                                                                                                                                                                                                                                                                                                   |
|--------------------------------------------------------------------------------------------------------------------------|-------------------------------|---------|----------------------------------------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                                                                                          |                               |         |                                        |         | details about overrun behavior.                                                                                                                                                                                                                                                                                                           |
| 1010b: RANSWER 4 . A frame was configured to recognize a Remote Request frame and transmit a Response frame in return. 5 | RANSWER                       | -       | TANSWER (1110b)                        | 0       | A Remote Answer was configured to recognize a Remote Request frame received. After that, a message buffer is set to transmit a response frame. CODE is automatically changed to TANSWER (1110b). See Matching process for details. If CTRL2[RRS] = 0, transmit a response frame when a remote request frame with the same ID is received. |
| 1010b: RANSWER 4 . A frame was configured to recognize a Remote Request frame and transmit a Response frame in return. 5 | RANSWER                       | -       | -                                      | 1       | This code is ignored during matching and arbitration process. See Matching process for details.                                                                                                                                                                                                                                           |
| CODE[0] = 1: BUSY. FlexCAN is updating the contents of the message buffer. The CPU must not access the message buffer.   | BUSY 6                        | -       | FULL                                   | -       | Indicates that the message buffer is being updated. It automatically becomes 0 and does not interfere with the next CODE.                                                                                                                                                                                                                 |
| CODE[0] = 1: BUSY. FlexCAN is updating the contents of the message buffer. The CPU must not access the message buffer.   | BUSY 6                        | -       | OVERRUN                                | -       | Indicates that the message buffer is being updated. It automatically becomes 0 and does not interfere with the next CODE.                                                                                                                                                                                                                 |

1. SRV: Serviced message buffer. Message buffer was read and unlocked by reading TIMER or other message buffer.
3. Remote Request Stored field. See Control 2 (CTRL2).

2. A frame is considered a successful reception after the frame to be moved to message buffer (move-in process). See Move-in.

4. Code 1010b is not considered TX and a message buffer with this code should not be aborted.
6. For TX message buffers, the BUSY bit should be ignored upon read, except when MCR[AEN] = 1. If this field is 1, the corresponding message buffer does not participate in the matching process.
5. Code 1010b must be used in message buffers configured in CAN FD format, with EDL = 1.

Table 383. Message buffer code for TX buffers

| CODE Description                               | TX Code BEFORE TX frame   | MB RTR   | TX Code AFTER successful transmission   | Comment                                                     |
|------------------------------------------------|---------------------------|----------|-----------------------------------------|-------------------------------------------------------------|
| 1000b: INACTIVE. Message buffer is not active. | INACTIVE                  | -        | -                                       | Message buffer does not participate in arbitration process. |

Table continues on the next page...

Table 383. Message buffer code for TX buffers (continued)

| CODE Description                                                                                   | TX Code BEFORE TX frame   | MB RTR   | TX Code AFTER successful transmission   | Comment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|----------------------------------------------------------------------------------------------------|---------------------------|----------|-----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1001b: ABORT. Message buffer is aborted.                                                           | ABORT                     | -        | -                                       | Message buffer does not participate in arbitration process.                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 1100b: DATA. Message buffer is a TX data frame (MB RTR must be 0).                                 | DATA                      | 0        | INACTIVE                                | Transmit data frame unconditionally once. After transmission, the message buffer automatically returns to the INACTIVE state.                                                                                                                                                                                                                                                                                                                                                            |
| 1100b: REMOTE. Message buffer is a Transmit Remote Request frame (MB RTR must be 1).               | REMOTE                    | 1        | EMPTY                                   | Transmit remote request frame unconditionally once. After transmission, the message buffer automatically becomes an RX Empty message buffer with the same ID.                                                                                                                                                                                                                                                                                                                            |
| 1110b: TANSWER. Message buffer is a Transmit Response frame from an incoming Remote Request frame. | TANSWER                   | -        | RANSWER                                 | This intermediate code is automatically written to the message buffer by the CHI as a result of a match to a Remote Request frame. The Remote Response frame is transmitted unconditionally once, then the code automatically returns to RANSWER (1010b). The CPU can also write this code with the same effect. The Remote Response frame can be a data frame or another remote request frame, depending on the value of RTR. See Matching process and Arbitration process for details. |

Table 384. RX and TX message buffer field descriptions

| Mnemonic   | Field                     | Description                                                                                                                                                                                                                                                                                                                                                                                         |
|------------|---------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| SRR        | Substitute Remote Request | Fixed recessive bit, used only in extended format. Write 1 to SRR for transmission (TX Buffers). SRR is stored with the value received on the CAN bus for RXreceiving buffers. It can be received as either recessive or dominant. If FlexCAN receives this bit as dominant, it is interpreted as an arbitration loss. 1: Recessive value is compulsory for transmission in extended format frames. |

Table continues on the next page...

Table 384. RX and TX message buffer field descriptions (continued)

| Mnemonic          | Field                          | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|-------------------|--------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                   |                                | 0: Dominant is not a valid value for transmission in extended format frames.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| IDE               | ID Extended Bit                | Identifies whether the frame format is standard or extended. 1: Frame format is extended 0: Frame format is standard                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| RTR               | Remote Transmission Request    | Affects the behavior of remote frames and is part of the reception filter. See Table 382, Table 383, and CTRL2[RRS]. If FlexCAN transmits this field as 1 (recessive) and receives it as 0 (dominant), it is interpreted as an arbitration loss. If this field is transmitted as 0 (dominant) and it is received as 1 (recessive), FlexCAN treats it as a bit error. If the value received matches the value transmitted, it is considered a successful bit transmission. 1: If messagebuffer is TX, indicates that the currentmessagebuffermayhavea Remote Request frame to be transmitted. If the message buffer is RX, incoming remote request frames may be stored. 0: Indicates that the current message buffer has a Data frame to be transmitted. In an RX message buffer, it may be considered in matching processes. NOTE |
| DLC               | Length of Data in Bytes        | Indicates the length (in bytes) of the RX or TX data, which is located in offset 8h-Fh of the message buffer space (see Table 380). In reception, this field is written by FlexCAN, copied from the DLC(Data Length Code) field of the received frame. In transmission, this field is written by the CPUandcorresponds to the DLCfield value of the frame to be transmitted. When RTR = 1, the frame to be transmitted is a remote frame and does not include the data field, regardless of the DLC field (see Table 386).                                                                                                                                                                                                                                                                                                         |
| TIMESTAMP         | Free-Running Counter Timestamp | Provides a copy of the Free-Running Timer, captured for TX and RX frames when the beginning of the Identifier field appears on the CAN bus. See Table 385 for Timestamp operation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| PRIO              | Local priority                 | Used only when MCR[LPRIOEN] = 1, and only makes sense for transmit message buffers. These bits are not transmitted. They are appended to the regular ID to define the transmission priority. See Arbitration process.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ID                | Frame Identifier               | In standard frame format, only the 11 most significant bits (28 to 18) are used for frame identification in both receive and transmit cases. The 18 least significant bits are ignored. In extended frame format, all bits are used for frame identification in both receive and transmit cases.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| DATA BYTE 0 to 63 | Data Field                     | Up to sixty-four bytes can be used for a data frame, depending on the size of payload selected for the message buffers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

Table continues on the next page...

Table 384. RX and TX message buffer field descriptions (continued)

| Mnemonic   | Field   | Description                                                                                                                                       |
|------------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------|
|            |         | For RX frames, the data is stored as it is received from the CAN bus. DATA BYTE ( n ) is valid only if n is less than DLC, as shown in Table 386. |

## Table 385. Timestamp operation

| TSTAMPCAP   | MBTSBASE   | TIMER_SOURCE   | Captured timebase                               | Capture point                                                                                                |
|-------------|------------|----------------|-------------------------------------------------|--------------------------------------------------------------------------------------------------------------|
| b00         | bxx        | 0              | CAN_TIMER incremented by CAN bit clock          | Second bit of identifier field                                                                               |
| b00         | bxx        | 1              | CAN_TIMER incremented by on-chip timer clock    | Second bit of identifier field                                                                               |
| bxx         | b00        | 0              | CAN_TIMER incremented by CAN bit clock          | Second bit of identifier field                                                                               |
| bxx         | b00        | 1              | CAN_TIMER incremented by on-chip timer clock    | Second bit of identifier field                                                                               |
| b01         | b01        | x              | Lower 16 bits of high- resolution on-chip timer | Seventh bit of the end of frame field for transmission and sixth bit of the end of frame field for reception |
| b01         | b10        | x              | Upper 16 bits of high- resolution on-chip timer | Seventh bit of the end of frame field for transmission and sixth bit of the end of frame field for reception |
| b10         | b01        | x              | Lower 16 bits of high- resolution on-chip timer | Start of frame                                                                                               |
| b10         | b10        | x              | Upper 16 bits of high- resolution on-chip timer | Start of frame                                                                                               |
| b11         | b01        | x              | Lower 16 bits of high- resolution on-chip timer | Start of frame for classical CAN frame format and res bit for CAN FD frame format                            |
| b11         | b10        | x              | Upper 16 bits of high- resolution on-chip timer | Start of frame for classical CAN frame format and res bit for CAN FD frame format                            |

## Table 386. DATA BYTE validity

|   DLC | Valid data bytes   |
|-------|--------------------|
|     0 | none               |
|     1 | DATA BYTE 0        |
|     2 | DATA BYTE 0 to 1   |
|     3 | DATA BYTE 0 to 2   |
|     4 | DATA BYTE 0 to 3   |

Table continues on the next page...

Table 386. DATA BYTE validity (continued)

|   DLC | Valid data bytes   |
|-------|--------------------|
|     5 | DATA BYTE 0 to 4   |
|     6 | DATA BYTE 0 to 5   |
|     7 | DATA BYTE 0 to 6   |
|     8 | DATA BYTE 0 to 7   |
|     9 | DATA BYTE 0 to 11  |
|    10 | DATA BYTE 0 to 15  |
|    11 | DATA BYTE 0 to 19  |
|    12 | DATA BYTE 0 to 23  |
|    13 | DATA BYTE 0 to 31  |
|    14 | DATA BYTE 0 to 47  |
|    15 | DATA BYTE 0 to 63  |

## 50.5.4 FlexCAN memory partition for CAN FD

When CAN FD is enabled, FlexCAN RAM can be partitioned into blocks of 512 bytes each. Each block can accommodate a number of message buffers depending on the configuration provided by FDCTRL[MBDSRn] as shown in Table 387.

Table 387. RAM partition

|   RAM block | Number of MBs with 8 bytes (default range)   | Size control field in FDCTRL   | Number of MBs of different sizes, per block                                                                                                                       |
|-------------|----------------------------------------------|--------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           0 | 0 to 31                                      | MBDSR0                         | MBDSR0 = 00, 32 MBs with 8-byte payload MBDSR0 = 01, 21 MBs with 16-byte payload MBDSR0 = 10, 12 MBs with 32-byte payload MBDSR0 = 11, 7 MBs with 64-byte payload |
|           1 | 32 to 63                                     | MBDSR1                         | MBDSR1 = 00, 32 MBs with 8-byte payload MBDSR1 = 01, 21 MBs with 16-byte payload MBDSR1 = 10, 12 MBs with 32-byte payload MBDSR1 = 11, 7 MBs with 64-byte payload |
|           2 | 64 to 95                                     | MBDSR2                         | MBDSR2 = 00, 32 MBs with 8-byte payload MBDSR2 = 01, 21 MBs with 16-byte payload MBDSR2 = 10, 12 MBs with 32-byte payload MBDSR2 = 11, 7 MBs with 64-byte payload |
|           3 | 96 to 127                                    | MBDSR3                         | MBDSR3 = 00, 32 MBs with 8-byte payload MBDSR3 = 01, 21 MBs with 16-byte payload MBDSR3 = 10, 12 MBs with 32-byte payload                                         |

Table continues on the next page...

Table 387. RAM partition (continued)

| RAM block   | Number of MBs with 8 bytes (default range)   | Size control field in FDCTRL   | Number of MBs of different sizes, per block                          |
|-------------|----------------------------------------------|--------------------------------|----------------------------------------------------------------------|
|             |                                              |                                | MBDSR3 = 11, 7 MBs with 64-byte payload                              |
| 4           | -                                            | -                              | 7 MBs with 64 bytes (total number of MBs in blocks 0, 1, 2, 3 ≤ 121) |
| 5           | -                                            | -                              | 7 MBs with 64 bytes (total number of MBs in blocks 0, 1, 2, 3 ≤ 114) |
| 6           | -                                            | -                              | 7 MBs with 64 bytes (total number of MBs in blocks 0, 1, 2, 3 ≤ 107) |
| 7           | -                                            | -                              | 7 MBs with 64 bytes (total number of MBs in blocks 0, 1, 2, 3 ≤ 100) |

Payload sizes of 16, 32, or 64 bytes may be configured in some or all of RAM blocks 0, 1, 2, and 3. In those cases, the total number of MBs and their respective number order may differ from the default configuration of 8 bytes. Consider an example where Block0 is configured to an 8-byte payload, Block1 to a 16-byte payload, Block2 to 32-byte payload and Block3 to a 64-byte payload. Suppose also that MCR[MAXMB] is configured to 95. In this case, Table 388 indicates how the message buffers are arranged in RAM.

Table 388. RAM partition example

|   RAM block | Payload size                          |   Number of MBs in the RAM block | Message buffer range   |
|-------------|---------------------------------------|----------------------------------|------------------------|
|           0 | FDCTRL[MBDSR0] = 00, 8- byte payload  |                               32 | 0 to 31                |
|           1 | FDCTRL[MBDSR1] = 01, 16- byte payload |                               21 | 32 to 52               |
|           2 | FDCTRL[MBDSR2] = 10, 32- byte payload |                               12 | 53 to 64               |
|           3 | FDCTRL[MBDSR3] = 11, 64- byte payload |                                7 | 65 to 71               |
|           4 | 64-byte payload                       |                                7 | 72 to 78               |
|           5 | 64-byte payload                       |                                7 | 79 to 85               |
|           6 | 64-byte payload                       |                                7 | 85 to 92               |
|           7 | 64-byte payload                       |                                3 | 93 to 95               |

## 50.5.5 FlexCAN message buffer memory map

The FlexCAN memory buffers are allocated in memory according to the tables below.

Table 389. 8-byte message buffers

| Address offset (hex)   | MBDSR = b00 8-byte payload   |
|------------------------|------------------------------|
| 0080                   | MB0                          |
| 0090                   | MB1                          |
| 00A0                   | MB2                          |
| 00B0                   | MB3                          |
| 00C0                   | MB4                          |
| 00D0                   | MB5                          |
| 00E0                   | MB6                          |
| 00F0                   | MB7                          |
| 0100                   | MB8                          |
| 0110                   | MB9                          |
| 0120                   | MB10                         |
| 0130                   | MB11                         |
| 0140                   | MB12                         |
| 0150                   | MB13                         |
| 0160                   | MB14                         |
| 0170                   | MB15                         |
| 0180                   | MB16                         |
| 0190                   | MB17                         |
| 01A0                   | MB18                         |
| 01B0                   | MB19                         |
| 01C0                   | MB20                         |
| 01D0                   | MB21                         |
| 01E0                   | MB22                         |
| 01F0                   | MB23                         |
| 0200                   | MB24                         |
| 0210                   | MB25                         |
| 0220                   | MB26                         |
| 0230                   | MB27                         |
| 0240                   | MB28                         |
| 0250                   | MB29                         |
| 0260                   | MB30                         |

Table continues on the next page...

Table 389. 8-byte message buffers (continued)

| Address offset (hex)   | MBDSR = b00 8-byte payload   |
|------------------------|------------------------------|
| 0270                   | MB31                         |
| 0280                   | MB32                         |
| 0290                   | MB33                         |
| 02A0                   | MB34                         |
| 02B0                   | MB35                         |
| 02C0                   | MB36                         |
| 02D0                   | MB37                         |
| 02E0                   | MB38                         |
| 02F0                   | MB39                         |
| 0300                   | MB40                         |
| 0310                   | MB41                         |
| 0320                   | MB42                         |
| 0330                   | MB43                         |
| 0340                   | MB44                         |
| 0350                   | MB45                         |
| 0360                   | MB46                         |
| 0370                   | MB47                         |
| 0380                   | MB48                         |
| 0390                   | MB49                         |
| 03A0                   | MB50                         |
| 03B0                   | MB51                         |
| 03C0                   | MB52                         |
| 03D0                   | MB53                         |
| 03E0                   | MB54                         |
| 03F0                   | MB55                         |
| 0400                   | MB56                         |
| 0410                   | MB57                         |
| 0420                   | MB58                         |
| 0430                   | MB59                         |
| 0440                   | MB60                         |
| 0450                   | MB61                         |

Table continues on the next page...

Table 389. 8-byte message buffers (continued)

| Address offset (hex)   | MBDSR = b00 8-byte payload   |
|------------------------|------------------------------|
| 0460                   | MB62                         |
| 0470                   | MB63                         |
| 0480                   | MB64                         |
| 0490                   | MB65                         |
| 04A0                   | MB66                         |
| 04B0                   | MB67                         |
| 04C0                   | MB68                         |
| 04D0                   | MB69                         |
| 04E0                   | MB70                         |
| 04F0                   | MB71                         |
| 0500                   | MB72                         |
| 0510                   | MB73                         |
| 0520                   | MB74                         |
| 0530                   | MB75                         |
| 0540                   | MB76                         |
| 0550                   | MB77                         |
| 0560                   | MB78                         |
| 0570                   | MB79                         |
| 0580                   | MB80                         |
| 0590                   | MB81                         |
| 05A0                   | MB82                         |
| 05B0                   | MB83                         |
| 05C0                   | MB84                         |
| 05D0                   | MB85                         |
| 05E0                   | MB86                         |
| 05F0                   | MB87                         |
| 0600                   | MB88                         |
| 0610                   | MB89                         |
| 0620                   | MB90                         |
| 0630                   | MB91                         |
| 0640                   | MB92                         |

Table continues on the next page...

Table 389. 8-byte message buffers (continued)

| Address offset (hex)   | MBDSR = b00 8-byte payload   |
|------------------------|------------------------------|
| 0650                   | MB93                         |
| 0660                   | MB94                         |
| 0670                   | MB95                         |
| 0680                   | MB96                         |
| 0690                   | MB97                         |
| 06A0                   | MB98                         |
| 06B0                   | MB99                         |
| 06C0                   | MB100                        |
| 06D0                   | MB101                        |
| 06E0                   | MB102                        |
| 06F0                   | MB103                        |
| 0700                   | MB104                        |
| 0710                   | MB105                        |
| 0720                   | MB106                        |
| 0730                   | MB107                        |
| 0740                   | MB108                        |
| 0750                   | MB109                        |
| 0760                   | MB110                        |
| 0770                   | MB111                        |
| 0780                   | MB112                        |
| 0790                   | MB113                        |
| 07A0                   | MB114                        |
| 07B0                   | MB115                        |
| 07C0                   | MB116                        |
| 07D0                   | MB117                        |
| 07E0                   | MB118                        |
| 07F0                   | MB119                        |
| 0800                   | MB120                        |
| 0810                   | MB121                        |
| 0820                   | MB122                        |
| 0830                   | MB123                        |

Table continues on the next page...

Table 389. 8-byte message buffers (continued)

|   Address offset (hex) | MBDSR = b00 8-byte payload   |
|------------------------|------------------------------|
|                   0840 | MB124                        |
|                   0850 | MB125                        |
|                   0860 | MB126                        |
|                   0870 | MB127                        |

## Table 390. 16-byte message buffers

| Address offset (hex)   | MBDSR = b01 16-byte payload   |
|------------------------|-------------------------------|
| 0080                   | MB0                           |
| 0098                   | MB1                           |
| 00B0                   | MB2                           |
| 00C8                   | MB3                           |
| 00E0                   | MB4                           |
| 00F8                   | MB5                           |
| 0110                   | MB6                           |
| 0128                   | MB7                           |
| 0140                   | MB8                           |
| 0158                   | MB9                           |
| 0170                   | MB10                          |
| 0188                   | MB11                          |
| 01A0                   | MB12                          |
| 01B8                   | MB13                          |
| 01D0                   | MB14                          |
| 01E8                   | MB15                          |
| 0200                   | MB16                          |
| 0218                   | MB17                          |
| 0230                   | MB18                          |
| 0248                   | MB19                          |
| 0260                   | MB20                          |
| 0280                   | MB21                          |
| 0298                   | MB22                          |

Table continues on the next page...

Table 390. 16-byte message buffers (continued)

| Address offset (hex)   | MBDSR = b01 16-byte payload   |
|------------------------|-------------------------------|
| 02B0                   | MB23                          |
| 02C8                   | MB24                          |
| 02E0                   | MB25                          |
| 02F8                   | MB26                          |
| 0310                   | MB27                          |
| 0328                   | MB28                          |
| 0340                   | MB29                          |
| 0358                   | MB30                          |
| 0370                   | MB31                          |
| 0388                   | MB32                          |
| 03A0                   | MB33                          |
| 03B8                   | MB34                          |
| 03D0                   | MB35                          |
| 03E8                   | MB36                          |
| 0400                   | MB37                          |
| 0418                   | MB38                          |
| 0430                   | MB39                          |
| 0448                   | MB40                          |
| 0460                   | MB41                          |
| 0480                   | MB42                          |
| 0498                   | MB43                          |
| 04B0                   | MB44                          |
| 04C8                   | MB45                          |
| 04E0                   | MB46                          |
| 04F8                   | MB47                          |
| 0510                   | MB48                          |
| 0528                   | MB49                          |
| 0540                   | MB50                          |
| 0558                   | MB51                          |
| 0570                   | MB52                          |
| 0588                   | MB53                          |

Table continues on the next page...

Table 390. 16-byte message buffers (continued)

| Address offset (hex)   | MBDSR = b01 16-byte payload   |
|------------------------|-------------------------------|
| 05A0                   | MB54                          |
| 05B8                   | MB55                          |
| 05D0                   | MB56                          |
| 05E8                   | MB57                          |
| 0600                   | MB58                          |
| 0618                   | MB59                          |
| 0630                   | MB60                          |
| 0648                   | MB61                          |
| 0660                   | MB62                          |
| 0680                   | MB63                          |
| 0698                   | MB64                          |
| 06B0                   | MB65                          |
| 06C8                   | MB66                          |
| 06E0                   | MB67                          |
| 06F8                   | MB68                          |
| 0710                   | MB69                          |
| 0728                   | MB70                          |
| 0740                   | MB71                          |
| 0758                   | MB72                          |
| 0770                   | MB73                          |
| 0788                   | MB74                          |
| 07A0                   | MB75                          |
| 07B8                   | MB76                          |
| 07D0                   | MB77                          |
| 07E8                   | MB78                          |
| 0800                   | MB79                          |
| 0818                   | MB80                          |
| 0830                   | MB81                          |
| 0848                   | MB82                          |
| 0860                   | MB83                          |

Table 391. 32-byte message buffers

| Address offset (hex)   | MBDSR = b10 32-byte payload   |
|------------------------|-------------------------------|
| 0080                   | MB0                           |
| 00A8                   | MB1                           |
| 00D0                   | MB2                           |
| 00F8                   | MB3                           |
| 0120                   | MB4                           |
| 0148                   | MB5                           |
| 0170                   | MB6                           |
| 0198                   | MB7                           |
| 01C0                   | MB8                           |
| 01E8                   | MB9                           |
| 0210                   | MB10                          |
| 0238                   | MB11                          |
| 0280                   | MB12                          |
| 02A8                   | MB13                          |
| 02D0                   | MB14                          |
| 02F8                   | MB15                          |
| 0320                   | MB16                          |
| 0348                   | MB17                          |
| 0370                   | MB18                          |
| 0398                   | MB19                          |
| 03C0                   | MB20                          |
| 03E8                   | MB21                          |
| 0410                   | MB22                          |
| 0438                   | MB23                          |
| 0480                   | MB24                          |
| 04A8                   | MB25                          |
| 04D0                   | MB26                          |
| 04F8                   | MB27                          |
| 0520                   | MB28                          |
| 0548                   | MB29                          |
| 0570                   | MB30                          |

Table continues on the next page...

Table 391. 32-byte message buffers (continued)

| Address offset (hex)   | MBDSR = b10 32-byte payload   |
|------------------------|-------------------------------|
| 0598                   | MB31                          |
| 05C0                   | MB32                          |
| 05E8                   | MB33                          |
| 0610                   | MB34                          |
| 0638                   | MB35                          |
| 0680                   | MB36                          |
| 06A8                   | MB37                          |
| 06D0                   | MB38                          |
| 06F8                   | MB39                          |
| 0720                   | MB40                          |
| 0748                   | MB41                          |
| 0770                   | MB42                          |
| 0798                   | MB43                          |
| 07C0                   | MB44                          |
| 07E8                   | MB45                          |
| 0810                   | MB46                          |
| 0838                   | MB47                          |

## Table 392. 64-byte message buffers

| Address offset (hex)   | MBDSR = b11 64-byte payload   |
|------------------------|-------------------------------|
| 0080                   | MB0                           |
| 00C8                   | MB1                           |
| 0110                   | MB2                           |
| 0158                   | MB3                           |
| 01A0                   | MB4                           |
| 01E8                   | MB5                           |
| 0230                   | MB6                           |
| 0280                   | MB7                           |
| 02C8                   | MB8                           |
| 0310                   | MB9                           |

Table continues on the next page...

Table 392. 64-byte message buffers (continued)

| Address offset (hex)   | MBDSR = b11 64-byte payload   |
|------------------------|-------------------------------|
| 0358                   | MB10                          |
| 03A0                   | MB11                          |
| 03E8                   | MB12                          |
| 0430                   | MB13                          |
| 0480                   | MB14                          |
| 04C8                   | MB15                          |
| 0510                   | MB16                          |
| 0558                   | MB17                          |
| 05A0                   | MB18                          |
| 05E8                   | MB19                          |
| 0630                   | MB20                          |
| 0680                   | MB21                          |
| 06C8                   | MB22                          |
| 0710                   | MB23                          |
| 0758                   | MB24                          |
| 07A0                   | MB25                          |
| 07E8                   | MB26                          |
| 0830                   | MB27                          |

Table 393. 64-byte message buffers in RAM blocks 4, 5, 6, and 7

| Address offset (hex)   | 64-byte payload   |
|------------------------|-------------------|
| 1000                   | MB28              |
| 1048                   | MB29              |
| 1090                   | MB30              |
| 10D8                   | MB31              |
| 1120                   | MB32              |
| 1168                   | MB33              |
| 11B0                   | MB34              |
| 1200                   | MB35              |
| 1248                   | MB36              |
| 1290                   | MB37              |

Table continues on the next page...

Table 393. 64-byte message buffers in RAM blocks 4, 5, 6, and 7 (continued)

| Address offset (hex)   | 64-byte payload   |
|------------------------|-------------------|
| 12D8                   | MB38              |
| 1320                   | MB39              |
| 1368                   | MB40              |
| 13B0                   | MB41              |
| 1400                   | MB42              |
| 1448                   | MB43              |
| 1490                   | MB44              |
| 14D8                   | MB45              |
| 1520                   | MB46              |
| 1568                   | MB47              |
| 15B0                   | MB48              |
| 1600                   | MB49              |
| 1648                   | MB50              |
| 1690                   | MB51              |
| 16D8                   | MB52              |
| 1720                   | MB53              |
| 1768                   | MB54              |
| 17B0                   | MB55              |

## 50.5.6 Legacy RX FIFO structure

When MCR[RFEN] = 1, the memory area 80h-DCh (which is normally occupied by MBs 0-5) is used by the reception Legacy FIFO engine.

The region 80h-8Ch contains the output of the Legacy RX FIFO, which the CPU must read as a message buffer. This output contains the oldest message that has been received but not yet read. The region 90h-DCh is reserved for internal use of the Legacy RX FIFO engine.

An additional memory area, which starts at E0h and may extend up to 2DCh (normally occupied by MBs 6-37) depending on the CTRL2[RFFN] field setting, contains the ID filter table (configurable from 8 to 128 table elements) that specifies filtering criteria for accepting frames into the Legacy RX FIFO.

Out of reset, the ID filter table flexible memory area defaults to E0h and extends only to FCh, which corresponds to MBs 6 to 7 for RFFN = 0, for backward compatibility with previous versions of FlexCAN.

The following shows the Legacy RX FIFO data structure.

Table 394. Legacy RX FIFO structure

<!-- image -->

| 31   | 28    | 24   | 23   | 22   | 21   | 20   | 18   | 17   | 16   | 15   | 8 7       | 0   |
|------|-------|------|------|------|------|------|------|------|------|------|-----------|-----|
| 80h  | IDHIT |      |      | SRR  | IDE  | RTR  | DLC  |      |      |      | TIMESTAMP |     |

Table continues on the next page...

## Table 394. Legacy RX FIFO structure (continued)

| 84h       | ID standard                       | ID standard                       | ID standard                       | ID extended                       | ID extended                       |
|-----------|-----------------------------------|-----------------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| 88h       | Data byte 0                       | Data byte 0                       | Data byte 1                       | Data byte 2                       | Data byte 3                       |
| 8Ch       | Data byte 4                       | Data byte 4                       | Data byte 5                       | Data byte 6                       | Data byte 7                       |
| 90h-DCh   | Reserved                          | Reserved                          | Reserved                          | Reserved                          | Reserved                          |
| E0h       | ID filter table element 0         | ID filter table element 0         | ID filter table element 0         | ID filter table element 0         | ID filter table element 0         |
| E4h       | ID filter table element 1         | ID filter table element 1         | ID filter table element 1         | ID filter table element 1         | ID filter table element 1         |
| E8h- 2D4h | ID filter table elements 2 to 125 | ID filter table elements 2 to 125 | ID filter table elements 2 to 125 | ID filter table elements 2 to 125 | ID filter table elements 2 to 125 |
| 2D8h      | ID filter table element 126       | ID filter table element 126       | ID filter table element 126       | ID filter table element 126       | ID filter table element 126       |
| 2DCh      | ID filter table element 127       | ID filter table element 127       | ID filter table element 127       | ID filter table element 127       | ID filter table element 127       |
|           |                                   | = Unimplemented or reserved       | = Unimplemented or reserved       | = Unimplemented or reserved       | = Unimplemented or reserved       |

Each ID filter table element occupies an entire 32-bit word. One, two, or four Identifier Acceptance Filters (IDAF) can compound each element, depending on MCR[IDAM]. The following figures show the IDAF indexation.

Table 395 shows the three different formats of the ID table elements. All elements of the table must have the same format. See Legacy RX FIFO for more information.

## Table 395. ID table structure

| Format   | 31                            | 30                            | 29                                        | 24                                        | 23                                        | 16                                        | 15                                        | 14                                        | 13                                         | 8                                          | 7                                          | 1                                          | 0                                          |
|----------|-------------------------------|-------------------------------|-------------------------------------------|-------------------------------------------|-------------------------------------------|-------------------------------------------|-------------------------------------------|-------------------------------------------|--------------------------------------------|--------------------------------------------|--------------------------------------------|--------------------------------------------|--------------------------------------------|
| A        | RTR                           | IDE                           | RXIDA (standard = 29-19, extended = 29-1) | RXIDA (standard = 29-19, extended = 29-1) | RXIDA (standard = 29-19, extended = 29-1) | RXIDA (standard = 29-19, extended = 29-1) | RXIDA (standard = 29-19, extended = 29-1) | RXIDA (standard = 29-19, extended = 29-1) | RXIDA (standard = 29-19, extended = 29-1)  | RXIDA (standard = 29-19, extended = 29-1)  | RXIDA (standard = 29-19, extended = 29-1)  | RXIDA (standard = 29-19, extended = 29-1)  | RXIDA (standard = 29-19, extended = 29-1)  |
| B        | RTR                           | IDE                           | (standard = 29-19,                        | RXIDB_0 extended = 296-)                  | RXIDB_0 extended = 296-)                  | RXIDB_0 extended = 296-)                  | RTR                                       | IDE                                       | RXIDB_1 (standard = 13-3, extended = 13-0) | RXIDB_1 (standard = 13-3, extended = 13-0) | RXIDB_1 (standard = 13-3, extended = 13-0) | RXIDB_1 (standard = 13-3, extended = 13-0) | RXIDB_1 (standard = 13-3, extended = 13-0) |
| C        | RXIDC_0 (std and ext = 31-24) | RXIDC_0 (std and ext = 31-24) | RXIDC_0 (std and ext = 31-24)             | RXIDC_0 (std and ext = 31-24)             | RXIDC_1 (std and ext = 23-;16)            | RXIDC_1 (std and ext = 23-;16)            | RXIDC_2 (std and ext = 15-8)              | RXIDC_2 (std and ext = 15-8)              | RXIDC_2 (std and ext = 15-8)               | RXIDC_2 (std and ext = 15-8)               | RXIDC_3 (std and ext = 7-0)                | RXIDC_3 (std and ext = 7-0)                | RXIDC_3 (std and ext = 7-0)                |
|          | = Unimplemented or Reserved   | = Unimplemented or Reserved   | = Unimplemented or Reserved               | = Unimplemented or Reserved               | = Unimplemented or Reserved               | = Unimplemented or Reserved               | = Unimplemented or Reserved               | = Unimplemented or Reserved               | = Unimplemented or Reserved                | = Unimplemented or Reserved                | = Unimplemented or Reserved                | = Unimplemented or Reserved                | = Unimplemented or Reserved                |

## Table 396. Field descriptions

| Mnemonic   | Field        | Description                                                                                                                                                                                                                  |
|------------|--------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| RTR        | Remote Frame | Specifies whether remote frames are accepted into the Legacy FIFO if they match the target ID. 1: Remote frames can be accepted and data frames are rejected. 0: Remote frames are rejected and data frames can be accepted. |

Table continues on the next page...

Table 396. Field descriptions (continued)

| Mnemonic                           | Field                                      | Description                                                                                                                                                                                                                                                                                                                              |
|------------------------------------|--------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| IDE                                | Extended Frame                             | Specifies whether extended or standard frames are accepted into the Legacy FIFO if they match the target ID. 1: Extended frames can be accepted and standard frames are rejected. 0: Extended frames are rejected and standard frames can be accepted.                                                                                   |
| RXIDA                              | RX Frame Identifier (Format A)             | Specifies an ID to be used as acceptance criteria for the Legacy FIFO. In the standard frame format, only the 11 most significant bits (29 to 19) are used for frame identification. In the extended frame format, all bits are used.                                                                                                    |
| RXIDB_0, RXIDB_1                   | RX Frame Identifier (Format B)             | Specifies an ID to be used as acceptance criteria for the Legacy FIFO. In the standard frame format, the 11 most significant bits (a full standard ID) (29 to 19 and 13 to 3) are used for frame identification. In the extended frame format, all 14 bits of the field are compared to the 14 most significant bits of the received ID. |
| RXIDC_0, RXIDC_1, RXIDC_2, RXIDC_3 | RX Frame Identifier (Format C)             | Specifies an ID to be used as acceptance criteria for the Legacy FIFO. In both standard and extended frame formats, all 8 bits of the field are compared to the 8 most significant bits of the received ID.                                                                                                                              |
| IDHIT                              | Identifier Acceptance Filter Hit Indicator | Indicates which identifier acceptance filter the received message in the output of the Legacy RX FIFO hit. See Legacy RX FIFO for more information.                                                                                                                                                                                      |

## 50.5.7 Enhanced RX FIFO structure

When ERFCR[ERFEN] = 1, the Enhanced RX FIFO is enabled. The region 2000h-204Ch contains the output of the Enhanced RX FIFO, which the CPU must read as a message buffer. This output contains the oldest message that has been received but not yet read.

Table 397. Enhanced RX FIFO structure

|       | 31                                                  | 30          | 29          | 28                     | 24                     | 23                                    | 22                                    | 21                                    |                                       | 20                                    | 19                                    | 18                                    | 17                                    | 16                                    | 15                                    |                                       | 8                                     | 7                                     | 6                                     | 0                                     |                                       |                                       |                                       |                                       |                                       |
|-------|-----------------------------------------------------|-------------|-------------|------------------------|------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|
| 2000h | EDL                                                 | BRS         | ESI         | RESERVED               | RESERVED               | RESERVED                              | RESERVED                              | SRR                                   | IDE                                   | RTR                                   |                                       | DLC                                   | DLC                                   | DLC                                   | DLC                                   | TIMESTAMP LEGACY                      | TIMESTAMP LEGACY                      | TIMESTAMP LEGACY                      | TIMESTAMP LEGACY                      | TIMESTAMP LEGACY                      | TIMESTAMP LEGACY                      | TIMESTAMP LEGACY                      | TIMESTAMP LEGACY                      | TIMESTAMP LEGACY                      | TIMESTAMP LEGACY                      |
| 2004h | RESERVED                                            | RESERVED    | RESERVED    | ID (STANDARD/EXTENDED) | ID (STANDARD/EXTENDED) | ID (STANDARD/EXTENDED)                | ID (STANDARD/EXTENDED)                | ID (STANDARD/EXTENDED)                | ID (STANDARD/EXTENDED)                | ID (STANDARD/EXTENDED)                | ID (STANDARD/EXTENDED)                | ID (STANDARD/EXTENDED)                | ID (STANDARD/EXTENDED)                | ID (EXTENDED)                         | ID (EXTENDED)                         | ID (EXTENDED)                         | ID (EXTENDED)                         | ID (EXTENDED)                         | ID (EXTENDED)                         | ID (EXTENDED)                         | ID (EXTENDED)                         | ID (EXTENDED)                         | ID (EXTENDED)                         | ID (EXTENDED)                         | ID (EXTENDED)                         |
| 2008h | Data byte 0                                         | Data byte 0 | Data byte 0 | Data byte 0            | Data byte 0            | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   | Data byte 1 Data byte 2 Data byte 3   |
| 200Ch | Data byte 4                                         | Data byte 4 | Data byte 4 | Data byte 4            | Data byte 4            | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   | Data byte 5 Data byte 6 Data byte 7   |
| 2010h | Data byte 8                                         | Data byte 8 | Data byte 8 | Data byte 8            | Data byte 8            | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 | Data byte 9 Data byte 10 Data byte 11 |
| 2014h | Data byte 12 Data byte 13 Data byte 14 Data byte 15 |             |             |                        |                        |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |
| 2018h | Data byte 16 Data byte 17 Data byte 18 Data byte 19 |             |             |                        |                        |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |
| 201Ch | Data byte 20 Data byte 21 Data byte 22 Data byte 23 |             |             |                        |                        |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |
| 2020h | Data byte 24 Data byte 25 Data byte 26 Data byte 27 |             |             |                        |                        |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |
| 2024h | Data byte 28 Data byte 29 Data byte 30 Data byte 31 |             |             |                        |                        |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |
| 2028h | Data byte 32 Data byte 33 Data byte 34 Data byte 35 |             |             |                        |                        |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |
| 202Ch | Data byte 36 Data byte 37 Data byte 38 Data byte 39 |             |             |                        |                        |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |                                       |

Table continues on the next page...

## Table 397. Enhanced RX FIFO structure (continued)

| 2030h   | Data byte 40                         | Data byte 41                         | Data byte 42                         | Data byte 43                         |
|---------|--------------------------------------|--------------------------------------|--------------------------------------|--------------------------------------|
| 2034h   | Data byte 44                         | Data byte 45                         | Data byte 46                         | Data byte 47                         |
| 2038h   | Data byte 48                         | Data byte 49                         | Data byte 50                         | Data byte 51                         |
| 203Ch   | Data byte 52                         | Data byte 53                         | Data byte 54                         | Data byte 55                         |
| 2040h   | Data byte 56                         | Data byte 57                         | Data byte 58                         | Data byte 59                         |
| 2044h   | Data byte 60                         | Data byte 61                         | Data byte 62                         | Data byte 63                         |
| IH_OFF  | RESERVED ID HIT                      | RESERVED ID HIT                      | RESERVED ID HIT                      | RESERVED ID HIT                      |
| TS_OFF  | HR TIMESTAMP                         | HR TIMESTAMP                         | HR TIMESTAMP                         | HR TIMESTAMP                         |
| 2050h   |                                      |                                      |                                      |                                      |
| ...     | 31 Enhanced FIFO Elements (RESERVED) | 31 Enhanced FIFO Elements (RESERVED) | 31 Enhanced FIFO Elements (RESERVED) | 31 Enhanced FIFO Elements (RESERVED) |
| 29FCh   |                                      |                                      |                                      |                                      |

## NOTE

ID HIT offset and high-resolution timestamp offset change dynamically according to data length code (DLC) as shown in Table 398.

## Table 398. ID HIT offset and high-resolution timestamp offset

| Data Length Code (DLC)   | ID HIT offset (IH_OFF)   | High-resolution timestamp offset (TS_OFF)   |
|--------------------------|--------------------------|---------------------------------------------|
| 0                        | 2008h                    | 200Ch                                       |
| 1-4                      | 200Ch                    | 2010h                                       |
| 5-8                      | 2010h                    | 2014h                                       |
| 9                        | 2014h                    | 2018h                                       |
| 10                       | 2018h                    | 201Ch                                       |
| 11                       | 201Ch                    | 2020h                                       |
| 12                       | 2020h                    | 2024h                                       |
| 13                       | 2028h                    | 202Ch                                       |
| 14                       | 2038h                    | 203Ch                                       |
| 15                       | 2048h                    | 204Ch                                       |

## Table 399. Field descriptions

| Mnemonic   | Field                | Description                                                                                                               |
|------------|----------------------|---------------------------------------------------------------------------------------------------------------------------|
| EDL        | Extended Data Length | Distinguishes between classical CAN format and CAN FD format frames. 0: Classical CAN frame format 1: CAN FD frame format |
| BRS        | Bit Rate Switch      | Defines whether the bit rate is switched inside a CAN FD format frame.                                                    |

Table continues on the next page...

CAN (FlexCAN)

Table 399. Field descriptions (continued)

| Mnemonic          | Field                                      | Description                                                                                                                                                                                                                                                                                                                                        |
|-------------------|--------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                   |                                            | 0: Bit rate is not switched in a CAN FD frame. 1: Bit rate is switched in a CAN FD frame.                                                                                                                                                                                                                                                          |
| ESI               | Error State Indicator                      | Indicates whether the transmitting node is error-active or error-passive. This field is meaningful only if EDL = 1. 0: Error-active 1: Error-passive                                                                                                                                                                                               |
| SRR               | Substitute Remote Request                  | Fixed recessive bit, used only in extended format. Transmitting nodes always send it as recessive and receiving nodes can receive it as either recessive or dominant. If FlexCAN receives this bit as dominant, it is interpreted as an arbitration loss.                                                                                          |
| IDE               | ID Extended Bit                            | Identifies whether the frame format is standard or extended. 0: Standard 1: Extended                                                                                                                                                                                                                                                               |
| RTR               | Remote Frame                               | Identifies whether the current frame is a data frame or a remote request. 0: Data frame 1: Remote request                                                                                                                                                                                                                                          |
| DLC               | Data Length Code                           | Defines the number of bytes in the data field of a CAN frame (Data byte 0 to Data byte 63 ). When RTR = 1, the frame is a remote request and does not include the data field, regardless of the DLC field. See Table 386 for more details.                                                                                                         |
| LEGACY TIMESTAMP  | 16-bit Timestamp                           | Provides a copy of the Free-Running Timer, captured during the CAN frame. See Table 385 for details about legacy timestamp operation.                                                                                                                                                                                                              |
| ID                | Frame Identifier                           | In base frame format, only the 11 most significant bits are used for frame identification. The 18 least significant bits are ignored. In extended frame format, all bits are used for frame identification.                                                                                                                                        |
| DATA BYTE 0 to 63 | Data Field                                 | Up to sixty-four bytes can be stored in the data field.                                                                                                                                                                                                                                                                                            |
| IDHIT             | Identifier Acceptance Filter Hit Indicator | Indicates which Enhanced RX FIFO Filter Element (ERFFEL0 - ERFFEL127) the received message in the output of the Enhanced RX FIFO hit. For each filter region, standard-ID filter space, and extended-ID filter space, there is an independent index starting from zero. Table 400 shows how FlexCAN writes IDHIT according to each filter element. |
| HR TIMESTAMP      | High-resolution Timestamp                  | 32-bit timebase captured during the CAN frame. When CTRL2[TSTAMPCAP] is not zero, a 32-bit timebase is captured from a dedicated on- chip timer which operates in free-running mode. See #unique_2568/ unique_2568_Connect_42_CTRL2.TSTAMPCAP for details about capture point configuration of the high-resolution timestamp.                      |

Table 400. IDHIT for Enhanced RX FIFO

| Enhanced RX FIFO filter element - ERFFEL   | IDHIT value   | Filter element type   |
|--------------------------------------------|---------------|-----------------------|
| ERFFEL0                                    | 0             | Extended-ID           |
| ERFFEL1                                    | 1             | Extended-ID           |
| . .                                        | .             | Extended-ID           |
|                                            | .             |                       |
| .                                          | .             |                       |
| ERFFEL(m-1)                                | m-1           | Extended-ID           |
| ERFFEL(m)                                  | 0             | Standard-ID           |
| ERFFEL(m+1)                                | 1             | Standard-ID           |
| .                                          | .             | Standard-ID           |
| .                                          | .             |                       |
| .                                          | .             |                       |
| ERFFEL(2n-m+1)                             | 2x(n-m)+1     | Standard-ID           |

## NOTE

Where m = NEXIF and n = NFE. If NEXIF = 0, only standard-ID filter elements exist. If NEXIF &gt; NFE, only extended-ID filter elements exist.

## 50.6 Initialization and application information

This section provides instructions for initializing FlexCAN.

## 50.6.1 FlexCAN initialization sequence

For any configuration change or initialization, FlexCAN must be put into Freeze mode (see Freeze mode). The module must be initialized after every reset. FlexCAN memory must be initialized before switching to functional mode.

The following is a generic initialization sequence applicable to FlexCAN:

1. Initialize Module Configuration (MCR).
- a. Enable the individual filtering per message buffer and reception queue features by writing 1 to MCR[IRMQ].
- b. Enable the warning interrupts by writing 1 to MCR[WRNEN].
- c. If required, disable frame self-reception by writing 1 to MCR[SRXDIS].
- d. Enable the Legacy RX FIFO by writing 1 to MCR[RFEN] or the Enhanced RX FIFO by writing 1 to ERFCR[ERFEN].
- e. If Legacy RX FIFO or Enhanced RX FIFO is enabled and DMA is required, write 1 to MCR[DMA].
- f. Enable the abort mechanism by writing 1 to MCR[AEN].
- g. Enable the local priority feature by writing 1 to MCR[LPRIOEN].
2. Initialize Control 1 (CTRL1) and optionally CAN Bit Timing (CBT). Also initialize CAN FD Bit Timing (FDCBT).
- a. Determine the bit timing parameters: CTRL1[PROPSEG], CTRL1[PSEG1], CTRL1[PSEG2], and CTRL1[RJW].

- b. Optionally determine the bit timing parameters: CBT[EPROPSEG], CBT[EPSEG1], CBT[EPSEG2], and CBT[ERJW].
- c. Determine the CAN FD bit timing parameters: FDCBT[FPROPSEG], FDCBT[FPSEG1], FDCBT[FPSEG2], and FDCBT[FRJW].
- d. Determine the bit rate by programming CTRL1[PRESDIV] and optionally CBT[EPRESDIV].
- e. Determine the CAN FD bit rate by programming FDCBT[FPRESDIV].
- f. Determine the internal arbitration mode by programming CTRL1[LBUF].
3. If Error Code Correction (ECC) is enabled, you must initialize all FlexCAN memory. See Detection and correction of memory errors.
4. Initialize the message buffers.
- a. The control and status word of all message buffers must be initialized.
- b. If RX FIFO is enabled, the ID filter table must be initialized.
- c. Other entries in each message buffer should be initialized as required.
5. Initialize Receive Individual Mask (RXIMR0 - RXIMR127).
6. Write 1 to required interrupt mask bits in:
- IMASK registers (for all message buffer interrupts)
- Control 1 (CTRL1) and Control 2 (CTRL2) (for Bus Off and Error interrupts)
7. Write 0 to MCR[HALT].

After the last step listed above, FlexCAN attempts to synchronize to the CAN bus.

## 50.7 Glossary

| Active message buffer   | A message buffer is active if it can participate in the current matching or arbitration process.                                                        |
|-------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| Bus interface unit      | FlexCAN submodule responsible for the interface to the CPU.                                                                                             |
| Bus off                 | See CAN Specification. [5]                                                                                                                              |
| CAN                     | Controller Area Network, a serial communication protocol defined in CAN Specification [5] and ISO International Standard. [6]                           |
| CHI                     | Controller-host interface, a FlexCAN submodule responsible for message buffer matching and arbitration algorithms.                                      |
| CRC                     | Cyclic redundancy check                                                                                                                                 |
| Dominant bit            | A dominant bit wins the arbitration on the CAN bus. It is transmitted as 0.                                                                             |
| Doze mode               | A system low-power mode where the CPU bus remains active and a global Doze mode request is sent to all peripherals asking them to enter low power mode. |
| Error active            | See CAN Specification. [5]                                                                                                                              |
| Error frame             | See CAN Specification. [5]                                                                                                                              |
| Error passive           | See CAN Specification. [5]                                                                                                                              |
| Form error              | See CAN Specification. [5]                                                                                                                              |

CAN (FlexCAN)

| Hard reset                  | A reset coming from an external pin and/or following power-on. It resets everything.                                                                                                     |
|-----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Idle                        | See CAN Specification. [5]                                                                                                                                                               |
| Information processing time | See CAN Specification. [5]                                                                                                                                                               |
| Intermission                | See CAN Specification. [5]                                                                                                                                                               |
| Matching elements           | Data used in the matching process, such as ID, filter, mask, etc.                                                                                                                        |
| MB                          | See Message buffer.                                                                                                                                                                      |
| Message buffer              | Internal FlexCAN data structure containing bytes received from, or to be transmitted to, the CAN line, as well as information about this data.                                           |
| Overload frame              | See CAN Specification. [5]                                                                                                                                                               |
| Phase buffer segment        | See CAN Specification. [5]                                                                                                                                                               |
| Recessive bit               | A recessive bit loses the arbitration on the CAN bus. It is transmitted as 1.                                                                                                            |
| Sclock                      | Serial clock. Obtained by dividing the clock feeding the CAN engine (oscillator or bus clock) by a prescaler factor. The Sclock period defines the time quantum for CAN protocol timing. |
| Soft reset                  | Global reset typically used by peripherals to reinitialize some of its registers, but not all of them.                                                                                   |
| Stop mode                   | A system low-power mode in which all chip clocks are stopped for maximum power savings.                                                                                                  |
| Stuffing error              | See CAN Specification. [5]                                                                                                                                                               |
| Time quantum                | This is equal to the Sclock period. It is the minimum time period used to compose the CAN protocol bit timing.                                                                           |

## Chapter 51 Timestamp

## 51.1 Timestamping and distribution

The CAN Timestamp function enables the distribution of a common timestamp base to all CAN interfaces on the chip, which enables you to temporally correlate frames received across all CAN module instances.

CAN Timestamp supports:

- Multiple timestamp sources, selectable via software:
- Ethernet PTP timestamp counter (32-bit)
- PFE PTP Ethernet PTP timestamp counter (32-bit)
- STM\_7 (System Timer Module) counter output (32-bit)
- A timestamp synchronization and distribution submodule

## 51.2 Block diagram

<!-- image -->

The block diagram shows:

- Logic that selects the timestamp source
- Timestamping enabling logic

The timestamp logic uses the XBAR\_DIV2\_CLK 200 MHz clock for the timestamp clock domain to ensure the timestamp value delivered to the CAN modules (timestamp sinks) is:

- As accurate as possible
- Delivered without any missing counts

Refer to the LLCE and CAN chapters for details on how the timestamp value is used.

## 51.3 Timestamp synchronization controls

Configure and control CAN Timestamp via the Time Stamp Control register (TIME\_STAMP\_CONTROL\_REGISTER) in the SRC module. See the System Resource Controller (SRC) chapter for details.

- Enable timestamp synchronization and distribution via the TS\_EN field.
- Select a timestamp counter source via the CAN\_TS\_CNT\_SEL field.

The following table shows the available timestamp sources:

Table 401. Timestamp source selection

| CAN_TS_CNT_SEL value   | Timestamp source                               |
|------------------------|------------------------------------------------|
| 00b                    | Lower 32 bits of the GMAC_0 timestamp output   |
| 01b                    | 32-bit STM_7 timer output                      |
| 10b                    | Lower 32 bits of the PFE GMAC timestamp output |
| 11b                    | Reserved. Timestamp value is 0000_0000h        |

## 51.4 Application information

Perform the procedures in the following sections when using CAN Timestamp functions.

## 51.4.1 Enable timestamping

To enable CAN Timestamp:

1. Verify that all blocks related to timestamping are out of reset
2. Verify that you have enabled the required clocks
3. Select the timestamp source by setting the desired value in the SRC module's TIME\_STAMP\_CONTROL\_REGISTER[CAN\_TS\_CNT\_SEL] field. See Table 401.
4. Enable the timestamp synchronization submodule by writing 1 to the SRC module's TIME\_STAMP\_CONTROL\_REGISTER[TS\_EN] field.
5. Confiigure and enable the source selected in step 3 to start counting.
6. Enable the timestamp sinks (CAN modules) to send out the timestamp. Refer to the LLCE and CAN chapters for details on how to enable for each module.

## 51.4.2 Disable timestamping or changing the timestamp source

To disable CAN Timestamp:

1. Disable the timestamp sinks (CAN modules). Refer to the LLCE and CAN chapters for details on how to do this.
2. Disable the timestamp synchronization submodule by writing 0 to the SRC module's TIME\_STAMP\_CONTROL\_REGISTER[TS\_EN] field. This effectively pauses the timestamp output from the timestamp synchronization submodule by gating the internal clocks and causing the output timestamp flops to hold their most recent value.
3. You can now change the timestamp source, if desired, by setting the desired value in the SRC module's TIME\_STAMP\_CONTROL\_REGISTER[CAN\_TS\_CNT\_SEL] field. See Table 401.
4. To resume timestamping, see Enable timestamping.

## NOTE

When pausing or changing timestamp sources, there is a large jump or change in the timestamp values.

Timestamp

## Chapter 52 SerDes Subsystem

## 52.1 Chip-specific SerDes subsystem information

## 52.1.1 Programming guideline

## Table 402. SerDes space

| Size   | Allocation        | Accessed by    |
|--------|-------------------|----------------|
| 16 MB  | First 4 GB space  | 32-bit masters |
| 32 GB  | Beyond 4 GB space | 64-bit masters |

- For Serdes\_0:
- Accesses to the 16 MB address region (0x00\_5300\_0000 - 0x00\_53FF\_FFFF) of Serdes\_0 are translated by the chip interconnect to address region (0x58\_0000\_0000 - 0x58\_00FF\_FFFF).
- Serdes\_0 must be configured per the translated address region in (0x58\_0000\_0000 - 0x58\_00FF\_FFFF).
- Serdes\_0 MRC (XRDC\_0\_MRC10) must be programmed per non-translated address region, 0x00\_5300\_0000 -0x00\_53FF\_FFFF.
- For Serdes\_1:
- Accesses to the 16 MB address region (0x00\_4500\_0000 - 0x00\_45FF\_FFFF) of Serdes\_1 are translated by the chip interconnect to address region (0x48\_0000\_0000 - 0x48\_00FF\_FFFF).
- Serdes\_1 must be configured per the translated address region in (0x48\_0000\_0000 - 0x48\_00FF\_FFFF).
- Serdes\_1 MRC (XRDC\_1\_MRC3) must be programmed per non-translated address region, 0x00\_4500\_0000 -0x00\_45FF\_FFFF.

## 52.1.2 SerDes subsystem working modes

This chip implements two SerDes instances:

- SerDes\_0 starts at 4040\_0000.
- SerDes\_1 starts at 4410\_0000.

Each row below represents a valid configuration for SerDes.

## NOTE

On S32G234M, only PCIe\_0 is supported.

Table 403. SerDes\_0 working modes

|   Lane Configuration 1 | Serdes Subsystem Mode 2   | PHY lane 0      | PHY lane 1        | Lane 0 speed   | Lane 1 speed   |   PHY reference clock (MHz) |
|------------------------|---------------------------|-----------------|-------------------|----------------|----------------|-----------------------------|
|                      0 | Mode 0                    | PCIe0_x2 lane 0 | PCIe0_x2 lane 1   | Gen 3/2/1      | Gen 3/2/1      |                         100 |
|                      1 | Mode 1                    | PCIe0_x1 lane 0 | SGMII (GMAC0)     | Gen 3/2/1      | 1.25 Gbit/s    |                         100 |
|                      2 | Mode 2                    | PCIe0_x1 lane 0 | SGMII ( PFE_MAC2) | Gen 3/2/1      | 1.25 Gbit/s    |                         100 |

Table continues on the next page...

Table 403. SerDes\_0 working modes (continued)

|   Lane Configuration 1 | Serdes Subsystem Mode 2   | PHY lane 0   | PHY lane 1       |   Lane 0 speed | Lane 1 speed   | PHY reference clock (MHz)   |
|------------------------|---------------------------|--------------|------------------|----------------|----------------|-----------------------------|
|                      3 | Mode 3                    | SGMII(GMAC0) | SGMII (PFE_MAC2) |           1.25 | Gbit/s         | 100 or 125 3                |

1. For lane configuration settings refer to the S32G2SERDESRM.
3. The SerDes subsystem's default setting is 125 MHz.
2. For details of SS\_RW\_REG\_0[SUBSYS\_MODE], see S32G2SERDESRM.

## Table 404. SerDes\_1 working modes 1

|   Lane Configuration 2 | Serdes Subsystem Mode 3   | PHY lane 0       | PHY lane 1       | Lane 0 speed   | Lane 1 speed   | PHY reference clock (MHz)   |
|------------------------|---------------------------|------------------|------------------|----------------|----------------|-----------------------------|
|                      0 | Mode 0                    | PCIe1_x2 lane 0  | PCIe1_x2 lane 1  | Gen 3/2/1      | Gen 3/2/1      | 100                         |
|                      1 | Mode 1                    | PCIe1_x1 lane 0  | SGMII (PFE_MAC0) | Gen 3/2/1      | 1.25 Gbit/s    | 100                         |
|                      2 | Mode 2                    | PCIe1_x1 lane 0  | SGMII (PFE_MAC1) | Gen 3/2/1      | 1.25 Gbit/s    | 100                         |
|                      3 | Mode 3                    | SGMII (PFE_MAC0) | SGMII (PFE_MAC1) | 1.25 Gbits/s   | 1.25 Gbits/s   | 100 or 125 4                |
|                      4 | Mode 4                    | SGMII (PFE_MAC0) | NA               | 3.125 Gbit/s   | NA             | 125                         |

1. PCIe1 is not avail on S32G234M.
3. For details of SS\_RW\_REG\_0[SUBSYS\_MODE], see S32G2SERDESRM.
2. For lane configuration settings refer to the S32G2SERDESRM.
4. The SerDes subsystem's default setting is 125 MHz.

## 52.1.3 Ethernet MAC mapping to XPCS

## Table 405. Ethernet MAC mapping to XPCS

| SerDes instance   | XPCS0   | XPCS1   |
|-------------------|---------|---------|
| SerDes_0          | GMAC    | PFE2    |
| SerDes_1          | PFE0    | PFE1    |

## 52.1.4 Supported clocking modes

## Table 406. Supported clocking modes

| Clocking mode   | Description                                             | Restrictions                                                                               |
|-----------------|---------------------------------------------------------|--------------------------------------------------------------------------------------------|
| CRNS            | Common reference clock with no spread-spectrum clocking | None                                                                                       |
| CRSS            | Common reference clock with spread-spectrum clocking    | The SerDes subsystem supports this type only in the SerDes subsystem mode 0 configuration. |

Table continues on the next page...

## Table 406. Supported clocking modes (continued)

| Clocking mode   | Description                                               | Restrictions                                                                               |
|-----------------|-----------------------------------------------------------|--------------------------------------------------------------------------------------------|
| SRNS            | Split reference with no spread spectrum clocking          | None                                                                                       |
| SRIS            | Split reference with independent spread spectrum clocking | The SerDes subsystem supports this type only in the SerDes subsystem mode 0 configuration. |

## Table 407. Clocking mode details for PCIe modes

| Mode                        | Internal reference clock      | External reference clock   |
|-----------------------------|-------------------------------|----------------------------|
| Common clock architecture   | No                            | Yes                        |
| Separate clock architecture | Yes (Gen1 and Gen2 mode only) |                            |
| Spread spectrum supported   | No                            |                            |

## 52.1.5 Resets required for operation

## Table 408. Resets required for SerDes\_0

| Task                                       | Do this                                                |
|--------------------------------------------|--------------------------------------------------------|
| Start a power on reset of the subsystem    | In the MC_RGM, write a 1 to RGM_PRST0_0[PERIPH_5_RST]. |
| Start the PERST of the SerDes subsystem    | In the MC_RGM, write a 1 to RGM_PRST0_0[PERIPH_4_RST]. |
| Finish the power on reset of the subsystem | In the MC_RGM, write a 0 to RGM_PRST0_0[PERIPH_5_RST]. |
| Finish the PERST of the SerDes subsystem   | In the MC_RGM, write a 0 to RGM_PRST0_0[PERIPH_4_RST]. |

## Table 409. Resets required for SerDes\_1

| Task                                       | Do this                                                 |
|--------------------------------------------|---------------------------------------------------------|
| Start a power on reset of the subsystem    | In the MC_RGM, write a 1 to RGM_PRST0_0[PERIPH_17_RST]. |
| Start the PERST of the SerDes subsystem    | In the MC_RGM, write a 1 to RGM_PRST0_0[PERIPH_16_RST]. |
| Finish the power on reset of the subsystem | In the MC_RGM, write a 0 to RGM_PRST0_0[PERIPH_17_RST]. |
| Finish the PERST of the SerDes subsystem   | In the MC_RGM, write a 0 to RGM_PRST0_0[PERIPH_16_RST]. |

## 52.1.6 Register configuration for base spec

The base spec electrical limit of SerDes subsystem for an 8 Gbit/s operation require the user to program specific values in the equalization control registers. You must configure these registers before enabling the SerDes subsystem block by using PE0\_GEN\_CTRL\_3[LTSSM\_EN]. Details related to these registers are provided in the SerDes\_SS register descriptions section of the SerDes Subsystem Reference Manual, document identifier S32SERDESSUBSYSRM.

## 52.1.7 Steps to link up with PCIe

1. Lift the partition reset of the SerDes subsystem using the MC\_RGM.PRSTn registers.
2. Wait for PCIE\_SS\_PCIE\_PHY\_MPLLA\_CTRL[MPLL\_STATE] to be set for up to 3.4 ms.
3. Set equalization parameters in the PCIE\_SS\_GEN3\_EQ\_CONTROL\_OFF register.
4. Enable link training in the PCIE\_SS\_PE0\_GEN\_CTRL\_3 register.
5. Program the BARs.

## NOTE

- If PCIE\_SS\_PCIE\_PHY\_MPLLA\_CTRL[MPLL\_STATE] does not get set, the SerDes PHY is not operational.
- Loss of the reference clock at run-time is not a supported scenario.

## 52.1.8 Errors when enabling error injection in DMA channel context memories

When you enable error injection in DMA channel context memories of the SerDes subsystem and perform DMA operations, you encounter errors. These errors persist even after you disable the injection because memory accesses are based on the read-before-write pattern.

When the error injection is enabled, write operations lead to errors getting injected in the memory.

## 52.1.9 Steps to convert nonsecure accesses into secure accesses

1. Write 0 to XRDC.MDA\_W0\_n\_DFMT1[SA].
2. Write 1 to XRDC.MDA\_W0\_n\_DFMT1[VLD].

For more information on enabling XRDC, See the XRDC chapter.

## 52.1.10 Bus fault

When you insert multi-bit errors in the SerDes\_1 memory, a bus fault might occur. However, no such faults occur if you insert multi-bit errors in the SerDes\_0 memory.

## 52.1.11 IO coherency configurations

The PCIe controller supports hardware enforced coherency for inbound transactions by default, The PCIe controller automatically sets the ARDOMAIN/AWDOMAIN signals of AXI bus based on No-Snoop bits in received TLPs and memory type decided by COHERENCY\_CONTROL\_1\_OFF and COHERENCY\_CONTROL\_2\_OFF registers. It is not recommended but possible to override the automatic mapping result with the COHERENCY\_CONTROL\_3\_OFF register.

## 52.1.12 Device and revision IDs

Table 410. Device and revision IDs

| ID       |   Value (hex) |
|----------|---------------|
| Device   |          4002 |
| Revision |             1 |

## Chapter 53 SerDes General Purpose Registers (SERDES\_GPR)

## 53.1 Introduction

This module supplements the programming model for the SerDes subsystem.

## 53.2 SERDES\_GPR register descriptions

## 53.2.1 SERDES\_GPR memory map

SERDES\_0\_GPR base address: 4007\_C500h

SERDES\_1\_GPR base address: 4007\_CC00h

| Offset   | Register                             |   Width (In bits) | Access   | Reset value   |
|----------|--------------------------------------|-------------------|----------|---------------|
| 0h       | PCIE Configuration 0 (PCIE_Config_0) |                32 | RW       | 0000_0000h    |

## 53.2.2 PCIE Configuration 0 (PCIE\_Config\_0)

## Offset

| Register      | Offset   |
|---------------|----------|
| PCIE_Config_0 | 0h       |

## Function

Provides error status of PCIe AXI address or data reads and writes.

## Diagram

<!-- image -->

## Fields

| Field                          | Function                                                                                                                                                                                                                                                                                                                                                                                                                   |
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-4 -                         | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 3 parity_chk_slv_r datap_err   | parity_chk_slv_rdatap_err Parity Check Error Status Provides the error status from comparing the PCIe controller-generated AXI slave read data bits and the associated parity bits. The error is routed to FCCU. After your application manages the error, write a 1 to this field to change its value to 0. 0b - Parity error did not occur 1b - Parity error occurred                                                    |
| 2 parity_chk_mstr _wdatap_err  | parity_chk_mstr_wdatap_err Parity Check Error Status Provides the error status from comparing the PCIe controller-generated AXI master write data bits and the associated parity bits. The error is routed to FCCU. After your application manages the error, write a 1 to this field to change its value to 0. 0b - Parity error did not occur 1b - Parity error occurred                                                 |
| 1 parity_chk_mstr _awaddrp_err | mstr_awaddrp Parity Check Error Status Provides the error status from comparing the PCIe controller-generated AXI master write address bits and the associated parity bits. The error is routed to FCCU. After your application manages the error, write a 1 to this field to change its value to 0. 0b - Parity error did not occur 1b - Parity error occurred                                                            |
| 0 parity_chk_mstr _araddrp_err | mstr_araddrp Parity Check Error Status Provides the error status of the AXI master read address parity check. It is the result of comparing the PCIe controller-generated AXI master read address bits and the associated parity bits. The error is routed to FCCU. After your application manages the error, write a 1 to this field to change its value to 0. 0b - Parity error did not occur 1b - Parity error occurred |

## Chapter 54 Low Latency Communication Engine (LLCE)

## 54.1 Introduction

LLCE is a combination of cores, memory, hardware acceleration IP blocks, and firmware developed by NXP.

LLCE supports the following channels:

- 16 BCAN channels
- 2 FlexRay channels (A+B)
- 4 LINFlexD channels
- 4 LPSPI hardware interfaces

## NOTE

This chip does not support Single-Wire mode for LPSPI0 and LPSPI3.

The communication hardware channels abstract the communication that is fully supported through a firmware-defined host interface. A key advantage of this approach is that it delivers an optimized host interface to reduce the load on the host cores. It also provides flexibility because additional firmware-defined features are added over the LLCE lifetime. Contact your NXP representative for further details on firmware extension.

The figure below shows the high-level architecture of LLCE.

<!-- image -->

## 54.2 High-level features

- 16 BCAN interfaces fully compliant with ISO11898-1: 2015
- One FlexRay interface (2 channels) fully compliant with the FlexRay communications system protocol specification, Version 2.1 Rev A
- Four LINFlexD interfaces

- Fully compliant with LIN protocol versions 1.3, 2.0, 2.1, and 2.2
- Support for master and slave modes on all channels
- Four cores for high-performance operation
- Dedicated path to the HSE\_H subsystem to optimize security tasks
- Global timestamping across all BCAN, FlexRay, and LIN interfaces, with a global timebase that can be driven by:
- IEEE802.1AS timebase from PFE
- IEEE802.1AS timebase from GMAC
- Free-running 32-bit STM counter
- Advanced BCAN and FlexRay receive filtering
- Interrupt and polled operation by the host core
- Optimized FIFO-based host interface
- Communication with the host cores is abstracted
- FlexRay host communication is decoupled from the FlexRay schedule
- All peripherals on the chip are accessible by LLCE cores
- Four LPSPI hardware interfaces can be enabled with LLCE firmware

## 54.3 Reset and boot

LLCE is a firmware-based machine. You must load the firmware before using the LLCE. The LLCE cores boot during LLCE initialization by the host. After initialization completes, the LLCE moves into normal mode and is ready for full operation. The delivered host interface driver and LLCE firmware abstracts initialization.

## 54.4 Modes of operation

After initialization, all interfaces are available and operate at full performance. The abstracted host interface and firmware control communication with LLCE.

LLCE does not support low-power modes. When the chip is in Standby mode, the entire LLCE is power-gated.

## 54.5 Subsystem control

LLCE has the following system control features that the host configures prior to operation.

## 54.5.1 Reset control

Each of the LLCE core individually resets via LLCE\_SYSRSTR. If you deassert the chip's system functional reset then all LLCE cores default to the reset state. Writing to the respective field in the LLCE\_SYSRSTR allows each core to be taken out of reset. See LLCE register descriptions for details.

## 54.6 Host interface

The main functional blocks of the Host interface are as follows:

- Hardware FIFOs: Used for transmission and reception flows. In general the FIFOs transfer indexes to the message buffers that contain the communication frames. See LLCE generic FIFO.
- Shared memory: Implemented with SRAM stored in LLCE. The shared memory is mostly used for exchanging message buffer content (communication frames), commands and error or status information between LLCE and the host core.
- Core2Core interrupt module: Used to generate interrupts between LLCE and the host. See Core-to-Core module.

The architecture of the host interface is shown in the following figure.

Low Latency Communication Engine (LLCE)

Low Latency Communication Engine (LLCE)

<!-- image -->

## 54.7 Clocking options

LLCE needs the following clocks to be configured correctly for full operation. See the "Clocking Overview" chapter for details.

Table 411. LLCE clocks

| Clock name       | Description                                                                                                                                                                                                                                                                                       |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| LLCE_SYS_CLK     | This is the main LLCE clock. All cores and interconnects derive from this clock source. The source is a divided version of the XBAR_CLK that clocks the ARMCortex-M7 cores. LLCE_SYS_CLK runs at a maximum frequency of 200 MHz. Clocking LLCE slower than the maximum reduces its functionality. |
| CAN_PE_CLK[0:15] | This source clocks the protocol engine of the BCANchannels. Its source is selected from the FXOSC or output of the PERPH PLL. Each BCAN channel uses the same clock. For example, if you select 40 MHz FXOSC as a source, then it becomes the source for all the channels.                        |
| FLEXRAY_PE_CLK   | This source clocks the protocol engine of the FlexRay channels. Its source is selected from the FXOSC or output of the PERPH PLL.                                                                                                                                                                 |
| LINFLEX_CLK[0:3] | This source clocks the protocol engine of the LINFlexD channels. The LINFLEX_CLK source is LIN_BAUD_CLK, which is selected from the FXOSC or output of the PERPH PLL. To generate LINFLEX_CLK, divide LIN_BAUD_CLK by 2 within LLCE.                                                              |
| LPSPI_CLK[0:3]   | This source clocks the LPSPI channels. The LPSPI_CLK source is PER_CLK, which is selected from the FXOSC or output of the PERPH PLL.                                                                                                                                                              |

## 54.8 Global timestamping

Frames transmitted and received via the LLCE CAN and FlexRay are timestamped against a global timebase. Selection of the global timebase is configurable. See the Timestamp chapter for global timestamp sources and how they can be selected.

Also see the LLCE host interface and firmware description for supported timestamping of specific channels.

## 54.9 Host interface events or interrupts

The host core can generate events or interrupts on the individual LLCE cores by writing to the core2core interface. With this action, the host cores generate events or interrupts on LLCE cores 0, 1, 2, and 3. See the host interface documentation for further details.

Low Latency Communication Engine (LLCE)

It is also possible for the LLCE cores 0, 1, 2, and 3 to generate events or interrupts on the chip's host cores. See the interrupt map file attached to this document.

An interrupt forwarding mechanism is also available through firmware feature for the modules not having direct interrupt connectivity with the host. See LLCE firmware user guide for more details.

## 54.10 FIFO interrupts

Each LLCE host interface FIFO generates an event or interrupt on the respective host core. See the interrupt map file attached to this document.

## 54.11 LLCE generic FIFO

The generic FIFO handles all functionalities needed for different FIFO applications inside LLCE. Specific instances are marked with instance name as defined in LLCE block diagram. All FIFO instances have 16 entries.

<!-- image -->

## 54.11.1 Features

- FIFO full, not-full, empty, and not-empty flags
- FIFO flush control
- Consecutive Entry push operation support (back-to-back clock cycle)
- Consecutive Entry pop operation support (back-to-back clock cycle)
- Configuration of PUSH register Fixed MSB pattern
- Configurable watermark cross flag for number of filled entries

- Configurable watermark cross flag for number of empty entries
- POP operation support when automatic POP-on-read is disabled
- FIFO count status
- Control to overwrite last FIFO entry when FIFO is full
- Maskable event/error flags which can be configured to be routed to any of the two interrupt lines

## 54.11.2 Modes of operation

LLCE FIFO supports two operation modes:

- FIFO run mode: FIFO operates with full functionality.
- FIFO disabled mode: FIFO PUSH and POP operations are disabled. Register configurations and flush operation can still work in this mode.

## 54.11.3 LLCE FIFO register descriptions

## 54.11.3.1 LLCE FIFO registers memory map

LLCE\_FIFO\_0 base address: 43A0\_0000h

LLCE\_FIFO\_1 base address: 43A0\_0400h

LLCE\_FIFO\_2 base address: 43A0\_0800h

LLCE\_FIFO\_3 base address: 43A0\_0C00h

LLCE\_FIFO\_4 base address: 43A0\_1000h

LLCE\_FIFO\_5 base address: 43A0\_1400h

LLCE\_FIFO\_6 base address: 43A0\_1800h

LLCE\_FIFO\_7 base address: 43A0\_1C00h

LLCE\_FIFO\_8 base address: 43A0\_2000h

LLCE\_FIFO\_9 base address: 43A0\_2400h

LLCE\_FIFO\_10 base address: 43A0\_2800h

LLCE\_FIFO\_11 base address: 43A0\_2C00h

LLCE\_FIFO\_12 base address: 43A0\_3000h

LLCE\_FIFO\_13 base address: 43A0\_3400h

LLCE\_FIFO\_14 base address: 43A0\_3800h

LLCE\_FIFO\_15 base address: 43A0\_3C00h

LLCE\_FIFO\_16 base address: 43A0\_4000h

LLCE\_FIFO\_17 base address: 43A0\_4400h

LLCE\_FIFO\_18 base address: 43A0\_4800h

LLCE\_FIFO\_19 base address: 43A0\_4C00h

LLCE\_FIFO\_20 base address: 43A0\_5000h

LLCE\_FIFO\_21 base address: 43A0\_8000h

LLCE\_FIFO\_22 base address: 43A0\_8400h

LLCE\_FIFO\_23 base address: 43A0\_8800h

LLCE\_FIFO\_24 base address: 43A0\_8C00h LLCE\_FIFO\_25 base address: 43A0\_9000h LLCE\_FIFO\_26 base address: 43A0\_9400h LLCE\_FIFO\_27 base address: 43A0\_9800h LLCE\_FIFO\_28 base address: 43A0\_9C00h LLCE\_FIFO\_29 base address: 43A0\_A000h LLCE\_FIFO\_30 base address: 43A0\_A400h LLCE\_FIFO\_31 base address: 43A0\_A800h LLCE\_FIFO\_32 base address: 43A0\_AC00h LLCE\_FIFO\_33 base address: 43A0\_B000h LLCE\_FIFO\_34 base address: 43A0\_B400h LLCE\_FIFO\_35 base address: 43A0\_B800h LLCE\_FIFO\_36 base address: 43A0\_BC00h LLCE\_FIFO\_37 base address: 43A0\_C000h LLCE\_FIFO\_38 base address: 43A0\_C400h LLCE\_FIFO\_39 base address: 43A0\_C800h LLCE\_FIFO\_40 base address: 43A0\_CC00h LLCE\_FIFO\_41 base address: 43A0\_D000h LLCE\_FIFO\_42 base address: 43B0\_0000h LLCE\_FIFO\_43 base address: 43B0\_0400h LLCE\_FIFO\_44 base address: 43B0\_0800h LLCE\_FIFO\_45 base address: 43B0\_0C00h LLCE\_FIFO\_46 base address: 43B0\_1000h LLCE\_FIFO\_47 base address: 43B0\_1400h LLCE\_FIFO\_48 base address: 43B0\_1800h LLCE\_FIFO\_49 base address: 43B0\_1C00h LLCE\_FIFO\_50 base address: 43B0\_2000h LLCE\_FIFO\_51 base address: 43B0\_2400h LLCE\_FIFO\_52 base address: 43B0\_2800h LLCE\_FIFO\_53 base address: 43B0\_2C00h LLCE\_FIFO\_54 base address: 43B0\_3000h LLCE\_FIFO\_55 base address: 43B0\_3400h LLCE\_FIFO\_56 base address: 43B0\_3800h LLCE\_FIFO\_57 base address: 43B0\_3C00h LLCE\_FIFO\_58 base address: 43B0\_4000h LLCE\_FIFO\_59 base address: 43B0\_4400h LLCE\_FIFO\_60 base address: 43B0\_4800h LLCE\_FIFO\_61 base address: 43B0\_4C00h

- LLCE\_FIFO\_62 base address: 43B0\_5000h
- LLCE\_FIFO\_63 base address: 43B0\_8000h
- LLCE\_FIFO\_64 base address: 43B0\_8400h
- LLCE\_FIFO\_65 base address: 43B0\_8800h
- LLCE\_FIFO\_66 base address: 43B0\_8C00h
- LLCE\_FIFO\_67 base address: 43B0\_9000h
- LLCE\_FIFO\_68 base address: 43B0\_9400h
- LLCE\_FIFO\_69 base address: 43B0\_9800h
- LLCE\_FIFO\_70 base address: 43B0\_9C00h
- LLCE\_FIFO\_71 base address: 43B0\_A000h
- LLCE\_FIFO\_72 base address: 43B0\_A400h
- LLCE\_FIFO\_73 base address: 43B0\_A800h
- LLCE\_FIFO\_74 base address: 43B0\_AC00h

LLCE\_FIFO\_75 base address: 43B0\_B000h

- LLCE\_FIFO\_76 base address: 43B0\_B400h
- LLCE\_FIFO\_77 base address: 43B0\_B800h
- LLCE\_FIFO\_78 base address: 43B0\_BC00h

LLCE\_FIFO\_79 base address: 43B0\_C000h

LLCE\_FIFO\_80 base address: 43B0\_C400h

- LLCE\_FIFO\_81 base address: 43B0\_C800h
- LLCE\_FIFO\_82 base address: 43B0\_CC00h

LLCE\_FIFO\_83 base address: 43B0\_D000h

- LLCE\_FIFO\_84 base address: 43B1\_0000h
- LLCE\_FIFO\_85 base address: 43B1\_0400h
- LLCE\_FIFO\_86 base address: 43B1\_0800h
- LLCE\_FIFO\_87 base address: 43B1\_0C00h
- LLCE\_FIFO\_88 base address: 43B1\_1000h
- LLCE\_FIFO\_89 base address: 43B1\_1400h
- LLCE\_FIFO\_90 base address: 43B1\_1800h
- LLCE\_FIFO\_91 base address: 43B1\_1C00h
- LLCE\_FIFO\_92 base address: 43B1\_2000h
- LLCE\_FIFO\_93 base address: 43B1\_2400h
- LLCE\_FIFO\_94 base address: 43B1\_2800h
- LLCE\_FIFO\_95 base address: 43B1\_2C00h
- LLCE\_FIFO\_96 base address: 43B1\_3000h
- LLCE\_FIFO\_97 base address: 43B1\_3400h
- LLCE\_FIFO\_98 base address: 43B1\_3800h
- LLCE\_FIFO\_99 base address: 43B1\_3C00h

LLCE\_FIFO\_100 base address: 43B1\_4000h

LLCE\_FIFO\_101 base address: 43B1\_4400h

LLCE\_FIFO\_102 base address: 43B1\_4800h

LLCE\_FIFO\_103 base address: 43B1\_4C00h

LLCE\_FIFO\_104 base address: 43B1\_5000h

| Offset   | Register                    |   Width (In bits) | Access   | Reset value   |
|----------|-----------------------------|-------------------|----------|---------------|
| 0h       | FIFO Configuration (FCR)    |                32 | RW       | 0000_0000h    |
| 4h       | FIFO Status 0 (SR0)         |                32 | W1C      | 0000_0602h    |
| 8h       | FIFO Status 1 (SR1)         |                32 | W1C      | 0000_0002h    |
| Ch       | FIFO Interrupt Enable (IER) |                32 | RW       | 0000_0000h    |
| 10h      | FIFO Interrupt Line (ILR)   |                32 | RW       | 0000_0000h    |
| 14h      | FIFO Push 0 (PUSHR0)        |                32 | RW       | 0000_0000h    |
| 24h      | FIFO Pop 0 (POPR0)          |                32 | RO       | FFFF_FFFFh    |
| 34h      | FIFO Fixed MSB (FMR0)       |                32 | RW       | 0000_0000h    |

## 54.11.3.2 FIFO Configuration (FCR)

## Offset

| Register   | Offset   |
|------------|----------|
| FCR        | 0h       |

## Function

Controls module-level features.

## Diagram

<!-- image -->

Low Latency Communication Engine (LLCE)

## Fields

| Field          | Function                                                                                                                                                                                                                                                        |
|----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -        | Reserved                                                                                                                                                                                                                                                        |
| 27-24 WMKEMTYL | Watermark Empty Level Contains the number of entries for the FIFO_SR[WMKEMTY] decision. This helps in bulk transfer during write operation.                                                                                                                     |
| 23-20 -        | Reserved                                                                                                                                                                                                                                                        |
| 19-16 WMKFULLL | Watermark Full Level Contains the number of entries for the FIFO_SR[WMKFULL] decision. This watermark helps in bulk transfer during read operation.                                                                                                             |
| 15-6 -         | Reserved                                                                                                                                                                                                                                                        |
| 5 RD_POP_DIS   | Read When Pop Disabled Pops an entry and updates the FIFO pointers and status. This happens if FIFO_FCR[POPEN] is 0 and FIFO_FCR[FIFOEN] is 1. 0b - No operation 1b - Pop operation                                                                             |
| 4 FFLUSH       | FIFO Flush Flushes the FIFO memory content. It does not clear any set W1C status flag. 0b - No operation 1b - FIFO flush                                                                                                                                        |
| 3 PUSHEN       | Push Enable If enabled, any write to FIFO Push 0 (PUSHR0) is considered a FIFO Push operation and the FIFO pointers and status are updated. If disabled, FIFO logic is unaffected and only the register write takes place. 0b - Push disabled 1b - Push enabled |
| 2 POPEN        | Pop Enable If enabled, any read from FIFO Pop 0 (POPR0) is considered a FIFO Pop operation and the FIFO pointers and status are updated. If disabled, FIFO logic is unaffected and only the register read takes place. 0b - Pop disabled                        |

Table continues on the next page...

Table continued from the previous page...

| Field     | Function                                                                                                                                                                                              |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 LENOWEN | Last Entry Overwrite Enable If enabled, the last FIFO entry can be overwritten when the FIFO is full. If disabled, overwrite is not allowed. 0b - Overwrite disabled 1b - Overwrite enabled           |
| 0 FIFOEN  | FIFO Enable Controls the FIFO Push and Pop operations. Register configurations and flush operation can occur for both enabled and disabled values of this field. 0b - FIFO disabled 1b - FIFO enabled |

## 54.11.3.3 FIFO Status 0 (SR0)

## Offset

| Register   | Offset   |
|------------|----------|
| SR0        | 4h       |

## Function

Contains various fields used in LLCE FIFO operations. The W1C fields of this register are accessible or reserved based on the programming of corresponding fields in FIFO Interrupt Line (ILR). When the corresponding field in FIFO Interrupt Line (ILR) is 0, then the field is accessible to the user for W1C and read operations. When the corresponding field in FIFO Interrupt Line (ILR) is 1, then the field is reserved to the user. The RO fields of this register show the dynamic status of the FIFO independent of FIFO Interrupt Line (ILR) programming.

## Diagram

<!-- image -->

| Bits   | 31      | 30       | 29       | 28      | 27      | 26     | 25      | 24     | 23   | 22   | 21   | 20   | 19   | 18   | 17       | 16       |
|--------|---------|----------|----------|---------|---------|--------|---------|--------|------|------|------|------|------|------|----------|----------|
| R      | 0       | 0        | 0        | FCOUNT  | FCOUNT  | FCOUNT | FCOUNT  | FCOUNT | 0    | 0    | 0    | 0    | 0    | 0    | MSBN OMT | PUSH OVR |
| W      |         |          |          |         |         |        |         |        |      |      |      |      |      |      | W1C      | W1C      |
| Reset  | 0       | 0        | 0        | 0       | 0       | 0      | 0       | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0        | 0        |
| Bits   | 15      | 14       | 13       | 12      | 11      | 10     | 9       | 8      | 7    | 6    | 5    | 4    | 3    | 2    | 1        | 0        |
| R      | POPU ND | WMKE MTY | WMKF ULL | POPE VT | FNEM TY | FEMT Y | FNFUL L | FFULL  | 0    | 0    | 0    | 0    | 0    | 0    | FEMT YD  | FFULL D  |
| W      | W1C     | W1C      | W1C      | W1C     | W1C     | W1C    | W1C     | W1C    |      |      |      |      |      |      |          |          |
| Reset  | 0       | 0        | 0        | 0       | 0       | 1      | 1       | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 1        | 0        |

## Fields

| Field        | Function                                                                                                                                                                                                                                          |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-29 -      | Reserved                                                                                                                                                                                                                                          |
| 28-24 FCOUNT | FIFO Count Indicates the dynamic count of the entries present inside the FIFO.                                                                                                                                                                    |
| 23-18 -      | Reserved                                                                                                                                                                                                                                          |
| 17 MSBNOMT   | MSB Not Matching Flag This flag is set when the MSB bit pattern of FIFO Push 0 (PUSHR0) does not match the MSB bit pattern programmed inside FIFO Fixed MSB (FMR0). This flag is cleared when you write 1 to it. 0b - MSB match 1b - MSB mismatch |
| 16 PUSHOVR   | Push Overflow Flag This flag is set when a write access is made to FIFO Push 0 (PUSHR0) when the FIFO is full. This flag is cleared when you write 1 to it. 0b - No Push overflow 1b - Push overflow                                              |
| 15 POPUND    | Pop Underflow Flag This flag is set when a read access is made to FIFO Pop 0 (POPR0) when the FIFO is empty. This flag is cleared when you write 1 to it. 0b - No Pop underflow 1b - Pop underflow                                                |
| 14 WMKEMTY   | Watermark Empty Flag This flag is set when FIFO_SR0[FCOUNT] goes lower than FIFO_FCR[WMKEMTYL]. This flag is cleared when you write 1 to it. 0b - No watermark empty event 1b - Watermark empty event                                             |
| 13 WMKFULL   | Watermark Full Flag This flag is set when FIFO_SR0[FCOUNT] goes higher than FIFO_FCR[WMKFULLL]. This flag is cleared when you write 1 to it. 0b - No watermark full event 1b - Watermark full event                                               |
| 12           | Pop Event Flag                                                                                                                                                                                                                                    |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                    |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| POPEVT    | Contains the Pop event status whenever a Pop access is made to FIFO Pop 0 (POPR0). The flag is cleared when you write 1 to it. 0b - No Pop event 1b - Pop event                                                                                                                                             |
| 11 FNEMTY | FIFO Not Empty Flag Contains the not empty status of the FIFO when the condition occurs in the hardware. The flag is cleared when you write 1 to it. If the hardware condition that sets this flag persists when a W1C operation is happening, the flag is not cleared. 0b - FIFO empty 1b - FIFO not empty |
| 10 FEMTY  | FIFO Empty Contains the empty status of the FIFO when the condition occurs in the hardware. The flag is cleared when you write 1 to it. If the hardware condition that sets this flag persists when a W1C operation is happening, the flag is not cleared. 0b - FIFO not empty 1b - FIFO empty              |
| 9 FNFULL  | FIFO Not Full Flag Contains the not full status of the FIFO when the condition occurs in the hardware. The flag is cleared when you write 1 to it. If the hardware condition that sets this flag persists when a W1C operation is happening, the flag is not cleared. 0b - FIFO full 1b - FIFO not full     |
| 8 FFULL   | FIFO Full Flag Contains the full status of the FIFO when the condition occurs in the hardware. The flag is cleared when you write 1 to it. If the hardware condition that sets this flag persists when a W1C operation is happening, the flag is not cleared. 0b - FIFO not full 1b - FIFO full             |
| 7-2 -     | Reserved                                                                                                                                                                                                                                                                                                    |
| 1 FEMTYD  | FIFO Empty Dynamic Indicates the dynamic empty status of the FIFO. 0b - FIFO not empty 1b - FIFO empty                                                                                                                                                                                                      |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                         |
|---------|----------------------------------------------------------------------------------|
| 0       | FIFO Full Dynamic                                                                |
| FFULLD  | Indicates the dynamic full status of the FIFO. 0b - FIFO not full 1b - FIFO full |

## 54.11.3.4 FIFO Status 1 (SR1)

## Offset

| Register   | Offset   |
|------------|----------|
| SR1        | 8h       |

## Function

Contains various fields used in LLCE FIFO operations. The W1C fields of this register are accessible or reserved based on the programming of corresponding fields in FIFO Interrupt Line (ILR). When the corresponding field in FIFO Interrupt Line (ILR) is 1, then the field is accessible to the user for W1C operation. When the corresponding field in FIFO Interrupt Line (ILR) is 0, then the field is reserved to the user. The RO fields of this register show the dynamic status of the FIFO independent of FIFO Interrupt Line (ILR) programming.

## Diagram

<!-- image -->

| Bits   | 31      | 30       | 29       | 28      | 27      | 26     | 25      | 24     | 23   | 22   | 21   | 20   | 19   | 18   | 17       | 16       |
|--------|---------|----------|----------|---------|---------|--------|---------|--------|------|------|------|------|------|------|----------|----------|
| R      | 0       | 0        | 0        | FCOUNT  | FCOUNT  | FCOUNT | FCOUNT  | FCOUNT | 0    | 0    | 0    | 0    | 0    | 0    | MSBN OMT | PUSH OVR |
| W      |         |          |          |         |         |        |         |        |      |      |      |      |      |      | W1C      | W1C      |
| Reset  | 0       | 0        | 0        | 0       | 0       | 0      | 0       | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0        | 0        |
| Bits   | 15      | 14       | 13       | 12      | 11      | 10     | 9       | 8      | 7    | 6    | 5    | 4    | 3    | 2    | 1        | 0        |
| R      | POPU ND | WMKE MTY | WMKF ULL | POPE VT | FNEM TY | FEMT Y | FNFUL L | FFULL  | 0    | 0    | 0    | 0    | 0    | 0    | FEMT YD  | FFULL D  |
| W      | W1C     | W1C      | W1C      | W1C     | W1C     | W1C    | W1C     | W1C    |      |      |      |      |      |      |          |          |
| Reset  | 0       | 0        | 0        | 0       | 0       | 0      | 0       | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 1        | 0        |

## Fields

| Field   | Function   |
|---------|------------|
| 31-29   | Reserved   |
| 28-24   | FIFO Count |

Table continues on the next page...

## Table continued from the previous page...

| Field      | Function                                                                                                                                                                                                                                          |
|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| FCOUNT     | Indicates the dynamic count of the entries present inside the FIFO.                                                                                                                                                                               |
| 23-18 -    | Reserved                                                                                                                                                                                                                                          |
| 17 MSBNOMT | MSB Not Matching Flag This flag is set when the MSB bit pattern of FIFO Push 0 (PUSHR0) does not match the MSB bit pattern programmed inside FIFO Fixed MSB (FMR0). This flag is cleared when you write 1 to it. 0b - MSB match 1b - MSB mismatch |
| 16 PUSHOVR | Push Overflow Flag This flag is set when a write access is made to FIFO Push 0 (PUSHR0) when the FIFO is full. This flag is cleared when you write 1 to it. 0b - No Push overflow 1b - Push overflow                                              |
| 15 POPUND  | Pop Underflow Flag This flag is set when a read access is made to FIFO Pop 0 (POPR0) when the FIFO is empty. This flag is cleared when you write 1 to it. 0b - No Pop underflow 1b - Pop underflow                                                |
| 14 WMKEMTY | Watermark Empty Flag This flag is set when FIFO_SR1[FCOUNT] goes lower than FIFO_FCR[WMKEMTYL]. This flag is cleared when you write 1 to it. 0b - No watermark empty event 1b - Watermark empty event                                             |
| 13 WMKFULL | Watermark Full Flag This flag is set when FIFO_SR1[FCOUNT] goes higher than FIFO_FCR[WMKFULLL]. This flag is cleared when you write 1 to it. 0b - No watermark full event 1b - Watermark full event                                               |
| 12 POPEVT  | Pop Event Flag Stores the Pop event status whenever a Pop access is made to FIFO Pop 0 (POPR0). This flag is cleared when you write 1 to it. 0b - No Pop event 1b - Pop event                                                                     |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                  |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 11 FNEMTY | FIFO Not Empty Flag Stores the not empty status of the FIFO when the condition occurs in the hardware. The flag is cleared when you write 1 to it. If the hardware condition that sets this flag persists when a W1C operation is happening, the flag is not cleared. 0b - FIFO empty 1b - FIFO not empty |
| 10 FEMTY  | FIFO Empty Flag Stores the empty status of the FIFO when the condition occurs in the hardware. The flag is cleared when you write 1 to it. If the hardware condition that sets this flag persists when a W1C operation is happening, the flag is not cleared. 0b - FIFO not empty 1b - FIFO empty         |
| 9 FNFULL  | FIFO Not Full Flag Stores the not full status of the FIFO when the condition occurs in the hardware. The flag is cleared when you write 1 to it. If the hardware condition that sets this flag persists when a W1C operation is happening, the flag is not cleared. 0b - FIFO full 1b - FIFO not full     |
| 8 FFULL   | FIFO Full Flag Stores the full status of the FIFO when the condition occurs in the hardware. The flag is cleared when you write 1 to it. If the hardware condition that sets this flag persists when a W1C operation is happening, the flag is not cleared. 0b - FIFO not full 1b - FIFO full             |
| 7-2 -     | Reserved                                                                                                                                                                                                                                                                                                  |
| 1 FEMTYD  | FIFO Not Empty Dynamic Indicates the dynamic empty status of the FIFO. 0b - FIFO not empty 1b - FIFO empty                                                                                                                                                                                                |
| 0 FFULLD  | FIFO Full Dynamic Indicates the dynamic full status of the FIFO. 0b - FIFO not full 1b - FIFO full                                                                                                                                                                                                        |

## 54.11.3.5 FIFO Interrupt Enable (IER)

## Offset

| Register   | Offset   |
|------------|----------|
| IER        | Ch       |

## Function

Enables and disables the propagation of the corresponding flags in FIFO Status 0 (SR0) and FIFO Status 1 (SR1) to the interrupt line.

## Diagram

<!-- image -->

## Fields

| Field         | Function                                                                                                                                                      |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-18 -       | Reserved                                                                                                                                                      |
| 17 MSBNOMT_IE | MSB Not Matching Interrupt Enable Enables or disables MSB not matching flag propagation to the interrupt line. 0b - Interrupt disabled 1b - Interrupt enabled |
| 16 PUSHOVR_IE | Push Overflow Interrupt Enable Enables or disables Push overflow flag propagation to the interrupt line. 0b - Interrupt disabled 1b - Interrupt enabled       |
| 15 POPUND_IE  | Pop Underflow Interrupt Enable Enables or disables Pop underflow flag propagation to the interrupt line.                                                      |

Table continues on the next page...

## Table continued from the previous page...

| Field        | Function                                                                                                                                                  |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
| 14 WMKEM_IE  | Watermark Empty Interrupt Enable Enables or disables Watermark empty flag propagation to the interrupt line. 0b - Interrupt disabled                      |
| 13 WMKFL_IE  | Watermark Full Interrupt Enable Enables or disables Watermark full flag propagation to the interrupt line. 0b - Interrupt disabled 1b - Interrupt enabled |
| 12 POPEVT_IE | Pop Event Interrupt Enable Enables or disables Pop event flag propagation to the interrupt line. 0b - Interrupt disabled 1b - Interrupt enabled           |
| 11 FNEMTY_IE | FIFO Not Empty Interrupt Enable Enables or disables FIFO not empty flag propagation to the interrupt line. 0b - Interrupt disabled 1b - Interrupt enabled |
| 10 FEMTY_IE  | FIFO Empty Interrupt Enable Enables or disables FIFO empty flag propagation to the interrupt line. 0b - Interrupt disabled 1b - Interrupt enabled         |
| 9 FNFULL_IE  | FIFO Not Full Interrupt Enable Enables or disables FIFO not full flag propagation to the interrupt line. 0b - Interrupt disabled 1b - Interrupt enabled   |
| 8 FFULL_IE   | FIFO Full Interrupt Enable Enables or disables FIFO full flag propagation to the interrupt line. 0b - Interrupt disabled 1b - Interrupt enabled           |
| 7-0          | Reserved                                                                                                                                                  |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function   |
|---------|------------|
| -       |            |

## 54.11.3.6 FIFO Interrupt Line (ILR)

## Offset

| Register   | Offset   |
|------------|----------|
| ILR        | 10h      |

## Function

Selects which interrupt line, A or B, the individual flag is routed to.

## Diagram

<!-- image -->

| Bits   | 31     | 30   | 29   | 28     | 27     | 26   | 25    | 24    | 23   | 22   | 21   | 20   | 19   | 18   | 17     | 16     |
|--------|--------|------|------|--------|--------|------|-------|-------|------|------|------|------|------|------|--------|--------|
| R      | 0      | 0    | 0    | 0      | 0      | 0    | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | MSBN   | PUSH   |
| W      |        |      |      |        |        |      |       |       |      |      |      |      |      |      | OMT... | OVR... |
| Reset  | 0      | 0    | 0    | 0      | 0      | 0    | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0      |
| Bits   | 15     | 14   | 13   | 12     | 11     | 10   | 9     | 8     | 7    | 6    | 5    | 4    | 3    | 2    | 1      | 0      |
| R      | POPU   | WMKE | WMKF | POPE   | FNEM   | FEMT | FNFUL | FFULL | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0      |
| W      | ND_... | M_IL | L_IL | VT_... | TY_... | Y_IL | L_... | _IL   |      |      |      |      |      |      |        |        |
| Reset  | 0      | 0    | 0    | 0      | 0      | 0    | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0      |

## Fields

| Field         | Function                                                                                                                                                            |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-18 -       | Reserved                                                                                                                                                            |
| 17 MSBNOMT_IL | MSB Not Matching Interrupt Line Selects the interrupt line for the MSB not matching flag. 0b - Flag routed to interrupt line A 1b - Flag routed to interrupt line B |
| 16 PUSHOVR_IL | Push Overflow Interrupt Line Selects the interrupt line for the Push overflow flag. 0b - Flag routed to interrupt line A                                            |

Table continues on the next page...

## Table continued from the previous page...

| Field        | Function                                                                                                                                                          |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 POPUND_IL | Pop Underflow Interrupt Line Selects the interrupt line for the Pop underflow flag. 0b - Flag routed to interrupt line A 1b - Flag routed to interrupt line B     |
| 14 WMKEM_IL  | Watermark Empty Interrupt Line Selects the interrupt line for the watermark empty flag. 0b - Flag routed to interrupt line A 1b - Flag routed to interrupt line B |
| 13 WMKFL_IL  | Watermark Full Interrupt Line Selects the interrupt line for the watermark full flag. 0b - Flag routed to interrupt line A 1b - Flag routed to interrupt line B   |
| 12 POPEVT_IL | Pop Event Interrupt Line Selects the interrupt line for the Pop event flag. 0b - Flag routed to interrupt line A 1b - Flag routed to interrupt line B             |
| 11 FNEMTY_IL | FIFO Not Empty Interrupt Line Selects the interrupt line for the FIFO not empty flag. 0b - Flag routed to interrupt line A 1b - Flag routed to interrupt line B   |
| 10 FEMTY_IL  | FIFO Empty Interrupt Line Selects the interrupt line for the FIFO empty flag. 0b - Flag routed to interrupt line A 1b - Flag routed to interrupt line B           |
| 9 FNFULL_IL  | FIFO Not Full Interrupt Line Selects the interrupt line for the FIFO not full flag. 0b - Flag routed to interrupt line A 1b - Flag routed to interrupt line B     |
| 8 FFULL_IL   | FIFO Full Interrupt Line Selects the interrupt line for the FIFO full flag.                                                                                       |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                  |
|---------|---------------------------------------------------------------------------|
|         | 0b - Flag routed to interrupt line A 1b - Flag routed to interrupt line B |
| 7-0     | Reserved                                                                  |

## 54.11.3.7 FIFO Push 0 (PUSHR0)

## Offset

| Register   | Offset   |
|------------|----------|
| PUSHR0     | 14h      |

## Function

Contains word entry to be pushed inside the FIFO.

## Diagram

<!-- image -->

## Fields

| Field    | Function                                                                 |
|----------|--------------------------------------------------------------------------|
| 31-0     | Entry Push                                                               |
| ENTRPUSH | The word entry which must be added to the FIFO is written to this field. |

## 54.11.3.8 FIFO Pop 0 (POPR0)

## Offset

| Register   | Offset   |
|------------|----------|
| POPR0      | 24h      |

## Function

Read the FIFO word from this register.

## Diagram

<!-- image -->

| Bits    | 31      | 30      | 29      | 28      | 27      | 26      | 25      | 24      | 23      | 22      | 21      | 20      | 19      | 18      | 17      | 16      |
|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|
| R       | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP |
| W       |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |
| Reset 1 |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |
|         | 1       | 1       | 1 1     | 1       | 1       |         | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1       |
| Bits    | 15      | 14      | 13 12   | 11      |         | 10      | 9       | 8       | 7       | 6       | 5       | 4       | 3       | 2       | 1       | 0       |
| R       | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP | ENTRPOP |
| W       |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |
| Reset   | 1       | 1       | 1 1     | 1       |         | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1       |

## Fields

| Field   | Function                                               |
|---------|--------------------------------------------------------|
| 31-0    | Entry Pop                                              |
| ENTRPOP | The FIFO word to be popped is read from this register. |

## 54.11.3.9 FIFO Fixed MSB (FMR0)

## Offset

| Register   | Offset   |
|------------|----------|
| FMR0       | 34h      |

## Function

Holds the fixed MSB bit pattern to be compared against the same number of MSBs of PUSHR0, which is FIFO\_PUSHR0[ENTRPUSH]. Specifically, these are bits [31:(32-MSB)], and MSB is 13. If the two bit patterns are not the same, the MSBNOMT flag is set in the SRn register (where n is 0 or 1 depending on the value of ILR[MSBNOMT\_IL]) and LLCE considers the MSB bit pattern of this register to be correct.

Low Latency Communication Engine (LLCE)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
|--------|------|------|------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|
| R      | 0    | 0    | 0    | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| W      |      |      |      |          |          |          |          |          |          |          |          |          |          |          |          |          |
| Reset  | 0    | 0    | 0    | 0 0      |          | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| Bits   | 15   | 14   | 13   | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R      | 0    | 0    | 0    |          |          |          |          |          |          |          |          |          |          |          |          |          |
| W      |      |      |      | ENTRFMSB | ENTRFMSB | ENTRFMSB | ENTRFMSB | ENTRFMSB | ENTRFMSB | ENTRFMSB | ENTRFMSB | ENTRFMSB | ENTRFMSB | ENTRFMSB | ENTRFMSB | ENTRFMSB |
| Reset  | 0    | 0    | 0    | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |

## Fields

| Field         | Function                                                                                                                                                                                                                             |
|---------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-13 -       | Reserved                                                                                                                                                                                                                             |
| 12-0 ENTRFMSB | Entry Fixed MSB Contains the fixed MSB pattern to be compared against the PUSHR MSB bit pattern. To change this value without corrupting the pointer value, you must first flush the FIFO to ensure that no entry is populated. NOTE |

## 54.11.4 Functional description

The following sections describe the functional details of the LLCE FIFO module.

## 54.11.4.1 Basic push operation

Once the FIFO module has been initialized (See Programming Guidelines section), and automatic PUSH on write operation has been enabled (FIFO\_FCR[PUSHEN] = 1), write into FIFO\_PUSHR0 to add the entry to the FIFO memory by polling FIFO not full flag or using the interrupt indication of this flag. Once the PUSH register has been written, the FIFO write pointer increments to point to next location and module status is updated in the status register.

## 54.11.4.2 Mulit-word push operation

Generic FIFO supports multi-word support to write and read multiple words to and from the FIFO. When multi-word PUSH is being used, always write into PUSH register 0 at the end, after writing into PUSH register of higher index. Otherwise, incomplete data will be loaded into the memory. Once all the writes are complete, one PUSH operation is completed, the write pointer points to the next FIFO location and module status is updated in the status register.

## 54.11.4.3 Basic pop operation

Once the FIFO module has been initialized (See Programming Guidelines Section), and automatic POP on read operation has been enabled (FIFO\_FCR[POPEN]=1), read FIFO\_POPR0 to read an entry from FIFO memory by polling FIFO not empty flag or using the interrupt indication of this flag. Once the POP register has been read, the FIFO read pointer increments to point to next location and module status is updated in the status register.

Low Latency Communication Engine (LLCE)

## 54.11.4.4 Multi-word pop operation

When multi-word POP is being used, always read POP register 0 at the end, after reading POP register of higher index. Otherwise, incorrect data will be read from the FIFO. Once all the reads are complete, one POP operation is completed, the FIFO read pointer increments to point to next location and module status is updated in the status register.

## 54.11.4.5 Pop operation when FIFO\_FCR[POPEN] is 0

There can be use cases when FIFO\_FCR[POPEN] is reset to 0 so that a read access on FIFO\_POPR does not result in an automatic POP operation. A POP access can still be made by writing to FIFO\_FCR[RD\_POP\_DIS]. This is a write-only-1 bit and any write into this bit when FIFO\_FCR[POPEN] = 0 qualifies a POP operation which results in an update of the FIFO status and POP register content. This operation will only work when FIFO\_FCR[FIFOEN] = 1.

## 54.11.4.6 FIFO flush

The FIFO entries can be flushed at any time by writing 1 to FIFO\_FCR[FLUSH] to completely empty the FIFO.

## NOTE

W1C status flags which are set to 1 are not cleared by FIFO flush operation. They should be cleared by writing 1.

## 54.11.4.7 FIFO watermark operation

Generic FIFO has separate watermark indicators when the entry count is nearing full and empty levels. The application can configure the watermark levels for both the cases and use the corresponding status flags WMKFULL and WMKEMTY for bulk data transfer.

## Example 1

FIFO DEPTH=16

FIFO\_FCR[WMKFULLL] = 11

FIFO\_SR[WMKFULL] flag is set when FIFO\_SR[FCOUNT] goes higher than 11. This flag indicates that at least 12 entries are present inside the FIFO to be read. This can help in bulk read transfer.

## Example 2

FIFO DEPTH=16

FIFO\_FCR[WMKEMTYL] = 5

FIFO\_SR[WMKEMTY] flag is set when FIFO\_SR[FCOUNT] goes lower than five. This flag indicates that at least 12 (DEPTH-FIFO\_FCR[WMKEMTYL] + 1) entries are vacant inside the FIFO to be written. This can help in bulk write transfer.

## 54.11.4.8 Last FIFO entry overwrite operation

FIFO\_FCR[LENOWEN] when set to 1 allows an entry to be added to the FIFO when it is full, overwriting the last written FIFO entry with this new incoming entry. The PUSH overflow flag, which indicates a FIFO PUSH when FIFO is full, will be set in the status register even when FIFO\_FCR[LENOWEN] = 1.

Low Latency Communication Engine (LLCE)

## 54.11.4.9 Error scenarios

| Scenario                  | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PUSH overflow             | PUSH overflow error occurs when FIFO_PUSHR0 is written when FIFO is full as indicated by FIFO full flag of status register or FIFO full dynamic bit of status register. PUSH overflow flag is set to 1 in status register when this error condition occurs.                                                                                                                                                                                                                                     |
| POP underflow             | POP underflow error occurs when FIFO_POPR0 is read when FIFO is empty as indicated by FIFO empty flag of status register or FIFO empty dynamic bit of status register. POP underflow flag is set to 1 in status register when this error condition occurs.                                                                                                                                                                                                                                      |
| PUSH MSB pattern mismatch | The entry pushed into FIFO_PUSHRn can have a fixed MSB pattern. This is true when memory pointers are stored inside the FIFO and not all 32 bits are used to address the memory. The FIFO hardware compares the MSB pattern of every incoming entry against a fixed MSB pattern configured in FIFO_FMRn register. In case the two patterns don't match, MSBNOMT flag is set to 1 in the status register and the MSB pattern of FIFO_FMRn is appended to entries which are read from FIFO_POPRn. |

## 54.11.4.10 FIFO performance

Generic FIFO supports writes into the PUSH register in consecutive clock cycles. Similarly, entries can be read from the POP register in consecutive clock cycles when there are valid entries available.

## 54.11.5 Interrupts

The generic FIFO has two interrupt outputs, A and B. The status flags inside the status register can be programmed to be routed to either of the two interrupt lines. A value 0 in a bit of FIFO\_ILR will route the corresponding flag to interrupt line A. A value 1 in a bit of FIFO\_ILR will route the corresponding flag to interrupt line B.

There are two status registers implemented for software to access flags corresponding to each interrupt line with minimum latency. Core receiving interrupt A should access Status register 0 to read/clear status flags which are driving interrupt A. Flags driving interrupt A will be accessible only in FIFO\_SR0 and the corresponding flag in FIFO\_SR1 will read 0. Core receiving interrupt B should access Status register 1 to read/clear status flags which are driving interrupt B. Flags driving interrupt B will be accessible only in FIFO\_SR1 and will read 0 in FIFO\_SR0.

Interrupt line selection can be modified, dynamically, in run mode by configuring FIFO\_ILR bits.

## Example

When FIFO\_ILR[POP\_EVT] = 1 and FIFO\_IER[POP\_EVT] = 1, an active POP event flag is routed to interrupt line B. The core receiving interrupt B should always access FIFO\_SR1 to read and clear the status of the FIFO\_SR1[POP\_EVT]. FIFO\_SR0[POP\_EVT] will read 0 even if the event has occurred because FIFO\_ILR[POP\_EVT] = 1.

<!-- image -->

Low Latency Communication Engine (LLCE)

## 54.11.6 Programming

- General guidelines
1. To write into a vacant entry of the FIFO, use FIFO not full flag of the status register.
2. To read a valid entry from the FIFO, use FIFO not empty flag of the status register.
3. For bulk entry transfers, use watermark full and watermark empty flags of the status register See FIFO watermark operation.
- Initialization
1. Select the interrupt line of each flag of FIFO\_SR0/FIFO\_SR1 register by writing into corresponding bits of FIFO\_ILR register
2. Enable the required interrupts by setting bits in the FIFO\_IER register.
3. Configure Fixed MSB pattern of FIFO\_PUSHR inside FIFO\_FMR register. This configuration can be changed only after flushing the FIFO.
4. Configure the FIFO\_FCR register:
- Automatic Push operation: write 1 to FIFO\_FCR[PUSHEN] (must be done for FIFO operation).
- Automatic POP operation: write 1 to FIFO\_FCR[POPEN].
- FIFO watermark levels FIFO\_FCR[WMKFULLL] and FIFO\_FCR[WMKEMTYL]
- Overwrite last entry in case of full: write 1 to FIFO\_FCR[LENOWEN].
5. Select FIFO run mode: write 1 to FIFO\_FCR[FIFOEN].
- FIFO RUN mode
1. PUSH operation: Write into FIFO\_PUSHR0 to add an entry to the FIFO.
2. POP operation: Read from FIFO\_POPR0 to read an entry from the FIFO.
3. FIFO Flush: The FIFO can be flushed by writing 1 to FIFO\_FCR[FFLUSH] to empty the contents of the FIFO. The flush operation does not clear w1c status flags in SR0/SR1. The status flags still should be cleared by writing 1 into them.
4. To qualify a POP operation when FIFO\_FCR[POPEN] is 0, write 1 to FIFO\_FCR[RD\_POP\_DIS].
5. Configuration change: The configurations done during initialization can be modified during RUN mode and the change will take effect in the next clock cycle.
6. Select FIFO disabled mode: write 0 to FIFO\_FCR[FIFOEN] to freeze the FIFO. FIFO PUSH and POP operations are disabled. Register configurations and flush operation can still work in this mode.

## 54.12 Core-to-Core module

Core to core communication module provides LLCE cores and HOST core the capability to indicate system events among themselves via flags and associated mask-able interrupts. Exclusive registers are provided for each core for flag bits and interrupt masking. A flag bit for a receiving core can be set by a transmitting core to indicate an event to it. Once set, the flag can be cleared by the receiving core only.

Low Latency Communication Engine (LLCE)

## 54.12.1 Block diagram

<!-- image -->

## 54.12.2 Features

- Support of event communication between four LLCE cores and one host

- Interrupt to host from LLCE cores
- Support of 16 flags with masks from each LLCE core
- One interrupt line from each LLCE core (16 flags OR-ed after mask)
- Interrupt to LLCE cores from host
- Support of 16 flags with masks from Host to each LLCE core
- One interrupt line for each LLCE core (16 flags OR-ed after mask)

## 54.12.3 Core-to-core register descriptions

The host is the core accessing through the host AHB port of LLCE.

## 54.12.3.1 Core\_to\_core memory map

LLCE\_Core\_to\_core base address: 43C2\_6000h

| Offset   | Register                                              |   Width (In bits) | Access   | Reset value   |
|----------|-------------------------------------------------------|-------------------|----------|---------------|
| 0h       | HOST interrupt from Core 0 Register (HINTC0R)         |                32 | RW       | 0000_0000h    |
| 4h       | HOST Interrupt from Core 1 Register (HINTC1R)         |                32 | RW       | 0000_0000h    |
| 8h       | HOST Interrupt from Core 2 Register (HINTC2R)         |                32 | RW       | 0000_0000h    |
| Ch       | HOST Interrupt from Core 3 Register (HINTC3R)         |                32 | RW       | 0000_0000h    |
| 20h      | Core 0 Interrupt from HOST (C0INTHR)                  |                32 | RW       | 0000_0000h    |
| 24h      | Core 1 Interrupt From HOST Register (C1INTHR)         |                32 | RW       | 0000_0000h    |
| 28h      | Core 2 Interrupt from HOST Register (C2INTHR)         |                32 | RW       | 0000_0000h    |
| 2Ch      | Core 3 Interrupt from HOST Register (C3INTHR)         |                32 | RW       | 0000_0000h    |
| 60h      | HOST Interrupt from Core 0 Enable Register (HINTC0ER) |                32 | RW       | 0000_0000h    |
| 64h      | HOST Interrupt from Core 1 Enable Register (HINTC1ER) |                32 | RW       | 0000_0000h    |
| 68h      | HOST Interrupt from Core 2 Enable Register (HINTC2ER) |                32 | RW       | 0000_0000h    |
| 6Ch      | HOST Interrupt from Core 3 Enable Register (HINTC3ER) |                32 | RW       | 0000_0000h    |

## 54.12.3.2 HOST interrupt from Core 0 Register (HINTC0R)

## Offset

| Register   | Offset   |
|------------|----------|
| HINTC0R    | 0h       |

## Function

This register controls the event indication to HOST from Core 0. 16 flags can be set by Core 0 to indicate 16 separate events. All flags combine to generate a single interrupt to HOST. A flag once set, can be cleared only by HOST with w1c operation. All cores and HOST have read access to this register. Only HOST and Core 0 have write access to this register. ACCESS GUIDELINE- HOST: Write 1 to clear flag. Core 0: Write 1 to set flag.

Low Latency Communication Engine (LLCE)

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28    | 27    | 26    | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|-------|-------|-------|-------|-------|-------|------|------|------|------|------|------|------|------|------|------|
| R      | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |       |       |       |       |       |       |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15    | 14    | 13    | 12    | 11    | 10    | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    | FLG15 | FLG14 | FLG13 | FLG12 | FLG11 | FLG10 | FLG9 | FLG8 | FLG7 | FLG6 | FLG5 | FLG4 | FLG3 | FLG2 | FLG1 | FLG0 |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field    | Function                                                                                                                                       |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -  | Reserved                                                                                                                                       |
| 15 FLG15 | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 14 FLG14 | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 13 FLG13 | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 12 FLG12 | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 11 FLG11 | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 10 FLG10 | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation.                          |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

## Table continued from the previous page...

| Field   | Function                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------|
|         | 0b - No Event 1b - Event                                                                                                                       |
| 9 FLG9  | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 8 FLG8  | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 7 FLG7  | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 6 FLG6  | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 5 FLG5  | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 4 FLG4  | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 3 FLG3  | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 2       | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation.                          |
| FLG2    | 0b - No Event                                                                                                                                  |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 FLG1  | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 0 FLG0  | This flag is set by Core 0 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |

## 54.12.3.3 HOST Interrupt from Core 1 Register (HINTC1R)

## Offset

| Register   | Offset   |
|------------|----------|
| HINTC1R    | 4h       |

## Function

This register controls the event indication to HOST from Core 1. 16 flags can be set by Core 1 to indicate 16 separate events. All flags combine to generate a single interrupt to HOST. A flag once set, can be cleared only by HOST with w1c operation. All cores and HOST have read access to this register. Only HOST and Core 1 have write access to this register. ACCESS GUIDELINE- HOST: Write 1 to clear flag. Core 1: Write 1 to set flag.

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-16   | Reserved   |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                       |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------|
| -        |                                                                                                                                                |
| 15 FLG15 | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 14 FLG14 | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 13 FLG13 | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 12 FLG12 | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 11 FLG11 | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 10 FLG10 | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 9 FLG9   | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 8 FLG8   | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 7        | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation.                          |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------|
| FLG7    | 0b - No Event 1b - Event                                                                                                                       |
| 6 FLG6  | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 5 FLG5  | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 4 FLG4  | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 3 FLG3  | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 2 FLG2  | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 1 FLG1  | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 0 FLG0  | This flag is set by Core 1 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |

## 54.12.3.4 HOST Interrupt from Core 2 Register (HINTC2R)

## Offset

| Register   | Offset   |
|------------|----------|
| HINTC2R    | 8h       |

## Function

This register controls the event indication to HOST from Core 2. 16 flags can be set by Core 2 to indicate 16 separate events. All flags combine to generate a single interrupt to HOST. A flag once set, can be cleared only by HOST with w1c operation. All cores and HOST have read access to this register. Only HOST and Core 2 have write access to this register. ACCESS GUIDELINE- HOST: Write 1 to clear flag. Core 2: Write 1 to set flag.

## Diagram

<!-- image -->

## Fields

| Field    | Function                                                                                                                                       |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -  | Reserved                                                                                                                                       |
| 15 FLG15 | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 14 FLG14 | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 13 FLG13 | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event            |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                       |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 12 FLG12 | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 11 FLG11 | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 10 FLG10 | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 9 FLG9   | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 8 FLG8   | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 7 FLG7   | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event            |
| 6 FLG6   | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 5 FLG5   | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 4        | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation.                          |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------|
| FLG4    | 0b - No Event 1b - Event                                                                                                                       |
| 3 FLG3  | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 2 FLG2  | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 1 FLG1  | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 0 FLG0  | This flag is set by Core 2 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |

## 54.12.3.5 HOST Interrupt from Core 3 Register (HINTC3R)

## Offset

| Register   | Offset   |
|------------|----------|
| HINTC3R    | Ch       |

## Function

This register controls the event indication to HOST from Core 3. 16 flags can be set by Core 3 to indicate 16 separate events. All flags combine to generate a single interrupt to HOST. A flag once set, can be cleared only by HOST with w1c operation. All cores and HOST have read access to this register. Only HOST and Core 3 have write access to this register. ACCESS GUIDELINE- HOST: Write 1 to clear flag. Core 3: Write 1 to set flag.

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28    | 27    | 26    | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|-------|-------|-------|-------|-------|-------|------|------|------|------|------|------|------|------|------|------|
| R      | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |       |       |       |       |       |       |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15    | 14    | 13    | 12    | 11    | 10    | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    | FLG15 | FLG14 | FLG13 | FLG12 | FLG11 | FLG10 | FLG9 | FLG8 | FLG7 | FLG6 | FLG5 | FLG4 | FLG3 | FLG2 | FLG1 | FLG0 |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field    | Function                                                                                                                                       |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -  | Reserved                                                                                                                                       |
| 15 FLG15 | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 14 FLG14 | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 13 FLG13 | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 12 FLG12 | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 11 FLG11 | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 10 FLG10 | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation.                          |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

## Table continued from the previous page...

| Field   | Function                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------|
|         | 0b - No Event 1b - Event                                                                                                                       |
| 9 FLG9  | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 8 FLG8  | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 7 FLG7  | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 6 FLG6  | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 5 FLG5  | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 4 FLG4  | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 3 FLG3  | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 2       | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation.                          |
| FLG2    | 0b - No Event                                                                                                                                  |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 FLG1  | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |
| 0 FLG0  | This flag is set by Core 3 by writing 1 into it to indicate an event. The flag is cleared by HOST with w1c operation. 0b - No Event 1b - Event |

## 54.12.3.6 Core 0 Interrupt from HOST (C0INTHR)

## Offset

| Register   | Offset   |
|------------|----------|
| C0INTHR    | 20h      |

## Function

This register controls the event indication to Core 0 from HOST. 16 flags can be set by HOST to indicate 16 separate events. All flags combine to generate a single interrupt to Core 0. A flag once set, can be cleared only by Core 0 with w1c operation. All cores and HOST have read access to this register. Only HOST and Core 0 have write access to this register. ACCESS GUIDELINE- HOST: Write 1 to set flag. Core 0: Write 1 to clear flag.

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-16   | Reserved   |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                       |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------|
| -        |                                                                                                                                                |
| 15 FLG15 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 14 FLG14 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 13 FLG13 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 12 FLG12 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 11 FLG11 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 10 FLG10 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 9 FLG9   | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 8 FLG8   | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 7        | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation.                          |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------|
| FLG7    | 0b - No Event 1b - Event                                                                                                                       |
| 6 FLG6  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 5 FLG5  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 4 FLG4  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 3 FLG3  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 2 FLG2  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 1 FLG1  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |
| 0 FLG0  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 0 with w1c operation. 0b - No Event 1b - Event |

## 54.12.3.7 Core 1 Interrupt From HOST Register (C1INTHR)

## Offset

| Register   | Offset   |
|------------|----------|
| C1INTHR    | 24h      |

## Function

This register controls the event indication to Core 1 from HOST. 16 flags can be set by HOST to indicate 16 separate events. All flags combine to generate a single interrupt to Core 1. A flag once set, can be cleared only by Core 1 with w1c operation. All cores and HOST have read access to this register. Only HOST and Core 1 have write access to this register. ACCESS GUIDELINE- HOST: Write 1 to set flag. Core 1: Write 1 to clear flag.

## Diagram

<!-- image -->

## Fields

| Field    | Function                                                                                                                                       |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -  | Reserved                                                                                                                                       |
| 15 FLG15 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 14 FLG14 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 13 FLG13 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event            |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                       |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 12 FLG12 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 11 FLG11 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 10 FLG10 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 9 FLG9   | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 8 FLG8   | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 7 FLG7   | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event            |
| 6 FLG6   | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 5 FLG5   | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 4        | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation.                          |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------|
| FLG4    | 0b - No Event 1b - Event                                                                                                                       |
| 3 FLG3  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 2 FLG2  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 1 FLG1  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |
| 0 FLG0  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 1 with w1c operation. 0b - No Event 1b - Event |

## 54.12.3.8 Core 2 Interrupt from HOST Register (C2INTHR)

## Offset

| Register   | Offset   |
|------------|----------|
| C2INTHR    | 28h      |

## Function

This register controls the event indication to Core 2 from HOST. 16 flags can be set by HOST to indicate 16 separate events. All flags combine to generate a single interrupt to Core 2. A flag once set, can be cleared only by Core 2 with w1c operation. All cores and HOST have read access to this register. Only HOST and Core 2 have write access to this register. ACCESS GUIDELINE- HOST: Write 1 to set flag. Core 2: Write 1 to clear flag.

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28    | 27    | 26    | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|-------|-------|-------|-------|-------|-------|------|------|------|------|------|------|------|------|------|------|
| R      | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |       |       |       |       |       |       |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15    | 14    | 13    | 12    | 11    | 10    | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    | FLG15 | FLG14 | FLG13 | FLG12 | FLG11 | FLG10 | FLG9 | FLG8 | FLG7 | FLG6 | FLG5 | FLG4 | FLG3 | FLG2 | FLG1 | FLG0 |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field    | Function                                                                                                                                       |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -  | Reserved                                                                                                                                       |
| 15 FLG15 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 14 FLG14 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 13 FLG13 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 12 FLG12 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 11 FLG11 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 10 FLG10 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation.                          |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

## Table continued from the previous page...

| Field   | Function                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------|
|         | 0b - No Event 1b - Event                                                                                                                       |
| 9 FLG9  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 8 FLG8  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 7 FLG7  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 6 FLG6  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 5 FLG5  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 4 FLG4  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 3 FLG3  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event            |
| 2       | 1b - Event This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation.               |
| FLG2    | 0b - No Event 1b - Event                                                                                                                       |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 FLG1  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |
| 0 FLG0  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 2 with w1c operation. 0b - No Event 1b - Event |

## 54.12.3.9 Core 3 Interrupt from HOST Register (C3INTHR)

## Offset

| Register   | Offset   |
|------------|----------|
| C3INTHR    | 2Ch      |

## Function

This register controls the event indication to Core 3 from HOST. 16 flags can be set by HOST to indicate 16 separate events. All flags combine to generate a single interrupt to Core 3. A flag once set, can be cleared only by Core 3 with w1c operation. All cores and HOST have read access to this register. Only HOST and Core 3 have write access to this register. ACCESS GUIDELINE- HOST: Write 1 to set flag. Core 3: Write 1 to clear flag .

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-16   | Reserved   |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                       |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------|
| -        |                                                                                                                                                |
| 15 FLG15 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 14 FLG14 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 13 FLG13 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 12 FLG12 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 11 FLG11 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 10 FLG10 | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 9 FLG9   | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 8 FLG8   | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 7        | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation.                          |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------|
| FLG7    | 0b - No Event 1b - Event                                                                                                                       |
| 6 FLG6  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 5 FLG5  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 4 FLG4  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 3 FLG3  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 2 FLG2  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 1 FLG1  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |
| 0 FLG0  | This flag is set by HOST by writing 1 into it to indicate an event. The flag is cleared by Core 3 with w1c operation. 0b - No Event 1b - Event |

## 54.12.3.10 HOST Interrupt from Core 0 Enable Register (HINTC0ER)

## Offset

| Register   | Offset   |
|------------|----------|
| HINTC0ER   | 60h      |

## Function

This register controls the masking of corresponding flags inside HINTC0R. ACCESS GUIDELINE- Write/read access for all cores and HOST.

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28    | 27    | 26    | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|-------|-------|-------|-------|-------|-------|------|------|------|------|------|------|------|------|------|------|
| R      | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |       |       |       |       |       |       |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15    | 14    | 13    | 12    | 11    | 10    | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    | IEN15 | IEN14 | IEN13 | IEN12 | IEN11 | IEN10 | IEN9 | IEN8 | IEN7 | IEN6 | IEN5 | IEN4 | IEN3 | IEN2 | IEN1 | IEN0 |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field    | Function                                                                                               |
|----------|--------------------------------------------------------------------------------------------------------|
| 31-16 -  | Reserved                                                                                               |
| 15 IEN15 | This bit enables/disables FLG15 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 14 IEN14 | This bit enables/disables FLG14 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 13 IEN13 | This bit enables/disables FLG13 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 12 IEN12 | This bit enables/disables FLG12 propagation to the interrupt line 0b - Flag disabled                   |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                               |
|----------|--------------------------------------------------------------------------------------------------------|
| 11 IEN11 | This bit enables/disables FLG11 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 10 IEN10 | This bit enables/disables FLG10 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 9 IEN9   | This bit enables/disables FLG9 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 8 IEN8   | This bit enables/disables FLG8 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 7 IEN7   | This bit enables/disables FLG7 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 6 IEN6   | This bit enables/disables FLG6 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 5 IEN5   | This bit enables/disables FLG5 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 4 IEN4   | This bit enables/disables FLG4 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 3 IEN3   | This bit enables/disables FLG3 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 2 IEN2   | This bit enables/disables FLG2 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                              |
|---------|-------------------------------------------------------------------------------------------------------|
| 1       | This bit enables/disables FLG1 propagation to the interrupt line                                      |
| IEN1    | 0b - Flag disabled 1b - Flag enabled                                                                  |
| 0 IEN0  | This bit enables/disables FLG0 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |

## 54.12.3.11 HOST Interrupt from Core 1 Enable Register (HINTC1ER)

## Offset

| Register   | Offset   |
|------------|----------|
| HINTC1ER   | 64h      |

## Function

This register controls the masking of corresponding flags inside HINTC1R. ACCESS GUIDELINE- Write/read access for all cores and HOST.

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28    | 27    | 26    | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|-------|-------|-------|-------|-------|-------|------|------|------|------|------|------|------|------|------|------|
| R      | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |       |       |       |       |       |       |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15    | 14    | 13    | 12    | 11    | 10    | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    | IEN15 | IEN14 | IEN13 | IEN12 | IEN11 | IEN10 | IEN9 | IEN8 | IEN7 | IEN6 | IEN5 | IEN4 | IEN3 | IEN2 | IEN1 | IEN0 |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                          |
|---------|-------------------------------------------------------------------|
| 31-16   | Reserved                                                          |
| -       |                                                                   |
| 15      | This bit enables/disables FLG15 propagation to the interrupt line |
| IEN15   |                                                                   |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                 |
|----------|--------------------------------------------------------------------------------------------------------------------------|
| 14 IEN14 | 1b - Flag enabled This bit enables/disables FLG14 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 13 IEN13 | This bit enables/disables FLG13 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled                   |
| 12 IEN12 | This bit enables/disables FLG12 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled                   |
| 11 IEN11 | This bit enables/disables FLG11 propagation to the interrupt line 0b - Flag disabled                                     |
| 10 IEN10 | This bit enables/disables FLG10 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled                   |
| 9 IEN9   | This bit enables/disables FLG9 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled                    |
| 8 IEN8   | This bit enables/disables FLG8 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled                    |
| 7 IEN7   | This bit enables/disables FLG7 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled                    |
| 6 IEN6   | This bit enables/disables FLG6 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled                    |
| 5 IEN5   | This bit enables/disables FLG5 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled                    |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                              |
|---------|-------------------------------------------------------------------------------------------------------|
| 4 IEN4  | This bit enables/disables FLG4 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 3 IEN3  | This bit enables/disables FLG3 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 2 IEN2  | This bit enables/disables FLG2 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 1 IEN1  | This bit enables/disables FLG1 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 0 IEN0  | This bit enables/disables FLG0 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |

## 54.12.3.12 HOST Interrupt from Core 2 Enable Register (HINTC2ER)

## Offset

| Register   | Offset   |
|------------|----------|
| HINTC2ER   | 68h      |

## Function

This register controls the masking of corresponding flags inside HINTC2R. ACCESS GUIDELINE- Write/read access for all cores and HOST.

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28    | 27    | 26    | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|-------|-------|-------|-------|-------|-------|------|------|------|------|------|------|------|------|------|------|
| R      | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |       |       |       |       |       |       |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15    | 14    | 13    | 12    | 11    | 10    | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    | IEN15 | IEN14 | IEN13 | IEN12 | IEN11 | IEN10 | IEN9 | IEN8 | IEN7 | IEN6 | IEN5 | IEN4 | IEN3 | IEN2 | IEN1 | IEN0 |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field    | Function                                                                                               |
|----------|--------------------------------------------------------------------------------------------------------|
| 31-16 -  | Reserved                                                                                               |
| 15 IEN15 | This bit enables/disables FLG15 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 14 IEN14 | This bit enables/disables FLG14 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 13 IEN13 | This bit enables/disables FLG13 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 12 IEN12 | This bit enables/disables FLG12 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 11 IEN11 | This bit enables/disables FLG11 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 10 IEN10 | This bit enables/disables FLG10 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 9 IEN9   | This bit enables/disables FLG9 propagation to the interrupt line                                       |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

## Table continued from the previous page...

| Field   | Function                                                                                              |
|---------|-------------------------------------------------------------------------------------------------------|
|         | 0b - Flag disabled 1b - Flag enabled                                                                  |
| 8 IEN8  | This bit enables/disables FLG8 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 7 IEN7  | This bit enables/disables FLG7 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 6 IEN6  | This bit enables/disables FLG6 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 5 IEN5  | This bit enables/disables FLG5 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 4 IEN4  | This bit enables/disables FLG4 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 3 IEN3  | This bit enables/disables FLG3 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 2 IEN2  | This bit enables/disables FLG2 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 1 IEN1  | This bit enables/disables FLG1 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 0 IEN0  | This bit enables/disables FLG0 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |

## 54.12.3.13 HOST Interrupt from Core 3 Enable Register (HINTC3ER)

## Offset

| Register   | Offset   |
|------------|----------|
| HINTC3ER   | 6Ch      |

## Function

This register controls the masking of corresponding flags inside HINTC3R. ACCESS GUIDELINE- Write/read access for all cores and HOST.

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28    | 27    | 26    | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|-------|-------|-------|-------|-------|-------|------|------|------|------|------|------|------|------|------|------|
| R      | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |       |       |       |       |       |       |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15    | 14    | 13    | 12    | 11    | 10    | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    | IEN15 | IEN14 | IEN13 | IEN12 | IEN11 | IEN10 | IEN9 | IEN8 | IEN7 | IEN6 | IEN5 | IEN4 | IEN3 | IEN2 | IEN1 | IEN0 |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field    | Function                                                                                               |
|----------|--------------------------------------------------------------------------------------------------------|
| 31-16 -  | Reserved                                                                                               |
| 15 IEN15 | This bit enables/disables FLG15 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 14 IEN14 | This bit enables/disables FLG14 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 13 IEN13 | This bit enables/disables FLG13 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 12 IEN12 | This bit enables/disables FLG12 propagation to the interrupt line 0b - Flag disabled                   |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                               |
|----------|--------------------------------------------------------------------------------------------------------|
| 11 IEN11 | This bit enables/disables FLG11 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 10 IEN10 | This bit enables/disables FLG10 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |
| 9 IEN9   | This bit enables/disables FLG9 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 8 IEN8   | This bit enables/disables FLG8 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 7 IEN7   | This bit enables/disables FLG7 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 6 IEN6   | This bit enables/disables FLG6 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 5 IEN5   | This bit enables/disables FLG5 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 4 IEN4   | This bit enables/disables FLG4 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 3 IEN3   | This bit enables/disables FLG3 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |
| 2 IEN2   | This bit enables/disables FLG2 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled  |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                              |
|---------|-------------------------------------------------------------------------------------------------------|
| 1       | This bit enables/disables FLG1 propagation to the interrupt line 0b - Flag disabled                   |
| IEN1    | 1b - Flag enabled                                                                                     |
| 0 IEN0  | This bit enables/disables FLG0 propagation to the interrupt line 0b - Flag disabled 1b - Flag enabled |

## 54.12.4 Functional description

The core-to-core communication interface provides the capability for each core, including the host, to transmit and receive events with each other via flags and maskable interrupts.

The event indication between transmitting core and receiving core is facilitated by two types of registers (symbolic notation):

1. (RxCORE)INT(TxCORE)R - Receive core interrupt from transmit core register. This register is accessed to set or clear event flags. The transmit core sets a flag. The receive core clears the flag.
2. (RxCORE)INT(TxCORE)ER - Receive core interrupt from transmit core enable register. This register is accessed to enable or disable the propagation of the corresponding flag in (RxCORE)INT(TxCORE)R to the interrupt line.

A flag (field) written by the transmit core to (RxCORE)INT(TxCORE)R sets the flag in the register. A flag can be set when the transmitting core requests service from the receiving core. The receiving core is interrupted if the enable field for that flag is 1 in (RxCORE)INT(TxCORE)ER. Otherwise, the flag does not generate an interrupt but remains set. Only the receiving core can reset the flag by writing 1 to it.

Access guidelines:

1. (RxCORE)INT(TxCORE)R can be written only by TxCORE (to set a flag) and RxCORE (to clear a flag). It can be read by all cores and the host.
2. (RxCORE)INT(TxCORE)ER can be written and read by all cores and the host.

Block diagram shows the interrupt generation scheme with access types.

For example, assume core 0 must indicate two events to the host. One event is required to generate an interrupt and the other is required only to set a flag.

1. To generate an interrupt from the flag HINTC0R[0], write 1 to HINTC0ER[0] and keep all other fields 0. This can be done by any core or host.
2. Core 0 writes 1 to HINTC0R[1] to indicate the first event to the host. No interrupt is generated for this because it is not enabled (HINTC0ER[1]=0). Only the flag is set.
3. Core 0 writes 1 to HINTC0R[0] to indicate the second event to the host. This generates an interrupt to the host along with this flag because it is enabled (HINTC0ER[0]=1).
4. The host, in reaction to the interrupt, reads HOST interrupt from Core 0 Register (HINTC0R) and clears flags HINTC0R[0] and HINTC0R[1] by writing 1 to each of them after completing the requested task.
5. Flags HINTC0R[0] and HINTC0R[1] are then available to be written by core 1 again.

Each core has its own flag/interrupt set registers and flag mask registers.

The transmitting core sets the interrupt/flag to the register of the receiving core. The same physical register is read/write for the transmitting core and W1C for the receiving core. If enabled, each field of this flag/interrupt register can generate an interrupt; otherwise, it is used as a flag and is polled by the receiving core.

Low Latency Communication Engine (LLCE)

The receiving core clears the interrupts and flags in its own flag/interrupt register. Therefore, the transmitting core must check the current flag status before setting it. There is no protection taken if the transmitting core clears a flag/interrupt itself before the receiving core has read and acted upon it.

Each master has fixed master IDs in the system. The following figure shows the decoding of master IDs to generate access protection.

Cores of LLCE have master ID values that are hard-coded to identify them uniquely. The core-to-core module has five master ID input ports, each dedicated to one master, with one for the host and four for the cores. The host port is fixed at value 8h.

Index assignment and fixed values of master IDs are shown below:

- Host master ID 8h
- Core0 master ID 3h
- Core1 master ID 4h
- Core2 master ID 5h
- Core3 master ID 6h

<!-- image -->

## Access protection

Access to (RxCORE)INT(TxCORE)R registers is protected against access from disallowed cores. The master ID from the access interface is compared against the master ID of core 0-3 and the host.

- If its ID matches TxCORE ID, access is granted to a core to set the flag.
- If its ID matches RxCORE ID, access is granted to a core to clear the flag.

## 54.13 Interrupts and status

Multiple interrupts generate from LLCE's internal modules. The interrupt logic of LLCE does concentration, keeps status, and routes them per configuration. The output goes to IRQ lines of LLCE cores and to host.

There are two modules inside LLCE:

- Interrupt concentrator module (IC)
- Interrupt routing configuration module (IRCM)

## 54.13.1 Interrupt concentrator (IC)

The IC takes interrupts from FIFOs and Core2Core and concentrates (OR-ed) them and present to IRCM.

Concentration occurs in two stages:

- First Level: concentration of interrupts from a single module
- Second level: concentration of interrupts from first level or directly from different modules (where first level is not required)

There are status registers for the interrupts for which second level of concentration helps in identifying the interrupting module by reading one register only. These registers are read only and corresponding status is automatically cleared when its source is cleared. The output of concentrator module goes to interrupt routing configuration module (IRCM).

## 54.13.2 Interrupt concentrator register descriptions

## 54.13.2.1 Int\_Concentrator memory map

LLCE\_Int\_Concentrator base address: 43A1\_4000h

| Offset   | Register                                           |   Width (In bits) | Access   | Reset value   |
|----------|----------------------------------------------------|-------------------|----------|---------------|
| 38h      | Interrupt Concentrator Status Register#14 (ICSR14) |                32 | RO       | 0000_0000h    |
| 3Ch      | Interrupt Concentrator Status Register#15 (ICSR15) |                32 | RO       | 0000_0000h    |
| 40h      | Interrupt Concentrator Status Register#16 (ICSR16) |                32 | RO       | 0000_0000h    |
| 44h      | Interrupt Concentrator Status Register#17 (ICSR17) |                32 | RO       | 0000_0000h    |
| 48h      | Interrupt Concentrator Status Register#18 (ICSR18) |                32 | RO       | 0000_0000h    |
| 4Ch      | Interrupt Concentrator Status Register#19 (ICSR19) |                32 | RO       | 0000_0000h    |
| 50h      | Interrupt Concentrator Status Register#20 (ICSR20) |                32 | RO       | 0000_0000h    |
| 54h      | Interrupt Concentrator Status Register#21 (ICSR21) |                32 | RO       | 0000_0000h    |
| 58h      | Interrupt Concentrator Status Register#22 (ICSR22) |                32 | RO       | 0000_0000h    |
| 5Ch      | Interrupt Concentrator Status Register#23 (ICSR23) |                32 | RO       | 0000_0000h    |
| 60h      | Interrupt Concentrator Status Register#24 (ICSR24) |                32 | RO       | 0000_0000h    |
| 64h      | Interrupt Concentrator Status Register#25 (ICSR25) |                32 | RO       | 0000_0000h    |
| 68h      | Interrupt Concentrator Status Register#26 (ICSR26) |                32 | RO       | 0000_0000h    |
| 6Ch      | Interrupt Concentrator Status Register#27 (ICSR27) |                32 | RO       | 0000_0000h    |

Low Latency Communication Engine (LLCE)

## 54.13.2.2 Interrupt Concentrator Status Register#14 (ICSR14)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR14     | 38h      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #7 to #0.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                   |
|---------|----------------------------------------------------------------------------|
| 31-8 -  | Reserved                                                                   |
| 7 FB7   | LLCE_FIFO_7 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 6 FB6   | LLCE_FIFO_6 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB5   | LLCE_FIFO-5 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB4   | LLCE_FIFO_4 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                   |
|---------|----------------------------------------------------------------------------|
| 3 FB3   | LLCE_FIFO_3 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB2   | LLCE_FIFO_2 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB1   | LLCE_FIFO_1 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 0 FB0   | LLCE_FIFO_0 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |

## 54.13.2.3 Interrupt Concentrator Status Register#15 (ICSR15)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR15     | 3Ch      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #15 to #8.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | FB15 | B14  | FB13 | FB12 | FB11 | FB10 | FB9  | FB8  |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
| 31-8 -  | Reserved                                                                    |
| 7 FB15  | LLCE_FIFO_15 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 6 FB14  | LLCE_FIFO_14 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB13  | LLCE_FIFO_13 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB12  | LLCE_FIFO_12 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 3 FB11  | LLCE_FIFO_11 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB10  | LLCE_FIFO_10 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB9   | LLCE_FIFO_9 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present  |
| 0 FB8   | LLCE_FIFO_8 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present  |

## 54.13.2.4 Interrupt Concentrator Status Register#16 (ICSR16)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR16     | 40h      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #28 to #21.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | FB28 | FB27 | FB26 | FB25 | FB24 | FB23 | FB22 | FB21 |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
| 31-8 -  | Reserved                                                                    |
| 7 FB28  | LLCE_FIFO_28 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 6 FB27  | LLCE_FIFO_27 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB26  | LLCE_FIFO_26 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB25  | LLCE_FIFO_25 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 3 FB24  | LLCE_FIFO_24 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB23  | LLCE_FIFO_23 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                           |
|---------|----------------------------------------------------|
| 1       | LLCE_FIFO_22 Interrupt B                           |
| FB22    | 0b - Interrupt is Absent 1b - Interrupt is Present |
| 0       | LLCE_FIFO_21 Interrupt B 0b - Interrupt is Absent  |
| FB21    | 1b - Interrupt is Present                          |

## 54.13.2.5 Interrupt Concentrator Status Register#17 (ICSR17)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR17     | 44h      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #36 to #30.

## Diagram

<!-- image -->

## Fields

| Field   | Function                 |
|---------|--------------------------|
| 31-8    | Reserved                 |
| 7       | LLCE_FIFO_36 Interrupt B |
| FB36    | 0b - Interrupt is Absent |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
|         | 1b - Interrupt is Present                                                   |
| 6 FB35  | LLCE_FIFO_35 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB34  | LLCE_FIFO_34 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB33  | LLCE_FIFO_33 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 3 FB32  | LLCE_FIFO_32 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB31  | LLCE_FIFO_31 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB30  | LLCE_FIFO_30 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 0 FB29  | LLCE_FIFO_29 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |

## 54.13.2.6 Interrupt Concentrator Status Register#18 (ICSR18)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR18     | 48h      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #49 to #42.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | FB49 | FB48 | FB47 | FB46 | FB45 | FB44 | FB43 | FB42 |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
| 31-8 -  | Reserved                                                                    |
| 7 FB49  | LLCE_FIFO_49 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 6 FB48  | LLCE_FIFO_48 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB47  | LLCE_FIFO_47 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB46  | LLCE_FIFO_46 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 3 FB45  | LLCE_FIFO_45 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB44  | LLCE_FIFO_44 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB43  | LLCE_FIFO_43 Interrupt B                                                    |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

Table continued from the previous page...

| Field   | Function                                           |
|---------|----------------------------------------------------|
|         | 0b - Interrupt is Absent 1b - Interrupt is Present |
| 0       | LLCE_FIFO_42 Interrupt B 0b - Interrupt is         |
| FB42    | Absent 1b - Interrupt is Present                   |

## 54.13.2.7 Interrupt Concentrator Status Register#19 (ICSR19)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR19     | 4Ch      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #57 to #50.

## Diagram

<!-- image -->

## Fields

| Field   | Function                  |
|---------|---------------------------|
| 31-8    | Reserved                  |
| -       |                           |
| 7       | LLCE_FIFO_57 Interrupt B  |
| FB57    | 0b - Interrupt is Absent  |
|         | 1b - Interrupt is Present |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
| 6 FB56  | LLCE_FIFO_56 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB55  | LLCE_FIFO_55 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB54  | LLCE_FIFO_54 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 3 FB53  | LLCE_FIFO_53 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB52  | LLCE_FIFO_52 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB51  | LLCE_FIFO_51 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 0 FB50  | LLCE_FIFO_50 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |

## 54.13.2.8 Interrupt Concentrator Status Register#20 (ICSR20)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR20     | 50h      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #70 to #63.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |    |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|----|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0  |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |    |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |    |
| Bits   | 15   | 14   | 13   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | FB70 | FB69 | FB68 | FB67 | FB66 | FB65 | FB64 | FB63 |    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |    |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |    |

## Fields

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
| 31-8 -  | Reserved                                                                    |
| 7 FB70  | LLCE_FIFO_70 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 6 FB69  | LLCE_FIFO_69 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB68  | LLCE_FIFO_68 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB67  | LLCE_FIFO_67 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 3 FB66  | LLCE_FIFO_66 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB65  | LLCE_FIFO_65 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB64  | LLCE_FIFO_64 Interrupt B                                                    |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

Table continued from the previous page...

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
|         | 0b - Interrupt is Absent 1b - Interrupt is Present                          |
| 0 FB63  | LLCE_FIFO_63 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |

## 54.13.2.9 Interrupt Concentrator Status Register#21 (ICSR21)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR21     | 54h      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #78 to #71.

## Diagram

<!-- image -->

## Fields

| Field   | Function                  |
|---------|---------------------------|
| 31-8    | Reserved                  |
| -       |                           |
| 7       | LLCE_FIFO_78 Interrupt B  |
| FB78    | 0b - Interrupt is Absent  |
|         | 1b - Interrupt is Present |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
| 6 FB77  | LLCE_FIFO_77 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB76  | LLCE_FIFO_76 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB75  | LLCE_FIFO_75 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 3 FB74  | LLCE_FIFO_74 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB73  | LLCE_FIFO_73 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB72  | LLCE_FIFO_72 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 0 FB71  | LLCE_FIFO_71 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |

## 54.13.2.10 Interrupt Concentrator Status Register#22 (ICSR22)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR22     | 58h      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #91 to #84.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | FB91 | B90  | B89  | FB88 | FB87 | FB86 | FB85 | FB84 |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
| 31-8 -  | Reserved                                                                    |
| 7 FB91  | LLCE_FIFO_91 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 6 FB90  | LLCE_FIFO_90 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB89  | LLCE_FIFO_89 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB88  | LLCE_FIFO_88 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 3 FB87  | LLCE_FIFO_87 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB86  | LLCE_FIFO_86 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB85  | LLCE_FIFO_85 Interrupt B                                                    |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

Table continued from the previous page...

| Field   | Function                                           |
|---------|----------------------------------------------------|
|         | 0b - Interrupt is Absent 1b - Interrupt is Present |
| 0       | LLCE_FIFO_84 Interrupt B 0b - Interrupt is Absent  |
| FB84    | 1b - Interrupt is Present                          |

## 54.13.2.11 Interrupt Concentrator Status Register#23 (ICSR23)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR23     | 5Ch      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #99 to #92.

## Diagram

<!-- image -->

## Fields

| Field   | Function                  |
|---------|---------------------------|
| 31-8    | Reserved                  |
| -       |                           |
| 7       | LLCE_FIFO_99 Interrupt B  |
| FB99    | 0b - Interrupt is Absent  |
|         | 1b - Interrupt is Present |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
| 6 FB98  | LLCE_FIFO_98 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB97  | LLCE_FIFO_97 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB96  | LLCE_FIFO_96 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 3 FB95  | LLCE_FIFO_95 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB94  | LLCE_FIFO_94 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB93  | LLCE_FIFO_93 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 0 FB92  | LLCE_FIFO_92 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |

## 54.13.2.12 Interrupt Concentrator Status Register#24 (ICSR24)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR24     | 60h      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #40 to #37 and LLCE\_FIFO #19 to #16.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | FB40 | FB39 | FB38 | FB37 | FB19 | FB18 | FB17 | FB16 |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
| 31-8 -  | Reserved                                                                    |
| 7 FB40  | LLCE_FIFO_40 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 6 FB39  | LLCE_FIFO_39 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB38  | LLCE_FIFO_38 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB37  | LLCE_FIFO_37 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 3 FB19  | LLCE_FIFO_19 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB18  | LLCE_FIFO_18 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB17  | LLCE_FIFO_17 Interrupt B                                                    |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

Table continued from the previous page...

| Field   | Function                                           |
|---------|----------------------------------------------------|
|         | 0b - Interrupt is Absent 1b - Interrupt is Present |
| 0       | LLCE_FIFO_16 Interrupt B 0b - Interrupt is         |
| FB16    | Absent 1b - Interrupt is Present                   |

## 54.13.2.13 Interrupt Concentrator Status Register#25 (ICSR25)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR25     | 64h      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #82 to #79 and LLCE\_FIFO #61 to #58.

## Diagram

<!-- image -->

## Fields

| Field   | Function                  |
|---------|---------------------------|
| 31-8    | Reserved                  |
| -       |                           |
| 7       | LLCE_FIFO_82 Interrupt B  |
| FB82    | 0b - Interrupt is Absent  |
|         | 1b - Interrupt is Present |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                    |
|---------|-----------------------------------------------------------------------------|
| 6 FB81  | LLCE_FIFO_81 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 5 FB80  | LLCE_FIFO_80 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 4 FB79  | LLCE_FIFO_79Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present  |
| 3 FB61  | LLCE_FIFO_61 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB60  | LLCE_FIFO_60 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB59  | LLCE_FIFO_59 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 0 FB58  | LLCE_FIFO_58Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present  |

## 54.13.2.14 Interrupt Concentrator Status Register#26 (ICSR26)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR26     | 68h      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO #1103 to #100.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19    | 18    | 17    | 16    |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|-------|-------|-------|-------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 0     |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |       |       |       |       |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 0     |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3     | 2     | 1     | 0     |
| R      |      |      |      |      |      |      |      |      |      |      |      |      | FB103 | FB102 | FB101 | FB100 |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |       |       |       |       |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 0     |

## Fields

| Field   | Function                                                                     |
|---------|------------------------------------------------------------------------------|
| 31-4 -  | Reserved                                                                     |
| 3 FB103 | LLCE_FIFO_103 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 2 FB102 | LLCE_FIFO_102 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 1 FB101 | LLCE_FIFO_101 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 0 FB100 | LLCE_FIFO_100 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |

## 54.13.2.15 Interrupt Concentrator Status Register#27 (ICSR27)

## Offset

| Register   | Offset   |
|------------|----------|
| ICSR27     | 6Ch      |

## Function

This register provides status information of interrupt B for LLCE\_FIFO\_104, LLCE\_FIFO\_83, LLCE\_FIFO\_62, LLCE\_FIFO\_41 and LLCE\_FIFO\_20.

Low Latency Communication Engine (LLCE)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20    | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|-------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |       |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4     | 3    | 2    | 1    | 0    |
| R      |      |      |      |      |      | 0    |      |      |      |      |      | FB104 | FB83 | FB62 | FB41 | FB20 |
| W      |      |      |      |      |      |      |      |      |      |      |      |       |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                     |
|---------|------------------------------------------------------------------------------|
| 31-5 -  | Reserved                                                                     |
| 4 FB104 | LLCE_FIFO_104 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present |
| 3 FB83  | LLCE_FIFO_83 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present  |
| 2 FB62  | LLCE_FIFO_62 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present  |
| 1 FB41  | LLCE_FIFO_41 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present  |
| 0 FB20  | LLCE_FIFO_20 Interrupt B 0b - Interrupt is Absent 1b - Interrupt is Present  |

## 54.13.3 Interrupt routing configuration module (IRCM)

IRCM contains the configuration that defines the destinations of the interrupts.

It has a configuration register (IRSPRCn) corresponding to each input. This register has as many fields as the number of possible destinations for the interrupt. The number of destinations for each input interrupt is fixed per its functional requirements. One input may have single or multiple destinations. In both cases, the field specified for a destination enables or disables the interrupt associated with it. An interrupt that has multiple destinations can go to all or some of the selected destinations, if enabled in its register.

Low Latency Communication Engine (LLCE)

The destinations are:

- LLCE Core 0
- LLCE Core 1
- LLCE Core 2
- LLCE Core 3
- Host

B line interrupts from each 8 FIFOs are captured in the same status register (ICSR*) inside IC and concentrated (OR-ed) at the second level to feed to IRCM. IRSPRCn contains the fields to route the interrupt to different locations. The following table shows the FIFO instances and corresponding registers to check the interrupt status and control the routing.

Table 412. Core2core and FIFO instances and corresponding interrupt registers

| Module    | Module instances                        | Interrupt concentrator status register   |   Host |
|-----------|-----------------------------------------|------------------------------------------|--------|
| Core2core | Core2core                               | -                                        |      0 |
| Core2core | Core2core                               | -                                        |      1 |
| Core2core | Core2core                               | -                                        |      2 |
| Core2core | Core2core                               | -                                        |      3 |
| FIFO      | LLCE_FIFO_7_0                           | ICSR14                                   |      4 |
|           | LLCE_FIFO_15_8                          | ICSR15                                   |      5 |
|           | LLCE_FIFO_21_28                         | ICSR16                                   |      6 |
|           | LLCE_FIFO_36_29                         | ICSR17                                   |      7 |
|           | LLCE_FIFO_49_42                         | ICSR18                                   |      8 |
|           | LLCE_FIFO_57_50                         | ICSR19                                   |      9 |
|           | LLCE_FIFO_70_63                         | ICSR20                                   |     10 |
|           | LLCE_FIFO_78_71                         | ICSR21                                   |     11 |
|           | LLCE_FIFO_91_84                         | ICSR22                                   |     12 |
|           | LLCE_FIFO_99_85                         | ICSR23                                   |     13 |
|           | LLCE_FIFO_41_37, LLCE_FIFO_19_16        | ICSR24                                   |     14 |
|           | LLCE_FIFO_82_79, LLCE_FIFO_61_58        | ICSR25                                   |     15 |
|           | LLCE_FIFO_103_100                       | ICSR26                                   |     16 |
|           | LLCE_FIFO_104 LLCE_FIFO_83 LLCE_FIFO_62 | ICSR27                                   |     17 |

Table continues on the next page...

## S32G2 Reference Manual, Rev. 8, February 2024

Low Latency Communication Engine (LLCE)

Table 412. Core2core and FIFO instances and corresponding interrupt registers (continued)

| Module   | Module instances          | Interrupt concentrator status register   | Host   |
|----------|---------------------------|------------------------------------------|--------|
|          | LLCE_FIFO_41 LLCE_FIFO_20 |                                          |        |

## 54.14 Local Interconnect Network (LIN) interfaces

The LINFlex controller is designed to manage a large number of LIN messages efficiently with a minimum of CPU load. It supports LIN protocol version 1.3, 2.0, 2.1, and 2.2. See the LINFlexD chapter for details.

## NOTE

The LIN modules inside LLCE doesn't have DMA features.

LINFlexD interface base addresses:

- LLCE\_LINFlexD\_0 base address: 43C0\_8000h
- LLCE\_LINFlexD\_1 base address: 43C0\_8400h
- LLCE\_LINFlexD\_2 base address: 43C0\_8800h
- LLCE\_LINFlexD\_3 base address: 43C0\_8C00h

## 54.15 FlexRay host interface

The FlexRay communication controller implements the  FlexRay Communications System Protocol Specification, Version 2.1 Rev A. The host interface provides access to the module's configuration, control, and status registers, and to the message buffer configuration, control, and status registers. The offset of the FlexRay communication controller registers is given in memory map tab of attached spread sheet. 16 KB has been reserved for the registers. See the FlexRay chapter for details.

## NOTE

The FlexRay module of LLCE has 32-bit system memory interface.

LLCE Flexray base address: 43C1\_0000h

## 54.16 LPSPI

LPSPI is a low-power Serial Peripheral Interface (SPI) module that supports an efficient interface to an SPI bus, either as a master and/or as a slave. The SPI bus is a synchronous serial communication interface used in embedded systems, typically to perform short distance communications between microcontrollers and peripheral devices, on printed circuit boards. Typical applications include interfacing to Secure Digital cards and LCD displays.

## 54.16.1 Block diagram

<!-- image -->

## 54.16.2 Features

LPSPI supports:

- Uses little CPU overhead
- Word size of 32 bits
- Configurable clock polarity and clock phase
- Master operation supporting up to 4 peripheral chip selects
- Slave operation
- Command/transmit FIFO of 4 words
- Receive FIFO of 4 words
- Flexible timing parameters in Master mode, including SCK frequency, duty cycle, and delays between PCS and SCK edges
- Continuous transfer option to keep the PCS asserted across multiple frames
- Full duplex transfers supporting 1-bit transmit and receive on each clock edge
- Half duplex transfers supporting 1-bit transmit or receive on each clock edge
- Half duplex transfers supporting 2-bit transmit or receive on each clock edge

- Half duplex transfers supporting 4-bit transmit or receive on each clock edge
- Host request can be used to control the start of a SPI bus transfer

## 54.16.3 Memory map and registers

## NOTE

Writing a Read-Only (RO) register or reading a Write-Only (WO) register can cause bus errors. LPSPI does not check if programmed values in the registers are correct, so application software must take care to write valid values only.

## 54.16.3.1 LPSPI register descriptions

## 54.16.3.1.1 LPSPI memory map

LLCE\_LPSPI\_0 base address: 43C0\_0000h

LLCE\_LPSPI\_1 base address: 43C0\_1000h

LLCE\_LPSPI\_2 base address: 43C0\_2000h

LLCE\_LPSPI\_3 base address: 43C0\_3000h

| Offset   | Register                       |   Width (In bits) | Access   | Reset value   |
|----------|--------------------------------|-------------------|----------|---------------|
| 0h       | Version ID (VERID)             |                32 | RO       | 0200_0004h    |
| 4h       | Parameter (PARAM)              |                32 | RO       | 0004_0202h    |
| 10h      | Control (CR)                   |                32 | RW       | 0000_0000h    |
| 14h      | Status (SR)                    |                32 | W1C      | 0000_0001h    |
| 18h      | Interrupt Enable (IER)         |                32 | RW       | 0000_0000h    |
| 20h      | Configuration 0 (CFGR0)        |                32 | RW       | 0000_0000h    |
| 24h      | Configuration 1 (CFGR1)        |                32 | RW       | 0000_0000h    |
| 30h      | Data Match 0 (DMR0)            |                32 | RW       | 0000_0000h    |
| 34h      | Data Match 1 (DMR1)            |                32 | RW       | 0000_0000h    |
| 40h      | Clock Configuration (CCR)      |                32 | RW       | 0000_0000h    |
| 44h      | Clock Configuration 1 (CCR1)   |                32 | RW       | 0000_0000h    |
| 58h      | FIFO Control (FCR)             |                32 | RW       | 0000_0000h    |
| 5Ch      | FIFO Status (FSR)              |                32 | RO       | 0000_0000h    |
| 60h      | Transmit Command (TCR)         |                32 | RW       | 0000_001Fh    |
| 64h      | Transmit Data (TDR)            |                32 | WO       | 0000_0000h    |
| 70h      | Receive Status (RSR)           |                32 | RO       | 0000_0002h    |
| 74h      | Receive Data (RDR)             |                32 | RO       | 0000_0000h    |
| 78h      | Receive Data Read Only (RDROR) |                32 | RO       | 0000_0000h    |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

## Table continued from the previous page...

| Offset      | Register                              |   Width (In bits) | Access   | Reset value   |
|-------------|---------------------------------------|-------------------|----------|---------------|
| 3FCh        | Transmit Command Burst (TCBR)         |                32 | WO       | 0000_0000h    |
| 400h - 5FCh | Transmit Data Burst (TDBR0 - TDBR127) |                32 | WO       | 0000_0000h    |
| 600h - 7FCh | Receive Data Burst (RDBR0 - RDBR127)  |                32 | RO       | 0000_0000h    |

## 54.16.3.1.2 Version ID (VERID)

## Offset

| Register   | Offset   |
|------------|----------|
| VERID      | 0h       |

## Function

Contains version numbers for the module design and feature set.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                        |
|---------|---------------------------------------------------------------------------------|
| 31-24   | Major Version Number                                                            |
| MAJOR   | Returns the major version number for the module specification. Read-only field. |
| 23-16   | Minor Version Number                                                            |
| MINOR   | Returns the minor version number for the module specification. Read-only field. |
| 15-0    | Module Identification Number Returns the feature set number. Read-only field.   |
| FEATURE | 0000_0000_0000_0100b - Standard feature set supporting a 32-bit shift register. |

## 54.16.3.1.3 Parameter (PARAM)

## Offset

| Register   | Offset   |
|------------|----------|
| PARAM      | 4h       |

## Function

Contains parameter values that were implemented in the module.

## Diagram

<!-- image -->

## Fields

| Field        | Function                                                                                           |
|--------------|----------------------------------------------------------------------------------------------------|
| 31-24 -      | Reserved                                                                                           |
| 23-16 PCSNUM | PCS Number Sets the number of PCS pins supported by the peripheral.                                |
| 15-8 RXFIFO  | Receive FIFO Size Indicates the maximum number of words in the receive FIFO, which is 2 RXFIFO .   |
| 7-0 TXFIFO   | Transmit FIFO Size Indicates the maximum number of words in the transmit FIFO, which is 2 TXFIFO . |

## 54.16.3.1.4 Control (CR)

## Offset

| Register   | Offset   |
|------------|----------|
| CR         | 10h      |

## Function

Contains fields associated with the module operation.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19     | 18        | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|--------|-----------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0         | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |        |           |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0         | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3      | 2         | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    |      |      | 0    | 0    | 0    | 0    | DBGE N | Reserv ed | RST  | MEN  |
| W      |      |      |      |      |      |      | RRF  | RTF  |      |      |      |      | DBGE N | Reserv ed | RST  | MEN  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0         | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                                                                                              |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-10 - | Reserved                                                                                                                                                                                                                                                                                                                                                              |
| 9 RRF   | Reset Receive FIFO 0b - No effect 1b - Reset the Receive FIFO. The register bit always reads zero.                                                                                                                                                                                                                                                                    |
| 8 RTF   | Reset Transmit FIFO 0b - No effect 1b - Reset the Transmit FIFO. The register bit always reads zero.                                                                                                                                                                                                                                                                  |
| 7-4 -   | Reserved                                                                                                                                                                                                                                                                                                                                                              |
| 3 DBGEN | Debug Enable Enables or disables the LPSPI module in debug mode. Debug Enable bit should be updated only when the LPSPI module is disabled. 0b - LPSPI module is disabled when the CPU is halted. When LPSPI is disabled, the PCS will be negated once the transmit FIFO is empty regardless of the state of TCR register. 1b - LPSPI module is enabled in debug mode |
| 2 -     | Reserved                                                                                                                                                                                                                                                                                                                                                              |
| 1 RST   | Software Reset                                                                                                                                                                                                                                                                                                                                                        |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | Reset all internal logic and registers, except the Control Register. RST remains set until cleared by software. The reset takes effect immediately and remains asserted until negated by software. There is no minimum delay required before clearing the software reset. 0b - Module is not reset 1b - Module is reset |
| 0 MEN   | Module Enable 0b - Module is disabled 1b - Module is enabled                                                                                                                                                                                                                                                            |

## 54.16.3.1.5 Status (SR)

## Offset

| Register   | Offset   |
|------------|----------|
| SR         | 14h      |

## Function

Contains the status of data flow.

## Diagram

<!-- image -->

## Fields

| Field   | Function         |
|---------|------------------|
| 31-25   | Reserved         |
| 24      | Module Busy Flag |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| MBF     | In Master mode, MBF asserts when there is data to transmit and LPSPI is able to transmit (eg: HREQ asserted, etc). It negates after the PCS negates and the LPSPI master has waited half the DBT time with no new data to transmit. Slave mode asserts MBF when LPSPI is enabled and PCS is asserted. 0b - LPSPI is idle 1b - LPSPI is busy    |
| 23-14 - | Reserved                                                                                                                                                                                                                                                                                                                                       |
| 13 DMF  | Data Match Flag Indicates that the received data has matched the DMR0[MATCH0] and/or DMR1[MATCH1] fields (as configured by CFGR1[MATCFG]. 0b - Have not received matching data 1b - Have received matching data                                                                                                                                |
| 12 REF  | Receive Error Flag The Receive Error Flag sets when the Receiver FIFO overflows. When the Receive Error Flag is set, it is recommended to first end the transfer, empty the Receive FIFO, clear the Receive Error Flag and then restart the transfer from the beginning. 0b - Receive FIFO has not overflowed 1b - Receive FIFO has overflowed |
| 11 TEF  | Transmit Error Flag The Transmit Error Flag sets when the Transmit FIFO underruns. When the Transmit Error Flag is set, it is recommended to first end the transfer, clear the Transmit Error Flag and then restart the transfer from the beginning. 0b - Transmit FIFO underrun has not occurred 1b - Transmit FIFO underrun has occurred     |
| 10 TCF  | Transfer Complete Flag In Master mode when LPSPI returns to idle state with the transmit FIFO empty, the Transfer Complete Flag sets. 0b - All transfers have not completed 1b - All transfers have completed                                                                                                                                  |
| 9 FCF   | Frame Complete Flag The Frame Complete Flag sets at the end of each frame transfer, when the PCS negates. 0b - Frame transfer has not completed 1b - Frame transfer has completed                                                                                                                                                              |
| 8       | Word Complete Flag                                                                                                                                                                                                                                                                                                                             |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                             |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| WCF     | The Word Complete Flag sets when the last bit of a received word is sampled. 0b - Transfer of a received word has not yet completed 1b - Transfer of a received word has completed                                   |
| 7-2 -   | Reserved                                                                                                                                                                                                             |
| 1 RDF   | Receive Data Flag The Receive Data Flag is set whenever the number of words in the receive FIFO is greater than the value in FCR[RXWATER]. 0b - Receive Data is not ready 1b - Receive data is ready                 |
| 0 TDF   | Transmit Data Flag The Transmit Data Flag is set whenever the number of words in the transmit FIFO is equal or less than the value in FCR[TXWATER]. 0b - Transmit data not requested 1b - Transmit data is requested |

## 54.16.3.1.6 Interrupt Enable (IER)

## Offset

| Register   | Offset   |
|------------|----------|
| IER        | 18h      |

## Function

Enables interrupts based on data flow and errors.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                      |
|---------|---------------------------------------------------------------|
| 31-14 - | Reserved                                                      |
| 13 DMIE | Data Match Interrupt Enable 0b - Disabled 1b - Enabled        |
| 12 REIE | Receive Error Interrupt Enable 0b - Disabled 1b - Enabled     |
| 11 TEIE | Transmit Error Interrupt Enable 0b - Disabled 1b - Enabled    |
| 10 TCIE | Transfer Complete Interrupt Enable 0b - Disabled 1b - Enabled |
| 9 FCIE  | Frame Complete Interrupt Enable 0b - Disabled 1b - Enabled    |
| 8 WCIE  | Word Complete Interrupt Enable 0b - Disabled 1b - Enabled     |
| 7-2 -   | Reserved                                                      |
| 1 RDIE  | Receive Data Interrupt Enable 0b - Disabled 1b - Enabled      |
| 0 TDIE  | Transmit Data Interrupt Enable 0b - Disabled 1b - Enabled     |

## 54.16.3.1.7 Configuration 0 (CFGR0)

## Offset

| Register   | Offset   |
|------------|----------|
| CFGR0      | 20h      |

## Function

Includes additional fields to configure LPSPI including Circular FIFO Enable and Receive Data Match Only.

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-10 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 9 RDMO    | Receive Data Match Only When RDMO is enabled, all received data that does not cause the Data Match Flag (SR[DMF]) to set is discarded. • Set the RDMO bit when LPSPI is idle and SR[DMF] = 0. • After SR[DMF] = 1, the RDMO bit configuration is ignored. • When disabling RDMO and to ensure that no receive data is lost, before clearing SR[DMF], first clear RDMO. 0b - Received data is stored in the receive FIFO as in normal operations 1b - Received data is discarded unless the SR[DMF] = 1 |
| 8 CIRFIFO | Circular FIFO Enable When enabled, the transmit FIFO read pointer is saved to a temporary register. The transmit FIFO is emptied as it normally is, but after LPSPI is idle and the transmit FIFO is empty, then the read pointer value is restored from the temporary register. This restoring of the read pointer causes the contents of the transmit FIFO to be cycled through repeatedly.                                                                                                          |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                             |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | The read pointer is restored for as long as the CIRFIFO is set. Writing additional words to the FIFO after setting CIRFIFO adds them to the end of the FIFO, up to the size of the transmit FIFO. NOTE 0b - Circular FIFO is disabled 1b - Circular FIFO is enabled                                                                                  |
| 7-4 -   | Reserved                                                                                                                                                                                                                                                                                                                                             |
| 3 HRDIR | Host Request Direction Configures the direction of the HREQ pin. The HREQ pin should only be configured as output in Slave mode. The HREQ pin direction is input for Master mode. 0b - HREQ pin is configured as input 1b - HREQ pin is configured as output                                                                                         |
| 2 HRSEL | Host Request Select Selects the source of the host request input. When the host request function is enabled with the HREQ pin, the PCS[1] function is disabled. 0b - Host request input is the HREQ pin 1b - Host request input is the input trigger                                                                                                 |
| 1 HRPOL | Host Request Polarity Configures the polarity of the host request pin or trigger. 0b - HREQ pin or input trigger is active high 1b - HREQ pin or input trigger is active low                                                                                                                                                                         |
| 0 HREN  | Host Request Enable When enabled in Master mode, LPSPI only starts a new SPI bus transfer if the host request input is asserted. When LPSPI is busy, the host request input is ignored. When enabled in Slave mode, the HREQ output pin asserts when data is available to be transmitted. 0b - Host request is disabled 1b - Host request is enabled |

## 54.16.3.1.8 Configuration 1 (CFGR1)

## Offset

| Register   | Offset   |
|------------|----------|
| CFGR1      | 24h      |

## Function

CFGR1 should only be written when LPSPI is disabled.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28     | 27 26   | 25     | 24     | 23     | 22     | 21     | 20     | 19     | 18     | 17     | 16     |
|--------|------|------|------|--------|---------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| R      | 0    |      | 0    | PCSC   | OUTC FG |        | 0      | 0      | 0      | 0      | 0      | 0      |        |        |        |
| W      |      |      |      | FG     |         |        | PINCFG | PINCFG | PINCFG | PINCFG | PINCFG | PINCFG | MATCFG | MATCFG | MATCFG |
| Reset  | 0    | 0    | 0 0  | 0      | 0       | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| Bits   | 15   | 14   | 13   | 12     | 11 10   | 9      | 8      | 7      | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
| R      | 0    | 0    | 0    |        |         |        |        | 0      | 0      | 0      | PARTI  | NOST   | AUTO   | SAMP   | MAST   |
| W      |      |      |      | PCSPOL | PCSPOL  | PCSPOL | PCSPOL |        |        |        | AL     | ALL    | PCS    | LE     | ER     |
| Reset  | 0    | 0    | 0 0  | 0      | 0       | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-29 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 28 -         | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 27 PCSCFG    | Peripheral Chip Select Configuration When performing parallel transfers, PCSCFG must be configured to enable the desired transfer. 0b - PCS[3:2] are configured for chip select function 1b - PCS[3:2] are configured for half-duplex 4-bit transfers (PCS[3:2] = DATA[3:2])                                                                                                                                                                                                                                             |
| 26 OUTCFG    | Output Configuration Configures if the output data is tristated between accesses (PCS is negated). If performing half-duplex transfers, the Output Configuration bit must be set. 0b - Output data retains last value when chip select is negated 1b - Output data is tristated when chip select is negated                                                                                                                                                                                                              |
| 25-24 PINCFG | Pin Configuration Configures which pins are used for input and output data during serial transfers. When performing parallel transfers, the Pin Configuration field is ignored. 00b - SIN is used for input data and SOUT is used for output data 01b - SIN is used for both input and output data, only half-duplex serial transfers are supported 10b - SOUT is used for both input and output data, only half-duplex serial transfers are supported 11b - SOUT is used for input data and SIN is used for output data |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

## Table continued from the previous page...

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|--------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 23-19 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 18-16 MATCFG | Match Configuration Configures the condition that causes the DMF to set. Syntax: * is boolean AND, + is boolean OR NOTE 000b - Match is disabled 001b - Reserved 010b - Match is enabled is 1st data word is MATCH0 or MATCH1. Match is enabled, if 1st data word equals MATCH0 OR MATCH1, that is ( 1st data word = MATCH0 + MATCH1) 011b - Match is enabled on any data word equal MATCH0 or MATCH1. Match is enabled, if any data word equals MATCH0 OR MATCH1, that is ( any data word = MATCH0 + MATCH1) 100b - Match is enabled on data match sequence. Match is enabled, if 1st data word equals MATCH0 AND 2nd data word equals MATCH1, that is [( 1st data word = MATCH0) * ( 2nd data word = MATCH1)] 101b - Match is enabled on data match sequence. Match is enabled, if any data word equals MATCH0 AND the next data word equals MATCH1, that is [( any data word = MATCH0) * ( next data word = MATCH1)] 110b - Match is enabled. Match is enabled, if (1st data word AND MATCH1) equals (MATCH0 AND MATCH1), that is [( 1st data word * MATCH1) = (MATCH0 * MATCH1)] 111b - Match is enabled. Match is enabled, if (any data word AND MATCH1) equals (MATCH0 |
| 15-12 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 11-8 PCSPOL  | Peripheral Chip Select Polarity Configures the polarity of each Peripheral Chip Select pin. Each PCSPOL bit position (let's call it n ) corresponds to a PCS[ n ] pin. For example, PCSPOL[0] is chip select 0 (at PCS[0] pin), and PCSPOL[1] is chip select 1 (at PCS[1] pin). If a PCSPOL bit: • = 0, then the PCS[ n ] pin is active low. • = 1, then the PCS[ n ] pin is active high. The entire PCSPOLfield is not fully supported in every LPSPI module instance. Refer to the chip-specific information for LPSPI. NOTE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 7-5 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 4 PARTIAL | Partial Enable In Slave mode, when PCS negates then any partially received word can be either discarded or stored in the receive FIFO. 0b - Partial words in the receive shift register when PCS negates are discarded. 1b - Partial words in the receive shift register when PCS negates are stored in the receive FIFO.                                                                                                                                                                                                                                                                                                |
| 3 NOSTALL | No Stall In Master mode, LPSPI stalls transfers when the transmit FIFO is empty or when the receive FIFO is full, ensuring that no transmit FIFO underrun or receive FIFO overrun can occur. Setting the No Stall bit disables this functionality. 0b - Transfers stall when the transmit FIFO is empty or the receive FIFO is full 1b - Transfers do not stall, allowing transmit FIFO underruns or receive FIFO overruns to occur                                                                                                                                                                                      |
| 2 AUTOPCS | Automatic PCS For correct operations, the LPSPI slave normally requires the PCS to negate between frames. Setting the AUTOPCS bit causes LPSPI to generate an internal PCS signal at the end of each transfer word when the Clock Phase bit TCR[CPHA] = 1. • When the Automatic PCS bit is set, the SCK must remain idle for at least 4 LPSPI functional clock cycles (divided by the Prescaler Value TCR[PRESCALE] configuration) between each word, to ensure correct operations • In Master mode, the Automatic PCS bit is ignored 0b - Automatic PCS generation is disabled 1b - Automatic PCS generation is enabled |
| 1 SAMPLE  | Sample Point When set, the LPSPI master samples the input data on a delayed loopback SCK clock edge, which improves the setup time when sampling data. • The input data setup time in Master mode with delayed SCK edge is equal to the input data setup time in Slave mode • In Slave mode, the SAMPLE bit is ignored 0b - Input data is sampled on SCK edge 1b - Input data is sampled on delayed SCK edge                                                                                                                                                                                                             |
| 0 MASTER  | Master Mode Configures LPSPI in Master or Slave mode. The Master Mode bit directly controls the direction of the SCK and PCS pins. 0b - Slave mode 1b - Master mode                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

## 54.16.3.1.9 Data Match 0 (DMR0)

## Offset

| Register   | Offset   |
|------------|----------|
| DMR0       | 30h      |

## Function

For the Data Match register to be available, set CFGR0[RDMO] = 1. Do not change the value stored in DMR0 while CFGR0[RDMO] is enabled.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24     | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|--------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      | MATCH0 |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8      | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      |      |      |      |      |      |      |      | MATCH0 |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                         |
|---------|----------------------------------------------------------------------------------|
| 31-0    | Match 0 Value                                                                    |
| MATCH0  | When CFGR0[RDMO] = 1, the value in MATCH0 is compared against the received data. |

## 54.16.3.1.10 Data Match 1 (DMR1)

## Offset

| Register   | Offset   |
|------------|----------|
| DMR1       | 34h      |

## Function

The DMR1 register use depends on setting CFGR0[RDMO] = 1. Do not change the value stored in DMR1 while CFGR0[RDMO] is enabled.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24     | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|--------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      | MATCH1 |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8      | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    |      |      |      |      |      |      |      | MATCH1 |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                         |
|---------|----------------------------------------------------------------------------------|
| 31-0    | Match 1 Value                                                                    |
| MATCH1  | When CFGR0[RDMO] = 1, the value in MATCH1 is compared against the received data. |

## 54.16.3.1.11 Clock Configuration (CCR)

## Offset

| Register   | Offset   |
|------------|----------|
| CCR        | 40h      |

## Function

The Clock Configuration Register is only used in Master mode, and the Clock Configuration Register cannot be changed when LPSPI is enabled.

## Diagram

<!-- image -->

Low Latency Communication Engine (LLCE)

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                  |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 SCKPCS | SCK-to-PCS Delay In Master mode: configures the delay from the last SCK edge to the PCS negation. • The delay is equal to (SCKPCS + 1) cycles of the LPSPI functional clock divided by the Prescaler Value TCR[PRESCALE] configuration. • The minimum delay is 1 cycle. See Figure 480.   |
| 23-16 PCSSCK | PCS-to-SCK Delay In Master mode: configures the delay from the PCS assertion to the first SCK edge. • The delay is equal to (PCSSCK + 1) cycles of the LPSPI functional clock divided by the Prescaler Value TCR[PRESCALE] configuration. • The minimum delay is 1 cycle. See Figure 480. |
| 15-8 DBT     | Delay Between Transfers Writing this field updates the contents of CCR1[PCSPCS] and CCR1[SCKSCK].                                                                                                                                                                                         |
| 7-0 SCKDIV   | SCK Divider Writing this field updates the contents of CCR1[SCKSET] and CCR1[SCKHLD].                                                                                                                                                                                                     |

## 54.16.3.1.12 Clock Configuration 1 (CCR1)

## Offset

| Register   | Offset   |
|------------|----------|
| CCR1       | 44h      |

## Function

The Clock Configuration Register 1 is only used in Master mode, and the Clock Configuration Register cannot be changed when LPSPI is enabled.

## Diagram

<!-- image -->

| Bits   | 31     | 30     | 29     | 28     | 27     | 26     | 25     | 24     | 23     | 22     | 21     | 20     | 19     | 18     | 17     | 16     |
|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| R W    | SCKSCK | SCKSCK | SCKSCK | SCKSCK | SCKSCK | SCKSCK | SCKSCK | SCKSCK | PCSPCS | PCSPCS | PCSPCS | PCSPCS | PCSPCS | PCSPCS | PCSPCS | PCSPCS |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| Bits   | 15     | 14     | 13     | 12     | 11     | 10     | 9      | 8      | 7      | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
| R W    | SCKHLD | SCKHLD | SCKHLD | SCKHLD | SCKHLD | SCKHLD | SCKHLD | SCKHLD | SCKSET | SCKSET | SCKSET | SCKSET | SCKSET | SCKSET | SCKSET | SCKSET |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 SCKSCK | SCK Inter-Frame Delay In Master mode: • Configures the delay from the last SCK pulse of a frame and the first SCK pulse of the following frame, in a continuous transfer. • The delay is equal to (SCKSCK + 1) cycles of the LPSPI functional clock divided by the Prescaler Value TCR[PRESCALE] configuration. • The minimum delay is 1 cycle. For backwards compatibility, writing CCR[DBT] updates CCR1[SCKSCK] with the value written. NOTE                                                                                                                                                                                                                                                                                                                                                                                     |
| 23-16 PCSPCS | PCS to PCS delay In Master mode: • Configures the delay from the PCS negation to the next PCS assertion. • The delay is equal to (PCSPCS + PCSPCS + 2) cycles of the LPSPI functional clock divided by the Prescaler Value TCR[PRESCALE] configuration. • The minimum delay is 2 cycles. • Half of the delay (PCSPCS + 1) occurs before PCS assertion and the other half of the delay (PCSPCS + 1) occurs after PCS negation. If the command word is updated between 2 transfers, then the command word is updated half-way between the PCS negation of the last transfer and PCS assertion of the next transfer. • The command word sets which PCS signal is used, the polarity/phase of the SCK signal, and the Prescaler Value. For backwards compatibility, writing CCR[DBT] updates CCR1[PCSPCS] with (DBT/2) rounded up. NOTE |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

Table continued from the previous page...

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-8 SCKHLD | SCK Hold In Master mode, the SCK Hold configures the hold phase of the SCK pin. • The hold phase is the delay between the SCK edge that samples the receive data and the SCK edge that drives the transmit data. • This is the SCK low period for CPHA=0, CPOL=1 and CPHA=1, CPOL =0 and the SCK high period for CPHA=0, CPOL=0 and CPHA=1, CPOL=1. • The SCK hold phase delay is equal to (SCKHLD + 1) cycles of the LPSPI functional clock divided by the Prescaler Value TCR[PRESCALE] configuration. • The minimum delay is 1 cycle. • The SCK period is equal to (SCKSET + SCKHLD + 2) cycles of the LPSPI functional clock divided by the Prescaler Value TCR[PRESCALE] configuration. • The SCK duty cycle is based on the difference between SCKSET and SCKHLD, configure both fields to the same value for 50/50 duty cycle. See Figure 480. For backwards compatibility, writing CCR[SCKDIV] updates CCR1[SCKHLD] with (SCKDIV/2) rounded down. NOTE    |
| 7-0 SCKSET  | SCK Setup In Master mode, the SCK Setup configures the setup phase of the SCK pin. • The setup phase is the delay between the SCK edge that drives the transmit data and the SCK edge that samples the receive data. • This is the SCK high period for CPHA=0, CPOL=1 and CPHA=1, CPOL =0 and the SCK low period for CPHA=0, CPOL=0 and CPHA=1, CPOL=1. • The SCK setup phase delay is equal to (SCKSET + 1) cycles of the LPSPI functional clock divided by the Prescaler Value TCR[PRESCALE] configuration. • The minimum delay is 1 cycle. • The SCK period is equal to (SCKSET + SCKHLD + 2) cycles of the LPSPI functional clock divided by the Prescaler Value TCR[PRESCALE] configuration. • The SCK duty cycle is based on the difference between SCKSET and SCKHLD, configure both fields to the same value for 50/50 duty cycle. See Figure 480. For backwards compatibility, writing CCR[SCKDIV] updates CCR1[SCKSET] with (SCKDIV/2) rounded up. NOTE |

## 54.16.3.1.13 FIFO Control (FCR)

## Offset

| Register   | Offset   |
|------------|----------|
| FCR        | 58h      |

## Function

Contains the RXWATER and TXWATER control fields.

## Diagram

<!-- image -->

## Fields

| Field         | Function                                                                                                                                                                                                                |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 -       | Reserved                                                                                                                                                                                                                |
| 23-18 -       | Reserved                                                                                                                                                                                                                |
| 17-16 RXWATER | Receive FIFO Watermark The Receive Data Flag is set whenever the number of words in the receive FIFO is greater than RXWATER. Writing a value equal or greater than the FIFO size truncates the written value.          |
| 15-8 -        | Reserved                                                                                                                                                                                                                |
| 7-2 -         | Reserved                                                                                                                                                                                                                |
| 1-0 TXWATER   | Transmit FIFO Watermark The Transmit Data Flag is set whenever the number of words in the transmit FIFO is equal or less than TXWATER. Writing a value equal or greater than the FIFO size truncates the written value. |

## 54.16.3.1.14 FIFO Status (FSR)

## Offset

| Register   | Offset   |
|------------|----------|
| FSR        | 5Ch      |

## Function

Contains the TXCOUNT and RXCOUNT fields, which hold the number of words currently stored in the FIFO.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23        | 22        | 21        | 20        | 19        | 18        | 17        | 16        |
|--------|------|------|------|------|------|------|------|------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0 RXCOUNT | 0 RXCOUNT | 0 RXCOUNT | 0 RXCOUNT | 0 RXCOUNT | 0 RXCOUNT | 0 RXCOUNT | 0 RXCOUNT |
| W      |      |      |      |      |      |      |      |      |           |           |           |           |           |           |           |           |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7         | 6         | 5         | 4         | 3         | 2         | 1         | 0         |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0         | 0         | 0         | 0         | 0         | TXCOUNT   | TXCOUNT   | TXCOUNT   |
| W      |      |      |      |      |      |      |      |      |           |           |           |           |           |           |           |           |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         |

## Fields

| Field         | Function                                                                               |
|---------------|----------------------------------------------------------------------------------------|
| 31-24 -       | Reserved                                                                               |
| 23-19 -       | Reserved                                                                               |
| 18-16 RXCOUNT | Receive FIFO Count Returns the number of words currently stored in the receive FIFO.   |
| 15-8 -        | Reserved                                                                               |
| 7-3 -         | Reserved                                                                               |
| 2-0 TXCOUNT   | Transmit FIFO Count Returns the number of words currently stored in the transmit FIFO. |

## 54.16.3.1.15 Transmit Command (TCR)

## Offset

| Register   | Offset   |
|------------|----------|
| TCR        | 60h      |

## Function

Writes to either the Transmit Command Register or Transmit Data Register pushes the data into the transmit FIFO, in the order that the data are written. The Command Register should only be written using 32-bit writes. Command Register writes are tagged and cause the command register to update, after that entry reaches the top of the FIFO and the LPSPI is enabled. This allows changes to the command word and the transmit data itself to be interleaved. That is, the writes to the two registers can be interleaved (write command word, then data word, then command word, and so on). Changing the command word causes all subsequent SPI bus transfers to be performed using the new command word.

- In Master mode, writing a new command word does not initiate a new transfer, unless TXMSK is set. Transfers are initiated by transmit data in the transmit FIFO, or by a new command word (with TXMSK set). Hardware clears TXMSK when the PCS negates.
- In Master mode, if the command word is changed before an existing frame has completed, then the existing frame terminates and the command word then updates. The command word can be changed during a continuous transfer, if CONTC of the new command word is set and the command word is written on a frame size boundary.
- In Slave mode, the command word should be changed only when LPSPI is idle and there is no SPI bus transfer.

Avoid reseting the Transmit FIFO after writing to the Transmit Command Register, wait for the command register to update from the FIFO first.

Avoid register reading problems: Reading the Transmit Command Register returns the current state of the command register. Reading the Transmit Command Register at the same time that the Transmit Command Register is loaded from the transmit FIFO, can return an incorrect Transmit Command Register value. It is recommended:

- Read the Transmit Command Register when the transmit FIFO is empty,
- Read the Transmit Command Register more than once and then compare the returned values.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29       | 28       | 27                 | 26                 | 25                 | 24                 | 23                 | 22                 | 21                 | 20                 | 19                 | 18                 | 17                 | 16                 |
|--------|------|------|----------|----------|--------------------|--------------------|--------------------|--------------------|--------------------|--------------------|--------------------|--------------------|--------------------|--------------------|--------------------|--------------------|
| R W    | CPOL | CPHA | PRESCALE | PRESCALE | PRESCALE           | Reserv ed          | PCS                | PCS                | LSBF               | BYSW               | CONT               | CONT C             | RXMS K             | TXMS K             | WIDTH              | WIDTH              |
| Reset  | 0    | 0    | 0        | 0        | 0                  | 0                  | 0                  | 0                  | 0                  | 0                  | 0                  | 0                  | 0                  | 0                  | 0                  | 0                  |
| Bits   | 15   | 14   | 13       | 12       | 11                 | 10                 | 9                  | 8                  | 7                  | 6                  | 5                  | 4                  | 3                  | 2                  | 1                  | 0                  |
|        |      |      |          |          | R Reserved FRAMESZ | R Reserved FRAMESZ | R Reserved FRAMESZ | R Reserved FRAMESZ | R Reserved FRAMESZ | R Reserved FRAMESZ | R Reserved FRAMESZ | R Reserved FRAMESZ | R Reserved FRAMESZ | R Reserved FRAMESZ | R Reserved FRAMESZ | R Reserved FRAMESZ |
| W      | 0    | 0    | 0        | 0        |                    |                    |                    |                    |                    |                    |                    |                    |                    |                    |                    |                    |
| Reset  | 0    | 0    | 0        | 0        | 0                  | 0                  | 0                  | 0                  | 0                  | 0                  | 0                  | 1                  | 1                  | 1                  | 1                  | 1                  |

Low Latency Communication Engine (LLCE)

## Fields

| Field          | Function                                                                                                                                                                                                                                                                                                                                 |
|----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 CPOL        | Clock Polarity The Clock Polarity field is only updated when PCS negated. See Figure 480. 0b - The inactive state value of SCK is low 1b - The inactive state value of SCK is high                                                                                                                                                       |
| 30 CPHA        | Clock Phase The Clock Phase field is only updated when PCS negated. See Figure 480. 0b - Captured. Data is captured on the leading edge of SCK and changed on the following edge of SCK 1b - Changed. Data is changed on the leading edge of SCK and captured on the following edge of SCK                                               |
| 29-27 PRESCALE | Prescaler Value For all SPI bus transfers, the Prescaler value applied to the clock configuration register. The Prescaler Value field is only updated when PCS negated. 000b - Divide by 1 001b - Divide by 2 010b - Divide by 4 011b - Divide by 8 100b - Divide by 16 101b - Divide by 32 110b - Divide by 64 111b - Divide by 128     |
| 26 -           | Reserved                                                                                                                                                                                                                                                                                                                                 |
| 25-24 PCS      | Peripheral Chip Select Configures the peripheral chip select used for the transfer. The Peripheral Chip Select field is only updated when PCS negated. The entire PCS field is not fully supported in every LPSPI module instance. See the chip-specific LPSPI information. NOTE 00b - Transfer using PCS[0] 01b - Transfer using PCS[1] |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|          | 10b - Transfer using PCS[2] 11b - Transfer using PCS[3]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 23 LSBF  | LSB First 0b - Data is transferred MSB first 1b - Data is transferred LSB first                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 22 BYSW  | Byte Swap Byte swap swaps the contents of [31:24] with [7:0] and [23:16] with [15:8] for each transmit data word read from the FIFO and for each received data word stored to the FIFO (or compared with match registers). 0b - Byte swap is disabled 1b - Byte swap is enabled                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 21 CONT  | Continuous Transfer • In Master mode, CONT keeps the PCS asserted at the end of the frame size, until a command word is received that starts a new frame. • In Slave mode, when CONT is enabled, LPSPI only transmits the first FRAMESZ bits; after which LPSPI transmits received data (assuming a 32-bit shift register) until the next PCS negation. 0b - Continuous transfer is disabled 1b - Continuous transfer is enabled                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 20 CONTC | Continuing Command In Master mode, the CONTC bit allows the command word to be changed within a continuous transfer. • The initial command word must enable continuous transfer (CONT = 1), • the continuing command must set this bit (CONTC = 1), • and the continuing command word must be loaded on a frame size boundary. For example, if the continuous transfer has a frame size of 64-bits, then a continuing command word must be loaded on a 64-bit boundary. In Slave mode, the Continuing Command bit modifies the internal RXMSK/TXMSK configuration after the first FRAMESZ bits and until the PCS negation. • Receive data is discarded after the first FRAMESZ bits, if CONT is also set this does not block the transmission of received data. • Transmit data is not masked after the first FRAMESZ bits, this allows the first FRAMESZ bits to be received and a response transmitted. 0b - Command word for start of new transfer 1b - Command word for continuing transfer |
| 19       | Receive Data Mask When set, receive data is masked (receive data is not stored in receive FIFO).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

Table continues on the next page...

## Table continued from the previous page...

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| RXMSK        | 0b - Normal transfer 1b - Receive data is masked                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 18 TXMSK     | Transmit Data Mask When set, transmit data is masked (no data is loaded from transmit FIFO and output pin is tristated). In Master mode, the TXMSK bit initiates a new transfer which cannot be aborted by another command word; the TXMSK bit is cleared by hardware at the end of the transfer. 0b - Normal transfer 1b - Mask transmit data                                                                                                                                                                                                                                         |
| 17-16 WIDTH  | Transfer Width Configures between serial (1-bit) or parallel transfers. For half-duplex parallel transfers, either Receive Data Mask (RXMSK) or Transmit Data Mask (TXMSK) must be set. 00b - 1 bit transfer 01b - 2 bit transfer 10b - 4 bit transfer 11b - Reserved                                                                                                                                                                                                                                                                                                                  |
| 15-12 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 11-0 FRAMESZ | Frame Size Configures the frame size in number of bits equal to (FRAMESZ + 1). • The minimum frame size is 8 bits • If the frame size is larger than 32 bits, then the frame is divided into multiple words of 32-bits; each word is loaded from the transmit FIFO and stored in the receive FIFO separately. • If the size of the frame is not divisible by 32, then the last load of the transmit FIFO and store of the receive FIFO contains the remainder bits. For example, a 72-bit transfer consists of 3 words: the 1st and 2nd words are 32 bits, and the 3rd word is 8 bits. |

## 54.16.3.1.16 Transmit Data (TDR)

## Offset

| Register   | Offset   |
|------------|----------|
| TDR        | 64h      |

## Function

Writes to either the Transmit Command Register or Transmit Data Register push the data into the transmit FIFO, in the order that the data was written. The Data Register can be written using 32-bit, 16-bit, or 8-bit writes, but each write pushes data into the FIFO with zero pushed in unwritten bytes.

## Diagram

Low Latency Communication Engine (LLCE)

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W      | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W      | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                    |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Transmit Data                                                                                                                                                                                                                                                                               |
| DATA    | Both 8-bit and 16-bit writes of transmit data zero-extend the data written and push the data into the transmit FIFO. To zero-extend 8-bit and 16-bit writes (to 32 bits), means that the higher order (most significant) empty parts of the 8-bit and 16-bit writes are filled with zeroes. |

## 54.16.3.1.17 Receive Status (RSR)

## Offset

| Register   | Offset   |
|------------|----------|
| RSR        | 70h      |

## Function

Contains data flow status fields for receive FIFO.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17       | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|----------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0        | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |          |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0        | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1        | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | RXEM PTY | SOF  |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |          |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 1        | 0    |

## Fields

| Field     | Function                                                                                                                                                                                         |
|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-2 -    | Reserved                                                                                                                                                                                         |
| 1 RXEMPTY | RX FIFO Empty 0b - RX FIFO is not empty 1b - RX FIFO is empty                                                                                                                                    |
| 0 SOF     | Start Of Frame Indicates that this is the first data word received after PCS assertion. 0b - Subsequent data word received after PCS assertion 1b - First data word received after PCS assertion |

## 54.16.3.1.18 Receive Data (RDR)

## Offset

| Register   | Offset   |
|------------|----------|
| RDR        | 74h      |

## Function

Pulls the first entry from the receive FIFO.

## Diagram

<!-- image -->

## Fields

| Field   | Function     |
|---------|--------------|
| 31-0    | Receive Data |
| DATA    |              |

## 54.16.3.1.19 Receive Data Read Only (RDROR)

## Offset

| Register   | Offset   |
|------------|----------|
| RDROR      | 78h      |

## Function

Returns the first entry in the receive FIFO, but does not pull the data from the FIFO.

## Diagram

<!-- image -->

## Fields

| Field   | Function     |
|---------|--------------|
| 31-0    | Receive Data |
| DATA    |              |

## 54.16.3.1.20 Transmit Command Burst (TCBR)

## Offset

| Register   | Offset   |
|------------|----------|
| TCBR       | 3FCh     |

## Function

The Transmit Command Burst Register is an alias of the Transmit Command Register designed to support burst transfers to the transmit FIFO for use with the DMA controller.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W      | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W      | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                          |
|---------|---------------------------------------------------|
| 31-0    | Command Data                                      |
| DATA    | Data is written to the Transmit Command Register. |

## 54.16.3.1.21 Transmit Data Burst (TDBR0 - TDBR127)

## Offset

For n = 0 to 127:

| Register   | Offset          |
|------------|-----------------|
| TDBRn      | 400h + (n × 4h) |

## Function

The Transmit Data Burst Register is an alias of the Transmit Data Register designed to support burst transfers to the transmit FIFO for use with the DMA controller. The size of the Transmit Data Burst Register is 512-bytes.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W      | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W      | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

Low Latency Communication Engine (LLCE)

## Fields

| Field   | Function                                       |
|---------|------------------------------------------------|
| 31-0    | Data                                           |
| DATA    | Data is written to the Transmit Data Register. |

## 54.16.3.1.22 Receive Data Burst (RDBR0 - RDBR127)

## Offset

For n = 0 to 127:

| Register   | Offset          |
|------------|-----------------|
| RDBRn      | 600h + (n × 4h) |

## Function

The Receive Data Burst Register is an alias of the Receive Data Register designed to support burst transfers from the receive FIFO. The size of the Receive Data Burst Register is 512-bytes.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA | DATA |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                     |
|---------|----------------------------------------------|
| 31-0    | Data                                         |
| DATA    | Data is read from the Receive Data Register. |

## 54.16.4 Functional description

## 54.16.4.1 Master mode

## 54.16.4.1.1 Transmit and Command FIFO commands

The transmit and command FIFO is a combined FIFO that includes both transmit data words and command words.

Low Latency Communication Engine (LLCE)

- Transmit data words are stored to the transmit/command FIFO, by writing the Transmit Data (TDR).
- Command words are stored to the transmit/command FIFO, by writing the Transmit Command (TCR).

When a command word is at the top of the transmit/command FIFO, the actions that can occur depend upon whether the LPSPI module is either busy or between frames. See Continuous Transfer bit, TCR[CONT] and Continuing Command bit, TCR[CONTC]

Table 413. Possible actions when a command word is at the top of the transmit/command FIFO

| Condition                                                                                  | Action                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|--------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| If LPSPI is enabled and between frames                                                     | then the command word is pulled from the FIFO, and that command word controls all subsequent transfers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| If LPSPI is busy and the Continuing Command bit (TCR[CONTC]) is cleared                    | then the SPI frame completes at the end of the existing word, ignoring the FRAMESZ configuration. The command word is then pulled from the FIFO and that command word controls all subsequent transfers (or until the next update to the command word). Note that a command word with TCR[CONTC] = 0 always terminates (stop) the existing transfer regardless of the previous TCR[CONT] value.                                                                                                                                                                                                                      |
| If LPSPI is busy and the existing TCR[CONT] bit is set and the new TCR[CONTC] value is set | then the command word must be updated at the frame boundary. The command word is pulled from the FIFO during the last SCK pulse of the existing frame (based on the FRAMESZ configuration), and the frame continues using the new command value for the rest of the frame (or until the next update to the command word). When TCR[CONTC] is set, only the lower 24-bits of the command word are updated. If the command word is updated at a word boundary, then the transfer halts (stops) after that word. Essentially the TCR[CONTC] bit is ignored when not at a frame boundary, so the frame ends prematurely. |

About TCR[CONT] and TCR[CONTC]:

- TCR[CONT] = 1 is used to keep PCS asserted at end of frame, allowing the transfer to continue.
- TCR[CONTC] = 1 is used to indicate that this command word should not terminate the existing frame, and the transfer can continue using the new command word.

TCR[CONTC] = 1 is restricted in the sense that the new command must load on a frame boundary, and the only way for a transfer to continue from a frame boundary, is when the previous command has TCR[CONT] = 1.

The current state of the existing command word is read from Transmit Command (TCR). It requires at least 3 LPSPI functional clock cycles for TCR to update after TCR is written (assuming an empty FIFO) and LPSPI must be enabled ( CR[MEN] bit is set).

Writing the TCR does not initiate a SPI bus transfer, unless the TCR[TXMSK] = 1. When the TCR[TXMSK] bit is set, a new command word is not be loaded until the end of the existing frame (based on FRAMESZ configuration); at the end of the transfer, the TCR[TXMSK] bit clears.

In master mode, the LPSPI command word in TCR controls SPI attributes (using bits and fields in registers).

Table 414. LPSPI Command Word in Master mode

| Transmit Command (TCR)   | Transmit Command (TCR)   | Description                                                                                              | Can this field be modified during a data transfer?   |
|--------------------------|--------------------------|----------------------------------------------------------------------------------------------------------|------------------------------------------------------|
| Field                    | Name                     |                                                                                                          |                                                      |
| CPOL                     | Clock Polarity           | Configures the polarity of the SCK pin. Any change of CPOL value will cause a transition on the SCK pin. | N                                                    |
| CPHA                     | Clock Phase              | Configures the clock phase of the transfer.                                                              | N                                                    |

Table continues on the next page...

Table 414. LPSPI Command Word in Master mode (continued)

| Transmit Command (TCR)   | Transmit Command (TCR)   | Description                                                                                                                                                                                                                                                                                                                          | Can this field be modified during a data transfer?   |
|--------------------------|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
| Field                    | Name                     |                                                                                                                                                                                                                                                                                                                                      |                                                      |
| PRESCALE                 | Prescaler Value          | Configures a prescaler used to divide the LPSPI functional clock, to generate the timing parameters of the SPI bus transfer. Changing PRESCALE in conjunction with PCS enables the LPSPI module to connect to different slave devices at different frequencies.                                                                      | N                                                    |
| PCS                      | Peripheral Chip Select   | Configures which PCS asserts for the transfer; the polarity of PCS is static and configured by CFGR1[PCSPOL]. If CFGR1[PCSCFG] = 1. then PCS[3:2] should not be selected.                                                                                                                                                            | N                                                    |
| LSBF                     | LSB First                | Configures if LSB (bit 0) or MSB (bit 31 for a 32-bit word) is transmitted or received first.                                                                                                                                                                                                                                        | Y                                                    |
| BYSW                     | Byte Swap                | Enables byte swap on each 32-bit word when transmitting and receiving data. Byte swapping can be useful when interfacing to devices that organize data as big-endian.                                                                                                                                                                | Y                                                    |
| CONT                     | Continuous Transfer      | Configures for a continuous transfer that keeps PCS asserted between frames (as configured by FRAMESZ). A new command word is required to cause PCS to negate. Also supports changing the command word at the frame size boundaries.                                                                                                 | Y                                                    |
| CONTC                    | Continuing Command       | Indicates that this is a new command word for the existing continuous transfer. The CONTC bit when set must only be written to the transmit/ command FIFO on a frame boundary.                                                                                                                                                       | Y                                                    |
| RXMSK                    | Receive Data Mask        | Masks the receive data and does not store the masked receive data to the receive FIFO or perform receive data matching. Useful for half-duplex transfers or to configure which fields are compared during receive data matching.                                                                                                     | Y                                                    |
| TXMSK                    | Transmit Data Mask       | Masks the transmit data, so that masked transmit data is not pulled from transmit FIFO, and the output data pin is tristated (unless configured by CFGR1[OUTCFG]). Useful for half-duplex transfers.                                                                                                                                 | Y                                                    |
| WIDTH                    | Transfer Width           | Configures the number of bits shifted on each SCK pulse. • 1-bit transfers support traditional SPI bus transfers in either half- duplex or full-duplex data formats. • 2-bit and 4-bit half-duplex transfers are useful for interfacing to QuadSPI memory devices, and at least one bit (TCR[TXMSK] or TCR[RXMSK]) must also be set. | Y                                                    |
| FRAMESZ                  | Frame Size               | Configures the frame size in number of bits equal to (FRAMESZ + 1). • The minimum frame size is 8 bits. • If the frame size is larger than 32 bits, then the frame is divided into multiple words of 32-bits; each word is loaded from the transmit FIFO and stored in the receive FIFO separately.                                  | Y                                                    |

Table continues on the next page...

Table 414. LPSPI Command Word in Master mode (continued)

| Transmit Command (TCR)   | Transmit Command (TCR)   | Description                                                                                                                                                                                                                                                                    | Can this field be modified during a data transfer?   |
|--------------------------|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
| Field                    | Name                     |                                                                                                                                                                                                                                                                                |                                                      |
|                          |                          | • If the size of the frame is not divisible by 32, then the last load of the transmit FIFO and store of the receive FIFO will contain the remainder bits. For example, a 72-bit transfer will consist of 3 words: the 1st and 2nd words are 32-bit, and the 3rd word is 8-bit. |                                                      |

## SPI bus transfers:

- LPSPI initiates a SPI bus transfer when all conditions are true:
- Data is written to the transmit FIFO
- And the HREQ pin is asserted (or the HREQ function is disabled)
- And LPSPI is enabled
- To perform the SPI bus transfer, LPSPI uses the attributes configured in Transmit Command (TCR) and uses the timing parameters in Clock Configuration (CCR).
- The SPI bus transfer ends after the FRAMESZ configuration is reached (provided CONT=0), or at the end of a word when a new transmit command word is at the top of the transmit/command FIFO. When LPSPI is disabled, the SPI bus transfers end after the transmit FIFO is empty and LPSPI is idle.
- The HREQ input is only checked when PCS is negated.

Circular FIFO: The transmit/command FIFO also supports a Circular FIFO feature, which enables the LPSPI master to (periodically) repeat a short data transfer that fits within the transmit/command FIFO, without requiring additional FIFO accesses. When the circular FIFO is enabled (CFGR0[CIRFIFO] = 1), the current state of the FIFO read pointer is saved and the status flags do not update. After the transmit/command FIFO is considered empty and LPSPI is idle, the FIFO read pointer is restored with the saved version, so the contents of the transmit/command FIFO are not permanently pulled from the FIFO while circular FIFO mode is enabled.

## 54.16.4.1.2 Receive FIFO and Data Match

The receive FIFO stores receive data during SPI bus transfers. When TCR[RXMSK] = 1, the receive data is discarded instead of being stored in the receive FIFO.

- The receive data is written to the receive FIFO when the last bit of the word is sampled.
- If the transmit FIFO is empty during a multiple word or continuous transfer, then the receive data is written to the receive FIFO before the transfer stalls (assuming CFGR1[NOSTALL] is clear) while waiting for new transmit data or command word to be written.

Receive data supports a receive data match function that can match received data against one of two words in the DMR0 and DMR1 registers or against a masked data word. The receive data match function can also be configured to compare only the first one or two received data words since the start of the frame.

- Received data that is already discarded due to the TCR[RXMSK] bit cannot cause the data match to set, and delays the receive data match on the first received data word, until all discarded data is received.
- The receive data match function can also be configured to discard all received data until a data match is detected, using the CFGR0[RDMO] bit.
- After a receive data match, to allow all subsequent data to be received, clear the CFGR0[RDMO] bit, then clear the SR[DMF] bit.

## 54.16.4.1.3 Timing parameters

The timing parameters that are used for all SPI bus transfers are relative to the LPSPI functional clock divided by the PRESCALE configuration. Although the Clock Configuration (CCR) cannot be changed when the LPSPI module is busy, to support interfacing to different slave devices at different frequencies, the TCR[PRESCALE] configuration can be changed between SPI bus transfers using the Transmit Command Register (TCR).

## NOTE

The minimum value below is the minimum counter value, but the clock configuration register values must also satisfy the datasheet specs based on the LPSPI functional clock frequency and prescaler value.

## Table 415. LPSPI timing parameters

| Clock Configuration (CCR) Clock Configuration 1 (CCR1)   | Clock Configuration (CCR) Clock Configuration 1 (CCR1)   | Description                                                                                                                                                                                                                                                                                                | Min          | Max              |
|----------------------------------------------------------|----------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|------------------|
| Field                                                    | Name                                                     |                                                                                                                                                                                                                                                                                                            |              |                  |
| SCKSET                                                   | SCK Setup Phase                                          | Configures the SCK setup phase to (SCKSET + 1) cycles. The setup phase is the SCK high period when either CPHA = 0, CPOL = 1 or CPHA = 1, CPOL = 0, otherwise is it the SCK low period. The SCK period is defined as (SCKSET + SCKHLD + 2) and the duty cycle is the difference between SCKSET and SCKHLD. | 0 (1 cycle)  | 255 (256 cycles) |
| SCKHLD                                                   | SCK Hold Phase                                           | Configures the SCK hold phase to (SCKHLD + 1) cycles. The hold phase is the SCK low period when either CPHA = 0, CPOL = 1 or CPHA = 1, CPOL = 0, otherwise it is the SCK high period. The SCK period is defined as (SCKSET + SCKHLD + 2) and the duty cycle is the difference between SCKSET and SCKHLD.   | 0 (1 cycle)  | 255 (256 cycles) |
| PCSPCS                                                   | PCS to PCS Delay                                         | Configures the minimum delay between PCS negation and the next PCS assertion to (PCSPCS + PCSPCS + 2) cycles. When the command word is updated between transfers, there is a minimum of (PCSPCS + 1) cycles between the command word update and any change on PCS pins.                                    | 0 (2 cycles) | 255 (512 cycles) |
| SCKSCK                                                   | SCK to SCK Delay                                         | Configures the delay during a continuous transfer between the last SCK edge of a frame and the first SCK edge of the continuing frame to (SCKSCK + 1) cycles. This is useful when the external slave requires a large delay between different words of an SPI bus transfer.                                | 0 (1 cycle)  | 255 (256 cycles) |
| PCSSCK                                                   | PCS-to-SCK Delay                                         | Configures the minimum delay between PCS assertion and the first SCK edge to (PCSSCK + 1) cycles.                                                                                                                                                                                                          | 0 (1 cycle)  | 255 (256 cycles) |
| SCKPCS                                                   | SCK-to-PCS Delay                                         | Configures the minimum delay between the last SCK edge and the PCS assertion to (SCKPCS + 1) cycles.                                                                                                                                                                                                       | 0 (1 cycle)  | 255 (256 cycles) |

This figure shows the timing settings controlled by TCR[CPHA], TCR[CPOL], CCR[SCKPCS], CCR[PCSSCK], CCR1[SCKSET], and CCR1[SCKHLD].

Low Latency Communication Engine (LLCE)

Figure 480. Clock Phase (TCR[CPHA]) timing diagram example

Low Latency Communication Engine (LLCE)

<!-- image -->

## 54.16.4.1.4 Pin configuration

- To swap directions or support half-duplex transfers on the same pin, the SIN and SOUT pins can be configured using CFGR1[PINCFG].
- To determine if an output data pin (like SOUT) tristates when PCS is negated, or if the output data pin simply retains the last value, use CFGR1[PCSCFG].
- When configuring for half-duplex transfers the output data pins must be configured to tristate when PCS is negated; use CFGR1[OUTCFG] CFGR1[OUTCFG].
- When performing half-duplex 2-bit transfers, CFGR1[PCSCFG] can be set to any value.
- When performing half-duplex 4-bit transfers, CFGR1[PCSCFG] must equal 0x1.

## 54.16.4.1.5 Clock loopback

Configure the LPSPI master to use either the output clock or a loopback clock to sample the receive data (for example, SIN). Use one of these these clocks to sample the input data:

- The SCK output clock directly
- A delayed version of the SCK output clock

The delayed version of the SCK is chosen by the SCK pin output delay, plus the SCK pin input delay, and is configured by setting CFGR1[SAMPLE]. Enabling the loopback version of the SCK can improve the setup time of the input data from the slave.

<!-- image -->

See the chip data sheet for the specific input setup time in master loopback mode.

## 54.16.4.2 Slave mode

LPSPI slave mode:

- Uses the same shift register and logic that master mode uses
- Does not use the Clock Configuration Register (CCR)
- During SPI bus transfers, requires that the Transmit Command (TCR) register remain static (unchanging)

## 54.16.4.2.1 Transmit and Command FIFO commands

Before enabling LPSPI in slave mode, initialize the Transmit Command (TCR) register, although the TCR register does not update until after LPSPI is enabled. After being enabled, the TCR register should only be changed if LPSPI is idle. In slave mode, the LPSPI command word in TCR controls SPI attributes. Before the PCS input asserts, the transmit FIFO must be filled with transmit data, or the transmit error flag sets.

Table 416. LPSPI Command Word in Slave mode

| Transmit Command (TCR)   | Transmit Command (TCR)   | Description                                                                                  |
|--------------------------|--------------------------|----------------------------------------------------------------------------------------------|
| Field                    | Name                     | Description                                                                                  |
| CPOL                     | Clock Polarity           | Configures the polarity of the external SCK input.                                           |
| CPHA                     | Clock Phase              | Configures the clock phase of transfer.                                                      |
| PRESCALE                 | Prescaler Value          | Configures the LPSPI functional clock prescaler.                                             |
| PCS                      | Peripheral Chip Select   | Configures which PCS is used, the polarity of PCS is static and configured by CFGR1[PCSPOL]. |

Table continues on the next page...

Low Latency Communication Engine (LLCE)

Table 416. LPSPI Command Word in Slave mode (continued)

| Transmit Command (TCR)   | Transmit Command (TCR)   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|--------------------------|--------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Field                    | Name                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                          |                          | If CFGR1[PCSCFG] is not equal to zero, then PCS[3:2] pins should not be selected.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| LSBF                     | LSB First                | Configures if LSB (bit 0) or MSB (bit 31 for a 32-bit word) is transmitted or received first.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| BYSW                     | Byte Swap                | Enables byte swap on each 32-bit word when transmitting and receiving data. Byte swapping can be useful when interfacing to devices that organize data as big-endian.                                                                                                                                                                                                                                                                                                                                                                                                              |
| CONT                     | Continuous Transfer      | When Continuous Transfer is set in slave mode and after the first FRAMESZ bits are transferred, the LPSPI will passthrough and transmit the received data until the next PCS negation. Whatever is shifted in on the receive data is shifted out as transmit data as if there was a 32-bit shift register.                                                                                                                                                                                                                                                                         |
| CONTC                    | Continuing Command       | When Continuing Command is set in slave mode and after the first FRAMESZ bits are transferred, then RXMSK will be considered set and TXMSK will be considered clear until the next PCS negation. CONTC can be used to flip the direction of a transfer after the first FRAMESZ bits.                                                                                                                                                                                                                                                                                               |
| RXMSK                    | Receive Data Mask        | Masks the receive data and does not store the masked receive data to the receive FIFO or perform receive data matching. Useful for half-duplex transfers or to configure which fields are compared during receive data matching.                                                                                                                                                                                                                                                                                                                                                   |
| TXMSK                    | Transmit Data Mask       | Masks the transmit data, so that the masked transmit data is not pulled from transmit FIFO, and the output data pin is tristated (unless configured by CFGR1[OUTCFG]). Useful for half-duplex transfers.                                                                                                                                                                                                                                                                                                                                                                           |
| WIDTH                    | Transfer Width           | Configures the number of bits shifted on each SCK pulse. • 1-bit transfers support traditional SPI bus transfers in either half-duplex or full- duplex data formats. • 2-bit and 4-bit half-duplex transfers are useful for interfacing to QuadSPI memory devices, and at least one bit (Transmit Data Mask (TCR[TXMSK] or Receive Data Mask TCR[RXMSK]) must also be set.                                                                                                                                                                                                         |
| FRAMESZ                  | Frame Size               | Configures the frame size in number of bits equal to (FRAMESZ + 1). • The minimum frame size is 8 bits. • If the frame size is larger than 32 bits, then the frame is divided into multiple words of 32-bits; each word is loaded from the transmit FIFO and stored in the receive FIFO separately. • If the size of the frame is not divisible by 32, then the last load of the transmit FIFO and store of the receive FIFO will contain the remainder bits. For example, a 72-bit transfer will consist of 3 words: the 1st and 2nd words are 32-bit, and the 3rd word is 8-bit. |

## 54.16.4.2.2 Receive FIFO and data match

The receive FIFO stores receive data during SPI bus transfers. When TCR[RXMSK] = 1, the received data is discarded instead of storing the received data in the receive FIFO.

Receive data supports a receive data match function that can match received data against one of two words in the DMR0 and DMR1 registers or against a masked data word. The data match function can also be configured to compare only the first one or two received data words since the start of the frame.

Low Latency Communication Engine (LLCE)

- Received data that is already discarded because TCR[RXMSK] = 1 cannot cause the data match to set, and delays the match on the first received data word, until all discarded data is received.
- The receiver match function can also be configured to discard all received data until a data match is detected, using the CFGR0[RDMO] bit.
- After a receive data match, to allow all subsequent data to be received, first clear the CFGR0[RDMO] bit, then clear the SR[DMF] bit.

## 54.16.4.2.3 Partial Received Word

When the PCS negates and the receive shift register has shifted in a partial word, the receive shift register can be configured to discard the partial word or to store it in the receive FIFO. This is controlled by the CFGR1[PARTIAL] configuration bit.

A partial word is defined as less than FRAMESZ bits (when FRAMESZ is equal or less than 32 bits, or it is the last word in a multi-word frame) or less than 32 bits (when FRAMESZ is greater than 32 bits and not the last word in a multi-word frame).

A single bit frame is not supported. A partial received word of 1 bit is fine, but a partial received frame of 1 bit is not supported.

## 54.16.4.2.4 Clocked interface

The LPSPI module supports interfacing to external masters that provide only clock and data pins (PCS is not required). This interface requires:

- Using Clock Phase TCR[CPHA] = 1 (data is changed on the leading edge of SCK and captured on the following edge)
- Configuring the PCS input to be always asserted (CFGR1[PCSPOLn] = 1). For example, to configure PCS[0] to be always asserted, set PCSPOL[0] = 1, and do not configure PCS[0] in the pin muxing. The chip-level drives PCS to a certain value (ideally 1), CFGR1[PCSPOLn] could be used to invert that value.
- Setting CFGR1[AUTOPCS] = 1 (Automatic PCS generation is enabled). When CFGR1[AUTOPCS] = 1, a minimum of 4 LPSPI functional clock cycles (divided by PRESCALE configuration) is required between the last SCK edge of one word and the first SCK edge of the next word.

## 54.16.4.3 Low power modes

## Table 417. Low power modes

| Chip mode   | LPSPI operation   |
|-------------|-------------------|
| Run         | Normal operation  |

## 54.16.4.4 Debug mode

## Table 418. Debug mode

| Chip mode                                 | LPSPI operation                                             |
|-------------------------------------------|-------------------------------------------------------------|
| Debug (the core is in Debug/ Halted mode) | Can continue operating in Debug mode, if the CR[DBGEN] = 1. |

## 54.16.4.5 Interrupts

The next table lists the slave mode sources (status flags) that can generate LPSPI interrupts.

## Table 419. LPSPI Interrupts

| Status Register (SR)   | Status Register (SR)   | Description                                                                                                                                                                       | Can generate   | Can generate      |
|------------------------|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|-------------------|
| Status Flag            | Name                   | Description                                                                                                                                                                       | Interrupt?     | Low Power Wakeup? |
| TDF                    | Transmit Data Flag     | Data can be written to transmit FIFO, as configured by FCR[TXWATER]                                                                                                               | Y              | Y                 |
| RDF                    | Receive Data Flag      | Data can be read from the receive FIFO, as configured by FCR[RXWATER]                                                                                                             | Y              | Y                 |
| WCF                    | Word Complete Flag     | Word is complete, the last bit of the word has been sampled                                                                                                                       | Y              | Y                 |
| FCF                    | Frame Complete Flag    | Frame is complete, and PCS has negated                                                                                                                                            | Y              | Y                 |
| TCF                    | Transfer Complete Flag | Transfer is complete, PCS has negated, and the transmit/command FIFO is empty                                                                                                     | Y              | Y                 |
| TEF                    | Transmit Error Flag    | Indicates a transmit/command FIFO underrun. In master mode when CFGR1[NOSTALL] = 0 (transfers stall when transmit FIFO is empty), the Transmit Error Flag bit cannot set.         | Y              | Y                 |
| REF                    | Receive Error Flag     | Receive error flag, indicates a receive FIFO overflow. In master mode when CFGR1[NOSTALL] = 0 (transfers stall when receive FIFO is full), the Receive Error Flag bit cannot set. | Y              | Y                 |
| DMF                    | Data Match Flag        | Indicates that the received data has matched the configured data match value                                                                                                      | Y              | Y                 |
| MBF                    | Module Busy Flag       | LPSPI is busy performing a SPI bus transfer                                                                                                                                       | N              | N                 |

## 54.16.4.6 Clocks

## Table 420. LPSPI Clocks

| LPSPI Functional clock   | • The LPSPI functional clock is asynchronous to the bus clock. • If the LPSPI functional clock remains enabled in low power modes, then LPSPI can perform SPI bus transfers and low power wakeups, in both master and slave modes. • The LPSPI divides the functional clock by a prescaler; the resulting frequency must be at least 2 times faster than the SPI external clock frequency (SCK).   |
|--------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| External clock           | • The LPSPI shift register is clocked directly by the SCK clock. • How the SCK clock is generated or supplied depends upon the mode (master or slave): - In master mode: the SCK clock is generated internally. - In slave mode: the SCK clock is supplied externally.                                                                                                                             |
| Bus clock                | The bus clock is only used for bus accesses to the LPSPI control and configuration registers. The bus clock frequency must be high enough to support the data bandwidth requirements of the LPSPI registers, including the FIFOs.                                                                                                                                                                  |

For chip-specific clocking information, see the Clocking chapter.

## 54.16.4.7 Resets

## Table 421. Resets

| Chip reset     | Resets the LPSPI logic and registers to their default state.                                                                                                                                           |
|----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Software reset | • Resets the LPSPI logic and registers to their default state, except for the Control Register. • The LPSPI software reset is in the Control Register CR[RST].                                         |
| FIFO resets    | • Resets the transmit/command FIFO and the receive FIFO. • The Reset Transmit FIFO field, CR[RTF] and the Reset Receive FIFO field, CR[RRF] are write-only bits. • After being reset, a FIFO is empty. |

## 54.16.4.8 Peripheral Triggers

The connection of the LPSPI peripheral triggers to other peripherals depend upon the specific device being used.

Table 422. LPSPI Triggers

| Trigger              | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Notes                                                                                       |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|
| Frame Output Trigger | The frame output trigger: • asserts at the end of each frame (when PCS negates) • remains asserted for one cycle of LPSPI functional clock divided by the PRESCALE configuration                                                                                                                                                                                                                                                                                                                                                                                | LPSPI generates 2 output triggers that can be connected to other peripherals on the device. |
| Word Output Trigger  | The word output trigger: • asserts at the end of each received word • remains asserted for one cycle of LPSPI functional clock divided by the PRESCALE configuration                                                                                                                                                                                                                                                                                                                                                                                            | LPSPI generates 2 output triggers that can be connected to other peripherals on the device. |
| Input Trigger        | To control the start of a LPSPI bus transfer, the LPSPI input trigger can be selected instead of the HREQ input. • The LPSPI input trigger is synchronized, and must assert for at least 2 cycles of the LPSPI functional clock divided by the PRESCALE configuration, so that the input trigger can be detected. • When the LPSPI module is busy, the HREQ input (and therefore the LPSPI input trigger) is ignored. • Both HREQandthe LPSPI input trigger are ignored when the module is busy. They are used to start a new transfer when the module is idle. |                                                                                             |

Low Latency Communication Engine (LLCE)

## 54.17 Signal descriptions

## Table 423. Signals

| Signal           | Name                                                                | Description                                                                                                                                                                                                   | I/O   |
|------------------|---------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------|
| SCK              | Serial clock                                                        | • Input in slave mode • Output in master mode                                                                                                                                                                 | I/O   |
| PCS[0]           | Peripheral Chip Select                                              | • Input in slave mode • Output in master mode                                                                                                                                                                 | I/O   |
| PCS[1] / HREQ    | Peripheral Chip Select or Host Request                              | Host Request pin is selected when CFGR0[HREN] = 1 and CFGR0[HRSEL] = 0 • Input in either slave mode or when used as master Host Request • Output in either master mode or when used as slave Host Request     | I/O   |
| PCS[2] / DATA[2] | Peripheral Chip Select or data pin 2 during parallel data transfers | When CFGR1[PCSCFG] = 0: • Input in slave mode • Output in master mode When CFGR1[PCSCFG] = 1: • Input in half-duplex parallel data receive transfers • Output in half-duplex parallel data transmit transfers | I/O   |
| PCS[3] / DATA[3] | Peripheral Chip Select or data pin 3 during parallel data transfers | When CFGR1[PCSCFG] = 0: • Input in slave mode • Output in master mode When CFGR1[PCSCFG] = 1: • Input in half-duplex parallel data receive transfers • Output in half-duplex parallel data transmit transfers | I/O   |
| SOUT / DATA[0]   | Serial Data Output                                                  | Can be configured as serial data input signal • Used as data pin 0 in half-duplex parallel data transfers                                                                                                     | I/O   |
| SIN / DATA[1]    | Serial Data Input                                                   | Can be configured as serial data output signal • Used as data pin 1 in half-duplex parallel data transfers                                                                                                    | I/O   |

## 54.18 External signal description

The LLCE hardware communication channels control the following I/O. The host controller configures the I/O through SIUL2\_n.

Low Latency Communication Engine (LLCE)

Table 424. LLCE external signal description

| Name                       | Function                          |
|----------------------------|-----------------------------------|
| LLCE_CAN[0:15]_TX          | BCAN transmit data                |
| LLCE_CAN[0:15]_RX          | BCAN receive data                 |
| LLCE_LIN[0:3]_TX           | LINFlexD transmit data            |
| LLCE_LIN[0:3]_RX           | LINFlexD receive data             |
| LLCE_FR_TXD_A              | FlexRay channel A transmit data   |
| LLCE_FR_TXD_B              | FlexRay channel B transmit data   |
| LLCE_FR_TXE_A              | FlexRay channel A transmit enable |
| LLCE_FR_TXE_B              | FlexRay channel B transmit enable |
| LLCE_FR_RXD_A              | FlexRay channel A receive data    |
| LLCE_FR_RXD_B              | FlexRay channel B receive data    |
| LLCE_FR_DBG_[0:3]          | FlexRay debug channels            |
| LLCE_LPSPI[0_3]_SIN        | LPSPI serial data in              |
| LLCE_LPSPI[0_3]_SOUT       | LPSPI serial data out             |
| LLCE_LPSPI[0_3]_SCLK       | LPSPI serial data clock           |
| LLCE_LPSPI[0_3]_PCS[0:3]_I | LPSPI chip select in              |
| LLCE_LPSPI[0_3]_PCS[0:3]_O | LPSPI chip select out             |

## 54.19 LLCE register descriptions

## 54.19.1 System control memory map

LLCE\_SYSCTRL base address: 43FF\_8000h

| Offset   | Register                            |   Width (In bits) | Access   | Reset value   |
|----------|-------------------------------------|-------------------|----------|---------------|
| 0h       | System Reset Control (LLCE_SYSRSTR) |                32 | RW       | 0000_0000h    |

## 54.19.2 System Reset Control (LLCE\_SYSRSTR)

## Offset

| Register     | Offset   |
|--------------|----------|
| LLCE_SYSRSTR | 0h       |

## Function

Controls the reset of various modules inside LLCE. The default value keeps the modules under reset. You must write 1 to deassert the resets of each module. This register is accessible only from the host CPU port.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | CPU_ | CPU_ | CPU_ | CPU_ |
| W      |      |      |      |      |      |      |      |      |      |      |      |      | RST3 | RST2 | RST1 | RST0 |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field      | Function                                                             |
|------------|----------------------------------------------------------------------|
| 31-4 -     | Reserved                                                             |
| 3 CPU_RST3 | CPU Reset 3 Resets core 3 0b - CPU under reset 1b - CPU out of reset |
| 2 CPU_RST2 | CPU Reset 2 Resets core 2 0b - CPU under reset 1b - CPU out of reset |
| 1 CPU_RST1 | CPU Reset 1 Resets core 1 0b - CPU under reset 1b - CPU out of reset |
| 0 CPU_RST0 | CPU Reset 0 Resets core 0 0b - CPU under reset 1b - CPU out of reset |

Low Latency Communication Engine (LLCE)

## Chapter 55 Universal Serial Bus On-The-Go Controller (USBOTG)

## 55.1 Chip-specific USB information

## 55.1.1 Chip-specific USBOTG information

Weak pulldown is required on the DIR pin of ULPI interface. In case, the external PHY is completely powered down, all the inputs need to be pulled down so that the pads should not remain floating.

<!-- image -->

## 55.1.2 SBUSCFG[AHBBRST] field reset value

AHB Master Interface Burst Configuration (AHBBRST) field controls the AHB master transfer type sequence (or priority). This chip is designed to support only 011b reset value for this field. Chip operation is not guaranteed for any other programmed values.

## 55.2 Introduction

This chapter describes the USB high-speed (HS) OTG controller (USBOTG), which implements many industry standards. See the standards' governing specifications for more information. To use this chapter most effectively, you need to be fluent in the operation and requirements of a USB network.

See the USB implementers forum at http://www.usb.org/developers/docs for:

- Universal Serial Bus Specification, Revision 2.0
- On-The-Go Supplement to the USB 2.0 Specification, Revision 1.0a

See the Intel USB specifications at http://www.intel.com/ for:

- Enhanced Host Controller Interface Specification for Universal Serial Bus, Revision 1.0

See the ULPI specifications at http://www.ulpi.org for:

- UTMI+ Specification, Revision 1.0
- UTMI Low Pin Interface (ULPI) Specification, Revision 1.1

## 55.2.1 Overview

USBOTG is a USB 2.0-compliant serial interface engine for implementing a USB interface. The registers and data structures are based on the  Enhanced Host Controller Interface Specification for Universal Serial Bus (EHCI) from Intel Corporation. This module can act as a host, a device, or an On-The-Go (OTG) negotiable host or device on the USB bus.

The USBOTG controller interfaces with the processor's core. The controller is configured to support host or device operations under firmware control. The ULPI (UTMI Low Pin Interface) interface supports HS, full-speed (FS), and low-speed (LS) applications.

## 55.2.2 Features

- Complies with USB specification rev 2.0
- USB Host mode
- Supports EHCI
- USB Device mode
- Supports FS/HS operation via an external ULPI transceiver
- Supports one upstream facing port
- Supports six programmable, bidirectional USB endpoints, including endpoint 0. See endpoint configurations in the following table:

## Table 425. Endpoint configurations

| Endpoint   | Type          | FIFO size   | Data transfer           | Comments   |
|------------|---------------|-------------|-------------------------|------------|
| 0          | Bidirectional | Variable    | Control                 | Mandatory  |
| 1-5        | IN or OUT     | Variable    | Ctrl, int, bulk, or ISO | Optional   |

- Suspend mode/low-power
- As host, firmware can suspend individual devices or the entire USB and disable chip clocks for low-power operation.
- Device supports low-power suspend.
- Remote wake-up is supported for host and device.
- Support for off-chip HS, FS, LS transceiver
- External ULPI transceiver supports HS, FS, and LS operations in Host mode, and HS and FS operations in Device mode.
- Interface uses an 8-bit, single-data-rate ULPI data bus.
- ULPI PHY supplies a 60 MHz USB reference clock input to the USB controller.

Universal Serial Bus On-The-Go Controller (USBOTG)

## 55.2.3 Modes of operation

This module has two basic operating modes: Host and Device. Selection of an operating mode is accomplished via the USBMODE[CM] field.

Speed selection is auto-detected at connect time using enumeration procedures in the USB network. This module provides these operation modes:

- USB disabled: In this mode, the USB datapath does not accept transactions received on the USB interface.
- USB enabled: In this mode, the datapath of the USB host is enabled to accept transactions received on the USB interface.
- USB enabled, low-power modes.

## 55.3 External signal description

This table describes the external signal functionality of the USBOTG module.

Table 426. Signal descriptions

| Signal         | I/O            | Description                                                                                                                                                                                                                                                                                                                                                                        | Description                                                                                                                                                                                                                                                                                                                                                                                                        |
|----------------|----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ULPI interface | ULPI interface | ULPI interface                                                                                                                                                                                                                                                                                                                                                                     | ULPI interface                                                                                                                                                                                                                                                                                                                                                                                                     |
| ULPI_CLK       | I/O            | 60 MHz clock input from the ULPI transceiver                                                                                                                                                                                                                                                                                                                                       | 60 MHz clock input from the ULPI transceiver                                                                                                                                                                                                                                                                                                                                                                       |
| ULPI_DIR       | O              | Direction. ULPI_DIR controls data bus direction. When PHY has data to transfer to USB port, it drives ULPI_DIR high to take ownership of the bus. When the PHY has no data to transfer, it drives ULPI_DIR low and monitors the bus for link activity. The PHY pulls ULPI_DIR high when the interface cannot accept data from the link; for example, when PHY's PLL is not stable. | Direction. ULPI_DIR controls data bus direction. When PHY has data to transfer to USB port, it drives ULPI_DIR high to take ownership of the bus. When the PHY has no data to transfer, it drives ULPI_DIR low and monitors the bus for link activity. The PHY pulls ULPI_DIR high when the interface cannot accept data from the link; for example, when PHY's PLL is not stable.                                 |
| ULPI_DIR       | O              | State meaning                                                                                                                                                                                                                                                                                                                                                                      | Asserted-PHY has data to transfer to the link. Negated-PHY has no data to transfer.                                                                                                                                                                                                                                                                                                                                |
| ULPI_DIR       | O              | Timing                                                                                                                                                                                                                                                                                                                                                                             | Synchronous to ULPI_CLK                                                                                                                                                                                                                                                                                                                                                                                            |
| ULPI_NXT       | I              | Next data. PHY asserts ULPI_NXT to throttle data. When the USB port sends data to the PHY, ULPI_NXT indicates when PHY accepts the current byte. The USB port places the next byte on the data bus in the following clock cycle. When the PHY sends data to USB port, ULPI_NXT indicates when a new byte is available for USB port to consume.                                     | Next data. PHY asserts ULPI_NXT to throttle data. When the USB port sends data to the PHY, ULPI_NXT indicates when PHY accepts the current byte. The USB port places the next byte on the data bus in the following clock cycle. When the PHY sends data to USB port, ULPI_NXT indicates when a new byte is available for USB port to consume.                                                                     |
| ULPI_NXT       | I              | State meaning                                                                                                                                                                                                                                                                                                                                                                      | Asserted-PHY is ready to transfer byte. Negated-PHY is not ready.                                                                                                                                                                                                                                                                                                                                                  |
| ULPI_NXT       | I              | Timing                                                                                                                                                                                                                                                                                                                                                                             | Synchronous to ULPI_CLK                                                                                                                                                                                                                                                                                                                                                                                            |
| ULPI_STP       | I              | Stop. ULPI_STP indicates the end of a transfer on the bus.                                                                                                                                                                                                                                                                                                                         | Stop. ULPI_STP indicates the end of a transfer on the bus.                                                                                                                                                                                                                                                                                                                                                         |
| ULPI_STP       | I              | State meaning                                                                                                                                                                                                                                                                                                                                                                      | Asserted-USB asserts this signal for one clock cycle to stop the data stream currently on the bus. If the USB port sends data to the PHY, ULPI_STP indicates the last data byte was previously on the bus. If the PHY is sending data to the USB port, ULPI_STP forces the PHY to end its transfer, deassert ULPI_DIR, and relinquish control of the data bus to the USB port. Negated-Indicates normal operation. |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

Table 426. Signal descriptions (continued)

| Signal         | I/O   | Description                                                                                                                                                           | Description                                                                                                                                                           |
|----------------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                |       | Timing                                                                                                                                                                | Synchronous to ULPI_CLK                                                                                                                                               |
| ULPI_DATA[7:0] | I/O   | Data bit n . ULPI_DATAT n is bit n of the 8-bit, bi-directional data bus used to carry USB, register, and interrupt data between the USB port controller and the PHY. | Data bit n . ULPI_DATAT n is bit n of the 8-bit, bi-directional data bus used to carry USB, register, and interrupt data between the USB port controller and the PHY. |
| ULPI_DATA[7:0] |       | State meaning                                                                                                                                                         | Asserted-Data bit n is 1. Negated-Data bit n is 0.                                                                                                                    |
| ULPI_DATA[7:0] |       | Timing                                                                                                                                                                | Synchronous to ULPI_CLK                                                                                                                                               |

## 55.4 USBOTG register descriptions

There are two types of registers in the USB module: USB core registers (UOTG) and USB non-core registers (UOTGNC).

The UOTG are used to control USB core functions and are more independent of USB features. Each UB controller core has its own core registers.

The UOTGNC are additional to the UOTG and are more dependent upon USB features.

## NOTE

- You must preserve a register's reserved field values when writing (that is, read its reset value, then write this value back). Writing any other value might result in unpredictable functionality or behavior.
- Consider all undefined locations in the register memory range as reserved.
- The UOTGNC register name prefix indicates a USB non-core register.

## 55.4.1 Core register descriptions

## 55.4.1.1 UOTG memory map

UOTG base address: 4406\_4000h

| Offset   | Register                                        |   Width (In bits) | Access   | Reset value   |
|----------|-------------------------------------------------|-------------------|----------|---------------|
| 0h       | Identification (ID)                             |                32 | R        | E4A1_FA05h    |
| 4h       | General Hardware Parameters (HWGENERAL)         |                32 | R        | 0000_0083h    |
| 8h       | Host Hardware Parameters (HWHOST)               |                32 | R        | 1002_0001h    |
| Ch       | Device Hardware Parameters (HWDEVICE)           |                32 | R        | 0000_000Dh    |
| 10h      | TX Buffer Hardware Parameters (HWTXBUF)         |                32 | R        | 8008_0B04h    |
| 14h      | RX Buffer Hardware Parameters (HWRXBUF)         |                32 | R        | 0000_0804h    |
| 80h      | General Purpose Timer Load (GPTIMER0LD)         |                32 | RW       | 0000_0000h    |
| 84h      | General Purpose Timer Controller (GPTIMER0CTRL) |                32 | RW       | 0000_0000h    |
| 88h      | General Purpose Timer Load (GPTIMER1LD)         |                32 | RW       | 0000_0000h    |

Table continues on the next page...

## Table continued from the previous page...

| Offset   | Register                                                                               |   Width (In bits) | Access   | Reset value   |
|----------|----------------------------------------------------------------------------------------|-------------------|----------|---------------|
| 8Ch      | General Purpose Timer Controller (GPTIMER1CTRL)                                        |                32 | RW       | 0000_0000h    |
| 90h      | System Bus Configuration (SBUSCFG)                                                     |                32 | RW       | 0000_01FBh    |
| 100h     | Capability Register Length (CAPLENGTH)                                                 |                 8 | R        | 40h           |
| 102h     | Host Controller Interface Version (HCIVERSION)                                         |                16 | R        | 0100h         |
| 104h     | Host Controller Structural Parameters (HCSPARAMS)                                      |                32 | R        | 0001_0011h    |
| 108h     | Host Controller Capability Parameters (HCCPARAMS)                                      |                32 | R        | 0000_0006h    |
| 120h     | Device Controller Interface Version (DCIVERSION)                                       |                16 | R        | 0001h         |
| 124h     | Device Controller Capability Parameters (DCCPARAMS)                                    |                32 | R        | 0000_0186h    |
| 140h     | USB Command (USBCMD)                                                                   |                32 | RW       | 0008_0B00h    |
| 144h     | USB Status (USBSTS)                                                                    |                32 | RW       | 0000_0000h    |
| 148h     | Interrupt Enable (USBINTR)                                                             |                32 | RW       | 0000_0000h    |
| 14Ch     | USB Frame Index (FRINDEX)                                                              |                32 | RW       | 0000_0000h    |
| 154h     | Frame List Base Address or Device Address (PERIODICLISTBASE_or_DEVICEADDR)             |                32 | RW       | 0000_0000h    |
| 158h     | Next Asynchronous Address or Endpoint List Address (ASYNCLISTADDR_or_ENDPOINTLISTADDR) |                32 | RW       | 0000_0000h    |
| 160h     | Programmable Burst Size (BURSTSIZE)                                                    |                32 | RW       | 0000_1010h    |
| 164h     | TX FIFO Fill Tuning (TXFILLTUNING)                                                     |                32 | RW       | 0000_0000h    |
| 16Ch     | IC_USB Enable and Voltage Negotiation (IC_USB)                                         |                32 | RW       | 0000_0000h    |
| 170h     | ULPI Register Access (ULPI_VIEWPORT)                                                   |                32 | RW       | 0800_0000h    |
| 178h     | Endpoint NAK (ENDPTNAK)                                                                |                32 | RW       | 0000_0000h    |
| 17Ch     | Endpoint NAK Enable (ENDPTNAKEN)                                                       |                32 | RW       | 0000_0000h    |
| 180h     | Configure Flag (CONFIGFLAG)                                                            |                32 | R        | 0000_0001h    |
| 184h     | Port Status and Control (PORTSC1)                                                      |                32 | RW       | 8C00_0004h    |
| 1A4h     | OTG Status Control (OTGSC)                                                             |                32 | RW       | 0000_1020h    |
| 1A8h     | USB Device Mode (USBMODE)                                                              |                32 | RW       | 0000_5000h    |
| 1ACh     | Endpoint Setup Status (ENDPTSETUPSTAT)                                                 |                32 | RW       | 0000_0000h    |
| 1B0h     | Endpoint Initialization (ENDPTPRIME)                                                   |                32 | RW       | 0000_0000h    |
| 1B4h     | Endpoint De-Initialize (ENDPTFLUSH)                                                    |                32 | RW       | 0000_0000h    |
| 1B8h     | Endpoint Status (ENDPTSTAT)                                                            |                32 | R        | 0000_0000h    |
| 1BCh     | Endpoint Complete (ENDPTCOMPLETE)                                                      |                32 | RW       | 0000_0000h    |

Table continues on the next page...

Table continued from the previous page...

| Offset      | Register                                   |   Width (In bits) | Access   | Reset value   |
|-------------|--------------------------------------------|-------------------|----------|---------------|
| 1C0h        | Endpoint Control 0 (ENDPTCTRL0)            |                32 | RW       | 0080_0080h    |
| 1C4h - 1D4h | Endpoint Control (ENDPTCTRL1 - ENDPTCTRL5) |                32 | RW       | 0000_0000h    |

## 55.4.1.2 Identification (ID)

## Offset

| Register   | Offset   |
|------------|----------|
| ID         | 0h       |

## Function

Identifies the USB 2.0 OTG HS core and its revision.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23       | 22       | 21       | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|----------|----------|----------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | REVISION | REVISION | REVISION | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |          |          |          |      |      |      |      |      |
| Reset  | 1    | 1    | 1    | 0    | 0    | 1    | 0    | 0    | 1        | 0        | 1        | 0    | 0    | 0    | 0    | 1    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7        | 6        | 5        | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | NID  | NID  | NID  | NID  | NID  | NID  | 0        | 0        | ID       | ID   | ID   | ID   | ID   | ID   |
| W      |      |      |      |      |      |      |      |      |          |          |          |      |      |      |      |      |
| Reset  | 1    | 1    | 1    | 1    | 1    | 0    | 1    | 0    | 0        | 0        | 0        | 0    | 0    | 1    | 0    | 1    |

## Fields

| Field          | Function                               |
|----------------|----------------------------------------|
| 31-25 -        | Reserved                               |
| 24-21 REVISION | Revision Number of the Controller Core |
| 20-16 -        | Reserved                               |

Table continues on the next page...

Table continued from the previous page...

| Field    | Function                                                                                                 |
|----------|----------------------------------------------------------------------------------------------------------|
| 15-14    | Reserved                                                                                                 |
| 13-8 NID | Complement Version of ID                                                                                 |
| 7-6 -    | Reserved                                                                                                 |
| 5-0 ID   | Configuration Number This number is set to 05h and indicates that the peripheral is USB 2.0 OTG HS core. |

## 55.4.1.3 General Hardware Parameters (HWGENERAL)

## Offset

<!-- image -->

| Register   | Register   | Register   | Register   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   |
|------------|------------|------------|------------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|
| HWGENERAL  | HWGENERAL  | HWGENERAL  | HWGENERAL  | 4h       | 4h       | 4h       | 4h       | 4h       | 4h       | 4h       | 4h       | 4h       | 4h       | 4h       | 4h       | 4h       |
| Diagram    | Diagram    | Diagram    | Diagram    | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  |
| Bits       | 31         | 30         | 29         | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
| R          | 0          | 0          | 0          | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| W          |            |            |            |          |          |          |          |          |          |          |          |          |          |          |          |          |
| Reset      | 0          | 0          | 0          | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| Bits       | 15         | 14         | 13         | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R          | 0          | 0          | 0          | 0        | SM       | SM       | PHYM     | PHYM     | PHYM     | PHYM     | PHYW     | PHYW     | 0        | 0        | 0        | 0        |
| W          |            |            |            |          |          |          |          |          |          |          |          |          |          |          |          |          |
| Reset      | 0          | 0          | 0          | 0        | 0        | 0        | 0        | 0        | 1        | 0        | 0        | 0        | 0        | 0        | 1        | 1        |

## Fields

| Field   | Function                                                                  |
|---------|---------------------------------------------------------------------------|
| 31-12   | Reserved                                                                  |
| -       |                                                                           |
| 11-10   | Serial Interface Mode Capability                                          |
| SM      | Selects between parallel and serial signaling for LS and FS applications. |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|          | 00b - No serial engine; always use parallel signaling 01b - Serial engine present; always use serial signaling for FS or LS 10b - Software-programmable reset to use parallel signaling for FS or LS 11b - Software-programmable reset to use serial signaling for FS or LS                                                                                                                                                                                       |
| 9-6 PHYM | Transceiver Type Selects transceiver type and software-programmable reset. 0000b - UTMI/UMTI+ 0001b - ULPI DDR 0010b - ULPI 0011b - Serial only 0100b - Software-programmable reset to UTMI/UTMI+ 0101b - Software-programmable reset to ULPI DDR 0110b - Software-programmable reset to ULPI 0111b - Software-programmable reset to Serial 1000b - IC-USB 1001b - Software-programmable reset to IC-USB 1010b - HSIC 1011b - Software-programmable reset to HSIC |
| 5-4 PHYW | Data Width of the Transceiver connected to the controller core Selects data bus width of the transceiver connected to the controller core andsoftware-programmable reset. 00b - 8-bit wide data bus [60 MHz clock from the transceiver] 01b - 16-bit wide data bus [30 MHZ clock from the transceiver] 10b - Software-programmable reset to 8-bit width 11b - Software-programmable reset to 16-bit width                                                         |
| 3-0 -    | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

## 55.4.1.4 Host Hardware Parameters (HWHOST)

## Offset

| Register   | Offset   |
|------------|----------|
| HWHOST     | 8h       |

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28    | 27    | 26    | 25    | 24    | 23    | 22    | 21    | 20    | 19    | 18    | 17    | 16   |
|--------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|------|
| R      | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0    |
| W      |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |      |
| Reset  | 0     | 0     | 0     | 1     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 1     | 0    |
| Bits   | 15    | 14    | 13    | 12    | 11    | 10    | 9     | 8     | 7     | 6     | 5     | 4     | 3     | 2     | 1     | 0    |
| R      | NPORT | NPORT | NPORT | NPORT | NPORT | NPORT | NPORT | NPORT | NPORT | NPORT | NPORT | NPORT | NPORT | NPORT | NPORT | HC   |
| W      |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |      |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 1    |

## Fields

| Field     | Function                                                                                                                                                        |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-4 -    | Reserved                                                                                                                                                        |
| 3-1 NPORT | Number of Ports Contains the number of downstream ports supported by the host controller is NPORT+1. This field is set to 000b for this single-port controller. |
| 0 HC      | Host Capable 0b - Host operation mode not supported 1b - Host operation mode supported                                                                          |

## 55.4.1.5 Device Hardware Parameters (HWDEVICE)

## Offset

| Register   | Offset   |
|------------|----------|
| HWDEVICE   | Ch       |

Universal Serial Bus On-The-Go Controller (USBOTG)

## Diagram

Universal Serial Bus On-The-Go Controller (USBOTG)

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22    | 21    | 20    | 19    | 18    | 17    | 16   |
|--------|------|------|------|------|------|------|------|------|------|-------|-------|-------|-------|-------|-------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 0     | 0     | 0     | 0    |
| W      |      |      |      |      |      |      |      |      |      |       |       |       |       |       |       |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 0     | 0     | 0     | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6     | 5     | 4     | 3     | 2     | 1     | 0    |
| R      |      |      |      |      | 0    |      |      |      |      | DEVEP | DEVEP | DEVEP | DEVEP | DEVEP | DEVEP | DC   |
| W      |      |      |      |      |      |      |      |      |      |       |       |       |       |       |       |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 1     | 1     | 0     | 1    |

## Fields

| Field     | Function                                                                                     |
|-----------|----------------------------------------------------------------------------------------------|
| 31-7 -    | Reserved                                                                                     |
| 6-1 DEVEP | Device Endpoint Number The OTG controller core has six endpoints.                            |
| 0 DC      | Device Capable 0b - Device operation mode not supported 1b - Device operation mode supported |

## 55.4.1.6 TX Buffer Hardware Parameters (HWTXBUF)

## Offset

| Register   | Offset   |
|------------|----------|
| HWTXBUF    | 10h      |

<!-- image -->

## Fields

| Field           | Function                                                                                                                                                                                                                                                                                                                                                          |
|-----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 -         | Reserved                                                                                                                                                                                                                                                                                                                                                          |
| 23-16 TXCHANADD | TX Channel Address Indicates the number of address bits required for TX channel buffer addressing. The TX buffer size is equal to 2 TXCHANADD ×4 bytes. For the OTG controller core, there is one TX buffer for each endpoint, therefore there are six TX buffers in all. The value of this field is configured as 8h, therefore, the buffer size is 256×4 bytes. |
| 15-8 TXADD      | TX Address Indicates the number of address bits required for TX buffer addressing. The buffer total size for all transmit endpoints is 2 RXADD .                                                                                                                                                                                                                  |
| 7-0 TXBURST     | TX Burst Size Indicates the default burst size for memory to TX buffer transfer. This is the reset value of BURSTSIZE[TXPBURST]. See BURSTSIZE for details.                                                                                                                                                                                                       |

## 55.4.1.7 RX Buffer Hardware Parameters (HWRXBUF)

## Offset

<!-- image -->

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                                                     |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -     | Reserved                                                                                                                                                                                                                                                                                                                                                     |
| 15-8 RXADD  | RX Address Indicates the number of address bits required for RX buffer addressing. The buffer total size for all receive endpoints is 2 RXADD. . RX buffer size is equal to 2 RXADD ×4 bytes. For the OTG controller core, there is one RX buffer shared by six endpoints. The value of this field is set to 08h, therefore, the buffer size is 256×4 bytes. |
| 7-0 RXBURST | RX Burst size Indicates the default burst size for memory to RX buffer transfer. This is the reset value of BURSTSIZE[RXPBURST]. See BURSTSIZE for details.                                                                                                                                                                                                  |

## 55.4.1.8 General Purpose Timer Load (GPTIMER0LD - GPTIMER1LD)

## Offset

| Register   | Offset   |
|------------|----------|
| GPTIMER0LD | 80h      |
| GPTIMER1LD | 88h      |

## Function

Controls the load value of the count timer in GPTnCL. See GPTIMER0CTRL for details.

## Diagram

<!-- image -->

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24    | 23    | 22    | 21    | 20    | 19    | 18    | 17    | 16    |
|---------|------|------|------|------|------|------|------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| R       | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     |       |       |       |       |       |       |       |       |
| W       |      |      |      |      |      |      |      |       | GPTLD | GPTLD | GPTLD | GPTLD | GPTLD | GPTLD | GPTLD | GPTLD |
| Reset   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8     | 7     | 6     | 5     | 4     | 3     | 2     | 1     | 0     |
| R       |      |      |      |      |      |      |      | GPTLD |       |       |       |       |       |       |       |       |
| W Reset | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     |

## Fields

| Field      | Function                                                                                                                                                                                                                                                                                                            |
|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 -    | Reserved                                                                                                                                                                                                                                                                                                            |
| 23-0 GPTLD | General Purpose Timer Load Value These bits are loaded to the GPTCNT bits when the GPTRST field is set to 1. This value represents the time in microseconds minus 1 for the timer duration. For example, a one millisecond timer, load 1000-1=999, or 0003E7h. Maximum value is FFFFFFh, or 16.777215 seconds. NOTE |

## 55.4.1.9 General Purpose Timer Controller (GPTIMER0CTRL - GPTIMER1CTRL)

## Offset

| Register     | Offset   |
|--------------|----------|
| GPTIMER0CTRL | 84h      |
| GPTIMER1CTRL | 8Ch      |

## Function

Contains the countdown timer control and a data field can be queried to determine the running count value. This timer has a granularity of 1 us and can be programmed to slightly more than 16 seconds. There are two counter modes that are described in the register table. When the timer counter value transitions to 0, an interrupt could be generated if enabled.

Interrupt status field is USBSTS[TI0]; interrupt enable field is USBINTR[TIE0].

## Diagram

<!-- image -->

Universal Serial Bus On-The-Go Controller (USBOTG)

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                        |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 GPTRUN   | General Purpose Timer Run The GPTCNT bits are not affected when setting or clearing this field. 0b - Stop counting 1b - Run                                                                                                                                                                                                     |
| 30 GPTRST   | General Purpose Timer Reset 0b - No action 1b - Load the counter value from GPT0LD[GPTLD]                                                                                                                                                                                                                                       |
| 29-25 -     | Reserved                                                                                                                                                                                                                                                                                                                        |
| 24 GPTMODE  | General Purpose Timer Mode In One-Shot mode, the timer counts down to 0, generates an interrupt, and stops until you reset the counter. In Repeat mode, the timer counts down to 0, generates an interrupt, and automatically reloads the counter value from the GPTLD bits to start again. 0b - One-Shot mode 1b - Repeat mode |
| 23-0 GPTCNT | General Purpose Timer Counter Contains the count value of the countdown timer.                                                                                                                                                                                                                                                  |

## 55.4.1.10 System Bus Configuration (SBUSCFG)

## Offset

<!-- image -->

| Register   | Register   | Register   | Register   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   | Offset   |
|------------|------------|------------|------------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|
| SBUSCFG    | SBUSCFG    | SBUSCFG    | SBUSCFG    | 90h      | 90h      | 90h      | 90h      | 90h      | 90h      | 90h      | 90h      | 90h      | 90h      | 90h      | 90h      | 90h      |
| Diagram    | Diagram    | Diagram    | Diagram    | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  | Diagram  |
| Bits       | 31         | 30         | 29         | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
| R          | 0          | 0          | 0          | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| W          |            |            |            |          |          |          |          |          |          |          |          |          |          |          |          |          |
| Reset      | 0          | 0          | 0          | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| Bits       | 15         | 14         | 13         | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R          | 0 BAWR     | 0 BAWR     | 0 BAWR     | 0 BAWR   | 0 BAWR   | 0 BAWR   | 0 BAWR   | 0 BAWR   | 0 BAWR   | 0 BAWR   |          |          |          |          |          |          |
| W          |            |            |            |          |          |          |          |          |          |          | BARD     | BARD     | BARD     | AHBBRST  | AHBBRST  | AHBBRST  |
| Reset      | 0          | 0          | 0          | 0        | 0        | 0        | 0        | 1        | 1        | 1        | 1        | 1        | 1        | 0        | 1        | 1        |

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-9 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 8-6 BAWR    | AMBA Burst Alignment for Writes To improve performance on system bus architectures where unaligned bursts are a problem, this mode guarantees that AMBA-AHB burst transfers never cross the burst size address boundary. Burst transfers that start unaligned are broken into smaller aligned bursts until aligned bursts of maximumsize can be used. This aligns all packet data AMBA burst transfers to their respective address boundaries: • INCR16-64 byte boundary • INCR8-32 byte boundary • INCR4-16 byte boundary • SINGLE-4 byte boundary This mode only applies to packet data transfers, not data structures. When burst alignment is enabled, you can select a minimum threshold for the packet size that uses aligned bursts when being written to system memory. • 000 - Disable burst alignment • 001 - Align bursts for packets larger than 512 bytes • 010 - Align bursts for packets larger than 256 bytes • 011 - Align bursts for packets larger than 128 bytes • 100 - Align bursts for packets larger than 64 bytes • 101 - Align bursts for packets larger than 32 bytes • 110 - Align bursts for packets larger than 16 bytes • 111 - Align bursts for all packets |
| 5-3 BARD    | AMBA Burst Alignment for Reads Same function as BAWR above, but for AMBA reads.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 2-0 AHBBRST | AHB Master Interface Burst Configuration Controls the AHB master transfer type sequence (or priority). Overrides BURSTSIZE when its value is not 0. NOTE 000b - Incremental burst of unspecified length only 001b - INCR4 burst, then single transfer 010b - INCR8 burst, INCR4 burst, then single transfer 011b - INCR16 burst, INCR8 burst, INCR4 burst, then single transfer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                   |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | 100b - Reserved 101b - INCR4 burst, then incremental burst of unspecified length 110b - INCR8 burst, INCR4 burst, then incremental burst of unspecified length 111b - INCR16 burst, INCR8 burst, INCR4 burst, then incremental burst of unspecified length |

## 55.4.1.11 Capability Register Length (CAPLENGTH)

## Offset

| Register   | Offset   |
|------------|----------|
| CAPLENGTH  | 100h     |

## Function

Indicates the offset that must be added to the register base address at the beginning of the operational register.

## Diagram

<!-- image -->

| Bits    | 7         | 6         | 5         | 4         | 3         | 2         | 1         | 0         |           |
|---------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|
| R       | CAPLENGTH | CAPLENGTH | CAPLENGTH | CAPLENGTH | CAPLENGTH | CAPLENGTH | CAPLENGTH | CAPLENGTH | CAPLENGTH |
| W Reset | 0         | 1         | 0         | 0         | 0         | 0         | 0         | 0         |           |

## Fields

| Field     | Function                                                                                      |
|-----------|-----------------------------------------------------------------------------------------------|
| 7-0       | This field is used as an offset to be added to the register base to find the beginning of the |
| CAPLENGTH | Operational register.                                                                         |

## 55.4.1.12 Host Controller Interface Version (HCIVERSION)

## Offset

| Register   | Offset   |
|------------|----------|
| HCIVERSION | 102h     |

## Function

Contains a BCD encoding of the EHCI revision number supported by this host controller. The most significant byte of this register represents a major revision and the least significant byte is the minor revision.

## Diagram

<!-- image -->

## Fields

| Field      | Function                                               |
|------------|--------------------------------------------------------|
| 15-0       | Host Controller Interface Version Number               |
| HCIVERSION | For example, the value 10h indicates EHCI revision 1.0 |

## 55.4.1.13 Host Controller Structural Parameters (HCSPARAMS)

## Offset

| Register   | Offset   |
|------------|----------|
| HCSPARAMS  | 104h     |

## Function

Indicates the port steering logic capabilities of Host Controller Structural Parameters (HCSPARAMS).

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27    | 26    | 25    | 24    | 23    | 22    | 21    | 20    | 19      | 18      | 17      | 16      |
|--------|------|------|------|------|-------|-------|-------|-------|-------|-------|-------|-------|---------|---------|---------|---------|
| R      | 0    | 0    | 0    | 0    | N_TT  | N_TT  | N_TT  | N_TT  | N_PTT | N_PTT | N_PTT | N_PTT | 0       | 0       | 0       | PI      |
| W      |      |      |      |      |       |       |       |       |       |       |       |       |         |         |         |         |
| Reset  | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0       | 0       | 0       | 1       |
| Bits   | 15   | 14   | 13   | 12   | 11    | 10    | 9     | 8     | 7     | 6     | 5     | 4     | 3       | 2       | 1       | 0       |
| R      | N_CC | N_CC | N_CC | N_CC | N_PCC | N_PCC | N_PCC | N_PCC | 0     | 0     | 0     | PPC   | N_PORTS | N_PORTS | N_PORTS | N_PORTS |
| W      |      |      |      |      |       |       |       |       |       |       |       |       |         |         |         |         |
| Reset  | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 1     | 0       | 0       | 0       | 1       |

## Fields

| Field   | Function   |
|---------|------------|
| 31-28   | Reserved   |
| -       |            |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table continued from the previous page...

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|-------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 27-24 N_TT  | Number of Transaction Translators Indicates the number of embedded transaction translators associated with the USB2.0 host controller. 0000b - Single-port host 0001b - Multi-port host                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 23-20 N_PTT | Number of Ports Per Transaction Translator Indicates the number of ports assigned to each transaction translator within the USB2.0 host controller. This field is set to equal N_PORTS for Multi-Port Host, and 0000b for single-port host.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 19-17 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 16 PI       | Port Indicators Indicates whether the ports support port indicator control. This field is 1b in the controller core. 0b - The ports do not support port indicator control. 1b - The port status and control registers include a read/writeable field for controlling the state of                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 15-12 N_CC  | Number of Companion Controllers Indicates the number of companion controllers associated with this USB2.0 host controller. This field is 0000b in the controller core. 0000b - There is no internal companion controller and port-ownership hand-off is not supported. 0001b - There are internal companion controller(s) and port-ownership hand-offs are supported.                                                                                                                                                                                                                                                                                                                                                                                |
| 11-8 N_PCC  | Number of Ports Per Companion Controller Indicates the number of ports supported per internal companion controller. It is used to indicate the port routing configuration to the system software. For example, if N_PORTShas a value of 6 and N_CChas a value of 2 then N_PCCcould have a value of 3. The convention is that the first N_PCC ports are assumed to be routed to companion controller 1, the next N_PCC ports to companion controller 2, and so on. In the previous example, the N_PCC could have been 4, where the first 4 are routed to companion controller 1 and the last two are routed to companion controller 2. The number in this field must be consistent with N_PORTS and N_CC. This field is 0000b in the controller core. |
| 7-5 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 4 PPC       | Port Power Control                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

Table continues on the next page...

Table continued from the previous page...

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                           |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|             | Indicates whether the host controller implementation includes port power control. The value of this field affects the functionality of the port power field in each port status and control register. 0b - The ports do not have port power switches. 1b - The ports have port power switches.                                                                                                     |
| 3-0 N_PORTS | Number of Downstream Ports Specifies the number of physical downstream ports implemented on this host controller. The value of this field determines how many port registers are addressable in the Operational register. Valid values are in the range of 1h to Fh. The value 0h in this field is undefined. This field is always set to 0001b because the controller core is a single-port host. |

## 55.4.1.14 Host Controller Capability Parameters (HCCPARAMS)

## Offset

| Register   | Offset   |
|------------|----------|
| HCCPARAMS  | 108h     |

## Function

Identifies multiple mode control (time-base bit functionality) addressing capabilities.

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19   | 18   | 17   | 16   |
|--------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|------|------|------|------|
| R      | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0    | 0    | 0    | 0    |
| W      |          |          |          |          |          |          |          |          |          |          |          |          |      |      |      |      |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0    | 0    | 0    | 0    |
| Bits   | 15       | 14       | 13       | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3    | 2    | 1    | 0    |
| R      | EECP IST | EECP IST | EECP IST | EECP IST | EECP IST | EECP IST | EECP IST | EECP IST | EECP IST | EECP IST | EECP IST | EECP IST | 0    | ASP  | PFL  | ADC  |
| W      |          |          |          |          |          |          |          |          |          |          |          |          |      |      |      |      |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0    | 1    | 1    | 0    |

## Fields

| Field   | Function   |
|---------|------------|
| 31-16   | Reserved   |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-8 EECP | EHCI Extended Capabilities Pointer Indicates the existence of a capabilities list. A value of 00h indicates that no extended capabilities are implemented. A non-zero value in this register indicates the offset in PCI configuration space of the first EHCI extended capability. If implemented, the pointer value must be 40h or greater to maintain the consistency of the PCI header defined for this class of device. This field has a fixed value of 00h.                                                                                                     |
| 7-4 IST   | Isochronous Scheduling Threshold Indicates, relative to the current position of the executing host controller, where you can reliably update the isochronous schedule. When bit [7] is 0, the value of the least significant 3 bits indicates the number of microframes for which a host controller can hold a set of isochronous data structures (one or more) before flushing the state. When IST[3] is 1, then the host software assumes that the host controller may cache an isochronous data structure for an entire frame. This field has a fixed value of 0h. |
| 3 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 2 ASP     | Asynchronous Schedule Park Capability Supports the park feature for HSQHsintheasynchronousschedule.Thefeature can bedisabled or enabled and set to a specific level by using USBCMD[ASPE] and USBCMD[ASP]. This field has a fixed value of 1.                                                                                                                                                                                                                                                                                                                         |
| 1 PFL     | Programmable Frame List Flag If you write 0 to this field, then the system software must use a frame list length of 1024 elements with this host controller. You must write 0 to USBCMD[FS1]. If you write 1 to this field, then the system software can specify and use a smaller frame list and configure the host controller via USBCMD[FS1]. The frame list must always be aligned on a 4K-page boundary. This requirement ensures that the frame list is always physically contiguous. This field has a fixed value of 1.                                        |
| 0 ADC     | 64-bit Addressing Capability This field has a fixed value of 0 and 64-bit addressing capability is not supported.                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

## 55.4.1.15 Device Controller Interface Version (DCIVERSION)

## Offset

| Register   | Offset   |
|------------|----------|
| DCIVERSION | 120h     |

## Function

Indicates the two-byte BCD encoding of the device controller interface version number.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                   |
|---------|--------------------------------------------|
| 15-0    | Device Controller Interface Version Number |
| DCIFVER | For example, 01h means rev0.1.             |

## 55.4.1.16 Device Controller Capability Parameters (DCCPARAMS)

## Offset

| Register   | Offset   |
|------------|----------|
| DCCPARAMS  | 124h     |

## Function

Describes the overall device capability of the controller.

## Diagram

<!-- image -->

Universal Serial Bus On-The-Go Controller (USBOTG)

## Fields

| Field   | Function                                                                                                                                                                                         |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-9 -  | Reserved                                                                                                                                                                                         |
| 8 HC    | Host Capable When the value of this field is 1, this controller is capable of operating as an EHCI compatible USB 2.0 host controller.                                                           |
| 7 DC    | Device Capable When the value of this field is 1, this controller is capable of operating as a USB 2.0 device.                                                                                   |
| 6 -     | Reserved                                                                                                                                                                                         |
| 5-0 DEN | Device Endpoint Number Indicates the number of endpoints built into the device controller. If this controller is not device capable, then the value of this field is 0. Valid values are 0 - 15. |

## 55.4.1.17 USB Command (USBCMD)

## Offset

| Register   | Offset   |
|------------|----------|
| USBCMD     | 140h     |

## Function

Indicates the command to be executed by the serial bus host/device controller. Writing to the register causes a command to be executed.

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 23-16 ITC | Interrupt Threshold Control The system software uses this field to set the maximum rate at which the host/device controller issues interrupts. ITC contains the maximum interrupt interval measured in microframes. Valid values are shown below. Maximum interrupt interval values are these: 0000_0000b - Immediate (no threshold) 0000_0001b - 1 microframe 0000_0010b - 2 microframes 0000_0100b - 4 microframes 0000_1000b - 8 microframes 0001_0000b - 16 microframes 0010_0000b - 32 microframes                                    |
| 15 FS1    | Frame List Size See also FS0. This field is read/write only if the value of Programmable Frame List Flag in the HCCPARAMSregisters is 1. Specifies the size of the frame list that controls which fields in USB Frame Index (FRINDEX) must be used for the frame list current index. This field is made up from USBCMD[FS1] and USBCMD[FS0]. NOTE 000 - 1024 elements (4096 bytes) 001 - 512 elements (2048 bytes) 010 - 256 elements (1024 bytes) 011 - 128 elements (512 bytes) 110 - 16 elements (64 bytes) 111 - 8 elements (32 bytes) |
| 14 ATDTW  | Add device transfer descriptor (dTD) TripWire Used as a semaphore to ensure proper addition of a new dTD to an active (primed) endpoint's linked list. This field is set and cleared by you. This field is cleared by hardware when state machine is hazard region for which adding a dTD to a primed endpoint may go unrecognized.                                                                                                                                                                                                        |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 13 SUTW | Setup TripWire Used as a semaphore to ensure that the setup data payload of eight bytes is extracted from a QH by the device controller driver (DCD) without being corrupted. If the setup lockout mode is off (USBMODE[SLOM] is 1), then there is a hazard when new setup data arrives while the DCD is copying the setup data payload from the QH for a previous setup packet. This field is set and cleared by you. The hardware also writes 0 to this field when a hazard is detected.                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 12 -    | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 11 ASPE | Asynchronous Schedule Park Mode Enable If HCCPARAMS[ASP] is 0, then this field defaults to 1h and is R/W. Otherwise, the field must be 0 and is RO. You use this field to enable or disable Park mode. When this field is 1, Park mode is enabled. When this field is a 0, Park mode is disabled. This field is set to 1h (the default value).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 10 -    | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 9-8 ASP | Asynchronous Schedule Park Mode Count If HCCPARAMS[ASP] is 1, then this field defaults to 3 and is read/write. Otherwise, it defaults to 0 and is read-only. It contains a count of the number of successive transactions the host controller is allowed to execute from an HS QH on the asynchronous schedule before continuing traversal of the asynchronous schedule. Valid values are 1 to 3. You must not write a 0 to this field when Park Mode Enable is a 1 as this results in undefined behavior. This field is set to 3h (the default value).                                                                                                                                                                                                                                                                                                                                                                           |
| 7 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 6 IAA   | Interrupt on Async Advance Doorbell You use this as a doorbell to tell the host controller to issue an interrupt the next time it advances the asynchronous schedule. You must write 1 to this field to ring the doorbell. When the host controller has evicted all appropriate cached schedule states, it sets the Interrupt on the Async Advance status field in USB Status (USBSTS). If the Interrupt on Sync Advance Enable field in Interrupt Enable (USBINTR) is 1, then the host controller asserts an interrupt at the next interrupt threshold. The host controller clears this field to 0 after it has set the Interrupt on Sync Advance status field in USB Status (USBSTS)to 1. Youmustnot write a 1 to this field whenthe asynchronous schedule is inactive; doing so yields undefined results. This field is only used in host mode. Writing 1 to this field when device mode is selected yields undefined results. |
| 5       | Asynchronous Schedule Enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ASE     | Controls whether the host controller skips processing of the asynchronous schedule. Only the host controller uses this field. 0b - Do not process the asynchronous schedule 1b - Use ASYNCLISTADDR to access the asynchronous schedule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 4 PSE   | Periodic Schedule Enable Controls whether the host controller skips processing the periodic schedule. Only the host controller uses this field. 0b - Do not process the periodic schedule 1b - Use PERIODICLISTBASE to access the periodic schedule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 3-2 FS0 | FS0 See description at FS1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 1 RST   | Controller Reset You use this field to reset the controller. It is cleared to 0 by the Host/Device controller when the reset process is complete. You cannot terminate the reset process early by writing a 0 to this register. Host operation mode: When you write 1 to this field, the controller resets its internal pipelines, timers, counters, state machines, and so on, to their initial value. Any transaction currently in progress on the USB is immediately terminated. A USB reset is not driven on downstream ports. You must not write 1 to this field when USBSTS[HCH] is 0. Attempting to reset an actively running host controller results in undefined behavior. Device operation mode: When you write 1 to this field, the controller resets its internal pipelines, timers, counters, state machines, and so on, to their initial values. Writing 1 to this field, when the device is in the attached state, is not recommended because the effect on an attached host is undefined. To ensure that the device is not in an attached state before initiating a device controller reset, all primed endpoints must be flushed, and USBCMD[RS] must be written to 0. The reset value of this field is gated with the reset state machine. If the PHYclock is not up and running, the read value of this field is 1. |
| 0 RS    | Run/Stop Host Operation mode: When the value of this field is 1, the controller proceeds with the execution of the schedule. The controller continues execution as long as this field is set to 1. When this field is cleared to 0, the host controller completes the current transaction on the USB and then halts. The HC Halted field in the status register indicates when the controller has finished the transaction and has entered the stopped state. You must not write a 1 to this field unless the controller is in the Halted state (that is, USBSTS[HCH] is a 1). Device Operation mode: Writing a 1 to this field causes the controller to enable a pull-up on D+ and initiate an attach event. This control field is not directly connected to the pull-up enable, as the pull-up becomes disabled upon transitioning into HS mode. You must use this field to prevent an attach event before the controller has been properly initialized. Writing a 0 to this field causes a detach event.                                                                                                                                                                                                                                                                                                                            |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function           |
|---------|--------------------|
|         | 0b - Stop 1b - Run |

## 55.4.1.18 USB Status (USBSTS)

## Offset

| Register   | Offset   |
|------------|----------|
| USBSTS     | 144h     |

## Function

Indicates various states of the host/device controller and any pending interrupts. The register does not indicate status resulting from a transaction on the serial bus.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27    | 26    | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|-------|-------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0     | 0     | TI1  | TI0  | 0    | 0    | 0    | 0    | UPI  | UAI  | 0    | NAKI |
| W      |      |      |      |      |       |       | W1C  | W1C  |      |      |      |      | W1C  | W1C  |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11    | 10    | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | AS   | PS   | RCL  | HCH  | UALTI | ULPII | 0    | SLI  | SRI  | URI  | AAI  | SEI  | FRI  | PCI  | UEI  | UI   |
| W      |      |      |      |      | W1C   | W1C   |      | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  |
| Reset  | 0    | 0    | 0    | 0    | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                         |
|---------|----------------------------------------------------------------------------------|
| 31-26   | Reserved                                                                         |
| -       |                                                                                  |
| 25      | General Purpose Timer Interrupt 1                                                |
| TI1     | This field is set to 1 when the counter in the GPT1CL register transitions to 0. |
| 24      | General Purpose Timer Interrupt 0                                                |
| TI0     | This field is set to 1 when the counter in the GPT0CL register transitions to 0. |
| 23-20   | Reserved                                                                         |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 19 UPI  | USB Host Periodic Interrupt The host controller writes 1 to this field when the cause of an interrupt is a completion of a USB transaction in which the transfer descriptor (TD) has an interrupt on complete (IOC) field set to 1 and the TD was from the periodic schedule. This field is also set to 1 by the host controller when a short packet is detected and the packet is on the periodic schedule. A short packet occurs when the actual number of bytes received is less than expected. This field is not used by the device controller and is always 0. |
| 18 UAI  | USB Host Asynchronous Interrupt The host controller writes 1 to this field when the cause of an interrupt is completion of a USB transaction in which the TD has an IOC field set to 1 and the TD originates from the asynchronous schedule. This field is also set to 1 by the host when a short packet is detected and the packet is on the asynchronous schedule. A short packet occurs when the actual number of bytes received is less than expected. This field is not used by the device controller and is always 0.                                         |
| 17 -    | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 16 NAKI | NAK Interrupt This field is set to 1 by hardware when, for a particular endpoint, both the TX/RX Endpoint NAK fields (ENDPTNAK[EPTN] and ENDPTNAK[ERTN]) and the corresponding TX/RX Endpoint NAK Enable fields (ENDPTNAKEN[EPTNE] and ENDPTNAKEN[EPRNE]) are 1. This field is automatically cleared to 0 by hardware when all Enabled TX/RX Endpoint NAK fields are cleared to 0.                                                                                                                                                                                  |
| 15 AS   | Asynchronous Schedule Status Reports the current real status of the asynchronous schedule. When cleared to 0, the asynchronous schedule status is disabled; if set to 1, the status is enabled. The host controller is not required to immediately disable or enable the asynchronous schedule when you transition USBCMD[ASE]. When this field and USBCMD[ASE] are the same value, the asynchronous schedule is either enabled (1) or disabled (0). This field is only used in the host operation mode.                                                            |
| 14 PS   | Periodic Schedule Status Reports the current real status of the periodic schedule. When cleared to 0, the periodic schedule is disabled, and if set to 1 the status is enabled. The host controller is not required to immediately disable or enable the periodic schedule when you transition the Periodic Schedule Enable field in USB Command (USBCMD). When this field and the Periodic Schedule Enable field are the same value, the periodic schedule is either enabled (1) or disabled (0). This field is only used in the host operation mode.              |
| 13      | Reclamation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| RCL      | This status field is used to detect an empty asynchronous schedule. It is only used in the host operation mode.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 12 HCH   | HC Halted This field is a 0 whenever the Run/Stop field is a 1. The controller sets this field to 1 after it has stopped executing because of the Run/Stop field being cleared to 0, either by you or by the controller hardware (for example, on an internal error). This field is only used in the host operation mode. The OTG core does not operate as a host by default. See USBMODE[CM].                                                                                                                                                                                                                                                                                                     |
| 11 UALTI | ULPI alt_int Interrupt This interrupt field is set to 1 when an RXCMDis received through the ULPI interface with bit 7 set (alt_int). The alt_int itself is set when an unmasked event occurs on any bit in the Carkit Interrupt Latch register, in the ULPI PHY. You must read the Carkit Interrupt Latch register (Read to Clear) through the ULPI Viewport to check the source of the interrupt.                                                                                                                                                                                                                                                                                                |
| 10 ULPII | ULPI Interrupt This field is set to 1 by hardware when there is an event completion in the ULPI viewport. This field is usable only if the controller supports ULPI interface mode.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 9 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 8 SLI    | DC Suspend When a controller enters a suspend state from an active state, the value of this field is 1. The device controller clears the field to 0 upon exiting from a suspend state. This field is only used in device operation mode.                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 7 SRI    | SOF Received When the device controller detects a start-of-(micro)frame, this field is set to 1. When a SOF is extremely late, the device controller automatically sets this field to 1 to indicate that an SOF was expected. Therefore, this field is set roughly every 1 ms in device FS mode and every 125 ms in HS mode, and is synchronized to the actual SOF that is received. Because the device controller is initialized to FS before connect, this field is set to 1 at an interval of 1 ms during the prelude to connect and chirp. In host mode, this field is set every 125 µs and can be used by the host controller driver as a time base. You write a 1 to this field to clear it. |
| 6 URI    | USB Reset Received When the device controller detects a USB Reset and enters the default state, this field is set to 1. You can write a 1 to this field to clear the USB Reset Received status field to 0.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | This field is only used in device operation mode.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 5       | Interrupt on Async Advance                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| AAI     | You can force the host controller to issue an interrupt the next time the host controller advances the asynchronous schedule by writing a 1 to USBCMD[IAA]. This status field indicates the assertion of that interrupt source. This field is only used in host operation mode.                                                                                                                                                                                                                                                               |
| 4 SEI   | System Error This field is set to 1 when an error is seen in response to a read on the system interface.                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 3 FRI   | Frame List Rollover The host controller sets this field to 1 when the Frame List Index rolls over from its maximum value to 0. The exact value at which the rollover occurs depends on the frame list size. For example, if the frame list size (as programmed in USBCMD[FS1]) is 1024, USBFrame Index (FRINDEX) rolls over every time FRINDEX [13] toggles. Similarly, if the size is 512, the host controller sets this field to 1 every time FHINDEX [12] toggles. This field is only used in host operation mode.                         |
| 2 PCI   | Port Change Detect The host controller sets this field to 1 when, on any port, a Connect Status occurs, a Port Enable/Disable Change occurs, or the Force Port Resume field is set as the result of a J-K transition on the suspended port. The device controller sets this field to 1 when the port controller enters the FS or HS operational state. Whentheport controller exits the FSorHSoperation states due to Reset or Suspend events, the notification mechanisms are the USB Reset Received and the DCSuspend fields, respectively. |
| 1 UEI   | USB Error Interrupt When completion of a USB transaction results in an error condition, this field is set to 1 by the host/device controller. This field is set to 1, along with the USBSTS[UI] field, if the TD on which the error interrupt occurred also had its IOC field set to 1. The device controller detects resume signaling only.                                                                                                                                                                                                  |
| 0 UI    | USB Interrupt Set by the host/device controller when the cause of an interrupt is a completion of a USB transaction where the TD has an IOC field set to 1. This field is also set by the host/device controller when a short packet is detected. A short packet is when the actual number of bytes received was less than the expected number of bytes.                                                                                                                                                                                      |

## 55.4.1.19 Interrupt Enable (USBINTR)

## Offset

| Register   | Offset   |
|------------|----------|
| USBINTR    | 148h     |

## Function

Enables interrupts to software. An interrupt is generated when a field is 1 and the corresponding interrupt source is active. USB Status (USBSTS) still shows interrupt sources even if they are disabled by the USBINTR, allowing you to poll interrupt events.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                   |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-26 - | Reserved                                                                                                                                                   |
| 25 TIE1 | General Purpose Timer 1 Interrupt Enable When this field is 1 and USBSTS[TI1] is 1, the controller issues an interrupt.                                    |
| 24 TIE0 | General Purpose Timer 0 Interrupt Enable When this field is 1 and USBSTS[TI0] is 1, the controller issues an interrupt.                                    |
| 23-20 - | Reserved                                                                                                                                                   |
| 19 UPIE | USB Host Periodic Interrupt Enable When this field is 1 and USBSTS[UPI] is 1, the host controller issues an interrupt at the next interrupt threshold.     |
| 18 UAIE | USB Host Asynchronous Interrupt Enable When this field is 1 and USBSTS[UAI] is 1, the host controller issues an interrupt at the next interrupt threshold. |
| 17 -    | Reserved                                                                                                                                                   |
| 16 NAKE | NAK Interrupt Enable When this field is 1 and USBSTS[NAKI] is 1, the controller issues an interrupt.                                                       |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                         |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-11 -  | Reserved                                                                                                                                                                         |
| 10 ULPIE | ULPI Interrupt Enable When this field is 1 and USBSTS[ULPII] is 1, the controller issues an interrupt. This field is usable only if the controller supports ULPI interface mode. |
| 9 -      | Reserved                                                                                                                                                                         |
| 8 SLE    | Sleep Interrupt Enable When this field is 1 and USBSTS[SLI] is 1, the controller issues an interrupt. This field is only used in device operation mode.                          |
| 7 SRE    | SOF Received Interrupt Enable When this field is 1 and USBSTS[SRI] is 1, the controller issues an interrupt.                                                                     |
| 6 URE    | USB Reset Interrupt Enable When this field is 1 and USBSTS[URI] is 1, the controller issues an interrupt. This field is only used in device operation mode.                      |
| 5 AAE    | Async Advance Interrupt Enable When this field is 1 and USBSTS[AAI] is 1, the controller issues an interrupt. This field is only used in host operation mode.                    |
| 4 SEE    | System Error Interrupt Enable When this field is 1 and USBSTS[SEI] is 1, the controller issues an interrupt.                                                                     |
| 3 FRE    | Frame List Rollover Interrupt Enable When this field is 1 and USBSTS[FRI] is 1, the controller issues an interrupt. This field is only used in host operation mode.              |
| 2 PCE    | Port Change Detect Interrupt Enable When this field is 1 and USBSTS[PCI] is 1, the controller issues an interrupt.                                                               |
| 1 UEE    | USB Error Interrupt Enable When this field is 1 and USBSTS[UEI] is 1, the controller issues an interrupt.                                                                        |
| 0 UE     | USB Interrupt Enable When this field is 1 and USBSTS[UI] is 1, the controller issues an interrupt.                                                                               |

## 55.4.1.20 USB Frame Index (FRINDEX)

## Offset

| Register   | Offset   |
|------------|----------|
| FRINDEX    | 14Ch     |

## Function

Used by the host controller to index the periodic frame list. The register updates every 125 µs (once each microframe). Bits [N:3] are used to select a particular entry in the periodic frame list during periodic schedule execution. The number of bits used for the index depends on the size of the frame list that you set in USBCMD[FS1].

This register must be written as a DWord. Byte writes produce undefined results. This register cannot be written unless the host controller is in the Halted state as indicated by USBSTS[HCH]. A write to this register while USBCMD[RS] is set to 1 produces undefined results. Writes to this register also affect the SOF value.

In Device mode, this register is read-only, and the device controller updates it using the frame number indicated by the SOF marker. Whenever the USB receives and SOF, FRINDEX [13:3] is checked against the SOF marker. If FRINDEX [13:3] is different from the SOF marker, FRINDEX [13:3] will be set to the SOF value and FRINDEX [2:0] becomes 0 (that is, SOF for a 1 ms frame). If FRINDEX [13:3] is equal to the SOF value, FRINDEX [2:0] is incremented (that is, SOF for a 125 µs microframe.).

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23      | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|---------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0       | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |         |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0       | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7       | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      |      | 0    |      |      |      |      |      |      |         |      |      |      |      |      |      |      |
| W      |      |      |      |      |      |      |      |      | FRINDEX |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0       | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                             |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-14 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                             |
| 13-0 FRINDEX | Frame Index In this field, the value increments at the end of each time frame (microframe). Bits [N:3] are used for the Frame List current index. This means that each location of the frame list is accessed eight times (frames or microframes) before moving to the next index. The following illustrates values of N, based on the value of USBCMD[FS1], when used in Host mode. |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | In Device mode, the value is the current frame number of the last frame transmitted. It is not used as an index. In either mode, bits 2:0 indicate the current microframe. USBCMD [Frame List Size] Number Elements N 00_0000_0000_0000b - (1024) 12 00_0000_0000_0001b - (512) 11 00_0000_0000_0010b - (256) 10 00_0000_0000_0011b - (128) 9 00_0000_0000_0100b - (64) 8 00_0000_0000_0101b - (32) 7 00_0000_0000_0110b - (16) 6 00_0000_0000_0111b - (8) 5 |

## 55.4.1.21 Frame List Base Address or Device Address (PERIODICLISTBASE\_or\_DEVICEADDR)

## Offset

| Register                        | Offset   |
|---------------------------------|----------|
| PERIODICLISTBASE_or _DEVICEADDR | 154h     |

## Function

PERIODICLISTBASE - For host controller only:

Contains the beginning address of the periodic frame list in the system memory. The host controller device (HCD) loads this register prior to starting the schedule execution by the host controller. The memory structure referenced by this physical memory pointer is assumed to be 4 KB aligned. The contents of this register are combined with the ones of USB Frame Index (FRINDEX) to enable the host controller to step through the periodic frame list in sequence.

DEVICEADDR - For device controller only:

The upper seven bits of this register represent the device address. After any controller reset or a USB reset, the device address is set to the default address (0). The default address will match all incoming addresses. You must reprogram the address after receiving a SET\_ADDRESS descriptor.

## Diagram

<!-- image -->

| Bits   | 31                | 30                | 29                | 28                | 27                | 26                | 25                | 24        | 23      | 22      | 21      | 20      | 19      | 18      | 17      | 16      |
|--------|-------------------|-------------------|-------------------|-------------------|-------------------|-------------------|-------------------|-----------|---------|---------|---------|---------|---------|---------|---------|---------|
| R W    | USBADR_or_PERBASE | USBADR_or_PERBASE | USBADR_or_PERBASE | USBADR_or_PERBASE | USBADR_or_PERBASE | USBADR_or_PERBASE | USBADR_or_PERBASE | USBA DDRA | PERBASE | PERBASE | PERBASE | PERBASE | PERBASE | PERBASE | PERBASE | PERBASE |
| Reset  | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0         | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       |
| Bits   | 15                | 14                | 13                | 12                | 11                | 10                | 9                 | 8         | 7       | 6       | 5       | 4       | 3       | 2       | 1       | 0       |
| R      |                   |                   |                   |                   | 0                 | 0                 | 0                 | 0         | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       |
| W      | PERBASE           | PERBASE           | PERBASE           | PERBASE           |                   |                   |                   |           |         |         |         |         |         |         |         |         |
| Reset  | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0         | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       |

## Fields

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-25 USBADR_or_P ERBASE | Device Address (For Device mode) or PERBASE (For Host mode) Device mode: These bits correspond to the USB device address. Host mode: See the PERBASE description.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 24 USBADDRA              | Device Address Advance (For Device mode) or Reserved (For Host mode) Device mode: Whenthis field is 0, any writes to USBADRareinstantaneous. Whenthis field is written to 1 at the sametime or before USBADRis written, the write to the USBADRfield is staged and held in a hidden register. After an IN occurs on endpoint 0 and generates an ACK response, USBADR is loaded from the holding register. Hardware automatically clears this field to 0 on the following conditions: • IN generates an ACK to endpoint 0 (USBADR is updated from the hidden register). • OUT/SETUP occurs to endpoint 0 (USBADR is not updated). • Device Reset occurs (USBADR is reset to 0). • After the status phase of the SET_ADDRESS descriptor, the DCD has 2 ms to program the USBADR field. This mechanism ensures that this specification is met when the DCD cannot execute a write of the device address within 2 ms from the SET_ADDRESSstatus phase. If the DCDwrites the USBADRwith USBADRA=1after the SET_ADDRESS data phase (before the prime of the status phase), the USBADR is programmed instantly at the correct time and meet the 2 ms USB requirement. • This field is reserved for Host mode operation. NOTE |
| 23-12 PERBASE            | PERBASE (For Host mode) or Reserved (for Device mode) Periodic List Base Address Corresponds to memory address signals [31:12].                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

Table continued from the previous page...

| Field   | Function                                                                                               |
|---------|--------------------------------------------------------------------------------------------------------|
|         | This field is only used by the host controller. This field is reserved for Device mode operation. NOTE |
| 11-0    | Reserved                                                                                               |

## 55.4.1.22 Next Asynchronous Address or Endpoint List Address (ASYNCLISTADDR\_or\_ENDPOINTLISTADDR)

## Offset

| Register                           | Offset   |
|------------------------------------|----------|
| ASYNCLISTADDR_or_E NDPOINTLISTADDR | 158h     |

## Function

Next asynchronous address - for host controller only:

Contains the address of the next asynchronous QH to be executed by the host. You cannot modify bits [4:0] of this register, and when you read them they always return 0s.

Endpoint list address - for device controller only:

In Device mode, this register contains the address of the top of the endpoint list in system memory. You cannot modify bits [10:0] of this register, and when you read them they always return 0s.

The memory structure referenced by this physical memory pointer is assumed to be 64 bytes.

## Diagram

<!-- image -->

## Fields

| Field                     | Function                                                                                                                                                                                                                                                                                        |
|---------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-11 EPBASE_or_AS YBASE  | Endpoint List Pointer (Low) (for Device mode) or Link Pointer Low (LPL) (for Host mode) Device mode: These bits correspond to memory address signals [31:11]. This field references a list of up to 32 QH (that is, one QH per endpoint and direction). Host mode: See the ASYBASE description. |
| 10-5 ASYBASE_or_ RESERVED | Link Pointer Low (LPL) (for Host mode) or Reserved (for Device mode) Host mode: These bits correspond to memory address signals [31:5]. This field may only reference a QH. This field is reserved for Device mode operation. NOTE                                                              |
| 4-0 -                     | Reserved                                                                                                                                                                                                                                                                                        |

## 55.4.1.23 Programmable Burst Size (BURSTSIZE)

## Offset

| Register   | Offset   |
|------------|----------|
| BURSTSIZE  | 160h     |

## Function

Controls the burst size used during data movement on the AHB master interface. The register is ignored if SBUSCFG[AHBBRST] is a non-zero value.

## NOTE

The AHB maximum burst length is 16 beats. Each beat can be 4 bytes; therefore, the maximum burst supported on the AHB is 64 bytes.

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
|--------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|
| R      | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| W      |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| Bits   | 15       | 14       | 13       | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R W    | TXPBURST | TXPBURST | TXPBURST | TXPBURST | TXPBURST | TXPBURST | TXPBURST | TXPBURST | RXPBURST | RXPBURST | RXPBURST | RXPBURST | RXPBURST | RXPBURST | RXPBURST | RXPBURST |
| Reset  | 0        | 0        | 0        | 1        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 1        | 0        | 0        | 0        | 0        |

## Fields

| Field         | Function                                                                                                                                                                                      |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -       | Reserved                                                                                                                                                                                      |
| 15-8 TXPBURST | Programmable TX Burst Size HWTXBUF[TXBURST] determines the default value. This field represents the maximum burst length in 32-bit words while moving data from system memory to the USB bus. |
| 7-0 RXPBURST  | Programmable RX Burst Size HWRXBUF[RXBURST] determines the default value. This field represents the maximum burst length in 32-bit words while moving data from the USB bus to system memory. |

## 55.4.1.24 TX FIFO Fill Tuning (TXFILLTUNING)

## Offset

| Register     | Offset   |
|--------------|----------|
| TXFILLTUNING | 164h     |

## Function

The fields in this register control performance tuning associated with how the host controller posts data to the TX latency FIFO before moving the data onto the USB bus. The specific areas of performance include how much data to post into the FIFO and an estimate of the length the operation should take in the target system.

## Definitions:

T 0 = Standard packet overhead

T 1 = Time to send data payload

T ff = Time to fetch packet into TX FIFO up to specified level

Universal Serial Bus On-The-Go Controller (USBOTG)

T s = Total Packet Flight Time (send-only) packet

<!-- formula-not-decoded -->

T p = Total Packet Time (fetch and send) packet

<!-- formula-not-decoded -->

Upon discovery of a transmit (OUT/SETUP) packet in the data structures, the host controller checks to ensure T p remains before the end of the (micro)frame. If so, it proceeds to pre-fill the TX FIFO. If at any time during the pre-fill operation the time remaining the [micro]frame is &lt; T s , then the packet attempt ceases and the packet is tried at a later time. Although this is not an error condition and the host controller eventually recovers, a mark is made to the scheduler health counter to note the occurrence of a "back-off" event. When a back-off event is detected, the partial packet fetched may need to be discarded from the latency buffer to make room for periodic traffic that begins after the next SOF. Too many back-off events can waste bandwidth and power on the system bus and thus must be minimized (not necessarily eliminated). Back-offs can be minimized with use of the TSCHHEALTH (T ff ) described below.

## Diagram

<!-- image -->

1. Reset value is implementation-dependent.

## Fields

| Field             | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-22 -           | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 21-16 TXFIFOTHRES | FIFO Burst Threshold Controls the number of data bursts that are posted to the TX latency FIFO in host mode before the packet begins on the bus. The minimum value is two, and this value must be as small as possible to maximize USB performance. A higher value can be used in systems with unpredictable latency and/or insufficient bandwidth for which the FIFO may underrun because the data transferred from the latency FIFO to theUSB occurs before it can be refreshed from system memory. This value is ignored if USBMODE[SDIS] is 1. |
| 15-13 -           | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 12-8              | Scheduler Health Counter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

Table continued from the previous page...

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|--------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TXSCHHEALT H | Increments when the host controller fails to fill the TX latency FIFO to the level programmed by TXFIFOTHRES before running out of time to send the packet before the next Start-Of-Frame. This health counter measures the numberof times this occurs to provide feedback toselectingaproperTXSCHOH.The maximum value for this counter is 31, and writing to this register clears the counter.                                                                                                                                                                                                      |
| 7 -          | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 6-0 TXSCHOH  | Scheduler Overhead This field adds a fixed offset to the schedule time estimator described aboveasT ff . As an approximation, the value chosen for this register must limit the number of back-off events captured in the TXSCHHEALTH to less than 10 per second in a high-usage bus. Choosing a value that is too high for this register is not desired as it can needlessly reduce USB utilization. The time unit represented in this register is 1.267 µs when a device is connected in HS mode. The time unit represented in this register is 6.333 µs when a device is connected in LS/FS mode. |

## 55.4.1.25 IC\_USB Enable and Voltage Negotiation (IC\_USB)

## Offset

| Register   | Offset   |
|------------|----------|
| IC_USB     | 16Ch     |

## Function

Enables and controls the IC-USB FS or LS transceiver.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18      | 17      | 16      |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|---------|---------|---------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0       | 0       | 0       |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |         |         |         |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0       | 0       | 0       |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2       | 1       | 0       |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | IC1  | IC_VDD1 | IC_VDD1 | IC_VDD1 |
| W      |      |      |      |      |      |      |      |      |      |      |      |      | IC1  |         |         |         |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0       | 0       | 0       |

## Fields

| Field       | Function                                                                                                                                                                                                                                                          |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-4 -      | Reserved                                                                                                                                                                                                                                                          |
| 3 IC1       | Inter-Chip Transceiver Enable Enables the inter-chip transceiver. To enable the IC-USB interface, the PTS bits in the PORTSC1 register also need to be set correspondingly. See PORTSC1. If IC1 is enabled, IOMUX must set the DP/DM pad into loopback mode. NOTE |
| 2-0 IC_VDD1 | Indicates which voltage is being supplied to the peripheral. The field is set to 000b in the case of a device controller. 000b - No voltage 001b - 1.0 V 010b - 1.2 V 011b - 1.5 V 100b - 1.8 V 101b - 3.0 V 110b - Reserved 111b - Reserved                      |

## 55.4.1.26 ULPI Register Access (ULPI\_VIEWPORT)

## Offset

| Register      | Offset   |
|---------------|----------|
| ULPI_VIEWPORT | 170h     |

## Function

Provides indirect access to the ULPI PHY register set. Although the controller modules perform access to the ULPI PHY register set, there may be circumstances for which you need direct access.

## CAUTION

Writes to the ULPI through the ULPI viewport can substantially harm standard USB operations. No usage model has been defined in which you should need to execute writes directly to the ULPI. Executing read operations though the ULPI viewport must have no harmful side effects to standard USB operations. Also, if the ULPI interface is not enabled, this register is always read-cleared.

There are two operations that can be performed with the ULPI viewport: wake-up and read/write. The wake-up operation is used to put the ULPI interface into normal operation mode and re-enable the clock if necessary. A wake-up operation is required before accessing the registers when the ULPI interface is operating in low-power mode, serial mode, or carkit mode. The ULPI state can be determined by reading the sync state field (ULPI\_VIEWPORT[ULPI\_SS]). If this field is 1, then the ULPI

Universal Serial Bus On-The-Go Controller (USBOTG)

interface is running in normal operating mode and can accept read/write operations. If ULPI\_VIEWPORT[ULPI\_SS] becomes 0, then read/write operations are not executed. Undefined behavior results if a read or write operation is performed when ULPI\_VIEWPORT[ULPI\_SS] becomes 0. To execute a wake-up operation, you write all 32-bits of the ULPI VIEWPORT where ULPI\_VIEWPORT[ULPI\_PORT] is constructed appropriately, the ULPI\_WU field is set to 1, and ULPI\_VIEWPORT[ULPI\_RUN] is cleared to 0. You must poll this register until the ULPI\_WU field is cleared to 0 in order for the operation to complete.

To execute a read or write operation, you must write to all 32-bits of this register, where ULPI\_DATWR, ULPI\_ADDR, ULPI\_PORT, and ULPI\_RW fields are constructed appropriately and the ULPI\_RUN field is 1. Poll the register until ULPI\_RUN becomes 0 in order for the operation to complete. For read operations, ULPI\_DATRD is valid after ULPI\_RUN becomes 0.

The polling method above can be replaced with interrupts using the ULPI interrupt defined in USB Status (USBSTS) and Interrupt Enable (USBINTR). When a wake-up or read/write operation completes, the ULPI interrupt is set.

## Diagram

<!-- image -->

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                               |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 ULPI_WU  | ULPI Wake-Up Writing a 1 to this field begins the wake-up operation. This field is automatically cleared to 0 after the wake-up is complete. After this field is set to 1, it cannot be cleared to 0 by you. The driver must never execute a wake-up and a read/write operation at the same time. NOTE |
| 30 ULPI_RUN | ULPI Run Writing this field to 1 begins a read/write operation. This field is automatically cleared to 0 after the read/write is complete. After this field is set to 1, it cannot be cleared to 0 by you. The driver must never execute a wake-up and a read/write operation at the same time. NOTE   |
| 29 ULPI_RW  | ULPI Read/Write Selects between running a read or write operation to the ULPI. 0b - Read 1b - Write                                                                                                                                                                                                    |

Table continues on the next page...

## Table continued from the previous page...

| Field           | Function                                                                                                                                                                                                                                                                                          |
|-----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 28 -            | Reserved                                                                                                                                                                                                                                                                                          |
| 27 ULPI_SS      | ULPI Sync State Represents the state of the ULPI interface. Before reading this field, the ULPI_PORT field must be set accordingly if used with the multi-port host. Otherwise, this field must always remain 0. 0b - Any other state (that is, carkit, serial, low-power) 1b - Normal sync state |
| 26-24 ULPI_PORT | ULPI Port Number For wake-up or read/write operations, this value selects the port number to which the ULPI PHYis attached. Valid values are 0 and 1.                                                                                                                                             |
| 23-16 ULPI_ADDR | ULPI Data Address When a read or write operation is commanded, the address of the operation is written to this field.                                                                                                                                                                             |
| 15-8 ULPI_DATRD | ULPI Data Read After a read operation completes, the result is placed in this field.                                                                                                                                                                                                              |
| 7-0 ULPI_DATWR  | ULPI Data Write When a write operation is commanded, the data to be sent is written to this field.                                                                                                                                                                                                |

## 55.4.1.27 Endpoint NAK (ENDPTNAK)

## Offset

| Register   | Offset   |
|------------|----------|
| ENDPTNAK   | 178h     |

## Function

This status register indicates whether the device has sent NAK on the corresponding endpoint.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | EPTN | EPTN | EPTN | EPTN | EPTN | EPTN |
| W      |      |      |      |      |      |      |      |      |      |      | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | EPRN | EPRN | EPRN | EPRN | EPRN | EPRN |
| W      |      |      |      |      |      |      |      |      |      |      | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field      | Function                                                                                                                                                                                                              |
|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-22 -    | Reserved                                                                                                                                                                                                              |
| 21-16 EPTN | TX Endpoint NAK Each TX endpoint has 1 in this field. The field is 1 when the device sends a NAK handshake on a received IN token for the corresponding endpoint. Bit [N] - Endpoint #[N], where N is 0 to 5          |
| 15-6 -     | Reserved                                                                                                                                                                                                              |
| 5-0 EPRN   | RX Endpoint NAK Each RX endpoint has 1 in this field. The field is 1 when the device sends a NAK handshake on a received OUT or PING token for the corresponding endpoint. Bit [N] - Endpoint #[N], where N is 0 to 5 |

## 55.4.1.28 Endpoint NAK Enable (ENDPTNAKEN)

## Offset

| Register   | Offset   |
|------------|----------|
| ENDPTNAKEN | 17Ch     |

## Function

This configuration register is used to enable interrupts corresponding to NAK received on a particular endpoint.

Universal Serial Bus On-The-Go Controller (USBOTG)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21    | 20    | 19    | 18    | 17    | 16    |
|--------|------|------|------|------|------|------|------|------|------|------|-------|-------|-------|-------|-------|-------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |       |       |       |       |       |       |
| W      |      |      |      |      |      |      |      |      |      |      | EPTNE | EPTNE | EPTNE | EPTNE | EPTNE | EPTNE |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 0     | 0     | 0     |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5     | 4     | 3     | 2     | 1     | 0     |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |       |       |       |       |       |       |
| W      |      |      |      |      |      |      |      |      |      |      | EPRNE | EPRNE | EPRNE | EPRNE | EPRNE | EPRNE |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0     | 0     | 0     | 0     | 0     |

## Fields

| Field       | Function                                                                                                                                                                                                                                                                  |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-22 -     | Reserved                                                                                                                                                                                                                                                                  |
| 21-16 EPTNE | TX Endpoint NAK Enable Each field is an enable field for the corresponding TX Endpoint NAK field. If this field is set to 1 and the corresponding TX Endpoint NAK field is set to 1, then the NAK Interrupt field is set to 1. Bit [N] - Endpoint #[N], where N is 0 to 5 |
| 15-6 -      | Reserved                                                                                                                                                                                                                                                                  |
| 5-0 EPRNE   | RX Endpoint NAK Enable Each field is an enable field for the corresponding RX Endpoint NAK field. If this field is set to 1 and the corresponding RX Endpoint NAK field is set to 1, then the NAK Interrupt field is set to 1. Bit [N] - Endpoint #[N], where N is 0 to 5 |

## 55.4.1.29 Configure Flag (CONFIGFLAG)

## Offset

| Register   | Offset   |
|------------|----------|
| CONFIGFLAG | 180h     |

## Function

This EHCI register is not used in this implementation. A read from this register returns a constant of 0000\_0001h to indicate that all port routings default to this host controller.

Universal Serial Bus On-The-Go Controller (USBOTG)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 1    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 1    |

## Fields

| Field   | Function                                             |
|---------|------------------------------------------------------|
| 31-1    | Reserved                                             |
| -       | (0000_0001h; all port routings default to this host) |
| 0       | Reserved                                             |
| -       | (0000_0001h; all port routings default to this host) |

## 55.4.1.30 Port Status and Control (PORTSC1)

## Offset

| Register   | Offset   |
|------------|----------|
| PORTSC1    | 184h     |

## Function

## Host controller

A host controller could implement one to eight of these port status and control registers. The number is determined by the N\_PORTs bits in the HCSPARAMS register (see HCSPARAMS). You can read this parameter register to determine how many ports need service.

Both of the controller cores are single-port hosts, so there is only one port status and control register for each controller core.

This register is only reset by power-on reset or controller core reset. The initial conditions of a port are:

- No device connected
- Port disabled

If the port supports power control, the device controller state remains until port power is supplied (by you).

A device controller has only port register one (PORTSC1) and it does not support power control. Port control in Device mode is only used for status port reset, suspend, and current connect status. It is also used to initiate Test mode or force signaling, and allows you to put the PHY into low-power Suspend mode and disable the PHY clock.

Universal Serial Bus On-The-Go Controller (USBOTG)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | PTS1 |      | STS  | PTW  | PSPD |      | PTS0 | PFSC | PHCD | WKOC | WKDS | WKCN |      | PTC  |      |      |
| W      |      |      |      |      |      |      | PTS0 |      |      |      |      |      |      | PTC  |      |      |
| Reset  | 1    | 0    | 0    | 0    | 1    | 1    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | PIC  |      | PO   | PP   | LS   |      | HSP  | PR   | SUSP | FPR  | OCC  | OCA  | PEC  | PE   | CSC  | CCS  |
| W      |      |      |      |      |      |      |      |      |      |      | W1C  |      | W1C  | PE   | W1C  |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 1    | 0    | 0    |

## Fields

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-30 PTS1 | Parallel Transceiver Select This field consists of PTS1 and PTS0. All USBport interface modes are listed in this field description, but not all are supported. For the feature details of each controller core, see Features. The behavior is unknown when an unsupported interface mode is selected. NOTE 000 UTMI/UTMI+ 001 Reserved 010 ULPI 011 Serial/USB 1.1 PHY/IC-USB (FS only) 100 HSIC 101 Reserved 110 Reserved 111 Reserved                                                                                                                                                                     |
| 29 STS     | Serial Transceiver Select The serial interface engine can be used in combination with the UTMI+/ULPI physical interface to provide FS or LS signaling instead of the parallel interface signals. When this field is 1, the serial interface engine is used instead of the parallel interface signals. This field has no effect unless the PTS field is configured to select the UTMI+/ULPI interface. The Serial/USB1.1 PHY/IC-USB uses the serial interface engine for FS or LS signaling regardless of this field's value. 0b - Parallel interface signals selected 1b - Serial interface engine selected |
| 28         | Parallel Transceiver Width                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table continued from the previous page...

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PTW        | This field has no effect if serial interface engine is used. These register bits are implementation-dependent. 0b - Select the 8-bit UTMI interface [60MHz] 1b - Select the 16-bit UTMI interface [30MHz]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 27-26 PSPD | Port Speed Indicates the speed at which the port is operating. 00b - FS 01b - LS 10b - HS 11b - Undefined                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 25 PTS0    | PTS0 See the description in PTS1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 24 PFSC    | Port Force FS Connect When this field is set to 1, the port is forced to only connect at FS, It disables the chirp sequence that allows the port to identify itself as FS. 0b - Normal operation 1b - Forced to FS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 23 PHCD    | PHY Low Power Suspend - Clock Disable When this field is 1, the PHY clock is disabled. Reading this field indicates the status of the PHY clock. The PHY clock cannot be disabled if it is being used as the system clock. NOTE In Device mode, the PHY can be put into low-power Suspend mode when the device is not running (USBCMD Run/Stop=0) or the host has signaled suspend (PORTSC1 SUSPEND=1). PHY Low Power Suspend is cleared automatically when the host initials resume. Before forcing a resume from the device, the DCD must clear this field. InHostmode,thePHYcanbeputintolow-powerSuspendmodewhenthedownstreamdevicehasbeenput into Suspend mode or when no downstream device is connected. Low-power Suspend mode is completely under your control. 0b - Enable PHY clock 1b - Disable PHY clock |
| 22 WKOC    | Wake on Over-current Enable Writing this field to 1 enables the port to be sensitive to over-current conditions as wake-up events. This field is 0 if PORTSC1 is 0.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 21 WKDS   | Wake on Disconnect Enable Writing this field to 1 enables the port to be sensitive to device disconnects as wake-up events. This field is 0 if PORTSC1 is 0 or is in Device mode.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 20 WKCN   | Wake on Connect Enable Writing this field to a 1 enables the port to be sensitive to device connects as wake-up events. This field is 0 if PORTSC1 is 0 or is in Device mode.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 19-16 PTC | Port Test Control The FORCE_ENABLE_FS and FORCE ENABLE_LS are extensions to the test mode support specified in the EHCI specification. Writing the PTC field to any of the FORCE_ENABLE_{HS, FS, or LS} values forces the port into the connected and enabled state at the selected speed. Writing the PTC field back to TEST_MODE_DISABLE allows the port state machines to progress normally from that point. LS operations are not supported as a peripheral device. NOTE Any value other than 0h indicates that the port is operating in Test mode. 0000b - TEST_MODE_DISABLE 0001b - J_STATE 0010b - K_STATE 0011b - SE0 (host) / NAK (device) 0100b - Packet 0101b - FORCE_ENABLE_HS 0110b - FORCE_ENABLE_FS 0111b - FORCE_ENABLE_LS |
| 15-14 PIC | Port Indicator Control Writing to this field has no effect if HCSPARAMS[PI] is 0. See "USB Specification Revision 2.0" for a description on how these fields are to be used. This field is 0 if port power is 0. Field-value encoding: 00b - Port indicators are off 01b - Amber 10b - Green 11b - Undefined                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 13        | Port Owner                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PO       | This field unconditionally goes to 0 when the configured field in Configure Flag (CONFIGFLAG) makes a 0 to 1 transition. This field unconditionally goes to 1 whenever the Configured field is 0. You use this field to release ownership of the port to a selected host controller (if the attached device is not an HS device). You write 1 to this field when the attached device is not an HSdevice. A1in this field means that an internal companion controller owns and controls the port. Port owner hand-off is not supported, therefore this field is always 0.                                                                                                                                                                                     |
| 12 PP    | Port Power The function of this field depends on the value of HCSPARAMS[PPC]. The behavior is as follows: PPC PP Operation 0 1b - Read Only. The host controller does not have port power control switches. Each port is hard-wired to power. 1 1b/0b - Read/Write. Host/OTG controller requires port power control switches. This field represents the current setting of the switch (0=off, 1=on). When power is not available on a port (that is, PP equals 0), the port is non-functional and does not report attaches, detaches, and so on. When an over-current condition is detected on a powered port and PPC is 1, the PP field in each affected port may be transitioned by the host controller driver from 1 to 0 (removing power from the port). |
| 11-10 LS | Line Status Reflects the current logical levels of the D+ (bit 11) and D- (bit 10) signal lines. In host mode, the use of linestate by the host controller driver is not necessary (unlike EHCI), because the port controller state machine and the port routing manage the connection of LS and FS. In device mode, the use of linestate by the DCD is not necessary. The encoding of the bits [11:10] are: 00b - SE0 01b - K-state 10b - J-state 11b - Undefined                                                                                                                                                                                                                                                                                           |
| 9 HSP    | HS Port When the field is 1, the host/device connected to the port is in HSmode; when this field is 0, the host/device connected to the port is not in HS mode. HSP is redundant with PSPD (bit 27, 26) but is retained for compatibility. NOTE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 8 PR     | Port Reset In Host mode, this field is R/W. When you write 1 to this field, the bus reset sequence begins as defined in USB Specification Revision 2.0. This field automatically changes to 0 after the reset sequence is completed. This behavior is different from                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | the EHCI in which the host controller driver is required to clear this field to 0 after the reset duration is timed in the driver. In Device mode, this field is read-only. Device reset from the USB bus is also indicated in USB Status (USBSTS). This field is 0 if PORTSC1[PP] is 0. 0b - Port is not in Reset 1b - Port is in Reset                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 7 SUSP  | Suspend 1 - Port is in suspend state 0 - Port is not in suspend state In Host mode: Read/Write PORTSC1[PE] and PORTSC1[SUSP] of this register define the port states as follows: Bits [Port Enabled, Suspend] Port State 0x - Disabled 10 - Enabled 11 - Suspended Wheninthe Suspend state, the downstream propagation of data is blocked on this port except for port reset. The blocking occurs at the end of the current transaction if a transaction was in progress when this field was written to 1. In the Suspend state, the port is sensitive to resume detection. The field status does not change until the port is suspended, and there may be a delay in suspending a port if there is a transaction currently in progress. The host controller unconditionally clears this field to 0 when you set the Force Port Resume field to 0. The host controller ignores a write of 0 to this field. If the host software sets this field to 1 when the port is not enabled (that is, the Port enabled field is 0), the results are undefined. This field is 0 if PORTSC1[PP] is 0 in Host mode. In Device mode: Read Only |
| 6 FPR   | Force Port Resume In Host mode: You set this field to 1 to drive resume signaling. The host controller sets this field to 1 if a J-to-K transition is detected while the port is in the Suspend state. When this field transitions to a 1 because a J-to-K transition is detected, the Port Change Detect field in the USBSTS register is also set to 1. This field automatically changes to 0after the resumesequenceis completed. This behavior is different from EHCI, in which the host controller driver is required to set this field to 0 after the resume duration is timed in the driver. NOTE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | Whenthe Host controller owns the port, the resume sequence follows the defined sequence documented in the USB Specification Revision 2.0. The resume signaling (FS, 'K') is driven on the port as long as this field remains 1. This field remains 1 until the port has switched to HSidle. Writing 0 has no effect because the port controller times the resume operation to clear the field when the port control state switches to HSor FS idle. This field is 0 if PORTSC1[PP] is 0 in Host mode. This field is not EHCI-compatible. In Device mode: After the device has been in the Suspend state for 5 ms or more, you must set this field to 1 to drive resume signaling before clearing. The Device Controller sets this field to 1 if a J-to-K transition is detected while the port is in the Suspend state. Thefield is cleared to 0 whenthe device returns to normal operation. Also,when this field transitions to a 1 because a J-to-K transition detected, USBSTS[PCI] is also set to 1. Field values: 0b - No resume (K-state) detected/driven on port 1b - Resume detected/driven on port |
| 5 OCC   | Over-Current Change This field is set to 1 by hardware when there is a change to Over-current Active. You can clear this field to 0 by writing 1 to it.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 4 OCA   | Over-Current Active Automatically transitions from 1 to 0 when the over-current condition is removed. 0b - This port does not have an over-current condition 1b - This port presently has an over-current condition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 3 PEC   | Port Enable/Disable Change In Host mode: For the root hub, this field is set to 1 only when a port is disabled due to disconnect on the port or due to the appropriate conditions existing at the EOF2 point (See Chapter 11 of the USB Specification). You clear this field to 0 by writing 1 to it. This field is 0 if PORTSC1[PP] is 0. In Device mode: The device port is always enabled, so this field is always 0. 0b - No change 1b - Port enabled/disabled status has changed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 2 PE    | Port Enabled/Disabled In Host mode: Ports can only be enabled by the host controller as a part of the reset and enable. You cannot enable a port by writing 1 to this field. Ports can be disabled by a disconnect event or other fault condition, or by the host                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | software. The field status does not change until the port state actually changes. There may be a delay in disabling or enabling a port due to other host controller and bus events. When the port is disabled (0), downstream propagation of data is blocked except for reset. This field is 0 if PORTSC1[PP] is 0 in host mode. In Device mode: The device port is always enabled, so this field is always 1. 0b - Disabled 1b - Enabled                                                                                                                                                                                                                                               |
| 1 CSC   | Connect Status Change In Host mode: Indicates that a change has occurred in the port's Current Connect Status. The host/device controller sets this field for all changes to the port device connect status, even if system software has not cleared anexisting connect status change. For example, if the insertion status changes twice before the system software has cleared the changed condition, the hub hardware is setting an already-set field (that is, the field remains set). You clear this field to 0 by writing a 1 to it. This field is 0 if PORTSC1[PP] is 0 in Host mode. In Device mode: This field is undefined in device controller mode.                         |
| 0 CCS   | Current Connect Status In Host mode: 0 = No device is present 1 = Device is present on port This value reflects the current state of the port, and may not correspond directly to the event that caused the Connect Status Change field (bit 1) to be set to 1. This field is 0 if PORTSC1[PP] is 0 in Host mode. In Device mode: Avalue of 1 in this field indicates that the device successfully attached and is operating in eitherHSorFSas indicated by the HSPort field in this register. A 0 indicates that the device did not attach successfully or you forcibly disconnected it by writing a 0 to USBCMD[RS]. It does not identify the device being disconnected or suspended. |

## 55.4.1.31 OTG Status Control (OTGSC)

## Offset

| Register   | Offset   |
|------------|----------|
| OTGSC      | 1A4h     |

## Function

This register has four sections:

- OTG Interrupt enables (Read/Write)
- OTG Interrupt status (Read/Write to Clear)
- OTG Status inputs (Read Only)
- OTG Controls (Read/Write)

The status inputs are debounced using a 1 ms time constant. Values on the status inputs that do not persist for more than 1 ms do not cause an update of the status inputs (bits 14:0 of this register) or cause an OTG interrupt.

Also see USBMODE.

## Diagram

<!-- image -->

| Bits    |   31 | 30   | 29       | 28    | 27    | 26    | 25    | 24   | 23   | 22       | 21        | 20        | 19        | 18        | 17        | 16   |
|---------|------|------|----------|-------|-------|-------|-------|------|------|----------|-----------|-----------|-----------|-----------|-----------|------|
| R W     |    0 | DPIE | TIMIE    | BSEIE | BSVIE | ASVIE | AVVIE | IDIE | 0    | DPIS W1C | TIMIS W1C | BSEIS W1C | BSVIS W1C | ASVIS W1C | AVVIS W1C | IDIS |
| Reset   |    0 | 0    | 0        | 0     | 0     | 0     | 0     | 0    | 0    | 0        | 0         | 0         | 0         | 0         | 0         | 0    |
| Bits    |   15 | 14   | 13       | 12    | 11    | 10    | 9     | 8    | 7    | 6        | 5         | 4         | 3         | 2         | 1         | 0    |
| R       |    0 | DPS  | TIM_ TOG | BSE   | BSV   | ASV   | AVV   | ID   | HABA | HADP     | IDPU      | DP        | OT        | HAAR      | VC        | VD   |
| W Reset |    0 | 0    | 0        | 1     | 0     | 0     | 0     | 0    | 0    | 0        | 1         | 0         | 0         | 0         | 0         | 0    |

## Fields

| Field    | Function                                                                                        |
|----------|-------------------------------------------------------------------------------------------------|
| 31 -     | Reserved                                                                                        |
| 30 DPIE  | Data Pulse Interrupt Enable                                                                     |
| 29 TIMIE | One-Millisecond Timer Interrupt Enable (1MsE)                                                   |
| 28 BSEIE | B Session End Interrupt Enable Writing 1 to this field enables the B session end interrupt.     |
| 27 BSVIE | B Session Valid Interrupt Enable Writing 1 to this field enables the B session valid interrupt. |
| 26 ASVIE | A Session Valid Interrupt Enable Writing 1 to this field enables the A session valid interrupt. |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                           |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 25 AVVIE | A VBus Valid Interrupt Enable Writing 1 to this field enables the A VBus valid interrupt.                                                                                                                                          |
| 24 IDIE  | USB ID Interrupt Enable Writing 1 to this field enables the USB ID interrupt.                                                                                                                                                      |
| 23 -     | Reserved                                                                                                                                                                                                                           |
| 22 DPIS  | Data Pulse Interrupt Status This field is set to 1 when data bus pulsing occurs on DP or DM. Data bus pulsing is only detected when USBMODE[CM] = 3 (host) and PORTSC1[PP] = 0. You must write a 1 to this field to clear it to 0. |
| 21 TIMIS | One-Millisecond Timer Interrupt Status (1MsS) This field is set once every millisecond. You must write a 1 to this field to clear it to 0.                                                                                         |
| 20 BSEIS | B Session End Interrupt Status This field is set to 1 when VBus has fallen below the Bsession end threshold. You must write a 1 to this field to clear it to 0.                                                                    |
| 19 BSVIS | B Session Valid Interrupt Status This field is set to 1 when VBus has either risen above or fallen below the B session valid threshold (0.8 VDC). You must write a 1 to this field to clear it to 0.                               |
| 18 ASVIS | A Session Valid Interrupt Status This field is set to 1 when VBus has either risen above or fallen below the A session valid threshold (0.8 VDC). You must write a 1 to this field to clear it to 0.                               |
| 17 AVVIS | A VBus Valid Interrupt Status This field is set to 1 when VBus has either risen above or fallen below the VBus valid threshold (4.4 VDC) on an A device. You must write a 1 to this field to clear it to 0.                        |
| 16 IDIS  | USB ID Interrupt Status This field is set to 1 when a change on the ID input has been detected. You must write a 1 to this field to clear it to 0.                                                                                 |
| 15       | Reserved                                                                                                                                                                                                                           |

Table continues on the next page...

## Table continued from the previous page...

| Field      | Function                                                                                                                                                                       |
|------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -          |                                                                                                                                                                                |
| 14 DPS     | Data Bus Pulsing Status 0b - Data bus pulsing is not being detected on the port 1b - Data bus pulsing is being detected on the port                                            |
| 13 TIM_TOG | One-Millisecond Timer Toggle This field toggles once per millisecond.                                                                                                          |
| 12 BSE     | B Session End Indicates VBus is below the B session end threshold.                                                                                                             |
| 11 BSV     | B Session Valid Indicates VBus is above the B session valid threshold.                                                                                                         |
| 10 ASV     | A Session Valid Indicates VBus is above the A session valid threshold.                                                                                                         |
| 9 AVV      | A VBus Valid Indicates VBus is above the A VBus valid threshold.                                                                                                               |
| 8 ID       | USB ID 0b - A device 1b - B device                                                                                                                                             |
| 7 HABA     | Hardware Assist B-Disconnect to A-connect. 0b - Disabled 1b - Enable automatic B-disconnect to A-connect sequence                                                              |
| 6 HADP     | HADP Hardware Assist Data. If set to 1, the hardware assist data pulsing sequence starts.                                                                                      |
| 5 IDPU     | ID Pullup Provides control over the ID pull-up resistor. When this field is 0, the ID input is not sampled. 0b - Pull-up resistor is off 1b - Pull-up resistor is on (default) |
| 4 DP       | Data Pulsing Writing 1 to this field causes the pullup on DP to be asserted for data pulsing during SRP.                                                                       |
| 3 OT       | OTG Termination This field must be set when the OTG device is in device mode; this controls the pulldown on DM.                                                                |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                              |
|---------|-------------------------------------------------------------------------------------------------------|
| 2 HAAR  | Hardware Assist Auto-Reset 0b - Disabled                                                              |
| 1       | 1b - Enable automatic reset after connect on host port Charge                                         |
|         | VBUS                                                                                                  |
| VC      | Writing 1 to this field causes the VBus line to be charged. This is used for VBus pulsing during SRP. |
| 0       | VBUS Discharge                                                                                        |
| VD      | Writing 1 to this field causes VBus to discharge through a resistor.                                  |

## 55.4.1.32 USB Device Mode (USBMODE)

## Offset

| Register   | Offset   |
|------------|----------|
| USBMODE    | 1A8h     |

## Function

Configures various features of the USB controller as given in the field descriptions below.

## Diagram

<!-- image -->

## Fields

| Field   | Function       |
|---------|----------------|
| 31-24   | Reserved       |
| 23-16   | Auto Low Power |

Table continues on the next page...

## Table continued from the previous page...

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|-------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ALP         | Includes one bit per port. To enable or disable this automation for a port, you must write the corresponding bit: 16 + port number - 1. When you enable this field, the PHY is put into low-power when in Suspend (PORTSCx[SUSP]), even if PORTSCx[PHCD] is not set to 1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 15 SRT      | Shorten Reset Time When the controller is in Host mode, this field enables a bypass of the Chirp J/K reset handshake, saving 6-7 msinsimulation time for each reset sequence. This field should only beusedfor initial system integration simulations, and must always be cleared for normal operation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 14-12 TXHSD | Tx to Tx HS Delay                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 11-5 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 4 SDIS      | Stream Disable Mode Device mode: Writing 1 to this field disables double priming on both RX and TX for low bandwidth systems. This mode ensures that when the RX and TX buffers are sufficient to contain an entire packet that the standard double-buffering scheme is disabled to prevent overruns/underruns in bandwidth-limited systems. Note: In HS mode, all packets received are responded to with a NYET handshake when stream disable is active. Host mode: Writing 1 to this field ensures that overruns/underruns of the latency FIFO are eliminated for low bandwidth systems where the RXandTXbuffers are sufficient to contain the entire packet. Enabling stream disable also has the effect of ensuring the TX latency is filled to capacity before the packet is launched onto the USB. Time duration to pre-fill the FIFO becomes significant when stream disable is active. See TXFILLTUNING to characterize the adjustments needed for the scheduler when using this feature. NOTE Underrun may occur while USB controller is operating in streaming mode, and setting this Stream Disable (SDIS) field to 1 ensures avoiding underruns. NOTE NOTE |
| 3 SLOM      | Setup Lockout Mode In Device mode, controls the behavior of the setup lock mechanism. 0b - Setup lockouts on (default) 1b - Setup lockouts off (DCD requires use of Setup Data Buffer Tripwire in USBCMD)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 2 ES    | Endian Select Controls the byte alignment of the transfer buffers to match the host microprocessor. The fields in the microprocessor interface and the data structures are unaffected by the value of this field because they are based on the 32-bit word. Bit Meaning 0b - Little Endian 1b - Big Endian                                                                                                                                                                                                                                                                                 |
| 1-0 CM  | Controller Mode Controller mode is defaulted to the proper mode for host-only and device-only implementations. For those designs that contain both host and device capability, the controller defaults to an idle state and must be initialized to the desired operating mode after reset. For combination host/device controllers, this register can only bewritten once after reset. If it is necessary to switch modes,youmustresetthe controller by writing to USBCMD[RST] before reprogramming this register. 00b - Idle 01b - Reserved 10b - Device Controller 11b - Host Controller |

## 55.4.1.33 Endpoint Setup Status (ENDPTSETUPSTAT)

## Offset

| Register       | Offset   |
|----------------|----------|
| ENDPTSETUPSTAT | 1ACh     |

## Function

For every setup transaction that is received, a corresponding bit in this register is set to 1.

## Diagram

<!-- image -->

## Fields

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                 |
|----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 15-0 ENDPTSETUP STAT | Setup Endpoint Status You must clear or acknowledge the setup transfer by writing a 1 to a respective bit after it has read the setup data from QH. The response to a setup packet with regard to order of operations and total response time is crucial to limiting bus timeouts while the setup lockout mechanism is engaged. See the Device Operational Model for details. This register is only used in Device mode. |

## 55.4.1.34 Endpoint Initialization (ENDPTPRIME)

## Offset

| Register   | Offset   |
|------------|----------|
| ENDPTPRIME | 1B0h     |

## Function

Only used in Device mode. Used to prime endpoints corresponding to transmit and receive.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |      |      |      |      |      |      |
| W      |      |      |      |      |      |      |      |      |      |      | PETB | PETB | PETB | PETB | PETB | PETB |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |      |      |      |      |      |      |
| W      |      |      |      |      |      |      |      |      |      |      | PERB | PERB | PERB | PERB | PERB | PERB |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                       |
|---------|--------------------------------|
| 31-22   | Reserved                       |
| 21-16   | Prime Endpoint Transmit Buffer |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PETB     | For each endpoint, a corresponding bit is used to request that a buffer prepare for a transmit operation in order to respond to a USB IN/INTERRUPT transaction. You must set the corresponding bit to 1 when posting a new TD to an endpoint. The hardware automatically uses this bit to begin parsing for a new TD from the QHandprepareatransmit buffer. Thehardware clears this bit to 0 whentheassociated endpoint(s) is (are) successfully primed. These bits are momentarily set to 1 by the hardware during hardware re-priming operations when a dTD is retired, and the device queue head (dQH) is updated. NOTE PETB[N] - Endpoint #N, N is in 0..5                  |
| 15-6 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 5-0 PERB | Prime Endpoint Receive Buffer For each endpoint, a corresponding bit is used to request that a buffer prepare for a receive operation that occurs whenaUSBhostinitiates a USBOUTtransaction. You must set the corresponding bit to 1 whenever posting a new TD to an endpoint. The hardware automatically uses this bit to begin parsing for a new TD from the QHandprepare a receive buffer. The hardware clears this bit to 0 when the associated endpoint(s) is (are) successfully primed. These bits are momentarily set to 1 by the hardware during hardware re-priming operations when a dTD is retired, and the dQH is updated. NOTE PERB[N] - Endpoint #N, N is in 0..5 |

## 55.4.1.35 Endpoint De-Initialize (ENDPTFLUSH)

## Offset

| Register   | Offset   |
|------------|----------|
| ENDPTFLUSH | 1B4h     |

## Function

Only used in Device mode. Writing 1 to a field(s) in this register causes the associated endpoint(s) to clear any primed buffers.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |      |      |      |      |      |      |
| W      |      |      |      |      |      |      |      |      |      |      | FETB | FETB | FETB | FETB | FETB | FETB |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |      |      |      |      |      |      |
| W      |      |      |      |      |      |      |      |      |      |      | FERB | FERB | FERB | FERB | FERB | FERB |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                           |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-22 -    | Reserved                                                                                                                                                                                                                                                                                                                                                                           |
| 21-16 FETB | Flush Endpoint Transmit Buffer Writing 1 to a field(s) in this register causes the associated endpoint(s) to clear any primed buffers. If a packet is in progress for one of the associated endpoints, then that transfer continues until completion. The hardware clears this register to 0 after the endpoint flush operation is successful. FETB[N] - Endpoint #N, N is in 0..5 |
| 15-6 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                           |
| 5-0 FERB   | Flush Endpoint Receive Buffer Writing 1 to a field(s) in this register causes the associated endpoint(s) to clear any primed buffers. If a packet is in progress for one of the associated endpoints, then that transfer continues until completion. The hardware clears this register to 0 after the endpoint flush operation is successful. FERB[N] - Endpoint #N, N is in 0..5  |

## 55.4.1.36 Endpoint Status (ENDPTSTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| ENDPTSTAT  | 1B8h     |

## Function

Only used in Device mode. One bit for each endpoint indicates the readiness status of the respective endpoint buffer.

Universal Serial Bus On-The-Go Controller (USBOTG)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | ETBR | ETBR | ETBR | ETBR | ETBR | ETBR |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | ERBR | ERBR | ERBR | ERBR | ERBR | ERBR |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-22 -    | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 21-16 ETBR | Endpoint Transmit Buffer Ready One bit for each endpoint indicates status of the respective endpoint buffer. This bit is set to 1 by the hardware as a response to receiving a command from a corresponding bit in the ENDPTPRIME register. There is always a delay between setting a bit to 1 in the ENDPTPRIME register and endpoint indicating ready. This delay time varies based on the current USB traffic and the number of bits set in the ENDPTPRIME register. Buffer ready is cleared by USB reset, by the USB DMA system, or through the ENDPTPRIME register. These bits are momentarily cleared by hardware during hardware endpoint re-priming operations when a dTD is retired, and the dQH is updated. NOTE ETBR[N] - Endpoint #N, N is in 0..5 |
| 15-6 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 5-0 ERBR   | Endpoint Receive Buffer Ready One bit for each endpoint indicates status of the respective endpoint buffer. This bit is set to 1 by the hardware as a response to receiving a commandfromacorresponding bit in the ENDPRIMEregister. There is always a delay between setting a bit to 1 in the ENDPRIME register and endpoint indicating ready. This delay time varies based on the current USBtraffic and the number of bits set to 1 in the ENDPRIMEregister. Buffer ready is cleared to 0 by USB reset, by the USB DMA system, or through the ENDPDINT register. These bits are momentarily cleared to 0 by hardware during hardware endpoint re-priming operations when a dTD is retired, and the dQH is updated. NOTE ERBR[N] - Endpoint #N, N is in 0..5 |

Universal Serial Bus On-The-Go Controller (USBOTG)

## 55.4.1.37 Endpoint Complete (ENDPTCOMPLETE)

## Offset

| Register      | Offset   |
|---------------|----------|
| ENDPTCOMPLETE | 1BCh     |

## Function

Only used in Device mode. Each bit indicates a transmit (IN/INTERRUPT) or receive (OUT/SETUP) event occurred.

## Diagram

<!-- image -->

## Fields

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                        |
|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-22 -    | Reserved                                                                                                                                                                                                                                                                                                                                                                                        |
| 21-16 ETCE | Endpoint Transmit Complete Event Each bit indicates a transmit event (IN/INTERRUPT) occurred and you must read the corresponding endpoint queue to determine the endpoint status. If the corresponding IOC field is set in the TD, then this bit is set simultaneously with the USBSTS[UI]. Writing a 1 clears the corresponding bit in this register to 0. ETCE[N] - Endpoint #N, N is in 0..5 |
| 15-6 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                        |
| 5-0 ERCE   | Endpoint Receive Complete Event Each bit indicates a received event (OUT/SETUP) occurred and you must read the corresponding endpoint queue to determine the transfer status. If the corresponding IOC field is set in the TD, then this bit is set simultaneously with the USBSTS[UI]. Writing a 1 clears the corresponding bit in this register to 0. ERCE[N] - Endpoint #N, N is in 0..5     |

## 55.4.1.38 Endpoint Control 0 (ENDPTCTRL0)

## Offset

| Register   | Offset   |
|------------|----------|
| ENDPTCTRL0 | 1C0h     |

## Function

Every chip implements Endpoint 0 as a control endpoint. This register contains endpoint enable, type, and stall control fields.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | TXE  | 0    | 0    | 0    |      |      | 0    | TXS  |
| W      |      |      |      |      |      |      |      |      | TXE  |      |      |      | TXT  | TXT  |      | TXS  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 1    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | RXE  | 0    | 0    | 0    |      |      | 0    | RXS  |
| W      |      |      |      |      |      |      |      |      | RXE  |      |      |      | RXT  | RXT  |      | RXS  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 1    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field     | Function                                                                   |
|-----------|----------------------------------------------------------------------------|
| 31-24 -   | Reserved                                                                   |
| 23 TXE    | TX Endpoint Enable 1b - Enabled (Endpoint 0 is always enabled)             |
| 22-20 -   | Reserved                                                                   |
| 19-18 TXT | TX Endpoint Type Endpoint 0 is fixed as a Control End Point. 00b - Control |
| 17 -      | Reserved                                                                   |
| 16 TXS    | TX Endpoint Stall                                                          |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | You can write a 1 to this field to force the endpoint to return a STALL handshake to the host. It continues returning STALL until you clear the field to 0 or it is automatically cleared to 0 upon receipt of a new SETUP request. After receiving a SETUP request, this field continues to be cleared by hardware until the associated Endpoint Setup Status (ENDPTSETUPSTAT) bit is cleared to 0. Note: There is a slight delay (50 clocks maximum) between the Endpoint Setup Status (ENDPTSETUPSTAT) bit being cleared to 0 and hardware continuing to clear this field. In most systems, it is unlikely the DCD software will observe this delay. However, should the DCD observe that the STALL field is not set after writing a 1 to it, then follow this procedure: Continually write this STALL field until it is set or until a new SETUP has been received by checking the associated Endpoint Setup Status (ENDPTSETUPSTAT) bit. 0b - Endpoint okay 1b - Endpoint stalled |
| 15-8 -  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 7 RXE   | RX Endpoint Enable 1b - Enabled (Endpoint 0 is always enabled)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 6-4 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 3-2 RXT | RX Endpoint Type Endpoint 0 is fixed as a Control endpoint. 00b - Control                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 1 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 0 RXS   | RX Endpoint Stall You can write a 1 to this field to force the endpoint to return a STALL handshake to the host. It continues returning STALL until you clear the field to 0 or it is automatically cleared to 0 upon receipt of a new SETUP request. 0b - Endpoint is okay 1b - Endpoint is stalled                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

## 55.4.1.39 Endpoint Control (ENDPTCTRL1 - ENDPTCTRL5)

## Offset

| Register   | Offset   |
|------------|----------|
| ENDPTCTRL1 | 1C4h     |
| ENDPTCTRL2 | 1C8h     |
| ENDPTCTRL3 | 1CCh     |
| ENDPTCTRL4 | 1D0h     |
| ENDPTCTRL5 | 1D4h     |

## Function

There is an ENDPTCTRLn register for each endpoint in a device.

## NOTE

If one endpoint direction is enabled and the paired endpoint of opposite direction is disabled, then the unused direction type must be changed from the default control type to any other type (for example, bulk type). Leaving an unconfigured endpoint control causes undefined behavior for the data PID tracking on the active endpoint/direction.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                  |
|---------|-------------------------------------------------------------------------------------------|
| 31-24   | Reserved                                                                                  |
| 23      | TX Endpoint Enable                                                                        |
| TXE     | An endpoint must only be enabled after it has been configured. 0b - Disabled 1b - Enabled |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 22 TXR    | TX Data Toggle Reset Write 1 - Reset PID Sequence Whenever a configuration event is received for this endpoint, you must write a 1 to this field in order to synchronize the data PIDs between the host and the device.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 21 TXI    | TX Data Toggle Inhibit Only used for test and must always be written as 0. Writing a 1 to this field causes this endpoint to ignore the data toggle sequence and always transmit DATA0 for a data packet. 0b - PID sequencing enabled 1b - PID sequencing disabled                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 20 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 19-18 TXT | TX Endpoint Type 00b - Control 01b - Isochronous 10b - Bulk 11b - Interrupt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 17 TXD    | TX Endpoint Data Source 0b - 0 Dual Port Memory Buffer/DMA Engine [DEFAULT] (must always be written as 0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 16 TXS    | TX Endpoint Stall This field is automatically set to 1 upon receipt of a SETUP request if this Endpoint is not configured as a Control Endpoint. It is cleared to 0 automatically upon receipt of a SETUP request if this Endpoint is configured as a Control Endpoint. You can write a 1 to this field to force the endpoint to return a STALL handshake to the Host. It continues to return STALL until you either clear this field to 0 or it is automatically cleared to 0 as above. For a CONTROL type endpoint, there is a slight delay (50 clocks maximum) between the Endpoint Setup Status (ENDPTSETUPSTAT) bit being cleared to 0 and the hardware continuing to clear this field to 0. In most systems, it is unlikely the DCD software will observe this delay. Take care that the STALL field is not set to 1 immediately after writing a 1 to it. Follow this procedure: Continually write this STALL field until it is set to 1 or until a new SETUP has been received by checking the associated Endpoint Setup Status (ENDPTSETUPSTAT) bit. NOTE 0b - Endpoint is okay 1b - Endpoint is stalled |
| 15-8      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 7 RXE   | RX Endpoint Enable An Endpoint must only be enabled after it has been configured. 0b - Disabled 1b - Enabled                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 6 RXR   | RX Data Toggle Reset Whenever a configuration event is received for this Endpoint, you must write a 1 to this field in order to synchronize the data PIDs between the host and the device. 1b - Reset PID Sequence                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 5 RXI   | RX Data Toggle Inhibit Only used for test and must always be written as 0. Writing a 1 to this field causes this endpoint to ignore the data toggle sequence and always accept data packets regardless of their data PID. 0b - Disabled 1b - Enabled                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 4 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 3-2 RXT | RX Endpoint Type 00b - Control 01b - Isochronous 10b - Bulk 11b - Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 1 RXD   | RX Endpoint Data Sink This field must always be written as 0. 0b - Dual Port Memory Buffer/DMA Engine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 0 RXS   | RX Endpoint Stall This field is set to 1 automatically upon receipt of a SETUP request if this Endpoint is not configured as a Control Endpoint. It is cleared to 0 automatically upon receipt a SETUPrequest if this Endpoint is configured as a Control Endpoint, You can write a 1 to this field to force the endpoint to return a STALL handshake to the host. It continues to return STALL until you either clear this field to 0 or it is automatically cleared to 0 as above. After receiving a SETUP request, this field continues to be cleared to 0 by hardware until the associated Endpoint Setup Status (ENDPTSETUPSTAT) bit is cleared to 0. Note: There is a slight delay (50 clocks maximum) between the Endpoint Setup Status (ENDPTSETUPSTAT) bit being cleared to 0 and hardware continuing to clear this bit to 0. In most systems, it is unlikely the DCD software will observe this delay. |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                  |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | However, should the DCD observe that the STALL field is not set after writing a 1 to it, then follow this procedure: Continually write this STALL field until it is set to 1 or until a new SETUP has been received by checking the associated Endpoint Setup Status (ENDPTSETUPSTAT) bit. 0b - Endpoint is okay 1b - Endpoint is stalled |

## 55.4.2 Non-core register descriptions

## 55.4.2.1 UOTGNC memory map

UOTGNC base address: 4406\_4200h

| Offset   | Register              |   Width (In bits) | Access   | Reset value   |
|----------|-----------------------|-------------------|----------|---------------|
| 0h       | Control register (CR) |                32 | RW       | 0000_0000h    |

## 55.4.2.2 Control register (CR)

## Offset

| Register   | Offset   |
|------------|----------|
| CR         | 0h       |

## Diagram

<!-- image -->

## Fields

| Field         | Function                                                                                                                                                                                                                                |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-17 -       | Reserved                                                                                                                                                                                                                                |
| 16 -          | Reserved                                                                                                                                                                                                                                |
| 15 UCMALLBE   | USB Core Master All Byte Enable This field enables assertion of all bytes in all transactions, that is, no transaction is corrected. 0b - No change on line levels. 1b - Assert all byte enables.                                       |
| 14 -          | Reserved                                                                                                                                                                                                                                |
| 13 -          | Reserved                                                                                                                                                                                                                                |
| 12 -          | Reserved                                                                                                                                                                                                                                |
| 11 WAKEUPEN   | User Wake-Up Enable This field enables or disables user wake-up. 0b - Disable 1b - Enable                                                                                                                                               |
| 10 WAKEUPCTRL | User Wake-Up Control You request wake-up using this field. 0b - No wake-up request 1b - Wake-up request is received                                                                                                                     |
| 9 WAKEUPIS    | USB Wake-Up Interrupt Status This field indicates reception of a wake-up interrupt on the USB port. You clear this field by writing 1 to the CR[WAKEUPIC] field. 0b - Wake-up interrupt received 1b - Wake-up interrupt is not received |
| 8 PWRFLTDF    | Vbus Power Fault Status This field indicates the status of Power fault. Default behavior of this field (that is, when CR[PWRFLT]=0):                                                                                                    |

Table continues on the next page...

## Table continued from the previous page...

| Field       | Function                                                                                                                                                                                                                            |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7           | 0b - No power fault 1b - Power fault detected When polarity of Power fault is changed (that is, when CR[PWRFLT]=1), behavior of this field changes to: 0b - Power fault detected 1b - No power fault                                |
| PWRFLTEN    | Enable Vbus Power Fault Detection This field enables detection of Vbus power fault (CR[PWRFLT]). 0b - Disable 1b - Enable                                                                                                           |
| 6 -         | Reserved                                                                                                                                                                                                                            |
| 5 WAKEUPIC  | Clear USB Wake-Up Interrupt 0b - Clears this field (CR[WAKEUPIC]) 1b - Clears the USB Wake-Up Interrupt Status field (CR[WAKEUPIS])                                                                                                 |
| 4 -         | Reserved                                                                                                                                                                                                                            |
| 3 -         | Reserved                                                                                                                                                                                                                            |
| 2 PWRFLT    | Vbus Power Fault Polarity Control This field controls the polarity of power fault. Write to this field to reverse the polarity. See CR[PWRFLTDF] to learn impact of writing to this field. 1b - Reverse the polarity of Power fault |
| 1 CORE_IE   | Enable Interrupt from Core This field enables or disables interrupts from the core. 0b - Disable 1b - Enable                                                                                                                        |
| 0 WAKEUP_IE | USB Wake-Up Interrupt Enable This field enables or disables the wake-up interrupt. You must disable this field after receiving a wake-up interrupt and enable it again prior to going into Suspend mode. 0b - Disable               |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function    |
|---------|-------------|
|         | 1b - Enable |

## 55.5 Functional description

These sections describe the functionality of the various building blocks of the USB.

## 55.5.1 USB dual role device/host controller

The OTG controller is an instantiation of EHCI-compatible USB core that supports HS, FS, and LS operations.

The USBOTG core USB signals do not connect directly to the OTG I/O pins. Instead, the signals pass through the Serial and ULPI Mux to allow for additional functionality on the OTG port. The OTG controller is configured for operation with a parallel ULPI transceiver (HS, FS, or LS). The selection between transceiver types is software programmable. The block defaults to Serial mode.

The USB controller core supports HS, FS, and LS operations in Host mode, and HS and FS operations in Device mode.

## 55.5.1.1 Host mode

The controller supports the direct connection of a HS, FS, or LS device (without an external hub). Although there is no separate transaction translator block in the system, the transaction translator function, normally associated with a USB 2.0 HS hub, is implemented within the DMA and protocol engine blocks to support connection to FS and LS devices.

## 55.5.1.2 Peripheral (Device) mode

- Up to six bidirectional endpoints
- HS or FS operation
- Remote wake-up capable

## 55.5.2 System interface

The system interface block contains all the control and status registers to allow a core to interface with the module. These registers allow the processor to control the configuration and ascertain the capabilities of the module, and they control the module's operation.

## 55.5.3 DMA engine

This module contains a local DMA engine. It is responsible for moving all of the data transferred over the USB between the module and system memory.

The DMA controllers must access control information and packet data from system memory. Control information is contained in linked list-based queue structures. The DMA controllers have state machines that are able to parse all of the data structures defined in the EHCI specification. In Host mode, the data structures are EHCI compliant and represent queues of transfers performed by the host controller, including the split-transaction requests that allow an EHCI controller to direct packets to FS and LS devices.

## 55.5.4 FIFO RAM controller

The FIFO RAM controller is used for context information and to control FIFOs between the protocol engine and the DMA controller. These FIFOs decouple the system processor/memory bus requests from the extremely tight timing required by USB.

In Host mode, a single data channel is maintained in each direction through the buffer memory, and the USB host modules use 1024-byte transmit buffers and 1024-byte receive buffers.

## 55.5.5 USB power control block

The USB controller supports suspend and wake-up functionality. The power control block allows for placing the transceiver in low-power mode when USB bus is IDLE, and supports local and remote wake-up to bring the transceiver out of low-power mode when needed. Additionally, the power control block can wake-up the platform from Sleep mode by generating an interrupt.

## 55.5.5.1 Entering low-power Suspend mode

This mode is always entered when the controlling driver software sets the appropriate field in the USB core register, Port Status and Control (PORTSC1). After the controller is suspended, the clocks to the USB can be stopped.

## 55.6 Wake-up events

The power control block monitors the USB bus when the USB core is in the suspend state. Depending on whether the core is in Host or Device mode, a number of wake-up conditions are monitored. Upon detection of a wake-up condition, an interrupt (asynchronous) can be generated to the platform if the value of the related wake-up interrupt enable field is 1. This interrupt also reactivates the platform clocks if they were stopped during the suspend.

## 55.6.1 Host mode events

The host controller wakes up on the following events:

- Remote wake-up request

A peripheral can request the host to reactivate the bus by driving wake-up signaling on the DM/DP lines. The power control block sends a wake-up request to the USB core when J-K transition on DM/DP line is detected.

- Wake-up on over-current

If wake-up on over-current is enabled (the value of PORTSC1[WKOC] is 1), the power control block sends a wake-up request to the USB core when an over-current event is detected.

- Wake-up on disconnect

If wake-up on disconnection is enabled (the value of PORTSC1[WKDS] is 1), the power control block sends a wake-up request to the USB core when a disconnection event is detected (J-SE0/K-SE0 transition on DM/DP line).

- Wake-up on connect

If wake-up on connection is enabled (the value of PORTSC1[WKCN] is 1), the power control sub-block sends a wake-up request to the USB core when a connection event is detected (SE0-J/SE0-K transition on DM/DP line).

## 55.6.2 Device mode events

When the OTG controller is configured for peripheral operation, the power control block sends a wake-up request to the USB core when any non-idle state is detected on the USB bus.

## 55.7 Interrupts

## 55.7.1 USB core interrupts

Each USB core uses one dedicated vector in the interrupt table. The vector number associated with each core can be found in the interrupt section.

With the exception of the wake-up interrupts, all of the interrupt sources are controlled in the USB cores.

## 55.7.2 USB wake-up interrupts

Each USB core has an associated wake-up interrupt. The wake-up interrupts are generated outside of the USB controller cores, but each one uses the same vector as the corresponding USB controller core's interrupt. These interrupts are generated by the power control blocks, which run on the 32 KHz standby clock. The wake-up interrupt is designed to work even when the USB and platform clocks are disabled, such that a wake-up condition on the USB bus can reactivate the platform clocks.

Universal Serial Bus On-The-Go Controller (USBOTG)

Universal Serial Bus On-The-Go Controller (USBOTG)

Because the wake-up interrupt is generated and cleared on a 32 KHz clock, this interrupt request responds very slowly to clear actions. For this reason, you must disable the wake-up interrupt to clear the request flag. Disabling the interrupt masks the request instantaneously as this is clocked by the platform clock. You must then wait for at least three 32 KHz clock cycles before re-enabling this interrupt to allow sufficient time for the request flag to clear. Because this interrupt is only used during low-power modes of the USB, it is sufficient to enable the wake-up interrupt just prior to entering the USB Suspend mode.

## 55.8 Data structures

## 55.8.1 Device data structures

This section defines the interface data structures used to communicate control, status, and data between DCD software and the device controller. The interface consists of multiple dQH and TD instances.

## NOTE

You must ensure that data structures do not span a 4 KB page boundary.

The USB OTG uses an array of device endpoint QHs to organize device transfers. As shown in the following figure, there are two endpoint QHs in the array for each device endpoint-one for IN and the other for OUT. ENDPOINTLISTADDR provides a pointer to the first entry in the array.

<!-- image -->

## 55.8.1.1 Endpoint dQH

All transfers are managed in the endpoint dQH. The dQH is a 48-byte data structure, but must align on 64-byte boundaries. During priming of an endpoint, the dTD copies into the overlay area of the dQH, which starts at the NextTD pointer and continues through the end of the buffer pointers entries. After a transfer is complete, the dTD status updates to the CurrentTD pointer. When a packet is in progress, the overlay area of the dQH acts as a staging area for the dTD, so the device controller can access needed information with minimal latency.

The following table shows the endpoint QH structure.

Table 427. Endpoint QH layout

<!-- image -->

Table continues on the next page...

Table 427. Endpoint QH layout (continued)

<!-- image -->

| Current dTD Pointer                                | Current dTD Pointer                                | Current dTD Pointer                                | Current dTD Pointer                                | Current dTD Pointer                                | Current dTD Pointer                                | Current dTD Pointer                                | Current dTD Pointer                                | Current dTD Pointer                                | Current dTD Pointer                                | 0 0                                                | 0 0                                                | 0 04h                                              |                                                    |                                                    |                                                    |
|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|
| Next dTD Pointer                                   | Next dTD Pointer                                   | Next dTD Pointer                                   | Next dTD Pointer                                   | Next dTD Pointer                                   | Next dTD Pointer                                   | Next dTD Pointer                                   | Next dTD Pointer                                   | Next dTD Pointer                                   | Next dTD Pointer                                   | 0 0                                                | 0 0                                                | T 08h 1                                            |                                                    |                                                    |                                                    |
| 0                                                  | 0                                                  | Total Bytes                                        | I O C                                              | 0                                                  | 0                                                  | 0                                                  | Mult O                                             | 0 0                                                | Status                                             | Status                                             | Status                                             | 0Ch 1                                              |                                                    |                                                    |                                                    |
| Buffer Pointer (Page 0)                            | Buffer Pointer (Page 0)                            | Buffer Pointer (Page 0)                            | Buffer Pointer (Page 0)                            | Buffer Pointer (Page 0)                            | Buffer Pointer (Page 0)                            | Buffer Pointer (Page 0)                            | Current Offset                                     | Current Offset                                     | Current Offset                                     | Current Offset                                     | Current Offset                                     | 10h 1                                              |                                                    |                                                    |                                                    |
| Buffer Pointer (Page 1)                            | Buffer Pointer (Page 1)                            | Buffer Pointer (Page 1)                            | Buffer Pointer (Page 1)                            | Buffer Pointer (Page 1)                            | Buffer Pointer (Page 1)                            | Buffer Pointer (Page 1)                            | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | 14h 1                                              |                                                    |                                                    |                                                    |
| Buffer Pointer (Page 2)                            | Buffer Pointer (Page 2)                            | Buffer Pointer (Page 2)                            | Buffer Pointer (Page 2)                            | Buffer Pointer (Page 2)                            | Buffer Pointer (Page 2)                            | Buffer Pointer (Page 2)                            | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | 18h 1                                              |                                                    |                                                    |                                                    |
| Buffer Pointer (Page 3)                            | Buffer Pointer (Page 3)                            | Buffer Pointer (Page 3)                            | Buffer Pointer (Page 3)                            | Buffer Pointer (Page 3)                            | Buffer Pointer (Page 3)                            | Buffer Pointer (Page 3)                            | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | 1Ch 1                                              |                                                    |                                                    |                                                    |
| Buffer Pointer (Page 4)                            | Buffer Pointer (Page 4)                            | Buffer Pointer (Page 4)                            | Buffer Pointer (Page 4)                            | Buffer Pointer (Page 4)                            | Buffer Pointer (Page 4)                            | Buffer Pointer (Page 4)                            | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | 20h 1                                              |                                                    |                                                    |                                                    |
| Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | Reserved                                           | 24h                                                | Reserved                                           |                                                    |                                                    |
| Setup buffer bytes 3-0                             | Setup buffer bytes 3-0                             | Setup buffer bytes 3-0                             | Setup buffer bytes 3-0                             | Setup buffer bytes 3-0                             | Setup buffer bytes 3-0                             | Setup buffer bytes 3-0                             | Setup buffer bytes 3-0                             | Setup buffer bytes 3-0                             | Setup buffer bytes 3-0                             | Setup buffer bytes 3-0                             | Setup buffer bytes 3-0                             | 28h                                                | Setup buffer bytes 3-0                             |                                                    |                                                    |
| Setup buffer bytes 7-4                             | Setup buffer bytes 7-4                             | Setup buffer bytes 7-4                             | Setup buffer bytes 7-4                             | Setup buffer bytes 7-4                             | Setup buffer bytes 7-4                             | Setup buffer bytes 7-4                             | Setup buffer bytes 7-4                             | Setup buffer bytes 7-4                             | Setup buffer bytes 7-4                             | Setup buffer bytes 7-4                             | Setup buffer bytes 7-4                             | 2Ch                                                | Setup buffer bytes 7-4                             |                                                    |                                                    |
| Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only | Device controller read/write; all others read-only |

## 55.8.1.1.1 Endpoint capabilities and characteristics (offset = 0h)

This entry specifies static information about the endpoint. In other words, this information does not change over the lifetime of the endpoint. DCD software must not attempt to modify this information when the corresponding endpoint is enabled.

## Table 428. Endpoint capabilities and characteristics

| Field   | Description                                                                                                                                                                           |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-30   | Multiple packet select                                                                                                                                                                |
| Mult    | This field indicates the number of packets executed per transaction description:                                                                                                      |
|         | 00 Execute N transactions as demonstrated by the USB variable length packet protocol, where N is computed using the Maximum Packet Length field (dQH) and the Total Bytes field (dTD) |
|         | 01 Execute 1 transaction                                                                                                                                                              |
|         | 10 Execute 2 transactions                                                                                                                                                             |
|         | 11 Execute 3 transactions                                                                                                                                                             |

Table continues on the next page...

Table 428. Endpoint capabilities and characteristics (continued)

| Field                       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                             | Non-ISO endpoints must set Mult equal to 00. ISO endpoints must set Mult equal to 01, 10, or 11 as needed. NOTE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 29 ZLT                      | Zero length termination select. This field is ignored in isochronous transfers. Clearing this bit enables the hardware to automatically append a zero-length packet when the following conditions are true: • The packet transmitted equals the value of the Maximum Packet Length field • The dTD has exhausted the Total Bytes field After this, the dTD retires. When the device is receiving packets, if the last packet length received equals the maximum packet length, and the value of the Total Bytes field is zero, it waits for a zero-length packet from the host to retire the current dTD. Setting this field disables the zero-length packet. When the device is transmitting, the hardware does not append any zero-length packet. When receiving, it does not require a zero-length packet to retire a dTD, the last packet of which was equal to the maximum packet length. The dTD is retired as soon as the value of the Total Bytes field becomes zero, or a short packet is received. 0 Enable zero-length packet (default) 1 Disable the zero-length packet |
| 28-27                       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 26-16 Maximum Packet Length | This field directly corresponds to the maximum packet size of the associated endpoint (wMaxPacketSize). The maximum value for this field is 400h (1024).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 15 IOS                      | Interrupt on setup. This field, used on control type endpoints, indicates if USBSTS[UI] is set in response to a setup being received.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 14-0                        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

## 55.8.1.1.2 Transfer overlay (offset = 8h-20h)

The seven entries in the overlay area represent a transaction working space for the device controller. The general operational model is that the device controller can detect whether the overlay area contains a description of an active transfer. If it does not contain an active transfer, then the device controller does not read the associated endpoint.

Universal Serial Bus On-The-Go Controller (USBOTG)

After an endpoint is configured, the dTD is copied into this QH overlay area by the device controller. Until a transfer expires, you must not write the QH overlay area or the associated TD. When the transfer is complete, the device controller writes the results back to the original TD and advances the queue.

See Endpoint dTD for a description of the overlay fields.

## 55.8.1.1.3 Current dTD Pointer (offset = 0h)

The current dTD pointer is used by the controller to locate the transfer in progress. This entry is for device controller (hardware) use only and must not be modified by DCD software.

## Table 429. Current dTD pointer

| Field                    | Description                                                                                                                                                                                    |
|--------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-5 Current dTD Pointer | This field is a pointer to the dTD that is represented in the transfer overlay area, and is updated by the device controller to the next dTD pointer during endpoint priming or queue advance. |
| 4-0                      | Reserved                                                                                                                                                                                       |

## 55.8.1.1.4 Setup buffer (offset = 28h-2Ch)

The setup buffer is a dedicated storage for the 8-byte data that follows a setup PID. See Control endpoint operation for information on the procedure for reading the setup buffer.

## NOTE

Each endpoint has a TX and an RX dQH associated with it, and only the RX QH receives setup data packets.

Table 430. Multiple mode control

| Offset   | Field               | Description                                                                                                                                  |
|----------|---------------------|----------------------------------------------------------------------------------------------------------------------------------------------|
| 28h      | 31-0 Setup buffer 0 | Setup buffer 0. This buffer contains bytes 3 to 0 of an incoming setup buffer packet and is written by the device controller software reads. |
| 2Ch      | 31-0 Setup buffer 1 | Setup buffer 1. This buffer contains bytes 7 to 4 of an incoming setup buffer packet and is written by the device controller software reads. |

## 55.8.1.2 Endpoint dTD

The dTD describes to the device controller the location and quantity of data for a given transfer.

## NOTE

The DCD software must not attempt to modify any field in an active dTD except the next dTD pointer.

## Table 431. Endpoint dTD

<!-- image -->

| 3   | 3   | 2   | 2   | 2   | 2   | 2 2   | 2   | 2   | 2   | 1   | 1 1   | 1 6 1   | 1   | 1 1 1   | 1   | 9   | 8 7 6   | 5   | 4   | 3 2 1   | 0 of   |
|-----|-----|-----|-----|-----|-----|-------|-----|-----|-----|-----|-------|---------|-----|---------|-----|-----|---------|-----|-----|---------|--------|
| 1   | 0   | 9   | 8   | 7   | 6   | 5 4   | 3   | 2   | 0   | 9   | 8 7   | 5       | 4 3 | 2       |     | 1 0 |         |     |     |         | fs     |
|     |     |     |     |     |     |       |     |     |     |     |       |         |     |         |     |     |         |     |     |         | et     |

Table continues on the next page...

## Table 431. Endpoint dTD (continued)

<!-- image -->

| Next dTD Pointer          | Next dTD Pointer          | Next dTD Pointer          | Next dTD Pointer          | Next dTD Pointer          | Next dTD Pointer          | Next dTD Pointer   | Next dTD Pointer   | Next dTD Pointer   | Next dTD Pointer   | Next dTD Pointer   | 0              | 0              | 0              |                | 0              | T 0 0 h   |
|---------------------------|---------------------------|---------------------------|---------------------------|---------------------------|---------------------------|--------------------|--------------------|--------------------|--------------------|--------------------|----------------|----------------|----------------|----------------|----------------|-----------|
| 0                         | Total Bytes               | I O C                     | 0 0                       | 0                         | Mult O                    | 0                  | 0                  | Status             | Status             | Status             | Status         | Status         | Status         | Status         | Status         | 0 4 h     |
| Buffer Pointer (Page 0)   | Buffer Pointer (Page 0)   | Buffer Pointer (Page 0)   | Buffer Pointer (Page 0)   | Buffer Pointer (Page 0)   | Current Offset            | Current Offset     | Current Offset     | Current Offset     | Current Offset     | Current Offset     | Current Offset | Current Offset | Current Offset | Current Offset | Current Offset | 0 8 h     |
| Buffer Pointer (Page 1) 0 | Buffer Pointer (Page 1) 0 | Buffer Pointer (Page 1) 0 | Buffer Pointer (Page 1) 0 | Buffer Pointer (Page 1) 0 | Frame Number              | Frame Number       | Frame Number       | Frame Number       | Frame Number       | Frame Number       | Frame Number   | Frame Number   | Frame Number   | Frame Number   | Frame Number   | 0 C h     |
| Buffer Pointer (Page 2) 0 | Buffer Pointer (Page 2) 0 | Buffer Pointer (Page 2) 0 | Buffer Pointer (Page 2) 0 | Buffer Pointer (Page 2) 0 | Buffer Pointer (Page 2) 0 | 0 0                | 0                  | 0                  | 0                  | 0                  | 0              | 0              | 0              | 0              | 0              | 1 0 h     |
| Buffer Pointer (Page 3) 0 | Buffer Pointer (Page 3) 0 | Buffer Pointer (Page 3) 0 | Buffer Pointer (Page 3) 0 | Buffer Pointer (Page 3) 0 | Buffer Pointer (Page 3) 0 | 0 0                | 0                  |                    | 0 0                | 0                  | 0              | 0              | 0              | 0              | 0              | 1 4 h     |
| Buffer Pointer (Page 4)   | Buffer Pointer (Page 4)   | Buffer Pointer (Page 4)   | Buffer Pointer (Page 4)   | Buffer Pointer (Page 4)   | 0                         | 0                  | 0                  | 0                  | 0 0                | 0                  | 0              | 0              | 0              | 0              | 0              | 1 8 h     |

## 55.8.1.2.1 Next dTD pointer (offset = 0h)

The Next dTD pointer is used to point the device controller to the next dTD in the linked list.

## Table 432. Next dTD pointer

| Field                 | Description                                                                                                                                            |
|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-5 Next dTD Pointer | This field contains the physical memory address of the next dTD to be processed. The field corresponds to memory address signals [31:5], respectively. |
| 4-1                   | Reserved                                                                                                                                               |
| 0                     | Terminate. This field indicates to the device controller that no more valid entries exist in the queue.                                                |
| T                     | 0 - Pointer is valid (points to a valid transfer element descriptor) 1 - Pointer is invalid                                                            |

## 55.8.1.2.2 dTD token (offset = 4h)

The dTD token is used to specify attributes for the transfer including the number of bytes to read or write and the status of the transaction.

Table 433. dTD token

| Field             | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 30-16 Total Bytes | This field specifies the total number of bytes moved with this TD. This field decrements by the number of bytes actually moved during the transaction and only on the successful completion of the transaction. The maximum value that you may store in the field is 5*4 K(5000h). This is the maximum number of bytes that five-page pointers can access. Although possible to create a transfer up to 20 KB, this assumes the first offset into the first page is 0. When the offset cannot be predetermined, crossing past the fifth page can be guaranteed by limiting the total bytes to 16 K**. Therefore, the maximum recommended transfer is 16 KB (4000h). Larger transfer sizes can be supported, but require disabling ZLT and using multiple dTDs. NOTE If the value of the field is 0 when the host controller fetches this TD (and the active bit is 1), the device controller executes a zero-length transaction and retires the TD. For IN transfers, Total Bytes to Transfer need not be an even multiple of the maximum packet length. If you build such a TD for an IN transfer, the last transaction is always less than the maximum packet length. For OUT transfers, total bytes must be evenly divisible by the maximum packet length. |
| 15 IOC            | Indicates whether USBSTS[UI] is set in response to the device controller being finished with this dTD.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 14-12             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 11-10 MultO       | Multiplier Override. This field can possibly transmit ISOs (ISO-IN) to override the multiplier in the QH. This field must be 0 for all packet types that are not transmit-ISO. For example, if QH.MULT equals 3, maximum packet size equals 8, total bytes equals 15, and MultO equals 0 [default], then three packets are sent: {Data2(8); Data1(7); Data0(0)}. If QH.MULT equals 3, maximum packet size equals 8, total bytes equals 15, and MultO equals 2, then two packets are sent: {Data1(8); Data0(7)}. For maximum efficiency, you must compute MultO equals greatest integer of (total bytes / maximum packet size) except for the case when total bytes equals 0; then MultO must be 1. Non-ISO and Non-TX endpoints must set MultO to 0. NOTE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 9-8               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 7-0 Status        | The device controller communicates individual command execution states back to the DCDsoftware. This field contains the status of the last transaction performed on this dTD. The bit encodings are as follows.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 7-0 Status        | Bit Status field description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

Table continues on the next page...

## Table 433. dTD token (continued)

| Field   | Description   | Description                                                                                                                                                                                                                                        |
|---------|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | 7             | Active. Set by you to enable the execution of transactions by the device controller.                                                                                                                                                               |
|         | 6             | Halted. Set by the device controller during status updates to indicate that a serious error has occurred at the device/endpoint addressed by this dTD. Any time a transaction results in the halted bit being set, the active bit is also cleared. |
|         | 5             | Data Buffer Error. Set by the device controller during status update to indicate that the device controller is unable to maintain the reception of incoming data (overrun) or is unable to supply data fast enough during transmission (underrun). |
|         | 4             | Reserved                                                                                                                                                                                                                                           |
|         | 3             | Transaction Error. Set by the device controller during status update in case the device did not receive a valid response from the host (time-out, CRC, bad PID).                                                                                   |
|         | 2-0           | Reserved                                                                                                                                                                                                                                           |

## 55.8.1.2.3 dTD buffer page pointer list (offset = 8h-18h)

The buffer page pointer list (belonging to a device element TD) is an array of physical memory address pointers. These pointers reference the individual pages of a data buffer.

## Table 434. Buffer page pointer list

| Field                 | Description                                                                                                                                                             |
|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-12 Buffer Pointer  | Selects the page offset in memory for the packet buffer. Non-virtual memory systems typically set the buffer pointers to a series of incrementing integers.             |
| 0;11-0 Current Offset | Offset into the 4 KB buffer where the packet begins.                                                                                                                    |
| 1;10-0 Frame Number   | Written by the device controller to indicate the frame number in which a packet finishes. Typically correlates relative completion times of packets on an ISO endpoint. |

## 55.8.2 Host data structures

This section defines the interface data structures used to communicate control, status, and data between HCD (software) and the enhanced host controller (hardware).

The data structure definitions in this chapter support a 32-bit memory buffer address space. The interface consists of the following:

- Periodic schedule
- Periodic frame list
- Asynchronous schedule
- iTDs

- siTDs
- Queue heads
- Queue element transfer descriptors

The following table shows the functions of data structures.

Table 435. Data structure functions

| Data structure                                  | Function                                                                                         |
|-------------------------------------------------|--------------------------------------------------------------------------------------------------|
| Periodic frame list                             | Root of all periodic (isochronous and interrupt transfer type) transfers for the host controller |
| Asynchronous list                               | Root for all the bulk and control transfers                                                      |
| iTDs                                            | Manage isochronous data streams                                                                  |
| siTDs                                           | Manage isochronous split-transaction data streams                                                |
| Queue heads, queue element transfer descriptors | Manage all interrupt, control, and bulk data streams                                             |

These data structures are optimized to reduce the total memory footprint of the schedule and to reduce the average number of memory accesses needed to execute a USB transaction.

Note that you must ensure that no interface data structure reachable by the EHCI host controller spans a 4 KB page boundary.

The data structures defined in this section are (from the host controller's perspective) a mix of read-only and read/writeable fields. The host controller must preserve the read-only fields on all data structure writes.

## 55.8.2.1 Periodic frame list

This schedule is for all periodic transfers (isochronous and interrupt). The periodic schedule is referenced from the operational registers space using the PERIODICLISTBASE address register and USB Frame Index (FRINDEX) register. The periodic schedule is based on an array of pointers called the periodic frame list. The PERIODICLISTBASE address register is combined with the USB Frame Index (FRINDEX) register to produce a memory pointer into the frame list. The periodic frame list implements a sliding window of work over time.

The following figure shows the organization of periodic schedule.

Universal Serial Bus On-The-Go Controller (USBOTG)

Universal Serial Bus On-The-Go Controller (USBOTG)

<!-- image -->

Split-transaction interrupt, bulk, and control are also managed using QHs and queue element transfer descriptors.

The Periodic frame list is a 4 KB page-aligned array of frame list link pointers. The length of the frame list may be programmable. The programmability of the periodic frame list is exported to the system software via the Host Controller Capability Parameters (HCCPARAMS) register.

Table 436. Frame list length

| Programmability   | Number of elements                                             |
|-------------------|----------------------------------------------------------------|
| No                | 1024                                                           |
| Yes               | Selectable by system software to be 256, 512, or 1024 elements |

An implementation must support all three of the above sizes. Programming the size (that is, the number of elements) is accomplished by system software writing the appropriate value into USBCMD[FS1].

Frame List Link pointers direct the host controller to the first work item in the frame's periodic schedule for the current microframe. The link pointers are aligned on DWord boundaries within the Frame List.

The table below illustrates the format of the frame list element pointer.

Table 437. Format of frame list element pointer

Table continues on the next page...

Table 437. Format of frame list element pointer (continued)

| 3 1 2 7                 | 3 0   | 2 9   | 2 8   | 2 6   | 2 5   | 2 4   | 2 3   | 2 2 2 1   | 2 0   | 1 9   | 1 8   | 1 7 1 6   | 1 5   | 1 4   | 1 3   | 1 2   | 1 1 1 0   | 9   |   8 | 7 6   | 5   | 4   | 3   | 2       | 1       | 0       |
|-------------------------|-------|-------|-------|-------|-------|-------|-------|-----------|-------|-------|-------|-----------|-------|-------|-------|-------|-----------|-----|-----|-------|-----|-----|-----|---------|---------|---------|
| Frame List Link pointer |       |       |       |       |       |       |       |           |       |       |       |           |       |       |       |       |           |     |   0 | Typ   | Typ | Typ | Typ | 03-00 h | 03-00 h | 03-00 h |

Frame List Link pointers always reference memory objects that are 32-byte aligned. The referenced objects may be isochronous transfer descriptors for HS devices, siTDs (for FS isochronous endpoints), or a QH (used to support HS, FS, and LS interrupts). System software must not place non-periodic schedule items into the periodic schedule. The least significant bits in a frame list pointer are used to indicate to the host controller the type of object the pointer is referencing.

The least significant bit is the T-Bit (bit 0). When the value of this field is 1, the host controller never uses the value of the frame list pointer as a physical memory pointer. The Typ field is used to indicate the exact type of data structure being referenced by this pointer; the value encodings are shown below.

## Table 438. Typ field value definitions

| Value   | Meaning                                                  |
|---------|----------------------------------------------------------|
| 00b     | Isochronous transfer descriptor (iTD)                    |
| 01b     | QH                                                       |
| 10b     | Split transaction isochronous transfer descriptor (siTD) |
| 11b     | Frame span traversal node (FSTN)                         |

## 55.8.2.2 Asynchronous list QH pointer

The asynchronous transfer list (based at the ASYNCLISTADDR register) is where all of the control and bulk transfers are managed. Host controllers use the list based at ASYNCLISTADDR only when the periodic list is empty or disabled.

<!-- image -->

The asynchronous list is a simple circular list of QHs. ASYNCLISTADDR is a pointer to the next QH. This implements a round-robin service for all QHs linked into the asynchronous list.

## 55.8.2.3 iTD

The format of an iTD is shown in the table below.

Universal Serial Bus On-The-Go Controller (USBOTG)

This structure is used only for HS isochronous endpoints. All other transfer types must use queue structures. Isochronous TDs must be aligned on a 32-byte boundary.

## Table 439. iTD

| 3 1 2 7 1               | 3 0                     | 2 9                     | 2 8                     | 2 6                        | 2 5                        | 2 4                        | 2 3                        | 2 2                        | 2 1 2                      | 0                          | 1 9                        | 1 8 1 7                    | 1 6                        | 1 5 4                      | 1 3                        | 1 1 2                  | 1 1 0                  | 1 9                    | 8                      | 7                      | 6                      | 5 4                    | 3                      | 2                      | 0                     | 0                     |                        |                     |
|-------------------------|-------------------------|-------------------------|-------------------------|----------------------------|----------------------------|----------------------------|----------------------------|----------------------------|----------------------------|----------------------------|----------------------------|----------------------------|----------------------------|----------------------------|----------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|-----------------------|-----------------------|------------------------|---------------------|
| Next Link Pointer 0 Typ |                         |                         |                         |                            |                            |                            |                            |                            |                            |                            |                            |                            |                            |                            |                            |                        |                        |                        |                        |                        |                        |                        |                        |                        | 03-0 0h               | 03-0 0h               |                        |                     |
| Status                  | Status                  | Status                  | Status                  | Transaction 0 length I O C | Transaction 0 length I O C | Transaction 0 length I O C | Transaction 0 length I O C | Transaction 0 length I O C | Transaction 0 length I O C | Transaction 0 length I O C | Transaction 0 length I O C | Transaction 0 length I O C | Transaction 0 length I O C | Transaction 0 length I O C | PG*                        | PG*                    | Transaction 0 offset*  | Transaction 0 offset*  | Transaction 0 offset*  | Transaction 0 offset*  | Transaction 0 offset*  | Transaction 0 offset*  | Transaction 0 offset*  | Transaction 0 offset*  | Transaction 0 offset* | Transaction 0 offset* | Transaction 0 offset*  |                     |
| Status                  | Status                  | Status                  | Status                  | Transaction 1 length I O C | Transaction 1 length I O C | Transaction 1 length I O C | Transaction 1 length I O C | Transaction 1 length I O C | Transaction 1 length I O C | Transaction 1 length I O C | Transaction 1 length I O C | Transaction 1 length I O C | Transaction 1 length I O C | Transaction 1 length I O C | PG*                        | Transaction 1 offset*  | Transaction 1 offset*  | Transaction 1 offset*  | Transaction 1 offset*  | Transaction 1 offset*  | Transaction 1 offset*  | Transaction 1 offset*  | Transaction 1 offset*  | Transaction 1 offset*  | 8h                    | 0B-0                  | Transaction 1 offset*  |                     |
| Status                  | Status                  | Status                  | Status                  | Transaction 2 length I O C | Transaction 2 length I O C | Transaction 2 length I O C | Transaction 2 length I O C | Transaction 2 length I O C | Transaction 2 length I O C | Transaction 2 length I O C | Transaction 2 length I O C | Transaction 2 length I O C | Transaction 2 length I O C | Transaction 2 length I O C | Transaction 2 length I O C | PG*                    | Transaction            | Transaction            | 2 offset*              | 2 offset*              | 2 offset*              | 2 offset*              | 2 offset*              | 2 offset*              | 0F-0 Ch               | 0F-0 Ch               | 2 offset*              |                     |
| Status                  | Status                  | Status                  | Status                  | Transaction                |                            | 3                          | length                     |                            |                            |                            |                            |                            |                            | I O                        |                            | PG*                    | Transaction 3 offset*  | Transaction 3 offset*  | Transaction 3 offset*  | Transaction 3 offset*  | Transaction 3 offset*  | Transaction 3 offset*  | Transaction 3 offset*  | Transaction 3 offset*  | 13-1 0h               | 13-1 0h               | Transaction 3 offset*  |                     |
| Status                  | Status                  | Status                  | Status                  | Transaction 4 length I O C | Transaction 4 length I O C | Transaction 4 length I O C | Transaction 4 length I O C | Transaction 4 length I O C | Transaction 4 length I O C | Transaction 4 length I O C | Transaction 4 length I O C | Transaction 4 length I O C | Transaction 4 length I O C | Transaction 4 length I O C |                            | PG*                    | PG*                    | Transaction 4 offset*  | Transaction 4 offset*  | Transaction 4 offset*  | Transaction 4 offset*  | Transaction 4 offset*  | Transaction 4 offset*  | Transaction 4 offset*  | 17-1 4h               | 17-1 4h               |                        |                     |
| Status                  | Status                  | Status                  | Status                  | Transaction 5 length I O C | Transaction 5 length I O C | Transaction 5 length I O C | Transaction 5 length I O C | Transaction 5 length I O C | Transaction 5 length I O C | Transaction 5 length I O C | Transaction 5 length I O C | Transaction 5 length I O C | Transaction 5 length I O C | Transaction 5 length I O C | PG*                        | Transaction 5 offset*  | Transaction 5 offset*  | Transaction 5 offset*  | Transaction 5 offset*  | Transaction 5 offset*  | Transaction 5 offset*  | Transaction 5 offset*  | Transaction 5 offset*  | Transaction 5 offset*  | 1B-1 8h               | 1B-1 8h               |                        |                     |
|                         |                         |                         |                         |                            |                            |                            |                            |                            |                            |                            |                            |                            |                            | I                          | PG*                        |                        |                        | Transaction            | 6                      |                        | offset*                |                        |                        |                        | 1F-1                  | 1F-1                  |                        |                     |
| Status                  | Status                  | Status                  | Status                  | Transaction 6 length       | Transaction 6 length       | Transaction 6 length       | Transaction 6 length       | Transaction 6 length       | Transaction 6 length       | Transaction 6 length       | Transaction 6 length       | Transaction 6 length       | Transaction 6 length       | O C                        |                            |                        |                        |                        |                        |                        |                        |                        |                        |                        | Ch                    | Ch                    |                        |                     |
| Status                  | Status                  | Status                  | Status                  | Transaction 7 length       | Transaction 7 length       | Transaction 7 length       | Transaction 7 length       | Transaction 7 length       | Transaction 7 length       | Transaction 7 length       | Transaction 7 length       | Transaction 7 length       | Transaction 7 length       | I O C                      | PG*                        |                        |                        | Transaction            | 7                      |                        | offset*                |                        |                        |                        | 23-2 0h               | 23-2 0h               |                        |                     |
| Buffer Pointer (Page 0) | Buffer Pointer (Page 0) | Buffer Pointer (Page 0) | Buffer Pointer (Page 0) | Buffer Pointer (Page 0)    | Buffer Pointer (Page 0)    | Buffer Pointer (Page 0)    | Buffer Pointer (Page 0)    | Buffer Pointer (Page 0)    | Buffer Pointer (Page 0)    | Buffer Pointer (Page 0)    | Buffer Pointer (Page 0)    | Buffer Pointer (Page 0)    | Buffer Pointer (Page 0)    | Buffer Pointer (Page 0)    |                            | EndPt R Device address | EndPt R Device address | EndPt R Device address | EndPt R Device address | EndPt R Device address | EndPt R Device address | EndPt R Device address | EndPt R Device address | EndPt R Device address | 4h                    | 4h                    | EndPt R Device address |                     |
|                         |                         |                         |                         |                            |                            |                            |                            |                            |                            |                            |                            |                            |                            |                            |                            |                        |                        |                        |                        |                        |                        |                        |                        |                        | 27-2                  | 27-2                  |                        |                     |
| Buffer Pointer (Page 1) | Buffer Pointer (Page 1) | Buffer Pointer (Page 1) | Buffer Pointer (Page 1) | Buffer Pointer (Page 1)    | Buffer Pointer (Page 1)    | Buffer Pointer (Page 1)    | Buffer Pointer (Page 1)    | Buffer Pointer (Page 1)    | Buffer Pointer (Page 1)    | Buffer Pointer (Page 1)    | Buffer Pointer (Page 1)    | Buffer Pointer (Page 1)    | Buffer Pointer (Page 1)    | Buffer Pointer (Page 1)    | Buffer Pointer (Page 1)    | I/ O                   | Maximum Packet Size    | Maximum Packet Size    | Maximum Packet Size    | Maximum Packet Size    | Maximum Packet Size    | Maximum Packet Size    | Maximum Packet Size    | Maximum Packet Size    | 2B-2 8h               | 2B-2 8h               | Maximum Packet Size    | Maximum Packet Size |

Table continues on the next page...

## Table 439. iTD (continued)

| Buffer Pointer (Page 2)   | -   | 2F-2 Ch   |
|---------------------------|-----|-----------|
| Buffer Pointer (Page 3)   | -   | 33-3 0h   |
| Buffer Pointer (Page 4)   | -   | 37-3 4h   |
| Buffer Pointer (Page 5)   | -   | 3B-3 8h   |
| Buffer Pointer (Page 6)   | -   | 3F-3 Ch   |

- [ ] Host controller read/write

- [ ] Host controller read-only

These fields may be modified by the host controller if the I/O field indicates an OUT.

## 55.8.2.3.1 Next link pointer

The first DWord of an iTD is a pointer to the next schedule data structure. The following table describes the Next Schedule Element pointer field.

## Table 440. Next schedule element pointer

| Bit                        | Description                                                                                                                                                                                                                                                                                                |
|----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-5 Link Pointer (LP)     | These bits correspond to memory address signals [31:5], respectively. This field points to another iTD, siTD, or QH.                                                                                                                                                                                       |
| 4-3 Reserved               | This field is reserved and its value has no effect on operation. You must initialize this field to zero.                                                                                                                                                                                                   |
| 2-1 QH/(s)iTD Select (Typ) | This field indicates to the host controller whether the item referenced is an iTD, siTD, or a QH. This allows the host controller to perform appropriate processing on the item after it is fetched. Value encodings are given below. 00b - iTD 01b - QH 10b - siTD 11b - Frame span traversal node (FSTN) |
| 0 Terminate (T)            | 1b - Link Pointer field is invalid. 0b - Link Pointer field is valid.                                                                                                                                                                                                                                      |

## 55.8.2.3.2 iTD transaction status and control list

DWords 1 through 8 are eight slots of transaction control and status.

Each transaction description includes:

- Status results field
- Transaction length (bytes to send for OUT transactions and bytes received for IN transactions)
- Buffer offset. The PG and Transaction X Offset fields are used with the buffer pointer list to construct the starting buffer address for the transaction.

The host controller uses the information in each transaction description plus the endpoint information contained in the first three DWords of the Buffer Page Pointer list to execute a transaction on the USB.

The following table describes the iTD Transaction Status and Control fields.

Table 441. iTD transaction status and control

| Bit                        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 Status               | Records the status of the transaction executed by the host controller for this slot. This field is a bit vector with the following encoding:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Records the status of the transaction executed by the host controller for this slot. This field is a bit vector with the following encoding:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                            | Bit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Definition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                            | 31                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Active. Set to 1 by you to enable the execution of an isochronous transaction by the host controller. When the transaction associated with this descriptor is completed, the host controller sets this bit to 0 to indicate that a transaction for this element should not be executed when it is next encountered in the schedule.                                                                                                                                                                                                                                                                                                                          |
|                            | 30                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Data Buffer Error. Set to 1bythehost controller during status update to indicate that the host controller is unable to keep up with the reception of incoming data (overrun) or is unable to supply data fast enough during transmission (under run). If an overrun condition occurs, no action is necessary.                                                                                                                                                                                                                                                                                                                                                |
|                            | 29                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Babble Detected. Set to 1 by the host controller during status update when"babble" is detected during the transaction generated by this descriptor.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                            | 28                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Transaction Error (XactErr). Set to 1 by the host controller during status update in the case where the host did not receive a valid response from the device (Timeout, CRC, Bad PID, and so on). This bit may only be set for isochronous IN transactions.                                                                                                                                                                                                                                                                                                                                                                                                  |
| 27-16 Transaction X Length | For an OUT transaction, this field is the number of data bytes that the host controller sends during the transaction. The host controller is not required to update this field to reflect the actual number of bytes transferred during the transfer. For an IN transaction, this is the initial value of the endpoint to deliver. During status update, the host controller writes back the field is the number of bytes the host expects the number of bytes successfully received. The value in this register is the actual byte count (0-zero length data, 1-one byte, 2-two bytes, and so on). The maximum value this field may contain is C00h (3072). | For an OUT transaction, this field is the number of data bytes that the host controller sends during the transaction. The host controller is not required to update this field to reflect the actual number of bytes transferred during the transfer. For an IN transaction, this is the initial value of the endpoint to deliver. During status update, the host controller writes back the field is the number of bytes the host expects the number of bytes successfully received. The value in this register is the actual byte count (0-zero length data, 1-one byte, 2-two bytes, and so on). The maximum value this field may contain is C00h (3072). |
| 15 IOC                     | If the value of this field is 1, it specifies that when this transaction completes, the host controller should issue an interrupt at the next interrupt threshold.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | If the value of this field is 1, it specifies that when this transaction completes, the host controller should issue an interrupt at the next interrupt threshold.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 14-12 Page Select (PG)     | You configure the value of this field to indicate which of the buffer page pointers in the offset field in this slot must be concatenated to produce the starting memory address for this transaction. The valid range of values for this field is 0 to 6.                                                                                                                                                                                                                                                                                                                                                                                                   | You configure the value of this field to indicate which of the buffer page pointers in the offset field in this slot must be concatenated to produce the starting memory address for this transaction. The valid range of values for this field is 0 to 6.                                                                                                                                                                                                                                                                                                                                                                                                   |

Table continues on the next page...

Table 441. iTD transaction status and control (continued)

| Bit                       | Description                                                                                                                                                                                                                               |
|---------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 11-0 Transaction X Offset | This field is a value that is an offset, expressed in bytes, from the beginning of a buffer. The field is concatenated onto the buffer page pointer indicated in the PGfield to produce the starting buffer address for this transaction. |

## 55.8.2.3.3 iTD buffer page pointer list (plus)

DWords 9-15 of an isochronous transaction descriptor are nominally page pointers (4 KB aligned) to the data buffer for this TD. This data structure requires the associated data buffer to be contiguous (relative to virtual memory), but allows the physical memory pages to be non-contiguous.

Seven page pointers are provided to support the expression of eight isochronous transfers. The seven pointers allow for 3 (transactions) * 1024 (maximum packet size) * 8 (transaction records) = 24576 bytes to be moved with this data structure, regardless of the alignment offset of the first page.

Because each pointer is a 4 KB aligned page pointer, the least significant 12 bits in several of the page pointers are used for other purposes.

The tables below illustrate the field descriptions.

Table 442. iTD buffer pointer page 0 (plus)

| Field                         | Description                                                                                               |
|-------------------------------|-----------------------------------------------------------------------------------------------------------|
| 31-12 Buffer Pointer (page 0) | This is a 4 KB aligned pointer to physical memory that corresponds to memory address bits [31:12].        |
| 11-8 Endpoint Number (Endpt)  | This 4-bit field selects the particular endpoint number on the device serving as the data source or sink. |
| 7 Reserved                    | This field is reserved for future use and you must initialize it to 0.                                    |
| 6-0 Device Address            | This field selects the specific device serving as the data source or sink.                                |

Table 443. iTD buffer pointer page 1 (plus)

| Field                         | Description                                                                                        |
|-------------------------------|----------------------------------------------------------------------------------------------------|
| 31-12 Buffer Pointer (page 1) | This is a 4 KB aligned pointer to physical memory that corresponds to memory address bits [31:12]. |
| 11 Direction (I/O)            | This field encodes whether the HS transaction should use an IN or OUT PID. 0 - OUT 1 - IN          |

Table continues on the next page...

Table 443. iTD buffer pointer page 1 (plus) (continued)

| Field                    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 10-0 Maximum Packet Size | This directly corresponds to the maximum packet size of the associated endpoint (wMaxPacketSize). This field is used for high-bandwidth endpoints where more than one transaction is issued per transaction description (per microframe). The field is used with the Multi field to support high-bandwidth pipes. This field is also used for all IN transfers to detect packet babble. You must not set a value larger than 1024 (400h). Any larger value yields undefined results. |

Table 444. iTD buffer pointer page 2 (plus)

| Field                | Description                                                                                                                                                                                                                                                                                                                                                                                                               |
|----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-12 Buffer Pointer | This is a 4 KB aligned pointer to physical memory that corresponds to memory address bits [31:12].                                                                                                                                                                                                                                                                                                                        |
| 11-2 Reserved        | This field is reserved for future use and must be set to 0.                                                                                                                                                                                                                                                                                                                                                               |
| 1-0 Multi            | This field is used to indicate to the host controller the number of transactions that are executed per transaction description (per microframe). The valid values are: 00b - Reserved-must always be zero 01b - One transaction to be issued for this endpoint per microframe 10b - Two transactions to be issued for this endpoint per microframe 11b - Three transactions to be issued for this endpoint per microframe |

## Table 445. iTD buffer pointer pages 3-6

| Field                | Description                                                                                        |
|----------------------|----------------------------------------------------------------------------------------------------|
| 31-12 Buffer Pointer | This is a 4 KB aligned pointer to physical memory that corresponds to memory address bits [31:12]. |
| 11-0 Reserved        | This field is reserved for future use and must be set to 0.                                        |

## 55.8.2.4 siTD

All FS isochronous transfers through the internal transaction translator are managed using the siTD data structure, which satisfies the operational requirements for managing the split transaction protocol.

The following table shows the siTD.

## Table 446. siTD

| 3     |   2 | 2   |   2 |   2 2 |    | 2   |   2 | 2 2   |   2 | 1   |   1 |   1 1 |   1 | 1   |   1 1 |   1 1 1 | 9   | 8   | 7   | 6   | 5 4   | 3 2   | 1   | 0   |
|-------|-----|-----|-----|-------|----|-----|-----|-------|-----|-----|-----|-------|-----|-----|-------|---------|-----|-----|-----|-----|-------|-------|-----|-----|
| 3 1 0 |   9 | 8 7 |   6 |     5 |  4 |     |   3 | 2 1   |   0 | 9 8 |   7 |     6 |   5 | 4 3 |     2 |       0 |     |     |     |     |       |       |     |     |

Table continues on the next page...

## Table 446. siTD (continued)

| Next Link Pointer   |
|---------------------|

Host controller read/write

## 55.8.2.4.1 Next link pointer

DWord0 of a siTD is a pointer to the next schedule data structure.

The following table describes the next link pointer fields.

## Table 447. Next link pointer

Field

31-5

4-3

2-1

Description

Next Link Pointer (LP). This field contains the address of the next data object to be processed in the periodic list and corresponds to memory address signals [31:5], respectively.

Reserved. This field must be written to zeros.

QH/(s)iTD Select (Typ). This field indicates to the host controller whether the item referenced is an iTD/siTD or a encodings are:

QH. This allows the host controller to perform the proper type of processing on the item after it is fetched. Value

00b - iTD

01b - QH

10b - siTD

11b - FSTN

Host controller read only

Table continues on the next page...

## Table 447. Next link pointer (continued)

| 0   | Terminate (T)                     |
|-----|-----------------------------------|
|     | 1b - Link pointer field not valid |
|     | 0b - Link pointer valid           |

## 55.8.2.4.2 siTD endpoint capabilities/characteristics

DWords 1 and 2 specify static information about the FS endpoint, the addressing of the parent companion controller, and microframe scheduling control.

The tables below describe the endpoint and transaction translator characteristics, and microframe schedule control fields.

Table 448. Endpoint and transaction translator characteristics

| Field   | Description                                                                                                                        |
|---------|------------------------------------------------------------------------------------------------------------------------------------|
| 31      | Direction (I/O). This field encodes whether the FS transaction should be an IN or OUT. 0 - OUT 1 - IN                              |
| 30-24   | Port number. This field is the port number of the recipient transaction translator.                                                |
| 23      | This field is reserved and must be set to 0.                                                                                       |
| 22-16   | Hub address. This field holds the device address of the companion controller's hub.                                                |
| 15-12   | This field is reserved and must be set to 0.                                                                                       |
| 11-8    | Endpoint number (Endpt). This 4-bit field selects the particular endpoint number on the device serving as the data source or sink. |
| 7       | This field is reserved for future use and must be set to 0.                                                                        |
| 6-0     | Device address. This field selects the specific device serving as the data source or sink.                                         |

## Table 449. Microframe schedule control

| Field   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16   | This field is reserved for future use and must be set to 0.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 15-8    | Split Completion Mask (mFrame C-Mask). This field (along with the Active and SplitX state fields in the Status byte) is used to determine during which microframes the host controller must execute complete-split transactions. When the criteria for using this field is met, an all-zeros value has undefined behavior. The host controller uses the value of the three low-order bits of the FRINDEX register to index into this bit field. If the FRINDEX register value indexes to a position for which the mFrame C-Mask field is a 1, then this siTD is a candidate for transaction execution. There may be more than one bit set in this mask. |
| 7-0     | Split Start Mask (mFrame S-mask). This field (along with the Active and SplitX state fields in the Status byte) is used to determine during which microframes the host controller must execute start-split transactions. The host controller uses the value of the three low-order bits of the FRINDEX register to index into this bit field. If                                                                                                                                                                                                                                                                                                        |

Table continues on the next page...

## Table 449. Microframe schedule control (continued)

the FRINDEX register value indexes to a position for which the mFrame S-mask field is a 1, then this siTD is a candidate for transaction execution. An all zeros value in this field, in combination with existing periodic frame list, has undefined results.

## 55.8.2.4.3 siTD transfer state

DWords 3-6 are used to manage the state of the transfer.

The following table describes siTD transfer state fields.

## Table 450. siTD transfer status and control

| Bit   | Description                                                                                                                                                                                                                                                                                                                                 | Description                                                                                                                                                                                                                                                                                                                                 |
|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31    | IOC Whenthe host controller determines that the split transaction is complete, it asserts a hardware interrupt at the next interrupt threshold. 0 - Do not interrupt when transaction is complete. 1 - Do interrupt when transaction is complete.                                                                                           | IOC Whenthe host controller determines that the split transaction is complete, it asserts a hardware interrupt at the next interrupt threshold. 0 - Do not interrupt when transaction is complete. 1 - Do interrupt when transaction is complete.                                                                                           |
| 30    | Page Select (P). Used to indicate which data page pointer must be concatenated with the CurrentOffset field to construct a data buffer pointer. 0 - Selects Page 0 pointer 1 - Selects Page 1 pointer The host controller is not required to write this field back when the siTD is retired (Active bit transitioned from a one to a zero). | Page Select (P). Used to indicate which data page pointer must be concatenated with the CurrentOffset field to construct a data buffer pointer. 0 - Selects Page 0 pointer 1 - Selects Page 1 pointer The host controller is not required to write this field back when the siTD is retired (Active bit transitioned from a one to a zero). |
| 29-26 | This field is reserved for future use and must be set to zero.                                                                                                                                                                                                                                                                              | This field is reserved for future use and must be set to zero.                                                                                                                                                                                                                                                                              |
| 25-16 | Total Bytes to Transfer. You initialize this field to the total number of bytes expected in this transfer. Maximumvalue is 1023 (3FFh).                                                                                                                                                                                                     | Total Bytes to Transfer. You initialize this field to the total number of bytes expected in this transfer. Maximumvalue is 1023 (3FFh).                                                                                                                                                                                                     |
| 15-8  | µFrame Complete-Split Progress Mask (C-prog-Mask). This field is used by the host controller to record which split-completes has been executed.                                                                                                                                                                                             | µFrame Complete-Split Progress Mask (C-prog-Mask). This field is used by the host controller to record which split-completes has been executed.                                                                                                                                                                                             |
| 7-0   | Status. This field records the status of the transaction executed by the host controller for this slot. This field is a bit vector with the following encoding:                                                                                                                                                                             | Status. This field records the status of the transaction executed by the host controller for this slot. This field is a bit vector with the following encoding:                                                                                                                                                                             |
|       | Bit numbe r                                                                                                                                                                                                                                                                                                                                 | Definition                                                                                                                                                                                                                                                                                                                                  |
|       | 7                                                                                                                                                                                                                                                                                                                                           | Active. You set this bit to 1 to enable the execution of an isochronous split transaction by the host controller.                                                                                                                                                                                                                           |
|       | 6                                                                                                                                                                                                                                                                                                                                           | ERR. The host controller writes a 1 to this bit when an ERR response is received from the companion controller.                                                                                                                                                                                                                             |

Table continues on the next page...

Table 450. siTD transfer status and control (continued)

| Bit   |   Description | Description                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-------|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|       |             5 | Data Buffer Error. The host controller writes a 1 to this bit during status update to indicate that the host controller is unable to keep up with the reception of incoming data (overrun) or is unable to supply data fast enough during transmission (under run). In the case of an under run, the host controller transmits an incorrect CRC (thus invalidating the data at the endpoint). If an overrun condition occurs, no action is necessary. |
|       |             4 | Babble Detected. The host controller writes a 1 to this bit during status update when "babble" is detected during the transaction generated by this descriptor.                                                                                                                                                                                                                                                                                       |
|       |             3 | Transaction Error (XactErr). The host controller writes a 1 to this bit during status update in the case for which the host did not receive a valid response from the device (Timeout, CRC, Bad PID, and so on). This bit is set only for IN transactions.                                                                                                                                                                                            |
|       |             2 | Missed Microframe. The host controller detected that a host-induced hold-off caused the host controller to miss a required complete-split transaction.                                                                                                                                                                                                                                                                                                |
|       |             1 | Split Transaction State (SplitXstate). The bit encodings are: 00b - Do Start Split. This value directs the host controller to issue a Start Split transaction to the endpoint when a match is encountered in the S-mask. 01b - Do Complete Split. This value directs the host controller to issue a Complete Split transaction to the endpoint when a match is encountered in the C-mask.                                                             |
|       |             0 | Reserved-must always be zero.                                                                                                                                                                                                                                                                                                                                                                                                                         |

## 55.8.2.4.4 siTD buffer pointer list (plus)

DWords 4 and 5 are the data buffer page pointers for the transfer. This structure supports one physical page cross. The most significant 20 bits of each DWord in this section are the 4 KB (page) aligned buffer pointers.

The least significant 12 bits of each DWord are used as additional transfer state. The following table describes the siTD buffer pointer fields.

Table 451. Buffer page pointer list (plus)

| Field   | Description                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-12   | Buffer Pointer List. Bits [31:12] of DWords 4 and 5 are 4 KBpage-aligned, physical memory addresses. These bits correspond to physical address bits [31:12] respectively. The lower 12 bits in each pointer are defined and used as specified below. This field P specifies the current active pointer.                                                                                                         |
| 11-0    | Page 0: Current Offset. The 12 least significant bits of the Page 0 pointer is the current byte offset for the current page pointer (as selected with the page indicator bit (P field)). The host controller is not required to write this field back when the siTD is retired (Active bit transitioned from a 1 to a 0). The least significant bits of Page 1 pointer are split into three sub-fields. Page 1: |
|         | Field Description                                                                                                                                                                                                                                                                                                                                                                                               |

Table continues on the next page...

Table 451. Buffer page pointer list (plus) (continued)

| Field   | Description   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|---------|---------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | 11-5          | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|         | 4-3           | Transaction Position (TP). This field is used with T-Count to determine whether to send All, Begin, Mid, or End with each outbound transaction payload. System software must initialize this field with the appropriate starting value. The host controller must correctly manage this state during the lifetime of the transfer. The bit encodings are: 00b - All. The entire FS transaction data payload is in this transaction (that is, less than or equal to 188 bytes). 01b - Begin. This is the first data payload for a FS transaction that is greater than 188 bytes. 10B - Mid. This is the middle payload for a FS OUTtransaction that is larger than 188 bytes. 11b - End. This is the last payload for a FS OUT transaction that was larger than 188 bytes. |
|         | 2-0           | Transaction Count (T-Count). You initialize this field with the number of OUTstart-splits this transfer requires. Any value larger than 6 is undefined.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

## 55.8.2.4.5 siTD back link pointer

DWord 6 of a siTD is simply another schedule link pointer. This pointer is always zero, or references a siTD, and it cannot reference any other schedule data structure.

The following table describes the siTD back link pointer fields.

.

Table 452. siTD back link pointer

| Field   | Description                                                                               |
|---------|-------------------------------------------------------------------------------------------|
| 31-5    | siTD Back Pointer. This field is a physical memory pointer to an siTD.                    |
| 4-1     | Reserved-must always be zero."                                                            |
| 0       | Terminate (T) 1 - siTD Back Pointer field is invalid 0 - siTD Back Pointer field is valid |

## 55.8.2.5 Queue element transfer descriptor (qTD)

This data structure is only used with a QH. It describes one or more USB transactions to transfer up to 20480 (5*4096) bytes. The structure contains two structure pointers used for queue advancement, a DWord of transfer state, and a five-element array of data buffer pointers. It is 32 bytes and must be physically contiguous.

The buffer associated with this transfer must be virtually contiguous. The buffer may start on any byte boundary; however, for optimal usage of on-chip buses, it is recommended to align the buffers on a 32-byte boundary. A separate buffer pointer list element must be used for each physical page in the buffer, regardless of whether the buffer is physically contiguous.

Host controller updates (host controller writes) to stand-alone qTDs only occur during transfer retirement. References in the following bit field definitions of updates to the qTD are to the qTD portion of a QH.

The following table shows the QH data structure.

## Table 453. QH data structure

<!-- image -->

| 3 1                                           | 3 0 1 7                                                   | 2 9   | 2 8   | 2 7 2 6   | 2 5   | 2 4   | 2 3   | 2 2   | 2 1   | 2 0   | 1 9   | 1 8   | 1 6 1 5   | 1 4 1 3   | 1 2   | 1 1 1 0   | 9   | 8   | 7   | 6   | 5   | 4   | 3 2   | 1   | 0   |            |
|-----------------------------------------------|-----------------------------------------------------------|-------|-------|-----------|-------|-------|-------|-------|-------|-------|-------|-------|-----------|-----------|-------|-----------|-----|-----|-----|-----|-----|-----|-------|-----|-----|------------|
| Next qTD Pointer 0                            |                                                           |       |       |           |       |       |       |       |       |       |       |       |           |           |       |           |     |     |     |     |     |     |       | T   |     | 0 3- 0 0 h |
| Alternate Next qTD Pointer 0                  |                                                           |       |       |           |       |       |       |       |       |       |       |       |           |           |       |           |     |     |     |     |     |     |       |     | T   | 0 7- 0     |
| D T                                           | Total Bytes to Transfer I O C C_Page Cerr PID code Status |       |       |           |       |       |       |       |       |       |       |       |           |           |       |           |     |     |     |     |     |     |       |     |     | 0 B -0 8 h |
| Buffer Pointer (Page 0) Current Offset 0 F- 0 |                                                           |       |       |           |       |       |       |       |       |       |       |       |           |           |       |           |     |     |     |     |     |     |       |     |     | C          |
| h                                             |                                                           |       |       |           |       |       |       |       |       |       |       |       |           |           |       |           |     |     |     |     |     |     |       |     |     | 0          |
| h                                             |                                                           |       |       |           |       |       |       |       |       |       |       |       |           |           |       |           |     |     |     |     |     |     |       |     |     | 4          |
| F-                                            |                                                           |       |       |           |       |       |       |       |       |       |       |       |           |           |       |           |     |     |     |     |     |     |       |     |     |            |
| 1                                             |                                                           |       |       |           |       |       |       |       |       |       |       |       |           |           |       |           |     |     |     |     |     |     |       |     |     |            |
| Buffer Pointer (Page 0) - 1                   |                                                           |       |       |           |       |       |       |       |       |       |       |       |           |           |       |           |     |     |     |     |     |     |       |     |     |            |
| Buffer Pointer (Page 0) -                     |                                                           |       |       |           |       |       |       |       |       |       |       |       |           |           |       |           |     |     |     |     |     |     |       |     |     | 1 B        |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table 453. QH data structure (continued)

| C h   |
|-------|

| Host controller read/write   | Host controller read only.   |
|------------------------------|------------------------------|

qTDs must be aligned on 32-byte boundaries.

## 55.8.2.5.1 Next qTD pointer

The first DWord of an element TD is a pointer to another transfer element descriptor. The following table describes Next qTD pointer fields.

Table 454. qTD next element transfer pointer (DWord 0)

| Field   | Description                                                                                                                                                                                            |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-5    | Next Transfer Element Pointer. This field contains the physical memory address of the next qTD to be processed. The field corresponds to memory address signals [31:5], respectively.                  |
| 4-1     | Reserved                                                                                                                                                                                               |
| 0       | Terminate (T) 1 - Pointer is invalid 0 - Pointer is valid (points to a valid transfer element descriptor) This bit indicates to the host controller that there are no more valid entries in the queue. |

## 55.8.2.5.2 Alternate next qTD pointer

The second DWord of a qTD is used to support hardware-only advance of the data stream to the next TD on short packet. To be more explicit, the host controller always uses this pointer when the current qTD is retired because of a short packet. The following table describes the TD Alternate Next Element Transfer Pointer field descriptions.

Table 455. TD alternate next element transfer pointer (DWord 1)

| Field   | Description                                                                                                                                                                                                                                                                                   |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-5    | Alternate Next Transfer Element Pointer. This field contains the physical memory address of the next qTD to be processed in the event that the current qTD execution encounters a short packet (for an IN transaction). The field corresponds to memory address signals [31:5], respectively. |
| 4-1     | Reserved                                                                                                                                                                                                                                                                                      |
| 0       | Terminate (T). This bit indicates to the host controller that there are no more valid entries in the queue. 1 - Pointer is invalid 0 - Pointer is valid (points to a valid transfer element descriptor)                                                                                       |

## 55.8.2.5.3 qTD token

The third DWord of a qTD contains most of the information that the host controller requires to execute a USB transaction (the remaining endpoint-addressing information is specified in the QH).

## NOTE

The field descriptions forward reference fields defined in the QH. Where necessary, these forward references are preceded with a QH notation.

The following table describes the TD token fields.

Table 456. TD token (DWord 2)

| Field                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|-------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 Data Toggle                | This is the data toggle sequence field. The use of this field depends on the setting of the Data Toggle Control field in the QH.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 30-16 Total Bytes to Transfer | This field specifies the total number of bytes to be moved with this TD. The field is decremented by the number of bytes actually moved during the transaction only on the successful completion of the transaction. The maximum value that you may store in this field is 5 * 4 KB (5000h). This is the maximum number of bytes five page pointers can access. If the value of this field is 0 whenthe host controller fetches this TD(and the value of the Active field is 1), the host controller executes a zero-length transaction and retires the TD. It is not a requirement for OUT transfers that this field be an even multiple of QH.Maximum Packet Length. If you build such a TD for an OUT transfer, the last transaction is always less than QH.Maximum Packet Length. Although it is possible to create a transfer up to 20 KB, it is required that the first offset into the first page is 0. When the offset cannot be predetermined, crossing past the 5th page can be guaranteed by limiting the total bytes to 16 KB**. Therefore, the maximum recommended transfer is 16 KB (4000h). |
| 15 IOC                        | If the value of this bit is 1, it specifies that when this qTD is completed, the host controller must issue an interrupt at the next interrupt threshold.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 14-12 Current Page (C_Page)   | This field is used as an index into the qTD buffer pointer list. Valid values are in the range 0h to 4h. The host controller is not required to write this field back when the qTD is retired.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 11-10 Error Counter (CERR)    | This field is a 2-bit down counter that keeps track of the number of consecutive errors detected when executing this qTD. If this field is programmed with a non-zero value during set-up, the host controller decrements the count and writes it back to the qTD if the transaction fails. If the counter counts from 1 to 0, the host controller: • Marks the qTD inactive • Writes the Halted bit to 1 • Writes the error status bit for the error that caused this field to decrement to 0 An interrupt is generated if the the value of the USBError Interrupt Enable field in the USBINTR register is 1. If HCDwrites a 0 to this field during set-up, the host controller does not count errors for this qTD and there is no limit on the retries of this qTD. Note that write-backs of intermediate execution state are to the QH overlay area, not to the qTD. Transaction Error - Decrement Data Buffer Error - No decrement 3 Stalled - No decrement 1 Babble Detected - No decrement 1                                                                                                         |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

Table 456. TD token (DWord 2) (continued)

| Field        | Description                                                                                                                                                                                                                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|              | No Error - No decrement 2                                                                                                                                                                                                           | No Error - No decrement 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|              | Error                                                                                                                                                                                                                               | Decrement counter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|              | 1                                                                                                                                                                                                                                   | Detection of Babble or Stall automatically halts the QH. Thus, count is not decremented.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|              | 2                                                                                                                                                                                                                                   | If the EPS field indicates an HS device or the QHis in the asynchronous schedule (and PIDCode indicates an IN or OUT) and a bus transaction completes and the host controller does not detect a transaction error, then the host controller must reset CERR to extend the total number of errors for this transaction. For example, CERR must be reset with maximum value (3) on each successful completion of a transaction. The host controller must never reset this field if the value at the start of the transaction is 00b. See Split transaction interrupt for CERR adjustment rules when the EPS field indicates a FS or LS device and the QH is in the periodic schedule. See Asynchronous-do complete split for CERR adjustment rules when the EPS field indicates a FS or LS device, the QHis in the asynchronous schedule and the PIDCode indicates a SETUP. |
|              | 3                                                                                                                                                                                                                                   | Data buffer errors are host problems; these do not count against the device's retries.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|              | You must not write 0 to CERR when the EPS field is programmed with a value indicating an FS or LS device. This combination could result in an undefined behavior. NOTE                                                              | You must not write 0 to CERR when the EPS field is programmed with a value indicating an FS or LS device. This combination could result in an undefined behavior. NOTE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 9-8 PID Code | This field is an encoding of the token, which must be used for transactions associated with this TD. The encodings are described as follows.                                                                                        | This field is an encoding of the token, which must be used for transactions associated with this TD. The encodings are described as follows.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 9-8 PID Code | 00b                                                                                                                                                                                                                                 | OUT token generates token (E1H)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 9-8 PID Code | 01b                                                                                                                                                                                                                                 | IN token generates token (69H)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 9-8 PID Code | 10b                                                                                                                                                                                                                                 | SETUPtoken generates token (2DH) (undefined if endpoint is an interrupt, theQH is non-zero) transfer type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 9-8 PID Code | 11b                                                                                                                                                                                                                                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 7-0 Status   | This field is used by the host controller to communicate individual command execution states back to HCD. This field contains the status of the last transaction performed on this qTD. The bit encodings are described as follows: | This field is used by the host controller to communicate individual command execution states back to HCD. This field contains the status of the last transaction performed on this qTD. The bit encodings are described as follows:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 7-0 Status   | Bit                                                                                                                                                                                                                                 | Status field description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 7-0 Status   | 7                                                                                                                                                                                                                                   | Active. You write 1 to this bit to enable the execution of transactions by the host controller.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

Table continues on the next page...

Table 456. TD token (DWord 2) (continued)

| Field   |   Description |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         |             6 | Halted. The host controller writes a 1 to this field during status updates to indicate that a serious error has occurred at the device/endpoint addressed by this qTD. This can be caused by babble, the error counter counting down to zero, or reception of the STALLhandshakefromthedevice during a transaction. Anytime a transaction results in the Halted field being set to a 1, the Active field is also set to 0.                                                                                                                                                                                                                                                                                            |
|         |             5 | Data Buffer Error. The host controller writes a 1 to this field during status updates to indicate that the host controller is unable to keep up with the reception of incoming data (overrun) or is unable to supply data fast enough during transmission (under run). If an overrun condition occurs, the host controller forces a timeout condition on the USB, invalidating the transaction at the source. If the host controller writes this field to a 1, then it remains a 1 for the duration of the transfer.                                                                                                                                                                                                  |
|         |             4 | Babble Detected. The host controller writes a 1 to this field during status update when "babble" is detected during the transaction. In addition to writing a 1 to this field, the host controller writes a 1 to the Halted field. Because "babble" is considered a fatal error for the transfer, writing a 1 to the Halted field ensures that no more transactions occur because of this descriptor.                                                                                                                                                                                                                                                                                                                 |
|         |             3 | Transaction Error (XactErr). The host controller writes a 1 to this field during status update in the case where the host did not receive a valid response from the device (Timeout, CRC, Bad PID, and so on). If the host controller writes a 1 to this field, then it remains a 1 for the duration of the transfer.                                                                                                                                                                                                                                                                                                                                                                                                 |
|         |             2 | Missed Microframe. This field is ignored unless the QH.EPS field indicates an FS or LS endpoint and the QH is in the periodic list. The host controller writes a 1 to this field when it detects that a host-induced hold-off caused the host controller to miss a required complete-split transaction. If the host controller writes a 1 to this field, then it remains a 1 for the duration of the transfer.                                                                                                                                                                                                                                                                                                        |
|         |             1 | Split Transaction State (SplitXstate). The host controller ignores this field unless the QH.EPS field indicates a FS or LS endpoint. With an FS or LS device, the host controller uses this field to track the state of the split-transaction. The functional requirements of the host controller for managing this state field and the split transaction protocol depend on whether the endpoint is in the periodic or asynchronous schedule. Following are the bit encodings: 0b - Do Start Split. This value directs the host controller to issue a start split transaction to the endpoint. 1b - Do Complete Split. This value directs the host controller to issue a complete split transaction to the endpoint. |
|         |             0 | Ping State (P)/ERR. If the QH.EPS field indicates an HSdevice and the PID_Code indicates an OUT endpoint, then this is the state field for the Ping protocol. The bit encodings are: 0b - Do OUT. This value directs the host controller to issue an OUT PID to the endpoint. 1b - Do Ping. This value directs the host controller to issue a PING PID to the endpoint.                                                                                                                                                                                                                                                                                                                                               |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table 456. TD token (DWord 2) (continued)

| Field   | Description   | Description                                                                                                                                                                                                            |
|---------|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         |               | If the QH.EPS field does not indicate an HS device, then this field is used as an error indicator field. The host controller writes this field to a 1 whenever a periodic split-transaction receives an ERR handshake. |

## 55.8.2.5.4 qTD buffer page pointer list

The last five DWords of a qTD form an array of physical memory address pointers. These pointers reference the individual pages of a data buffer.

System software initializes the Current Offset field to the starting offset into the current page, where this page is selected through the value in the C\_Page field.

The following table describes the qTD buffer pointer(s) (DWords 3-7) fields.

Table 457. qTD buffer pointer(s) (DWords 3-7)

| Field   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-12   | Buffer Pointer List. Each element in the list is a 4 KB page-aligned physical memory address. The lower 12 bits in each pointer are reserved (except for the first one), as each memory pointer must reference the start of a 4 KB page. The field C_Page specifies the current active pointer. When the transfer element descriptor is fetched, the starting buffer address is selected using C_Page (similar to an array index to select an array element). If a transaction spans a 4 KB buffer boundary, the host controller must detect the page-span boundary in the data stream, increment C_Page, advance to the next buffer pointer in the list, and conclude the transaction through the new buffer pointer. |
| 11-0    | Current Offset (Reserved). This field is reserved in all pointers except the first one (for example, page 0). The host controller must ignore all of the reserved bits. For the page 0 current offset interpretation, this field is the byte offset into the current page (as selected by C_Page). The host controller is not required to write this field back when the qTD is retired. You must ensure the reserved fields are initialized to 0.                                                                                                                                                                                                                                                                     |

## 55.8.2.6 QH

The following table shows the QH structure layout.

## Table 458. QH structure layout

| 3 1                                                       | 3   | 2   | 2   | 2 7       | 2 8                                             | 2   | 2   | 2   | 2   | 2   | 1   | 1   | 1   | 1   | 1   | 1 1   | 1 9   | 7   | 6   | 5 4   | 3       | 2       | 1       | 0       |
|-----------------------------------------------------------|-----|-----|-----|-----------|-------------------------------------------------|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-------|-------|-----|-----|-------|---------|---------|---------|---------|
| 1 7 QH                                                    | 0   | 9   | 8   | 2 6       | 5                                               | 4   | 3   | 2   | 1 0 | 9   |     | 8   | 6   | 5 4 | 3   | 2 1 1 | 0     |     |     |       |         |         |         |         |
| Horizontal Link Pointer (QHLP)                            |     |     |     |           |                                                 |     |     |     |     |     |     |     |     |     |     |       |       |     |     |       | 0 Typ T | 0 Typ T | 0 Typ T | 03-0 0h |
| RL                                                        |     |     |     | C Maximum | Packet Length H D T C EP EndPt I Device Address |     |     |     |     |     |     |     |     |     |     |       |       |     |     |       |         |         |         | 07-0 4h |
| Mult Port Number* Hub Addr* µFrame C-mask* µFrame S-mask* |     |     |     |           |                                                 |     |     |     |     |     |     |     |     |     |     |       |       |     |     |       |         |         |         | 0B-0 8h |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table 458. QH structure layout (continued)

| Current qTD Pointer                    | Current qTD Pointer                    | Current qTD Pointer                    | Current qTD Pointer                    | Current qTD Pointer                    | Current qTD Pointer                    | Current qTD Pointer                    | 0                                      |                                        | 0F-0 Ch   |
|----------------------------------------|----------------------------------------|----------------------------------------|----------------------------------------|----------------------------------------|----------------------------------------|----------------------------------------|----------------------------------------|----------------------------------------|-----------|
| Next qTD Pointer                       | Next qTD Pointer                       | Next qTD Pointer                       | Next qTD Pointer                       | Next qTD Pointer                       | Next qTD Pointer                       | 0                                      |                                        | T                                      | 13-1 0h   |
| Alternate Next qTD Pointer             | Alternate Next qTD Pointer             | Alternate Next qTD Pointer             | Alternate Next qTD Pointer             | Alternate Next qTD Pointer             | Alternate Next qTD Pointer             | NakC nt                                |                                        | T                                      | 17-1 4h   |
| D T                                    | Total Bytes to Transfer                | I O C C_Page                           | Cerr                                   | PID Code                               | Status                                 | Status                                 | Status                                 | Status                                 | 1B-1 8h   |
| Buffer Pointer (Page 0) Current Offset | Buffer Pointer (Page 0) Current Offset | Buffer Pointer (Page 0) Current Offset | Buffer Pointer (Page 0) Current Offset | Buffer Pointer (Page 0) Current Offset | Buffer Pointer (Page 0) Current Offset | Buffer Pointer (Page 0) Current Offset | Buffer Pointer (Page 0) Current Offset | Buffer Pointer (Page 0) Current Offset | 1F-1 Ch   |
| Buffer Pointer (Page 1)                | Buffer Pointer (Page 1)                | Buffer Pointer (Page 1)                | Buffer Pointer (Page 1)                | Reserved                               | C-prog-mask*                           | C-prog-mask*                           | C-prog-mask*                           | C-prog-mask*                           | 23-2 0h   |
| Buffer Pointer (Page 2)                | Buffer Pointer (Page 2)                | Buffer Pointer (Page 2)                | Buffer Pointer (Page 2)                | S-bytes*                               | S-bytes*                               | S-bytes*                               | FrameTa g*                             | FrameTa g*                             | 27-2 4h   |
| Buffer Pointer (Page 3)                | Buffer Pointer (Page 3)                | Buffer Pointer (Page 3)                | Buffer Pointer (Page 3)                | -                                      | -                                      | -                                      | -                                      | -                                      | 2B-2 8h   |
| Buffer Pointer (Page 4)                | Buffer Pointer (Page 4)                | Buffer Pointer (Page 4)                | Buffer Pointer (Page 4)                | -                                      | -                                      | -                                      | -                                      | -                                      | 2F-2 Ch   |

| Host controller read/write   | Host controller read only   |
|------------------------------|-----------------------------|

## 55.8.2.6.1 QHLP

The first DWord of a QH contains a link pointer to the next data object to be processed after any required processing in this queue has been completed, as well as the control bits defined below.

This pointer may reference a QH or one of the isochronous transfer descriptors. It must not reference a qTD.

The following table describes the QH DWord 0 fields.

## Table 459. QH DWord 0

| Field   | Description                                                                                                                                                          |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-5    | QHLP. This field contains the address of the next data object to be processed in the horizontal list and corresponds to memory address signals [31:5], respectively. |
| 4-3     | Reserved                                                                                                                                                             |

Table continues on the next page...

Table 459. QH DWord 0 (continued)

| Field   | Description                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 2-1     | QH/(s)iTD Select (Typ). This field indicates to the hardware whether the item referenced by the link pointer is an iTD, siTD, or a QH. This allows the host controller to perform the proper type of processing on the item after it is fetched. Value encodings are: 00b - iTD 01b - QH 10b - siTD 11b - FSTN                                                                                                            |
| 0       | Terminate (T). If the QH is in the context of the periodic list, a one bit in this field indicates to the host controller that this is the end of the periodic list. This bit is ignored by the host controller when the QHis in the asynchronous schedule. You must ensure that QHs reachable by the host controller always have valid horizontal link pointers. 1 - Last QH (pointer is invalid). 0 - Pointer is valid. |

## 55.8.2.6.2 QH endpoint capabilities/characteristics

The second and third DWords of a QH specify static information about the endpoint. This information does not change over the lifetime of the endpoint. There are three types of information in this region:

- Endpoint characteristics: These are the USB endpoint characteristics including addressing, maximum packet size, and endpoint speed.
- Endpoint capabilities: These are adjustable parameters of the endpoint. They affect how the endpoint data stream is managed by the host controller.
- Split transaction characteristics: This data structure is used to manage FS and LS data streams for bulk, control, and interrupt via split transactions to USB2.0 hub transaction translator. There are additional fields used for addressing the hub and scheduling the protocol transactions (for periodic).

The host controller must not modify the bits in this region.

The following table describes the Endpoint characteristics: QH DWord 1 fields.

Table 460. Endpoint characteristics: QH DWord 1

| Field   | Description                                                                                                                                                                                                      |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28   | Nak Count Reload (RL). This field contains a value that is used by the host controller to reload the Nak Counter field.                                                                                          |
| 27      | Control Endpoint Flag (C). If the QH.EPS field indicates the endpoint is not a HS device, and the endpoint is a control endpoint, then you must set this bit to 1. Otherwise, you must always set this bit to 0. |
| 26-16   | Maximum Packet Length. This directly corresponds to the maximum packet size of the associated endpoint (wMaxPacketSize). The maximum value this field may contain is 400h (1024).                                |
| 15      | Head of Reclamation List Flag (H). This bit is set by system software to mark a QH as being the head of the reclamation list.                                                                                    |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

Table 460. Endpoint characteristics: QH DWord 1 (continued)

| Field   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 14      | Data Toggle Control (DTC). This bit specifies where the host controller must obtain the initial data toggle on an overlay transition. 0b - Ignore DT bit from incoming qTD. The host controller preserves the DT bit in the QH. 1b - Initial data toggle from the incoming qTD DT bit. Host controller replaces the DT bit in the QH from the DT bit in the qTD.                                                                                                        | Data Toggle Control (DTC). This bit specifies where the host controller must obtain the initial data toggle on an overlay transition. 0b - Ignore DT bit from incoming qTD. The host controller preserves the DT bit in the QH. 1b - Initial data toggle from the incoming qTD DT bit. Host controller replaces the DT bit in the QH from the DT bit in the qTD.                                                                                                        |
| 13-12   | Endpoint Speed (EPS). This is the speed of the associated endpoint. Bit combinations are:                                                                                                                                                                                                                                                                                                                                                                               | Endpoint Speed (EPS). This is the speed of the associated endpoint. Bit combinations are:                                                                                                                                                                                                                                                                                                                                                                               |
| 13-12   | Value                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Meaning                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 13-12   | 00b                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | FS (12 Mbits/sec)                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 13-12   | 01b                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | LS (1.5 Mbits/sec)                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 13-12   | 10b                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | HS (480 Mbits/sec)                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 13-12   | 11b                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 13-12   | This field must not be modified by the host controller.                                                                                                                                                                                                                                                                                                                                                                                                                 | This field must not be modified by the host controller.                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 11-8    | Endpoint Number (Endpt). This 4-bit field selects the particular endpoint number on the device serving as the data source or sink.                                                                                                                                                                                                                                                                                                                                      | Endpoint Number (Endpt). This 4-bit field selects the particular endpoint number on the device serving as the data source or sink.                                                                                                                                                                                                                                                                                                                                      |
| 7       | Inactivate on Next Transaction (I). This bit is used by the system software to request that the host controller set the Active bit to 0. See Rebalancing the periodic schedule for full operational details. This field is only valid when the QHis in the periodic schedule and the EPS field indicates a FS and LS endpoint. Writing 1 to this field when the QH is in the asynchronous schedule or the EPS field indicates a HS device and yields undefined results. | Inactivate on Next Transaction (I). This bit is used by the system software to request that the host controller set the Active bit to 0. See Rebalancing the periodic schedule for full operational details. This field is only valid when the QHis in the periodic schedule and the EPS field indicates a FS and LS endpoint. Writing 1 to this field when the QH is in the asynchronous schedule or the EPS field indicates a HS device and yields undefined results. |
| 6-0     | Device Address. This field selects the specific device serving as the data source or sink.                                                                                                                                                                                                                                                                                                                                                                              | Device Address. This field selects the specific device serving as the data source or sink.                                                                                                                                                                                                                                                                                                                                                                              |

The table below describes the endpoint capabilities: QH DWord 2 field descriptions.

Table 461. Endpoint capabilities: QH DWord 2

| Field   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-30   | High-Bandwidth Pipe Multiplier (Mult). This field is a multiplier used to key the host controller as the number of successive packets the host controller may submit to the endpoint in the current execution. The host controller makes the simplifying assumption that you properly initialize this field (regardless of the location of the QHin the schedules or other run-time parameters). The valid values are: 00b - Reserved. A 0 in this field yields undefined results. 01b - One transaction to be issued for this endpoint per microframe 10b - Two transactions to be issued for this endpoint per microframe 11b - Three transactions to be issued for this endpoint per microframe |
| 29-23   | Port Number. This field is ignored by the host controller unless the EPS field indicates a FS or LS device. The value is the port number identifier on the USB 2.0 Hub (for hub at device address Hub Addr below),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

Table continues on the next page...

Table 461. Endpoint capabilities: QH DWord 2 (continued)

| Field   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | below which the FS or LS device associated with this endpoint is attached. This information is used in the split-transaction protocol.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 22-16   | Hub Addr. This field is ignored by the host controller unless the EPSfield indicates a FS or LS device. The value is the USB device address of the USB 2.0 Hub below which the FS or LS device associated with this endpoint is attached. This field is used in the split-transaction protocol.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 15-8    | Split Completion Mask (µFrame C-Mask). This field is ignored by the host controller unless the EPS field indicates this device is a LS or FS device and this QH is in the periodic list. This field (along with the Active and SplitX-state fields) is used to determine during which microframes the host controller must execute a complete-split transaction. When the criteria for using this field are met, the value 00h in this field has undefined behavior. This field is used by the host controller to match against the three low-order bits of USB Frame Index (FRINDEX). If the USB Frame Index (FRINDEX) bits decode to a position where the value of µFrame C-Mask field is 1, then this QHis a candidate for transaction execution. There may be more than one bit in this mask set.                                                                                                                                                                          |
| 7-0     | Interrupt Schedule Mask (µFrame S-mask). This field is used for all endpoint speeds. You must set this field to 00h when the QHis on the asynchronous schedule. Anon-zero value in this field indicates an interrupt endpoint. The host controller uses the value of the three low-order bits of USB Frame Index (FRINDEX) as an index into a bit position in this bit vector. If the µFrame S-mask field has a 1 at the indexed bit position then this QH is a candidate for transaction execution. If the EPSfield indicates the endpoint is a HSendpoint, then the transaction executed is determined by the PID_Code field contained in the execution area. This field is also used to support split transaction types: Interrupt (IN/OUT). This condition is true when this field is non-zero and the EPS field indicates this is either a FS or LS device. A value of 00h in this field, in combination with existing in the periodic frame list, has undefined results. |

## 55.8.2.6.3 Transfer overlay-QH

The nine DWords in this area represent a transaction working space for the host controller. The general operational model is that the host controller can detect whether the overlay area contains a description of an active transfer. If it does not contain an active transfer, then it follows the QHLP the next QH. The host controller never follows the Next Transfer Queue Element or Alternate Queue Element pointers unless it is actively attempting to advance the queue. For the duration of the transfer, the host controller keeps the incremental status of the transfer in the overlay area. When the transfer is complete, the results are written back to the original queue element.

The DWord3 of a QH contains a pointer to the source qTD currently associated with the overlay. The host controller uses this pointer to write back the overlay area into the source qTD after the transfer is complete.

The following table describes the Current qTD Link Pointer field descriptions.

Table 462. Current qTD link pointer

| Field   | Description                                                                                                                                                                                        |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-5    | Current Element Transaction Descriptor Link Pointer. Contains the address of the current transaction being processed in this queue and corresponds to memory address signals [31:5], respectively. |
| 4-0     | Reserved (R). The host controller ignores these bits when using the value as an address to write data. The actual value may vary depending on the usage.                                           |

The DWords 4-11 of a QH are the transaction overlay area. This has the same base structure as a qTD. The QH uses the reserved fields of the page pointers to implement tracking of the state of split transactions.

Universal Serial Bus On-The-Go Controller (USBOTG)

This area is characterized as an overlay because when the queue is advanced to the next queue element, the source queue element is merged onto this area. This area serves as execution cache for the transfer.

The table below describes the host-controller rules for bits in overlay.

Table 463. Host-controller rules for bits in overlay (DWords 5, 6, 8 and 9)

|   DWord | Field   | Description                                                                                                                                                                                                                                                                                                                                                                              |
|---------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|       5 | 4-1     | Nak Counter (NakCnt)µRW. The host controller decrements this value whenever a transaction for the endpoint associated with this QH results in a Nak or Nyet response. This counter is reloaded from RL before a transaction is executed during the first pass of the reclamation list (relative to an Asynchronous List Restart condition). It is also loaded from RL during an overlay. |
|       6 | 31      | Data Toggle. Controls whether the host controller preserves this bit when an overlay operation is performed.                                                                                                                                                                                                                                                                             |
|       6 | 15      | IOC. Is always inherited from the source qTD when the overlay operation is performed.                                                                                                                                                                                                                                                                                                    |
|       6 | 11-10   | Error Counter (C_ERR). Is copied from the qTD during the overlay and written back during queue advancement.                                                                                                                                                                                                                                                                              |
|       6 | 0       | Ping State (P)/ERR. If the EPS field indicates a HS endpoint, then you must preserve this field during the overlay operation.                                                                                                                                                                                                                                                            |
|       8 | 7-0     | Split-transaction Complete-split Progress (C-prog-mask). Is initialized to zero during any overlay. This field is used to track the progress of an interrupt split-transaction.                                                                                                                                                                                                          |
|       9 | 4-0     | Split-transaction Frame Tag (Frame Tag). Is initialized to zero during any overlay. This field is used to track the progress of an interrupt split-transaction.                                                                                                                                                                                                                          |
|       9 | 11-5    | S-bytes. Youmustensure that the S-bytes field in a qTDis zero before activating the qTD. This field is used to keep track of the number of bytes sent or received during an IN or OUTsplit transaction.                                                                                                                                                                                  |

## 55.8.2.7 Periodic FSTN

This data structure is to be used only for managing FS and LS transactions that span a host-frame boundary.

See Host controller operational model for FSTNs for full operational details. You must not use an FSTN in the asynchronous schedule. An FSTN in the asynchronous schedule results in undefined behavior. You must not use the FSTN feature with a host controller whose USB\_HCIVERSION register indicates a revision implementation below 0096h. FSTNs are not defined for implementations before 0.96 and their use yields undefined results.

| 3 1 2 8                  | 3 0   | 2 9   | 2 7   | 2 6   | 2 5   | 2 4   | 2 3 2   | 2 2 1   | 2 0   | 1 9   | 1 8   | 1 7 1 6   | 1 5   | 1 4 1 3   | 1 2   | 1 1   | 1 0   | 9   | 8 7   |    |   6 5 |     | 4   | 3 1   | 2   | 0          |
|--------------------------|-------|-------|-------|-------|-------|-------|---------|---------|-------|-------|-------|-----------|-------|-----------|-------|-------|-------|-----|-------|----|-------|-----|-----|-------|-----|------------|
| Normal Path Link Pointer |       |       |       |       |       |       |         |         |       |       |       |           |       |           |       |       |       |     |       |  0 |     0 | Typ | Typ | T     |     | 0 3- 0 0 h |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table continued from the previous page...

| Back Path Link Pointer   | 0   | Typ   | T   | 0 7- 0 4 h   |
|--------------------------|-----|-------|-----|--------------|

## Table 464. FSTN structure layout

| Host controller read/write   | Host controller read only   |
|------------------------------|-----------------------------|

## 55.8.2.7.1 FSTN normal path pointer

The first DWord of an FSTN contains a link pointer to the next schedule object. This object can be of any valid periodic schedule data type.

The following table describes the FSTN normal path pointer fields.

## Table 465. FSTN normal path pointer field descriptions

| Field   | Description                                                                                                                                                                                                                                                                                        |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-5    | Normal Path Link Pointer (NPLP). Contains the address of the next data object to be processed in the periodic list and corresponds to memory address signals [31:5], respectively.                                                                                                                 |
| 4-3     | Reserved                                                                                                                                                                                                                                                                                           |
| 2-1     | QH/(s)iTD/FSTN Select (Typ). Indicates to the host controller whether the item referenced is an iTD/siTD, a QH, or an FSTN.This allows the host controller to perform the proper type of processing on the item after it is fetched. Value encodings are: 00b - iTD 01b - QH 10b - siTD 11b - FSTN |
| 0       | Terminate (T) 1 - Link Pointer field is not valid. 0 - Link Pointer is valid.                                                                                                                                                                                                                      |

## 55.8.2.7.2 FSTN back path link pointer

The second DWord of an FTSN node contains a Link Pointer to a QH. If the T-bit in this pointer is zero, then this FSTN is a Save-Place indicator. You must set its Typ field to indicate the target data structure is a QH. If the T-bit in this pointer is set to one, then this FSTN is the Restore Indicator. When the T-bit is one, the host controller ignores the Typ field.

The following table describes the FSTN back path link pointer fields.

Table 466. FSTN back path link pointer field descriptions

| Field   | Description                                                                                                                                                                                                                                                                                                                                                                      |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-5    | Back Path Link Pointer (BPLP). Contains the address of a QH. This field corresponds to memory address signals [31:5], respectively.                                                                                                                                                                                                                                              |
| 4-3     | Reserved                                                                                                                                                                                                                                                                                                                                                                         |
| 2-1     | Typ. You must ensure this field is set to indicate the target data structure is a QH. Any other value in this field yields undefined results.                                                                                                                                                                                                                                    |
| 0       | Terminate (T). 1 - Link Pointer field is not valid; that is, the host controller must not use bits [31:5] as a valid memory address. This value also indicates that this FSTN is a Restore Indicator. 0 - Link Pointer is valid; that is, the host controller may use bits [31:5] as a valid memory address. This value also indicates that this FSTN is a Save-Place Indicator. |

## 55.9 Device mode operation

The function of the device operation is to transfer a request to and from the Universal Serial Bus (USB). The device controller performs data transfers using a set of linked list transfer descriptors pointed to by a QH. The next sections explain the use of the device controller from the DCD point-of-view and further describes how specific USB events relate to status changes in the device controller programmer's interface.

## 55.9.1 Port state and control

From a chip or system reset, the USB OTG module enters the Powered state. A transition from the Powered state to the Attach state occurs when USBCMD[RS] is 1. After receiving a reset on the bus, the port enters the DefaultFS or DefaultHS state in accordance with the protocol reset described in Appendix C.2 of the Universal Serial Bus Specification, Revision 2.0. The next figure depicts the states of a USB 2.0 device.

Universal Serial Bus On-The-Go Controller (USBOTG)

<!-- image -->

States Powered, Attach, Default FS or HS, and Suspend FS or HS are implemented in the USB OTG, and they are communicated to the DCD using the following status fields:

Table 467. Device controller state information fields

| Field                    | Register   |
|--------------------------|------------|
| DC Suspend (SLI)         | USBSTS     |
| USB Reset Received (URI) | USBSTS     |
| Port Change Detect (PCI) | USBSTS     |
| HS Port (PSPD)           | PORTSCn    |

The DCD software must maintain a state variable to differentiate between the Default FS or HS state and the Address/Configured states. Change of state from Default to the Address and Configured states is part of the enumeration process described in the Device Framework section of the USB 2.0 specification.

As a result of entering the Address state, the DCD must program the Device Address Register (DEVICEADDR).

Entry into the configured state indicates that all endpoints to be used in the operation of the device have been properly initialized by programming the ENDPTCTRLn registers and initializing the associated queue heads.

## 55.9.2 Bus reset

The host uses a bus reset to initialize downstream devices. When a bus reset is detected, the USB OTG controller does the following:

1. Renegotiates its attachment speed.
2. Resets the device address to 0.
3. Notifies the DCD by interrupt (assuming the USB reset interrupt enable (USBINTR[URE]) is 1).

After a reset is received, all endpoints (except endpoint 0) are disabled and the device controller cancels any primed transactions. The concept of priming is clarified below, but when a reset is received, the DCD must perform the following:

1. Clear all setup token semaphores by reading Endpoint Setup Status (ENDPTSETUPSTAT) and writing the same value back to this register.
2. Clear all the endpoint complete status bits by reading Endpoint Complete (ENDPTCOMPLETE) and writing the same value back to this register.
3. Cancel all primed status by waiting until all bits in Endpoint Initialization (ENDPTPRIME) are 0 and then writing 000F\_000Fh to Endpoint De-Initialize (ENDPTFLUSH).
4. Read PORTSCn[PR] and make sure it remains active. A USB reset occurs for a minimum of 3 ms and the DCD must reach this point in the reset clean-up before the end of the reset occurs; otherwise, a hardware reset of the device controller is recommended (rare).
- a. Writing a 1 to USBCMD[RST] can perform a hardware reset.

## NOTE

A hardware reset causes the device to detach from the bus by writing 0 to USBCMD[RS]. Therefore, the DCD must completely re-initialize the USB OTG after a hardware reset.

5. Free all allocated dTDs because the device controller no longer executes them. If this is the first time the DCD processes a USB reset event, it is likely no dTDs have been allocated.
6. At this time, the DCD may release control back to the OS because no further changes to the device controller are permitted until a port change detect is indicated.
7. After a port change detect, the device has reached the default state and the DCD can read PORTSCn to determine if the device operates in FS or HS mode. At this time, the device controller has reached normal operating mode and DCD can begin enumeration (see the "Device Framework" chapter of the USB specification).

## 55.9.3 Suspend/resume

To conserve power, the USB OTG module automatically enters the Suspended state when no bus traffic is observed for a specified period. When suspended, the module maintains any internal status, including its address and configuration. Attached devices must be prepared to suspend any time they are powered, regardless of whether they are assigned a non-default address, are configured, or neither. Bus activity may cease because the host enters a Suspend mode of its own. In addition, a USB device also enters the Suspended state when the hub port it is attached to is disabled.

The USB OTG module exits Suspend mode when there is bus activity. It may also request the host to exit Suspend mode or selectively suspend by using electrical signaling to indicate remote wake-up. The ability of a device to signal remote wake-up is optional. The USB OTG is capable of remote wake-up signaling. When the USB OTG is reset, remote wake-up signaling must be disabled.

## 55.9.3.1 Suspend operational model

The USB OTG moves into the Suspend state when suspend signaling is detected or activity is missing on the upstream port for more than a specific period. After the device controller enters the Suspend state, an interrupt notifies the DCD (assuming that the device controller suspend interrupt is enabled, by writing 1 to USBINTR[SLE]). When you write 1 to PORTSCn[SUSP], the device controller is suspended.

Universal Serial Bus On-The-Go Controller (USBOTG)

DCD response when the device controller is suspended is application-specific and may involve switching to a low-power operation. See the USB 2.0 specification for information on the bus power limits in the Suspend state.

## 55.9.3.2 Resume

If the USB OTG is suspended, its operation resumes when any non-idle signaling is received on its upstream-facing port. In addition, the USB OTG can signal the system to resume operation by forcing resume signaling to the upstream port. Writing 1 to PORTSCn[FPR] when the device is in the Suspend state sends resume signaling upstream. Sending a resume signal to an upstream port should cause the host to issue resume signaling and bring the suspended bus segment (one or more devices) back to the active condition.

## NOTE

Before the use of resume signaling, the host must enable it by using the set feature command defined in the "Device Framework" chapter of the USB 2.0 specification.

## 55.9.4 Managing endpoints

The USB 2.0 specification defines an endpoint (also called a device endpoint or an address endpoint) as a uniquely addressable portion of a USB device that can source or sink data in a communications channel between the host and the device. The combination of the endpoint number and the endpoint direction specifies endpoint address.

The channel between the host and an endpoint at a specific device represents a data pipe. Endpoint 0 for a device is always a control type data channel used for device discovery and enumeration. Other types of endpoints that are supported by USB include bulk, interrupt, and isochronous. Each endpoint type has specific behavior related to packet response and error managing. See the USB 2.0 specification for more details.

The USB OTG supports up to six endpoint-specified numbers. The DCD can enable, disable, and configure each endpoint except endpoint 0.

Each endpoint direction is essentially independent and can have differing behavior in each direction. For example, the DCD can configure endpoint 1-IN to be a bulk endpoint and endpoint 1-OUT to be an isochronous endpoint. This helps to conserve the total number of endpoints required for device operation. The only exception is that control endpoints must use both directions on a single endpoint number to function as a control endpoint. Endpoint 0, for example, is always a control endpoint and uses both directions.

Each endpoint direction requires a QH allocated in memory. If the maximum is six endpoint numbers (one for each endpoint direction used by the device controller), 12 QHs are required. The operation of an endpoint and use of QHs are described later in this document.

## 55.9.4.1 Endpoint initialization

After a hardware reset, all endpoints except endpoint 0 are uninitialized and disabled. The DCD must configure and enable each endpoint by writing to the appropriate ENDPTCTRLn register. Each register is split into an upper and lower half. The lower half of the register configures the receive or OUT endpoint, and the upper half configures the corresponding transmit or IN endpoint. Control endpoints must have the same configuration in the upper and lower halves of the register; otherwise, behavior is undefined. The next table shows how to construct a configuration word for endpoint initialization.

Table 468. Device controller endpoint initialization

| Field                          | Value                         |
|--------------------------------|-------------------------------|
| Data Toggle Reset (TXR, RXR)   | 1 - Synchronize the data PIDs |
| Data Toggle Inhibit (TXI, RXI) | 0 - PID sequencing disabled   |

Table continues on the next page...

Table 468. Device controller endpoint initialization (continued)

| Field                     | Value                                                  |
|---------------------------|--------------------------------------------------------|
| Endpoint Type (TXT, RXT)  | 00 - Control 01 - Isochronous 10 - Bulk 11 - Interrupt |
| Endpoint Stall (TXS, RXS) | 0 - Not stalled                                        |

## 55.9.4.2 Stalling

There are two occasions for which the USB OTG may need to return a STALL response to the host:

- The functional stall is a condition set by the DCD as described in the USB 2.0 Device Framework chapter. A functional stall is used only on non-control endpoints and can be enabled in the device controller by setting the endpoint stall bit in the ENDPTCTRLn register associated with the given endpoint and the given direction. In a functional stall condition, the device controller continues to return STALL responses to all transactions occurring on the respective endpoint and direction until the endpoint stall bit is cleared by the DCD.
- A protocol stall, unlike a functional stall, is used on control endpoints and automatically cleared by the device controller at the start of a new control transaction (setup phase). When enabling a protocol stall, the DCD must enable the stall bits as a pair (TXS and RXS bits). A single write to the ENDPTCTRLn register can ensure both stall bits are set at the same instant.

## NOTE

Any write to the ENDPTCTRLn register during operational mode must preserve the endpoint type field (perform a read-modify-write).

Table 469. Device controller stall response matrix

| USB packet                                            | Endpoint stall bit   | Effect on stall bit   | USB response   |
|-------------------------------------------------------|----------------------|-----------------------|----------------|
| SETUP packet received by a non-control endpoint       | N/A                  | None                  | STALL          |
| IN/OUT/PING packet received by a non-control endpoint | 1                    | None                  | STALL          |
| IN/OUT/PING packet received by a non-control endpoint | 0                    | None                  | ACK/NAK/NYET   |
| SETUP packet received by a control endpoint           | N/A                  | Cleared               | ACK            |
| IN/OUT/PING packet received by a control endpoint     | 1                    | None                  | STALL          |
| IN/OUT/PING packet received by a control endpoint     | 0                    | None                  | ACK/NAK/NYET   |

## 55.9.4.3 Data toggle

Data toggle maintains data coherency between host and device for any given data pipe. See the USB 2.0 specification for more information on data toggle.

Universal Serial Bus On-The-Go Controller (USBOTG)

## 55.9.4.3.1 Data toggle reset

The DCD may reset the Data Toggle state bit and cause the data toggle sequence to reset in the device controller by setting the Data Toggle reset field in the ENDPTCTRLn register. This must only happen when configuring or initializing an endpoint or returning from a STALL condition.

## 55.9.4.3.2 Data toggle inhibit

This feature is for test purposes only and must never be used during normal device controller operation.

Setting the Data Toggle Inhibit bit causes the USB OTG module to ignore the data toggle pattern normally sent and accepts all incoming data packets regardless of the data toggle state.

In normal operation, the USB OTG checks the DATA0/DATA1 bit against the Data Toggle to determine if the packet is valid. If the data PID does not match the Data Toggle state bit maintained by the device controller for that endpoint, the data toggle is considered not valid. If the data toggle is not valid, the device controller assumes the packet was already received and discards the packet (not reporting it to the DCD). To prevent the USB OTG from re-sending the same packet, the device controller responds to the error packet by acknowledging it with an ACK or NYET response.

## 55.9.5 Packet transfers

The host initiates all transactions on the USB bus, and in turn the device must respond to any request from the host within the turnaround time stated in the USB 2.0 specification.

A USB host sends requests to the USB OTG in an order that cannot be precisely predicted as a single pipeline, so it is not possible to prepare a single packet for the device controller to execute. However, the order of packet requests is predictable when the endpoint number and direction is considered. For example, if endpoint 3 (transmit direction) is configured as a bulk pipe, expect the host to send IN requests to that endpoint. This USB OTG module prepares packets for each endpoint/direction in anticipation of the host request. The process of preparing the device controller to send or receive data in response to host-initiated transactions on the bus is referred to as priming the endpoint. This term appears throughout the documentation to describe the USB OTG operation so the DCD is built properly. In addition, the term flushing describes the action of clearing a packet queued for execution.

## 55.9.5.1 Priming transmit endpoints

Priming a transmit endpoint causes the device controller to fetch the dTD for the transaction pointed to by the dQH. After the dTD is fetched, it is stored in the dQH until the device controller completes the transfer described by the dTD. Storing the dTD in the dQH allows the device controller to fetch the operating context needed to manage a request from the host without the need to follow the linked list, starting at the dQH when the host request is received.

After the device has loaded the dTD, the leading data in the packet is stored in a FIFO in the device controller. This FIFO splits into virtual channels so the leading data can be stored for any endpoint up to the maximum number of endpoints configured at device synthesis time.

After a priming request is complete, an endpoint state of "primed" is indicated in Endpoint Status (ENDPTSTAT). For a primed transmit endpoint, the device controller can respond to an IN request from the host and meet the stringent bus turnaround time of HS USB.

## 55.9.5.2 Priming receive endpoints

Priming receives endpoints identical to priming of transmit endpoints from the point of view of the DCD. The major difference in the operational model at the device controller is no data movement of the leading packet data because the data is to be received from the host.

As part of the architecture, the FIFO for the receive endpoints is not partitioned into multiple channels like the transmit FIFO. Thus, the size of the RX FIFO does not scale with the number of endpoints.

## 55.9.5.3 Interrupt/bulk endpoint operation

The behaviors of the device controller for interrupt and bulk endpoints are identical. All valid IN and OUT transactions to bulk pipes handshake with a NAK unless the endpoint is primed. After the endpoint is primed, data delivery commences.

Universal Serial Bus On-The-Go Controller (USBOTG)

Universal Serial Bus On-The-Go Controller (USBOTG)

A dTD is retired by the device controller when the packets described in the TD are completed. Each dTD describes N packets to transfer according to the USB variable length transfer protocol. The formula below and the next table describe how the device controller computes the number and length of the packets sent/received by the USB, which varies according to the total number of bytes and maximum packet length. See Endpoint capabilities and characteristics (offset = 0h) for details on the ZLT bit.

With zero-length termination (ZLT) cleared:

N = INT(number of bytes/maximum packet length) + 1

With zero-length termination (ZLT) set:

N = MAXINT(number of bytes/maximum packet length)

Table 470. Variable length transfer protocol example (ZLT=0)

|   Bytes (dTD) |   Maximumpacketlength (dQH) |   N |   P1 |   P2 | P3   |
|---------------|-----------------------------|-----|------|------|------|
|           511 |                         256 |   2 |  256 |  255 | -    |
|           512 |                         256 |   3 |  256 |  256 | 0    |
|           512 |                         512 |   2 |  512 |    0 | -    |

Table 471. Variable length transfer protocol example (ZLT=1)

|   Bytes (dTD) |   Maximumpacketlength (dQH) |   N |   P1 | P2   | P3   |
|---------------|-----------------------------|-----|------|------|------|
|           511 |                         256 |   2 |  256 | 255  | -    |
|           512 |                         256 |   2 |  256 | 256  | -    |
|           512 |                         512 |   1 |  512 | -    | -    |

TX-dTD is complete when:

- All packets described in the dTD successfully transmit. Total bytes in dTD equal 0 when this occurs.

RX-dTD is complete when:

- All packets described in the dTD are successfully received. Total bytes in dTD equal 0 when this occurs.
- A short packet (number of bytes &lt; maximum packet length) was received.

This is a successful transfer completion; DCD must check the total bytes field in the dTD to determine the number of bytes remaining. From the total bytes remaining in the dTD, the DCD can compute the actual bytes received.

- A long packet was received (number of bytes &gt; maximum packet size) or (total bytes received &gt; total bytes specified).

This is an error condition. The device controller discards the remaining packets and sets the buffer error bit in the dTD. In addition, the endpoint flushes and the USBERR interrupt becomes active.

## NOTE

Disabling zero-length packet termination allows transfers larger than the total bytes field spanning across two or more dTDs.

Upon successful completion of the packet(s) described by the dTD, the active bit in the dTD is cleared and the next pointer is followed when the terminate bit is clear. When the terminate bit is set, the USB OTG flushes the endpoint/direction and ceases operations for that endpoint/direction.

Universal Serial Bus On-The-Go Controller (USBOTG)

Upon unsuccessful completion of a packet (see long packet above), the dQH remains pointing to the dTD in error. To recover from this error condition, DCD must properly re-initialize the dQH by clearing the active bit and update the nextTD pointer before attempting to re-prime the endpoint.

## NOTE

All packet level errors, such as a missing handshake or CRC error, are retried automatically by the device controller.

There is no required interaction with the DCD for managing such errors.

Table 472. Interrupt/bulk endpoint bus response matrix

| Token type   | Stall   | Not primed   | Primed               | Underflow   | Overflow   |
|--------------|---------|--------------|----------------------|-------------|------------|
| Setup        | Ignore  | Ignore       | Ignore               | N/A         | N/A        |
| In           | STALL   | NAK          | Transmit             | BS Error 1  | N/A        |
| Out          | STALL   | NAK          | Receive + NYET/ACK 2 | N/A         | NAK        |
| Ping         | STALL   | NAK          | ACK                  | N/A         | N/A        |
| Invalid      | Ignore  | Ignore       | Ignore               | Ignore      | Ignore     |

1. Force bit stuff error
2. NYET/ACK - NYET; or, if the TD has packets remaining according to the USB variable length protocol, then ACK.

## 55.9.6 Control endpoint operation

## 55.9.6.1 Setup phase

All requests to a control endpoint begin with a setup phase followed by an optional data phase and a required status phase.

Setup packet managing:

- Disable setup lockout by writing 1 to USBMODE[SLOM] at initialization. Setup lockout is not necessary when using the tripwire as described below.

## NOTE

Leaving the setup lockout mode cleared results in a potential compliance issue.

- After receiving an interrupt and inspecting Endpoint Setup Status (ENDPTSETUPSTAT) to determine a setup packet was received on a particular pipe:
1. Write 1 to clear the corresponding field in Endpoint Setup Status (ENDPTSETUPSTAT).
2. Set the setup tripwire field (USBCMD[SUTW]).
3. Duplicate contents of dQH.SetupBuffer into a local software byte array.
4. Read USBCMD[SUTW]. If set to 1, continue; if cleared to 0, go to step 2.
5. Clear USBCMD[SUTW].
6. Poll Endpoint Setup Status (ENDPTSETUPSTAT) until it clears to 0.
7. Process the setup packet using the local software byte array copy and execute status/handshake phases.

## NOTE

After receiving a new setup packet, status and/or handshake phases may remain pending from a previous control sequence. These must be flushed and de-allocated before linking a new status and/or handshake dTD for the most recent setup packet.

## 55.9.6.2 Data phase

Following the setup phase, the DCD must create a dTD for the data phase and prime the transfer.

After priming the packet, the DCD must verify a new setup packet is not received by reading Endpoint Setup Status (ENDPTSETUPSTAT) immediately, verifying that the prime had completed. A prime completes when the associated field in Endpoint Initialization (ENDPTPRIME) is cleared to 0 and the associated field in Endpoint Status (ENDPTSTAT) is set to 1. If Endpoint Initialization (ENDPTPRIME) goes to 0 and Endpoint Status (ENDPTSTAT) is not set to 1, the prime fails. This can only happen because of improper setup of the dQH, dTD, or a setup arriving during the prime operation. If a new setup packet is indicated after Endpoint Initialization (ENDPTPRIME) is cleared to 0, then the TD can be freed and the DCD must reinterpret the setup packet.

Should a setup arrive after the data stage is primed, the device controller automatically clears the prime status (Endpoint Status (ENDPTSTAT)) to enforce data coherency with the setup packet.

## NOTE

Error managing of data phase packets is the same as for bulk packets described previously.

## 55.9.6.3 Status phase

Similar to the data phase, the DCD must create a TD (with byte length equal to 0) and prime the endpoint for the status phase. The DCD must also perform the same checks of Endpoint Setup Status (ENDPTSETUPSTAT) as described above in the data phase.

## NOTE

Error managing of status phase packets is the same as bulk packets described previously.

## 55.9.6.4 Control endpoint bus response matrix

The next table shows the device controller response to packets on a control endpoint according to the device controller state.

Table 473. Control endpoint bus response matrix

| Token type   | Endpoint state   | Endpoint state   | Endpoint state       | Endpoint state   | Endpoint state   | Setup lockout   |
|--------------|------------------|------------------|----------------------|------------------|------------------|-----------------|
| Token type   | Stall            | Not primed       | Primed               | Underflow        | Overflow         | Setup lockout   |
| Setup        | ACK              | ACK              | ACK                  | N/A              | SYSERR 1         |                 |
| In           | STALL            | NAK              | Transmit             | BS Error 2       | N/A              | N/A             |
| Out          | STALL            | NAK              | Receive + NYET/ACK 3 | N/A              | NAK              | N/A             |
| Ping         | STALL            | NAK              | ACK                  | N/A              | N/A              | N/A             |
| Invalid      | Ignore           | Ignore           | Ignore               | Ignore           | Ignore           | Ignore          |

1. SYSERR - System error must never occur when the latency FIFOs are correctly sized and the DCD is responsive.
3. NYET/ACK - NYET; or, if the TD has packets remaining according to the USB variable length protocol, then ACK.
2. Force bit stuff error.

## 55.9.7 Isochronous endpoint operation

Isochronous endpoints are used for real-time scheduled delivery of data, and their operational model is significantly different than the host throttled bulk, interrupt, and control data pipes. Real time delivery by the USB OTG is accomplished by:

- Exactly MULT packets per (micro)frame are transmitted/received.

Universal Serial Bus On-The-Go Controller (USBOTG)

## NOTE

MULT is a 2-bit field in the dQH. Isochronous endpoints do not use the variable length packet protocol.

- NAK responses are not used. Instead, zero-length packets are sent in response to an IN request to unprimed endpoints. For unprimed RX endpoints, the response to an OUT transaction is to ignore the packet within the device controller.
- Prime requests always schedule the transfer described in the dTD for the next (micro)frame. If ISO-dTD remains active after that frame, ISO-dTD holds ready until executed or canceled by the DCD.

The USB OTG in Host mode uses the periodic frame list to schedule data exchanges to isochronous endpoints. The operational model for Device mode does not use such a data structure. Instead, the same dTD used for control/bulk/interrupt endpoints is also used for isochronous endpoints. The difference is in the managing of the dTD.

The first difference between bulk and ISO-endpoints is that priming an ISO-endpoint is a delayed operation such that an endpoint becomes primed only after a SOF is received. After the DCD writes the prime bit, the prime bit clears as usual to indicate to you that the device controller completed priming the dTD for transfer. Internal to the design, the device controller hardware masks that prime start until the next frame boundary. This behavior is hidden from the DCD, but occurs so the device controller can match the dTD to a specific (micro)frame.

Another difference with isochronous endpoints is that the transaction must wholly complete in a (micro)frame. After an ISO transaction is started in a (micro)frame, it retires the corresponding dTD when MULT transactions occur or the device controller finds a fulfillment condition.

The transaction error bit set in the status field indicates a fulfillment error condition. When a fulfillment error occurs, the frame after the transfer failed to complete wholly, and the device controller retires the current ISO-dTD and moves to the next ISO-dTD.

Fulfillment errors are only caused due to partially completed packets. If no activity occurs to a primed ISO-dTD, the transaction stays primed indefinitely. This means you must discard transmit ISO-dTDs that pile up from a failure of the host to move the data.

Finally, the last difference with ISO packets is in the data level error managing. When a CRC error occurs on a received packet, the packet is not retried as is done for bulk and control endpoints. Instead, the CRC is noted by setting the transaction error bit and the data is stored as usual for you to sort out.

- TX packet retired:
- MULT counter reaches zero.
- Fulfillment error (Transaction Error bit is 1):
- # packets occurred &gt; 0 AND # packets occurred &lt; MULT

## NOTE

For TX-ISO, MULT counter can be loaded with a lesser value in the dTD multiplier override field. If the multiplier override field is 0, the MULT counter initializes to the multiplier in the QH.

- RX packet retired:
- MULT counter reaches zero.
- Non-MDATA data PID is received.
- Overflow error (Buffer Error bit is 1):
- Packet received is &gt; maximum packet length.
- Packet received exceeds total bytes allocated in dTD.
- Fulfillment error (Transaction Error bit is 1):
- # packets occurred &gt; 0 AND # packets occurred &lt; MULT
- CRC error (Transaction Error bit is 1)

Universal Serial Bus On-The-Go Controller (USBOTG)

## NOTE

For ISO, when a dTD is retired, the next dTD is primed for the next frame. For continuous (micro)frame to (micro)frame operation, DCD must ensure the dTD linked list is out ahead of the device controller by at least two (micro)frames.

## 55.9.7.1 Isochronous pipe synchronization

When it is necessary to synchronize an isochronous data pipe to the host, the (micro)frame number (USB Frame Index (FRINDEX)) can act as a marker. To cause a packet transfer to occur at a specific (micro)frame number (N), the DCD must interrupt on SOF during frame N-1. When USB Frame Index (FRINDEX) equals N-1, the DCD must write the prime bit. The USB OTG primes the isochronous endpoint in (micro)frame N-1 so the device controller executes delivery during (micro)frame N.

## CAUTION

Priming an endpoint towards the end of (micro)frame N-1 does not guarantee delivery in (micro)frame N. The delivery may actually occur in (micro)frame N+1 if the device controller does not have enough time to complete the prime before the SOF for packet N is received.

## 55.9.7.2 Isochronous endpoint bus response matrix

Table 474. Isochronous endpoint bus response matrix

| Token type   | Stall         | Not primed   | Primed   | Underflow   | Overflow    |
|--------------|---------------|--------------|----------|-------------|-------------|
| Setup        | STALL         | STALL        | STALL    | N/A         | N/A         |
| In           | NULL 1 packet | NULL packet  | Transmit | BS error 2  | N/A         |
| Out          | Ignore        | Ignore       | Receive  | N/A         | Drop packet |
| Ping         | Ignore        | Ignore       | Ignore   | Ignore      | Ignore      |
| Invalid      | Ignore        | Ignore       | Ignore   | Ignore      | Ignore      |

1. Zero length packet
2. Force bit stuff error

## 55.9.8 Managing QHs

The dQH points to the linked list of transfer tasks, each depicted by the dTD. An area of memory pointed to by ENDPOINTLISTADDR register contains a group of every dQH in a sequential list (see the next figure). The even elements in the dQH list receive endpoints (OUT/SETUP) and the odd elements transmit endpoints (IN/INTERRUPT). dTDs are linked head to tail starting at the QH and ending at a terminate bit. After the dTD retires, it is no longer part of the linked list from the QH. Therefore, you are required to track all transfer descriptors because pointers no longer exist within the QH after the dTD is retired (see Software link pointers).

Universal Serial Bus On-The-Go Controller (USBOTG)

## NOTE

The DCD must only modify dQH if the associated endpoint is not primed and there are no outstanding dTDs.

## 55.9.8.2 Setup transfers operation

As discussed in Control endpoint operation, setup transfers require special treatment by the DCD. A setup transfer does not use a dTD, but instead stores the incoming data from a setup packet in an 8-byte buffer within the dQH.

Upon receiving notification of the setup packet, the DCD must manage the setup transfer by:

1. Copying setup buffer contents from dQH-RX to the software buffer.
2. Acknowledging setup backup by writing a 1 to the corresponding field in Endpoint Setup Status (ENDPTSETUPSTAT).

Universal Serial Bus On-The-Go Controller (USBOTG)

<!-- image -->

In addition to current and next pointers and the dTD overlay examined in Packet transfers, the dQH also contains the following parameters for the associated endpoint:

- Multiplier
- Maximum packet length
- Interrupt on setup

The next section includes a demonstration of complete initialization of the dQH including these fields.

## 55.9.8.1 QH initialization

One dQH pair must be initialized for each active endpoint. To initialize a dQH:

1. Write to the wMaxPacketSize field as required by the USB specification chapter 9 or application-specific protocol.
2. Write the multiplier field to 0 for control, bulk, and interrupt endpoints. For ISO endpoints, set the multiplier to 1, 2, or 3 as required for bandwidth with the USB specification chapter 9 protocol. In FS mode, the multiplier field can only be 1 for ISO endpoints.
3. Set the next dTD terminate bit field.
4. Clear the active bit in the status field.
5. Clear the halt bit in the status field.

## 55.9.9.2 Building a TD

Before a transfer can be executed from the linked list, a dTD must be built to describe the transfer. You use the following procedure for building dTDs.

First, you allocate a 32-byte dTD block of memory aligned to 32-byte boundaries. The last 5 bits of the address must equal 00000.

Then, you need to do the following:

1. Initialize the first 7 entries (28 bytes) to 0.
2. Set the terminate field.
3. Fill in total bytes with transfer size.
4. Set the IOC field if desired.
5. Initialize the Status field with the Active field set to 1, and all remaining status bits cleared to 0.

## NOTE

The acknowledge must occur before continuing to process the setup packet. After acknowledge occurs, DCD must not attempt to access the setup buffer in dQH-RX. Only the local software copy should be examined.

3. Checking for pending data or status dTDs from previous control transfers and flushing any that exist as discussed in Flushing/de-priming an endpoint.

## NOTE

It is possible for the device controller to receive setup packets before previous control transfers complete. Existing control packets in progress must be flushed and the new control packet completed.

4. Decoding the setup packet and prepare data phase (optional) and status phase transfer as required by the USB specification chapter 9 or application-specific protocol.

## 55.9.9 Managing transfers with transfer descriptors

## 55.9.9.1 Software link pointers

It is necessary for the DCD software to maintain head and tail pointers for the linked list of dTDs for each respective QH. This is necessary because the dQH only maintains pointers to the current working dTD and the next dTD executed. The operations described in the next section for managing dTDs assumes the DCD can reference the head and tail of the dTD linked list.

## NOTE

To conserve memory, the reserved fields at the end of the dQH can be used to store the head and tail pointers, but the DCD must continue maintaining the pointers.

<!-- image -->

## NOTE

Check the status of each dTD to determine completed status.

Universal Serial Bus On-The-Go Controller (USBOTG)

Universal Serial Bus On-The-Go Controller (USBOTG)

6. Fill in buffer pointer page 0 and the current offset to point to the start of the data buffer.
7. Initialize buffer pointer page 1 through page 4 to be one greater than each of the previous buffer pointers.

## 55.9.9.3 Executing a TD

To safely add a dTD, the DCD must follow this procedure that manages the event where the device controller reaches the end of the dTD list. At the same time, a new dTD is added to the end of the list.

The DCD needs to determine whether the linked list is empty by checking the DCD driver to see if the pipe is empty (the internal representation of the linked list must indicate if any packets are outstanding).

Case 1: Linked list is empty.

1. Write the dQH next pointer AND dQH terminate bit to 0 as a single 32-bit operation.
2. Clear the active and halt bits in the dQH (in case set from a previous error).
3. Prime the endpoint by writing 1 to the correct bit position in Endpoint Initialization (ENDPTPRIME).

Case 2: Linked list is not empty.

1. Add the dTD to the end of the linked list.
2. Read the correct prime bit in Endpoint Initialization (ENDPTPRIME); if 1, then we are done.
3. Write 1 to USBCMD[ATDTW].
4. Read the correct status bit in Endpoint Status (ENDPTSTAT), and store it in a temporary variable for later.
5. Read USBCMD[ATDTW]:

If it is 0, go to step 3.

If it is 1, continue to step 6.

6. Write 0 to USBCMD[ATDTW].
7. If the status bit read in step 4 is 1, then DONE.
8. If the status bit read in step 4 is 0, then go to step 1 in case 1.

## 55.9.9.4 Transfer completion

After a dTD is initialized and the associated endpoint is primed, the device controller executes the transfer upon the host-initiated request. The DCD is notified with a USB interrupt if the IOC field was set, or alternatively, the DCD can poll the endpoint complete register to determine when the dTD was executed. After a dTD is executed, the DCD can check the status bits to determine success or failure.

## CAUTION

Multiple dTDs can be completed in a single endpoint complete notification. After clearing the notification, the DCD must search the dTD linked list and retire all finished (active bit cleared) dTDs.

By reading the status fields of the completed dTDs, the DCD can determine if the transfers completed successfully. Success is determined with the following combination of status bits:

- Active = 0
- Halted = 0
- Transaction error = 0
- Data buffer error = 0

Should any combination other than the one shown above exist, the DCD must take proper action. Transfer failure mechanisms are indicated in Device error matrix.

Universal Serial Bus On-The-Go Controller (USBOTG)

In addition to checking the status bit, the DCD must read the transfer bytes field to determine the actual bytes transferred. When a transfer is complete, the total bytes transferred decrements by the actual bytes transferred. For transmit packets, a packet is only complete after the actual bytes reaches zero. However, for receive packets, the host may send fewer bytes in the transfer according to the USB variable length packet protocol.

## 55.9.9.5 Flushing/de-priming an endpoint

It is necessary for the DCD to flush or de-prime endpoints during a USB device reset or during a broken control transfer. There may also be application-specific requirements to stop transfers in progress. The DCD can use this procedure to stop a transfer in progress:

1. Set the corresponding bit(s) in Endpoint De-Initialize (ENDPTFLUSH).
2. Wait until all bits in Endpoint De-Initialize (ENDPTFLUSH) are cleared to 0.

## NOTE

This operation may take a large amount of time depending on the USB bus activity. It is not desirable to have this wait loop within an interrupt service routine.

3. Read Endpoint Status (ENDPTSTAT) to ensure that, for all endpoints commanded to be flushed, the corresponding bits

are now cleared. If the corresponding bits are set after step #2 has finished, the flush failed as described below: In very rare cases, a packet is in progress to the particular endpoint when commanded to flush using Endpoint De-Initialize (ENDPTFLUSH). A safeguard is in place to refuse the flush to ensure that the packet in progress completes successfully. The DCD may need to repeatedly flush any endpoints that fail to flush by repeating steps 1-3 until each endpoint successfully flushes.

## 55.9.9.6 Device error matrix

The following table summarizes packet errors not automatically managed by the USB OTG module.

## Table 475. Device error matrix

| Error                 | Direction   | Packet type   |   Data buffer error bit |   Transaction error bit |
|-----------------------|-------------|---------------|-------------------------|-------------------------|
| Data buffer overflow  | RX          | Any           |                       1 |                       0 |
| ISO packet error      | RX          | ISO           |                       0 |                       1 |
| ISO fulfillment error | Both        | ISO           |                       0 |                       1 |

The device controller manages all errors on bulk/control/interrupt endpoints except for a data buffer overflow. However, for ISO endpoints, errors packets are not retried and errors are tagged as indicated.

## Table 476. Error descriptions

| Overflow         | Number of bytes received exceeded the maximum packet size or total buffer length. This error also sets the halt bit in the dQH, and if there are dTDs remaining in the NOTE   |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ISO packet error | CRC error on received ISO packet. Contents are not guaranteed to be correct.                                                                                                  |

Table continues on the next page...

## Table 476. Error descriptions (continued)

| ISO fulfillment error   | Host failed to complete the number of packets defined in the dQH Mult field within the given (micro)frame. For scheduled data delivery, the DCD may need to readjust the data queue because a fulfillment error causes the device controller to cease data transfers on the pipe for one (micro)frame. During the dead (micro)frame, the device controller reports an error on the pipe and primes for the following frame.   |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

## 55.9.10 Servicing interrupts

The interrupt service routine programmer must understand that there are high-frequency, low-frequency, and error operations to order accordingly.

## 55.9.10.1 High frequency interrupts

In particular, high frequency interrupts must be managed in the following order. The most important of these is listed first because the DCD must acknowledge a setup buffer in the timeliest manner possible.

Table 477. Interrupt managing order

| Execution order   | Interrupt                      | Action                                                                                                                                                                                                     |
|-------------------|--------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1a                | USB interrupt 1 ENDPTSETUPSTAT | Copy the contents of the setup buffer and acknowledge the setup packet (as indicated in Managing QHs). Process the setup packet according to USB specification chapter 9 or application-specific protocol. |
| 1b                | USB interrupt ENDPTCOMPLETE    | Manage completion of the dTD as indicated in Managing QHs.                                                                                                                                                 |
| 2                 | SOF interrupt                  | Action as deemed necessary by application. This interrupt may not have a use in all applications.                                                                                                          |

## 55.9.10.2 Error interrupts

Error interrupts are the least frequent and should be placed last in the interrupt service routine.

Table 478. Error interrupt events

| Interrupt           | Action                                                                                                                                                                                                                                          |
|---------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| USB error interrupt | This error is redundant because it combines USB interrupt and an error status in the dTD. The DCD more aptly manages packet-level errors by checking the dTDstatus field upon receipt of USBinterrupt (with Endpoint Complete (ENDPTCOMPLETE)). |
| System error        | Unrecoverable error. Immediate reset of module; free transfer buffers in progress and restart theDCD.                                                                                                                                           |

## 55.10 Host mode operation

The EHCI specification defines the general operational model for a USB module in Host mode. The EHCI specification describes the register-level interface for a host controller for USB Revision 2.0. It includes a description of the hardware/software interface between system software and host controller hardware. The next section has information about the initialization of the USB modules; however, full details of the EHCI specification are beyond the scope of this document.

## 55.10.1 Servicing interrupts

The interrupt service routine programmer must understand that there are high-frequency, low-frequency, and error operations to order accordingly.

## 55.10.1.1 High frequency interrupts

In particular, high frequency interrupts must be managed in the following order. The most important of these is listed first because the DCD must acknowledge a setup buffer in the timeliest manner possible.

Table 479. Interrupt managing order

| Execution order   | Interrupt                      | Action                                                                                                                                                                                                     |
|-------------------|--------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1a                | USB interrupt 1 ENDPTSETUPSTAT | Copy the contents of the setup buffer and acknowledge the setup packet (as indicated in Managing QHs). Process the setup packet according to USB specification chapter 9 or application-specific protocol. |
| 1b                | USB interrupt ENDPTCOMPLETE    | Manage completion of the dTD as indicated in Managing QHs.                                                                                                                                                 |
| 2                 | SOF interrupt                  | Action as deemed necessary by application. This interrupt may not have a use in all applications.                                                                                                          |

## 55.10.1.2 Low frequency interrupts

The low frequency events include the following interrupts. These interrupts can be managed in any order because they do not occur often in comparison to the high-frequency interrupts.

Table 480. Low frequency interrupt events

| Interrupt              | Action                                                              |
|------------------------|---------------------------------------------------------------------|
| Port change            | Change software state information.                                  |
| Sleep enable (Suspend) | Change software state information. Low-power managing as necessary. |
| Reset received         | Change software state information. Abort pending transfers.         |

## 55.10.1.3 Error interrupts

Error interrupts are the least frequent and should be placed last in the interrupt service routine.

Table 481. Error interrupt events

| Interrupt           | Action                                                                                                                                                                                                                                          |
|---------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| USB error interrupt | This error is redundant because it combines USB interrupt and an error status in the dTD. The DCD more aptly manages packet-level errors by checking the dTDstatus field upon receipt of USBinterrupt (with Endpoint Complete (ENDPTCOMPLETE)). |
| System error        | Unrecoverable error. Immediate reset of module; free transfer buffers in progress and restart theDCD.                                                                                                                                           |

## 55.10.2 Managing isochronous transfers using iTDs

The structure of an iTD is presented in iTD. The four distinct sections to an iTD are:

- Next link pointer - This first field is for schedule linkage purposes only.
- Transaction description array - This area is an eight-element array. Each element represents control and status information for one microframe's worth of transactions for a single HS isochronous endpoint.
- The buffer page pointer array - This is a 7-element array of physical memory pointers to data buffers. These are 4 KB aligned pointers to physical memory.
- Endpoint capabilities - This area utilizes the unused low-order 12 bits of the buffer page pointer array. The fields in this area are used across all transactions executed for this iTD, including endpoint addressing, transfer direction, maximum packet size, and high-bandwidth multiplier.

## 55.10.2.1 Host controller operational model for iTDs

The host controller uses USB Frame Index (FRINDEX) register bits [12:3] to index into the periodic frame list. This means that the host controller visits each frame list element eight consecutive times before incrementing to the next periodic frame list element. Each iTD contains eight transaction descriptions, which map directly to USB Frame Index (FRINDEX) register bits [2:0]. Therefore, each transaction descriptor corresponds to one microframe. Each iTD can span eight microframes worth of transactions.

When the host controller fetches an iTD, it uses USB Frame Index (FRINDEX) register bits [2:0] to index into the transaction description array.

If the value of the Active field in the Status field of the indexed transaction description is set to 0, the host controller ignores the iTD and follows the next pointer to the next schedule data structure.

When the value of the indexed Active field is 1, the host controller continues to parse the iTD. It stores the indexed transaction description and the general endpoint information (device address, endpoint number, maximum packet size, and so on). It also uses the Page Select (PG) field to index the buffer pointer array, storing the selected buffer pointer and the next sequential buffer pointer. For example, if the PG field is 0, then the host controller stores Page 0 and Page 1.

The host controller constructs a physical data buffer address by concatenating the current buffer pointer (as selected using the current transaction description's PG field) and the transaction description's Transaction Offset field. The host controller uses the endpoint addressing information and I/O-bit to execute a transaction to the appropriate endpoint. When the transaction is complete, the host controller clears the Active field to 0 and writes back any additional status information to the Status field in the currently selected transaction description.

The data buffer associated with the iTD must be virtually contiguous memory. Seven page pointers are provided to support eight high-bandwidth transactions regardless of the starting packet's offset alignment into the first page. A starting buffer pointer (physical memory address) is constructed by concatenating the page pointer (for example, page 0 pointer) selected by the active transaction description's PG (for example, value: 00B) field with the transaction offset field. As the transaction moves data, the host controller must detect when an increment of the current buffer pointer crosses a page boundary. When this occurs, the host controller simply replaces the current buffer pointer's page portion with the next page pointer (for example, page 1 pointer) and continues to move data. The size of each bus transaction is determined by the value in the Maximum Packet Size field. An iTD supports high-bandwidth pipes through the Mult (multiplier) field. When the Mult field is 1, 2, or 3, the host controller executes the specified number of bus transactions of maximum packet size for the endpoint in the current microframe. In other words, the Mult field represents a T-Count for the endpoint in the current microframe. If the Mult field is 0, the operation of the host controller is undefined. The transfer description is used to service all transactions indicated by the Mult field.

For OUT transfers:

- The value of the Transaction X Length field represents the total bytes to be sent during the microframe.
- You must set the Mult field to be consistent with Transaction X Length and Maximum Packet Size.
- The host controller:
- Sends the bytes in portions that are of Maximum Packet Size
- Decrements its local copy of Transaction X Length by Maximum Packet Size after each transaction
- Always sends a number of bytes that are of Maximum Packet Size or Transaction X Length, whichever is less

- Advances the transfer state in the transfer description
- Updates the appropriate record in the iTD
- Moves to the next schedule data structure
- The maximum sized transaction supported is 3 x 1024 bytes.

## For IN transfers:

- The host controller issues Mult transactions.
- It is assumed that you have properly initialized the iTD to accommodate all of the possible data.
- During each IN transaction, the host controller:
- Must use the maximum packet size during each IN transaction to detect packet babble errors
- Keeps the sum of bytes received in the Transaction X Length field
- After all transactions for the endpoint have completed for the microframe, Transaction X Length contains the total number of bytes received. If the final value of Transaction X Length is less than the value of Maximum Packet Size:
- Less data than was allowed for was received from the associated endpoint.
- This short packet condition does not write 1 to USBSTS[UI].
- The host controller will not detect this condition.
- If the device sends more than Transaction X Length or Maximum Packet Size bytes (whichever is less):
- The host controller sets the Babble Detected field to 1 and sets the Active field to 0.
- Note that the host controller is not required to update the iTD Transaction X Length field in this error scenario.
- If the value of the Mult field is greater than 1, then the host controller automatically executes the value of Mult transactions. The host controller does not execute all Mult transactions if:
- The endpoint is an OUT and Transaction X Length goes to zero before all the Mult transactions have executed (run out of data), or
- The endpoint is an IN and the endpoint delivers a short packet, or an error occurs on a transaction before Mult transactions have been executed. The end of microframe may occur before all of the transaction opportunities have been executed. When this happens, the transfer state of the transfer description is advanced to reflect the progress that was made, the result written back to the iTD and the host controller proceeds to processing the next microframe. See Appendix D for a table summary of the host controller required behavior for all the high-bandwidth transaction cases.

## 55.10.2.2 Software operational model for iTDs

A client buffer request to an isochronous endpoint may span 1 to N microframes. When N is larger than one, system software may have to use multiple iTDs to read or write data with the buffer (if N is larger than eight, it must use more than one iTD).

The following figure illustrates how a client buffer is mapped by system software to the periodic schedule (that is, the periodic frame list and a set of iTDs).

- On the right side of this figure is the client description of its request. The description includes a buffer base address plus additional annotations to identify which portions of the buffer must be used with each bus transaction.
- In the middle are the iTD data structures used by the system software to service the client request. Each iTD can be initialized to service up to 24 transactions, organized into eight groups of up to three transactions each. Each group maps to one microframe's worth of transactions. The EHCI controller does not provide per-transaction results within a microframe. It treats the per-microframe transactions as a single logical transfer.
- On the left is the host controller's Frame List. System software establishes references from the appropriate locations in the Frame List to each of the appropriate iTDs. If the buffer is large, then system software can use a small set of iTDs to service the entire buffer.

Universal Serial Bus On-The-Go Controller (USBOTG)

System software can activate the transaction description records (contained in each iTD) in any pattern required for the particular data stream.

<!-- image -->

As noted above, the client request includes a pointer to the base of the buffer and offsets into the buffer to annotate which buffer sections are to be used on each bus transaction that occurs on this endpoint. System software must initialize each transaction description in an iTD to ensure it uses the correct portion of the client buffer. For example, for each transaction description, the PG field is set to index the correct physical buffer page pointer and the Transaction Offset field is set relative to the correct buffer pointer page (for example, the same one referenced by the PG field). When the host controller executes a transaction it selects a transaction description record based on FRINDEX[2:0]. It then uses the current Page Buffer Pointer (as selected by the PG field) and concatenates to the Transaction Offset field. The result is a starting buffer address for the transaction. As the host controller moves data for the transaction, it must watch for a page wrap condition and properly advance to the next available Page Buffer Pointer. System software must not use the Page 6 buffer pointer in a transaction description where the length of the transfer wraps a page boundary. Doing so yields undefined behavior. The host controller hardware is not required to 'alias' the page selector to Page 0. USB 2.0 isochronous endpoints can specify a period greater than one. You can achieve the appropriate scheduling by linking iTDs into the appropriate frames (relative to the Frame List) and by setting appropriate transaction description elements active bits to 1.

## 55.10.2.2.1 Periodic scheduling threshold

HCCPARAMS[IST] is an indicator to system software as to how the host controller pre-fetches and effectively caches schedule data structures.

It is used by system software when adding isochronous work items to the periodic schedule. The value of this field indicates to system software the minimum distance it can update isochronous data (relative to the current location of the host controller execution in the periodic list) and still have the host controller process them.

Each of the iTD and siTD data structures describe 8 microframes of transactions. The host controller is allowed to cache one (or more) of these data structures to reduce memory traffic. Three basic caching models account for the fact that the isochronous data structures span eight microframes. Those are:

- No caching

- Microframe caching
- Frame caching

When you add new isochronous transactions to the schedule, it always performs a read of USB Frame Index (FRINDEX) to determine the frame and microframe the host controller is currently executing. Of course, there is no information about where in the microframe the host controller is, so a constant uncertainty-factor of one microframe must be assumed. Combining the knowledge of where the host controller is executing with the knowledge of the caching model allows the definition of simple algorithms for how closely software can reliably work to the executing host controller.

No caching is indicated with a value of zero in the Isochronous Scheduling Threshold field. The host controller may pre-fetch data structures during a periodic schedule traversal (per microframe) but always dumps any accumulated schedule state at the end of the microframe. At the appropriate time relative to the beginning of every microframe, the host controller always begins schedule traversal from the frame list. You can use the value of USB Frame Index (FRINDEX) (plus the constant uncertainty-factor of one microframe) to determine the approximate position of the executing host controller. When no caching is selected, you can add an isochronous transaction as near as two microframes in front of the current executing position of the host controller.

Frame caching is indicated with a non-zero value in bit [7] of the Isochronous Scheduling Threshold field. In the frame-caching model, system software assumes that the host controller caches one (or more) isochronous data structures for an entire frame (eight microframes). You use the value of USB Frame Index (FRINDEX) (plus the constant uncertainty-factor of one microframe) to determine the current microframe/frame (assume modulo 8 arithmetic in adding the constant 1 to the microframe number). For any current frame N, if the current microframe is 0 to 6, then you can safely add isochronous transactions to frame N + 1. If the current microframe is 7, then you can add isochronous transactions to frame N + 2.

Microframe caching is indicated with a non-zero value in the least-significant 3 bits of the Isochronous Scheduling Threshold field. System software assumes the host controller caches one or more periodic data structures for the number of microframes indicated in the Isochronous Scheduling Threshold field. For example, if the count value were 2, then the host controller keeps a window of two microframes worth of state (the current microframe, plus the next frame) on-chip. On each microframe boundary, the host controller releases the current microframe state and begins accumulating the next microframe state.

## 55.10.3 Managing control/bulk/interrupt transfers through QHs

This section presents an overview of how the host controller interacts with queuing data structures.

QHs use the qTD structure. One QH is used to manage the data stream for one endpoint. The QH structure contains static endpoint characteristics and capabilities. It also contains a working area from where individual bus transactions for an endpoint are executed (see the Overlay area, defined in QH). Each qTD represents one or more bus transactions, which is defined in the context of this specification as a transfer.

The general processing model for the host controller's use of a QH is this:

1. Read a QH
2. Execute a transaction from the overlay area
3. Write back the results of the transaction to the overlay area
4. Move to the next QH

If the host controller encounters errors during a transaction, the host controller sets one (or more) of the error reporting bits in the QH's Status field. The Status field accumulates all errors encountered during the execution of a qTD (for example, the error bits in the QH Status field are "sticky" until the transfer (qTD) has completed). This state is always written back to the source qTD when the transfer is complete. On transfer (for example, buffer or halt conditions) boundaries, the host controller must auto-advance (without software intervention) to the next qTD. Additionally, the hardware must be able to halt the queue so that no additional bus transactions occur for the endpoint and the host controller does not advance the queue.

An example host controller operational state machine of a QH traversal is illustrated in the following figure. This state machine is a model for how a host controller should traverse a QH. The host controller must be able to advance the queue from the Fetch QH state in order to avoid all hardware/software race conditions. This simple mechanism allows you to simply link qTDs to the QH and activate them, then the host controller can always find them if/when they are reachable. The figure below illustrates the host controller QH traversal state machine.

Universal Serial Bus On-The-Go Controller (USBOTG)

Universal Serial Bus On-The-Go Controller (USBOTG)

<!-- image -->

This traversal state machine applies to all QHs, regardless of transfer type or whether split transactions are required. The following sections describe each state, and each state description describes the entry criteria. The Execute Transaction state (see Execute transaction) describes the basic requirements for all endpoints. Split transactions for asynchronous transfers and Split transaction interrupt describe details of the required extensions to the Execute Transaction state for endpoints requiring split transactions.

## NOTE

Prior to placing a QH into either the periodic or asynchronous list, you must ensure the QH is properly initialized. At a minimum, the QH must be initialized to the following (see section QH for layout of a QH):

Valid static endpoint state:

- For the very first use of a QH, you may zero-out the QH transfer overlay, then set the next qTD pointer field value to reference a valid qTD.

## 55.10.3.1 Fetch QH

A QH can be referenced from the physical address stored in ASYNCLISTADDR. Additionally, it may be referenced from the Next LinkPointer field of an iTD, siTD, FSTN, or another QH. If the referencing link pointer has the Typ field set to indicate a QH, it is assumed to reference a QH structure as defined in Table 458.

When in this state, the host controller performs operations to implement empty schedule detection and Nak Counter reloads. After the QH has been fetched, the host controller checks the following conditions for empty schedule detection:

- The QH is not an interrupt QH (that is, S-mask is 0).
- The H-bit is 1.

## · USBSTS[RCL] is 0.

When the above criteria are met, the host controller stops traversing the asynchronous list. When the criteria are not met, the host controller continues schedule traversal. If the QH is not an interrupt and the H-bit is one and USBSTS[RCL] is 1, then the host controller writes USBSTS[RCL] to 0 before completing this state. The operations for reloading of the Nak Counter are described in detail in the Operational Model for Nak Counter. For details, see the standard documentation of Enhanced Host Controller Interface Specification for Universal Serial Bus (EHCI) available at intel.in.

This state is complete when the QH has been read on-chip.

## 55.10.3.2 Advance queue

To advance the queue, the host controller must find the next qTD, adjust the pointers, perform the overlay, and write the results back to the QH.

This state is entered from the FetchQHD state if the overlay Active and Halt bits are set to 0. Upon entry into this state, the host controller determines which next pointer to use to fetch a qTD, fetches a qTD, and then determines whether or not to perform an overlay.

## NOTE

If the I-bit is 1 and the Active field is 1, the host controller immediately skips processing of this QH, exits this state, and uses the horizontal pointer to the next schedule data structure. If the Bytes to Transfer field is not 0 and the T-bit in the Alternate Next qTD Pointer is set to 0, then the host controller uses the Alternate Next qTD Pointer. Otherwise, the host controller uses the NextqTD Pointer. If NextqTD Pointer's T-bit is set to 1, then the host controller exits this state and uses the horizontal pointer to the next schedule data structure.

Using the selected pointer, the host controller fetches the referenced qTD. If the fetched qTD has its Active field set to 1, the host controller moves the pointer value used to reach the qTD (next or alternate next) to the Current qTD Pointer field, then performs the overlay. If the fetched qTD has its Active field set to 0, the host controller aborts the queue advance and follows the QH's horizontal pointer to the next schedule data structure.

The host controller performs the overlay based on the following rules:

- The value of the Data Toggle (DT) field in the overlay area depends on the value of the Data Toggle Control (DTC) field (see Table 460).
- If the EPS field indicates the endpoint is a HS endpoint, the Ping state field is preserved by the host controller. The value of this field is not changed as a result of the overlay.
- C-prog-mask field is set to 0 (field from incoming qTD is ignored, as is the current contents of the overlay area).
- Frame Tag field is set to 0 (field from incoming qTD is ignored, as is the current contents of the overlay area).
- NakCnt field in the overlay area is loaded from the RL field in the QH's Static Endpoint State.
- All other areas of the overlay are set by the incoming qTD.

The host controller exits this state when it has committed the write to the QH.

## 55.10.3.3 Execute transaction

The host controller enters this state from the Fetch QH Head state only if the Active field in Status field of the QH is set to 1.

Upon entry to this state, the host controller executes a few pre-operations, then checks pre-condition criteria before committing to executing a transaction for the QH.

The pre-operations performed and the pre-condition criteria depend on whether the QH is an interrupt endpoint. The host controller can determine that a QH is an interrupt QH when the QH's S-mask field contains a non-zero value. It is your responsibility to ensure the S-mask field is appropriately initialized based on the transfer type. There are other criteria that must be met if the EPS field indicates that the endpoint is a LS or FS endpoint; see Split transactions for asynchronous transfers and Split transaction interrupt.

Universal Serial Bus On-The-Go Controller (USBOTG)

## 55.10.3.3.1 Interrupt transfer pre-condition criteria

If the QH is for an interrupt endpoint (for example, non-zero S-mask field), then the FRINDEX[2:0] field must identify a bit in the S-mask field that has 1 in it.

For example, an S-mask value of 00100000b would evaluate to true only when FRINDEX[2:0] is equal to 101b. If this condition is met, then the host controller considers this QH for a transaction.

## 55.10.3.3.2 Asynchronous transfer pre-operations and pre-condition criteria

If the QH is not for an interrupt endpoint (for example, 0 in the S-mask field), then the host controller performs one pre-operation and then evaluates one pre-condition criteria.

The pre-operation is:

- Check the Nak Counter reload state. It may be necessary for the host controller to reload the Nak Counter field. The reload is performed at this time.

The pre-condition evaluated is:

- Regardless of whether or not the NakCnt field has been reloaded, the host controller checks the value of the NakCnt field in the QH. If NakCnt is non-zero, or if the Reload Nak Counter field is 0, then the host controller considers this QH for a transaction.

## 55.10.3.3.3 Transfer type independent pre-operations

Regardless of the transfer type, the host controller always performs at least one pre-operation and evaluates one pre-condition. The pre-operation is:

- A host controller internal transaction (down) counter qHTransactionCounter is loaded from the QH's Mult field. A host controller implementation is allowed to ignore this for QHs on the asynchronous list. It is mandatory for interrupt QHs. You must ensure that the Mult field is set appropriately for the transfer type.

The pre-conditions evaluated are:

- The host controller determines whether there is enough time in the microframe to complete this transaction. If there is not enough time to complete the transaction, the host controller exits this state.
- If the value of qHTransactionCounter for an interrupt endpoint is 0, then the host controller exits this state.

When the pre-operations are complete and pre-conditions are met, the host controller sets USBSTS[RCL] to 1 and then begins executing one or more transactions using the endpoint information in the QH. The host controller iterates qHTransactionCounter times in this state executing transactions. After each transaction is executed, qHTransactionCounter is decremented by 1. The host controller exits this state when one of the following events occurs:

- The qHTransactionCounter decrements to 0.
- The endpoint responds to the transaction with any handshake other than an ACK, 4 .
- The transaction experiences a transaction error.
- The Active field in the QH goes to 0.
- There is not enough time remaining in the microframe to execute the next transaction.

## NOTE

For a high-bandwidth interrupt OUT endpoint, the host controller may optionally retry the transaction immediately if it fails.

The results of each transaction are recorded in the on-chip overlay area. If data was successfully moved during the transaction, the transfer state in the overlay area is advanced. To advance the QH's transfer state, the Total Bytes to Transfer field is decremented by the number of bytes moved in the transaction, the Data Toggle field (DT) is toggled, the current page offset is advanced to the next appropriate value (for example, advanced by the number of bytes successfully moved), and the C\_Page field is updated to the appropriate value (if necessary). See Buffer pointer list use for data streaming with qTDs.

Universal Serial Bus On-The-Go Controller (USBOTG)

## NOTE

The Total Bytes to Transfer field may be 0 when all the other criteria for executing a transaction are met. When this occurs, the host controller executes a zero-length transaction to the endpoint. If the PID\_Code field indicates an IN transaction and the device delivers data, the host controller detects a packet babble condition, sets the babble and halted fields in the Status field, sets the Active field to 0, writes the results back to the source qTD, and then exits this state.

In the event an IN token receives a data PID mismatch response, the host controller must ignore the received data (for example, not advance the transfer state for the bytes received). Additionally, if the endpoint is an interrupt IN, then the host controller must record that the transaction occurred (for example, decrement qHTransactionCounter). It is recommended (but not required) that the host controller continue executing transactions for this endpoint if the resultant value of qHTransactionCounter is greater than 1.

If the response to the IN bus transaction is a Nak (or Nyet) and RL is non-zero, NakCnt is decremented by 1. If RL is 0, then no write-back by the host controller is required (for a transaction receiving a Nak or Nyet response and the value of CErr did not change). You must set the RL field to 0 if the QH is an interrupt endpoint. Host controller hardware is not required to enforce this rule or operation.

After the transaction has finished and the host controller has completed the post processing of the results (advancing the transfer state and possibly NakCnt), the host controller writes back the results of the transaction to the QH's overlay area in main memory.

The number of bytes moved during an IN transaction depends on how much data the device endpoint delivers. The maximum number of bytes a device can send is MaximumPacket Size. The number of bytes moved during an OUT transaction is either Maximum Packet Length bytes or Total Bytes to Transfer, whichever is less.

If there was a transaction error during the transaction, the transfer state (as defined above) is not advanced by the host controller. The CErr field is decremented by 1 and the status field is updated to reflect the type of error observed.

The following events will cause the host controller to clear the Active field to 0 in the QH's overlay status field. When the Active field transitions from 1 to 0, the transfer in the overlay is considered complete. The reason for the transfer completion (clearing the Active field to 0) determines the next state.

- The CErr field decrements to 0. When this occurs, the Halted field is set to 1 and Active is set to 0. This results in the hardware not advancing the queue and the pipe halts. You must intercede to recover.
- The device responds to the transaction with a STALL PID. When this occurs, the Halted field is set to 1 and the Active field is set to 0. This results in the hardware not advancing the queue and the pipe halts. You must intercede to recover.
- The Total Bytes to Transfer field is 0 after the transaction completes.
- For a zero length transaction, it was 0 before the transaction was started. When this condition occurs, the Active field is set to 0.
- The PID code is an IN, and the number of bytes moved during the transaction is less than the Maximum Packet Length. When this occurs, the Active field is set to 0 and a short-packet condition exists. The short-packet condition is detected during the Advance Queue state. See Split transactions for additional rules for managing LS and FS transactions.

With the exception of a NAK response (when the value of the RL field is 0), the host controller always writes the results of the transaction back to the overlay area in main memory. This includes when the transfer completes. For a HS endpoint, the QH information written back includes the following fields at a minimum: The PID Code field indicates an IN and the device sends more than the expected number of bytes (for example Maximum Packet Length or Total Bytes to Transfer bytes, whichever is less) (for example, a packet babble). This results in the host controller setting the Halted field to 1.

- NakCnt, DT, Total Bytes to Transfer, C\_Page, Status, CERR, and Current Offset

For a LS or FS device, the QH information written back also includes these fields:

- C-prog-mask, FrameTag and S-bytes

The duration of this state depends on the time it takes to complete the transaction(s) and the status write to the overlay is committed.

Universal Serial Bus On-The-Go Controller (USBOTG)

## 55.10.3.3.4 Halting a QH

A halted endpoint is defined only for the transfer types that are managed through QHs (control, bulk and interrupt). The following events indicate that the endpoint has reached a condition where no more activity can occur without intervention from the driver:

- An endpoint may return a STALL handshake during a transaction,
- A transaction had three consecutive error conditions, or
- A Packet Babble error occurs on the endpoint.

When any of these events occur (for a QH), the host controller halts the QH and sets the USBSTS[UEI] status field to 1. To halt the QH, the Active field is set to 0 and the Halted field is set to 1. There may be other error status fields that are set when a queue is halted. The host controller always writes back the overlay area to the source qTD when the transfer is complete, regardless of the reason (normal completion, short packet or halt). The host controller does not advance the transfer state on a transaction that results in a Halt condition (for example, no updates necessary for Total Bytes to Transfer, C\_Page, Current Offset, and DT). The host controller must update CErr as appropriate. When a QH is halted, USBSTS[UEI] is set to 1. If the USBINTR[UEE] is set to 1, a hardware interrupt is generated at the next interrupt threshold.

## 55.10.3.3.5 Asynchronous Schedule Park mode

Asynchronous Schedule Park mode is a special execution mode that can be enabled by system software, where the host controller is permitted to execute more than one bus transaction from a HS QH in the Asynchronous schedule before continuing horizontal traversal of the Asynchronous schedule.

This feature has no effect on QHs or other data structures in the Periodic schedule. This feature is similar in intent to the Mult feature that is used in the Periodic schedule. Where the Mult feature is a characteristic that is tunable for each endpoint, park-mode is a policy that is applied to all HS QHs in the Asynchronous schedule. It is essentially the specification of an iterator for consecutive bus transactions to the same endpoint. All of the rules for managing bus transactions and the results of those as defined in Execute transaction apply. This feature merely specifies how many consecutive times the host controller is permitted to execute from the same QH before moving to the next QH in the Asynchronous List. This feature allows the host controller to attain better bus usage for those devices that are capable of moving data at maximum rate, and at the same time provide a fair service to all endpoints.

A host controller exports its capability to support this feature to system software by setting the Asynchronous Schedule Park Capability field in the USB\_n\_HCCPARAMs register to 1. This information keys system software that the Asynchronous Schedule Park Mode Enable and Asynchronous Schedule Park Mode Count fields in the USB\_n\_USBCMD register are modifiable. System software enables the feature by writing a 1 to the Asynchronous Schedule Park Mode Enable field.

When park-mode is not enabled (for example, when the Asynchronous Schedule Park Mode Enable field in the USB\_n\_USBCMD register is 0), the host controller must not execute more than one bus transaction per HS QH, per traversal of the asynchronous schedule. When park-mode is enabled, the host controller must not apply the feature to a QH whose EPS field indicates an LS or FS device (for example, only one bus transaction is allowed from each LS or FS QH per traversal of the asynchronous schedule). Park-mode may only be applied to QHs in the asynchronous schedule whose EPS field indicates that it is an HS device.

The host controller must apply park mode to QHs whose EPS field indicates a HS endpoint. The maximum number of consecutive bus transactions a host controller may execute on a HS QH is determined by the value in the Asynchronous Schedule Park Mode Count field in the USB\_n\_USBCMD register. You must not set the Asynchronous Schedule Park Mode Enable field to 1 and also set the Asynchronous Schedule Park Mode Count field to 0; the resulting behavior is not defined. A behavioral example describes the operational requirements for the host controller implementing park-mode. How the host controller manages the bus transaction as defined in Execute transaction is not affected by this feature. It only affects how many consecutive bus transactions for the current QH can be executed. All boundary conditions, error detection, and reporting apply as usual. This feature is similar in concept to the use of the Mult field for high-bandwidth interrupts for QHs in the periodic schedule.

The host controller effectively loads an internal down-counter PM-Count from Asynchronous Schedule Park Mode Count when the Asynchronous Schedule Park Mode Enable field is 1, and a HS QH is first fetched and meets all the criteria for executing a bus transaction. After the bus transaction, PM-Count is decremented. The host controller may continue to execute bus transactions from the current QH until PM-Count goes to 0, an error is detected, the buffer for the current transfer is exhausted, or the endpoint responds with a flow-control or STALL handshake.

Universal Serial Bus On-The-Go Controller (USBOTG)

Universal Serial Bus On-The-Go Controller (USBOTG)

The following table summarizes the responses that affect whether the host controller continues with another bus transaction for the current QH.

Table 482. Actions for park mode, based on endpoint response and residual transfer state

| PID   | Endpoint response                         | Transfer state after transaction   | Transfer state after transaction   | Action                                         |
|-------|-------------------------------------------|------------------------------------|------------------------------------|------------------------------------------------|
| PID   | Endpoint response                         | PM-Count                           | Bytes to transfer                  | Action                                         |
| IN    | DATA[0,1] with maximum packet- sized data | Not zero                           | Not zero                           | Allowed to perform another bus transaction 1,2 |
| IN    | DATA[0,1] with maximum packet- sized data | Not zero                           | Zero                               | Retire qTD and move to next QH                 |
| IN    | DATA[0,1] with maximum packet- sized data | Zero                               | Don't care                         | Move to next QH                                |
| IN    | DATA[0,1] with short packet               | Don't care                         | Don't care                         | Retire qTD and move to next QH                 |
| IN    | NAK                                       | Don't care                         | Don't care                         | Move to next QH                                |
| IN    | STALL, XactErr                            | Don't care                         | Don't care                         | Move to next QH                                |
| OUT   | ACK                                       | Not zero                           | Not zero                           | Allowed to perform another bus transaction 2   |
| OUT   | ACK                                       | Not zero                           | Zero                               | Retire qTD and move to next QH                 |
| OUT   | ACK                                       | Zero                               | Don't care                         | Move to next QH                                |
| OUT   | NYET, NAK                                 | Don't care                         | Don't care                         | Move to next QH                                |
| OUT   | STALL, XactErr                            | Don't care                         | Don't care                         | Move to next QH                                |
| PING  | ACK                                       | Not zero                           | Not zero                           | Allowed to perform another bus transaction 2   |
| PING  | NAK                                       | Don't care                         | Don't care                         | Move to next QH                                |
| PING  | STALL, XactErr                            | Don't care                         | Don't care                         | Move to next QH                                |

2. This specification does not require that the host controller execute another bus transaction when PM-Count is non-zero. Implementations are encouraged to make appropriate complexity and performance trade-offs.

## 55.10.3.4 Write back qTD

This state is entered from the Execute Transaction state when the Active bit is set to 0.

The source data for the write-back is the transfer results area of the QH overlay area (see Table 482).

The host controller uses the Current qTD Pointer field as the target address for the qTD.

The QH transfer result area is written back to the transfer result area of the target qTD. This state is also referred to as "qTD Retirement". The fields that must be written back to the source qTD include Total Bytes to Transfer, Cerr, and Status.

The duration of this state depends on when the qTD write-back is committed.

## 55.10.3.5 Follow QH horizontal pointer

The host controller must use the horizontal pointer in the QH to the next schedule data structure when any of the following conditions exist:

- If the Active bit is 1 on exit from the Execute Transaction state
- When the host controller exits the Write Back qTD state
- If the Advance Queue state fails to advance the queue because the target qTD is not active
- If the Halted bit is 1 on exit from the fetch QH state

There is no functional requirement for the host controller to wait until the current transaction is complete before using the horizontal pointer to read the next linked data structure. However, it must wait until the current transaction is complete before executing the next data structure.

## 55.10.3.6 Buffer pointer list use for data streaming with qTDs

A qTD has an array of buffer pointers, which is used to reference the data buffer for a transfer. This specification requires that the buffer associated with the transfer be virtually contiguous. This means that, if it spans more than one physical page, the buffer must obey the following rules (the figure below illustrates an example):

- The first portion of the buffer must begin at some offset in a page and extend through the end of the page.
- The remaining buffer cannot be allocated in small chunks scattered around memory. For each 4 KB chunk beyond the first page, each buffer portion matches to a full 4 KB page. The final portion, which may only be large enough to occupy a portion of a page, must start at the top of the page and be contiguous within that page.

The buffer pointer list in the qTD is long enough to support a maximum transfer size of 20 KB. This case occurs when all five buffer pointers are used and the first offset is zero. A qTD manages a 16 KB buffer with any starting buffer alignment.

The host controller uses the C\_Page field as an index value to determine which buffer pointer in the list must be used to start the current transaction. The host controller uses a different buffer pointer for each physical page of the buffer. This is always true, even if the buffer is physically contiguous.

The host controller must detect when the current transaction spans a page boundary and automatically move to the next available buffer pointer in the page pointer list. The next available pointer is reached by incrementing C\_Page and pulling the next page pointer from the list. You must ensure there are sufficient buffer pointers to move the amount of data specified in the Bytes to Transfer field.

The following figure illustrates a nominal example of how system software would initialize the buffer pointers list and the C\_Page field for a transfer size of 16383 bytes. C\_Page is set to 0. The upper 20 bits of page 0 references the start of the physical page. Current Offset (the lower 12 bits of QH Dword 7) holds the offset in the page; for example, 2049 (that is, 4096-2047). The remaining page pointers are set to reference the beginning of each subsequent 4 KB page.

Universal Serial Bus On-The-Go Controller (USBOTG)

Universal Serial Bus On-The-Go Controller (USBOTG)

<!-- image -->

For the first transaction on the qTD (assuming a 512-byte transaction), the host controller uses the first buffer pointer (page 0 because C\_Page is set to 0) and concatenates the Current Offset field. The 512 bytes are moved during the transaction, and current offset and total bytes to transfer are adjusted by 512 and written back to the QH working area.

During the 4 th  transaction, the host controller needs 511 bytes in page 0 and one byte in page 1. The host controller increments C\_Page (to 1) and uses the page 1 pointer to move the final byte of the transaction. After the 4 th  transaction, the active page pointer is the page 1 pointer and Current Offset has rolled to 1, and both are written back to the overlay area. The transactions continue for the rest of the buffer, with the host controller automatically moving to the next page pointer (that is, C\_Page) when necessary. The three conditions for how the host controller manages C\_Page are:

- The current transaction does not span a page boundary. The value of C\_Page is not adjusted by the host controller.
- The current transaction spans a page boundary. The host controller must detect the page cross condition and advance to the next buffer when streaming data to and from the USB.
- The current transaction completes on a page boundary (that is, the last byte moved for the current transaction is the last byte in the page for the current page pointer). The host controller must increment C\_Page before writing back status for the transaction.

## NOTE

The only valid adjustment the host controller may make to C\_Page is to increment by 1.

## 55.10.3.7 Adding interrupt QHs to the periodic schedule

The link path(s) from the periodic frame list to a QH establishes in which frames a transaction can be executed for the QH. QHs are linked into the periodic schedule so they are polled at the appropriate rate.

System software sets a bit in a QH's S-Mask to indicate which microframe within a 1 ms period a transaction must be executed for the QH. You must ensure that all QHs in the periodic schedule have S-Mask set to a non-zero value. An S-mask with zero value in the context of the periodic schedule yields undefined results.

If the desired poll rate is greater than one frame, system software can use a combination of QH linking and S-Mask values to spread interrupts of equal poll rates through the schedule so that the periodic bandwidth is allocated and managed in the most efficient manner possible. Some examples are illustrated in the following table.

Universal Serial Bus On-The-Go Controller (USBOTG)

Table 483. Example periodic reference patterns for interrupt transfers with 2 ms poll rate

| Frame # reference sequence            | Description                                                                                                                                                                                                                                                                                                                                                |
|---------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0, 2, 4, 6, 8, and so on S-Mask = 01h | A QH for the bInterval of 2 ms (16 microframes) is linked into the periodic schedule so that it is reachable from the periodic frame list locations indicated in the previous column. In addition, the S-Mask field in the QHis set to 01h, indicating that the transaction for the endpoint must be executed on the bus during microframe 0 of the frame. |
| 0, 2, 4, 6, 8, and so on S-Mask = 02h | Another example of a QH with a bInterval of 2 ms is linked into the periodic frame list at exactly the same interval as the previous example. However, the S-Mask is set to 02h indicating that the transaction for the endpoint must be executed on the bus during microframe 1 of the frame.                                                             |

## 55.10.3.8 Managing transfer complete interrupts from queue heads

The host controller sets an interrupt to be signaled at the next interrupt threshold when the completed transfer (qTD) has an IOC field that has a value of 1, or whenever a transfer (qTD) completes with a short packet.

If system software needs multiple qTDs to complete a client request (such as a control transfer), the intermediate qTDs do not require interrupts. System software may only need a single interrupt to notify it that the complete buffer has been transferred. System software may set IOCs to occur more frequently. A motivation for this may be that it wants early notification so that interface data structures can be reused in a timely manner.

## 55.10.4 Split transactions

USB 2.0 defines extensions to the bus protocol for managing USB 1.x data streams through USB 2.0 Hubs.

This section describes how the host controller uses the interface data structures to manage data streams with FS and LS devices, connected below USB 2.0 hub, using the split transaction protocol.

See the USB 2.0 Specification for the complete definition of the split transaction protocol. FS and LS devices are enumerated identically as HS devices, but the transactions to the FS and LS endpoints use the split-transaction protocol on the HS bus. The split transaction protocol is an encapsulation of (or wrapper around) the FS or LS transaction. The HS wrapper portion of the protocol is addressed to the USB 2.0 Hub and Transaction Translator, below which the FS or LS device is attached.

The EHCI interface uses dedicated data structures for managing FS isochronous data streams (see siTD). Control, bulk, and interrupt are managed using the queuing data structures (see QH). The interface data structures need to be programmed with the device address and the Transaction Translator number of the USB 2.0 Hub operating as the LS or FS host controller for this link. The following sections describe the details of how the host controller must process and manage the split transaction protocol.

## 55.10.4.1 Split transactions for asynchronous transfers

A QH in the asynchronous schedule with an EPS field indicating a FS or LS device indicates to the host controller that it must use split transactions to stream data for this QH.

All FS bulk, full- and LS control are managed through QHs in the asynchronous schedule.

You must initialize the QH with the appropriate device address and port number for the transaction translator that is serving as the FS/LS host controller for the links connecting the endpoint. You must also initialize the split transaction state field (SplitXState) to Do-Start-Split. Finally, if the endpoint is a control endpoint, then system software must set the Control Transfer Type (C) field in the QH to 1. If this is not a control transfer type endpoint, you must initialize the C field to be 0. This information is used by the host controller to properly set the Endpoint Type (ET) field in the split transaction bus token. When the C field is 0, the split transaction token's ET field is set to indicate a bulk endpoint. When the C field is 1, the split transaction token's ET field is set to indicate a control endpoint. See the USB Specification Revision 2.0 chapter for details.

Universal Serial Bus On-The-Go Controller (USBOTG)

<!-- image -->

## 55.10.4.1.1 Asynchronous-do start split

This is the state in which you must initialize a FS or LS asynchronous QH. This state is entered from the Do Complete Split state only after a complete-split transaction receives a valid response from the transaction translator that is not a Nyet handshake.

For QHs in this state, the host controller executes a start-split transaction to the appropriate transaction translator. If the bus transaction completes without an error and PidCode indicates an IN or OUT transaction, then the host controller reloads the error counter (CErr). If it is a successful bus transaction and the PidCode indicates a SETUP, the host controller does not reload the error counter. If the transaction translator responds with a Nak, the QH remains in this state, and the host controller proceeds to the next QH in the asynchronous schedule.

If the host controller times out the transaction (no response, or bad response) the host controller decrements Cerr and proceeds to the next QH in the asynchronous schedule.

## 55.10.4.1.2 Asynchronous-do complete split

This state is entered from the Do Start Split state only after a start-split transaction receives an Ack handshake from the transaction translator.

For QHs in this state, the host controller executes a complete-split transaction to the appropriate transaction translator. If the transaction translator responds with a Nyet handshake, the QH remains in this state, the error counter is reset and the host controller proceeds to the next QH in the asynchronous schedule. When a Nyet handshake is received for a bus transaction where the QH's PidCode indicates an IN or OUT, the host controller reloads the error counter (CErr). When a Nyet handshake is received for a complete-split bus transaction where the QH's PidCode indicates a SETUP, the host controller must not adjust the value of CErr.

Independent of PIDCode, the following responses have these effects:

- Transaction Error (XactErr). Timeout or data CRC failure, and so on. The error counter (Cerr) is decremented by 1 and the complete split transaction is immediately retried (if possible). If there is not enough time in the microframe to execute the retry, the host controller MUST ensure that the next time the host controller begins executing from the asynchronous schedule, it must begin executing from this QH. If another start-split (for some other endpoint) is sent to the transaction translator before the complete-split is really completed, the transaction translator could dump the results (which were never delivered to the host). This is why the core specification states the retries must be immediate. A method to accomplish this behavior is to not advance the asynchronous schedule. When the host controller returns to the asynchronous schedule in the next microframe, the first transaction from the schedule is the retry for this endpoint.

If Cerr went to 0, the host controller must halt the queue.

Universal Serial Bus On-The-Go Controller (USBOTG)

- NAK. The target endpoint generates a NAK response for the FS or LS transaction. The state of the transfer is not advanced and the state is exited. If the PidCode is a SETUP, then the Nak response is a protocol error. The XactErr status field is set to 1 and the CErr field is decremented.
- STALL. The target endpoint responded with a STALL handshake. The host controller sets the Halt field in the status byte and retires the qTD, but does not attempt to advance the queue.

If the PidCode indicates an IN, then any of following responses are expected:

- DATA0/1. On reception of data, the host controller ensures the PID matches the expected Data Toggle and checks CRC. If the packet is good, the host controller advances the state of the transfer; for example, it moves the data pointer by the number of bytes received, decrements the BytesToTransfer field by the number of bytes received, and toggles the DT field. The host controller then exits this state. The response and advancement of transfer may trigger other processing events, such as retirement of the qTD and advancement of the queue.

If the data sequence PID does not match the expected result, the data is ignored, the transfer state is not advanced, and this state is exited. If the PidCode indicates an OUT/SETUP, then any of following responses are expected:

- ACK. The target endpoint accepted the data, so the host controller must advance the state of the transfer. The Current Offset field is incremented by Maximum Packet Length or Bytes to Transfer, whichever is less. The field Bytes To Transfer is decremented by the same amount and the Data Toggle field (DT) is toggled. The host controller then exits this state.
- Advancing the transfer state may cause other processing events, such as retirement of the qTD and advancement of the queue (see Managing control/bulk/interrupt transfers through QHs).

## 55.10.4.2 Split transaction interrupt

Split-transaction interrupt-IN/OUT endpoints are managed through the same data structures used for HS interrupt endpoints; they coexist in the periodic schedule.

QHs/qTDs offer the set of features required for reliable data delivery, which is characteristic to interrupt transfer types. The split-transaction protocol is managed completely within this defined functional transfer framework. For example, for a HS endpoint, the host controller visits a QH, executes a HS transaction (if the criteria are met) and advances the transfer state (or not) depending on the results of the entire transaction. For LS and FS endpoints, the details of the execution phase are different (it takes more than one bus transaction to complete), but the remainder of the operational framework is intact. This means that the transfer advancement, and so on, occurs as defined in Managing control/bulk/interrupt transfers through QHs, but only occurs upon the completion of a split transaction.

## 55.10.4.2.1 Split transaction scheduling mechanisms for interrupt

FS and LS interrupt QHs have an EPS field indicating FS or LS and have a non-zero S-mask field.

The host controller can detect this combination of parameters and assume the endpoint is a periodic endpoint. LS and FS interrupt QHs require the use of the split transaction protocol. The host controller sets the Endpoint Type (ET) field in the split token to indicate the transaction is an interrupt. These transactions are managed through a transaction translator's periodic pipeline. You must not set these fields to indicate the QH is an interrupt unless the QH is used in the periodic schedule.

System software manages the per-transaction translator periodic pipeline by budgeting and scheduling exactly during which microframes the start-splits and complete-splits for each endpoint occur. The characteristics of the transaction translator are such that the HS transaction protocol must execute during explicit microframes, or else the data or response information in the pipeline is lost.

The following figure illustrates the general scheduling boundary conditions that are supported by the EHCI periodic schedule and QH data structure. The S and CX labels indicate microframes in which you can schedule start-splits and complete splits, respectively.

Figure 493. Split transaction, interrupt scheduling boundary conditions

<!-- image -->

The scheduling cases are:

- Case 1: The normal scheduling case is where the entire split transaction is completely bounded by a frame (H-Frame, in this case).
- Case 2a through Case 2c: The USB 2.0 Hub pipeline rules states clearly, determining when and how many completesplits must be scheduled to account for earliest to latest execution on the FS/LS link. The complete-splits may span the H-Frame boundary when the start-split is in microframe four or later. When this occurs, the H-Frame to B-Frame alignment requires that the QH be reachable from consecutive periodic frame list locations. System software cannot build an efficient schedule that satisfies this requirement unless it uses FSTNs.

The figure below illustrates the general layout of the periodic schedule.

<!-- image -->

Universal Serial Bus On-The-Go Controller (USBOTG)

The periodic frame list is effectively the leaf level of a binary tree, which is always traversed leaf to root. Each level in the tree corresponds to a 2 N  poll rate. You can efficiently manage periodic bandwidth on the USB by spreading interrupt QHs that have the same poll rate requirement across all the available paths from the frame list. For example, system software can schedule eight poll rate and eight QHs and account for them once in the HS bus bandwidth allocation.

When an endpoint is allocated an execution footprint that spans a frame boundary, the QH for the endpoint must be reachable from consecutive locations in the frame list. An example would be if 8 0b were such an endpoint. Without additional support on the interface, for 8 0b to be reachable at the correct time, you would have to link 8 1 to 8 0b . It would then have to move 4 1 and everything linked after into the same path as 4 0 . This upsets the integrity of the binary tree and disallows the use of the spreading technique.

FSTN data structures are used to preserve the integrity of the binary-tree structure and enable the use of the spreading technique. Host controller operational model for FSTNs defines the hardware and software operational model requirements for using FSTNs.

The following QH fields are initialized by system software to instruct the host controller when to execute portions of the split-transaction protocol:

- SplitXState. This is a single bit that resides in the Status field of a QH (see Table 456). This bit is used to track the current state of the split transaction.
- Frame S-mask. The system software sets a bit within this field corresponding to the microframe (within an H-Frame) for which the host controller should execute a start-split transaction. This is always qualified by the value of the SplitXState bit in the Status field of the QH. For example, referring to case one in Figure 493, the S-mask would have a value of 0000\_0001b; this indicates that if the QH is traversed by the host controller, and the SplitXState indicates Do\_Start, and the current microframe indicated by FRINDEX[2:0] is 0, then execute a start-split transaction.
- Frame C-mask. The system software sets one or more bits within this field corresponding to the microframes (within an H-Frame) for which the host controller should execute complete-split transactions. The interpretation of this field is always qualified by the value of the SplitXState bit in the Status field of the QH. For example, referring to case one in Figure 493, the C-mask would have a value of 0001\_1100b; this indicates that if the QH is traversed by the host controller, and the SplitXState indicates Do\_Complete, and the current microframe indicated by FRINDEX[2:0] is 2, 3, or 4, then execute a complete-split transaction. You are responsible for ensuring that the translation between H-Frames and B-Frames is correctly performed when setting bits in S-mask and C-mask.

## 55.10.4.2.2 Host controller operational model for FSTNs

The FSTN data structure is used to manage LS/FS interrupt QHs that need to be reached from consecutive frame list locations (that is boundary cases 2a through 2c).

An FSTN is essentially a back pointer, similar in intent to the back pointer field in the siTD data structure (see siTD back link pointer).

This feature provides you with a simple primitive to save a schedule position, redirect the host controller to traverse the necessary QHs in the previous frame, then restore the original schedule position and complete normal traversal.

The four components to the use of FSTNs are:

- FSTN data structure.
- A Save Place indicator. This is always an FSTN with its Back Path Link Pointer.T-bit set to 0.
- A Restore indicator. This is always an FSTN with its Back Path Link Pointer.T-bit set to 1.
- Host controller FSTN traversal rules.

When the host controller encounters an FSTN during microframes 2 through 7 it simply follows the node's Normal Path Link Pointer to access the next schedule data structure.

## NOTE

The FSTN's Normal Path Link Pointer.T-bit may set to 1, which the host controller must interpret as the end of periodic list mark.

When the host controller encounters a Save-Place FSTN in microframes 0 or 1, it saves the value of the Normal Path Link Pointer and sets an internal flag indicating that it is executing in Recovery Path mode. Recovery Path mode modifies the host controller's

Universal Serial Bus On-The-Go Controller (USBOTG)

rules for how it traverses the schedule and limits which data structures are considered for execution of bus transactions. The host controller continues executing in Recovery Path mode until it encounters a Restore FSTN or it determines that it has reached the end of the microframe (see details in the list below).

The rules for schedule traversal and limited execution when in Recovery Path mode are:

- Always follow the Normal Path Link Pointer when it encounters an FSTN that is a Save-Place indicator. The host controller must not recursively follow Save-Place FSTNs. Therefore, when executing in Recovery Path mode, it must never follow an FSTN's Back Path Link Pointer.
- Do not process an siTD or iTD data structure. Simply follow its Next Link Pointer.
- Do not process a QH whose EPS field indicates a HS device. Simply follow its Horizontal Link Pointer.
- When a QH's EPS field indicates a FS/LS device, the host controller only considers it for execution if its SplitXState is DoComplete (note: this applies whether the PID Code indicates an IN or an OUT). See Execute transaction and Tracking split transaction progress for interrupt transfers for a complete list of additional conditions that must be met in general for the host controller to issue a bus transaction.
- The host controller must not execute a Start-split transaction when executing in Recovery Path mode. See Periodic isochronous - do complete split for special handling when in Recovery Path mode.
- Stop traversing the recovery path when it encounters an FSTN that is a Restore indicator. The host controller unconditionally uses the saved value of the Save-Place FSTN's Normal Path Link Pointer when returning to the normal path traversal. The host controller must clear the context of executing a Recovery Path when it restores schedule traversal to the Save-Place FSTN's Normal Path Link Pointer.
- If the host controller determines that there is not enough time remaining in the microframe to complete processing of the periodic schedule, it abandons traversal of the recovery path and clears the context of executing a recovery path. The result is that at the start of the next consecutive microframe, the host controller starts traversal at the frame list.

An example traversal of a periodic schedule that includes FSTNs is illustrated in the following figure.

<!-- image -->

In frame N+1 (microframes 0 and 1), when the host controller encounters Save-Path FSTN (Save-N), it observes that the Save-N.Back Path Link Pointer.T-bit is 0 (definition of a Save-Path indicator). The host controller saves the value of Save-N.Normal Path Link Pointer and follows Save-N.Back Path Link Pointer. At the same time, it sets an internal flag indicating that it is now in Recovery Path mode (the recovery path is annotated in the figure above with a large dashed line). The host controller continues traversing data structures on the recovery path and executing only those bus transactions as noted above,

Universal Serial Bus On-The-Go Controller (USBOTG)

on the recovery path until it reaches Restore FSTN (Restore-N). Restore-N.Back Path Link Pointer.T-bit is set to 1 (definition of a Restore indicator), so the host controller exits Recovery Path mode by clearing the internal Recovery Path mode flag and commences (restores) schedule traversal using the saved value of the Save-Place FSTN's Normal Path Link Pointer (for example Save-N.Normal Path Link Pointer). The nodes traversed during these microframes include: {8 3.0 , 8 3.1 , 8 3.2 , Save-A, 8 2.2 , 8 2.3 , 4 2 , 20, Restore-N, 4 3 ,  2 1 ,  Restore-N, 1 0 ...}.  The  nodes on the recovery-path are in bold. In frame N (microframes 0-7), for this example, the host controller traverses all of the schedule data structures using the Normal Path Link Pointers in any FSTNs it encounters. This is because the host controller has not yet encountered a Save-Place FSTN so it is not executing in Recovery Path mode. When it encounters the Restore FSTN, (Restore-N), during microframes 0 and 1, it uses Restore-N.Normal Path Link Pointer to traverse to the next data structure (that is normal schedule traversal). This is because the host controller must use a Restore FSTN's Normal Path Link Pointer when not executing in a Recovery Path mode. The nodes traversed during frame N include: {8 2.0 , 82.1 , 8 2.2 , 8 2.3 , 4 2 , 2 0 , Restore-N, 1 0 ...}.

In frame N+1 (microframes 2-7), when the host controller encounters Save-Path FSTN Save-N, it unconditionally follows Save-N.Normal Path Link Pointer. The nodes traversed during these microframes include: {8 3.0 , 8 3.1 , 8 3.2 , Save-A, 4 3 , 2 1 , Restore-N, 10 ...}.

## 55.10.4.2.3 Software operational model for FSTNs

You must create a consistent, coherent schedule for the host controller to traverse.

When using FSTNs, the system software must adhere to the following rules:

- Each Save-Place indicator requires a matching Restore indicator.
- The Save-Place indicator is an FSTN with a valid Back Path Link Pointer and T-bit equal to 0.
- Back Path Link Pointer.Typ field must be set to indicate the referenced data structure is a QH. The Restore indicator is an FSTN with its Back Path Link Pointer.T-bit set to 1.
- A Restore FSTN may be matched to one or more Save-Place FSTNs. For example, if the schedule includes a poll-rate one level, then system software only needs to place a Restore FSTN at the beginning of this list in order to match all possible Save-Place FSTNs.
- If the schedule does not have elements linked at a poll-rate level of one, and one or more Save-Place FSTNs are used, then System software must ensure the Restore FSTN's Normal Path Link Pointer's T-bit is set to 1, as this is used to mark the end of the periodic list.
- When the schedule does have elements linked at a poll rate level of one, a Restore FSTN must be the first data structure on the poll rate one list. All traversal paths from the frame list converge on the poll-rate one list. System software must ensure that Recovery Path mode is exited before the host controller is allowed to traverse the poll rate level one list.
- A Save-Place FSTN's Back Path Link Pointer must reference a QH data structure. The referenced QH must be reachable from the previous frame list location. In other words, if the Save-Place FSTN is reachable from frame list offset N, then the FSTN's Back Path Link Pointer must reference a QH that is reachable from frame list offset N-1.

You should make the schedule as efficient as possible. What this means in this context is that you must have no more than one Save-Place FSTN reachable in any single frame. Note there are times when two (or more, depending on the implementation) could exist as FS/LS footprints change with bandwidth adjustments. This could occur, for example when a bandwidth re-balance causes system software to move the Save-Place FSTN from one poll rate level to another. During the transition, you must preserve the integrity of the previous schedule until the new schedule is in place.

## 55.10.4.2.4 Tracking split transaction progress for interrupt transfers

To correctly maintain the data stream, the host controller must be able to detect and report errors where data is lost.

For interrupt-IN transfers, data is lost when it makes it into the USB 2.0 hub, but the USB 2.0 host system is unable to obtain it from the USB 2.0 Hub and into the system before it expires from the transaction translator pipeline.

When a lost data condition is detected, the queue must be halted, thus signaling system software to recover from the error. A data-loss condition exists whenever a start-split is issued, accepted, and successfully executed by the USB 2.0 Hub, but the complete-splits generate unrecoverable errors on the HS link, or the complete-splits do not occur at the correct times. One reason

Universal Serial Bus On-The-Go Controller (USBOTG)

complete-splits might not occur at the correct time would be due to host-induced system hold-offs that cause the host controller to miss bus transactions because it cannot obtain timely access to the schedule in system memory.

The same condition can occur for an interrupt-OUT, but the result is not an endpoint halt condition and instead affects only the progress of the transfer. The QH has the following fields to track the progress of each split transaction. These fields are used to record an incremental state about which (and when) portions have been executed.

- C-prog-mask. This is an eight-bit bit-vector where the host controller keeps track of which complete-splits have been executed. Due to the nature of the Transaction Translator periodic pipeline, the complete-splits need to be executed in order. The host controller needs to detect when the complete-splits have not been executed in order. This can only occur due to system hold-offs where the host controller cannot access the memory-based schedule. C-prog-mask is a simple bit-vector in which the host controller sets one of the C-prog-mask bits for each complete-split executed. The bit position is determined by the microframe number in which the complete-split was executed. The host controller always checks C-prog-mask before executing a complete-split transaction. If the previous complete-splits have not been executed, then one (or more) have been skipped and data has potentially been lost.
- FrameTag. This field is used by the host controller during the complete-split portion of the split transaction to tag the QH with the frame number (H-Frame number) when the next complete split must be executed.
- S-bytes. This field can be used to store the number of data payload bytes sent during the start-split (if the transaction was an OUT). The S-bytes field must be used to accumulate the data payload bytes received during the complete-splits (for an IN).

## 55.10.4.2.5 Split transaction execution state machine for interrupt

In this section, all references to microframe are in the context of a microframe within an H-Frame.

As with asynchronous FS and LS endpoints, a split-transaction state machine is used to manage the split transaction sequence.

In addition to the fields defined in the QH for scheduling and tracking the split transaction, the host controller calculates one internal mechanism that is also used to manage the split transaction. The internal calculated mechanism is:

- cMicroFrameBit. This is a single-bit encoding of the current microframe number. It is an eight-bit value calculated by the host controller at the beginning of every microframe. It is calculated from the three least significant bits of USB Frame Index (FRINDEX) (that is, cMicroFrameBit = (1 shifted-left(FRINDEX[2:0])). The cMicroFrameBit has at most one bit asserted, which always corresponds to the current microframe number. For example, if the current microframe is 0, then cMicroFrameBit will equal 00000001b. The variable cMicroFrameBit is used to compare against the S-mask and C-mask fields to determine whether the QH is marked for a start- or complete-splt transaction for the current microframe.

The following figure illustrates the state machine for managing a complete interrupt split transaction. There are two phases to each split transaction. The first is a single start-split transaction, which occurs when the SplitXState is at Do\_Start and the single bit in cMicroFrameBit has a corresponding bit active in QH.S-mask. The transaction translator does not acknowledge the receipt of the periodic start-split, so the host controller unconditionally transitions the state to Do\_Complete. Due to the available jitter in the transaction translator pipeline, there will be more than one complete-split transaction scheduled by software for the Do\_Complete state. This translates simply to the fact that there are multiple bits set to 1 in the QH.C-mask field.

The host controller keeps the QH in the Do\_Complete state until the split transaction is complete (see definition below), or an error condition triggers the three-strikes-rule (for example, after the host tries the same transaction three times, and each encounters an error, the host controller will stop retrying the bus transaction and halt the endpoint, thus requiring system software to detect the condition and perform system-dependent recovery).

Universal Serial Bus On-The-Go Controller (USBOTG)

<!-- image -->

See the previous sections for the frame tag management rules.

## 55.10.4.2.5.1 Periodic interrupt-do start split

This is the state in which you must initialize a FS or LS interrupt QH StartXState bit. The state is entered from the Do\_Complete Split state only after the split transaction is complete. This occurs when one of the following events occur. The transaction translator responds to a complete-split transaction with one of the following:

- NAK. A NAK response is a propagation of the FS or LS endpoint's NAK response.
- ACK. An ACK response is a propagation of the FS or LS endpoint's ACK response. It only occurs on an OUT endpoint.
- DATA 0/1. Only occurs for INs. Indicates that this is the last of the data from the endpoint for this split transaction.
- ERR. The transaction on the LS/FS link below the transaction translator had a failure (for example, timeout, bad CRC, and so on.).
- NYET (and Last). The host controller issued the last complete-split and the transaction translator responded with a NYET handshake. This means that the start-split was not correctly received by the transaction translator, so it never executed a transaction to the FS or LS endpoint. See Section Periodic isochronous - do complete split for the definition of "Last".

Each time the host controller visits a QH in this state (when within the Execute Transaction state), it performs the following test to determine whether to execute a start-split:

- QH.S-mask is bit-wise anded with cMicroFrameBit.

If the result is non-zero, then the host controller will issue a start-split transaction. If the PIDCode field indicates an IN transaction, the host controller must zero-out the QH.S-bytes field. After the split-transaction has been executed, the host controller sets up state in the QH to track the progress of the complete-split phase of the split transaction. Specifically, it records the expected frame number into the QH.FrameTag field, sets the C-prog-mask to 0 (00h), and exits this state. Note that the host controller must not adjust the value of CErr as a result of completion of a start-split transaction.

## 55.10.4.2.5.2 Periodic interrupt-do complete split

This state is entered unconditionally from the Do Start Split state after a start-split transaction is executed on the bus. Each time the host controller visits a QH in this state (when within the Execute Transaction state), it checks to determine whether a complete-split transaction must be executed at that time.

Universal Serial Bus On-The-Go Controller (USBOTG)

There are four tests to determine whether a complete-split transaction must be executed.

- Test A. cMicroFrameBit is bit-wise anded with QH.C-mask field. A non-zero result indicates that you scheduled a complete-split for this endpoint, during this microframe.
- Test B. QH.FrameTag is compared with the current contents of FRINDEX[7:3]. An equal indicates a match.
- Test C. The complete-split progress bit vector is checked to determine whether the previous bit is set, indicating that the previous complete-split was appropriately executed. An example algorithm for this test is provided below:
- Test D. Check to see if a start-split should be executed in this microframe. Note this is the same test performed in the Do Start Split state (see Section Periodic isochronous - do start split). Whenever it evaluates to TRUE and the controller is NOT processing in the context of a Recovery Path mode, it means a start-split should occur in this microframe. Test D and Test A evaluating to TRUE at the same time is a system software error. Behavior is undefined.

```
Algorithm Boolean CheckPreviousBit(QH.C-prog-mask, QH.C-mask, cMicroFrameBit) Begin -- Return values: -- TRUE - no error -- FALSE - error --Boolean rvalue = TRUE; previousBit = cMicroframeBit logical-rotate-right(1) -- Bit-wise anding previousBit with C-mask indicates -- whether there was an intent -- to send a complete split in the previous microframe. So, -- if the -- 'previous bit' is set in C-mask, check C-prog-mask to -- make sure it -- happened. If (previousBit bitAND QH.C-mask)then If not(previousBit bitAND QH.C-prog-mask) then rvalue = FALSE; End if End If -- If the C-prog-mask already has a 1 in this bit position, -- then an aliasing -- error has occurred. It will probably be caught by the -- FrameTag Test, but -- at any rate it is an error condition that as detectable here -- must not allow -- a transaction to be executed. If (cMicroFrameBit bitAND QH.C-prog-mask) then rvalue = FALSE; End if return (rvalue) End Algorithm
```

If logically (A .and. B .and. C .and. not(D)) is true, then the host controller will execute a complete-split transaction. When the host controller commits to executing the complete-split transaction, it updates QH.C-prog-mask by performing a bit-OR with cMicroFrameBit. On completion of the complete-split transaction, the host controller records the result of the transaction in the QH and sets QH.FrameTag to the expected H-Frame number. The effect to the state of the QH and thus the state of the transfer depends on the response by the transaction translator to the complete-split transaction. The following responses have the given effects (note that any responses that result in decrementing of CErr will result in the QH being halted by the host controller if the result of the decrement is 0):

- NYET (and Last). On each NYET response, the host controller checks to determine whether this is the last complete-split for this split transaction. Last is defined in this context as the condition in which all of the scheduled complete-splits have been executed. If it is the last complete-split (with a NYET response), then the transfer state of the QH is not advanced (never received any data) and this state exited. The transaction translator must have responded to all the complete-splits

Universal Serial Bus On-The-Go Controller (USBOTG)

with NYETs, meaning that the start-split issued by the host controller was not received. The start-split should be retried at the next poll period.

- The test for whether this is the Last complete split can be performed by XOR QH.C-mask with QH.C-prog-mask. If the result is all zeros then all complete-splits have been executed. When this condition occurs, the XactErr status bit is set to a 1 and the CErr field is decremented.
- NYET (and not Last). See the above description for testing for Last. The complete-split transaction received a NYET response from the transaction translator. Do not update any transfer state (except for C-prog-mask and FrameTag) and stay in this state. The host controller must not adjust CErr on this response.
- Transaction Error (XactErr). Timeout, data CRC failure, and so on. The CErr field is decremented and the XactErr bit in the Status field is set to a 1. The complete split transaction is immediately retried (if Cerr is non-zero). If there is not enough time in the microframe to complete the retry and the endpoint is an IN, or CErr is decremented to a 0 from a 1, the queue is halted. If there is not enough time in the microframe to complete the retry and the endpoint is an OUT and CErr is not 0, then this state is exited (that is, returned to Do Start Split). This results in a retry of the entire OUT split transaction, at the next poll period. See the Hubs (specifically, the "FS and LS interrupts") section in the USB Specification Revision 2.0 for detailed requirements on why these errors must be immediately retried.
- ACK. This can only occur if the target endpoint is an OUT. The target endpoint responded with ACK for the data, and this response is a propagation of the endpoint ACK up to the host controller. The host controller must advance the state of the transfer. The Current Offset field is incremented by Maximum Packet Length or Bytes to Transfer, whichever is less. The field Bytes To Transfer is decremented by the same amount. And the data toggle bit (DT) is toggled. The host controller will then exit this state for this QH. The host controller must reload CErr with the maximum value on this response. Advancing the transfer state may cause other process events such as retirement of the qTD and advancement of the queue (see Managing control/bulk/interrupt transfers through QHs).
- MDATA. This response will only occur for an IN endpoint. The transaction translator responded with zero or more bytes of data and an MDATA PID. The incremental number of bytes received is accumulated in QH.S-bytes. The host controller must not adjust CErr on this response.
- DATA0/1. This response may only occur for an IN endpoint. The number of bytes received is added to the accumulated byte count in QH.S-bytes. The state of the transfer is advanced by the result and the host controller will exit this state for this QH.
- Advancing the transfer state may cause other processing events such as retirement of the qTD and advancement of the queue (see Managing control/bulk/interrupt transfers through QHs).
- If the data sequence PID does not match the expected, the entirety of the data received in this split transaction is ignored, the transfer state is not advanced, and this state is exited.
- NAK. The target endpoint generated a NAK response for the FS or LS transaction. The state of the transfer is not advanced, and this state is exited. The host controller must reload CErr with the maximum value on this response.
- ERR. There was an error during the FS or LS transaction. The ERR status bit is set to a 1, Cerr is decremented, the state of the transfer is not advanced, and this state is exited.
- STALL. The queue is halted (an exit condition of the Execute Transaction state). The Active status field is set to 0, the Halted status field is set to a 1, and the qTD is retired. Responses which are not enumerated in the list or which are received out of sequence are illegal and may result in undefined host controller behavior. The other possible combinations of tests A, B, C, and D may indicate that the data or the response was lost. The table below lists the possible combinations and the appropriate actions.

Table 484. Interrupt IN/OUT do complete split state execution criteria

| Condition     | Action     | Description                                                                                                                           |
|---------------|------------|---------------------------------------------------------------------------------------------------------------------------------------|
| not(A) not(D) | Ignore QHD | Neither a start nor complete-split is scheduled for the current microframe. The host controller should continue walking the schedule. |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

Table 484. Interrupt IN/OUT do complete split state execution criteria (continued)

| Condition    | Action                                                                | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|--------------|-----------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| A not(C)     | If PIDCode = IN then halt QHD If PIDCode = OUT then retry start-split | Progress bit check failed. This means a complete-split has been missed. There is the possibility of lost data. If PIDCode is an IN, then the QH must be halted. If PIDCode is an OUT, then the transfer state is not advanced and the state exited (for example, start-split is retried). This is a host-induced error and does not effect CERR. In either case, set the Missed Microframe bit in the status field to a 1.                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| A not(B) C   | If PIDCode = IN then halt QHD If PIDCode = OUT then retry start-split | QH.FrameTag test failed. This means that exactly one or more H-Frames have been skipped. This meanscomplete-splits and have missed. There is the possibility of lost data. If PIDCode is an IN, then the QHmustbehalted. If PIDCode is an OUT, then the transfer state is not advanced and the state is exited (for example, start-split is retried). This is a host-induced error and does not effect CERR. In either case, set the Missed Microframe bit in the status field to a 1.                                                                                                                                                                                                                                                                                                                                                                                        |
| A B C not(D) | Execute complete-split                                                | This is the non-error case where the host controller executes a complete- split transaction.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| D            | If PIDCode = IN then halt QHD If PIDCode = OUT then retry start-split | This is a degenerate case where the start-split was issued, but all of the complete-splits were skipped and all possible intervening opportunities to detect the missed data failed to result in detection. If PIDCodeis an IN, then the QH must be halted. If PIDCode is an OUT, then the transfer state is not advanced and the state exited (for example, start-split is retried). This is a host-induced error and does not affect CERR. In either case, you must set the Missed Microframe bit in the status field to a 1. Note: When executing in the context of a Recovery Path mode, the host controller is allowed to process the QHand take the actions indicated above, or it may wait until the QHis visited in the normal processing mode. Regardless, the host controller must not execute a start-split in the context of a executing in a Recovery Path mode. |

## 55.10.4.2.5.3 Managing the QH.FrameTag field

The QH.FrameTag field in a QH is completely managed by the host controller. The rules for setting QH.FrameTag are these (see USB Frame Index (FRINDEX)):

- Rule 1: If transitioning from Do Start Split to Do Complete Split and the current value of FRINDEX[2:0] is 6, then QH.FrameTag is set to FRINDEX[7:3] + 1. This accommodates split transactions whose start-split and complete-splits are in different H-Frames (case 2a, see Figure 493).
- Rule 2: If the current value of FRINDEX[2:0] is 7, then QH.FrameTag is set to FRINDEX[7:3] + 1. This accommodates staying in Do Complete Split for cases 2a, 2b, and 2c (see Figure 493).

Universal Serial Bus On-The-Go Controller (USBOTG)

- Rule 3: If transitioning from Do\_Start Split to Do Complete Split and the current value of FRINDEX[2:0] is not 6, or currently in Do Complete Split and the current value of (FRINDEX[2:0]) is not 7, FrameTag is set to FRINDEX[7:3]. This accommodates all other cases (see Figure 493).

## 55.10.4.2.6 Rebalancing the periodic schedule

System software must occasionally adjust a periodic QH's S-mask and C-mask fields during operation.

This need occurs when adjustments to the periodic schedule create a new bandwidth budget and one or more QHs are assigned new execution footprints (that is, new S-mask and C-mask values).

It is imperative that the system software must not update these masks to new values in the midst of a split transaction. In order to avoid any race conditions with the update, the EHCI host controller provides a simple assist to system software. System software sets the Inactivate-on-next-Transaction (I) field to a 1 to signal the host controller that it intends to update the S-mask and C-mask on this QH. System software will then wait for the host controller to observe the I-bit is a 1 and transition the Active field to a 0. Following are the rules for how and when the host controller sets the Active field to 0:

- If the Active field is a 0, no action is taken. The host controller does not attempt to advance the queue when the I-bit is a 1.
- If the Active field is a 1 and the SplitXState is DoStart (regardless of the value of S-mask), the host controller will simply set the Active field to a 0. The host controller is not required to write the transfer state back to the current qTD. Note that if the S-mask indicates that a start-split is scheduled for the current microframe, the host controller must not issue the start-split bus transaction. It must set the Active field to 0.

The system software must save the transfer state before setting the I-bit to a 1. This is required so that it can correctly determine what transfer progress (if any) occurred after the I-bit was set to a 1 and the host controller executed its final bus transaction and set Active to 0.

After system software has updated the S-mask and C-mask, it must then reactivate the QH. Because the Active field and the I-bit cannot be updated with the same write, the system software needs to use the following algorithm to coherently reactivate a QH that has been stopped via the I-bit.

1. Set the Halted field to 1.
2. Set the I-bit to 0.
3. Set the Active field to 1 and the Halted field to 0 in the same write.

Setting the Halted field to 1 inhibits the host controller from attempting to advance the queue between the time the I-bit goes to 0 and the Active field goes to 1.

## 55.10.4.3 Split transaction isochronous

FS isochronous transfers are managed using the split-transaction protocol through a USB 2.0 transaction translator in a USB2.0 Hub. The EHCI controller uses the siTD data structure to support the special requirements of isochronous split-transactions.

This data structure uses the scheduling model of isochronous TDs (see iTD; also see Managing isochronous transfers using iTDs for the operational model of iTDs) with the contiguous data feature provided by queue heads. This arrangement allows a single isochronous scheduling model with the additional feature that all data received from the endpoint (per split transaction) must land into a contiguous buffer.

## 55.10.4.3.1 Split transaction scheduling mechanisms for isochronous

FS isochronous transactions are managed through a transaction translator's periodic pipeline. As with FS and LS interrupts, system software manages each transaction translator's periodic pipeline by budgeting and scheduling exactly during which microframes the start-splits and complete-splits for each FS isochronous endpoint occur.

The requirements described in Split transaction scheduling mechanisms for interrupt apply. The following figure illustrates the general scheduling boundary conditions that are supported by the EHCI periodic schedule. The S X and CX labels indicate microframes where you can schedule start- and complete-splits (respectively). The H-Frame boundaries are marked with a large,

Universal Serial Bus On-The-Go Controller (USBOTG)

solid, bold vertical line. The B-Frame boundaries are marked with a large, bold, dashed line. The bottom of the figure illustrates the relationship of an siTD to the H-Frame.

Figure 497. Split transaction, isochronous scheduling boundary conditions

<!-- image -->

When the endpoint is an isochronous OUT, there are only start-splits and no complete-splits. When the endpoint is an isochronous IN, there is at most one start-split and one to N complete-splits. The scheduling boundary cases are:

- Case 1: The entire split transaction is completely bounded by an H-Frame. For example, the start-splits and completesplits are all scheduled to occur in the same H-Frame.
- Case 2a: In this boundary case, one or possibly two complete-splits of a split transaction IN are scheduled across an H-Frame boundary. This can only occur when the split transaction has the possibility of moving data in B-Frame, microframes 6 or 7 (H-Frame microframe 7 or 0). When an H-Frame boundary wrap condition occurs, the scheduling of the split transaction spans more than one location in the periodic list. (for example, it takes two siTDs in adjacent periodic frame list locations to fully describe the scheduling for the split transaction.)
- Although the scheduling of the split transaction may take two data structures, all of the complete-splits for each FS IN isochronous transaction must use only one data pointer. For this reason, siTDs contain a back pointer, the use of which is described below.
- You must never schedule FS isochronous OUTs across an H-Frame boundary.
- Case 2b: This case can only occur for a very large isochronous IN, and is the only allowed scenario in which a start-split and complete-split for the same endpoint can occur in the same microframe. You must enforce this rule by scheduling the large transaction first. Large is defined to be anything larger than 579-byte maximum packet size.

A subset of the same mechanisms employed by full- and LS interrupt queue heads are employed in siTDs to schedule and track the portions of isochronous split transactions. The following fields are initialized by the system software to instruct the host controller when to execute portions of the split transaction protocol.

Universal Serial Bus On-The-Go Controller (USBOTG)

- SplitXState. This is a single bit residing in the Status field of an siTD (see Figure 498). This bit is used to track the current state of the split transaction. The rules for managing this bit are described in Split transaction execution state machine for interrupt.
- Frame S-mask. This is a field in which the system software sets a bit corresponding to the microframe (within an H-Frame) for which the host controller should execute a start-split transaction. This is always qualified by the value of the SplitXState bit. For example, referring to the IN example in Figure 497, Case one, the S-mask would have a value of 00000001b, indicating that if the siTD is traversed by the host controller, and the SplitXState indicates Do Start Split, and the current microframe as indicated by USB\_n\_FRINDEX[2:0] is 0, then execute a start-split transaction.
- Frame C-mask. This is a field in which system software sets one or more bits corresponding to the microframes (within an H-Frame) for which the host controller should execute complete-split transactions. The interpretation of this field is always qualified by the value of the SplitXState bit. For example, referring to the IN example in Figure 497, Case one, the C-mask would have a value of 00111100b, indicating that if the siTD is traversed by the host controller, and the SplitXState indicates Do Complete Split, and the current microframe as indicated by USB\_n\_FRINDEX[2:0] is 2, 3, 4, or 5, then execute a complete-split transaction.
- Back Pointer. This field in an siTD is used to complete an IN split-transaction using the previous H-Frame's siTD. This is only used when the scheduling of the complete-splits span an H-Frame boundary.

There exists a one-to-one relationship between a HS isochronous split transaction (including all start- and complete-splits) and one FS isochronous transaction. An siTD contains (among other things) buffer state and split transaction scheduling information. An siTD's buffer state always maps to one FS isochronous data payload. This means that for any FS transaction payload, a single siTD's data buffer must be used. This rule applies to both IN and OUT transactions. An siTD's scheduling information usually also maps to one HS isochronous split transaction. The exception to this rule is the H-Frame boundary wrap cases mentioned above.

The siTD data structure describes, at most, one frame's worth of HS transactions, and that description is strictly bounded within a frame boundary. The figure below illustrates some examples. On the top are examples of the FS transaction footprints for the boundary scheduling cases described above. In the middle are time-frame references for both the B-Frames (HS, FS, or LS Bus) and the H-Frames. On the bottom is illustrated the relationship between the scope of an siTD description and the time references. Each H-Frame corresponds to a single location in the periodic frame list. The implication is that each siTD is reachable from a single periodic frame list location at a time.

<!-- image -->

Each case is described below:

Universal Serial Bus On-The-Go Controller (USBOTG)

- Case 1: One siTD is sufficient to describe and complete the isochronous split transaction because the whole isochronous split transaction is tightly contained within a single H-Frame.
- Case 2a, 2b: Although both INs and OUTs can have these footprints, OUTs always take only one siTD to schedule. However, INs (for these boundary cases) require two siTDs to complete. The scheduling of the isochronous split transaction siTD X is used to always issue the start-split and the first N complete-splits. The FS transaction (for these cases) can deliver data on the FS bus segment during microframe 7 of H-Frame Y+1 , or microframe 0 of H-Frame Y+2 . The complete splits are scheduled using siTD X+2 (not shown). The complete-splits used to extract this data must use the buffer pointer from siTD X+1 . The only way for the host controller to reach siTD X+1 from H-FrameY+2 is to use siTD X+2 's back pointer. The host controller rules for when to use the back pointer are described in Periodic isochronous - do complete split .

You must apply the following rules when calculating the schedule and linking the schedule data structures into the periodic schedule:

- You must ensure that an isochronous split-transaction is started so that it will complete before the end of the B-Frame.
- You must ensure that, for a single FS isochronous endpoint, there is never a start-split and complete-split in H-Frame, microframe 1. This is mandated as a rule so that Case 2a and Case 2b can be discriminated. According to the core USB specification, the long isochronous transaction illustrated in Case 2b, could be scheduled so that the start-split is in microframe 1 of H-Frame N and the last complete-split would need to occur in microframe 1 of H-Frame N+1. However, it is impossible to discriminate between Case 2a and Case 2b, which has a significant impact on the complexity of the host controller.

## 55.10.4.3.2 Tracking split transaction progress for isochronous transfers

To correctly maintain the data stream, the host controller must be able to detect and report errors where device-to-host data is lost. Isochronous endpoints do not employ the concept of "halt on error"; however, the host is required to identify and report per-packet errors observed in the data stream. This includes schedule traversal problems (skipped microframes), timeouts, and corrupted data received.

As is the case for interrupt split-transactions, the portions of the split transaction protocol must execute in the microframes they are scheduled. The QH data structure used to manage FS and LS interrupts has several mechanisms for tracking when portions of a transaction have occurred. Isochronous transfers use siTDs for their transfers, and the data structures are only reachable via the schedule in the exact microframe in which they are required (therefore, all of the mechanisms employed for tracking in QHs are not required for siTDs). You have the option of reusing an siTD several times in the complete periodic schedule. However, it must ensure that the results of split transaction N are consumed and the siTD reinitialized (activated) before the host controller returns to the siTD (in a future microframe).

Split-transaction isochronous OUTs use a low-level protocol to indicate which portions of the split transaction data have arrived. Control over the low-level protocol is exposed in an siTD via the fields TP and T-Count. If the entire data payload for the OUT split transaction is larger than 188 bytes, there will be more than one start-split transaction, each of which require proper annotation. If host hold-offs occur, then the sequence of annotations received from the host will not be complete, which is detected and managed by the transaction translator. See Periodic isochronous - do start split for a description of how these fields are used during a sequence of start-split transactions.

The fields siTD.T-Count and siTD.TP are used by the host controller to drive and sequence the TP annotations. It is the responsibility of the system software to properly initialize these fields in each siTD. After the budget for a split-transaction isochronous endpoint is established, S-mask, T-Count, and TP initialization values for all the siTD associated with the endpoint are constant, and they remain constant until you recalculate the budget for the endpoint and the periodic schedule is adjusted.

For IN-endpoints, the transaction translator simply annotates the response data packets with enough information to allow the host controller to identify the last data. As with a split transaction interrupt, it is the host controller's responsibility to detect when it has missed an opportunity to execute a complete-split. The following field in the siTD is used to track and detect errors in the execution of a split transaction for an IN isochronous endpoint.

- C-prog-mask. This is an eight-bit bit-vector in which the host controller keeps track of which complete-splits have been executed. Due to the nature of the Transaction Translator periodic pipeline, the complete-splits need to be executed in order. The host controller needs to detect when the complete-splits have not been executed in order. This can only occur due to system hold-offs for which the host controller cannot access the memory-based schedule. C-prog-mask is a simple

Universal Serial Bus On-The-Go Controller (USBOTG)

bit-vector for which the host controller sets a field for each complete-split executed. The bit position is determined by the microframe (USB\_n\_FRINDEX[2:0]) number in which the complete-split was executed. The host controller always checks the C-prog-mask before executing a complete-split transaction. If the previous complete-splits have not been executed, then it means that one (or more) have been skipped and data has potentially been lost. The system software must initialize this field to 0 before setting the Active field of an siTD to a 1.

If a transaction translator returns with the final data before all of the complete-splits have been executed, the state of the transfer is advanced so that the remaining complete-splits are not executed. See Asynchronous-do complete split for a description on how the state of the transfer is advanced. It is important to note that an IN siTD is retired based solely on the responses from the Transaction Translator to the complete-split transactions. This means, for example, that it is possible for a transaction translator to respond to a complete-split with an MDATA PID. The number of bytes in the MDATA's data payload could cause the siTD field Total Bytes to Transfer to decrement to 0. This response can occur before all of the scheduled complete-splits have been executed. In other interface data structures (for example, HS data streams through QHs), the transition of Total Bytes to Transfer to 0 signals the end of the transfer and results in setting of the Active field to 0. However, in this case, the result has not been delivered by the Transaction Translator and the host must continue with the next complete-split transaction to extract the residual transaction state. This scenario occurs because of the pipeline rules for a Transaction Translator (see Chapter 11 of the Universal Serial Bus Revision 2.0). In summary, the periodic pipeline rules require that, on a microframe boundary, the Transaction Translator will hold the final two bytes received (if it has not seen an End Of Packet (EOP)) in the FS bus pipe stage and give the remaining bytes to the HS pipeline stage. At the microframe boundary, the Transaction Translator could have received the entire packet (including both CRC bytes) but not received the packet EOP. In the next microframe, the Transaction Translator will respond with an MDATA and send all of the data bytes (with the two CRC bytes being held in the FS pipeline stage). This could cause the siTD to decrement its Total Bytes to Transfer field to 0, indicating it has received all expected data. The host must still execute one more (scheduled) complete-split transaction in order to extract the results of the FS transaction from the Transaction Translator (for example, the Transaction Translator may have detected a CRC failure, and this result must be forwarded to the host).

If the host experiences hold-offs that cause the host controller to skip one or more (but not all) scheduled split transactions for an isochronous OUT, then the protocol to the transaction translator will not be consistent and the transaction translator will detect and react to the problem. Likewise, for host hold-offs that cause the host controller to skip one or more (but not all) scheduled split transactions for an isochronous IN, the C-prog-mask is used by the host controller to detect errors. However, if the host experiences a hold-off that causes it to skip all of an siTD, or an siTD expires during a host hold off (for example, a hold-off occurs and the siTD is no longer reachable by the host controller in order for it to report the hold-off event), then the system software must detect that the siTDs have not been processed by the host controller (that is, state not advanced) and report the appropriate error to the client driver.

## 55.10.4.3.3 Split transaction execution state machine for isochronous

In the following presentation, all references to microframe are in the context of a microframe within an H-Frame.

If the Active field in the Status byte is a 0, the host controller will ignore the siTD and continue traversing the periodic schedule. Otherwise, the host controller will process the siTD as specified below. A split transaction state machine is used to manage the split-transaction protocol sequence. The host controller uses the fields defined in Tracking split transaction progress for interrupt transfers, plus the variable cMicroFrameBit defined in Section Split transaction execution state machine for interrupt to track the progress of an isochronous split transaction. The figure below illustrates the state machine for managing an siTD through an isochronous split transaction. Bold, dotted circles denote the state of the Active field in the Status field of an siTD. The bold, dotted arcs denote the transitions between these states. Solid circles denote the states of the split transaction state machine and the solid arcs denote the transitions between these states. Dotted arcs and boxes reference actions that take place either as a result of a transition or from being in a state.

<!-- image -->

## 55.10.4.3.4 Periodic isochronous - do start split

Isochronous split OUT transactions use only this state.

An siTD for a split-transaction isochronous IN is either initialized to this state, or the siTD transitions to this state from Do Complete Split when a case 2a (IN) or 2b scheduling boundary isochronous split-transaction completes.

Each time the host controller reaches an active siTD in this state, it checks the siTD.S-mask against cMicroFrameBit. If there is a 1 in the appropriate position, the siTD executes a start-split transaction. By definition, the host controller cannot reach an siTD at the wrong time. If the I/O field indicates an IN, then the start-split transaction includes only the extended token plus the FS token. You must initialize the siTD.Total Bytes To Transfer field to the number of bytes expected. This is usually the maximum packet size for the FS endpoint. The host controller exits this state when the start-split transaction is complete.

The remainder of this section is specific to an isochronous OUT endpoint (that is, the I/O field indicates an OUT). When the host controller executes a start-split transaction for an isochronous OUT, it includes a data payload in the start-split transaction. The memory buffer address for the data payload is constructed by concatenating siTD.Current Offset with the page pointer indicated by the page selector field (siTD.P). The value of 0 in this field selects Page 0 and a 1 selects Page 1. During the start-split for an OUT, if the data transfer crosses a page boundary during the transaction, the host controller must detect the page cross, update the siTD.P-bit from a 0 to a 1, and begin using the siTD.Page 1 with siTD.Current Offset as the memory address pointer. The field siTD.TP is used to annotate each start-split transaction with the indication of which part of the split-transaction data the current payload represents (ALL, BEGIN, MID, END). In all cases, the host controller simply uses the value in siTD.TP to mark the start-split with the correct TP code.

T-Count is always initialized to the number of start-splits for the current frame. TP is always initialized to the first required TP identifier. The scheduling boundary case (see Split transaction scheduling mechanisms for isochronous) is used to determine the initial value of TP. The initial cases are summarized in the following table.

Table 485. Initial conditions for OUT siTD's TP and T-Count fields

| Case   | T-Count   | TP    | Description                                                                                                                                                        |
|--------|-----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1, 2a  | =1        | ALL   | When the OUT data payload is less than (or equal to) 188 bytes, only one start-split is required to move the data. The one start-split must be marked with an ALL. |
| 1, 2a  | !=1       | BEGIN | When the OUT data payload is greater than 188 bytes, more than one start-split must be used to move the data. The initial start-split must be marked with a BEGIN. |

After each start-split transaction is complete, the host controller updates T-Count and TP appropriately so that the next start-split is correctly annotated.

The table below illustrates all of the TP and T-Count transitions, which must be accomplished by the host controller.

Table 486. TP/T-Count transition table

| TP    | T-Count next   | TP next   | Description                                                                                                                                                                     |
|-------|----------------|-----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ALL   | 0              | N/A       | Transition from ALL, to done.                                                                                                                                                   |
| BEGIN | 1              | END       | Transition from BEGIN to END. Occurs when T-Count starts at 2.                                                                                                                  |
| BEGIN | !=1            | MID       | Transition from BEGIN to MID. Occurs when T-Count starts at greater than 2.                                                                                                     |
| MID   | !=1            | MID       | TP stays at MID when T-Count is not equal to 1 (that is, greater than 1). This case can occur for any of the scheduling boundary cases where the T-Count starts greater than 3. |
| MID   | 1              | END       | Transition from MID to END. This case can occur for any of the scheduling boundary cases where the T-Count starts greater than 2.                                               |

The start-split transactions do not receive a handshake from the transaction translator, so the host controller always advances the transfer state in the siTD after the bus transaction is complete. To advance the transfer state, the following operations take place:

- The siTD.Total Bytes to Transfer and the siTD.Current Offset fields are adjusted to reflect the number of bytes transferred.
- The siTD.P (page selector) field is updated appropriately.
- The siTD.TP and siTD.T-Count fields are updated appropriately as defined in Table 486.

These fields are then written back to the memory-based siTD. The S-mask is fixed for the life of the current budget. As mentioned above, TP and T-Count are set specifically in each siTD to reflect the data to be sent from this siTD. Therefore, regardless of the value of S-mask, the actual number of start-split transactions depends on T-Count (or equivalently, Total Bytes to Transfer). The host controller must set the Active field to a 0 when it detects that all of the schedule data has been sent to the bus. The preferred method is to detect when T-Count decrements to 0 as a result of a start-split bus transaction. Equivalently, the host controller can detect when Total Bytes to Transfer decrements to 0. Either implementation must ensure that if the initial condition is Total Bytes to Transfer equal to 0 and T-Count is equal to a 1, then the host controller will issue a single start-split, with a zero-length data payload. You must ensure that TP, T-Count, and Total Bytes to Transfer are set to deliver the appropriate number of bus transactions from each siTD. An inconsistent combination will yield undefined behavior.

If the host experiences hold-offs that cause the host controller to skip start-split transactions for an OUT transfer, the state of the transfer will not progress appropriately. The transaction translator will observe protocol violations in the arrival of the start-splits for the OUT endpoint (that is, the TP annotation will be incorrect as received by the transaction translator).

A host controller implementation can optionally track the progress of an OUT split transaction by setting appropriate bits in the siTD.C-prog-mask as it executes each scheduled start-split. The checkPreviousBit() algorithm defined in Periodic isochronous -

Universal Serial Bus On-The-Go Controller (USBOTG)

do complete split can be used prior to executing each start-split to determine whether start-splits were skipped. The host controller can use this mechanism to detect missed microframes. It can then set the siTD's Active field to 0 and stop execution of this siTD. This saves on both memory and HS bus bandwidth.

## 55.10.4.3.5 Periodic isochronous - do complete split

The state is only used by a split-transaction isochronous IN endpoint.

This state is entered unconditionally from the Do Start State after a start-split transaction is executed for an IN endpoint. Each time the host controller visits an siTD in this state, it conducts a number of tests to determine whether it should execute a complete-split transaction. The individual tests are listed below. The sequence in which they are applied depends on which microframe the host controller is currently executing, meaning that the tests might not be applied until after the siTD referenced from the back pointer has been fetched.

- Test A. cMicroFrameBit is bit-wise ANDed with the siTD.C-mask field. A non-zero result indicates that you scheduled a complete-split for this endpoint, during this microframe. This test is always applied to a newly-fetched siTD that is in this state.
- Test B. The siTD.C-prog-mask bit vector is checked to determine whether the previous complete splits have been executed. The sequence in which this test is applied depends on the current value of USB\_n\_FRINDEX[2:0]. If USB\_n\_FRINDEX[2:0] is 0 or 1, it is not applied until the back pointer has been used; otherwise, it is applied immediately.

```
Algorithm Boolean CheckPreviousBit(siTD.C-prog-mask, siTD.C-mask, cMicroFrameBit) Begin Boolean rvalue = TRUE; previousBit = cMicroFrameBit rotate-right(1) -- Bit-wise anding previousBit with C-mask indicates whether there was an intent -- to send a complete split in the previous microframe. So, if the -- 'previous bit' is set in C-mask, check C-prog-mask to make sure it -- happened. if previousBit bitAND siTD.C-mask then if not (previousBit bitAND siTD.C-prog-mask) then rvalue = FALSE End if End if Return rvalue End Algorithm
```

If Test A is true and the value of USB\_n\_FRINDEX[2:0] is 0 or 1, then this is a case 2a or 2b scheduling boundary (see Figure 497).

If Test A and Test B evaluate to true, then the host controller executes a complete-split transaction using the transfer state of the current siTD. When the host controller commits to executing the complete-split transaction, it updates QH.C-prog-mask by performing a bit-OR with the cMicroFrameBit. The transfer state is advanced based on the completion status of the complete-split transaction. To advance the transfer state of an IN siTD, the host controller must:

- Decrement the number of bytes received from siTD.Total Bytes to Transfer,
- Adjust siTD.Current Offset by the number of bytes received,
- Adjust the siTD.P (page selector) field if the transfer caused the host controller to use the next page pointer, and
- Set any appropriate bits in the siTD.Status field, depending on the results of the transaction.

Note that if the host controller encounters a condition where siTD.Total Bytes To Transfer is zero, and it receives more data, the host controller must not write the additional data to memory. The siTD.Status.Active bit must be set to 0 and the siTD.Status.Babble Detected bit must be set to a 1. The fields siTD.Total Bytes to Transfer, siTD.Current Offset, and siTD.P (page selector) are not required to be updated as a result of this transaction attempt.

The host controller must accept (assuming good data packet CRC and sufficient room in the buffer as indicated by the value of siTD.Total Bytes To Transfer) MDATA and DATA0/1 data payloads up to and including 192 bytes. A host controller implementation may optionally set siTD.Status Active to 0 and siTD.Status.Babble Detected to 1 when it receives an MDATA or DATA0/1 with a data payload of more than 192 bytes. The following responses have these effects:

Universal Serial Bus On-The-Go Controller (USBOTG)

- ERR. FS transaction completed with a time-out or bad CRC and this is a reflection of that error to the host. The host controller sets the ERR bit in the siTD.Status field and sets the Active bit to 0.
- Transaction Error (XactErr). The complete-split transaction encounters a Timeout, CRC16 failure, and so on. The siTD.Status field XactErr field is set to a 1 and the complete-split transaction must be retried immediately. The host controller must use an internal error counter to count the number of retries as a counter field is not provided in the siTD data structure. The host controller will not retry more than two times. If the host controller exhausts the retries or the end of the microframe occurs, the Active bit is set to 0.
- DATAx (0 or 1). This response signals that the final data for the split transaction has arrived. The transfer state of the siTD is advanced and the Active bit is set to 0. If the Bytes To Transfer field has not decremented to 0 (including the reception of the data payload in the DATAx response), then less data than was expected, or allowed for, was actually received. This short packet event does not set USBSTS[UI] to 1. The host controller will not detect this condition.
- NYET (and Last). On each NYET response, the host controller also checks to determine whether this is the last completesplit for this split transaction. If it is the last complete-split (with a NYET response), then the transfer state of the siTD is not advanced (never received any data) and the Active bit is set to 0. No bits are set in the Status field because this is essentially a skipped transaction. The transaction translator must have responded to all the scheduled complete-splits with NYETs, meaning that the start-split issued by the host controller was not received. This result must be interpreted by system software as if the transaction was completely skipped. The test for whether this is the last complete split can be performed by XORing C-mask with C-prog-mask. A zero result indicates that all complete-splits have been executed.
- MDATA (and Last). See the above description for testing for Last. This can only occur when there is an error condition. Either there has been a babble condition on the FS link, which delayed the completion of the FS transaction, or you set up the S-mask and/or C-masks incorrectly. The host controller must set the XactErr bit to 1 and the Active bit is set to 0.
- NYET (and not Last). See the above description for testing for Last. The complete-split transaction received a NYET response from the transaction translator. Do not update any transfer state (except for C-prog-mask), and stay in this state.
- MDATA (and not Last). The transaction translator responds with an MDATA when it has partial data for the split transaction. For example, the FS transaction data payload spans from microframe X to X+1, and during microframe X the transaction translator will respond with an MDATA and the data accumulated up to the end of microframe X. The host controller advances the transfer state to reflect the number of bytes received.

If Test A succeeds, but Test B fails, it means that one or more of the complete-splits have been skipped. The host controller sets the Missed Microframe status bit and sets the Active bit to 0.

## 55.10.4.3.6 Complete-split for scheduling boundary cases 2a, 2b

Boundary cases 2a and 2b (INs only) (see Figure 497) require that the host controller use the transaction state context of the previous siTD to finish the split transaction. The table below enumerates the transaction state fields.

Table 487. Summary of siTD Split Transaction state

| Buffer state                                                      | Status                       | Execution progress   |
|-------------------------------------------------------------------|------------------------------|----------------------|
| Total Bytes to Transfer P (page select) Current Offset TP T-Count | All bits in the status field | C-prog-mask          |

## NOTE

TP and T-Count are used only for Host to Device (OUT) endpoints.

If you have budgeted the schedule of this data stream with a frame wrap case, then it must initialize the siTD.Back Pointer field to reference a valid siTD and will have the siTD.Back Pointer.T-bit in the siTD.Back Pointer field cleared to 0. Otherwise, you

Universal Serial Bus On-The-Go Controller (USBOTG)

must set the siTD.Back Pointer.T-bit in the siTD.Back Pointer field to 1. The host controller's rules for interpreting when to use the siTD.Back Pointer field are listed below. These rules apply only when the value of siTD's Active field is 1 and the SplitXState is Do Complete Split:

- When the cMicroFrameBit is a 1h and the siTDX.Back Pointer.T-bit is 0
- If the cMicroFrameBit is a 2h and the value of siTDX.S-mask[0] is 0

When either of the above conditions apply, then the host controller must use the transaction state from siTD X-1 .

To access siTDX-1, the host controller reads on-chip the siTD referenced from siTD X.Back Pointer.

The host controller must save the entire state from siTD X when processing siTDX-1. This is to accommodate for Case 2b processing. The host controller must not recursively walk the list of siTD.Back Pointers.

If siTD X-1 is active (the Active field is 1 and SplitXStat is Do Complete Split), then both Test A and Test B are applied as described above. If these criteria to execute a complete-split are met, the host controller executes the complete split and evaluates the results as described above. The transaction state (see Table 487) of siTD X-1 is appropriately advanced based on the results and written back to memory. If the resultant state of siTD X-1 's Active field is 1, then the host controller returns to the context of siTD X, and follows its next pointer to the next schedule item. No updates to siTD X are necessary.

If siTD X-1 is active (the Active field is 1 and SplitXStat is Do Start Split), then the host controller must clear the Active field to 0, set the Missed Microframe status field to 1, and write the resultant status back to memory.

If siTD X-1 'sActive field is 0 (because it was 0 when the host controller first visited siTD X-1 via siTD X's back pointer, it transitioned to 0 as a result of a detected error, or the results of siTD X-1 's complete-split transaction transitioned it to 0), then the host controller returns to the context of siTD X and transitions its SplitXState to Do Start Split. The host controller then determines whether the Case 2b start split boundary condition exists (that is, if cMicroframeBit is a 1b and siTD X.S-mask[0] is a 1b). If this criterion is met, the host controller immediately executes a start-split transaction and appropriately advances the transaction state of siTD X, then follows siTD X.Next Pointer to the next schedule item. If the criterion is not met, the host controller simply follows siTD X.Next Pointer to the next schedule item. Note that in the case of a 2b boundary case, the split-transaction of siTD X-1 will have its Active field cleared to 0 when the host controller returns to the context of siTD X. Also, note that you must not initialize an siTD with C-mask bits 0 and 1 set to 1 and an S-mask with bit 0 set to 1. This scheduling combination is not supported and the resulting behavior of the host controller is undefined.

## 55.11 Deviations from the EHCI specifications

The Host mode operation of the USB host module is mostly EHCI-compatible, with a few minor differences. For the most part, the modules conform to the data structures and operations described in Section 3, "Data structures," and Section 4, "Operational model," in the EHCI specification. The particulars of the deviations occur in the following areas:

- Embedded transaction translator - Allows direct attachment of HS, FS and LS devices in Host mode without the need for a companion controller.
- Embedded design interface - The module does not have a PCI Interface and therefore the PCI configuration registers described in the EHCI specification are not applicable.

## 55.11.1 Embedded transaction translator function

The USB Host mode supports directly-connected HS, FS, and LS devices without requiring a companion controller by including the capabilities of a USB 2.0 HS hub transaction translator. Although there is no separate transaction translator block in the system, the transaction translator function normally associated with a HS hub is implemented within the DMA and protocol engine blocks. The embedded transaction translator function is an extension to the EHCI interface, but makes use of the standard data structures and operational models in the EHCI specification to support FS and LS devices.

## 55.11.1.1 Capability registers

These additions to the capability registers support the embedded Transaction Translator function:

- N\_TT added to HCSPARAMS - Host controller structural parameters
- N\_PTT added to HCSPARAMS - Host controller structural parameters

Universal Serial Bus On-The-Go Controller (USBOTG)

See Host Controller Structural Parameters (HCSPARAMS) for usage information.

## 55.11.1.2 Operational registers

Operational registers are defined in the Universal Serial Bus Specification, Revision 2.0, in the section "Host Controller Operational Registers".

The following additions to the operational registers provide support for the embedded TT:

- Addition of a 2-bit port speed (PSPD) field to the PORTSCn register

## 55.11.1.3 Discovery

In a standard EHCI controller design, the EHCI host controller driver detects an FS or LS device by noting if the port enable field is set after the port reset operation. In a standard EHCI controller implementation, the port enable is set only after the port reset operation and when the host and device negotiate a HS connection (chirp completes successfully).

The module always sets the port enable field after the port reset operation regardless of the host device chirp result, and the resulting port speed is indicated by the PORTSCn[PSPD] field. Therefore, the standard EHCI host controller driver requires an alteration to manage directly-connected FS and LS devices or hubs. The change is a fundamental one that is summarized in the next table.

Table 488. Functional differences between EHCI and EHCI with embedded TT

| Standard EHCI                                                                                                                                                                                    | EHCI with embedded transaction translator                                                                                                                                                                                                                                                               |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| After the port enable field is set following a connection and reset sequence, the device/hub is assumed to be HS.                                                                                | After the port enable field is set following a connection and reset sequence, the device/hub speed is noted from PORTSCn.                                                                                                                                                                               |
| FS and LS devices are assumed to be downstream from an HS hub. Therefore, all port- level control performs through the hub class to the nearest hub.                                             | FS and LS devices can be downstream from an HShubor directly attached. When the FS or LS device is downstream from an HS hub, port-level control acts using the hub class through the nearest hub. When an FS or LS device is directly attached, then port-level control is accomplished using PORTSCn. |
| FS and LS devices are assumed to be downstream from a HShubwith HubAddr equal to X[whereHubAddr>0andHubAddristheaddress of the hub where the bus transitionsfromHStoFS or LS (split target hub)] | FS and LS devices can be downstream from an HS hub with HubAddr equal to X [HubAddr > 0] or directly attached [where HubAddr equals 0 and HubAddr is the address of the root hub where the bus transitions from HSto FS or LS (split target hub is the root hub)]                                       |

## 55.11.1.4 Data structures

The same data structures used for FS or LS transactions though a HS hub are also used for transactions through the root hub. It is demonstrated here how the hub address and endpoint speed fields must be set for directly-attached FS or LS devices and hubs:

- QH (for direct-attach FS or LS) - asynchronous (bulk/control endpoints) periodic (interrupt)
- Hub address equals 0
- Transactions to direct-attached device/hub.
- QH.EPS equals port speed
- Transactions to a device downstream from direct-attached FS hub.
- QH.EPS equals downstream device speed

## NOTE

When QH.EPS equals 01 (LS) and PORTSCn[PSPD] equals 00 (FS), a LS-pre-PID is sent before transmitting LS traffic.

Maximum packet size must equal 64 or less to prevent undefined behavior.

- siTD (for direct-attach FS) - Periodic (ISO endpoint)
- All FS ISO transactions:
- Hub address equals 0
- siTD.EPS equals 00 (FS)

Maximum packet size must equal 1023 or less to prevent undefined behavior.

## 55.11.1.5 Operational model

The operational models are well-defined for the behavior of the transaction translator (see the USB 2.0 specification) and for the EHCI controller moving packets between system memory and a USB-HS hub. Because the embedded transaction translator exists within the USB host controller, no physical bus exists between the EHCI host controller driver and the USB FS or LS bus. These sections briefly discuss the operational model for how the EHCI and transaction translator operational models combine without the physical bus between them. The following sections assume that you are familiar with the EHCI and USB 2.0 transaction translator operational models.

## 55.11.1.5.1 Microframe pipeline

The EHCI operational model uses the concept of H-frames and B-frames to describe the pipeline between the host (H) and the bus (B). The embedded transaction translator uses the same pipeline algorithms specified in the USB 2.0 specification for a hub-based transaction translator.

All periodic transfers always begin at B-frame 0 (after SOF) and continue until the stored periodic transfers are complete. As an example of the microframe pipeline implemented in the embedded transaction translator, all periodic transfers that are tagged in EHCI to execute in H-frame 0 are ready to execute on the bus in B-frame 0.

When programming the S-mask and C-masks in the EHCI data structures to schedule periodic transfers for the embedded transaction translator, the EHCI host controller driver must follow the same rules specified in EHCI for programming the S-mask and C-mask for downstream hub-based transaction translators.

After periodic transfers are exhausted, any stored asynchronous transfer is moved. Asynchronous transfers are opportunistic because they execute when possible and their operation is not tied to H-frame and B-frame boundaries with the exception that an asynchronous transfer cannot babble through the SOF (start of B-frame 0.)

## 55.11.1.5.2 Split-state machines

The start and complete-split operational model differs from EHCI slightly because there is no bus medium between the EHCI controller and the embedded transaction translator. Where a start or complete-split operation would occur by requesting the split to the HS hub, the start/complete-split operation is a simple internal operation to the embedded transaction translator. The next table summarizes the conditions where handshakes are emulated from internal states instead of actual handshakes to HS-split bus traffic.

Table 489. Emulated handshakes

| Condition                                      | Emulated TT response   |
|------------------------------------------------|------------------------|
| Start-Split: All asynchronous buffers are full | NAK                    |
| Start-Split: All periodic buffers are full     | ERR                    |

Table continues on the next page...

Universal Serial Bus On-The-Go Controller (USBOTG)

## Table 489. Emulated handshakes (continued)

| Condition                                                  | Emulated TT response                  |
|------------------------------------------------------------|---------------------------------------|
| Start-Split: Success for start of asynchronous transaction | ACK                                   |
| Start-Split: Start periodic transaction                    | No handshake (Okay)                   |
| Complete-Split: Failed to find transaction in queue        | Bus time-out                          |
| Complete-Split: Transaction in queue is busy               | NYET                                  |
| Complete-Split: Transaction in queue is complete           | Actual handshake from FS or LS device |

## 55.11.1.5.3 Asynchronous transaction scheduling and buffer management

The following USB 2.0 specification items are implemented in the embedded Transaction Translator:

- USB 2.0 - 11.17.3
- Sequencing is provided and a packet length estimator ensures no FS or LS packet babbles into SOF time.
- USB 2.0 - 11.17.4
- Transaction tracking for two data pipes.
- USB 2.0 - 11.17.5
- Clear\_TT\_Buffer capability

## 55.11.1.5.4 Periodic transaction scheduling and buffer management

The following USB 2.0 specification items are implemented in the embedded transaction translator:

- USB 2.0 - 11.18.6.[1-2]
- Abort of pending start-splits
- EOF (and not started in microframes 6)
- Idle for more than four microframes
- Abort of pending complete-splits
- EOF
- Idle for more than four microframes
- USB 2.0 - 11.18.[7-8]
- Transaction tracking for up to four data pipes
- No more than four periodic transactions (interrupt/isochronous) can be scheduled through the embedded TT per frame.
- Complete-split transaction searching

## NOTE

There is no data schedule mechanism for these transactions other than the microframe pipeline. The embedded TT assumes the number of packets scheduled in a frame does not exceed the frame duration (1 ms) or else undefined behavior may result.

## 55.11.1.5.5 Multiple transaction translators

The maximum number of embedded transaction translators currently supported is one, as indicated by HCSPARAMS[N\_TT]. See Host Controller Structural Parameters (HCSPARAMS) for more information.

## 55.11.2 Non-zero fields in the register file

For the reserved fields and reserved addresses in the capability registers, you need to adhere to these steps:

- Write operations to all EHCI reserved fields in the operation registers must always write a value of 0.
- Read operations by the module must properly mask EHCI reserved fields.

## 55.11.3 SOF interrupt

The SOF interrupt is a free-running 125 µs or 1 ms interrupt for Host mode. EHCI does not specify this interrupt, but it has been added for convenience and as a potential software time base. The free running interrupt is shared with the Device mode start-of-frame interrupt. See USB Status (USBSTS) and Interrupt Enable (USBINTR) for more information.

## 55.11.4 Embedded design

This is an embedded USB host controller as defined by the EHCI specification; therefore, it does not implement the PCI configuration registers.

## 55.11.4.1 Frame adjust register

Given that the optional PCI configuration registers are not included in this implementation, there are no corresponding bit-level timing adjustments like those provided by the frame adjust register in the PCI configuration registers. Starts of microframes are timed precisely to 125 µs using the transceiver clock as a reference clock or a 60 MHz transceiver clock for 8-bit physical interfaces and FS serial interfaces.

## 55.11.5 Miscellaneous variations from EHCI

## 55.11.5.1 Programmable physical interface behavior

The modules support multiple physical interfaces that can operate in different modes when the module is configured with the software-programmable physical interface modes. The control bits for selecting the PHY operating mode are added to PORTSCn, providing a capability not defined by the EHCI specification.

## 55.11.5.2 Discovery

## 55.11.5.2.1 Port reset

The port connect methods specified by EHCI require setting PORTSCn[PR] to 1 for a duration of 10 ms. Due to the complexity required for supporting the attachment of devices that are not HS, a counter is present in the design that can count the 10 ms reset pulse to alleviate the requirement for you to measure this duration. Therefore, the basic connection is summarized as:

- Port change interrupt - Port connect change occurs to notify the host controller driver that a device has attached.
- You write 1 to PORTSCn[PR] to reset the device.
- You write 0 to PORTSCn[PR] after 10 ms.
- This step, necessary in a standard EHCI design, may be omitted with this implementation. Should the EHCI host controller driver attempt to write a 0 to the reset field when a reset is in progress, the write is ignored and the reset continues until completion.
- Port change interrupt - Port enable change occurs to notify the host controller that the device is now operational and at this point the port speed is determined.

Universal Serial Bus On-The-Go Controller (USBOTG)

## 55.11.5.2.2 Port speed detection

After the port change interrupt indicates that a port is enabled, the EHCI stack must determine the port speed. Unlike the EHCI implementation, which reassigns the port owner for any device that does not connect at HS, this host controller supports direct-attach of non-HS devices. Therefore, the following differences are important regarding port speed detection:

- Port owner hand-off is not implemented. Therefore, PORTSCn[PO] is read-only and always reads 0.
- A 2-bit port speed indicator field has been added to PORTSCn to provide the current operating speed of the port to the host controller driver.
- A 1-bit HS indicator bit has been added to PORTSCn to signify that the port is in HS versus FS or LS.
- This information is redundant with the 2-bit port speed indicator field above.

## 55.11.5.3 Port Test mode

Port Test Control mode behaves fully as described in EHCI since the release of revision 3.2.1. In earlier product revisions, the test packet mode was not EHCI compatible. An alternate host controller driver procedure is no longer necessary or supported.

Universal Serial Bus On-The-Go Controller (USBOTG)

## Chapter 56 FlexRay Communication Controller (FlexRay)

## 56.1 Overview

This module implements the FlexRay Communications System Protocol Specification, Version 2.1 Rev A.

To distinguish between the FlexRay protocol and the FlexRay module on this chip, this chapter also uses the term CC to refer to the module.

CC has three main components:

- CHI
- PE
- CDC

The protocol engine has two transmitter units, TxA and TxB, and two receiver units, RxA and RxB, for sending and receiving frames through the two FlexRay channels. TCU is responsible for maintaining global clock synchronization to the FlexRay network. SEQ controls the overall PE activity.

CHI provides host access to the module's configuration, control, and status registers, as well as to the MB configuration, control, and status registers.

CDC implements signal crossing between the CHI and PE clock domains, to allow for asynchronous PE and CHI clock domains.

CC stores the frame header and payload data of frames received or of frames to be transmitted in the FlexRay memory area. The application accesses the FlexRay memory area to retrieve and provide the frames for CC to process. In addition to the frame header and payload data, CC stores the synchronization frame related tables in the FlexRay memory area for application processing.

The FlexRay memory area is located in the MCU system memory. CC has access to the FlexRay memory area via its BMIF. The host provides the start address of the FlexRay memory area within the system memory by programming System Memory Base Address High (SYMBADHR) and System Memory Base Address Low (SYMBADLR). the System Memory Base Address Register (SYMBADHR and SYMBADLR). All offsets related to the FlexRay memory area are stored in offset registers. The physical address pointer into the FlexRay memory area is calculated using the offset values and the FlexRay memory base address.

CC does not provide a memory protection scheme for the FlexRay memory area.

## 56.1.1 References

The FlexRay specifications have been developed for automotive applications. These specifications have not been developed or tested for non-automotive applications.

- FlexRay Communications System Protocol Specification, Version 2.1 Rev A

See this document for all of the FlexRay-related information including the configuration parameters and the allowed parameter ranges.

- FlexRay Communications System Electrical Physical Layer Specification, Version 3.0

## 56.1.2 Block diagram

The following figure represents a block diagram of CC and its surrounding modules.

FlexRay Communication Controller (FlexRay)

<!-- image -->

## 56.1.3 Features

- Implements a protocol that complies with the protocol specification in References
- Implements a bus driver interface that complies with the physical layer specification in References
- Single-channel support, in which FlexRay port A can connect to physical FlexRay channel A or B
- Dual-channel support
- Supports FlexRay bus data rates of:
- 10 Mbit/s
- 8 Mbit/s
- 5 Mbit/s
- 2.5 Mbit/s
- Supports 256 configurable MBs with individual:
- Frame ID filtering
- Channel ID filtering
- Cycle counter filtering
- MB header, status, and payload data stored in dedicated FlexRay memory area
- Allows for flexible and efficient MB implementation
- Ensures consistent data access via buffer locking scheme
- Allows an application to lock multiple buffers simultaneously
- Size of MB payload data section configurable from 0 up to 254 bytes
- Two independent MB segments with configurable size of payload data section:
- Each segment's payload data section has a configurable size
- Each segment can contain MBs assigned to the static segment and MBs assigned to the dynamic segment simultaneously
- Zero padding for transmit MBs in the static segment, applied when the frame payload length exceeds the size of the MB data section

- Transmit MBs configurable with state/event semantics
- MBs that can be configured as receive and transmit MBs
- Supports individual MB reconfiguration, allowing you to:
- Disable individual MBs safely
- Reconfigure disabled MBs
- Two independent receive FIFOs
- One receive FIFO per channel
- Up to 255 entries for each FIFO
- Global frame ID filtering, based on both value/mask filters and range filters
- Global channel ID filtering
- Global message ID filtering for the dynamic segment
- Four configurable slot error counters
- Four dedicated slot status indicators, used to observe slots without using receive MBs
- Measured value indicators for the clock synchronization; the internal synchronization frame ID and synchronization frame measurement tables can be copied into the FlexRay memory area
- Supports fractional MTs for clock correction
- Maskable interrupt sources provided via individual and combined interrupt lines
- One absolute timer
- One timer that can be configured as absolute or relative
- Error correction and error detection (SECDED ECC) for PE data RAM
- Error detection (SECDED ECC) for CHI LRAM

## 56.2 Functional description

This section provides a detailed description of the implemented CC functionality.

## 56.2.1 Modes of operation

This section describes the basic CC operational power modes.

## 56.2.1.1 Disabled mode

CC enters Disabled mode during hard reset or when the host writes 0 to MCR[MEN]. The host can write 0 to this field only when the module is in the POC:default config mode. You can check whether CC is in Disabled mode by reading MCR[MEN].

No communication is performed on the FlexRay bus.

All registers with the write access conditions Any Time and Disabled Mode can be accessed for writing as stated in Register conventions and access.

You configure CC by accessing the configuration fields in Module Configuration (MCR) as described in CC initialization after a system reset.

## 56.2.1.1.1 Leave Disabled mode

CC leaves Disabled mode and enters Normal mode when you write 1 to MCR[MEN].

After you enable CC, you can disable it only during POC:default config.

FlexRay Communication Controller (FlexRay)

## 56.2.1.2 Normal mode

In this mode, CC is fully functional. CC indicates that it is in Normal mode by writing 1 to MCR[MEN].

## 56.2.1.2.1 Enter Normal mode

CC enters this mode when you request CC to leave Disabled mode. If CC enters Normal mode by leaving Disabled mode, you must perform the protocol initialization described in Protocol initialization to achieve full FlexRay functionality.

Depending on the values of the SCM, CHA, and CHB fields in Module Configuration (MCR), the corresponding FlexRay bus driver ports are enabled and driven.

## 56.2.2 Clocking

This section describes clocking requirements of the module.

## 56.2.2.1 PE clocking

PE is clocked by an internal crystal oscillator, a crystal or CMOS compatible clock must be connected to the oscillator pins. The crystal or clock must fulfill the requirements given by the FlexRay Communications System Protocol Specification, Version2.1 Rev A.

## 56.2.3 MB concept

The CC uses MBs-data structures that store frame data, configuration, control, and status data. Each MB consists of two parts-the MB control data and the physical MB. The MB control data is located in dedicated registers. The structure of the MB control data depends on the MB type and is described in MB types. The physical MB is located in the FlexRay memory area and is described in the next section.

## 56.2.4 Physical MB

All FlexRay messages and related frame and slot status information of received frames and of frames to be transmitted to the FlexRay bus are stored in data structures called physical MBs. The physical MBs are located in the FlexRay memory area. The following figure shows the structure of a physical MB.

<!-- image -->

A physical MB consists of two fields-the MB header field and the MB data field. The MB header field contains the frame header and the slot status. The MB data field contains the frame data.

The connection between the two fields is established by the data field offset.

## 56.2.4.1 MB header field

The MB header field is a contiguous region in the FlexRay memory area and occupies eight bytes. It contains the frame header and the slot status. Its structure is shown in Figure 501.

The physical start address SADR\_MBHF of the MB header field must be 16-bit aligned.

FlexRay Communication Controller (FlexRay)

## 56.2.4.1.1 Frame header

The frame header occupies the first six bytes in the MB header field. It contains all information related to the FlexRay frame header, according to FlexRay Communications System Protocol Specification, Version 2.1 Rev A.

A detailed description of the usage and the content of the frame header is provided in Frame header description.

## 56.2.4.1.2 Slot status

The slot status occupies the last two bytes of the MB header field. It provides the slot and frame status related information according to FlexRay Communications System Protocol Specification, Version 2.1 Rev A.

A detailed description of the content and usage of the slot status is provided in Slot status description.

## 56.2.4.2 MB data field

The MB data field is a contiguous area of 2-byte entities. This field contains all or part of the frame payload data of the frame to be transmitted or received on the FlexRay bus. The minimum length of this field depends on the specific MB configuration and is specified in the MB descriptions given in the following section.

## 56.2.5 MB types

CC provides three different MB types:

- Individual MBs
- Receive shadow buffers
- Receive FIFO buffers

For each MB type, the structure of the physical MB is identical. The MB types differ only in the structure and content of MB control data, which control the related physical MB. The MB control data is described in the following sections.

## 56.2.5.1 Individual MBs

The individual MBs are used for all types of frame transmission and for dedicated frame reception based on individual filter settings for each MB. CC supports three types of individual MBs, which are described in Individual MB functional description.

Each individual MB consists of two parts:

- The physical MB, located in the FlexRay memory area
- The MB control data, located in dedicated registers

This figure shows the structure of an individual MB.

FlexRay Communication Controller (FlexRay)

Figure 502. Individual MB structure

<!-- image -->

Each MB has an MB number n assigned. This number determines the set of MB control registers associated with this individual MB. The following registers control the individual MB with number n:

- MB Configuration Control Status (MBCCSR0 - MBCCSR255)
- MB Cycle Counter Filter (MBCCFR0 - MBCCFR255)
- MB FID (MBFIDR0 - MBFIDR255)
- MB Index (MBIDXR0 - MBIDXR255)

The MBIDX field in MB Index (MBIDXR0 - MBIDXR255) establishes the connection between the MB control registers and the physical MB. The start address SADR\_MBHF of the related MB header field in the FlexRay memory area is determined according to Equation 35.

SADR\_MBHF = (MBIDXRn[MBIDX] × 8) + SMBA

## Equation 35. Equation for SADR\_MBHF

The data field belonging to a particular physical MB is characterized by the data field offset. For each physical MB with MBIDX i, MBDORi contains the offset of the corresponding MB data field with respect to the CC FlexRay memory area base address as provided by the SMBA field in the System Memory Base Address Register (SYMBADR).

The data field offset is used to determine the start address SADR\_MBDF of the corresponding MB data field in the FlexRay memory area according to Equation 36.

SADR\_MBDF = [DataFieldOffset] + SMBA

## Equation 36. Equation for SADR\_MBDF

MBDORn are stored in the module internal memory LRAM. See CHI LRAM initialization for the setup of the data field offset values.

## 56.2.5.1.1 Individual MB segments

The set of individual MBs can be split in two MB segments using MB Segment Size and Utilization (MBSSUTR). All individual MBs with a MB number n ≤ MBSSUTR[LAST\_MB\_SEG1] belong to the first MB segment. All individual MBs with a MB number n &gt; MBSSUTR[LAST\_MB\_SEG1] belong to the second MB segment. The following rules apply to the length of the MB data field:

## Equation 37. Equation for SADR\_MBHF

The length required for the MB data field depends on the MB segment that the receive shadow buffer is assigned to. For the receive shadow buffers assigned to the first MB segment, the length must be the same as for the individual MBs assigned to the first MB segment. For the receive shadow buffers assigned to the second MB segment, the length must be the same as for the individual MBs assigned to the second MB segment. The receive shadow buffer assignment is described in Receive Shadow Buffer Index (RSBIR).

FlexRay Communication Controller (FlexRay)

- All physical MBs associated with individual MBs that belong to the same MB segment must have MB data fields of the same length.
- The minimum length of the MB data field for individual MBs in the first MB segment is 2 × MBDSR[MBSEG1DS] bytes.
- The minimum length of the MB data field for individual MBs in the second segment is 2 × MBDSR[MBSEG2DS] bytes.

## 56.2.5.2 Receive shadow buffers

The receive shadow buffers are required for the frame reception process for individual MBs. CC provides four receive shadow buffers, one receive shadow buffer per channel and per MB segment.

Each receive shadow buffer consists of two parts-the physical MB located in the FlexRay memory area and the receive shadow buffer control registers located in dedicated registers. The structure of a receive shadow buffer is shown in the figure below. The four internal shadow buffer control registers can be accessed by Receive Shadow Buffer Index (RSBIR).

<!-- image -->

RSBIR[RSBIDX] establishes the connection between the receive shadow buffer control register and the physical MB for the selected receive shadow buffer. The start address SADR\_MBHF of the related MB header field in the FlexRay memory area is determined according to this equation:

SADR\_MBHF = (RSBIR[RSBIDX] × 8) + SMBA

## 56.2.5.3 Receive FIFO

The receive FIFO implements a frame reception system based on the FIFO concept. CC provides two independent receive FIFOs, one per channel.

A receive FIFO consists of a set of physical MBs in the FlexRay memory area and a set of receive FIFO control registers located in dedicated registers. The following figure shows the structure of a receive FIFO.

<!-- image -->

The following registers establish the connection between the receive FIFO control registers and the set of physical MBs:

- Receive FIFO Start Index (RFSIR)
- Receive FIFO Depth And Size (RFDSR)
- Receive FIFO A Read Index (RFARIR)
- Receive FIFO B Read Index (RFBRIR)

The system memory base address SMBA valid for the receive FIFOs is defined by the system memory base address register that MCR[FAM] selects.

Equation 38 determines the start byte address SADR\_MBHF[1] of the first MB header field that belongs to the receive FIFO.

FlexRay Communication Controller (FlexRay)

## Equation 38. Equation for SADR\_MBHF[1]

Equation 39 determines the start byte address SADR\_MBHF[n] of the last MB header field that belongs to the receive FIFO in the FlexRay memory area.

SADR\_MBHF[  ] = (8 × (RFSIR[SIDX] + RFDSR[FIFO\_DEPTH])) + SMBA n

## Equation 39. Equation for SADR\_MBHF[n]

Receive FIFO A Read Index (RFARIR) and Receive FIFO B Read Index (RFBRIR) provide:

- The required information to access the current entry of the FIFO
- The index of the physical MB belonging to the current entry

You must calculate the data field offset belonging to the current FIFO entry RF\_DFO[X] using the current read index i according to Equation 40.

RF\_DFO[   ] = FR\_RFSDOR[   ] + (FR\_RFDSR[   ][ENTRY\_SIZE] × 2) ×   - FR\_RFSIR[   ][SID]) X X X X i

## Equation 40. Calculating data field offset

The current read index loops up starting at the number given in the RD[A/B]RDIDX register for the required number of entries.

See FIFO update for details about updating the FIFO read pointer.

All MB header fields assigned to a receive FIFO are within a contiguous region defined by RFSIR[SIDX] and RFDSR[FIFO\_DEPTH].

The data sections of all FIFO entries within on receive FIFO are of the same length defined by RFDSR[FIFO\_SIZE].

You must calculate the actual values of the data field offsets RF\_DFO[A/B] according to Equation 40. They are not stored in a register.

## 56.2.5.4 MB configuration and control data

This section describes the configuration and control data for each MB type.

## 56.2.5.4.1 Individual MB configuration data

Before an individual MB can be used for transmission or reception, you must configure it. There is a set of common configuration parameters that applies to all individual MBs and a set of configuration parameters that applies to each MB individually.

## 56.2.5.4.1.1 Common configuration data

The set of common configuration data for individual MB is located in the following registers:

- MB Data Size (MBDSR): The MBSEG2DS and MBSEG1DS fields define the minimum length of the MB data field with respect to the MB segment.
- MB Segment Size and Utilization (MBSSUTR): The LAST\_MB\_SEG1 and LAST\_MB\_UTIL fields define the segmentation of the individual MBs and the number of individual MBs that are used. For more details, see Individual MB segments.

## 56.2.5.4.1.2 Specific configuration data

The set of MB-specific configuration data for individual MBs is located in the following registers:

- MB Configuration Control Status (MBCCSR0 - MBCCSR255): The MTD field configures the MB type.
- MB Cycle Counter Filter (MBCCFR0 - MBCCFR255):

SADR\_MBHF[1] = (8 × RFSIR[SIDX]) + SMBA

FlexRay Communication Controller (FlexRay)

FlexRay Communication Controller (FlexRay)

- The MTM, CHA, and CHB fields configure the transmission mode and the channel assignment.
- The CCFE, CCFMSK, and CCFVAL fields configure the cycle counter filter.
- MB FID (MBFIDR0 - MBFIDR255): For a transmit MB, the FID field determines the slot in which the message in this MB is transmitted.
- MB Index (MBIDXR0 - MBIDXR255): The MBIDX field provides the index of the MB header field of the physical MB that is currently associated with this MB.

## 56.2.5.5 Individual MB control data

During normal operation, each individual MB can be controlled by the control and trigger fields CMT, LCKT, EDT, and MBIE in MB Configuration Control Status (MBCCSR0 - MBCCSR255).

## 56.2.5.6 Receive shadow buffer configuration data

Before frame reception into the individual MB can be performed, you must configure the receive shadow buffers. Receive Shadow Buffer Index (RSBIR) provides the configuration data. For each receive shadow buffer, the application provides the MB header index. When the protocol is in the "POC:normal active" or "POC:normal passive" state, the receive shadow buffers are under full CC control.

## 56.2.5.7 Receive FIFO control and configuration data

This section describes the configuration and control data for the two receive FIFOs.

## 56.2.5.7.1 Receive FIFO configuration data

CC provides two functional independent receive FIFOs, one per channel. The FIFOs have a common subset of configuration data in Receive FIFO Periodic Timer (RFPTR). Each FIFO has its own set of configuration data that is located in the following registers:

- Receive FIFO Watermark And Selection (RFWMSR)
- Receive FIFO Start Index (RFSIR)
- Receive FIFO Start Data Offset (RFSDOR)
- Receive FIFO Depth And Size (RFDSR)
- Receive FIFO Message ID Acceptance Filter Value (RFMIDAFVR)
- Receive FIFO Message ID Acceptance Filter Mask (RFMIDAFMR)
- Receive FIFO Frame ID Rejection Filter Value (RFFIDRFVR)
- Receive FIFO Frame ID Rejection Filter Mask (RFFIDRFMR)
- Receive FIFO Range Filter Configuration (RFRFCFR)

## 56.2.5.7.2 Receive FIFO control data

You can access the FIFOs at any time using the control fields in the following registers:

- Global Interrupt Flag And Enable (GIFER)
- Receive FIFO Fill Level and Pop Count (RFFLPCR)

## 56.2.5.7.3 Receive FIFO status data

The current status of the receive FIFO is provided in the following registers:

- Global Interrupt Flag And Enable (GIFER)
- Receive FIFO A Read Index (RFARIR)
- Receive FIFO B Read Index (RFBRIR)

- Receive FIFO Fill Level and Pop Count (RFFLPCR)

## 56.2.6 FlexRay memory area layout

CC supports a wide range of possible layouts for the FlexRay memory area. You can select two basic layout modes using MCR[FAM].

## 56.2.6.1 FlexRay memory area layout when MCR[FAM] = 0

The figure provided below shows an example layout for the FIFO address mode associated with MCR[FAM] = 0. In this mode, the following set of rules applies to the layout of the FlexRay memory area:

- It is one contiguous region.
- Its size is a maximum of 64 KB.
- It starts at a 16-byte boundary.

<!-- image -->

The FlexRay memory area contains three areas:

- MB header area
- MB data area
- Sync frame table area

## 56.2.6.2 FlexRay memory area layout when MCR[FAM] = 1

The following figure shows an example layout for the FIFO address mode associated with MCR[FAM] = 1. The following set of rules applies to the layout of the FlexRay memory area:

- The FlexRay memory area consists of two contiguous regions.
- The size of each region is a maximum of 64 KB.
- Each region starts on a 16-byte boundary.

FlexRay Communication Controller (FlexRay)

<!-- image -->

## 56.2.6.3 MB header area when MCR[FAM] = 0

The MB header area contains all MB header fields of the physical MBs for all MB types. The following rules apply to the MB header fields for the three type of MBs.

- The start byte address SADR\_MBHF of each MB header field for individual MBs and receive shadow buffers must fulfill Equation 41:

SADR\_MBHF = (i × 8) + SYMBADR[SMBA] ; (0 ≤ i ≤ 259)

Equation 41. Equation for SADR\_MBHF of individual MBs and receive shadow buffers

- The start byte address SADR\_MBHF of each MB header field for the FIFO must fulfill Equation 42:

SADR\_MBHF = (i × 8) + SYMBADR[SMBA] ; (0 ≤ i ≤ 1023)

Equation 42. Equation for SADR\_MBHF of the FIFO

- The MB header fields for each FIFO must be a contiguous area.

## 56.2.6.4 MB header area with MCR[FAM] = 1

The MB header area contains all MB header fields of the physical MBs for the individual MBs and receiver shadow buffers.

For the two type of MBs, the start address SADR\_MBHF of each MB header field for individual MBs and receive shadow buffers must fulfill Equation 43:

SADR\_MBHF = (i × 8) + SYMBADR[SMBA] ; (0 ≤ i ≤ 259)

## Equation 43. Equation for SADR\_MBHF

## 56.2.6.5 FIFO MB header area with MCR[FAM] = 1

The FIFO MB header area contains all MB header fields of the physical MBs for the FIFO. The following rules apply to the FIFO MB header fields:

- The start byte address SADR\_MBHF of each MB header field for the FIFO must fulfill the following equation:

SADR\_MBHF = ( i γ8) + RFSYMBADR[SMBA];(0 ≤ i ≤ 1023)

## Equation 44. Equation for SADR\_MBHF

- The MB header fields for each FIFO must be a contiguous area.

## 56.2.6.6 MB data area

The MB data area contains all the MB data fields of the physical MBs. Each MB data field must start at a 16-bit boundary.

## 56.2.6.7 Sync frame table area

The sync frame table area provides a copy of the internal sync frame tables for application access. See Sync FID and sync frame deviation tables for the description of the sync frame table area.

## 56.2.7 Physical MB description

This section provides a detailed description of the usage and the content of the two parts of a physical MB-the MB header field and the MB data field.

## 56.2.7.1 MB protection and data consistency

The physical MBs are located in the FlexRay memory area. CC provides no means to protect the FlexRay memory area from uncontrolled or illegal host or other client write access. To ensure data consistency of the physical MBs, you must follow the write access scheme that is given in the description of each of the physical MB fields.

## 56.2.7.2 MB header field description

This section provides a detailed description of the usage and content of the MB header field. A description of the structure of the MB header fields is provided in MB header field. Each MB header field consists of two sections-frame header and slot status.

## 56.2.7.2.1 Frame header description

## 56.2.7.2.1.1 Frame header content

The semantic and content of the frame header section depends on the MB type.

For individual receive MBs and receive FIFOs, the frame header receives the frame header data of the first valid frame received on the assigned channels.

For receive shadow buffers, the frame header receives the frame header data of the current frame received regardless of whether the frame is valid or not.

FlexRay Communication Controller (FlexRay)

FlexRay Communication Controller (FlexRay)

For transmit MBs, you write the frame header of the to-be-transmitted frame to this location. The frame header is read out when the frame is transferred to the FlexRay bus.

The structure of the frame header in the MB header field for receive MBs and the receive FIFO is given in Table 490. A detailed description is given in Table 494.

## Table 490. Frame header structure (receive MB and receive FIFO)

|    | 15   | 14   | 13     | 12     | 10     | 9      | 8      | 7     | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
|----|------|------|--------|--------|--------|--------|--------|-------|--------|--------|--------|--------|--------|--------|--------|
| 0h | R    | PPI  | NUF    | SYF    | FID    | FID    | FID    | FID   | FID    | FID    | FID    | FID    | FID    | FID    | FID    |
| 2h | 0    | 0    | CYCCNT | CYCCNT | CYCCNT | CYCCNT | CYCCNT | 0     | PLDLEN | PLDLEN | PLDLEN | PLDLEN | PLDLEN | PLDLEN | PLDLEN |
| 4h | 0    | 0    | 0      | 0      | HDCRC  | HDCRC  | HDCRC  | HDCRC | HDCRC  | HDCRC  | HDCRC  | HDCRC  | HDCRC  | HDCRC  | HDCRC  |

The structure of the frame header in the MB header field for transmit MBs is given in Table 491. A detailed description is given in Table 495. The checks to be performed are described in Frame header checks.

## Table 491. Frame header structure (transmit MB)

<!-- image -->

= Not used

The structure of the frame header in the MB header field for transmit MBs assigned to key slot is provided in Table 492.

## Table 492. Frame header structure (transmit MB for key slot)

<!-- image -->

= Not used

## 56.2.7.2.1.2 Frame header access

The frame header is located in the FlexRay memory area. To ensure data consistency, you must follow the write access scheme described below.

For receive MBs, receive shadow buffers, and receive FIFOs, you must not write to the frame header field.

For transmit MBs, you must follow the write access restrictions given in the following table. This table shows the condition under which you can write to the frame header entries without corrupting the FlexRay message transmission.

Table 493. Frame header write access constraints (transmit MB)

| Field              | Static segment       | Dynamic segment      |
|--------------------|----------------------|----------------------|
| FID                | POC:config or MB_DIS | POC:config or MB_DIS |
| PPI, PLDLEN, HDCRC | POC:config or MB_DIS | POC:config or MB_DIS |
|                    |                      | MB_LCK               |

## 56.2.7.2.1.3 Frame header checks

As shown in Table 491 and Table 492, not all fields in the MB frame header are used for transmission. Some fields in the MB frame header are ignored, some are used for transmission, and some of them are checked for correct values. All checks that are performed are described below.

For MBs assigned to the key slot, no checks are performed.

The value of the FID field must be equal to the value of the corresponding MB FID (MBFIDR0 - MBFIDR255). If CC detects a mismatch while transmitting the frame header, it causes CHIERFR[FID\_EF] to become 1. The value of the FID field is ignored and replaced by the value provided in MB FID (MBFIDR0 - MBFIDR255).

For transmit MBs assigned to the static segment, the PLDLEN value must be equal to PCR19[payload\_length\_static]. If this is not fulfilled, CHIERFR[SPL\_EF] becomes 1 when the MB is under transmission. A syntactically and semantically correct frame is generated with PCR19[payload\_length\_static] payload words and the payload length field in the transmitted frame header set to payload\_length\_static.

For transmit MBs assigned to the dynamic segment, the PLDLEN value must be less than or equal to PCR24[max\_payload\_length\_dynamic]. If this is not fulfilled, CHIERFR[DPL\_EF] becomes 1 when the MB is under transmission. A syntactically and semantically correct dynamic frame is generated with PLDLEN payload words and the payload length field in the frame header set to PLDLEN.

Table 494. Frame header field descriptions (receive MB and receive FIFO)

| Field   | Description                                                                                                            |
|---------|------------------------------------------------------------------------------------------------------------------------|
| R       | Reserved field-This is the value of the reserved field of the received frame stored in the MB.                         |
| PPI     | Payload preamble indicator-This is the value of the payload preamble indicator of the received frame stored in the MB. |
| NUF     | Null frame indicator-This is the value of the null frame indicator of the received frame stored in the MB.             |
| SYF     | Sync frame indicator-This is the value of the sync frame indicator of the received frame stored in the MB.             |
| SUF     | Startup frame indicator-This is the value of the startup frame indicator of the received frame stored in the MB.       |
| FID     | This is the value of the frame ID field of the received frame stored in the MB.                                        |
| CYCCNT  | Cycle count-This is the number of the communication cycle in which the frame stored in the MB was received.            |
| PLDLEN  | Payload length-This is the value of the payload length field of the received frame stored in the MB.                   |
| HDCRC   | Header CRC-This is the value of the header CRC field of the received frame stored in the MB.                           |

FlexRay Communication Controller (FlexRay)

Table 495. Frame header field descriptions (transmit MB)

| Field   | Description                                                                                                                                                                               |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| R       | Reserved field-Not used; the value of the reserved field is generated internally according to FlexRay Communications System Protocol Specification, Version 2.1 Rev A.                    |
| PPI     | Payload preamble indicator-This field provides the value of the payload preamble indicator for the frame transmitted from the MB.                                                         |
| NUF     | Null frame indicator-Not used; the value of the null frame indicator is generated internally according to FlexRay Communications System Protocol Specification, Version 2.1 Rev A .       |
| SYF     | Sync frame indicator-Not used; the value of the sync frame indicator is generated internally according to FlexRay Communications System Protocol Specification, Version 2.1 Rev A .       |
| SUF     | Startup frame indicator-Not used; the value of the startup frame indicator is generated internally according to FlexRay Communications System Protocol Specification, Version 2.1 Rev A . |
| FID     | This field is checked as described in Frame Header Checks.                                                                                                                                |
| CYCCNT  | Cycle count-Not used; the value of the transmitted cycle count field is taken from the internal communication cycle counter.                                                              |
| PLDLEN  | Payload length-This field is checked and used as described in Frame Header Checks.                                                                                                        |
| HDCRC   | Header CRC-This field provides the value of the header CRC field for the frame transmitted from the MB.                                                                                   |

## 56.2.7.2.2 Slot status description

The slot status is a read-only structure for you and a write-only structure for CC. The meaning and content of the slot status in the MB header field depends on the MB type.

## 56.2.7.2.2.1 Slot status description for the receive MBs and receive FIFOs

The content of the slot status structure for receive MBs depends on the MB type and on the channel assignment for individual receive MBs as given in Table 496.

Table 496. Receive MB slot status content

| Receive MB type                                 | MBCCFR n [CHA]   | MBCCFR n [CHB]   | Slot status content   |
|-------------------------------------------------|------------------|------------------|-----------------------|
| Individual receive MB assigned to both channels | 1                | 1                | See Table 497.        |
| Individual receive MB assigned to channel A     | 1                | 0                | See Table 498.        |
| Individual receive MB assigned to channel B     | 0                | 1                | See Table 499.        |
| Receive FIFO channel A MB                       | -                | -                | See Table 498.        |
| Receive FIFO channel B MB                       | -                | -                | See Table 499.        |

Table 500 provides the meaning of the fields in the slot status structure.

Table 497. Receive MB slot status structure (ChAB)

|                                                   | 15                                                | 14                                                | 13                                                | 12                                                | 11                                                | 10                                                | 9                                                 | 8                                                 | 7                                                 | 6                                                 | 5                                                 | 4                                                 | 3                                                 | 2                                                 | 1                                                 | 0                                                 |
|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|
| R                                                 | VFB                                               | SYB                                               | NFB                                               | SUB                                               | SEB                                               | CEB                                               | BVB                                               | CH                                                | VFA                                               | SYA                                               | NFA                                               | SUA                                               | SEA                                               | CEA                                               | BVA                                               | 0                                                 |
| Reset                                             | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 |
| Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) | Table 498. Receive MB slot status structure (ChA) |
|                                                   | 15                                                | 14                                                | 13                                                | 12                                                | 11                                                | 10                                                | 9                                                 | 8                                                 | 7                                                 | 6                                                 | 5                                                 | 4                                                 | 3                                                 | 2                                                 | 1                                                 | 0                                                 |
| R                                                 | 0                                                 | 0                                                 | 0                                                 | 0                                                 | 0                                                 | 0                                                 | 0                                                 | 0                                                 | VFA                                               | SYA                                               | NFA                                               | SUA                                               | SEA                                               | CEA                                               | BVA                                               | 0                                                 |
| Reset                                             | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 |
| Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) | Table 499. Receive MB slot status structure (ChB) |
|                                                   | 15                                                | 14                                                | 13                                                | 12                                                | 11                                                | 10                                                | 9                                                 | 8                                                 | 7                                                 | 6                                                 | 5                                                 | 4                                                 | 3                                                 | 2                                                 | 1                                                 | 0                                                 |
| R                                                 | VFB                                               | SYB                                               | NFB                                               | SUB                                               | SEB                                               | CEB                                               | BVB                                               | 1                                                 | 0                                                 | 0                                                 | 0                                                 | 0                                                 | 0                                                 | 0                                                 | 0                                                 | 0                                                 |
| Reset                                             | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 | -                                                 |

Table 500. Receive MB slot status field descriptions

| Field                   | Description                                                                                                                                               |
|-------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
| Common MB status fields | Common MB status fields                                                                                                                                   |
| VFB                     | Valid Frame On Channel B Protocol-related variable: vSS!ValidFrame channel B 0: vSS!ValidFrame = 0 1: vSS!ValidFrame = 1                                  |
| SYB                     | Sync Frame Indicator Channel B Protocol-related variable: vRF!Header!SyFIndicator channel B 0: vRF!Header!SyFIndicator = 0 1: vRF!Header!SyFIndicator = 1 |
| NFB                     | Null Frame Indicator Channel B Protocol-related variable: vRF!Header!NFIndicator channel B 0: vRF!Header!NFIndicator = 0 1: vRF!Header!NFIndicator = 1    |
| SUB                     | Startup Frame Indicator Channel B Protocol-related variable: vRF!Header!SuFIndicator channel B 0: vRF!Header!SuFIndicator = 0                             |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table 500. Receive MB slot status field descriptions (continued)

| Field   | Description                                                                                                                                                                                                                                                                                                                                                                               |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| SEB     | Syntax Error On Channel B Protocol-related variable: vSS!SyntaxError channel B 0: vSS!SyntaxError = 0 1: vSS!SyntaxError = 1                                                                                                                                                                                                                                                              |
| CEB     | Content Error On Channel B Protocol-related variable: vSS!ContentError channel B 0: vSS!ContentError = 0 1: vSS!ContentError = 1                                                                                                                                                                                                                                                          |
| BVB     | Boundary Violation On Channel B Protocol-related variable: vSS!BViolation channel B 0: vSS!BViolation = 0 1: vSS!BViolation = 1                                                                                                                                                                                                                                                           |
| CH      | Channel First Valid Received Applies only to receive MBs assigned to the static segment and to both channels. It indicates the channel that has received the first valid frame in the slot. This field becomes 0 if no valid frame was received in the subscribed slot. 0: First valid frame received on channel A, or no valid frame received 1: First valid frame received on channel B |
| VFA     | Valid Frame On Channel A Protocol-related variable: vSS!ValidFrame channel A 0: vSS!ValidFrame = 0 1: vSS!ValidFrame = 1                                                                                                                                                                                                                                                                  |
| SYA     | Sync Frame Indicator Channel A Protocol-related variable: vRF!Header!SyFIndicator channel A 0: vRF!Header!SyFIndicator = 0 1: vRF!Header!SyFIndicator = 1                                                                                                                                                                                                                                 |
| NFA     | Null Frame Indicator Channel A Protocol-related variable: vRF!Header!NFIndicator channel A 0: vRF!Header!NFIndicator = 0 1: vRF!Header!NFIndicator = 1                                                                                                                                                                                                                                    |
| SUA     | Startup Frame Indicator Channel A                                                                                                                                                                                                                                                                                                                                                         |

Table continues on the next page...

Table 500. Receive MB slot status field descriptions (continued)

| Field   | Description                                                                                                                      |
|---------|----------------------------------------------------------------------------------------------------------------------------------|
|         | Protocol-related variable: vRF!Header!SuFIndicator channel A 0: vRF!Header!SuFIndicator = 0 1: vRF!Header!SuFIndicator = 1       |
| SEA     | Syntax Error On Channel A Protocol-related variable: vSS!SyntaxError channel A 0: vSS!SyntaxError = 0 1: vSS!SyntaxError = 1     |
| CEA     | Content Error On Channel A Protocol-related variable: vSS!ContentError channel A 0: vSS!ContentError = 0 1: vSS!ContentError = 1 |
| BVA     | Boundary Violation On Channel A Protocol-related variable: vSS!BViolation channel A 0: vSS!BViolation = 0 1: vSS!BViolation = 1  |

## 56.2.7.2.2.2 Slot status description for transmit MBs

Only the TCA and TCB status fields are directly related to the transmission process. All other status fields in this structure are related to a receive process that may have occurred. The content of the slot status structure for transmit MBs depends on the channel assignment as given in Table 501.

Table 501. Transmit MB slot status content

| Transmit MB type                                                               |   MBCCFR n [CHA] |   MBCCFR n [CHB] | Slot status content   |
|--------------------------------------------------------------------------------|------------------|------------------|-----------------------|
| Individual transmit MB assigned to both channels                               |                1 |                1 | See Table 502.        |
| Individual transmit MB assigned to channel A                                   |                1 |                0 | See Table 503.        |
| Individual transmit MB assigned to channel B MBCCFRn[CHA]=0 and MBCCFRn[CHB]=1 |                0 |                1 | See Table 504.        |

Table 505 provides the meaning of the fields in the slot status structure.

## Table 502. Transmit MB slot status structure (ChAB)

|                                                    | 15                                                 | 14                                                 | 13                                                 | 12                                                 | 11                                                 | 10                                                 | 9                                                  | 8                                                  | 7                                                  | 6                                                  | 5                                                  | 4                                                  | 3                                                  | 2                                                  | 1                                                  | 0                                                  |
|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|----------------------------------------------------|
| R                                                  | VFB                                                | SYB                                                | NFB                                                | SUB                                                | SEB                                                | CEB                                                | BVB                                                | TCB                                                | VFA                                                | SYA                                                | NFA                                                | SUA                                                | SEA                                                | CEA                                                | BVA                                                | TCA                                                |
| Reset                                              | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  |
| Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) | Table 503. Transmit MB slot status structure (ChA) |
|                                                    | 15                                                 | 14                                                 | 13                                                 | 12                                                 | 11                                                 | 10                                                 | 9                                                  | 8                                                  | 7                                                  | 6                                                  | 5                                                  | 4                                                  | 3                                                  | 2                                                  | 1                                                  | 0                                                  |
| R                                                  | 0                                                  | 0                                                  | 0                                                  | 0                                                  | 0                                                  | 0                                                  | 0                                                  | 0                                                  | VFA                                                | SYA                                                | NFA                                                | SUA                                                | SEA                                                | CEA                                                | BVA                                                | TCA                                                |
| Reset                                              | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  |
| Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) | Table 504. Transmit MB slot status structure (ChB) |
|                                                    | 15                                                 | 14                                                 | 13                                                 | 12                                                 | 11                                                 | 10                                                 | 9                                                  | 8                                                  | 7                                                  | 6                                                  | 5                                                  | 4                                                  | 3                                                  | 2                                                  | 1                                                  | 0                                                  |
| R                                                  | VFB                                                | SYB                                                | NFB                                                | SUB                                                | SEB                                                | CEB                                                | BVB                                                | TCB                                                | 0                                                  | 0                                                  | 0                                                  | 0                                                  | 0                                                  | 0                                                  | 0                                                  | 0                                                  |
| Reset                                              | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  | -                                                  |

Table 505. Transmit MB slot status structure field descriptions

| Field   | Description                                                                                                                                                  |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| VFB     | Valid Frame On Channel B Protocol-related variable: vSS!ValidFrame channel B 0: vSS!ValidFrame = 0 1: vSS!ValidFrame = 1                                     |
| SYB     | Sync Frame Indicator Channel B Protocol-related variable: vRF!Header!SyFIndicator channel B 0: vRF!Header!SyFIndicator = 0 1: vRF!Header!SyFIndicator = 1    |
| NFB     | Null Frame Indicator Channel B Protocol-related variable: vRF!Header!NFIndicator channel B 0: vRF!Header!NFIndicator = 0 1: vRF!Header!NFIndicator = 1       |
| SUB     | Startup Frame Indicator Channel B Protocol-related variable: vRF!Header!SuFIndicator channel B 0: vRF!Header!SuFIndicator = 0 1: vRF!Header!SuFIndicator = 1 |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table 505. Transmit MB slot status structure field descriptions (continued)

| Field   | Description                                                                                                                                                  |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| SEB     | Syntax Error On Channel B Protocol-related variable: vSS!SyntaxError channel B 0: vSS!SyntaxError = 0 1: vSS!SyntaxError = 1                                 |
| CEB     | Content Error On Channel B Protocol-related variable: vSS!ContentError channel B 0: vSS!ContentError = 0 1: vSS!ContentError = 1                             |
| BVB     | Boundary Violation On Channel B Protocol-related variable: vSS!BViolation channel B 0: vSS!BViolation = 0 1: vSS!BViolation = 1                              |
| TCB     | Transmission Conflict On Channel B Protocol-related variable: vSS!TxConflict channel B 0: vSS!TxConflict = 0 1: vSS!TxConflict = 1                           |
| VFA     | Valid Frame On Channel A Protocol-related variable: vSS!ValidFrame channel A 0: vSS!ValidFrame = 0 1: vSS!ValidFrame = 1                                     |
| SYA     | Sync Frame Indicator Channel A Protocol-related variable: vRF!Header!SyFIndicator channel A 0: vRF!Header!SyFIndicator = 0 1: vRF!Header!SyFIndicator = 1    |
| NFA     | Null Frame Indicator Channel A Protocol-related variable: vRF!Header!NFIndicator channel A 0: vRF!Header!NFIndicator = 0 1: vRF!Header!NFIndicator = 1       |
| SUA     | Startup Frame Indicator Channel A Protocol-related variable: vRF!Header!SuFIndicator channel A 0: vRF!Header!SuFIndicator = 0 1: vRF!Header!SuFIndicator = 1 |

Table continues on the next page...

Table 505. Transmit MB slot status structure field descriptions (continued)

| Field   | Description                                                                                                                      |
|---------|----------------------------------------------------------------------------------------------------------------------------------|
| SEA     | Syntax Error On Channel A Protocol-related variable: vSS!SyntaxError channel A 0: vSS!SyntaxError = 0 1: vSS!SyntaxError = 1     |
| CEA     | Content Error On Channel A Protocol-related variable: vSS!ContentError channel A 0: vSS!ContentError = 0 1: vSS!ContentError = 1 |
| BVA     | Boundary Violation On Channel A Protocol-related variable: vSS!BViolation channel A 0: vSS!BViolation = 0 1: vSS!BViolation = 1  |

## 56.2.7.3 MB data field description

The MB data field is used to store the payload data-or a part of that data-of the frame that you want to transmit or receive on the FlexRay bus. The minimum required length of this field depends on the MB type that the physical MB is assigned to and is given in Table 506. Table 507 shows the structure of the MB data field.

Table 506. MB data field minimum length

| Physical MB assigned to            | Minimum length defined by           |
|------------------------------------|-------------------------------------|
| Individual MB in segment 1         | MBDSR[MBSEG1DS]                     |
| Receive shadow buffer in segment 1 | MBDSR[MBSEG1DS]                     |
| Individual MB in segment 2         | MBDSR[MBSEG2DS]                     |
| Receive shadow buffer in segment 2 | MBDSR[MBSEG2DS]                     |
| Receive FIFO for channel A         | RFDSR[ENTRY_SIZE] (RFWMSR[SEL] = 0) |
| Receive FIFO for channel B         | RFDSR[ENTRY_SIZE] (RFWMSR[SEL] = 1) |

## NOTE

CC does not access any locations outside the MB data field boundaries given in Table 506.

## Table 507. MB data field structure

<!-- image -->

|    | 15                  | 14                  | 13                  | 12                  | 11                  | 10                  | 9                   | 8                   | 7                   | 6                   | 5 4                 | 3                   | 2 1                 |                     |                     |
|----|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|
| 0h | DATA0 / MID0 / NMV0 | DATA0 / MID0 / NMV0 | DATA0 / MID0 / NMV0 | DATA0 / MID0 / NMV0 | DATA0 / MID0 / NMV0 | DATA0 / MID0 / NMV0 | DATA0 / MID0 / NMV0 | DATA0 / MID0 / NMV0 | DATA1 / MID1 / NMV1 | DATA1 / MID1 / NMV1 | DATA1 / MID1 / NMV1 | DATA1 / MID1 / NMV1 | DATA1 / MID1 / NMV1 | DATA1 / MID1 / NMV1 | DATA1 / MID1 / NMV1 |
| 2h | DATA2 / NMV2        | DATA2 / NMV2        | DATA2 / NMV2        | DATA2 / NMV2        | DATA2 / NMV2        | DATA2 / NMV2        | DATA2 / NMV2        | DATA2 / NMV2        | DATA3 / NMV3        | DATA3 / NMV3        | DATA3 / NMV3        | DATA3 / NMV3        | DATA3 / NMV3        | DATA3 / NMV3        | DATA3 / NMV3        |
| …  | …                   | …                   | …                   | …                   | …                   | …                   | …                   | …                   | …                   | …                   | …                   | …                   | …                   | …                   | …                   |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

## Table 507. MB data field structure (continued)

<!-- image -->

The MB data field is located in the FlexRay memory area; thus, CC has no means to control your write access to the field. To ensure data consistency, you must follow a write and read access scheme.

## 56.2.7.3.1 MB data field read access

For transmit MBs, CC does not modify the content of the MB data field. Thus you can read back the data at any time without any impact on data consistency.

For receive MBs, you must lock the related receive MB and retrieve the MB header index from MB Index (MBIDXR0 MBIDXR255). While the MB is locked, CC does not update the MB data field.

For receive FIFOs, you can read the MB indicated by Receive FIFO A Read Index (RFARIR) or Receive FIFO B Read Index (RFBRIR) when the related fill levels in Receive FIFO Fill Level and Pop Count (RFFLPCR) indicate a non-empty FIFO.

## 56.2.7.3.2 MB data field write access

For receive MBs, receive shadow buffers, and receive FIFOs, you must not write to the MB data field.

For transmit MBs, you must follow the write access restrictions provided in Table 508.

## Table 508. Frame data write access constraints

| Field          | CC/MB state                    |
|----------------|--------------------------------|
| DATA, MID, NMV | POC:config or MB_DIS or MB_LCK |

## Table 509. Frame data field descriptions

| Field           | Description                                                                                                                                                                                                                                  |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| DATA 0-DATA N-1 | Message Data Provides the message data received or to be transmitted. For receive MBs and receive FIFOs, this field provides the message data received for this MB. For transmit MBs, the field provides the message data to be transmitted. |
| MID 0-1         | Message Identifier If the MBframe header's PPI field is 1, MID n holds the message ID of a dynamic frame located in the MB. The receive FIFO filter uses the received message ID for message ID filtering.                                   |
| NMV 0-11        | NMV If the MBframe header's PPI field is1,NMV n holds the NMVofastatic frame located in the MB. The MID and NMV bytes replace the corresponding DATA bytes. NOTE                                                                             |

## 56.2.8 Individual MB functional description

CC provides these basic types of individual MBs:

- Transmit MBs

FlexRay Communication Controller (FlexRay)

- Receive MBs

Before an individual MB can be used, you must configure it. After the initial configuration, the MB can be reconfigured later. Individual MB configuration data provides the set of configuration data for individual MBs.

## 56.2.8.1 Individual MB configuration

The individual MB configuration consists of two steps:

1. Allocation of the required amount of memory for the FlexRay memory area
2. Programming of the MB configuration registers (described in the following subsections)

## 56.2.8.1.1 Common configuration data

One part of the MB configuration data is common to all individual MBs and the receive shadow buffers. This data can only be set when the protocol is in the POC:config state.

Table 510. Common configuration data

| To configure this:                                                             | Do this:                                                                                                                             |
|--------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------|
| The number of used MBs                                                         | Write the MB number of the last-used MB to MBSSUTR[LAST_MB_UTIL].                                                                    |
| The size of the two segments of individual MBs                                 | Write the MB number of the last MB in the first segment to MBSSUTR[LAST_MB_SEG1].                                                    |
| The length of the MB data fields for both MB segments                          | Write to MBDSR[MBSEG1DS] and MBDSR[MBSEG2DS].                                                                                        |
| The receive shadow buffers (depending on the current CC receive functionality) | Write to Receive Shadow Buffer Index (RSBIR) for each segment and for each channel with at least one individual receive MB assigned. |

## 56.2.8.1.2 Specific configuration data

The second part of the MB configuration data is specific for each MB.

This data can be changed only when either of the following is true:

- The protocol is in the POC:config state.
- The MB is disabled-that is, MBCCSRn[EDS] = 0.

The individual MB type is defined by MBCCSRn[MTD] as given in the following table.

Table 511. Individual MB types

|   MBCCSR n [MTD] | Individual MB description   |
|------------------|-----------------------------|
|                0 | Receive MB                  |
|                1 | Transmit MB                 |

The MB-specific configuration data is:

- MBCCSRn[MTD]
- All fields in MB Cycle Counter Filter (MBCCFR0 - MBCCFR255)
- All fields in MB FID (MBFIDR0 - MBFIDR255)
- All fields in MB Index (MBIDXR0 - MBIDXR255)

The meaning of the specific configuration data depends on the MB type, as described in Transmit MBs and Receive MBs.

FlexRay Communication Controller (FlexRay)

## 56.2.8.2 Transmit MBs

The section provides a detailed description of the functionality of single-buffered transmit MBs.

You use a transmit MB to provide message data to CC that is transmitted over the FlexRay bus. CC uses the transmit MBs to provide information about the transmission process and status information about the slot in which the message was transmitted.

The individual MB with MB number n is configured to be a transmit MB by the following settings:

- MBCCSRn[MBT] = 0 (single-buffered MB)
- MBCCSRn[MDT] = 1 (transmit MB)

## 56.2.8.2.1 Access regions

Both you and CC have access to certain MB fields. To ensure data consistency, an MB locking scheme controls the access to the MB data, control, and status fields. The access regions for transmit MBs are depicted in the following figure. A description of the regions is given in Table 513. If a region is active as indicated in Table 514, the access scheme given for that region applies to the MB.

<!-- image -->

Table 512. Transmit MB access region description

| Region   | Access from   | Access from   | Region used for                                   |
|----------|---------------|---------------|---------------------------------------------------|
| Region   | Application   | Module        | Region used for                                   |
| CFG      | Read/write    | -             | MB configuration                                  |
| MSG      | Read/write    | -             | Message data and slot status access               |
| NF       | -             | Read-only     | Message header access for null frame transmission |
| TX       | -             | Read/write    | Message transmission and slot status update       |
| CM       | -             | Read-only     | MB validation                                     |
| SR       | -             | Read-only     | MB search                                         |

FlexRay Communication Controller (FlexRay)

FlexRay Communication Controller (FlexRay)

The EDT and LCKT trigger fields, and the MBIE interrupt-enable field, in MB Configuration Control Status (MBCCSR0 MBCCSR255) are not under access control and can be accessed from the application at any time. The EDS and LCKS status fields are not under access control and can be accessed from CC at any time.

MBCCSRn[MBIF] is not under access control and can be accessed from the application and CC at any time. CC clear access has higher priority.

CC restricts its access to the regions depending on the current state of the MB. You must comply with these restrictions to ensure data consistency. The transmit MB states are given in Figure 508. A description of the states is given in Table 513, which also provides the access scheme for the access regions.

The EDS and LCKS status fields in MB Configuration Control Status (MBCCSR0 - MBCCSR255) provide you with the required MB status information. The internal status information is not visible to you.

## 56.2.8.2.2 MB states

This section describes the transmit MB states and provides a state diagram.

Figure 508. Transmit MB states

<!-- image -->

Table 513. Transmit MB state description

| State   | MBCCSRn   | MBCCSRn   | Access region   | Access region   | Description                                                          |
|---------|-----------|-----------|-----------------|-----------------|----------------------------------------------------------------------|
| State   | EDS       | LCKS      | Application     | Module          | Description                                                          |
| Idle    | 1         | 0         | -               | CM, SR          | Idle MB is idle. Included in MB search.                              |
| HDis    | 0         | 0         | CFG             | -               | Disabled MB under configuration. Excluded from MB search.            |
| HDisLck | 0         | 1         | CFG             | -               | Disabled and locked MB under configuration. Excluded from MB search. |
| HLck    | 1         | 1         | MSG             | SR              | Locked                                                               |

Table continues on the next page...

Table 513. Transmit MB state description (continued)

| State    | MBCCSRn   | MBCCSRn   | Access region   | Access region   | Description                                                                                                                                |
|----------|-----------|-----------|-----------------|-----------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| State    | EDS       | LCKS      | Application     | Module          | Description                                                                                                                                |
|          |           |           |                 |                 | Applications access to data, control, and status. Included in MB search.                                                                   |
| CCSa     | 1         | 0         | -               | -               | Slot assigned MB assigned to next static slot. Ready for null frame transmission.                                                          |
| HLckCCSa | 1         | 1         | MSG             | -               | Locked and slot assigned Applications access to data, control, and status. MB assigned to next static slot.                                |
| CCNf     | 1         | 0         | -               | NF              | Null frame transmission Header is used for null frame transmission.                                                                        |
| HLckCCNf | 1         | 1         | MSG             | NF              | Locked and null frame transmission Applications access to data, control, and status. Header is used for null frame transmission.           |
| CCMa     | 1         | 0         | -               | CM              | Message available MB is assigned to next slot and cycle counter filter matches.                                                            |
| HLckCCMa | 1         | 1         | MSG             | -               | Locked and message available Applications access to data, control, and status.MBis assigned to next slot and cycle counter filter matches. |
| CCTx     | 1         | 0         | -               | TX              | Message transmission MB data transmit. Payload data from buffer transmitted.                                                               |
| CCSu     | 1         | 0         | -               | TX              | Status update MB status update. Update of status flags, the slot status field, and the header index.                                       |

## 56.2.8.2.3 MB transitions

This section discusses:

- Application transitions
- Module transitions
- Transition priorities

## 56.2.8.2.3.1 Application transitions

You can trigger the application transitions using the commands described in Table 514. You issue the commands by writing to MB Configuration Control Status (MBCCSR0 - MBCCSR255). Only one command can be issued with one write access. Each command executes immediately. If the command is ignored, you must issue it again.

## 56.2.8.2.3.1.1 MB enable and disable

You issue the enable and disable commands by writing 1 to MBCCSRn[EDT]. The transition that each of these commands triggers depends on the current value of MBCCSRn[EDS].

If the command triggers the disable transition HD and the MB is in one of the states:

- CCSa
- HLckCCSa
- CCMa
- HLckCCMa
- CCNf
- HLckCCNf
- CCTx

then the disable transition has no effect (the command is ignored) and the MB state does not change. You do not receive any notification.

## NOTE

Do not disable an MB when FlexRay is in the STARTUP protocol state.

## 56.2.8.2.3.1.2 MB lock and unlock

You issue the lock and unlock commands by writing 1 to MBCCSRn[LCKT]. The transition that each of these commands triggers depends on the current value of MBCCSRn[LCKS]. If the command triggers the HL lock transition and the MB is in the CCTx state, the lock transition has no effect (command is ignored) and the MB state does not change. In this case, CHIERFR[LCK\_EF] becomes 1.

Table 514. Transmit MB application transitions

| Transition   | Command                    | Condition           | Description                      |
|--------------|----------------------------|---------------------|----------------------------------|
| HE           | Write 1 to MBCCSR n [EDT]  | MBCCSR n [EDS] = 0  | Application triggers MB enable.  |
| HD           | Write 1 to MBCCSR n [EDT]  | MBCCSR n [EDS] = 1  | Application triggers MB disable. |
| HL           | Write 1 to MBCCSR n [LCKT] | MBCCSR n [LCKS] = 0 | Application triggers MB lock.    |
| HU           | Write 1 to MBCCSR n [LCKT] | MBCCSR n [LCKS] = 1 | Application triggers MB unlock.  |

## 56.2.8.2.3.2 Module transitions

The following table describes the module transitions that CC can trigger. Each transition is triggered for certain MBs when the related condition is fulfilled.

Table 515. Transmit MB module transitions

| Transition   | Condition                  | Description   |
|--------------|----------------------------|---------------|
| SA           | Slot match and static slot | Slot assigned |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table 515. Transmit MB module transitions (continued)

| Transition   | Condition                                             | Description                                                                                                      |
|--------------|-------------------------------------------------------|------------------------------------------------------------------------------------------------------------------|
|              |                                                       | MB is assigned to the next static slot.                                                                          |
| MA           | Slot match and cycle counter match                    | Message available MB is assigned to the next slot and cycle counter filter matches.                              |
| TX           | Slot start and MBCCSR n [CMT] = 1                     | Transmission slot start Slot start and MBCCSR n [CMT] = 1. In case of a dynamic slot, pLatestTx is not exceeded. |
| SU           | Status updated                                        | Status updated Slot status field and MB status flags updated. Interrupt flag becomes 1.                          |
| STS          | Static slot start                                     | Static slot start                                                                                                |
| DSS          | Dynamic slot start, symbol window start, or NIT start | Dynamic slot or segment start                                                                                    |
| SSS          | Slot start, symbol window start, or NIT start         | Slot or segment start                                                                                            |

## 56.2.8.2.3.3 Transition priorities

You can trigger only one transition at a time. There is no need to specify priorities among them.

As shown in the first part of the following table, the module transitions have a higher priority than the application transitions. For all states except the CCMa state, both a lock/unlock transition HL/HD and a module transition can be executed at the same time. The result state is reached by first applying the application transition and subsequently the module transition to the intermediately reached state. For example, if all of the following is true:

- The MB is in the HLck state
- Your application unlocks the MB by using the HU transition
- The module triggers the slot assigned transition SA

then the intermediate state is Idle and the resulting state is CCSa.

The second part of the following table gives the priorities among the module transitions.

Table 516. Transmit MB transition priorities

| State                  | Priorities             | Description                                 |
|------------------------|------------------------|---------------------------------------------|
| Module vs. application | Module vs. application | Module vs. application                      |
| Idle, HLck             | SA > HD                | Slot assigned > MB disable                  |
|                        | MA > HD                | Message available > MB disable              |
| CCMa                   | TX > HL                | Transmission start > MB lock                |
| Module internal        | Module internal        | Module internal                             |
| Idle, HLck             | MA > SA                | Message available > slot assigned           |
| CCMa                   | TX > STS               | Transmission slot start > static slot start |

Table continues on the next page...

## Table 516. Transmit MB transition priorities (continued)

| State   | Priorities   | Description                                  |
|---------|--------------|----------------------------------------------|
|         | TX > DSS     | Transmission slot start > dynamic slot start |

## 56.2.8.2.4 Transmit message setup

To transmit a message over the FlexRay bus, you:

- Write the message data into the MB data field
- Write 1 to MBCCSRn[CMT]

Individual MBs describes the physical access to the MB data field.

As indicated by Table 505, you must write to the MB data field and change MBCCSRn[CMT] only if the transmit MB is in one of these states:

- HDis
- HDisLck
- HLck
- HLckCCSa
- HLckCCMa
- HLckCCMa

You can change the MB state if you issue the appropriate commands shown in Table 505. The EDS and LCKS fields of MB Configuration Control Status (MBCCSR0 - MBCCSR255) indicate the state change.

If the transmit MB enters one of these states:

- HDis
- HDisLck
- HLck
- HLckCCSa
- HLckCCMa

then MBCCSRn[DVAL] becomes 0.

## 56.2.8.2.5 Message transmission

As a result of the MB search described in Individual MB search, CC triggers the message-available transition (MA) for up to two transmit MBs. This changes the MB state from Idle to CCMa and the MBs can be used for message transmission in the next slot.

CC transmits a message from an MB if both of the following conditions are fulfilled at the start of the transmission slot:

- The MB is in the message available state CCMa
- The message data is still valid-that is, MBCCSRn[CMT] = 1

In this case, CC triggers the TX transition and changes the MB state to CCTx.

Figure 509 shows transmit MB timing and state changes. In this example:

- The MB with MB number n is idle at the start of the search slot.
- The MB with MB number n matches the slot and cycle number of the next slot.
- MB data is valid-that is, MBCCSRn[CMT] = 1.

FlexRay Communication Controller (FlexRay)

<!-- image -->

The following items determine the amount of message data read from the FlexRay memory area and transferred to the FlexRay bus:

- The MB segment that the MB is assigned to, as defined by MB Segment Size and Utilization (MBSSUTR)
- The MB data field size, as defined by the related field of MB Data Size (MBDSR)
- The value of the PLDLEN field in the MB header field, as described in Frame header description

If an MB is assigned to MB segment 1, and PLDLEN &gt; MBSEG1DS, then 2 × MBSEG1DS bytes are read from the MB data field and zero padding is used for the remaining bytes for the FlexRay bus transfer. If PLDLEN ≤ MBSEG1DS, CC reads and transfers 2 × PLDLEN bytes. The same is true for segment 2 and MBSEG2DS.

## 56.2.8.2.6 Null frame transmission

A static slot with slot number S is assigned to CC for channel A if at least one transmit MB is configured with MBFIDRn[FID] = S and MBCCFRn[CHA] = 1. A null frame is transmitted in the static slot S on channel A if both of the following are true:

- This slot is assigned to CC for channel A.
- One of the following is true for all transmit MBs with MBFIDRn[FID] = S and MBCCFRn[CHA] = 1:
- Not committed (that is, MBCCSRn[CMT] = 0)
- You locked them (that is, MBCCSRn[LCKS] = 1)
- The cycle counter filter is enabled and does not match

Additionally, you can write 0 to the commit field of an MB that is in the CCMa state, which is called "uncommit" or "transmit abort". This MB is used for null frame transmission.

As a result of the MB search described in Individual MB search, CC triggers the slot assigned transition SA for up to two transmit MBs if at least one of the conditions mentioned above is fulfilled for these MBs. The transition SA changes the MB states from either Idle to CCSa or from HLck to HLckCCSa. In each case, these MBs are used for null frame transmission in the next slot.

Figure 511 shows an MB timing and state-change diagram for null frame transmission from Idle state.

FlexRay Communication Controller (FlexRay)

<!-- image -->

Figure 512 shows an MB timing and state-change diagram for null frame transmission from HLck state.

<!-- image -->

If a transmit MB is in the CCSa or HLckCCSa state at the start of the transmission slot, a null frame is transmitted in any case, even if the MB is unlocked or committed before the transmission slot starts. Figure 513 shows a transmit MB timing and state-change diagram for null frame transmission for this case.

<!-- image -->

Because the null frame transmission does not use the MB data, you can lock and unlock the MB during null frame transmission. Figure 514 shows a transmit MB timing and state-change diagram for null frame transmission for this case.

<!-- image -->

## 56.2.8.2.7 MB status update

After the end of each slot, PE generates the slot status vector. Depending on the status, the transmitted frame type, and the amount of transmitted data, the MB status is updated.

## 56.2.8.2.7.1 MB status update after complete message transmission

The term "complete message transmission" refers to the fact that all payload data stored in the MB were sent to the FlexRay bus. In this case, CC updates the MB slot status field and triggers the status-updated transition SU. With the SU transition, CC sets the MB interrupt flag (MBCCSRn[MBIF]) to indicate successful message transmission.

Depending on MBCCFRn[MTM], CC changes the commit flag (MBCCSRn[CMT]) and the valid flag (MBCCSRn[DVAL]). If MBCCFRn[MTM] = 0, the MB is in Event Transmission mode. In this case, each committed message is transmitted only one time. The commit flag is cleared with the SU transition. If MBCCFRn[MTM] = 1, the MB is in State Transmission mode. In this case, each committed message is transmitted as long as you provide new data or lock the MBs. CC does not clear the commit flag at the end of transmission and sets the valid flag to indicate that the message is transmitted again.

## 56.2.8.2.7.2 MB status update after incomplete message transmission

The term "incomplete message transmission" refers to the fact that not all payload data that must be transmitted was sent to the FlexRay bus. The following regular conditions in the dynamic segment may cause incomplete message transmission:

- The transmission slot starts in a minislot with a minislot number greater than pLatestTx.
- The transmission slot never existed in the dynamic segment.

If either of these conditions occur, the MB status does not change with the SU transition. The slot status field is not updated, the status and control flags are not changed, and the interrupt flag is not set.

Additionally, an incomplete message transmission can be caused by internal communication errors. If those errors occur, CC sets the PIFR1[PECF\_IF].

## 56.2.8.2.7.3 MB status update after null frame transmission

After the transmission of a null frame, the status of the MB that was used for the null frame transmission does not change. The slot status field is not updated, the status and control flags are not changed, and the interrupt flag is not set.

## 56.2.8.3 Receive MBs

This section provides a detailed description of the functionality of the receive MBs. If you use receive MBs, you must configure the related receive shadow buffer as described in Receive shadow buffers.

You use a receive MB to receive a message from the FlexRay Bus based on individual filter criteria. CC uses the receive MB to provide the following data to you:

- Message data received
- Information about the reception process
- Status information about the slot in which the message was received

An individual MB with number n is configured as a receive MB by the following configuration settings shown in Equation 45:

MBCCSRn[MTD] = 0(receivemessagebuffer)

## Equation 45. Configuration equation

Both you and CC have access to certain MB fields, To ensure data consistency, CC implements an MB locking scheme that controls the access to the MB data, control, and status fields.

Figure 515 shows the access regions for receive MBs. Table 517 describes the regions. If a region is active as indicated in Table 518, the access scheme given for that region applies to the MB.

FlexRay Communication Controller (FlexRay)

FlexRay Communication Controller (FlexRay)

<!-- image -->

Table 517. Receive MB access region description

| Region   | Access from    | Access from   | Region used for                                   |
|----------|----------------|---------------|---------------------------------------------------|
| Region   | Application    | CC            | Region used for                                   |
| CFG      | Read and write | -             | MB configuration, message data, and status access |
| MSG      | Read and write | -             | Message data, header, and status access           |
| RX       | -              | Write-only    | Message reception and status update               |
| SR       | -              | Read-only     | MB search data                                    |

In MB Configuration Control Status (MBCCSR0 - MBCCSR255):

- The EDT, LCKT, and MBIE fields in are not under access control and can be accessed from the application at any time.
- The EDS and LCKS fields are not under access control and can be accessed from CC at any time. They provide you with the required status information. The internal status information is not visible to you.
- The MBIF field is not under access control and can be accessed from the application and CC at any time. CC set access has higher priority.

CC restricts its access to the regions depending on the current MB state. You must comply with these restrictions to ensure data consistency.

Figure 516 shows the receive MB states. Table 513 describes the MB states and provides the access scheme for the access regions.

Figure 516. Receive MB states

FlexRay Communication Controller (FlexRay)

<!-- image -->

## Table 518. Receive MB states and access

| State    | MBCCSR n   | MBCCSR n   | Access from   | Access from   | Description                                                                                                                     |
|----------|------------|------------|---------------|---------------|---------------------------------------------------------------------------------------------------------------------------------|
| State    | EDS        | LCKS       | Application   | Module        | Description                                                                                                                     |
| Idle     | 1          | 0          | -             | SR            | Idle MB is idle. Included in MB search.                                                                                         |
| HDis     | 0          | 0          | CFG           | -             | Disabled MBunder configuration. Excluded from MBsearch.                                                                         |
| HDisLck  | 0          | 1          | CFG           | -             | Disabled And Locked MBunder configuration. Excluded from MBsearch.                                                              |
| HLck     | 1          | 1          | MSG           | -             | Locked Application access to data, control, and status. Included in MB search.                                                  |
| CCBs     | 1          | 0          | -             | -             | Buffer Subscribed MB subscribed to reception. Filter matches next (slot, cycle, channel) tuple.                                 |
| HLckCCBs | 1          | 1          | MSG           | -             | Locked And Buffer Subscribed Application access to data, control, and status. MB subscribed to reception.                       |
| CCRx     | 1          | 0          | -             | -             | Message Receive Message data received in the related shadow buffer.                                                             |
| HLckCCRx | 1          | 1          | MSG           | -             | Locked And Message Receive Application access to data, control, and status. Message data received in the related shadow buffer. |

Table continues on the next page...

Table 518. Receive MB states and access (continued)

| State   | MBCCSR n   | MBCCSR n   | Access from   | Access from   | Description                                                                                          |
|---------|------------|------------|---------------|---------------|------------------------------------------------------------------------------------------------------|
| State   | EDS        | LCKS       | Application   | Module        | Description                                                                                          |
| CCSu    | 1          | 0          | -             | RX            | Status Update MB status update. Update of status flags, the slot status field, and the header index. |

## 56.2.8.3.1 MB transitions

## 56.2.8.3.1.1 Application transitions

The application transitions that can be triggered by the application using the commands described in Table 514. You issue the commands by writing to MB Configuration Control Status (MBCCSR0 - MBCCSR255). One write access can issue only one command. Each command executes immediately. If the command is ignored, you must issue it again.

## 56.2.8.3.1.2 MB enable and disable

You issue the enable and disable commands by writing 1 to MBCCSRn[EDT]. The transition that each of these commands triggers depends on the current value of MBCCSRn[EDS]. If the command triggers the disable transition HD and the MB is in the CCBs, HLckCCBs, or CCRx state, the disable transition has no effect (the command is ignored) and the MB state does not change. You do not receive any notification.

## 56.2.8.3.1.3 MB lock and unlock

You issue the lock and unlock commands by writing 1 to MBCCSRn[LCKT]. The transition that each of these commands triggers depends on the current value of the status bit MBCCSRn[LCKS]. If the command triggers the HL lock transition HL while the MB is in the CCRx state, the lock transition has no effect (the command is ignored) and the MB state does not change. In this case, CC sets the MB lock error flag (CHIERFR[LCK\_EF]).

Table 519. Receive MB application transitions

| Transition   | Host command               | Condition           | Description                      |
|--------------|----------------------------|---------------------|----------------------------------|
| HE           | Write 1 to MBCCSR n [EDT]  | MBCCSR n [EDS] = 0  | Application triggers MB enable.  |
| HD           | Write 1 to MBCCSR n [EDT]  | MBCCSR n [EDS] = 1  | Application triggers MB disable. |
| HL           | Write 1 to MBCCSR n [LCKT] | MBCCSR n [LCKS] = 0 | Application triggers MB lock.    |
| HU           | Write 1 to MBCCSR n [LCKT] | MBCCSR n [LCKS] = 1 | Application triggers MB unlock.  |

## 56.2.8.3.1.4 Module transitions

The following table describes the module transitions that CC can trigger. Each transition triggers for certain MBs when the related condition is fulfilled.

Table 520. Receive MB module transitions

| Transition   | Condition                   | Description       |
|--------------|-----------------------------|-------------------|
| BS           | Slot and CycleCounter match | Buffer Subscribed |

Table continues on the next page...

Table 520. Receive MB module transitions (continued)

| Transition   | Condition                            | Description                                                                                      |
|--------------|--------------------------------------|--------------------------------------------------------------------------------------------------|
|              |                                      | The MB filter matches the next slot and cycle.                                                   |
| SLS          | Slot start                           | Slot Start Start of either a static or dynamic slot.                                             |
| SNS          | Start of symbol window or NIT        | Symbol Window Or NIT Start Start of either the symbol window or NIT                              |
| SSS          | Start of slot, symbol window, or NIT | Slot Or Segment Start Start of static slot, dynamic slot, symbol window, or NIT                  |
| SU           | Status updated                       | Status Updated Slot Status field, MB status flags, and header index updated. Interrupt flag set. |

## 56.2.8.3.1.5 Transition priorities

You can trigger only one transition at a time. You do not need to specify priorities among them.

As shown in the following table, the module transitions have a higher priority than the application transitions. For all states except CCRx, a module transition and the application lock/unlock transition HL/HU and can execute at the same time. You reach the resulting state by applying the module transition and the application transition, in that order, to the intermediately-reached state. For example, if the MB is in the Buffer Subscribed CCBs state and the module triggers the slot start transition SLS at the same time as the application locks the MB by the HL transition, the intermediate state is CCRx and the resulting state is locked Buffer Subscribed state HLckCCRx.

Table 521. Receive MB transition priorities

| State                  | Priorities             | Description                     |
|------------------------|------------------------|---------------------------------|
| Module vs. application | Module vs. application | Module vs. application          |
| Idle                   | BS > HD                | Buffer Subscribed > MB Disable  |
| HLck                   | BS > HD                | Buffer Subscribed > MB Disable  |
| CCRx                   | SSS > HL               | Slot or Segment Start > MB Lock |

## 56.2.8.3.2 Message reception

As a result of the MB search, CC changes the state of up to two enabled receive MBs from Idle or HLck state to either CCBs or HLckCCBs state by triggering the BS transition.

If the receive MBs for the next slot are assigned to both channels, then CC changes at most one receive MB to a buffersubscribed state.

If more than one matching MB is assigned to a certain channel, then only the MB with the lowest MB number is in one of the states mentioned above.

With the start of the next static or dynamic slot, the module triggers the SLS transition. This changes the state of the subscribed receive MBs from either CCBs to CCRx or from HLckCCBs to HLckCCRx, respectively.

FlexRay Communication Controller (FlexRay)

During the reception slot, the received frame data is written into the shadow buffers. For details on receive shadow buffers, see Receive shadow buffer concept. The data and status of the receive MBs that are in the CCRx or HLckCCRx states are not modified in the reception slot.

## 56.2.8.3.3 MB update

CC triggers the SSS transition at the start of any of these:

- Next static slot
- Next dynamic slot
- The symbol window
- NIT

This transition changes the state of the receiving receive MBs from either CCRx to CCSu or from HLckCCRx to HLck.

If an MB is in the HLckCCRx state, no update is performed. The received data is lost. CC indicates this by setting the FRLA\_EF or FRLB\_EF flags in CHI Error Flag (CHIERFR).

If an MB was in the CCRx state, it is now in the CCSu state. CC updates the MB after evaluating the PE-provided slot status. The MB update depends on the slot-status bits and the segment the MB is assigned to. This is described in Table 525.

Table 522. Receive MB update

|   vSS!ValidFrame | vRF!Header! NFIndicator   | Update description                                                                                                                                         |
|------------------|---------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                1 | 1                         | Valid non-null frame received • MB data field updated • Frame header field updated • Slot status field updated • DUP = 1 • DVAL = 1 • MBIF = 1             |
|                1 | 0                         | Valid null frame received • MB data field not updated • Frame header field not updated • Slot status field updated • DUP = 0 • DVAL not changed • MBIF = 1 |
|                0 | 0 or 1                    | No valid frame received • MB data field not updated • Frame header field not updated • Slot status field updated • DUP = 0                                 |

Table continues on the next page...

Table 522. Receive MB update (continued)

| vSS!ValidFrame   | vRF!Header! NFIndicator   | Update description                                                                                                                                                                                            |
|------------------|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                  |                           | • DVAL not changed. • MBIF = 1 if the slot was not an empty dynamic slot An empty dynamic slot occurs when all of the following are 0: • vSS!ValidFrame • vSS!SyntaxError • vSS!ContentError • vSS!BViolation |

## NOTE

If the number of the last slot in the current communication cycle on a given channel is n, then all receive MBs assigned to this channel with MBFIDRn[FID] &gt; n are not updated.

When the receive MB update completes, CC triggers the SU transition. This changes the buffer state from CCSu to Idle. The next figure shows an example receive MB timing and state change diagram for a normal frame reception.

<!-- image -->

The following considerations determine the amount of message data written into the MB data field of the receive shadow buffer:

- The MB segment that the MB is assigned to, as defined by MB Segment Size and Utilization (MBSSUTR)
- The MB data field size, as defined by the related field in MB Data Size (MBDSR)
- The number of bytes received over the FlexRay bus

If the MB is assigned to MB segment 1, and the number of received bytes is greater than 2 × MBDSR[MBSEG1DS], CC writes only 2 × MBDSR[MBSEG1DS] bytes into the MB data field of the receive shadow buffer. If the number of received bytes is less than 2 × MBDSR[MBSEG1DS], CC writes only the received number of bytes and does not change the trailing bytes in the MB data field of the receive shadow buffer. The same holds for the MB segment 2 with MBDSR[MBSEG2DS].

## 56.2.8.3.4 Received message access

To access the message data received over the FlexRay bus, you read the message data stored in the MB data field of the corresponding receive MB. Individual MBs describes the access to the MB data field.

You can read the MB data field if the receive MB is in one of these states:

- HDis
- HDisLck
- HLck

If the MB is in one of these states, CC does not change the MB content.

FlexRay Communication Controller (FlexRay)

## 56.2.8.3.5 Receive shadow buffer concept

The receive shadow buffer concept applies only to individual receive MBs. The concept ensures that the receive MB presents only syntactically- and semantically-valid received non-null frames to you. Receive shadow buffers describes the basic structure of a receive shadow buffer.

The receive shadow buffers temporarily store the received frame header and message data. The slot-status information is generated after the slot boundary. If the slot-status information indicates the reception of the valid non-null frame (see Table 522), CC writes the slot status into the Slot Status field of the receive shadow buffer and exchanges the content of MB Index (MBIDXR0 - MBIDXR255) with the content of the corresponding internal shadow buffer index register. In all other cases, CC writes the slot status into the identified receive MB, depending on the slot status and the FlexRay segment the MB is assigned to.

The shadow buffer concept, with its index exchange, results in the FlexRay memory area located MB associated to an individual receive MB changes after successful reception of a valid frame. This means that the MB area in the FlexRay memory area that you access for reading the received message is different from the initial MB setting. Therefore, you must not rely on the index information written initially into MB Index (MBIDXR0 - MBIDXR255). Instead, you must fetch the index of the MB header field from MB Index (MBIDXR0 - MBIDXR255).

## 56.2.9 Individual MB search

This section provides a detailed description of the MB search algorithm.

For each channel, the MB search determines whether a slot s in a communication cycle c is assigned to frame or null-frame transmission or is subscribed to frame reception on that channel.

The MB search is a sequential algorithm that is invoked at the following protocol-related events:

- NIT start
- Slot start in the static segment
- Minislot start in the dynamic segment

The MB search within the NIT searches for MBs assigned or subscribed to slot 1. The MB search within slot n searches for MBs assigned or subscribed to slot n+1.

In general, the MB search for the next slot n considers only MBs that are both of the following:

- Enabled-that is, MBCCSRn[EDS] = 1
- Match the next slot n-that is, MBFIDRn[FID] = n

Table 523 introduces and defines matching MBs. For each enabled channel, the MB search may identify multiple matching MBs. CC considers all matching MBs and selects the MBs with highest priority according to Table 524 and Table 525.

## Table 523. Matching MBs

| For this segment:   | An MB is a matching MB if it:                          |
|---------------------|--------------------------------------------------------|
| Static              | Matches the condition of at least one row of Table 524 |
| Dynamic             | Matches the condition of at least one row of Table 525 |

## Table 524. MB search priority (static segment)

| Priority    |   MTD | LCKS   | CMT   |   CCFM 1 | Description                                                    | Transition   |
|-------------|-------|--------|-------|----------|----------------------------------------------------------------|--------------|
| 0 (highest) |     1 | 0      | 1     |        1 | Transmit buffer, matches cycle count, not locked and committed | MA           |
| 1           |     1 | -      | 0     |        1 | Transmit buffer, matches cycle count, not committed            | SA           |
|             |     1 | 1      | -     |        1 | Transmit buffer, matches cycle count, locked                   | SA           |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table 524. MB search priority (static segment) (continued)

| Priority   |   MTD | LCKS   | CMT   | CCFM 1   | Description                                     | Transition   |
|------------|-------|--------|-------|----------|-------------------------------------------------|--------------|
| 2          |     1 | -      | -     | -        | Transmit buffer                                 |              |
| 3          |     0 | 0      | -     | 1        | Receive buffer, matches cycle count, not locked | SB           |
| 4 (lowest) |     0 | 1      | -     | 1        | Receive buffer, matches cycle count, locked     |              |

Table 525. MB search priority (dynamic segment)

| Priority    |   MTD |   LCKS | CMT   |   CCFM 1 | Description                                                    | Transition   |
|-------------|-------|--------|-------|----------|----------------------------------------------------------------|--------------|
| 0 (highest) |     1 |      0 | 1     |        1 | Transmit buffer, matches cycle count, not locked and committed | MA           |
| 1           |     0 |      0 | -     |        1 | Receive buffer, matches cycle count, not locked                | SB           |
| 2 (lowest)  |     0 |      1 | -     |        1 | Receive buffer, matches cycle count, locked                    | SB           |

If there are multiple MBs with highest priority, CC selects the MB with the lowest MB number. All MBs that have the highest priority must have a consistent channel assignment as specified in MB channel assignment consistency.

Depending on the MB channel assignment, the same MB can be found for both channel A and channel B. In this case, use this MB as described in Individual MBs.

## 56.2.9.1 MB cycle counter filtering

The MB cycle counter filter is a value-mask filter defined by the CCFE, CCFMSK, and CCFVAL fields in MB Cycle Counter Filter (MBCCFR0 - MBCCFR255). This filter determines a set of communication cycles in which the MB is considered for message reception or transmission. If the cycle counter filter is disabled (MBCCFRn[CCFE] = 0), this set of cycles consists of all communication cycles.

If the MB cycle counter filter does not match a certain communication cycle number, this MB is not considered for message transmission or reception in that communication cycle. In case of a transmit MB assigned to a slot in the static segment, though, this buffer is added to the matching MBs to indicate the slot assignment and to trigger the null-frame transmission.

The MB cycle counter filter matches the communication cycle with the number CYCCNT if at least one of the following conditions evaluates to true:

- MBCCFRn[CCFE] = 0
- CYCCNT &amp; MBCCFRn[CCFMSK] = MBCCFRn[CCFVAL] &amp; MBCCFRn[CCFMSK]

## 56.2.9.2 MB channel assignment consistency

The MB channel assignment given by the CHA and CHB fields in MB Cycle Counter Filter (MBCCFR0 - MBCCFR255) defines the channels on which the MB receives or transmits. The MB with number n transmits or receives:

- On channel A if MBCCFRn[CHA] = 1
- On channel B if MBCCFRn[CHB] = 1

To ensure correct MB operation, all MBs assigned to the same slot and with the same priority must have a consistent channel assignment. That means they must be either assigned to one channel only, or must be assigned to both channels. The behavior of the MB search is undefined if both types of channel assignments occur for one slot and priority. The following figure illustrates an inconsistent channel assignment for MB 0 and MB 1.

FlexRay Communication Controller (FlexRay)

<!-- image -->

## 56.2.9.3 Node-related slot multiplexing

Node-related slot multiplexing applies only to the dynamic segment and refers to the functionality in which transmit as well as receive MBs are configured for the same slot.

According to Table 525, the transmit buffer is found only if the cycle counter filter matches and the buffer is not locked and committed. In all other cases, the receive buffer is found. Thus, if the block has no data to transmit in a dynamic slot, it can receive frames on that slot.

## 56.2.9.4 MB search error

This section describes the types of errors that may occur during the MB search.

FIFO reception is not affected by the search errors. Additionally, if no receive buffer has been found because of a search error, the received frame is considered for FIFO reception.

## 56.2.9.4.1 MB search start while running

If the MB search is running in slot n-1 and the next MB search start event appears because of the start of slot n, the MB search engine stops and CC sets the MB search-error flag (CHIERFR[MBS\_EF]). As a result of this stop, no individual MB is identified for transmission or reception in slot n. Additionally, the search engine does not start in slot n, and consequently no individual MB is identified for transmission or reception in slot n+1.

An MB search error appears only if the CHI frequency is too slow to allow the search through all MBs to be completed within the NIT or a minislot.

For more details of the minimum required CHI frequency, see Number of usable MBs.

## 56.2.9.4.2 Illegal MB index found

If the MB search has finished the MB search in slot n-1, it retrieves the data offset values for the found MBs and the receive shadow buffers. If one of these MBs contains an illegal MB index, CC sets the MB search-error flag (CHIERFR[MBS\_EF]) and no individual MB is identified for transmission or reception in slot  n. Receive Shadow Buffer Index (RSBIR) and MB Index (MBIDXR0 - MBIDXR255) specify the legal MB index values for the individual and receive shadow buffers.

## 56.2.10 Individual MB reconfiguration

Individual MB reconfiguration is the ability to change the initial configuration of each individual MB even when the protocol is not in the POC:config state. The configuration bits and fields that can be changed are given in the section on specific configuration data. The common configuration data given in the section on specific configuration data cannot be reconfigured when the protocol is out of the POC:config state.

## 56.2.10.1 Reconfiguration schemes

This section discusses possible reconfiguration schemes. The choice of scheme depends on the target and destination basic states of the to-be-reconfigured MB.

## 56.2.10.1.1 Basic type not changed (RC1)

If you do not change MBCCSRn[MTD], a reconfiguration does not change the basic type of the individual MB. MB reconfiguration scheme labels this type of reconfiguration as RC1. You can use RC1 reconfiguration for transmit and receive MBs when they are in the HDis or HDisLck state.

## 56.2.10.1.2 Buffer type not changed (RC2)

A reconfiguration does not change the buffer type of the individual MB. MB reconfiguration scheme labels this type of reconfiguration as RC2. It applies to transmit and receive MBs. You can use RC1 reconfiguration for transmit and receive MBs when they are in the HDis or HDisLck state.

## 56.2.10.1.3 MB reconfiguration scheme

<!-- image -->

## 56.2.11 Receive FIFOs

## 56.2.11.1 Overview

The two receive FIFOs implement the queued MB concept defined by the FlexRay Communications System Protocol Specification, Version 2.1 Rev A. One FIFO is assigned to channel A, the other FIFO is assigned to channel B. Both FIFOs work completely independently from each other.

Receive FIFOdescribes the MB structure of each FIFO. The area in the FlexRay memory area for each of the two FIFOs is characterized by:

- The FIFO system memory base address
- The index of the first FIFO entry given by Receive FIFO Start Index (RFSIR)
- The offset of the data field belonging to the first FIFO entry given by Receive FIFO Start Data Offset (RFSDOR)
- The number of FIFO entries and the length of each FIFO entry as given by Receive FIFO Depth And Size (RFDSR)

## 56.2.11.2 FIFO configuration

The FIFOs can be configured for two different locations of the system memory base address via MCR[FAM].

## 56.2.11.2.1 Single System Memory Base Address mode

You enter this mode by writing 0 to MCR[FAM]. In this mode, the location of the system memory base address for the FIFO buffers is System Memory Base Address High (SYMBADHR).

## 56.2.11.2.2 Dual System Memory Base Address mode

You enter this mode by writing 1 to MCR[FAM]. In this mode, the location of the system memory base address for the FIFO buffers is Receive FIFO System Memory Base Address High (RFSYMBADHR).

Receive FIFO control and configuration data provides the FIFO control and configuration data. The configuration of the FIFOs consists of these steps:

1. Allocation of the required amount of FlexRay memory area for the FlexRay window. This includes the allocation of the MB header area and the allocation of the MB data fields. For more details, see FlexRay memory area layout.
2. Programming of the configuration data register while PE is in the POC:config state.

The following steps configure the FIFO layout:

1. Configure the FIFO update and address modes in Module Configuration (MCR).
2. Configure the FIFO system memory base address.
3. Configure Receive FIFO Start Index (RFSIR) with the first MB header index that belongs to the FIFO.

FlexRay Communication Controller (FlexRay)

FlexRay Communication Controller (FlexRay)

4. Configure the Receive FIFO Start Data Offset Register (RFSDOR) with the data field offset of the data field belonging to the first MB that belongs to the FIFO.
5. Configure Receive FIFO Start Data Offset (RFSDOR) with the FIFO entry size.
6. Configure Receive FIFO Depth And Size (RFDSR) with the FIFO depth.
7. Configure the FIFO filters.

## 56.2.11.3 FIFO periodic timer

The FIFO periodic timer is used to generate a FIFO almost-full interrupt at certain point in time, if the almost-full watermark is not reached, but the FIFO is not empty. You can use this to prevent frames from getting stuck in the FIFO for a long time.

You configure this timer via RFPTR[PTD].

Table 526. Effect of RFPTR[PTD] on FIFO periodic timer operation

| RFPTR[PTD] (hex)   | Effect                                                                                                                          |
|--------------------|---------------------------------------------------------------------------------------------------------------------------------|
| 0                  | The timer constantly expires.                                                                                                   |
| 1-3FFE             | The timer expires and restarts at both of the following events: • The start of every communication cycle • After RFPTR[PTD] MTs |
| 3FFF               | The timer never expires.                                                                                                        |

## 56.2.11.4 FIFO reception

FIFO reception is a CC-internal operation.

CC directs a message-frame reception into the FIFO if no individual MB is assigned for transmission or subscribed for reception using the current slot. In this case, the FIFO filter path shown in Figure 520 activates.

If the FIFO filter path indicates that the received frame must be appended to the FIFO and the FIFO is not full, CC writes the received frame header into the MB header field indicated by the CC internal FIFO write index. The frame payload data are written into the corresponding MB data field. If the status of the received frame indicates a valid non-null frame, CC:

- Writes the slot-status information into the MB header field
- Increments the CC internal FIFO write index by 1
- Increments the FLA or FLB subfields in Receive FIFO Fill Level and Pop Count (RFFLPCR)

If the status of the received frame indicates an invalid or null frame, CC does not append the frame to the FIFO.

## 56.2.11.5 FIFO almost-full interrupt generation

CC sets the corresponding FIFO almost-full interrupt flag (FAFAIF or FAFBIF in Global Interrupt Flag And Enable (GIFER)) when either of the following occurs:

- The FIFO fill level (FLA or FLB subfields in Receive FIFO Fill Level and Pop Count (RFFLPCR)) is updated after a frame reception and exceeds the FIFO watermark level WM-that is, FLA &gt; WMA or FLB &gt; WMB
- The periodic timer expires and FIFOA or FIFOB is not empty-that is, FLA &gt; 0 or FLB &gt; 0

## 56.2.11.6 FIFO overflow error generation

CC sets the corresponding FIFO overflow error flag (FOVA\_EF or FOVB\_EF in CHI Error Flag (CHIERFR)) when both of the following occur:

FlexRay Communication Controller (FlexRay)

- FIFOA or FIFOB is full-that is, the FLA subfield of Receive FIFO Fill Level and Pop Count (RFFLPCR) equals FIFO\_DEPTHA or the FLB subfield of Receive FIFO Fill Level and Pop Count (RFFLPCR) equals FIFO\_DEPTHB
- FIFO reception meets the conditions described in FIFO reception

## 56.2.11.7 FIFO message access

FIFOA or FIFOB contains valid messages if the FIFO fill level given in the FLA or FLB subfields in Receive FIFO Fill Level and Pop Count (RFFLPCR) is greater than 0. In this case, Receive FIFO A Read Index (RFARIR) and Receive FIFO B Read Index (RFBRIR) point to an MB with valid content and the oldest frames stored in the FIFO. You can calculate the respective read data field offsets using Equation 40.

FIFOA or FIFOB does not contain any valid messages if the FIFO fill level given in the FLA or FLB subfields in Receive FIFO Fill Level and Pop Count (RFFLPCR) is 0. In this case:

- Receive FIFO A Read Index (RFARIR) and Receive FIFO B Read Index (RFBRIR) point to an MB with invalid content.
- You must not read data from this FIFO.

To access the oldest message in FIFOA or FIFOB, you first read RFARIR[RDIDX] or RFBRIR[RDIDX]. This read index points to the MB header field of the oldest MB that contains valid received message data. You must calculate the data field offset belonging to this MB using Equation 40. You can access the message data as described in Receive FIFO. When you have read the MB data and status information, you can update the FIFO as described in FIFO update.

## 56.2.11.8 FIFO update

This section uses the following variables:

- pc = Pop count value greater than 0
- fl = Fill level as indicated by the FLA or FLB subfield in Receive FIFO Fill Level and Pop Count (RFFLPCR)

You update FIFOA or FIFOB by writing pc to the PCA or PCB subfield in Receive FIFO Fill Level and Pop Count (RFFLPCR). As a result of this operation, CC removes the oldest pc entries from FIFOA or FIFOB.

If pc &gt; fl, then CC removes only fl entries from FIFOA or FIFOB, and discards the remaining fl-pc requested pop operations notifying you. In this case, FIFOA or FIFOB is empty after the update operation.

The read index (RFARIR[RDIDX] or RFBRIR[RDIDX]) increments by the number of removed items. If the read index reaches the top of the FIFO, it automatically wraps around to the FIFO start index defined in Receive FIFO Start Index (RFSIR).

## 56.2.11.9 FIFO Interrupt Flag Update mode

You enter this mode by writing 0 to MCR[FUM]. In this mode, CC updates FIFOA or FIFOB by 1 entry when you set the corresponding interrupt flag (GIFER[FAFAIF] or GIFER[FAFBIF]).

If the FIFO is empty, CC ignores the update request without notifying you.

The read index in the Receive FIFO A Read Index Register (RFARIR) (Receive FIFO B Read Index Register (RFBRIR)) is incremented by 1, if the FIFO was not empty. If the read index reaches the top of the FIFO, it wraps around to the FIFO start index automatically.

The read index (RFARIR[RDIDX] or RFBRIR[RDIDX]) increments by 1 if the FIFO is not empty. If the read index reaches the top of the FIFO, it automatically wraps around to the FIFO start index.

## 56.2.11.10 FIFO filtering

CC activates FIFO filtering after all enabled individual receive MBs have been searched without success for an MB to receive the current frame.

CC provides three sets of FIFO filters, which it applies only to valid non-null frames. The FIFO does not receive invalid or null frames. For each FIFO filter, the pass criteria are specified in the related section below. Only frames that have passed all filters are appended to the FIFO. The following figure illustrates the FIFO filter path.

FlexRay Communication Controller (FlexRay)

<!-- image -->

A received frame passes the FIFO filtering if it has passed all three types of filter.

## 56.2.11.10.1 RX FIFO FID value-mask rejection filter

Receive FIFO Frame ID Rejection Filter Value (RFFIDRFVR) and Receive FIFO Frame ID Rejection Filter Mask (RFFIDRFMR) define this filter. Each received frame with an FID that does not match the value-mask filter value passes the filter-that is, it is not rejected.

Consequently, a received valid frame passes the RX FIFO FID value-mask rejection filter if the following equation is fulfilled:

FID &amp; RFFIDRFMR[FIDRFMSK] ≠ RFFIDRFVR[FIDRFVAL] &amp; RFFIDRFMR[FIDRFMSK]

## Equation 46. Equation for filter passing

You can configure the RX FIFO FID value-mask rejection filter to pass all frames by using the following settings:

- RFFIDRFVR[FIDRFVAL] = 0h
- RFFIDRFMR[FIDRFMSK] = 7FFh

Using the settings above, CC rejects only the frame with FID = 0 (which is an invalid frame). CC passes all other frames.

You can configure the RX FIFO FID value-mask rejection filter to reject all frames by writing 0h to RFFIDRFMR[FIDRFMSK]. With this setting, Equation 46 can never be fulfilled (0 ≠ 0) and thus CC rejects all frames. This is the reset value for the RX FIFO.

## 56.2.11.10.2 RX FIFO FID range rejection filter

You can configure each of the four RX FIFO FID range filters as a rejection filter. You set up and control the filters by using Receive FIFO Range Filter Configuration (RFRFCFR) and Receive FIFO Range Filter Control (RFRFCTR), respectively. The RX FIFO FID range filters apply to all received valid frames. A received frame passes the RX FIFO FID range rejection filters when either of the following is true:

- You have not enabled any rejection filter.
- All of the enabled RX FIFO FID range rejection filters (that is, with RFRFCTR[FnMD] = 1 and RFRFCTR[FnEN] = 1) fulfill Equation 47.

FID &lt; RFRFCFRSEL[SIDIBD=0] or (RFRFCFR SEL [SID IBD=1 ] &lt; FID)

## Equation 47. Equation for passing

Consequently, all frames with an FID that fulfill Equation 48 for at least one of the enabled rejection filters are rejected and thus do not pass.

RFRFCFRSEL[SIDIBD=0] ≤ FID ≤ RFRFCFRSEL[SIDIBD=1 ]

## Equation 48. Equation for rejecting

## 56.2.11.10.3 RX FIFO FID range acceptance filter

You can configure each of the four RX FIFO FID range filters as an acceptance filter. You set up and control the filters by using Receive FIFO Range Filter Configuration (RFRFCFR) and Receive FIFO Range Filter Control (RFRFCTR), respectively. The RX FIFO FID range filters apply to all received valid frames. A received frame passes the RX FIFO FID range acceptance filters when either of the following is true:

- You have not enabled any acceptance filter.
- All of the enabled RX FIFO FID range acceptance filters (that is, with RFRFCTR[FnMD] = 0 and RFRFCTR[FnEN] = 1) fulfill Equation 49.

RFRFCFRSEL[SIDIBD=0] ≤ FID ≤ RFRFCFRSEL[SIDIBD=1 ]

## Equation 49. Equation for passing

FlexRay Communication Controller (FlexRay)

## 56.2.11.10.4 RX FIFO message ID acceptance filter

Receive FIFO Message ID Acceptance Filter Value (RFMIDAFVR) and Receive FIFO Message ID Acceptance Filter Mask (RFMIDAFMR) define this value-mask filter. This filter applies only to valid frames received in the dynamic segment with the payload preamble indicator bit PPI equal to 1. All other frames pass this filter.

A received valid frame in the dynamic segment with the payload preamble indicator bit PPI equal to 1 and with the message ID MID (the first two bytes of the payload) pass the RX FIFO message ID acceptance filter if the following equation is fulfilled.

MID &amp; RFMIDAFMR[MIDAFMSK] = RFMIDAFMR[MIDAFVAL] &amp; RFMIDAFMR[MIDAFMSK]

## Equation 50. Equation for passing

You can configure the RX FIFO message ID acceptance filter to accept all frames by writing 0 to RFMIDAFMR[MIDAFMSK]. Using this setting, Equation 50 is always fulfilled and all frames pass.

## 56.2.12 Channel device modes

This section describes the FlexRay channel device modes that CC supports.

## 56.2.12.1 Dual Channel Device mode

In this mode, both FlexRay ports connect to physical FlexRay bus lines:

- The port consisting of FR\_A\_RX, FR\_A\_TX, and FR\_A\_TX\_EN\_b connects to the physical bus channel A.
- The port consisting of FR\_B\_RX, FR\_B\_TX, and FR\_B\_TX\_EN\_b connects to the physical bus channel B.

The following figure shows the dual-channel system.

<!-- image -->

## 56.2.12.2 Single Channel Device mode

This mode supports chips that have only one FlexRay port available. This FlexRay port consists of these signals:

- FR\_A\_RX
- FR\_A\_TX
- FR\_A\_TX\_EN\_b

and can be connected to either the physical bus channel A (shown in Figure 522) or the physical bus channel B (shown in Figure 523).

FlexRay Communication Controller (FlexRay)

<!-- image -->

If  you have configured the chip as a single-channel device (by writing 1 to MCR[SCM]), only the internal channel A and the FlexRay Port A is used. Depending on MCR[CHA] and MCR[CHB], the internal channel A behaves as FlexRay Channel A or B.

You must write 1 to MCR[CHA] if the FlexRay Port A is connected to FlexRay Channel A.

You must write 1 to MCR[CHB] if the FlexRay Port A is connected to FlexRay Channel B.

The two FlexRay channels differ only in the initial value for the frame CRC cCrcInit. For a single-channel device, you can access and configure only the registers related to internal channel A.

## 56.2.13 External clock synchronization

You trigger the application of external rate and offset correction when you write to the EOC\_AP and ERC\_AP fields in Protocol Operation Control (POCR). PE applies the external correction values in the next even-odd cycle pair as shown in Figure 524 and Figure 525.

FlexRay Communication Controller (FlexRay)

<!-- image -->

## NOTE

The values in the EOC\_AP and ERC\_AP fields are the values that you last wrote.. If these value were already applied, they are not applied in the current cycle pair again.

If the external offset correction affects the offset correction applied in the NIT of cycle 2n+1, you must write to POCR[EOC\_AP] after the start of cycle 2n and before the end of the static segment of cycle 2n+1. If you write to this field after the end of the static segment of cycle 2n+1, it is not guaranteed that the external correction value is applied in cycle 2n+1. If the value is not applied in cycle 2n+1, then the value is applied in cycle 2n+3. See Figure 524 for timing details.

If the the external offset correction affects the rate correction for the cycle pair [2n+2, 2n+3], you must write to POCR[ERC\_AP] after the start of cycle 2n and before the end of the static segment start of cycle 2n+1. If you write to this field after the end of the static segment of cycle 2n+1, it is not guaranteed that the external correction value is applied in cycle pair [2n+2, 2n+3]. If the value is not applied for cycle pair [2n+2, 2n+3], then the value is applied for cycle pair [2n+4, 2n+5]. See Figure 525 for details.

## 56.2.14 Sync FID and sync frame deviation tables

The FlexRay protocol requires the provision of a snapshot of the synchronization FID tables for the even and odd communication cycle for both channels. CC allows you to write a copy of these internal tables into the FlexRay memory area and provides table locking to ensure that you have access to consistent tables. After you have locked the table successfully, CC does not overwrite these tables and you can read a consistent snapshot.

## NOTE

Only synchronization frames that have passed the synchronization frame filters are considered for clock synchronization and appear in the sync frame tables.

## 56.2.14.1 Sync FID table content

The sync FID table is a snapshot of the protocol-related variables vsSyncIdListA and vsSyncIdListB for each even and odd communication cycle. This table provides a list of the FIDs of the synchronization frames received by the corresponding channel and cycle that are used for clock synchronization.

## 56.2.14.2 Sync frame deviation table content

The sync frame deviation table is a snapshot of the protocol-related variable zsDev(id)(oe)(ch)!Value. Each sync frame deviation table entry provides the deviation value for the sync frame, with the FID presented in the corresponding entry in the sync FID table.

FlexRay Communication Controller (FlexRay)

<!-- image -->

## 56.2.14.3 Setup of sync FID and sync frame deviation tables

CC writes a copy of the internal sync FID and deviation tables into the FlexRay memory area if you request this. You must provide the appropriate amount of FlexRay memory area for the tables. See Figure 526 for the memory layout of the tables. Each table occupies 120 16-bit entries.

When the protocol is in the POC:config state, you must program the offsets for the tables into Sync Frame Table Offset (SFTOR).

## 56.2.14.4 Generation of the sync FID and sync frame deviation tables

You control the generation of the sync FID and sync frame deviation tables and their copying into the FlexRay memory area using Sync Frame Table Configuration Control Status (SFTCCSR). The following table summarizes the copy modes.

## Table 527. Sync frame table generation modes

| SFTCCSR   | SFTCCSR   | SFTCCSR   | Description                                                             |
|-----------|-----------|-----------|-------------------------------------------------------------------------|
| OPT       | SDVEN     | SIDEN     |                                                                         |
| 0         | 0         | 0         | No sync frame table copy                                                |
| 0         | 0         | 1         | Sync FID tables are copied continuously                                 |
| 0         | 1         | 0         | Reserved                                                                |
| 0         | 1         | 1         | Sync FID tables and sync frame deviation tables are copied continuously |

Table continues on the next page...

Table 527. Sync frame table generation modes (continued)

| SFTCCSR   | SFTCCSR   | SFTCCSR   | Description                                                                             |
|-----------|-----------|-----------|-----------------------------------------------------------------------------------------|
| OPT       | SDVEN     | SIDEN     |                                                                                         |
| 1         | 0         | 0         | No sync frame table copy                                                                |
| 1         | 0         | 1         | Sync FID tables for next even-odd-cycle pair are copied                                 |
| 1         | 1         | 0         | Reserved                                                                                |
| 1         | 1         | 1         | Sync FID tables and sync frame deviation tables for next even-odd-cycle pair are copied |

The remainder of this section describes the sync frame table generation process for the even cycle. The same sequence applies to the odd cycle.

If you enabled the sync frame table generation by writing 1 to SFTCCSR[SIDEN], CC starts the update of the even cycle related tables after the start of the NIT of the next even cycle. CC checks if you locked the tables by reading SFTCCSR[ELKS]. If that field is 1, CC does not update the table in this cycle. If that field is 0, CC locks this table and starts the table update. To indicate that these tables are currently updated and may contain inconsistent data, CC changes SFTCCSR[EVAL] to 0. After CC transfers all table entries related to the even cycle to the FlexRay memory area, CC changes SFTCCSR[EVAL] and PIFR1[EVT\_IF] to 1. If PIER1[EVT\_IE] = 1, CC generates an interrupt request is generated.

To read the generated tables, you must lock the tables to prevent CC from updating them. You initiate the locking by writing 1 to SFTCCSR[ELKT]. When CC is not currently updating the even table, the lock is granted and SFTCCSR[ELKS] becomes 1. This indicates that you have successfully locked the even sync tables and the corresponding status-information fields (SFRA and SFRB) in Sync Frame Counter (SFCNTR). . SFTCCSR[CYCNUM] provides the number of the cycle that this table is related to.

The SFEVA and SFEVB fields in Sync Frame Counter (SFCNTR) provide the number of available table entries per channel. You can now read the sync table data from the locations given in Figure 526.

After reading all the data from the locked tables, you must unlock the table by writing to SFTCCSR[ELKT] again. CC then changes SFTCCSR[ELKS] to 0 immediately.

If the sync frame table generation is disabled, CC changes SFTCCSR[EVAL] to 0 when the counter values in Sync Frame Counter (SFCNTR) are updated. This occurs because the tables stored in the FlexRay memory area are no longer related to the values in Sync Frame Counter (SFCNTR).

<!-- image -->

## 56.2.14.5 Sync frame table access

CC transfers the sync frame tables to the FlexRay memory area during the table write windows shown in Figure 526. During the table write, you cannot lock the table that is currently written. If you lock the table outside of the table write window, CC grants the lock immediately.

## 56.2.14.6 Sync frame table locking and unlocking

You lock the even or odd sync frame table by writing 1 to SFTCCSR[ELKT] or SFTCCSR[OLKT], respectively. If the affected table is not currently written to the FlexRay memory area, CC grants the lock immediately, and SFTCCSR[ELKS] or SFTCCSR[OLKS] becomes 1. If the affected table is currently written to the FlexRay memory area, CC does not grant the lock. In this case, you must issue the lock request again until CC grants the lock.

FlexRay Communication Controller (FlexRay)

FlexRay Communication Controller (FlexRay)

Similarly, you unlock the even or odd sync frame table by writing 1 to SFTCCSR[ELKT] or SFTCCSR[OLKT], respectively. After you do this, SFTCCSR[ELKS] or SFTCCSR[OLKS] become 0 immediately.

## 56.2.15 MTS generation

CC provides a flexible means to request the MTS transmission in the symbol window of channel A or channel B.

You can configure the set of communication cycles in which CC transmits MTS over the FlexRay bus. Do this by writing to the CYCCNTMSK and CYCCNTVAL fields of MTS A Configuration (MTSACFR) and MTS B Configuration (MTSBCFR).

You enable or disables the MTS generation for either channel by writing 1 or 0 to MTSACFR[MTE] or MTSBCFR[MTE], respectively. If an MTS must be transmitted in a certain communication cycle, you must write 1 to the appropriate MTE field during the static segment of the preceding communication cycle.

CC transmits MTS over channel A in the communication cycle with number CYCCNT if all the following conditions are fulfilled:

- PSR0[PROTSTATE] = POC:normalactive
- MTSACFR[MTE] = 1
- CYCCNT &amp; MTSACFR[CYCCNTMSK] = MTSACFR[CYCCNTVAL] &amp; MTSACFR[CYCCNTMSK]

CC transmits MTS over channel B in the communication cycle with number CYCCNT if all the following conditions are fulfilled:

- MTSBCFR[MTE] = 1
- CYCCNT &amp; MTSBCFR[CYCCNTMSK] = MTSBCFR[CYCCNTVAL] &amp; MTSBCFR[CYCCNTMSK]

## 56.2.16 Key slot transmission

## 56.2.16.1 Key slot assignment

A key slot is assigned to CC if you the value you write to PCR18[key\_slot\_id] satisfies the expression 0 &lt; PCR18[key\_slot\_id] ≤ PCR2[number\_of\_static\_slots]. Otherwise, no key slot is assigned.

## 56.2.16.2 Key slot transmission in POC:startup

If a key slot is assigned and CC is in the POC:startup state, startup null frames are transmitted as specified by FlexRay Communications System Protocol Specification, Version 2.1 Rev A.

## 56.2.16.3 Key slot transmission in POC:normal active

If a key slot is assigned and CC is in POC:normal active state, a frame of the type shown in the following table is transmitted. If a transmit MB is configured for the key slot and a valid message is available, a message frame is transmitted (see Message transmission). If no transmit MB is configured for the key slot or no valid message is available, a null frame is transmitted (see Null frame transmission).

## Table 528. Key slot frame type

| Fields in Protocol Configuration 11 (PCR11)   | Fields in Protocol Configuration 11 (PCR11)   | Key slot frame type                                                                                                    |
|-----------------------------------------------|-----------------------------------------------|------------------------------------------------------------------------------------------------------------------------|
| key_slot_used_for_sync                        | key_slot_used_for_startup                     | Key slot frame type                                                                                                    |
| 0                                             | 0                                             | Normal frame                                                                                                           |
| 0                                             | 1                                             | Normal frame1; the frame transmitted has a semantically-incorrect header and the receiver detects the frame as invalid |
| 1                                             | 0                                             | Sync frame                                                                                                             |
| 1                                             | 1                                             | Startup frame                                                                                                          |

## 56.2.17 Sync frame filtering

Each received synchronization frame must pass the sync frame acceptance and rejection filters before it is considered for clock synchronization. If the synchronization frame filtering is globally disabled (MCR[SFFE] = 0), all received synchronization frames are considered for clock synchronization. If a received synchronization frame did not pass at least one of the two filters, this frame is processed as a normal frame and is not considered for clock synchronization.

## 56.2.17.1 Sync frame acceptance filtering

The synchronization frame acceptance filter is implemented as a value-mask filter. You configure the value and mask by using Sync Frame ID Acceptance Filter Value (SFIDAFVR) and Sync Frame ID Acceptance Filter Mask (SFIDAFMR), respectively. A received synchronization frame passes the sync frame acceptance filter if the following conditions are met:

- MCR[SFFE] = 0
- FID &amp; SFIDAFMR[FMSK] = SFIDAFVR[FVAL] &amp; SFIDAFMR[FMSK]

Sync frames are transmitted only in the static segment. Thus FID ≤ 1023.

## 56.2.17.2 Sync frame rejection filtering

The synchronization frame rejection filter is a comparator. Sync Frame ID Rejection Filter (SFIDRFR) defines the compare value. A received synchronization frame passes the sync frame rejection filter if the following conditions are met:

- MCR[SFFE] = 0
- FID ≠ SFIDRFR[SYNFRID]

Sync frames are transmitted only in the static segment. Thus FID ≤ 1023.

## 56.2.18 Strobe signal support

CC provides a number of strobe signals for observing internal PE signals related to timing. Table 551 lists and describes these signals.

## 56.2.18.1 Strobe signal assignment

You can assign each of the strobe signals listed in Table 551 to one of the four strobe ports using Strobe Signal Control (STBSCR). To assign multiple strobe signals, you must write multiple times to STBSCR with appropriate settings.

To read out the current settings for a strobe signal with number n, execute the following sequence:

1. In STBSCR, write 1 to WMD and n to SEL. (This step updates only the SEL field.)
2. Read STBCSR.

The SEL field provides n and the ENB and STBPSEL fields provide the settings for signal n.

## 56.2.18.2 Strobe signal timing

This section provides detailed timing information of the strobe signals with respect to the PE clock.

The strobe signals display internal PE signals. Due to its internal architecture, PE generates some signals several PE clock cycles before the actual action is performed on the FlexRay bus. Table 551 lists these signals with a negative clock offset. Figure 528 shows an example waveform with negative clock offset.

FlexRay Communication Controller (FlexRay)

FlexRay Communication Controller (FlexRay)

<!-- image -->

Other signals refer to events that occurred on the FlexRay bus some cycles before the strobe signal changed. Table 551 lists these signals with a positive clock offset. Figure 529 shows an example waveform with positive clock offset.

<!-- image -->

## 56.2.19 Timer support

CC provides two timers that run on the FlexRay time base:

- T1-absolute timer
- T2-configurable as an absolute or a relative timer

Each timer generates a maskable interrupt when the timer reaches a configured point in time.

You can configure both timers to be repetitive. In non-repetitive operation, the timer stops when it expires. In repetitive operation, the timer restarts when it expires.

Both timers are active only when the protocol is in POC:normal active or POC:normal passive state. If the protocol is not in one of these states, the timers stop. You must restart the timers when the protocol reaches the POC:normal active or POC:normal passive states.

## 56.2.19.1 T1 (absolute)

T1, the absolute timer, has the protocol cycle count and the macrotick count as the time base. CC sets the timer 1 interrupt flag (PIFR0[TI1\_IF]) at the macrotick start event if the following equations are fulfilled:

- CYCTR[CYCCNT] &amp; TI1CYSR[T1\_CYC\_MSK] = TI1CYSR[T1\_CYC\_VAL] &amp; TI1CYSR[T1\_CYC\_MSK]
- MTCTR[MTCT] = TI1MTOR[T1\_MTOFFSET]

If PIER0[TI1\_IE] = 1, CC generates an interrupt request.

CC changes TICCR[T1ST] to 1 when the timer is triggered, then changes T1ST to 0 when the timer expires and is non-repetitive. If the timer expires but is repetitive, CC does not change T1ST to 0 and the timer restarts immediately. CC changes T1ST to 0 when the timer stops.

The corresponding interrupt condition-that is, when the aforementioned equations are fulfilled-also leads to an event-out indication on an output port (fr\_evt\_tim1) based on PEOER[TIM1\_EE].

## 56.2.19.2 T2 (absolute or relative)

You can configure T2 to be an absolute or relative timer by using TICCR[T2\_CFG]. CC writes 1 to TICCR[T2ST] when the timer is triggered, and writes 0 to T2ST when the timer expires and is non-repetitive. If the timer expires but is repetitive, CC does not write 0 to and the timer restarts immediately. CC also writes 0 to T2ST when the timer stops.

## 56.2.19.2.1 T2 as an absolute timer

If you configured T2 as an absolute timer, it has the same functionality as timer T1, but uses the configuration from Timer 2 Configuration 0 (Absolute Timer Configuration) (TI2CR0\_ABS) and Timer 2 Configuration 1 (Absolute Timer Configuration) (TI2CR1\_ABS).

After T2 expires, CC sets the corresponding interrupt flag (PIFR0[TI2\_IF]). If PIER0[TI1\_IE] = 1, CC generates an interrupt request.

The corresponding interrupt condition for T2 also leads to an event-out indication on an output port (fr\_evt\_tim2) based on PEOER[TIM2\_EE].

## 56.2.19.2.2 T2 as a relative timer

If you configured T2 as a relative timer, CC sets the corresponding interrupt flag (PIFR0[TI2\_IF]) when the programmed amount of MTs (defined by Timer 2 Configuration 0 (Relative Timer Configuration) (TI2CR0\_REL) and Timer 2 Configuration 1 (Relative Timer Configuration) (TI2CR1\_REL)) expires after you triggered or restarted T2. The relative timer is implemented as a down counter and expires when it reaches 0. At the MT start event, the timer checks the number of MTs and then decrements that number. Thus, if you start the timer with zero MTs, it expires at the next MT start.

The corresponding interrupt condition for T2 also causes an event-out indication on an output port (fr\_evt\_tim2) based on PEOER[TIM2\_EE].

## 56.2.20 Slot status monitoring

CC provides several methods for slot status monitoring. All slot status monitors use the same slot status vector that PE provides. PE provides this vector for the following on a per-channel basis:

- Each static slot
- Each dynamic slot
- The symbol window
- The NIT

PE provides the slot status vector within the first MT after the end of the related slot, window, or NIT as shown in the figure below. The slot status for the NIT of cycle n is provided after the start of cycle n+1.

FlexRay Communication Controller (FlexRay)

<!-- image -->

The following table describes the content of the slot status vector.

## Table 529. Slot status vector content

|                        | Status content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Static or dynamic slot | Slot-related status: vSS!ValidFrame - valid frame received vSS!SyntaxError - syntax error occurred while receiving vSS!ContentError - content error occurred while receiving vSS!BViolation - boundary violation while receiving For slots in which the module transmits: vSS!TxConflict - reception ongoing while transmission starts For slots in which the module does not transmit: vSS!TxConflict - reception ongoing while transmission starts first valid - channel that has received the first valid frame Received frame related status, extracted from: Header of valid frame, if vSS!ValidFrame = 1 Last received header, if vSS!ValidFrame = 0 Set to 0, if nothing was received vRF!Header!NFIndicator - Null Frame Indicator (0 for null frame) vRF!Header!SuFIndicator - Startup Frame Indicator |
| Symbol window          | Window-related status:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

Table continues on the next page...

Table 529. Slot status vector content (continued)

|     | Status content                                                                                                                                                                                                                                                                                                                                                                           |
|-----|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|     | vSS!ValidFrame - always 0 vSS!ContentError - content error occurred while receiving vSS!SyntaxError - syntax error occurred while receiving vSS!BViolation - boundary violation while receiving vSS!TxConflict - reception ongoing while transmission starts Received symbol-related status: vSS!ValidMTS - valid MTS received Received frame-related status: see static or dynamic slot |
| NIT | NIT-related status: vSS!ValidFrame - always 0 vSS!ContentError - content error occurred while receiving vSS!SyntaxError - syntax error occurred while receiving vSS!BViolation - boundary violation while receiving vSS!TxConflict - always 0 Received frame-related status: see static or dynamic slot                                                                                  |

## 56.2.20.1 Channel status error counter registers

Channel A Status Error Counter Register (CASERCR) and Channel B Status Error Counter (CBSERCR) increment by one if at least one of the following slot-status error bits is 1:

- vSS!SyntaxError
- vSS!ContentError
- vSS!BViolation
- vSS!TxConflict

The status vectors for all slots in the static and dynamic segment, in the symbol window, and in the NIT are taken into account. The counters wrap round after they have reached the maximum value.

## 56.2.20.2 Protocol status registers

Protocol Status 2 (PSR2) provides slot status information about the NIT and the symbol window.

Protocol Status 3 (PSR3) provides the aggregated slot-status information.

## 56.2.20.3 Slot status registers

You can use Slot Status (SSR0 - SSR7) to observe the status of:

- Static slots
- Dynamic slots
- The symbol window
- The NIT without individual MBs

FlexRay Communication Controller (FlexRay)

These registers provide all information related to slot status and the status of received frames or symbols, as given in Table 529, except for the first valid indicator for non-transmission slots.

## 56.2.20.4 Slot status counter registers

CC provides slot status error counter registers (Slot Status Counter (SSCR0 - SSCR3)). Each of these registers is updated with the value of an internal slot status counter (SSCRn\_INT) at the start of a communication cycle. The internal slot status counter increments if its increment condition, defined by Slot Status Counter Condition (SSCCR), matches the status vector that PE provided. All static slots, the symbol window, and the NIT status are taken into account. Dynamic slots are excluded.

The following figure shows the internal slot status counting and update timing.

Figure 531. Slot status counting and SSCRn update

<!-- image -->

PE provides the NIT status in the first slot of the next cycle. Because of these facts, the respective SSCRn register reflects, in cycle n, the status of the NIT of cycle n-2, and the status of all static slots and the symbol window of cycle n-1.

The increment condition for each slot status counter consists of two parts-frame-related condition and slot-related condition. SSCRn\_INT increments if at least one of the conditions is fulfilled:

- Frame-related condition:

```
(SSCCRn[VFR] | SSCCRn[SYF] | SSCCRn[NUF] | SSCCRn[SUF]) // count on frame condition = 1; and ((~SSCCRn[VFR] | vSS!ValidFrame) &                // valid frame restriction (~SSCCRn[SYF] | vRF!Header!SyFIndicator) &        // sync frame indicator restriction (~SSCCRn[NUF] | ~vRF!Header!NFIndicator) &        // null frame indicator restriction (~SSCCRn[SUF] | vRF!Header!SuFIndicator))         // startup frame indicator restriction = 1;
```

The SYF, NUF, and SUF fields are valid only when a valid frame was received. Thus you must always write 1 to VFR whenever count on frame condition is used.

- Slot-related condition:

```
= 1;
```

FlexRay Communication Controller (FlexRay)

```
((SSCCRn[STATUSMASK[3]] & vSS!SyntaxError) |      // increment on syntax error (SSCCRn[STATUSMASK[2]] & vSS!ContentError) |      // increment on content error (SSCCRn[STATUSMASK[1]] & vSS!BViolation) |        // increment on boundary violation (SSCCRn[STATUSMASK[0]] & vSS!TxConflict))         // increment on transmission conflict
```

If the slot status counter is in Single-Cycle mode (SSCCRn[MCY] = 0), SSCRn\_INT resets at the start of each cycle. If the slot status counter is in Multicycle mode (SSCCRn[MCY] = 1), the counter does not reset or increment until it reaches the maximum value.

## 56.2.20.5 MB slot-status field

Each individual MB and each FIFO MB provides a slot-status field that provides the information shown in Table 529 for the static or dynamic slot. The update conditions for the slot-status field depend on the MB type. See the MB update sections in Individual MB configuration data.

## 56.2.21 System bus access

This section provides a description of the system bus accesses failures and the related CC behavior. System bus access failures may occur when CC transfers data to or from the FlexRay memory area.

## 56.2.21.1 System bus access failure types

## 56.2.21.1.1 System bus illegal address access

A system bus illegal address access is detected when CC used an illegal or invalid address to access the FlexRay system memory area. The following conditions are treated as a system bus illegal address access:

- The system bus subsystem detects a CC access to an illegal system memory address.
- CC detects the usage of a data field offset with a value of 0.
- CC detects a memory error while reading a data field offset from the CHI LRAM (see CHI LRAM error response after CC read).

If a system bus illegal address access is detected, CC sets the CHIERFR[ILSA\_EF] flag.

## 56.2.21.1.2 System bus access timeout

A system bus access timout is detected if an access to the FlexRay memory area does not finish before a specified timeout value (see SYMATOR[TIMEOUT] and Configure SYMATOR[TIMEOUT] and CHI clock frequency).

If a system bus access timout is detected, CC sets the CHIERFR[SBCF\_EF] flag.

## 56.2.21.2 System bus access failure response

This section describes the two types of CC behavior after a system bus access failure occurs. MCR[SBFF] defines the actual behavior.

## 56.2.21.2.1 Continue after system bus access failure

## If MCR[SBFF] = 0, CC:

- Continues its operation after the occurrence of the system bus access failure.
- Does not generate any system bus accesses until the start of the next communication cycle.

Because no data is read from or written to the FlexRay memory area, no messages are received or transmitted. Consequently, none of the individual MBs or receive FIFOs are updated until the next communication cycle starts.

FlexRay Communication Controller (FlexRay)

If a system bus failure occurs during frame transmission, a correct frame is generated with the remaining header and all frame data is replaced by zeros. Depending on the moment in time, this can affect:

- The PPI field
- The header CRC
- The payload length (in case of a dynamic slot)
- The payload data

Starting from the next slot in the current cycle, no frames are transmitted and received, except for the key slot, where a sync or startup null-frame is transmitted, if the key slot is assigned.

If a frame is received when the system bus failure occurs, the reception is aborted and the related receive MB is not updated.

Normal operation resumes after the start of the next communication cycle.

## 56.2.21.2.2 Freeze after system bus access failure

If MCR[SBFF] = 1, CC enters Freeze mode immediately after one of the system bus access failures occurs.

## 56.2.22 Interrupt support

CC provides 300 individual interrupt sources and five combined interrupt sources.

## 56.2.22.1 Individual interrupt sources

## 56.2.22.1.1 MB interrupts

CC provides 256 MB interrupt sources.

Each individual MB provides an interrupt flag (MBCCSRn[MBIF]) and an interrupt-enable field (MBCCSRn[MBIE]). CC sets the interrupt flag when the MB slot status is updated. If MBCCSRn[MBIE] = 1, CC generates an interrupt request.

## 56.2.22.1.2 FIFO interrupts

CC provides two FIFO interrupt sources.

Each of the two FIFOs provides a "receive FIFO almost full" interrupt flag (GIFER[FAFAIF] and GIFER[FAFBIF]). CC sets these flags when the corresponding receive-FIFO fill level exceeds the defined watermark.

## 56.2.22.1.3 Wakeup interrupt

CC provides one wakeup-related interrupt source.

CC sets the wakeup interrupt flag GIFER[WUPIF] when CC receives a wakeup symbol on the FlexRay bus. When GIFER[WUPIE] = 1, CC generates an interrupt request.

## 56.2.22.1.4 Protocol interrupts

CC provides 25 interrupt sources for protocol-related events. See Protocol Interrupt Flag 0 (PIFR0) and Protocol Interrupt Flag 1 (PIFR1) for details. Each interrupt source has its own interrupt-enable field.

## 56.2.22.1.5 CHI interrupts

CC provides 16 interrupt sources for CHI-related error events. See CHI Error Flag (CHIERFR) for details. One common interrupt-enable field (GIFER[CHIE]) services all CHI error interrupt sources.

## 56.2.22.2 Combined interrupt sources

Each combined interrupt source generates an interrupt request only when at least one of the individual constituent interrupt sources generates an interrupt request.

## 56.2.22.2.1 Receive MB interrupt

CC generates the receive MB interrupt request when at least one of the individual receive MBs generates an interrupt request MBXIRQ[n] and GIFER[RBIE] = 1.

## 56.2.22.2.2 Transmit MB interrupt

CC generates the transmit MB interrupt request when at least one of the individual transmit MBs generates an interrupt request MBXIRQ[n] and GIFER[TBIE] = 1.

## 56.2.22.2.3 Protocol interrupt

CC generates the protocol interrupt request when at least one of the individual protocol interrupt sources generates an interrupt request and GIFER[PRIE] = 1.

## 56.2.22.2.4 CHI interrupt

CC generates the CHI interrupt request when at least one of the individual CHI error interrupt sources generates an interrupt request and GIFER[CHIE] = 1.

## 56.2.22.2.5 Module interrupt

CC generates the module interrupt request if at least one of the combined interrupt sources generates an interrupt request and GIFER[MIE] = 1.

## 56.2.22.3 Interrupt signal generation schemes

## 56.2.22.3.1 GIFER

<!-- image -->

## 56.2.22.3.2 EEIFER

<!-- image -->

## 56.2.22.3.3 CIFR

<!-- image -->

## 56.2.23 Lower bit rate support

CC supports a number of lower bit rates on the FlexRay bus channels. You implement lower bit rates by modifying:

- The duration of the µT (pdMicrotick)
- The number of samples per µT (pSamplesPerMicrotick)
- The number of samples per bit (cSamplesPerBit)
- The strobe offset (cStrobeOffset)

You configure the FlexRay channel bit rate with MCR[BITRATE]. The protocol values are set internally.

The following table shows the available bit rates, the related BITRATE field configuration settings, and the related protocol parameter values.

NOTE

The FlexRay Communications System Protocol Specification, Version 2.1 Rev A, does not define the 8 Mbit/s bit rate.

Table 530. FlexRay channel bit rate control

|   FlexRay channel bit rate (Mbit/s) |   MCR[BITRATE] (binary) |   pdMicrotick (ns) |   gdSampleCloc kPeriod (ns) |   pSamplesPer Microtick |   cSamplesPer Bit |   cStrobeOffset |
|-------------------------------------|-------------------------|--------------------|-----------------------------|-------------------------|-------------------|-----------------|
|                                10   |                     000 |                 25 |                        12.5 |                       2 |                 8 |               5 |
|                                 8   |                     011 |                 25 |                        12.5 |                       2 |                10 |               6 |
|                                 5   |                     001 |                 25 |                        25   |                       1 |                 8 |               5 |
|                                 2.5 |                     010 |                 50 |                        50   |                       1 |                 8 |               5 |

## 56.2.24 Protocol engine data memory (PE DRAM)

PE DRAM is a 128-word, 16-bit wide memory with byte access. It contains the program data of PE's internal CPU. PE DRAM is divided into two banks of 8 bits each. The memory data [7:0] is assigned to BANK0, and the memory data [15:8] is assigned to BANK1.

Table 531. PE DRAM layout

| ADDR (hex)   | BANK1    | BANK0    |
|--------------|----------|----------|
| 0            | Byte 1   | Byte 0   |
| 1            | Byte 3   | Byte 2   |
| ...          | ...      | ...      |
| 7F           | Byte 255 | Byte 254 |

CC allows you access to PE DRAM. You initiate and control this access by using PE DRAM Access (PEDRAR). You use this functionality to check the memory error detection.

## 56.2.24.1 PE DRAM read access

You can initiate a read access from PE DRAM in any protocol state. The following pseudocode describes a read access from PE DRAM address 70h.

```
PEDRAR:= 50E0h;              // INST=5h; ADDR=70h Wait until PEDRAR[DAD] == 1; // wait for end of PE DRAM access
```

FlexRay Communication Controller (FlexRay)

```
Val = PEDRDR[DATA];          // read PE DRAM data Code Listing 1. Pseudocode example for a PE DRAM read access
```

The PE-internal CPU with the lowest execution priority manages the read access. This may cause a maximum response delay of 1000 PE clock cycles (25 µs).

## 56.2.24.2 PE DRAM write access

You can initiate a write access to PE DRAM in any protocol state. The following pseudocode describes a write access to PE DRAM address 70h.

```
PEDRDR:= DATA;               // write value to be written into data register PEDRAR:= 30E0h;              // INST=3h; ADDR=70h Wait until PEDRAR[DAD] == 1; // wait for end of PE DRAM access Val = PEDRDR[DATA];          // read back PE DRAM data Code Listing 2. Pseudocode example for a PE DRAM write access
```

The PE-internal CPU with the lowest execution priority manages the write access. This may cause a maximum response delay of 1000 PE clock cycles (25 µs).

If the conditions in PE DRAM write access limitations are fulfilled, the data provided in PE DRAM Access (PEDRAR) is:

1. Written to PE DRAM.
2. Read back in the next clock cycle.
3. Stored in PEDRAR.

Otherwise, data is not written into PE DRAM and 0h is stored in PEDRAR.

## 56.2.24.3 PE DRAM write access limitations

PE uses PE DRAM if PE is not in the "POC:default config" state. The only address that PE does not use is 70h. To prevent the corruption of PE data, the following PE DRAM write access limitations apply for application writes:

- When PE is in the "POC:default config" state, all PE DRAM addresses are writable.
- When PE is not in the "POC:default config" state, the only writable PE DRAM address is 70h.

## 56.2.25 CHI LRAM

CHI LRAM is a CHI-internal memory that contains the MB configuration data and the data field offsets for the physical MBs. One memory row contains the configuration data for two MBs or six data field offsets. CHI LRAM is divided into six memory banks, BANK0-BANK5.

## Table 532. CHI LRAM layout

|   ADR (hex) | BANK5   | BANK4   | BANK3   | BANK2   | BANK1   | BANK0   |
|-------------|---------|---------|---------|---------|---------|---------|
|           0 | MBIDXR1 | MBFIDR1 | MBCCFR1 | MBIDXR0 | MBFIDR0 | MBCCFR0 |
|           1 | MBIDXR3 | MBFIDR3 | MBCCFR3 | MBIDXR2 | MBFIDR2 | MBCCFR2 |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

## Table 532. CHI LRAM layout (continued)

| ADR (hex)   | BANK5     | BANK4     | BANK3     | BANK2     | BANK1     | BANK0     |
|-------------|-----------|-----------|-----------|-----------|-----------|-----------|
| 7F          | MBIDXR255 | MBFIDR255 | MBCCFR255 | MBIDXR254 | MBFIDR254 | MBCCFR254 |
| 80          | MBDOR5    | MBDOR4    | MBDOR3    | MBDOR2    | MBDOR1    | MBDOR0    |
| ...         | ...       | ...       | ...       | ...       | ...       | ...       |
| AB          | -         | -         | -         | -         | MBDOR259  | MBDOR258  |
| AC          | LEETR5    | LEETR4    | LEETR3    | LEETR2    | LEETR1    | LEETR0    |

## 56.2.25.1 CHI LRAM read and write access

You access CHI LRAM by using regular register read and write accesses.

## 56.2.26 Memory content fault detection

CC provides integrated memory content error detection for CHI LRAM and PE DRAM, as well as memory content error correction for PE DRAM.

The CHI LRAM memory error detection:

- Uses a standard Hamming code with a Hamming distance of 3.
- Detects all single-bit and double-bit errors (SEDDED).

The PE DRAM memory error detection and correction:

- Uses an enhanced Hamming code with a Hamming distance of 4.
- Detects and corrects all single-bit errors and detects all double-bit errors (SECDED).

This section describes:

- The reporting of the occurrence of memory content errors.
- CC's reaction to the occurrence.
- How you can inject memory errors to trigger the report and response behaviors.

## 56.2.26.1 Memory error types

A memory error is the distortion of one or more bits read out of the memory. A special case involves the reading of all zeros and all ones.

CC detects and indicates the memory errors as shown in the following table. The entries on the top have higher priority.

Table 533. Detected memory error types

| Memory   | Priority    | Memory data      | Indication         |
|----------|-------------|------------------|--------------------|
| CHI LRAM | 0 (highest) | All zeros        | Noncorrected error |
| PE DRAM  | 0 (highest) | All zeros        | Noncorrected error |
| CHI LRAM | 0 (highest) | All ones         | Noncorrected error |
| PE DRAM  | 0 (highest) | All ones         | Noncorrected error |
| CHI LRAM | 1 (lowest)  | One bit flipped  | Noncorrected error |
| PE DRAM  | 1 (lowest)  | One bit flipped  | Corrected error    |
| CHI LRAM | 1 (lowest)  | Two bits flipped | Noncorrected error |

Table continues on the next page...

Table 533. Detected memory error types (continued)

| Memory           | Priority   | Memory data          | Indication                                                                                                                                |
|------------------|------------|----------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| PE DRAM CHI LRAM |            | or more bits flipped | One of the following: • No error • Noncorrected error as defined by the coding in CHI LRAM checkbits and CHI LRAM syndrome                |
| PE DRAM          |            |                      | One of the following: • No error • Corrected error • Uncorrected error as defined by the coding in PE DRAM checkbits and PE DRAM syndrome |

Each memory read access reads all banks of the addressed row, and runs error detection on all banks, even when you triggered a read from only one bank. This may lead to the reporting of a memory error if at least one bank contains a memory error, even if an error-free bank has been read.

## 56.2.26.2 Memory error reporting

The memory error reporting is enabled only if MCR[ECCE] = 1.

Each of the two memories has two sets of internal registers to store the detection of one corrected and one non-corrected memory error.

If CC detects a memory error, CC checks whether the related error-interrupt flag in ECC Error Interrupt Flag And Enable (EEIFER) is set. Then:

- If the flag is set, CC does not update the related internal error-reporting register and sets the related error-overflow flag to indicate a loss-of-error condition.
- If the is not set, CC updates the internal reporting register and sets the error-interrupt flag. If CC detects two or more memory errors of the same type, CC reports the error for the bank with the lower bank number and sets the error-overflow flag.

If a memory error is detected for at least two banks of one memory, CC sets the related error-overflow flag to indicate a loss-of-error condition.

CC also sends the error indications (corrected or noncorrected) and the failing address to you for external error logging and corrective actions.

## 56.2.26.2.1 PE DRAM checkbits

The following table shows the coding of the checkbits reported in ECC Error Report Code (EERCR) for PE DRAM memory errors. This table shows the implemented enhanced Hamming code. If the error injection is applied to distort the checkbits, then the distorted checkbits are reported. This checkbit coding ensures that neither 0h nor FFFh are valid code words and written to the memory.

FlexRay Communication Controller (FlexRay)

## Table 534. PE DRAM checkbit coding

| CODE   | CODE   | CODE   | CODE   | CODE   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   |
|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| CODE   | 3      | 2      | 1      | 0      | 7      | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
| 4 1    | X      | X      | X      | X      | X      | X      | X      | X      | X      | X      | X      | X      |
| 3 2    | -      | -      | -      | -      | X      | X      | X      | X      | -      | -      | -      | -      |
| 2      | -      | -      | -      | -      | X      | -      | -      | -      | X      | X      | X      | -      |
| 1      | -      | -      | -      | -      | -      | X      | X      | -      | X      | X      | -      | X      |
| 0      | -      | -      | -      | -      | -      | X      | -      | X      | X      | -      | X      | X      |

1. The checkbit CODE[4] becomes 1 if and only if there is an even number of 1s in columns with X.
2. The checkbits CODE[3]...CODE[0] become 1 if and only if there is an odd number of 1s in all columns with X.

## 56.2.26.2.2 PE DRAM syndrome

The following table shows the coding of the syndrome reported in ECC Error Report Code (EERCR) for PE DRAM memory errors.

## Table 535. EERCR[CODE] PE DRAM syndrome coding

| EERCR[CODE]   | EERCR[CODE]    | Description                                                                                                            |
|---------------|----------------|------------------------------------------------------------------------------------------------------------------------|
| Bit 4         | Bits 3-0 (hex) | Description                                                                                                            |
| 1             | 0              | No error (never appears in error-report registers)                                                                     |
| 0             | 0              | If data = 0: noncorrected error (dedicated handling of all-zero code word) If data ≠ 0: corrected error (parity bit 4) |
| 0             | 1              | Corrected error (parity bit 0)                                                                                         |
| 0             | 2              | Corrected error (parity bit 1)                                                                                         |
| 0             | 3              | Corrected error (data bit 0)                                                                                           |
| 0             | 4              | Corrected error (parity bit 2)                                                                                         |
| 0             | 5              | Corrected error (data bit 1)                                                                                           |
| 0             | 6              | Corrected error (data bit 2)                                                                                           |
| 0             | 7              | Corrected error (data bit 3)                                                                                           |
| 0             | 8              | Corrected error (parity bit 3)                                                                                         |
| 0             | 9              | Corrected error (data bit 4)                                                                                           |
| 0             | A              | Corrected error (data bit 5)                                                                                           |
| 0             | B              | Corrected error (data bit 6)                                                                                           |
| 0             | C              | Corrected error (data bit 7)                                                                                           |
| 0             | D-F            | Noncorrected error                                                                                                     |
| 1             | 1-F            |                                                                                                                        |

## 56.2.26.2.3 CHI LRAM checkbits

The following table shows the coding of the checkbits reported in reported in ECC Error Report Code (EERCR) for CHI LRAM memory errors. The table shows the implemented Hamming code. If the error injection is applied to distort the checkbits, then the distorted checkbits are reported.

Table 536. CHI LRAM checkbits coding

| CODE 1   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   | DATA   |
|----------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| CODE 1   | 15     | 14     | 13     | 12     | 11     | 10     | 9      | 8      | 7      | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
| 4        | X      | X      | X      | X      | X      | -      | -      | -      | -      | -      | -      | -      | -      | -      | -      | -      |
| 3        | -      | -      | -      | -      | -      | X      | X      | X      | X      | X      | X      | X      | -      | -      | -      | -      |
| 2        | X      | X      | -      | -      | -      | X      | X      | X      | X      | -      | -      | -      | X      | X      | X      | -      |
| 1        | -      | -      | X      | X      | -      | X      | X      | -      | -      | X      | X      | -      | X      | X      | -      | X      |
| 0        | X      | -      | X      | -      | X      | X      | -      | X      | -      | X      | -      | X      | X      | -      | X      | X      |

## 56.2.26.2.4 CHI LRAM syndrome

The following table shows the coding of the syndrome reported in ECC Error Report Code (EERCR) for CHI LRAM memory errors.

Table 537. EERCR[CODE] CHI LRAM syndrome coding

| EERCR[CODE] (hex)   | Description                                        |
|---------------------|----------------------------------------------------|
| 0                   | No error (never appears in error report registers) |
| 1-1F                | Noncorrected error                                 |

## 56.2.26.3 Memory error response

The memory error response is enabled only when MCR[ECCE] = 1.

If CC detects a corrected memory error, CC continues its normal operation using the corrected data word. This section describes how CC behaves after detecting a noncorrected memory error.

## 56.2.26.3.1 CHI LRAM error response after CC read

When CC is out of the POC:default config state, CC reads the configuration data and the data field offsets of all used MBs in every slot and in the NIT. If a noncorrected memory error is detected during this read access, CC's error response depends on the LRAM location where the error occurred.

- If the LRAM address belongs to physical MB configuration data, CC considers the affected MB as disabled for the current search and excludes this MB from the search. The configuration of the affected MB is not changed. If the affected MB is a transmit MB, no frame is transmitted from this MB in the next slot. If the affected MB is a receive MB, no frame is received to this MB in the next slot.
- If the LRAM address belongs to the data field offset area and the related physical MB is used for reception or transmission, the first access to the system memory caused by payload read or write causes CHIERFR[ILSA\_EF] to become 1. No memory access occurs with respect to payload access is performed for the complete frame.

FlexRay Communication Controller (FlexRay)

## 56.2.26.3.2 CHI LRAM error response after application read

You can read the content of the CHI LRAM from these registers:

- MB Cycle Counter Filter (MBCCFR0 - MBCCFR255)
- MB FID (MBFIDR0 - MBFIDR255)
- MB Index (MBIDXR0 - MBIDXR255)
- MB Data Field Offset (MBDOR0 - MBDOR259)
- LRAM ECC Error Test Register (LEETR0 - LEETR5)

If CC detects a noncorrected memory error during this kind of read access, CC:

- Indicates the detected memory error.
- Delivers the noncorrected data read.
- Continues its normal operation.

## 56.2.26.3.3 PE DRAM error response after CC read

If CC detects a noncorrected memory error during an internal read of program data that is contained in PE DRAM, CC treats this situation as a fatal protocol error and enters the protocol freeze state immediately.

## 56.2.26.3.4 PE DRAM error response after application read in the POC:default config state

If CC detects a noncorrected memory error during an application-triggered read from any PE DRAM address and the protocol is in the POC:default config state, CC considers this situation a fatal protocol error and enters the protocol freeze state. This behavior allows you to check the freeze functionality if CC detects noncorrected errors.

## 56.2.26.3.5 PE DRAM error response after application read out of the POC:default config state

If CC detects a noncorrected memory error during an application-triggered read from any PE DRAM address, and the protocol is not in the POC:default config state, CC does not consider this situation a fatal error and does not change the protocol state. This prevents PE DRAM error-injection reads from interfering with the running protocol.

## 56.2.27 Memory fault injection

Use error injection to inject data errors into the memories to trigger and check the memory error detection functionality.

Error injection is enabled only if you write 1 to both of the following:

- MCR[ECCE]
- EERICR[EIE]

You configure the error injection mode by using EERICR[EIM].

When error injection is enabled, each write access to the configured memory location is distorted.

The injector behaves identically for memory writes that you initiate and that CC initiates.

## 56.2.27.1 CHI LRAM error injection

The pseudocode in this section describes the memory-error injection sequence for the CHI LRAM:

1. Setup of the error injector (Code Listing 3)
2. Application-triggered access that writes data to the defined injection bank and address to provoke a distortion of the memory content (Code Listing 4)

See Table 532 for details of the CHI LRAM content.

FlexRay Communication Controller (FlexRay)

When CC is in the POC:default config state, there are no limitations for the error injection and no impacts of error injection to the application. When CC is not in the POC:default config state, see Memory fault injection out of POC:default config.

```
MCR[ECCE]:= 1;        // enable ECC functionality EERICR[EIE]:=I_MODE;  // configure error injection mode EEIAR[MID]:= 1;       // select CHI LRAM for error injection EEIAR[BANK]:= I_BANK; // select bank for error injection; I_BANK = {0,1,2,3,4,5} EEIAR[ADDR]:= I_ADDR; // select address for error injection; I_ADDR ≤ ACh EEIDR[DATA]:= D_DIST; // define data distortion pattern EEICR[CODE]:= C_DIST; // define checkbit distortion pattern EERICR[EIE]:= 1;      // enable error injection
```

```
If (I_BANK==0) → MBCCFR(2n) / MBDOR(6k) / LEETR0 := DATA; If (I_BANK==1) → MBFIDR(2n) / MBDOR(6k+1) / LEETR1 := DATA; If (I_BANK==2) → MBIDXR(2n) / MBDOR(6k+2) / LEETR2 := DATA; If (I_BANK==3) → MBCCFR(2n+1) / MBDOR(6k+3) / LEETR3 := DATA; If (I_BANK==4) → MBFIDR(2n+1) / MBDOR(6k+4) / LEETR4 := DATA; If (I_BANK==5) → MBIDXR(2n+1) / MBDOR(6k+5) / LEETR5 := DATA;
```

```
Code Listing 3. Pseudocode for injector setup Code Listing 4. Pseudocode for application write access
```

## 56.2.27.2 PE DRAM error injection

The pseudocode in this section describes the memory-error injection sequence for the PE DRAM:

1. Setup of the error injector (Code Listing 5)
2. Application-triggered access that writes data to the defined injection bank and address to provoke a distortion of the memory content (Code Listing 6)

See Table 532 for details of the CHI LRAM content.

When CC is in the POC:default config state, there are no limitations for the error injection and no impacts of error injection to the application. When CC is not in the POC:default config state, see PE DRAM error injection out of POC:default config.

```
MCR[ECCE]:= 1;        // enable ECC functionality EERICR[EIE]:=I_MODE;  // configure error injection mode EEIAR[MID]:= 0;       // select PE DRAM for error injection EEIAR[BANK]:= I_BANK; // define bank for error injection; I_BANK = {0,1} EEIAR[ADDR]:= I_ADDR; // define address for error injection; I_ADDR ≤ 7Fh EEIDR[DATA]:= D_DIST; // define data distortion pattern EEICR[CODE]:= C_DIST; // define checkbit distortion pattern EERICR[EIE]:= 1;      // enable error injection Code Listing 5. Pseudocode for injector setup PEDRAR:= 30E0h;             // INST = 3h; ADDR = 70h
```

```
Wait until PEDRAR[DAD] = 1  // wait for end of PE DRAM access val = PEDRDR[DATA];         // get read back PE DRAM data Code Listing 6. Pseudocode for application write access with I_ADDR = 70h
```

## NOTE

The write access to the PE DRAM triggers a subsequent read access from PE DRAM in the next cycle, which triggers the detection of the distorted data.

## 56.2.28 StopWatch function

The StopWatch function facilitates OS synchronization to the FlexRay network. This allows you to capture the time difference in system clocks between the operating system timer tick and the FlexRay time base. This allows the software synchronization handler to adjust the OS clock to sync with the FlexRay MT and are fulfilled.

Figure 535 shows the counter logic. A 32-bit stopwatch counter resets and starts with each cycle start. This counter runs on the system clock and increments every cycle until an OS tick event is received, after which the counter halts and the count value is transferred to a shadow register (STPWR). STPWR holds the counter value until the host reads all 32 bits, after which it automatically clears. PEOER[STPW\_EN]controls the StopWatch logic. The counter runs only when this field is 1.

<!-- image -->

Figure 536 shows the counter-logic timing. In this figure:

- "Host read" implies that the host has read all 32 bits completely. Any partial read (that is, for 8- or 16-bit access) does not change STPWR to 0.
- If "CHI cycle start" and "OS\_tick" occur simultaneously, the timer remains at 0. However, "OS\_tick" has a two-stage synchronizer and cycle\_start has a single-stage synchronizer into the CHI clock domain. Therefore, "simultaneously" here means OS\_tick\_pulse and chi\_cycle\_start occurring at the same cycle.

FlexRay Communication Controller (FlexRay)

FlexRay Communication Controller (FlexRay)

<!-- image -->

## 56.3 External signal description

This section lists and describes the CC signals connected to external pins. These signals are summarized in the following table.

For the exact signal names on this chip, see the IOMUX file attached to this document. The off-chip signals FR\_A\_RX, FR\_A\_TX, and FR\_A\_TX\_EN\_b are available in each package option. The availability of the other off-chip signals depends on the package option and is specific to the chip.

Table 538. External signal properties

| Name         | Direction   | Active   | Reset   | Function                 | Details                                                                                 |
|--------------|-------------|----------|---------|--------------------------|-----------------------------------------------------------------------------------------|
| FR_A_RX      | Input       | -        | -       | Receive data channel A   | Carries the receive data for channel Afromthe corresponding FlexRay bus driver          |
| FR_A_TX      | Output      | -        | 1       | Transmit data channel A  | Carries the transmit data for channel A to the corresponding FlexRay bus driver         |
| FR_A_TX_EN_b | Output      | Low      | 1       | Transmit enable channelA | Indicates to the FlexRay bus driver that CC is attempting to transmit data on channel A |
| FR_B_RX      | Input       | -        | -       | Receive data channel B   | Carries the receive data for channel Bfromthe corresponding FlexRay bus driver          |
| FR_B_TX      | Output      | -        | 1       | Transmit data channel B  | Carries the transmit data for channel B to the corresponding FlexRay bus driver         |
| FR_B_TX_EN_b | Output      | Low      | 1       | Transmit enable channelB | Indicates to the FlexRay bus driver that CC is attempting to transmit data on channel B |

Table continues on the next page...

Table 538. External signal properties (continued)

| Name      | Direction   | Active   |   Reset | Function       | Details                                                                                                                |
|-----------|-------------|----------|---------|----------------|------------------------------------------------------------------------------------------------------------------------|
| FR_DBG[0] | Output      | -        |       0 | Debug strobe 0 | Provide the selected debug strobe signals For details of the debug strobe signal selection, see Strobe signal support. |
| FR_DBG[1] | Output      | -        |       0 | Debug strobe 1 | Provide the selected debug strobe signals For details of the debug strobe signal selection, see Strobe signal support. |
| FR_DBG[2] | Output      | -        |       0 | Debug strobe 2 | Provide the selected debug strobe signals For details of the debug strobe signal selection, see Strobe signal support. |
| FR_DBG[3] | Output      | -        |       0 | Debug strobe 3 | Provide the selected debug strobe signals For details of the debug strobe signal selection, see Strobe signal support. |

## 56.4 Initialization

This section describes the required steps to initialize CC. The first subsection describes the steps required after a module reset, and the second section describes the steps required after a preceding CC shutdown.

## 56.4.1 CC initialization after a system reset

Perform these steps after a system reset:

1. Configure CC:
- a. Configure the control fields in Module Configuration (MCR).
- b. Configure the system memory base address in System Memory Base Address High (SYMBADHR) and System Memory Base Address Low (SYMBADLR).
2. Enable CC by writing 1 to MCR[MEN].

After you finish these steps, CC enters Normal mode. You can then initialize the protocol as described in Protocol initialization.

## 56.4.2 Protocol initialization

1. Configure PE:
- a. Issue a CONFIG command via Protocol Operation Control (POCR).
- b. Wait for POC:config in Protocol Status 0 (PSR0).
- c. Configure the PCR0-PCR30 registers to set all protocol parameters.
2. Set the number of MBs used and the MB segmentation in MB Segment Size and Utilization (MBSSUTR).
3. Define the MB data size in MB Data Size (MBDSR).
4. Configure each MB by writing the appropriate values to:
- MB Configuration Control Status (MBCCSR0 - MBCCSR255)
- MB Cycle Counter Filter (MBCCFR0 - MBCCFR255)
- MB FID (MBFIDR0 - MBFIDR255)
- MB Index (MBIDXR0 - MBIDXR255)
5. Configure the FIFOs.
6. Issue a CONFIG\_COMPLETE command via Protocol Operation Control (POCR).
7. Wait for POC:ready in Protocol Status 0 (PSR0).

After you finish these steps, CC is configured as a FlexRay node and is ready to integrate into the FlexRay cluster.

## 56.4.3 CHI LRAM initialization

CC initializes the CHI LRAM when CC exits Disabled mode. The unitization runs for 173 CHI clock cycles. All fields in the following registers initialize to 0:

- MB Configuration Control Status (MBCCSR0 - MBCCSR255)
- MB Cycle Counter Filter (MBCCFR0 - MBCCFR255)
- MB FID (MBFIDR0 - MBFIDR255)
- MB Data Field Offset (MBDOR0 - MBDOR259)
- LRAM ECC Error Test Register (LEETR0 - LEETR5)

All application read or write accesses to these registers are delayed until the initialization finishes.

## 56.4.4 PE DRAM initialization

CC initializes PE DRAM in the POC:default config state. This initialization runs for 4.8 µs and delays the state transition from POC:default config into POC:config.

## 56.5 Application information

## 56.5.1 CC configuration

## 56.5.1.1 Configure SYMATOR[TIMEOUT] and CHI clock frequency

For reliable CC operation, you must ensure that:

- SYMATOR[TIMEOUT] fulfills Equation 51. In Equation 51, fCHI is in MHz.

0 ≤ SYMATOR[TIMEOUT] ≤ [0.45• f CHI -8]

## Equation 51. Relationship between fCHI and SYMATOR[TIMEOUT]

For a given SYMATOR[TIMEOUT] value, you can increase fCHI without causing unreliable CC operation of the CC. Similarly, you can reduce the SYMATOR[TIMEOUT] value for a given fCHI.

Table 539 shows some example combinations of SYMATOR[TIMEOUT] values and minimum CHI frequencies.

## Table 539. Maximum SYMATOR[TIMEOUT] examples

|   f CHI (MHz) | SYMATOR[TIMEOUT]   |   f CHI | SYMATOR[TIMEOUT]   |
|---------------|--------------------|---------|--------------------|
|            18 | 0                  |     100 | ≤ 37               |
|            23 | ≤ 2                |     120 | ≤ 46               |
|            27 | ≤ 4                |     140 | ≤ 55               |
|            32 | ≤ 6                |     160 | ≤ 64               |
|            60 | ≤ 19               |     180 | ≤ 73               |
|            80 | ≤ 28               |     200 | ≤ 82               |

## 56.5.1.1.1 System bus wait state constraints

SYMATOR[TIMEOUT] corresponds directly to a certain acceptable number of wait states on the system bus.

For single-channel configurations, and if you do not use the sync-frame table generation (SFTCCSR[SDVEN] = SFTCCSR[SIDEN] = 0), no timeout is detected if fewer than 2×SYMATOR[TIMEOUT]+1 wait states are seen on the system bus for each system bus access.

FlexRay Communication Controller (FlexRay)

FlexRay Communication Controller (FlexRay)

For dual-channel configurations, or if you use the sync-frame table generation, no timeout is detected if fewer than SYMATOR[TIMEOUT]-1 wait states are seen on the system bus for each system bus access.

## 56.5.1.2 Configure data field offsets

The data field offsets are located in MB Data Field Offset (MBDOR0 - MBDOR259) and Receive FIFO Start Data Offset (RFSDOR). You must configure the data field offset values for all MBs that you use.

When CC is enabled, it initializes MBDORn[MBDO] and RFSDOR[SDO] to 0. This value is illegal (see System bus illegal address access).

## 56.5.2 Memory fault injection out of POC:default config

This section describes application-driven memory fault injection out of POC:default config. CC allows you to inject memory faults without any impact to CC's internal protocol operation.

## 56.5.2.1 CHI LRAM error injection out of POC:default config

CC never performs any internal read access from LRAM ECC Error Test Register (LEETR0 - LEETR5). Internal access never detects any memory errors injected into these CHI LRAM locations, regardless of the protocol state.

You can use these registers and related CHI LRAM location to inject memory errors into the CHI LRAM. CHI LRAM error injection describes the injection sequence.

## 56.5.2.2 PE DRAM error injection out of POC:default config

CC never performs any internal read access from the PE DRAM address 70h. This is the only PE DRAM address to which you can write when not in the POC:default config state.

You can use this PE DRAM location to inject memory errors into the PE DRAM. PE DRAM error injection describes the injection sequence.

## 56.5.3 Shutdown sequence

This section describes a secure shutdown sequence to stop CC gracefully. The purpose of this sequence is:

- Finish all ongoing reception and transmission.
- Do not corrupt the FlexRay bus.
- Do not disturb ongoing FlexRay bus communication.

For a graceful shutdown, you must follow this procedure:

1. Disable all enabled MBs by repeatedly writing 1 to MBCCSRn[EDT] until MBCCSRn[EDS] = 0.
2. Stop PE:
- a. Issue a HALT command by using Protocol Operation Control (POCR).
- b. Wait for POC:halt in PProtocol Status 0 (PSR0).

## 56.5.4 Number of usable MBs

This section describes the required minimum CHI clock frequency for:

- A specified number of used MBs configured in MB Segment Size and Utilization (MBSSUTR).
- A configured mini-slot length gdMinislot.
- A configured nominal MT length gdMacrotick.

CC uses a sequential search algorithm to determine the individual MB assigned or subscribed to the next slot. This search begins at the start of the slot and must finish before the start of the next slot.

## Equation 52. Minimum length of a correct slot

The MB search engine runs on the CHI clock and evaluates one individual MB per CHI clock cycle. For internal status update operations and to account for clock domain crossing jitter, you need an additional 27 CHI clock cycles to ensure correct search engine operation.

Equation 53 shows the search duration for a given number of used MBs MBSSUTR[LAST\_MB\_UTIL] + 1 and for a given CHI clock frequency f chi :

<!-- formula-not-decoded -->

## Equation 53. Search duration

The MB search must finish within one slot. This means you must fulfill Equation 54:

search ≤ ∆ slotmin ∆

## Equation 54. Slot length constraint

This results in Equation 55 that determines the required minimum CHI frequency for a given number of used MBs.

<!-- formula-not-decoded -->

## Equation 55. Equation for fchi

Table 540 shows the required minimum CHI clock frequency for a selected set of relevant protocol parameters and for MBSSUTR[LAST\_MB\_UTIL] = 255.

Table 540. Minimum fchi (in MHz) examples (256 MBs used)

| pdMicrotick (ns)   |   gdMinislot |   gdMinislot |   gdMinislot |   gdMinislot |   gdMinislot |   gdMinislot |
|--------------------|--------------|--------------|--------------|--------------|--------------|--------------|
| pdMicrotick (ns)   |          2   |          3   |          4   |          5   |          6   |          7   |
| 25.0               |        145.2 |         96.8 |         72.6 |         58.1 |         48.4 |         41.5 |
| 50.0               |         72.6 |         48.4 |         36.3 |         29.1 |         24.2 |         20.8 |

## NOTE

If you do not meet the minimum CHI frequency, CC sets the CHIERFR[MBS\_EF] flag. See CHI Error Flag (CHIERFR).

## 56.5.5 Protocol control command execution

You issue protocol-control commands by writing to POCR[POCCMD]. See the description of that field for a list of the commands. As a result, CC changes POCR[BSY\_WMC] to 1 while the command transfers to PE. PE accepts all commands. When PE accepts the command, CC changes POCR[BSY\_WMC] to 0.

FlexRay Communication Controller (FlexRay)

The shortest FlexRay slot is a corrected empty dynamic slot. A corrected empty dynamic slot is a mini-slot and consists of gdMinislot corrected MTs with a duration of gdMacrotick. The minimum duration of a corrected MT is gdMacrotick min = 39 µT. This results in a minimum length of a correct slot that Equation 52 shows.

slotmin = 39·pdMicrotick·gdMinislot ∆

PE maintains a protocol-command vector. For each command that PE accepts, PE changes the corresponding command bit in the protocol command vector to 1. If a command is issued while the corresponding command bit is 1, the command is not queued and is lost.

If the PE command execution block is idle, it selects the next accepted protocol command with the highest priority from the current protocol command vector according to the protocol control command priorities given in the following table. If the current protocol state does not allow the execution of this protocol command (see POC state changes in FlexRay Communications System Protocol Specification, Version 2.1 Rev A) CC sets the PIFR1[IPC\_IF] flag. The protocol command does not execute in this case.

The following table indicates that other commands, or the detection of a fatal protocol error, can interrupt some protocol commands. If you issue the FREEZE or READY command, or if PE detects a fatal protocol error, some commands already stored in the command vector are removed from this vector.

Table 541. Protocol control command priorities

| Protocol command   | Priority    | What interrupts the command                          | What clears and terminates the command               |
|--------------------|-------------|------------------------------------------------------|------------------------------------------------------|
| FREEZE             | (highest) 1 | none                                                 |                                                      |
| READY              | 2           | none                                                 |                                                      |
| CONFIG_COMPLETE    | 3           | none                                                 |                                                      |
| ALL_SLOTS          | 4           | FREEZE, READY, CONFIG_COMPLETE, fatal protocol error | FREEZE, READY, CONFIG_COMPLETE, fatal protocol error |
| ALLOW_COLDSTART    | 5           | FREEZE, READY, CONFIG_COMPLETE, fatal protocol error |                                                      |
| RUN                | 6           | FREEZE, READY, CONFIG_COMPLETE, fatal protocol error | FREEZE, fatal protocol error                         |
| WAKEUP             | 7           | FREEZE, READY, CONFIG_COMPLETE, fatal protocol error | FREEZE, fatal protocol error                         |
| DEFAULT_CONFIG     | 8           | FREEZE, READY, CONFIG_COMPLETE, fatal protocol error | FREEZE, fatal protocol error                         |
| CONFIG             | 9           | FREEZE, READY, CONFIG_COMPLETE, fatal protocol error |                                                      |
| HALT               | (lowest) 10 | FREEZE, READY, CONFIG_COMPLETE, fatal protocol error | FREEZE, READY, CONFIG_COMPLETE, fatal protocol error |

## 56.5.6 MB search with a simple MB configuration

This section describes the MB search behavior with a simplified MB configuration. The section does not discuss FIFO behavior.

## 56.5.6.1 Simple MB configuration

A simple MB configuration is a configuration that has at most one transmit MB and at most one receive MB assigned to a slot S. The simple configuration used in this section uses two MBs-one single-buffered transmit MB and one receive MB.

Table 542 shows the configuration for the transmit MB with number t:

Table 542. Transmit MB configuration

| Register   | Field   |   Value | Description     |
|------------|---------|---------|-----------------|
| MBCCSR t   | MTD     |       1 | Transmit buffer |

Table continues on the next page...

Table 542. Transmit MB configuration (continued)

| Register   | Field   | Value   | Description                     |
|------------|---------|---------|---------------------------------|
| MBCCFR t   | MTM     | 0       | Event transition mode           |
| MBCCFR t   | CHA     | 1       | Assigned to channel A           |
| MBCCFR t   | CHB     | 0       | Not assigned to channel B       |
| MBCCFR t   | CCFE    | 1       | Cycle counter filter enabled    |
| MBCCFR t   | CCFMSK  | 000011  | Cycle set = {4n} = {0,4,8,12,…} |
| MBCCFR t   | CCFVAL  | 000000  | Cycle set = {4n} = {0,4,8,12,…} |
| MBFIDR t   | FID     | S       | Assigned to slot S              |

MBCCSRt[CMT] and MBCCSRt[LCKS] indicate the availability of data in the transmit MB.

Table 543 shows the configuration for the receive MB with number r:

Table 543. Receive MB configuration

| Register   | Field   | Value   | Description                    |
|------------|---------|---------|--------------------------------|
| MBCCSR r   | MTD     | 0       | Receive buffer                 |
| MBCCFR r   | MTM     | -       | Not applicable                 |
| MBCCFR r   | CHA     | 1       | Assigned to channel A          |
| MBCCFR r   | CHB     | 0       | Not assigned to channel B      |
| MBCCFR r   | CCFE    | 1       | Cycle counter filter enabled   |
| MBCCFR r   | CCFMSK  | 000001  | Cycle set = {2n} = {0,2,4,6,…} |
| MBCCFR r   | CCFVAL  | 000000  | Cycle set = {2n} = {0,2,4,6,…} |
| MBFIDR r   | FID     | S       | Subscribed slot                |

Furthermore, the assumption is that both MBs are enabled (MBCCSRt[EDS] = MBCCSRr[EDS] = 1).

## NOTE

The cycle set {4n+2} = {2,6,10,…} is assigned to the receive buffer only.

The cycle set {4n} = {0,4,8,12,…} is assigned to both buffers.

## 56.5.6.2 Behavior in static segment

In this case, both MBs are assigned to a slot S in the static segment.

The configuration of a transmit buffer for a static slot S assigns this slot to the node as a transmit slot. When a slot occurs and is assigned to a node on a channel, the FlexRay protocol requires that node to transmit either a normal frame or a null frame on that channel. Specifically, a null frame is sent if no data is ready, or if no match occurs on a transmit filter (for example, cycle counter filtering).

FlexRay Communication Controller (FlexRay)

Regardless of the availability of data and the cycle counter filter, the node transmits a frame in the static slot S. In any case, the result of the MB search is the transmit MB t. The receive MB r is not found, and no reception is possible.

## 56.5.6.3 Behavior in dynamic segment

In this case, both MBs are assigned to a slot  S in the dynamic segment. When a slot occurs, and is assigned to a node on a channel, the FlexRay protocol requires that node to transmit a frame on that channel only if data is ready and a match occurs on relevant transmit filters (no null frames are sent).

The transmission of a frame in the dynamic segment is determined by the availability of data and the match of the cycle counter filter of the transmit MB.

## 56.5.6.3.1 Transmit data not available

If transmit data is not available-that is, the transmit buffer is not committed (MBCCSRt[CMT] = 0), locked (MBCCSRt[LCKS] = 1), or both-then both of the following occur:

- For the cycles in the set {4n}, which is assigned to both buffers, the receive buffer is found and the node can receive data.
- For the cycles in the set {4n+2}, which is assigned to the receive buffer only, the receive buffer is found and the node can receive data.

The following figure shows the receive cycles.

Figure 537. Transmit data not available

<!-- image -->

## 56.5.6.3.2 Transmit data available

If transmit data is available-that is, the transmit buffer is committed (MBCCSRt[CMT] = 1) and not locked (MBCCSRt[LCKS] = 0) -then both of the following occur:

- For the cycles in the set {4n}, which is assigned to both buffers, the transmit buffer is found and the node transmits data.
- For the cycles in the set {4n+2}, which is assigned to the receive buffer only, the receive buffer is found and the node can receive data.

The following figure shows the receive and transmit cycles.

Figure 538. Transmit data available

<!-- image -->

|   TX |   RX |    |   TX | RX   |    |   TX |    |   TX |    |   RX |    |
|------|------|----|------|------|----|------|----|------|----|------|----|
|    0 |    2 |  3 |    4 | 5 6  |  7 |    8 | 59 |   60 | 61 |   62 | 63 |

## 56.6 Register conventions and access

Table 544. Register access conventions

| Convention   | Description                                                                                                     |
|--------------|-----------------------------------------------------------------------------------------------------------------|
|              | Depending on its placement in the read or write row, indicates that the field is not readable or not writeable. |
| R *          | Reserved field; will not be changed. You must not write any value different from the reset value.               |

Table continues on the next page...

## Table 544. Register access conventions (continued)

| Convention   | Description                                                                                           |
|--------------|-------------------------------------------------------------------------------------------------------|
| FIELDNAME    | Identifies the field. Its presence in the read or write row indicates that it can be read or written. |

## Table 545. Register field types

| Convention   | Description                                                                                               |
|--------------|-----------------------------------------------------------------------------------------------------------|
| rwm          | A read/write field that hardware can modify in some fashion other than by a reset.                        |
| w1c          | Write one to clear. A flag field that you can read and return to 0 by writing 1. Writing 0 has no effect. |
| Reset value  |                                                                                                           |
| 0            | Resets to zero.                                                                                           |
| 1            | Resets to one.                                                                                            |
| -            | Not defined after reset and not affected by reset.                                                        |

## 56.6.1 Register reset

After a system reset, all registers except the following reset to their reset value:

- MB Cycle Counter Filter (MBCCFR0 - MBCCFR255)
- MB FID (MBFIDR0 - MBFIDR255)
- MB Index (MBIDXR0 - MBIDXR255)

The aforementioned registers are located in physical memory blocks and are therefore unaffected by reset.

For some register fields, additional reset conditions exist. The following table explains them.

Table 546. Additional register reset conditions

| Condition            | Description                                                                                                                                                                                                  |
|----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Protocol RUN command | The field resets when you write 0101b (corresponding to the RUN command) to POCR[POCCMD].                                                                                                                    |
| MB disable           | The field resets when you have disabled the MB. This happens when you write 1 to MBCCSR n [EDT] while the MB is enabled (MBCCSR n [EDS] = 1) and CC grants you the disabling by writing 0 to MBCCSR n [EDS]. |

## 56.6.2 Register write access

This section describes the write access restriction terms that apply to all registers.

## 56.6.2.1 Register write access restriction

The detailed register descriptions specify the write access conditions for each field. The table below describes the write access conditions. If none of the given write access conditions are fulfilled for a specific field, any write attempt to this field is ignored without any notification. The values of the fields are not changed. The condition term [A or B] indicates that the register or field

FlexRay Communication Controller (FlexRay)

can be written to if at least one of the conditions is fulfilled. The condition term [A and B] indicates that the register or field can be written to if both conditions are fulfilled.

Table 547. Register write access restrictions

| Condition     | Indication                                     | Description                                                    |
|---------------|------------------------------------------------|----------------------------------------------------------------|
| Any time      | -                                              | No write access restriction                                    |
| Disabled mode | MCR[MEN] = 0                                   | Write access only when CC is in Disabled mode                  |
| Normal mode   | MCR[MEN] = 1                                   | Write access only when CC is in Normal Mode                    |
| POC:config    | PSR0[PROTSTATE] = 1b (representing POC:config) | Write access only when the protocol is in the POC:config state |
| MB_DIS        | MBCCSR n [EDS] = 0                             | Write access only when related MB is disabled                  |
| MB_LCK        | MBCCSR n [LCKS] = 1                            | Write access only when related MB is locked                    |
| IDL           | EERICR[BSY] = 0                                | Write access only when ECC configuration is idle               |

## 56.6.2.2 Register write access requirements

All registers can be accessed with 8-bit, 16-bit, and 32-bit wide operations.

For some of the registers, at least a 16-bit wide write access is required to ensure correct operation. This write access requirement is described in FlexRay register descriptions. If an 8-bit wide write access is performed to any of these registers, this access is ignored without notification.

## 56.6.2.3 Internal register access

The following memory mapped registers are used to access multiple internal registers.

- Strobe Signal Control (STBSCR)
- Slot Status Selection (SSSR)
- Slot Status Counter Condition (SSCCR)
- Receive Shadow Buffer Configuration Data

Each of these memory mapped registers provides a SEL and a WMD field. The SEL field is used to select the internal register. The WMD field controls the write mode. If you write 0 to WMD during the write access, all fields of the internal register are updated. If you write 1 to WMD, only the SEL field is changed. All other fields of the internal register remain unchanged. This allows for reading back the values of the selected internal register in a subsequent read access.

## 56.6.3 PCRn fields

## Table 548. PCRn fields

| Name                | Description             | Min   | Max   | Unit   |   PCR # |
|---------------------|-------------------------|-------|-------|--------|---------|
| coldstart_attempts  | gColdstartAttempts      |       |       | number |       3 |
| action_point_offset | gdActionPointOffset - 1 |       |       | MT     |       0 |

Table continues on the next page...

Table 548. PCRn fields (continued)

| Name                                 | Description                                 | Min   | Max   | Unit       | PCR #   |
|--------------------------------------|---------------------------------------------|-------|-------|------------|---------|
| cas_rx_low_max                       | gdCASRxLowMax - 1                           |       |       | gdBit      | 4       |
| dynamic_slot_idle_phase              | gdDynamicSlotIdlePhase                      |       |       | minislot   | 28      |
| minislot_action_point_offset         | gdMinislotActionPointOffset - 1             |       |       | MT         | 3       |
| minislot_after_action_point          | gdMinislot - gdMinislotActionPointOffset -1 |       |       | MT         | 2       |
| static_slot_length                   | gdStaticSlot                                |       |       | MT         | 0       |
| static_slot_after_action_point       | gdStaticSlot - gdActionPointOffset - 1      |       |       | MT         | 13      |
| symbol_window_exists                 | gdSymbolWindow!=0                           | 0     | 1     | bool       | 9       |
| symbol_window_after_action_point     | gdSymbolWindow - gdActionPointOffset - 1    |       |       | MT         | 6       |
| tss_transmitter                      | gdTSSTransmitter                            |       |       | gdBit      | 5       |
| wakeup_symbol_rx_idle                | gdWakeupSymbolRxIdle                        |       |       | gdBit      | 5       |
| wakeup_symbol_rx_low                 | gdWakeupSymbolRxLow                         |       |       | gdBit      | 3       |
| wakeup_symbol_rx_window              | gdWakeupSymbolRxWindow                      |       |       | gdBit      | 4       |
| wakeup_symbol_tx_idle                | gdWakeupSymbolTxIdle                        |       |       | gdBit      | 8       |
| wakeup_symbol_tx_low                 | gdWakeupSymbolTxLow                         |       |       | gdBit      | 5       |
| noise_listen_timeout                 | (gListenNoise * pdListenTimeout) - 1        |       |       | µT         | 16/17   |
| macro_initial_offset_a               | pMacroInitialOffset[A]                      |       |       | MT         | 6       |
| macro_initial_offset_b               | pMacroInitialOffset[B]                      |       |       | MT         | 16      |
| macro_per_cycle                      | gMacroPerCycle                              |       |       | MT         | 10      |
| macro_after_first_static_slot        | gMacroPerCycle - gdStaticSlot               |       |       | MT         | 1       |
| macro_after_offset_correction        | gMacroPerCycle - gOffsetCorrectionStart     |       |       | MT         | 28      |
| max_without_clock_correction_fatal   | gMaxWithoutClockCorrectionFatal             |       |       | cyclepairs | 8       |
| max_without_clock_correction_passive | gMaxWithoutClockCorrectionPassive           |       |       | cyclepairs | 8       |
| minislot_exists                      | gNumberOfMinislots!=0                       | 0     | 1     | bool       | 9       |
| minislots_max                        | gNumberOfMinislots - 1                      |       |       | minislot   | 29      |

Table continues on the next page...

Table 548. PCRn fields (continued)

| Name                               | Description                                               | Min   | Max   | Unit       | PCR #   |
|------------------------------------|-----------------------------------------------------------|-------|-------|------------|---------|
| offset_correction_start            | gOffsetCorrectionStart                                    |       |       | MT         | 11      |
| payload_length_static              | gPayloadLengthStatic                                      |       |       | 2 bytes    | 19      |
| max_payload_length_dynamic         | pPayloadLengthDynMax                                      |       |       | 2 bytes    | 24      |
| first_minislot_action_point_offset | max(gdActionPointOffset, gdMinislotActionPointOffset) - 1 |       |       | MT         | 13      |
| allow_halt_due_to_clock            | pAllowHaltDueToClock                                      |       |       | bool       | 26      |
| allow_passive_to_active            | pAllowPassiveToActive                                     |       |       | cyclepairs | 12      |
| cluster_drift_damping              | pClusterDriftDamping                                      |       |       | µT         | 24      |
| comp_accepted_startup_range_a      | pdAcceptedStartupRange - pDelayCompensation[A]            |       |       | µT         | 22      |
| comp_accepted_startup_range_b      | pdAcceptedStartupRange - pDelayCompensation[B]            |       |       | µT         | 26      |
| listen_timeout                     | pdListenTimeout - 1                                       |       |       | µT         | 14/15   |
| key_slot_id                        | pKeySlotId                                                |       |       | number     | 18      |
| key_slot_used_for_startup          | pKeySlotUsedForStartup                                    |       |       | bool       | 11      |
| key_slot_used_for_sync             | pKeySlotUsedForSync                                       |       |       | bool       | 11      |
| latest_tx                          | gNumberOfMinislots - pLatestTx                            |       |       | minislot   | 21      |
| sync_node_max                      | gSyncNodeMax                                              |       |       | number     | 30      |
| micro_initial_offset_a             | pMicroInitialOffset[A]                                    |       |       | µT         | 20      |
| micro_initial_offset_b             | pMicroInitialOffset[B]                                    |       |       | µT         | 20      |
| micro_per_cycle                    | pMicroPerCycle                                            |       |       | µT         | 22/23   |
| micro_per_cycle_min                | pMicroPerCycle - pdMaxDrift                               |       |       | µT         | 24/25   |
| micro_per_cycle_max                | pMicroPerCycle + pdMaxDrift                               |       |       | µT         | 26/27   |
| micro_per_macro_nom_half           | round(pMicroPerMacroNom / 2)                              |       |       | µT         | 7       |
| offset_correction_out              | pOffsetCorrectionOut                                      |       |       | µT         | 9       |
| rate_correction_out                | pRateCorrectionOut                                        |       |       | µT         | 14      |
| single_slot_enabled                | pSingleSlotEnabled                                        |       |       | bool       | 10      |

Table continues on the next page...

## Table 548. PCRn fields (continued)

| Name                     | Description                                     | Min            | Max            | Unit           |   PCR # |
|--------------------------|-------------------------------------------------|----------------|----------------|----------------|---------|
| wakeup_channel           | pWakeupChannel                                  | See Table 549. | See Table 549. | See Table 549. |      10 |
| wakeup_pattern           | pWakeupPattern                                  |                |                | number         |      18 |
| decoding_correction_a    | pDecodingCorrection + pDelayCompensation[A] + 2 |                |                | µT             |      19 |
| decoding_correction_b    | pDecodingCorrection + pDelayCompensation[B] + 2 |                |                | µT             |       7 |
| key_slot_header_crc      | Header CRC for key slot                         | 0h             | 7FFh           | number         |      12 |
| extern_offset_correction | pExternOffsetCorrection                         |                |                | µT             |      29 |
| extern_rate_correction   | pExternRateCorrection                           |                |                | µT             |      21 |

## Table 549. Wakeup channel selection

|   wakeup_channel | Wakeup channel   |
|------------------|------------------|
|                0 | A                |
|                1 | B                |

## 56.7 FlexRay register descriptions

This section provides detailed descriptions of all registers in ascending address order, presented as 16-bit wide entities.

CC occupies 8 KB (8192 bytes) of address space starting at the CC base address defined by the chip memory map.

Do not access these address offsets:

- Ah

because corresponding features are unavailable.

You can write to the following registers only with 16-bit writes:

- Strobe Signal Control (STBSCR)
- PE DRAM Access (PEDRAR)
- PE DRAM Data (PEDRDR)
- Sync Frame ID Rejection Filter (SFIDRFR)
- Slot Status Selection (SSSR)
- Slot Status Counter Condition (SSCCR)
- Receive Shadow Buffer Index (RSBIR)
- Receive FIFO Range Filter Configuration (RFRFCFR)
- MB Cycle Counter Filter (MBCCFR0 - MBCCFR255)
- MB FID (MBFIDR0 - MBFIDR255)
- MB Index (MBIDXR0 - MBIDXR255)

- MB Data Field Offset (MBDOR0 - MBDOR259)
- LRAM ECC Error Test Register (LEETR0 - LEETR5)

## NOTE

Access to the following register address space does not generate transfer error:

- 1208h to 120Ch

## 56.7.1 FlexRay memory map

FR\_0 base address: 402F\_8000h

| Offset   | Register                                          |   Width (In bits) | Access   | Reset value   |
|----------|---------------------------------------------------|-------------------|----------|---------------|
| 0h       | Module Version (MVR)                              |                16 | R        | A568h         |
| 2h       | Module Configuration (MCR)                        |                16 | RW       | 0000h         |
| 4h       | System Memory Base Address High (SYMBADHR)        |                16 | RW       | 0000h         |
| 6h       | System Memory Base Address Low (SYMBADLR)         |                16 | RW       | 0000h         |
| 8h       | Strobe Signal Control (STBSCR)                    |                16 | RW       | 0000h         |
| Ch       | MB Data Size (MBDSR)                              |                16 | RW       | 0000h         |
| Eh       | MB Segment Size and Utilization (MBSSUTR)         |                16 | RW       | FFFFh         |
| 10h      | PE DRAM Access (PEDRAR)                           |                16 | RW       | 0000h         |
| 12h      | PE DRAM Data (PEDRDR)                             |                16 | RW       | 0000h         |
| 14h      | Protocol Operation Control (POCR)                 |                16 | RW       | 0000h         |
| 16h      | Global Interrupt Flag And Enable (GIFER)          |                16 | RW       | 0000h         |
| 18h      | Protocol Interrupt Flag 0 (PIFR0)                 |                16 | RW       | 0000h         |
| 1Ah      | Protocol Interrupt Flag 1 (PIFR1)                 |                16 | RW       | 0000h         |
| 1Ch      | Protocol Interrupt Enable 0 (PIER0)               |                16 | RW       | 0000h         |
| 1Eh      | Protocol Interrupt Enable 1 (PIER1)               |                16 | RW       | 0000h         |
| 20h      | CHI Error Flag (CHIERFR)                          |                16 | RW       | 0000h         |
| 22h      | MB Interrupt Vector (MBIVEC)                      |                16 | R        | 0000h         |
| 24h      | Channel A Status Error Counter Register (CASERCR) |                16 | R        | 0000h         |
| 26h      | Channel B Status Error Counter (CBSERCR)          |                16 | R        | 0000h         |
| 28h      | Protocol Status 0 (PSR0)                          |                16 | R        | 0000h         |
| 2Ah      | Protocol Status 1 (PSR1)                          |                16 | RW       | 0000h         |
| 2Ch      | Protocol Status 2 (PSR2)                          |                16 | R        | 0000h         |
| 2Eh      | Protocol Status 3 (PSR3)                          |                16 | RW       | 0000h         |
| 30h      | MT Counter (MTCTR)                                |                16 | R        | 0000h         |

Table continues on the next page...

Table continued from the previous page...

| Offset    | Register                                                            |   Width (In bits) | Access   | Reset value   |
|-----------|---------------------------------------------------------------------|-------------------|----------|---------------|
| 32h       | Cycle Counter (CYCTR)                                               |                16 | R        | 0000h         |
| 34h       | Slot Counter Channel A (SLTCTAR)                                    |                16 | R        | 0000h         |
| 36h       | Slot Counter Channel B (SLTCTBR)                                    |                16 | R        | 0000h         |
| 38h       | Rate Correction Value (RTCORVR)                                     |                16 | R        | 0000h         |
| 3Ah       | Offset Correction Value (OFCORVR)                                   |                16 | R        | 0000h         |
| 3Ch       | Combined Interrupt Flag (CIFR)                                      |                16 | R        | 0000h         |
| 3Eh       | System Memory Access Timeout (SYMATOR)                              |                16 | RW       | 0006h         |
| 40h       | Sync Frame Counter (SFCNTR)                                         |                16 | R        | 0000h         |
| 42h       | Sync Frame Table Offset (SFTOR)                                     |                16 | RW       | 0000h         |
| 44h       | Sync Frame Table Configuration Control Status (SFTCCSR)             |                16 | RW       | 0000h         |
| 46h       | Sync Frame ID Rejection Filter (SFIDRFR)                            |                16 | RW       | 0000h         |
| 48h       | Sync Frame ID Acceptance Filter Value (SFIDAFVR)                    |                16 | RW       | 0000h         |
| 4Ah       | Sync Frame ID Acceptance Filter Mask (SFIDAFMR)                     |                16 | RW       | 0000h         |
| 4Ch - 56h | NMV n (NMVR0 - NMVR5)                                               |                16 | R        | 0000h         |
| 58h       | Network Management Vector Length Register (NMVLR)                   |                16 | RW       | 0000h         |
| 5Ah       | Timer Configuration And Control (TICCR)                             |                16 | RW       | 0000h         |
| 5Ch       | Timer 1 Cycle Set (TI1CYSR)                                         |                16 | RW       | 0000h         |
| 5Eh       | Timer 1 MT Offset (TI1MTOR)                                         |                16 | RW       | 0000h         |
| 60h       | Timer 2 Configuration 0 (Absolute Timer Configuration) (TI2CR0_ABS) |                16 | RW       | 0000h         |
| 60h       | Timer 2 Configuration 0 (Relative Timer Configuration) (TI2CR0_REL) |                16 | RW       | 0000h         |
| 62h       | Timer 2 Configuration 1 (Absolute Timer Configuration) (TI2CR1_ABS) |                16 | RW       | 0000h         |
| 62h       | Timer 2 Configuration 1 (Relative Timer Configuration) (TI2CR1_REL) |                16 | RW       | 0000h         |
| 64h       | Slot Status Selection (SSSR)                                        |                16 | RW       | 0000h         |
| 66h       | Slot Status Counter Condition (SSCCR)                               |                16 | RW       | 0000h         |
| 68h - 76h | Slot Status (SSR0 - SSR7)                                           |                16 | R        | 0000h         |
| 78h - 7Eh | Slot Status Counter (SSCR0 - SSCR3)                                 |                16 | R        | 0000h         |
| 80h       | MTS A Configuration (MTSACFR)                                       |                16 | RW       | 0000h         |
| 82h       | MTS B Configuration (MTSBCFR)                                       |                16 | RW       | 0000h         |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table continued from the previous page...

| Offset   | Register                                                    |   Width (In bits) | Access   | Reset value   |
|----------|-------------------------------------------------------------|-------------------|----------|---------------|
| 84h      | Receive Shadow Buffer Index (RSBIR)                         |                16 | RW       | 0000h         |
| 86h      | Receive FIFO Watermark And Selection (RFWMSR)               |                16 | RW       | 0000h         |
| 88h      | Receive FIFO Start Index (RFSIR)                            |                16 | RW       | 0000h         |
| 8Ah      | Receive FIFO Depth And Size (RFDSR)                         |                16 | RW       | 0000h         |
| 8Ch      | Receive FIFO A Read Index (RFARIR)                          |                16 | R        | 0000h         |
| 8Eh      | Receive FIFO B Read Index (RFBRIR)                          |                16 | R        | 0000h         |
| 90h      | Receive FIFO Message ID Acceptance Filter Value (RFMIDAFVR) |                16 | RW       | 0000h         |
| 92h      | Receive FIFO Message ID Acceptance Filter Mask (RFMIDAFMR)  |                16 | RW       | 0000h         |
| 94h      | Receive FIFO Frame ID Rejection Filter Value (RFFIDRFVR)    |                16 | RW       | 0000h         |
| 96h      | Receive FIFO Frame ID Rejection Filter Mask (RFFIDRFMR)     |                16 | RW       | 0000h         |
| 98h      | Receive FIFO Range Filter Configuration (RFRFCFR)           |                16 | RW       | 0000h         |
| 9Ah      | Receive FIFO Range Filter Control (RFRFCTR)                 |                16 | RW       | 0000h         |
| 9Ch      | Last Dynamic Transmit Slot Channel A (LDTXSLAR)             |                16 | R        | 0000h         |
| 9Eh      | Last Dynamic Transmit Slot Channel B (LDTXSLBR)             |                16 | R        | 0000h         |
| A0h      | Protocol Configuration 0 (PCR0)                             |                16 | RW       | 0000h         |
| A2h      | Protocol Configuration 1 (PCR1)                             |                16 | RW       | 0000h         |
| A4h      | Protocol Configuration 2 (PCR2)                             |                16 | RW       | 0000h         |
| A6h      | Protocol Configuration 3 (PCR3)                             |                16 | RW       | 0000h         |
| A8h      | Protocol Configuration 4 (PCR4)                             |                16 | RW       | 0000h         |
| AAh      | Protocol Configuration 5 (PCR5)                             |                16 | RW       | 0000h         |
| ACh      | Protocol Configuration 6 (PCR6)                             |                16 | RW       | 0000h         |
| AEh      | Protocol Configuration 7 (PCR7)                             |                16 | RW       | 0000h         |
| B0h      | Protocol Configuration 8 (PCR8)                             |                16 | RW       | 0000h         |
| B2h      | Protocol Configuration 9 (PCR9)                             |                16 | RW       | 0000h         |
| B4h      | Protocol Configuration 10 (PCR10)                           |                16 | RW       | 0000h         |
| B6h      | Protocol Configuration 11 (PCR11)                           |                16 | RW       | 0000h         |
| B8h      | Protocol Configuration 12 (PCR12)                           |                16 | RW       | 0000h         |
| BAh      | Protocol Configuration 13 (PCR13)                           |                16 | RW       | 0000h         |
| BCh      | Protocol Configuration 14 (PCR14)                           |                16 | RW       | 0000h         |
| BEh      | Protocol Configuration 15 (PCR15)                           |                16 | RW       | 0000h         |
| C0h      | Protocol Configuration 16 (PCR16)                           |                16 | RW       | 0000h         |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table continued from the previous page...

| Offset      | Register                                                   |   Width (In bits) | Access   | Reset value   |
|-------------|------------------------------------------------------------|-------------------|----------|---------------|
| C2h         | Protocol Configuration 17 (PCR17)                          |                16 | RW       | 0000h         |
| C4h         | Protocol Configuration 18 (PCR18)                          |                16 | RW       | 0000h         |
| C6h         | Protocol Configuration 19 (PCR19)                          |                16 | RW       | 0000h         |
| C8h         | Protocol Configuration 20 (PCR20)                          |                16 | RW       | 0000h         |
| CAh         | Protocol Configuration 21 (PCR21)                          |                16 | RW       | 0000h         |
| CCh         | Protocol Configuration 22 (PCR22)                          |                16 | RW       | 0000h         |
| CEh         | Protocol Configuration 23 (PCR23)                          |                16 | RW       | 0000h         |
| D0h         | Protocol Configuration 24 (PCR24)                          |                16 | RW       | 0000h         |
| D2h         | Protocol Configuration 25 (PCR25)                          |                16 | RW       | 0000h         |
| D4h         | Protocol Configuration 26 (PCR26)                          |                16 | RW       | 0000h         |
| D6h         | Protocol Configuration 27 (PCR27)                          |                16 | RW       | 0000h         |
| D8h         | Protocol Configuration 28 (PCR28)                          |                16 | RW       | 0000h         |
| DAh         | Protocol Configuration 29 (PCR29)                          |                16 | RW       | 0000h         |
| DCh         | Protocol Configuration 30 (PCR30)                          |                16 | RW       | 0000h         |
| DEh         | Stopwatch Count High (STPWHR)                              |                16 | RW       | 0000h         |
| E0h         | Stopwatch Count Low (STPWLR)                               |                16 | RW       | 0000h         |
| E2h         | Protocol Event Output Enable And Stopwatch Control (PEOER) |                16 | RW       | 0000h         |
| E6h         | Receive FIFO Start Data Offset (RFSDOR)                    |                16 | RW       | 0000h         |
| E8h         | Receive FIFO System Memory Base Address High (RFSYMBADHR)  |                16 | RW       | 0000h         |
| EAh         | Receive FIFO System Memory Base Address Low (RFSYMBADLR)   |                16 | RW       | 0000h         |
| ECh         | Receive FIFO Periodic Timer (RFPTR)                        |                16 | RW       | 0000h         |
| EEh         | Receive FIFO Fill Level and Pop Count (RFFLPCR)            |                16 | RW       | 0000h         |
| F0h         | ECC Error Interrupt Flag And Enable (EEIFER)               |                16 | RW       | 0000h         |
| F2h         | ECC Error Report And Injection Control (EERICR)            |                16 | RW       | 0000h         |
| F4h         | ECC Error Report Address (EERAR)                           |                16 | R        | 7000h         |
| F6h         | ECC Error Report Data (EERDR)                              |                16 | R        | 0000h         |
| F8h         | ECC Error Report Code (EERCR)                              |                16 | R        | 0000h         |
| FAh         | ECC Error Injection Address (EEIAR)                        |                16 | RW       | 0000h         |
| FCh         | ECC Error Injection Data (EEIDR)                           |                16 | RW       | 0000h         |
| FEh         | ECC Error Injection Code (EEICR)                           |                16 | RW       | 0000h         |
| 800h - FF8h | MB Configuration Control Status (MBCCSR0 - MBCCSR255)      |                16 | RW       | 0000h         |

Table continues on the next page...

## Table continued from the previous page...

| Offset        | Register                                       |   Width (In bits) | Access   | Reset value   |
|---------------|------------------------------------------------|-------------------|----------|---------------|
| 802h - FFAh   | MB Cycle Counter Filter (MBCCFR0 - MBCCFR255)  |                16 | RW       | 0000h         |
| 804h - FFCh   | MB FID (MBFIDR0 - MBFIDR255)                   |                16 | RW       | 0000h         |
| 806h - FFEh   | MB Index (MBIDXR0 - MBIDXR255)                 |                16 | RW       | 0000h         |
| 1000h - 1206h | MB Data Field Offset (MBDOR0 - MBDOR259)       |                16 | RW       | 0000h         |
| 1210h - 121Ah | LRAM ECC Error Test Register (LEETR0 - LEETR5) |                16 | RW       | 0000h         |

## 56.7.2 Module Version (MVR)

## Offset

| Register   | Offset   |
|------------|----------|
| MVR        | 0h       |

## Function

Provides the CC version number.

The CC version number is derived from the CHI and PE version numbers.

## Diagram

<!-- image -->

## Fields

| Field   | Function                         |
|---------|----------------------------------|
| 15-8    | CHI Version Number               |
| CHIVER  | Provides the CHI version number. |
| 7-0     | PE Version Number                |
| PEVER   | Provides the PE version number.  |

## 56.7.3 Module Configuration (MCR)

## Offset

| Register   | Offset   |
|------------|----------|
| MCR        | 2h       |

## Function

Defines the global CC configuration.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 MEN  | Module Enable Indicates whether or not CC is in Disabled mode. You request CC to leave Disabled mode by writing 1 to this field. Before leaving Disabled Mode, you must configure the SCM, SBFF, CHB, CHA, TMODE, and BITRATE fields in this register. For details, see Modes of operation. If CC is enabled, it can only be disabled during mode: POC:default config. 0b - Write: only during POC:default config, CC disable Read: CC disabled 1b - Write: enable CC Read: CC enabled |
| 14 SBFF | System Bus Failure Freeze Controls the CC behavior in case of a system bus failure. 0b - Continue normal operation 1b - Transition to freeze mode                                                                                                                                                                                                                                                                                                                                      |
| 13 SCM  | Single Channel Device Mode Defines the CC channel device mode as described in Channel device modes. 0b - Dual channel 1b - Single channel                                                                                                                                                                                                                                                                                                                                              |
| 12 CHB  | Channel B Enable Protocol related parameter: pChannels. The semantic of these control bits depends on the channel device mode controlled by the SCM bit and is given in the following table.                                                                                                                                                                                                                                                                                           |

FlexRay Communication Controller (FlexRay)

| Field   | Function                                                                                                                                                                                                                  | Function                                                                                                                                                                                                                  | Function                                                                                                                                                                                                                  | Function                                                                                                                                                                                                                  |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | Table 550. FlexRay channel selection                                                                                                                                                                                      | Table 550. FlexRay channel selection                                                                                                                                                                                      | Table 550. FlexRay channel selection                                                                                                                                                                                      | Table 550. FlexRay channel selection                                                                                                                                                                                      |
|         | SCM                                                                                                                                                                                                                       | CHB                                                                                                                                                                                                                       | CHA                                                                                                                                                                                                                       | Description                                                                                                                                                                                                               |
|         | Dual Channel Device Modes                                                                                                                                                                                                 | Dual Channel Device Modes                                                                                                                                                                                                 | Dual Channel Device Modes                                                                                                                                                                                                 | Dual Channel Device Modes                                                                                                                                                                                                 |
|         | 0                                                                                                                                                                                                                         | 0                                                                                                                                                                                                                         | 0                                                                                                                                                                                                                         | ports FR_A_RX, FR_A_TX, and FR_A_TX_EN_b not driven by CC ports FR_B_RX, FR_B_TX, and FR_A_TX_EN_b not driven by CC                                                                                                       |
|         |                                                                                                                                                                                                                           | 0                                                                                                                                                                                                                         | 1                                                                                                                                                                                                                         | ports FR_A_RX, FR_A_TX, and FR_A_TX_EN_b driven by CC - connected to FlexRay channel A ports FR_B_RX, FR_B_TX, and FR_A_TX_EN_b not driven by CC                                                                          |
|         |                                                                                                                                                                                                                           | 1                                                                                                                                                                                                                         | 0                                                                                                                                                                                                                         | reserved                                                                                                                                                                                                                  |
|         |                                                                                                                                                                                                                           | 1                                                                                                                                                                                                                         | 1                                                                                                                                                                                                                         | ports FR_A_RX, FR_A_TX, and FR_A_TX_EN_b driven by CC - connected to FlexRay channel A ports FR_B_RX, FR_B_TX, and FR_A_TX_EN_b driven by CC - connected to FlexRay channel B                                             |
|         | Single Channel Device Mode                                                                                                                                                                                                | Single Channel Device Mode                                                                                                                                                                                                | Single Channel Device Mode                                                                                                                                                                                                | Single Channel Device Mode                                                                                                                                                                                                |
|         | 1                                                                                                                                                                                                                         | 0                                                                                                                                                                                                                         | 0                                                                                                                                                                                                                         | ports FR_A_RX, FR_A_TX, and FR_A_TX_EN_b not driven by CC ports FR_B_RX, FR_B_TX, and FR_A_TX_EN_b not driven by CC                                                                                                       |
|         |                                                                                                                                                                                                                           | 0                                                                                                                                                                                                                         | 1                                                                                                                                                                                                                         | ports FR_A_RX, FR_A_TX, and FR_A_TX_EN_b driven by CC - connected to FlexRay channel A ports FR_B_RX, FR_B_TX, and FR_A_TX_EN_b not driven by CC                                                                          |
|         |                                                                                                                                                                                                                           | 1                                                                                                                                                                                                                         | 0                                                                                                                                                                                                                         | ports FR_A_RX, FR_A_TX, and FR_A_TX_EN_b driven by CC - connected to FlexRay channel B ports FR_B_RX, FR_B_TX, and FR_A_TX_EN_b not driven by CC                                                                          |
|         |                                                                                                                                                                                                                           | 1                                                                                                                                                                                                                         | 1                                                                                                                                                                                                                         | reserved                                                                                                                                                                                                                  |
| 11 CHA  | Channel A Enable Protocol related parameter: pChannels The semantic of these control bits depends on the channel device mode controlled by the SCM bit and is given in the FlexRay channel selection table as seen above. | Channel A Enable Protocol related parameter: pChannels The semantic of these control bits depends on the channel device mode controlled by the SCM bit and is given in the FlexRay channel selection table as seen above. | Channel A Enable Protocol related parameter: pChannels The semantic of these control bits depends on the channel device mode controlled by the SCM bit and is given in the FlexRay channel selection table as seen above. | Channel A Enable Protocol related parameter: pChannels The semantic of these control bits depends on the channel device mode controlled by the SCM bit and is given in the FlexRay channel selection table as seen above. |
| 10 SFFE | Synchronization Frame Filter Enable Enables and disables the filtering for received synchronization frames. For details, see Sync frame filtering. 0b - Disabled                                                          | Synchronization Frame Filter Enable Enables and disables the filtering for received synchronization frames. For details, see Sync frame filtering. 0b - Disabled                                                          | Synchronization Frame Filter Enable Enables and disables the filtering for received synchronization frames. For details, see Sync frame filtering. 0b - Disabled                                                          | Synchronization Frame Filter Enable Enables and disables the filtering for received synchronization frames. For details, see Sync frame filtering. 0b - Disabled                                                          |
| 9       | ECC Functionality Enable                                                                                                                                                                                                  | ECC Functionality Enable                                                                                                                                                                                                  | ECC Functionality Enable                                                                                                                                                                                                  | ECC Functionality Enable                                                                                                                                                                                                  |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

| Field       | Function                                                                                                                                                                                                                                                                                                                              |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ECCE        | Enables and disables the ECC memory error detection functionality (injection, detection, reporting, and response). For details, see Memory content fault detection. 0b - Disabled 1b - Enabled                                                                                                                                        |
| 8 -         | Reserved Do not write any value different from the reset value.                                                                                                                                                                                                                                                                       |
| 7 FUM       | FIFO Update Mode Determines whether FIFOA or FIFOB are updated when you write 1 to the FAFAIF or FAFBIF interrupt flags in Global Interrupt Flag And Enable (GIFER). See FIFO update. 0b - Updated 1b - Not updated                                                                                                                   |
| 6 FAM       | FIFO Address Mode Controls the location of the system memory base address for the FIFOs. See FIFO configuration. When FAM = 0, the address is located in System Memory Base Address High (SYMBADHR). When FAM = 1, the address is located in Receive FIFO System Memory Base Address High (RFSYMBADHR). 0b - SYMBADHR 1b - RFSYMBADHR |
| 5 -         | Reserved                                                                                                                                                                                                                                                                                                                              |
| 4 -         | Reserved                                                                                                                                                                                                                                                                                                                              |
| 3-1 BITRATE | FlexRay Bus Bit Rate Defines the FlexRay bus bit rate. 000b - 10.0 Mbit/s 001b - 5.0 Mbit/s 010b - 2.5 Mbit/s 011b - 8.0 Mbit/s All other values are reserved.                                                                                                                                                                        |
| 0 -         | Reserved                                                                                                                                                                                                                                                                                                                              |

## 56.7.4 System Memory Base Address High (SYMBADHR)

## Offset

| Register   | Offset   |
|------------|----------|
| SYMBADHR   | 4h       |

## Function

Contains the most significant bits of the base address.

This register and System Memory Base Address Low (SYMBADLR) define the base address of the FlexRay memory area within the system memory. BMIF uses the base address to calculate the physical memory address for system memory accesses.

You must set the system memory base address before enabling the CC.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                                                     |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-0    | System Memory Base Address High                                                                                                                                                                                              |
| SMBA    | Contains the value of the system memory base address for the individual MBs and sync frame table. This is the value of the system memory base address for the receive FIFO if MCR[FAM] = 1. It is defined as a byte address. |

## 56.7.5 System Memory Base Address Low (SYMBADLR)

## Offset

| Register   | Offset   |
|------------|----------|
| SYMBADLR   | 6h       |

## Function

Contains the least significant bits of the base address.

This register and System Memory Base Address High (SYMBADHR) define the base address of the FlexRay memory area within the system memory. BMIF uses the base address to calculate the physical memory address for system memory accesses.

You must set the system memory base address before enabling the CC.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                                                     |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-4    | System Memory Base Address Low                                                                                                                                                                                               |
| SMBA    | Contains the value of the system memory base address for the individual MBs and sync frame table. This is the value of the system memory base address for the receive FIFO if MCR[FAM] = 1. It is defined as a byte address. |
| 3-0 -   | Reserved                                                                                                                                                                                                                     |

## 56.7.6 Strobe Signal Control (STBSCR)

## Offset

| Register   | Offset   |
|------------|----------|
| STBSCR     | 8h       |

## Function

Assigns the individual protocol timing related strobe signals given in Table 551 to the external strobe ports.

Each strobe signal can be assigned to at most one strobe port. Each write access to registers overwrites the previously written ENB and STBPSEL values for the signal indicated by SEL. If more than one strobe signal is assigned to a strobe port, the current values of the strobe signals are combined with a binary OR and presented at the strobe port. If no strobe signal is assigned to a strobe port, the strobe port carries logic 0. For more information, see Strobe signal support.

In single channel device mode, channel B related strobe signals are undefined and must not be assigned to the strobe ports.

## Table 551. Strobe signal mapping

| SEL   | SEL   | Description   | Channel   | Type   | Offset (in PE clock cycles)   | Reference   |
|-------|-------|---------------|-----------|--------|-------------------------------|-------------|
| Dec   | Hex   | Description   | Channel   | Type   | Offset (in PE clock cycles)   | Reference   |
| 0     | 0     | Arm           | -         | Value  | +1                            | MT start    |
| 1     | 1     | MT            | -         | Value  | +1                            | MT start    |
| 2     | 2     | Cycle start   | -         | Pulse  | 0                             | MT start    |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table 551. Strobe signal mapping (continued)

| SEL     | SEL     | Description                                | Description                                | Description                                | Description                                | Description                                | Description                                | Channel   | Type    | Offset (in PE clock   | Reference                       |         |
|---------|---------|--------------------------------------------|--------------------------------------------|--------------------------------------------|--------------------------------------------|--------------------------------------------|--------------------------------------------|-----------|---------|-----------------------|---------------------------------|---------|
| Dec     | Hex     |                                            |                                            |                                            |                                            |                                            |                                            | Channel   | Type    | cycles)               | Reference                       |         |
| 3       | 3       | Minislot start                             | Minislot start                             | Minislot start                             | Minislot start                             | Minislot start                             | Minislot start                             | -         | Pulse   | 0                     | MT start                        |         |
| 4       | 4       | Slot start                                 | Slot start                                 | Slot start                                 | Slot start                                 | Slot start                                 | Slot start                                 | A         | Pulse   | 0                     | MT start                        |         |
| 5       | 5       |                                            |                                            |                                            |                                            |                                            |                                            | B         | Pulse   | 0                     | MT start                        |         |
| 6       | 6       | Receive data after glitch filtering        | Receive data after glitch filtering        | Receive data after glitch filtering        | Receive data after glitch filtering        | Receive data after glitch filtering        | Receive data after glitch filtering        | A         | Value   | +4                    | FR_A_RX                         |         |
| 7       | 7       |                                            |                                            |                                            |                                            |                                            |                                            | B         | Value   | +4                    | FR_B_RX                         |         |
| 8       | 8       | Channel idle indicator                     | Channel idle indicator                     | Channel idle indicator                     | Channel idle indicator                     | Channel idle indicator                     | Channel idle indicator                     | A         | Level   | +5                    | FR_A_RX                         |         |
| 9       | 9       |                                            |                                            |                                            |                                            |                                            |                                            | B         | Level   | +5                    | FR_B_RX                         |         |
| 10      | A       | Syntax error detected                      | Syntax error detected                      | Syntax error detected                      | Syntax error detected                      | Syntax error detected                      | Syntax error detected                      | A         | Pulse   | +4                    | FR_A_RX                         |         |
| 11      | B       |                                            |                                            |                                            |                                            |                                            |                                            | B         | Pulse   | +4                    | FR_B_RX                         |         |
| 12      | C       | Content error detected                     | Content error detected                     | Content error detected                     | Content error detected                     | Content error detected                     | Content error detected                     | A         | Level   | +4                    | FR_A_RX                         |         |
| 13      | D       |                                            |                                            |                                            |                                            |                                            |                                            | B         | Level   | +4                    | FR_B_RX                         |         |
| 14      | E       | Receive FIFO almost-full interrupt signals | Receive FIFO almost-full interrupt signals | Receive FIFO almost-full interrupt signals | Receive FIFO almost-full interrupt signals | Receive FIFO almost-full interrupt signals | Receive FIFO almost-full interrupt signals | A         | Value   | n.a.                  | RX FIFO A almost full interrupt |         |
| 15      | F       |                                            |                                            |                                            |                                            |                                            |                                            | B         | Value   | n.a.                  | RX FIFO B almost full interrupt |         |
| Diagram | Diagram | Diagram                                    | Diagram                                    | Diagram                                    | Diagram                                    | Diagram                                    | Diagram                                    | Diagram   | Diagram | Diagram               | Diagram                         | Diagram |
| Bits    | 15      | 13                                         | 12                                         | 11                                         | 10                                         | 9                                          | 8                                          | 6         | 4       | 3                     | 1 0                             |         |
| R       | 0       | 0                                          |                                            |                                            | SEL                                        |                                            |                                            | 0         | ENB     | 0                     | STBPSEL                         |         |
| W       | WMD     |                                            |                                            |                                            |                                            |                                            |                                            |           |         |                       |                                 |         |

## Fields

| Field   | Function                                 |
|---------|------------------------------------------|
| 15      | Write Mode                               |
| WMD     | Defines the write mode of this register. |

Table continues on the next page...

## Table continued from the previous page...

| Field       | Function                                                                                                                                                                                                                                                                            |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|             | 0b - Write to all fields in this register on a write access 1b - Write only to the SEL field on write access                                                                                                                                                                        |
| 14-12 -     | Reserved                                                                                                                                                                                                                                                                            |
| 11-8 SEL    | Strobe Signal Select Selects one of the strobe signals given in Table 551 to be enabled or disabled and assigned to one of the four strobe ports given in that table. Write: Disabled Mode                                                                                          |
| 7-5 -       | Reserved                                                                                                                                                                                                                                                                            |
| 4 ENB       | Strobe Signal Enable Enables and disables the strobe signal selected by STBSSEL. 0b - Disabled and not assigned to any strobe port 1b - Enabled and assigned to the strobe port selected by STBPSEL                                                                                 |
| 3-2 -       | Reserved                                                                                                                                                                                                                                                                            |
| 1-0 STBPSEL | Strobe Port Select Selects the strobe port that the strobe signal selected by SEL is assigned to. All strobe signals that are enabled and assigned to the same strobe port are combined with a binary OR operation. 00b - FR_DBG[0] 01b - FR_DBG[1] 10b - FR_DBG[2] 11b - FR_DBG[3] |

## 56.7.7 MB Data Size (MBDSR)

## Offset

| Register   | Offset   |
|------------|----------|
| MBDSR      | Ch       |

## Function

Defines the size of the MB data section for the two MB segments in a number of two-byte entities.

CC provides two independent segments for the individual MBs. All individual MBs within a segment must have the same size for the MB data section. This size can be different for the two MB segments.

## Diagram

<!-- image -->

## Fields

| Field         | Function                                                                                                                  |
|---------------|---------------------------------------------------------------------------------------------------------------------------|
| 15 -          | Reserved                                                                                                                  |
| 14-8 MBSEG2DS | MB Segment 2 Data Size Defines the size of the MB data section in two-byte entities for MBs within the second MB segment. |
| 7 -           | Reserved                                                                                                                  |
| 6-0 MBSEG1DS  | MB Segment 1 Data Size Defines the size of the MB data section in two-byte entities for MBs within the first MB segment.  |

## 56.7.8 MB Segment Size and Utilization (MBSSUTR)

## Offset

| Register   | Offset   |
|------------|----------|
| MBSSUTR    | Eh       |

## Function

## Defines:

- The last individual MB that belongs to the first MB segment
- The number of the last used individual MB

FlexRay Communication Controller (FlexRay)

## Diagram

<!-- image -->

## Fields

| Field              | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-8 LAST_MB_SEG 1 | Last MB In Segment 1 Defines the MB number of the last individual MB that is assigned to the first MB segment. The individual MBs in the first segment correspond to the following MB control registers with n ≤ LAST_MB_SEG1: • MB Configuration Control Status (MBCCSR0 - MBCCSR255) • MB Cycle Counter Filter (MBCCFR0 - MBCCFR255) • MB FID (MBFIDR0 - MBFIDR255) • MB Index (MBIDXR0 - MBIDXR255) The first MB segment contains: • At least one individual MB • LAST_MB_SEG1+1 individual MBs The individual MBs in the second MB segment correspond to the following MB control registers with LAST_MB_SEG1 < n < 256: • MB Configuration Control Status (MBCCSR0 - MBCCSR255) • MB Cycle Counter Filter (MBCCFR0 - MBCCFR255) • MB FID (MBFIDR0 - MBFIDR255) • MB Index (MBIDXR0 - MBIDXR255) If LAST_MB_SEG1 = 255, all individual MBs belong to the first MB segment and the second MB segment is empty. |
| 7-0 LAST_MB_UTIL   | Last MB Utilized Defines the MB number of the last utilized individual MB. The MB search engine examines all individual MBs with an MB number n ≤ LAST_MB_UTIL. If LAST_MB_UTIL=LAST_MB_SEG1,allindividual MBsbelong to the firstMBsegmentandthesecondMB segment is empty.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

FlexRay Communication Controller (FlexRay)

## 56.7.9 PE DRAM Access (PEDRAR)

## Offset

| Register   | Offset   |
|------------|----------|
| PEDRAR     | 10h      |

## Function

Triggers write and read operations on the PE data memory (PE DRAM). These operations are used for memory error injection and memory error observation.

Each write access to this register initiates a read or write operation on PE DRAM. CC writes 0 to PEDRAR[DAD] after the write access, and writes 1 to that field if the PE DRAM access is finished.

In case of a PE DRAM write access, the data provided in PEDRDR is:

- Written in PE DRAM
- Read back from PE DRAM
- Stored in PEDRDR

In case of an PE DRAM read access, the requested data is read from PE DRAM and stored in PEDRDR.

For a detailed description, see Memory content fault detection.

## Diagram

<!-- image -->

## Fields

| Field      | Function                                                                                                                                                                                                                                                     |
|------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-12 INST | PE DRAM Access Instruction Defines the operation to be executed on PE DRAM. other reserved 0011b - Write PEDRDR[DATA] to PE DRAM address ADDR (16 bit) 0101b - Read data from PE DRAM address ADDR (16 bit) into PEDRDR[DATA] All other values are reserved. |
| 11-1 ADDR  | PE DRAM Access Address Defines the address in PE DRAM to be written to or read from.                                                                                                                                                                         |
| 0 DAD      | PE DRAM Access Done                                                                                                                                                                                                                                          |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                       |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | CC writes 0 to this field when you have written to PERDR. CC writes 1 to this field when the PE DRAM access has finished. 0b - Access running 1b - Access done |

## 56.7.10 PE DRAM Data (PEDRDR)

## Offset

| Register   | Offset   |
|------------|----------|
| PEDRDR     | 12h      |

## Function

Provides the PE DRAM data that you want to write or read when you initiate a write access to PE DRAM Access (PEDRAR).

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                         |
|---------|------------------------------------------------------------------------------------------------------------------|
| 15-0    | Data To Or From PE DRAM                                                                                          |
| DATA    | Contains the PE DRAM that you want to write or read when you initiate a write access to PE DRAM Access (PEDRAR). |

## 56.7.11 Protocol Operation Control (POCR)

## Offset

| Register   | Offset   |
|------------|----------|
| POCR       | 14h      |

## Function

Issues commands for protocol control and external clock correction.

FlexRay Communication Controller (FlexRay)

Protocol control commands are issued by writing to the POCCMD field. For more information on protocol control commands, see Protocol control command execution.

External clock correction commands are issued by writing to the EOC\_AP and ERC\_AP fields. For more information on external clock correction, see External clock synchronization.

## Diagram

<!-- image -->

| Bits   | 15   | 14   | 13   | 12   | 11     | 10   | 9   | 8      | 7    | 6   | 5   | 4   | 3   | 2      | 1   | 0   |
|--------|------|------|------|------|--------|------|-----|--------|------|-----|-----|-----|-----|--------|-----|-----|
| R      | 0    |      | 0    |      | EOC_AP |      |     | ERC_AP | BSY_ |     | 0   |     |     | POCCMD |     |     |
| W      | WME  |      |      |      |        |      |     |        | WMC  |     |     |     |     |        |     |     |

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                             |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 WME       | Write Mode External Correction Controls the write mode of the EOC_AP and ERC_AP fields. 0b - Write to EOC_AP and ERC_AP fields on register write. 1b - No write to EOC_AP and ERC_AP fields on register write.                                                                                                                                                                                                                       |
| 14-12 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 11-10 EOC_AP | External Offset Correction Application Triggers the application of the external offset correction value defined in Protocol Configuration 29 (PCR29). 00b - Do not apply external offset correction value 01b - Reserved 10b - Subtract external offset correction value 11b - Add external offset correction value                                                                                                                  |
| 9-8 ERC_AP   | External Rate Correction Application Triggers the application of the external rate correction value defined in Protocol Configuration 21 (PCR21). 00b - Do not apply external rate correction value 01b - Reserved 10b - Subtract external rate correction value 11b - Add external rate correction value                                                                                                                            |
| 7 BSY_WMC    | Protocol Control Command Busy Or Command Write Serves two functions depending on whether you are reading or writing this field. When you read this field, it indicates the acceptance of the protocol control command that you issued via the POCCMD field. CC writes 1 to BSY_WMC when you issue the command, and writes 0 to BSY_WMC when PE accepts the command. When you issue a protocol control command while BSY_WMC = 1, CC: |

Table continues on the next page...

## Table continued from the previous page...

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|            | • Ignores this command • Writes 1 to CHIERFR[PCMI_EF] ets the protocol command ignored error flag PCMI_EF in the CHI Error Flag Register (CHIERFR) • Does not change the value of the POCCMD field When you write this field, it indicates the acceptance of the protocol control command that you issued via the POCCMD field. CC writes 1 to BSY_WMC when you issue the command, and writes 0 to BSY_WMC when PE accepts the command. When you issue a protocol control command while BSY_WMC = 1, CC: • Ignores this command • Writes 1 to CHIERFR[PCMI_EF] ets the protocol command ignored error flag PCMI_EF in the CHI Error Flag Register (CHIERFR) • Does not change the value of the POCCMD field 0b - Read operation: Command write idle; command accepted and ready to receive new protocol command. Write operation: Write to POCCMD field on register write. 1b - Read operation: Command write busy; command not yet accepted; not ready to receive new protocol command. Write operation: Do not write to POCCMD field on register write. |
| 6-4 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 3-0 POCCMD | Protocol Control Command Write to this field to issue a protocol control command to the PE. CC sends the protocol command to the PE immediately. While the transfer is running, BSY_WMC is 1. 0000b - ALLOW_COLDSTART. Immediately activate capability of node to cold start cluster. 0001b - ALL_SLOTS. Delayed transition to the all slots transmission mode. (Delayed means on completion of current communication cycle.) 0010b - CONFIG. Immediately transition to the POC:config state. 0011b - FREEZE. Immediately transition to the POC:halt state. 0100b - READY, CONFIG_COMPLETE. Immediately transition to the POC:ready state. 0101b - RUN. Immediately transition to the POC:startup start state. 0110b - DEFAULT_CONFIG. Immediately transition to the POC:default config state. 0111b - HALT. Delayed transition to the POC:halt state 1000b - WAKEUP. Immediately initiate the wakeup procedure. All other values are reserved.                                                                                                           |

## 56.7.12 Global Interrupt Flag And Enable (GIFER)

## Offset

| Register   | Offset   |
|------------|----------|
| GIFER      | 16h      |

## Function

Provides the means to control some of the interrupt request lines and provides the corresponding interrupt flags.

The interrupt flags MIF, PRIF, CHIF, RBIF, and TBIF are the outcome of a binary OR of the related individual interrupt flags and interrupt enables. The generation scheme for these flags is depicted in Module interrupt. For more details on interrupt generation, see Interrupt support. These flags become 0 automatically when you write 0 to all of the corresponding interrupt flags or interrupt enables in the related interrupt flag and enable registers.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                            |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 MIF  | Module Interrupt Flag CC writes 1 to this field if at least one of the other interrupt flags in this register and the related interrupt enable field are 1. 0b - No interrupt flag and related interrupt enable bit are set. 1b - At least one of the other interrupt flags in this register and the related interrupt field are 1.                                                                                 |
| 14 PRIF | Protocol Interrupt Flag CCwrites 1 to this field if at least one of the individual flags in Protocol Interrupt Flag 0 (PIFR0) and Protocol Interrupt Flag 1 (PIFR1), and the related interrupt enable field, are 1. 0b - No individual protocol interrupt flag and related interrupt enable field are 1. 1b - At least one of the individual protocol interrupt flags and the related interrupt enable field are 1. |
| 13 CHIF | CHI Interrupt Flag CCwrites 1 to this field if at least one of the error flags in CHI Error Flag (CHIERFR) and GIFER[CHIE] are 1. 0b - All CHI error flags are 0 or the CHI error interrupt is disabled. 1b - At least one CHI error flag and the CHI error interrupt enable are 1.                                                                                                                                 |

Table continues on the next page...

Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 12 WUPIF  | Wakeup Interrupt Flag Indicates whether CC has received a wakeup symbol on the FlexRay bus. You can determine which channel received the wakeup symbol by reading the relatedWUBandWUAfields in Protocol Status 3 (PSR3). 0b - Not received 1b - Received                                                                                                                                                                                                                                                                                                                                          |
| 11 FAFBIF | Receive FIFO Channel B Almost Full Interrupt Flag CC causes this field to become 1 when one of the following events occurs: • The current number of FIFO B entries is equal to or greater than the watermark defined by RFWMSR[WM] and CC writes a received message into FIFO A. • The current number of FIFO B entries is at least 1 and the periodic timer, as defined by Receive FIFO Periodic Timer (RFPTR), expires. 0b - No such event 1b - FIFO B almost-full event has occurred                                                                                                            |
| 10 FAFAIF | Receive FIFO Channel A Almost Full Interrupt Flag CC causes this field to become 1 when one of the following events occurs: • The current number of FIFO A entries is equal to or greater than the watermark defined by RFWMSR[WM] and CC writes a received message into FIFO A. • The current number of FIFO B entries is at least 1 and the periodic timer, as defined by Receive FIFO Periodic Timer (RFPTR), expires. 0b - No such event 1b - FIFO A almost-full event has occurred                                                                                                            |
| 9 RBIF    | Receive MB Interrupt Flag CC writes 1 to this field if for at least one of the individual MBs has the following field values in MB Configuration Control Status (MBCCSR0 - MBCCSR255): • MTD = 0 • MBIF = 1 • MBIE = 1 You cannot write 0 to this field directly. Instead, CC writes 0 to this field after either of the following occurs: • You write 0 to all of the individual MBIF fields of the individual transmit MBs. • You write 0 to the related MBIE field. 0b - None of the individual transmit MBs has MBIF = MBIE = 1. 1b - At least one individual transmit MB has MBIF = MBIE = 1. |
| 8         | Transmit MB Interrupt Flag                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TBIF     | CC writes 1 to this field if for at least one of the individual MBs all of the following fields in MBConfiguration Control Status (MBCCSR0 - MBCCSR255) are 1: • MTD • MBIF • MBIE You cannot write 0 to this field directly. Instead, CC writes 0 to this field after either of the following occurs: • You write 0 to all of the individual MBIF fields of the individual transmit MBs. • You write 0 to the related MBIE field. 0b - None of the individual transmit MBs has MBIF = MBIE = 1. |
| 7 MIE    | Module Interrupt Enable Enables or disables the Module Interrupt line when MIF = 1. 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                     |
| 6 PRIE   | Protocol Interrupt Enable Enables or disables the Protocol Interrupt line when PRIF = 1. 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                |
| 5 CHIE   | CHI Interrupt Enable Enables or disables the CHI Interrupt line when CHIF = 1. 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                          |
| 4 WUPIE  | Wakeup Interrupt Enable Enables or disables the Wakeup Interrupt line when WUPIF = 1. 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                   |
| 3 FAFBIE | Receive FIFO Channel B Almost Full Interrupt Enable Enables or disables the RX FIFO B Almost Full Interrupt line when FAFBIF = 1. 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                       |
| 2        | Receive FIFO Channel A Almost Full Interrupt Enable                                                                                                                                                                                                                                                                                                                                                                                                                                              |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                |
|---------|-------------------------------------------------------------------------------------------------------------------------|
| FAFAIE  | Enables or disables the RX FIFO A Almost Full Interrupt line when FAFAIF = 1. 0b - Disable 1b - Enable                  |
| 1 RBIE  | Receive MB Interrupt Enable Enables or disables the Receive MB Interrupt line when RBIF = 1. 0b - Disable 1b - Enable   |
| 0 TBIE  | Transmit MB Interrupt Enable Enables or disables the Transmit MB Interrupt line when TBIF = 1. 0b - Disable 1b - Enable |

## 56.7.13 Protocol Interrupt Flag 0 (PIFR0)

## Offset

| Register   | Offset   |
|------------|----------|
| PIFR0      | 18h      |

## Function

Holds one set of the protocol-related individual interrupt flags.

## Diagram

<!-- image -->

| Bits   | 15       | 14       | 13       | 12      | 11      | 10      | 9       | 8       | 7       | 6        | 5        | 4        | 3        | 2      | 1      | 0       |
|--------|----------|----------|----------|---------|---------|---------|---------|---------|---------|----------|----------|----------|----------|--------|--------|---------|
| R      | FATL_ IF | INTL_ IF | ILCF_ IF | CSA_ IF | MRC_ IF | MOC_ IF | CCL_ IF | MXS_ IF | MTX_ IF | LTXB_ IF | LTXA_ IF | TBVB_ IF | TBVA_ IF | TI2_IF | TI1_IF | CYS_ IF |
| W      | W1C      | W1C      | W1C      | W1C     | W1C     | W1C     | W1C     | W1C     | W1C     | W1C      | W1C      | W1C      | W1C      | W1C    | W1C    | W1C     |
| Reset  | 0        | 0        | 0        | 0       | 0       | 0       | 0       | 0       | 0       | 0        | 0        | 0        | 0        | 0      | 0      | 0       |

## Fields

| Field   | Function                                                                                                                                      |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------|
| 15      | Fatal Protocol Error Interrupt Flag                                                                                                           |
| FATL_IF | Becomes 1 when PE has detected a fatal protocol error. In this case, PE enters the POC:halt state immediately. The fatal protocol errors are: |

Table continues on the next page...

## Table continued from the previous page...

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|            | • pLatestTx violation, as described in the MAC process of the FlexRay protocol • Transmission across slot boundary violation, as described in the FSP process of the FlexRay protocol 0b - No such event 1b - Fatal protocol error detected                                                                                                                                                                                                                                                                                                   |
| 14 INTL_IF | Internal Protocol Error Interrupt Flag Becomes 1 when PE engine has detected an internal protocol error. In this case, PE enters the POC:halt state immediately. An internal protocol error occurs when PE has not finished a calculation and a new calculation is requested. This can be caused by a hardware error. 0b - No such event 1b - Internal protocol error detected                                                                                                                                                                |
| 13 ILCF_IF | Illegal Protocol Configuration Interrupt Flag Becomes1whenPEhasdetectedanillegal protocol configuration parameter setting. In this case, PEenters the POC:halt state immediately. PE checks the listen_timeout field in Protocol Configuration 14 (PCR14) and Protocol Configuration 15 (PCR15) when the application sent the CONFIG_COMPLETE command via Protocol Operation Control (POCR). If listen_timeout = 0, the protocol configuration setting is considered illegal. 0b - No such event 1b - Illegal protocol configuration detected |
| 12 CSA_IF  | Cold Start Abort Interrupt Flag Becomes 1 when the configured number of allowed cold start attempts is reached and none of these attempts was successful. The number of allowed cold start attempts is configured by PCR3[coldstart_attempts]. 0b - No such event 1b - Cold start aborted and no more coldstart attempts allowed                                                                                                                                                                                                              |
| 11 MRC_IF  | Missing Rate Correction Interrupt Flag Becomes 1 when an insufficient number of measurements is available for rate correction at the end of the communication cycle. 0b - No such event 1b - Insufficient number of measurements for rate correction detected                                                                                                                                                                                                                                                                                 |
| 10 MOC_IF  | Missing Offset Correction Interrupt Flag Becomes 1 when an insufficient number of measurements is available for offset correction. This is related to the MISSING_TERM event in the CSP process for offset correction in the FlexRay protocol. 0b - No such event 1b - Insufficient number of measurements for offset correction detected                                                                                                                                                                                                     |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                     |
|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 9 CCL_IF  | Clock Correction Limit Reached Interrupt Flag Becomes 1 when the internal calculated offset or rate calculation values have reached or exceeded configured thresholds as specified by PCR9[offset_correction_out] and PCR14[rate_correction_out]. 0b - No such event 1b - Offset or rate correction limit reached                                                                            |
| 8 MXS_IF  | Max Sync Frames Detected Interrupt Flag Becomes 1 when the number of synchronization frames detected in the current communication cycle exceeds the value of PCR30[sync_node_max]. Only synchronization frames that have passed the synchronization frame acceptance and rejection filters are taken into account. NOTE 0b - No such event 1b - More than node_sync_max sync frames detected |
| 7 MTX_IF  | Media Access Test Symbol Received Interrupt Flag Becomes 1 when MTS was received on channel A or channel B. 0b - No such event 1b - MTS symbol received                                                                                                                                                                                                                                      |
| 6 LTXB_IF | pLatestTx Violation on Channel B Interrupt Flag Becomes 1 when the frame transmission on channel B in the dynamic segment exceeds the dynamic segment boundary. This is related to the pLatestTx violation, as described in the MAC process of the FlexRay protocol. 0b - No such event 1b - pLatestTx violation occurred on channel B                                                       |
| 5 LTXA_IF | pLatestTx Violation on Channel A Interrupt Flag Becomes 1 when the frame transmission on channel A in the dynamic segment exceeds the dynamic segment boundary. This is related to the pLatestTx violation as described in the MAC process of the FlexRay protocol. 0b - No such event 1b - pLatestTx violation occurred on channel A                                                        |
| 4 TBVB_IF | Transmission Across Boundary On Channel B Interrupt Flag Becomes 1 when the frame transmission on channel B crosses the slot boundary. This is related to the transmission across slot boundary violation as described in the FSP process of the FlexRay protocol. 0b - No such event 1b - Transmission across boundary violation occurred on channel B                                      |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                |
|-----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 3 TBVA_IF | Transmission Across Boundary On Channel A Interrupt Flag Becomes 1 when the frame transmission on channel A crosses the slot boundary. This is related to the transmission across slot boundary violation as described in the FSP process of the FlexRay protocol. 0b - No such event 1b - Transmission across boundary violation occurred on channel A |
| 2 TI2_IF  | Timer 2 Expired Interrupt Flag Becomes 1 whenever timer 2 expires. 0b - No such event 1b - Timer 2 has reached its time limit                                                                                                                                                                                                                           |
| 1 TI1_IF  | Timer 1 Expired Interrupt Flag Becomes 1 whenever timer 1 expires. 0b - No such event 1b - Timer 1 has reached its time limit                                                                                                                                                                                                                           |
| 0 CYS_IF  | Cycle Start Interrupt Flag Becomes 1 when a communication cycle starts. 0b - No such event 1b - Communication cycle started                                                                                                                                                                                                                             |

## 56.7.14 Protocol Interrupt Flag 1 (PIFR1)

## Offset

| Register   | Offset   |
|------------|----------|
| PIFR1      | 1Ah      |

## Function

Holds one set of the protocol-related individual interrupt flags.

## Diagram

| Bits   | 15      | 14     | 13       | 12      | 11       | 10       | 9        | 8        | 7   | 6   | 5       | 4       | 3   | 2   | 1   | 0   |
|--------|---------|--------|----------|---------|----------|----------|----------|----------|-----|-----|---------|---------|-----|-----|-----|-----|
| R      | EMC_ IF | IPC_IF | PECF_ IF | PSC_ IF | SSI3_ IF | SSI2_ IF | SSI1_ IF | SSI0_ IF |     | 0   | EVT_ IF | ODT_ IF |     | 0   |     |     |
| W      | W1C     | W1C    | W1C      | W1C     | W1C      | W1C      | W1C      | W1C      |     |     | W1C     | W1C     |     |     |     |     |
| Reset  | 0       | 0      | 0        | 0       | 0        | 0        | 0        | 0        | 0   | 0   | 0       | 0       | 0   | 0   | 0   | 0   |

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                           |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 EMC_IF    | Error Mode Changed Interrupt Flag Becomes 1 when CC changes the value of PSR0[ERRMODE]. 0b - No such event 1b - ERRMODE field changed                                                                                                                                                                                                                                                                              |
| 14 IPC_IF    | Illegal Protocol Control Command Interrupt Flag Becomes 1 when PE tries to execute a protocol control command that POCR[POCCMD] issued and that PE detected that this protocol control command is not allowed in the current protocol state. In this case the command is not executed. For more details, see Protocol control command execution. 0b - No such event 1b - Illegal protocol control command detected |
| 13 PECF_IF   | PE Communication Failure Interrupt Flag Becomes 1 if CC detects a communication failure between PE and CHI. 0b - No such event 1b - Failure detected                                                                                                                                                                                                                                                               |
| 12 PSC_IF    | Protocol State Changed Interrupt Flag Becomes 1 when the protocol state in PSR0[PROTSTATE] has changed. 0b - No such event 1b - Protocol state changed                                                                                                                                                                                                                                                             |
| 11-8 SSIn_IF | Slot Status Counter Incremented Interrupt Flag n Becomes 1 when the SLOTSTATUSCNT field in the corresponding Slot Status Counter (SSCR0 - SSCR3) increments. 0b - No such event 1b - The corresponding slot status counter has incremented                                                                                                                                                                         |
| 7-6 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                           |
| 5            | Even Cycle Table Written Interrupt Flag                                                                                                                                                                                                                                                                                                                                                                            |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                          |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| EVT_IF   | Becomes 1 if CC wrote the sync frame measurement or ID tables into the FlexRay memory area for the even cycle. 0b - No such event 1b - Sync frame measurement table written                                       |
| 4 ODT_IF | Odd Cycle Table Written Interrupt Flag Becomes 1 if CC wrote the sync frame measurement or ID tables into the FlexRay memory area for the odd cycle. 0b - No such event 1b - Sync frame measurement table written |
| 3-0 -    | Reserved                                                                                                                                                                                                          |

## 56.7.15 Protocol Interrupt Enable 0 (PIER0)

## Offset

| Register   | Offset   |
|------------|----------|
| PIER0      | 1Ch      |

## Function

Defines whether the individual interrupt flags defined in Protocol Interrupt Flag 0 (PIFR0) can generate a protocol interrupt request.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                   |
|---------|------------------------------------------------------------|
| 15      | Fatal Protocol Error Interrupt Enable                      |
| FATL_IE | Enables and disables FATL_IF interrupt request generation. |
|         | 0b - Disabled                                              |
|         | 1b - Enabled                                               |

Table continues on the next page...

## Table continued from the previous page...

| Field      | Function                                                                                                                              |
|------------|---------------------------------------------------------------------------------------------------------------------------------------|
| 14 INTL_IE | Internal Protocol Error Interrupt Enable Enables and disables INTL_IF interrupt request generation. 0b - Disabled 1b - Enabled        |
| 13 ILCF_IE | Illegal Protocol Configuration Interrupt Enable Enables and disables ILCF_IF interrupt request generation. 0b - Disabled 1b - Enabled |
| 12 CSA_IE  | Cold Start Abort Interrupt Enable Enables and disables CSA_IF interrupt request generation. 0b - Disabled 1b - Enabled                |
| 11 MRC_IE  | Missing Rate Correction Interrupt Enable Enables and disables MRC_IF interrupt request generation. 0b - Disabled 1b - Enabled         |
| 10 MOC_IE  | Missing Offset Correction Interrupt Enable Enables and disables MOC_IF interrupt request generation. 0b - Disabled 1b - Enabled       |
| 9 CCL_IE   | Clock Correction Limit Reached Interrupt Enable Enables and disables CCL_IF interrupt request generation. 0b - Disabled 1b - Enabled  |
| 8 MXS_IE   | Max Sync Frames Detected Interrupt Enable Enables and disables MXS_IF interrupt request generation. 0b - Disabled 1b - Enabled        |
| 7 MTX_IE   | Media Access Test Symbol Received Interrupt Enable Enables and disables MTX_IF interrupt request generation. 0b - Disabled            |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                         |
|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| 6 LTXB_IE | pLatestTx Violation on Channel B Interrupt Enable Enables and disables LTXB_IF interrupt request generation. 0b - Disabled 1b - Enabled          |
| 5 LTXA_IE | pLatestTx Violation On Channel A Interrupt Enable Enables and disables LTXA_IF interrupt request generation. 0b - Disabled 1b - Enabled          |
| 4 TBVB_IE | Transmission Across Boundary On Channel B Interrupt Enable Enables and disables TBVB_IF interrupt request generation. 0b - Disabled 1b - Enabled |
| 3 TBVA_IE | Transmission Across Boundary On Channel A Interrupt Enable Enables and disables TBVA_IF interrupt request generation. 0b - Disabled 1b - Enabled |
| 2 TI2_IE  | Timer 2 Expired Interrupt Enable Enables and disables TI1_IF interrupt request generation. 0b - Disabled 1b - Enabled                            |
| 1 TI1_IE  | Timer 1 Expired Interrupt Enable Enables and disables TI1_IF interrupt request generation. 0b - Disabled 1b - Enabled                            |
| 0 CYS_IE  | Cycle Start Interrupt Enable Enables and disables CYC_IF interrupt request generation. 0b - Disabled 1b - Enabled                                |

## 56.7.16 Protocol Interrupt Enable 1 (PIER1)

## Offset

| Register   | Offset   |
|------------|----------|
| PIER1      | 1Eh      |

## Function

Defines whether the individual interrupt flags defined in Protocol Interrupt Flag 1 (PIFR1) can generate a protocol interrupt request.

## Diagram

<!-- image -->

| Bits   | 15      | 14     | 13       | 12      | 11       | 10       | 9        | 8        |   7 | 6   | 5       | 4       | 3   |   2 | 1   | 0   |
|--------|---------|--------|----------|---------|----------|----------|----------|----------|-----|-----|---------|---------|-----|-----|-----|-----|
| R W    | EMC_ IE | IPC_IE | PECF_ IE | PSC_ IE | SSI3_ IE | SSI2_ IE | SSI1_ IE | SSI0_ IE |   0 |     | EVT_ IE | ODT_ IE |     |   0 |     |     |
| Reset  | 0       | 0      | 0        | 0       | 0        | 0        | 0        | 0        |   0 | 0   | 0       | 0       | 0   |   0 | 0   | 0   |

## Fields

| Field      | Function                                                                                                                               |
|------------|----------------------------------------------------------------------------------------------------------------------------------------|
| 15 EMC_IE  | Error Mode Changed Interrupt Enable Enables and disables EMC_IF interrupt request generation. 0b - Disabled 1b - Enabled               |
| 14 IPC_IE  | Illegal Protocol Control Command Interrupt Enable Enables and disables IPC_IF interrupt request generation. 0b - Disabled 1b - Enabled |
| 13 PECF_IE | PE Communication Failure Interrupt Enable Enables and disables PECF_IF interrupt request generation. 0b - Disabled 1b - Enabled        |
| 12 PSC_IE  | Protocol State Changed Interrupt Enable Enables and disables PSC_IF interrupt request generation. 0b - Disabled 1b - Enabled           |
| 11-8       | Slot Status Counter Incremented Interrupt Enable Enables and disables SSI[3:0]_IF interrupt request generation.                        |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                       |
|----------|--------------------------------------------------------------------------------------------------------------------------------|
| SSIn_IE  | 0b - Disabled 1b - Enabled                                                                                                     |
| 7-6 -    | Reserved                                                                                                                       |
| 5 EVT_IE | Even Cycle Table Written Interrupt Enable Enables and disables EVT_IF interrupt request generation. 0b - Disabled 1b - Enabled |
| 4 ODT_IE | Odd Cycle Table Written Interrupt Enable Enables and disables ODT_IF interrupt request generation. 0b - Disabled 1b - Enabled  |
| 3-0 -    | Reserved                                                                                                                       |

## 56.7.17 CHI Error Flag (CHIERFR)

## Offset

| Register   | Offset   |
|------------|----------|
| CHIERFR    | 20h      |

## Function

Holds the CHI-related error flags. GIFER[CHIE] controls the interrupt generation for each of these error flags.

## Diagram

<!-- image -->

| Bits   | 15       | 14       | 13       | 12       | 11       | 10      | 9       | 8       | 7   | 6        | 5       | 4       | 3       | 2       | 1       | 0        |
|--------|----------|----------|----------|----------|----------|---------|---------|---------|-----|----------|---------|---------|---------|---------|---------|----------|
| R      | FRLB_ EF | FRLA_ EF | PCMI_ EF | FOVB _EF | FOVA _EF | MBS_ EF | MBU_ EF | LCK_ EF | 0   | SBCF_ EF | FID_ EF | DPL_ EF | SPL_ EF | NML_ EF | NMF_ EF | ILSA_ EF |
| W      | W1C      | W1C      | W1C      | W1C      | W1C      | W1C     | W1C     | W1C     |     | W1C      | W1C     | W1C     | W1C     | W1C     | W1C     | W1C      |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0       | 0       | 0       | 0   | 0        | 0       | 0       | 0       | 0       | 0       | 0        |

## Fields

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                               |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 FRLB_EF | Frame Lost Channel B Error Flag Becomes 1 if a complete frame is received on channel B but could not be stored in the selected individual MBbecause the application has currently locked this MB. In this case, the frame and the related slot status information are lost. 0b - No such event 1b - Frame lost on channel B detected                                                                                   |
| 14 FRLA_EF | Frame Lost Channel A Error Flag Becomes 1 if a complete frame is received on channel A but could not be stored in the selected individual MBbecause the application has currently locked this MB. In this case, the frame and the related slot status information are lost. 0b - No such error 1b - Frame lost on channel A detected                                                                                   |
| 13 PCMI_EF | Protocol Command Ignored Error Flag Becomes 1 if the application has issued a POCcommandbywriting to POCR[POCCMD]while the BSYflag is equal to 1. In this case CC ignores and discards the command. 0b - No such error 1b - POC command is ignored                                                                                                                                                                     |
| 12 FOVB_EF | Receive FIFO Overrun Channel B Error Flag Becomes 1 when an overrun of the FIFO for channel Boccurs. The error occurs if a semantically valid frame is received on channel Band matches the all criteria to be appended to the FIFO for channel Bbut the FIFO is full. In this case, the received frame and its related slot status information is lost. 0b - No such error 1b - FIFO overrun on channel B is detected |
| 11 FOVA_EF | Receive FIFO Overrun Channel A Error Flag Becomes 1 when an overrun of the FIFO for channel Aoccurs. The error occurs if a semantically valid frame is received on channel Aand matches all the criteria to be appended to the FIFO for channel Abut the FIFO is full. In this case, the received frame and its related slot status information is lost. 0b - No such error 1b - FIFO overrun on channel B is detected |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 10 MBS_EF | MB Search Error Flag Becomes 1 if at least one of the following events occurs: • The MB search engine is still running while the next search must be started because of the FlexRay protocol timing • A MB index greater than 259 is detected in the MBIDX field of MB Index (MBIDXR0 - MBIDXR255) of a found MB or in RSBIR[RSBIDX]. See MB search error for details. 0b - No such event 1b - Search engine is active while search start appears or illegal MB index is detected |
| 9 MBU_EF  | MB Usage Error Flag Becomes1if the application writes to a MBcontrol field thatisbeyondthenumberofusedMBsprogrammed in MB Segment Size and Utilization (MBSSUTR). If the application writes to MB Configuration Control Status (MBCCSR0 - MBCCSR255) with n > LAST_MB_UTIL, CC ignores the write attempt and causes MBU_EF to become 1. 0b - No such event 1b - Unused MB enabled                                                                                                 |
| 8 LCK_EF  | Lock Error Flag Becomes 1 if the application tries to lock a MBthat CCalready locked because of internal operations. In that case, CC does not grant the lock to the application. The application must issue the lock request again. 0b - No such error 1b - Lock error detected                                                                                                                                                                                                  |
| 7 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 6 SBCF_EF | System Bus Communication Failure Error Flag Becomes 1 if a system bus access is not finished within the required amount of time (see System bus access timeout). 0b - No such event 1b - System bus access not finished in time                                                                                                                                                                                                                                                   |
| 5 FID_EF  | FID Error Flag Becomes1if the frame ID stored in the MBheaderareadiffers from the FID stored in the MBcontrol register. 0b - No such error occurred 1b - FID error occurred                                                                                                                                                                                                                                                                                                       |
| 4         | Dynamic Payload Length Error Flag                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                              |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| DPL_EF    | Becomes 1 if the payload length written into the MB header field of a transmit MB assigned to the dynamic segment is greater than the maximum payload length for the dynamic segment as it is configured in PCR24[max_payload_length_dynamic]. 0b - No such error occurred 1b - Dynamic payload length error occurred                                                                                 |
| 3 SPL_EF  | Static Payload Length Error Flag Becomes 1 if the payload length written into the MB header field of a transmit MB assigned to the static segment is different from the payload length for the static segment as it is configured in PCR19[payload_length_static]. 0b - No such error occurred 1b - Static payload length error occurred                                                              |
| 2 NML_EF  | Network Management Length Error Flag Becomes 1 if the payload length written into the header structure of a receive MB assigned to the static segment is less than the configured NMV length as configured in Network Management Vector Length Register (NMVLR). In this case, the received NMV part is used to update NMV. 0b - No such error occurred 1b - Network management length error occurred |
| 1 NMF_EF  | Network Management Frame Error Flag Becomes 1 if a received message in the static segment with a Preamble Indicator flag PP asserted has its Null Frame indicator flag NF asserted as well. In this case, NMV n (NMVR0 - NMVR5) are not updated. 0b - No such error occurred 1b - Network management frame error occurred                                                                             |
| 0 ILSA_EF | Illegal System Bus Address Error Flag Becomes 1 if the external system bus subsystem has detected an access to an illegal system bus address from CC (see System bus illegal address access). 0b - No such event 1b - Illegal system bus address accessed                                                                                                                                             |

## 56.7.18 MB Interrupt Vector (MBIVEC)

## Offset

| Register   | Offset   |
|------------|----------|
| MBIVEC     | 22h      |

## Function

Indicates the lowest numbered receive MB and the lowest numbered transmit MB that have their MBIF = MBIE = 1. This means that MBs with lower MB numbers have higher priority.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                    |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-8    | Transmit Buffer Interrupt Vector                                                                                                                                            |
| TBIVEC  | Provides the MB number of the lowest numbered enabled transmit MB that has its MBIF = MBIE = 1. If no receive MB exists with MBIF = MBIE = 1, the value of this field is 0. |
| 7-0     | Receive Buffer Interrupt Vector                                                                                                                                             |
| RBIVEC  | Provides the MBnumber of the lowest numbered receive MBthat has its MBIF = MBIE = 1. If no receiveMB exists with MBIF = MBIE = 1, the value of this field is 0.             |

## 56.7.19 Channel A Status Error Counter Register (CASERCR)

## Offset

| Register   | Offset   |
|------------|----------|
| CASERCR    | 24h      |

## Function

Provides the channel status error counter for channel A.

PE generates a slot status vector for:

- Each static slot
- Each dynamic slot
- The symbol window
- NIT

The slot status vector contains the four protocol-related error indicator bits:

- vSS!SyntaxError
- vSS!ContentError
- vSS!BViolation
- vSS!TxConflict

FlexRay Communication Controller (FlexRay)

FlexRay Communication Controller (FlexRay)

CC increments the status error counter by 1 if, for a slot or segment, at least one error indicator bit is 1. The counter wraps around after it reaches the maximum value. For more information on slot status monitoring, see Slot status monitoring.

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                           |
|-----------|------------------------------------------------------------------------------------|
| 15-0      | Channel A Status Error Counter                                                     |
| CHAERSCNT | Provides the current channel status error count.                                   |
| CHAERSCNT | The counter value is updated within the first MT of the following slot or segment. |

## 56.7.20 Channel B Status Error Counter (CBSERCR)

## Offset

| Register   | Offset   |
|------------|----------|
| CBSERCR    | 26h      |

## Function

Provides the channel status error counter for channel B.

PE generates a slot status vector for:

- Each static slot
- Each dynamic slot
- The symbol window
- NIT

The slot status vector contains the four protocol-related error indicator bits:

- vSS!SyntaxError
- vSS!ContentError
- vSS!BViolation
- vSS!TxConflict

CC increments the status error counter by 1 if, for a slot or segment, at least one error indicator bit is 1. The counter wraps around after it reaches the maximum value. For more information on slot status monitoring, see Slot status monitoring.

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                           |
|-----------|------------------------------------------------------------------------------------|
| 15-0      | Channel B Status Error Counter                                                     |
| CHBERSCNT | Provides the current channel status error count.                                   |
| CHBERSCNT | The counter value is updated within the first MT of the following slot or segment. |

## 56.7.21 Protocol Status 0 (PSR0)

## Offset

| Register   | Offset   |
|------------|----------|
| PSR0       | 28h      |

## Function

Provides information about the current protocol status.

## Diagram

| Bits   | 15 14   | 13 12    | 11   | 10 9 8    | 7 6 5        | 3 2 1 0        |
|--------|---------|----------|------|-----------|--------------|----------------|
| R      | ERRMODE | SLOTMODE | 0    | PROTSTATE | STARTUPSTATE | 0 WAKEUPSTATUS |
| W      |         |          |      |           |              |                |

## Fields

| Field   | Function                                      |
|---------|-----------------------------------------------|
| 15-14   | Error Mode                                    |
| ERRMODE | This field indicates the protocol error mode. |
|         | Protocol related variable: vPOC!ErrorMode     |
|         | 00b - ACTIVE                                  |
|         | 01b - PASSIVE                                 |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

## Table continued from the previous page...

| Field             | Function                                                                                                                                                                                                                                                                                                                                                                              |
|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 13-12 SLOTMODE    | 11b - Reserved Slot Mode Indicates the protocol slot mode. Protocol related variable: vPOC!SlotMode 00b - SINGLE 01b - ALL_PENDING                                                                                                                                                                                                                                                    |
| 11 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                              |
| 10-8 PROTSTATE    | Protocol State Indicates the state of the protocol. Protocol related variable: vPOC!State 000b - POC:default config 001b - POC:config 010b - POC:wakeup 011b - POC:ready 100b - POC:normal passive 101b - POC:normal active 110b - POC:halt 111b - POC:startup                                                                                                                        |
| 7-4 STARTUPSTAT E | Startup State Indicates the current sub-state of the startup procedure. Protocol related variable: vPOC!StartupState 0010b - POC:coldstart collision resolution 0011b - POC:coldstart listen 0100b - POC:integration consistency check 0101b - POC:integration listen 0111b - POC:initialize schedule 1010b - POC:coldstart consistency check 1101b - POC:integration coldstart check |

Table continues on the next page...

Table continued from the previous page...

| Field             | Function                                                                                                                                                                                                                                                                                       |
|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                   | 1110b - POC:coldstart gap 1111b - POC:coldstart join All other values are reserved.                                                                                                                                                                                                            |
| 3 -               | Reserved                                                                                                                                                                                                                                                                                       |
| 2-0 WAKEUPSTAT US | Wakeup Status Provides the outcome of the execution of the wakeup mechanism. Protocol-related variable: vPOC!WakeupStatus 000b - UNDEFINED 001b - RECEIVED_HEADER 010b - RECEIVED_WUP 011b - COLLISION_HEADER 100b - COLLISION_WUP 101b - COLLISION_UNKNOWN 110b - TRANSMITTED 111b - Reserved |

## 56.7.22 Protocol Status 1 (PSR1)

## Offset

| Register   | Offset   |
|------------|----------|
| PSR1       | 2Ah      |

## Diagram

<!-- image -->

| Bits   | 15   | 14   | 13   | 12   | 11      | 10   | 9   | 8   | 7   | 6   | 5   | 4   | 3 2   | 1   | 0   |
|--------|------|------|------|------|---------|------|-----|-----|-----|-----|-----|-----|-------|-----|-----|
| R      | CSAA | CSP  | 0    |      | REMCSAT |      |     |     | CPN | HHR | FRZ |     | APTAC |     |     |
| W      | W1C  |      |      |      |         |      |     |     |     |     |     |     |       |     |     |
| Reset  | 0    | 0    | 0    | 0    | 0       | 0    | 0   | 0   | 0   | 0   | 0   | 0   | 0 0   |     | 0 0 |

## Fields

|   Field | Function                        |
|---------|---------------------------------|
|      15 | Cold Start Attempt Aborted Flag |

Table continues on the next page...

## Table continued from the previous page...

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                 |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CSAA         | Becomes 1 when CC aborts a cold start attempt. Protocol related event: set coldstart abort indicator in CHI 0b - No such event 1b - Cold start attempt aborted                                                                                                                                                                                                                                           |
| 14 CSP       | Leading Cold Start Path Becomes1whenCCreachesthePOC:normalactive state via the leading cold start path. This indicates that this node has started the network. 0b - No such event 1b - POC:normal active reached from POC:startup state via the leading cold start path                                                                                                                                  |
| 13 -         | Reserved                                                                                                                                                                                                                                                                                                                                                                                                 |
| 12-8 REMCSAT | Remaining Coldstart Attempts Provides the number of remaining cold start attempts that CC will execute. Protocol related variable: vRemainingColdstartAttempts                                                                                                                                                                                                                                           |
| 7 CPN        | Leading Cold Start Path Noise Becomes1if CCreachesthe POC:normal active state via the leading cold start path under noise conditions. This indicates some activity occurred on the FlexRay bus while CC was starting up the cluster. Protocol related variable: vPOC!ColdstartNoise 0b - No such event 1b - POC:normal active state was reached from POC:startup state via noisy leading cold start path |
| 6 HHR        | Host Halt Request Pending Becomes 1 when CC receives the HALT command from the application via Protocol Operation Control (POCR). CC returns this field to 0 after a hard reset condition or when the protocol is in the POC:default config state. Protocol related variable: vPOC!CHIHaltRequest 0b - No such event 1b - HALT command received                                                          |
| 5 FRZ        | Freeze Occurred Becomes1whenCCreachesthePOC:haltstatebecauseofthehostFREEZEcommandoraninternalerror condition requiring immediate halt. CCreturns this field to 0 after a hard reset condition or when the protocol is in the POC:default config state. Protocol related variable: vPOC!Freeze                                                                                                           |

Table continues on the next page...

Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           | 0b - No such event 1b - Immediate halt because of FREEZE or internal error condition                                                                                                                                                                                                                                                                                                                                          |
| 4-0 APTAC | Allow Passive To Active Counter Provides the number of consecutive even/odd communication cycle pairs that have passed with valid rate and offset correction terms, but the protocol is still in the POC:normal passive state because of an application configured delay to enter the POC:normal active state. This delay is defined by PCR12[allow_passive_to_active]. Protocol related variable: vPOC!vAllowPassivetoActive |

## 56.7.23 Protocol Status 2 (PSR2)

## Offset

| Register   | Offset   |
|------------|----------|
| PSR2       | 2Ch      |

## Function

Provides a snapshot of status information about:

- NIT
- The symbol window
- Clock synchronization

CC updates the NIT-related status fields-NBVB, NSEB, NBVA, and NSEA-after the end of the NIT and before the end of the first slot of the next communication cycle.

CC updates the fields related to the symbol window-STCB, SBVB, SSEB, MTB, STCA, SBVA, SSEB, and MTA-after the end of the symbol window and before the end of the current communication cycle. If no symbol window is configured, the status fields related to the symbol window remain in their reset state.

CC updates the clock-synchronization-related CLKCORRFAILCNT after the end of the static segment and before the end of the current communication cycle.

## Diagram

| Bits   | Bits   | 15 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    |     | 4         | 3 2       | 1         | 0         |
|--------|--------|---------|------|------|------|------|------|------|------|------|------|-----|-----------|-----------|-----------|-----------|
| R      | NBVB   | NSEB    | STCB | SBVB | SSEB | MTB  | NBVA | NSEA | STCA | SBVA | SSEA | MTA | CKCORFCNT | CKCORFCNT | CKCORFCNT | CKCORFCNT |
| W      |        |         |      |      |      |      |      |      |      |      |      |     |           |           |           |           |
| Reset  | 0      | 0       | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0   | 0         | 0         | 0         | 0         |

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                                   |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 NBVB | NIT Boundary Violation On Channel B Becomes 1 when some media activity occurs on the FlexRay bus channel B at the end of NIT. Protocol related variable: vSS!BViolation for NIT on channel B 0b - No such event 1b - Media activity detected at boundaries                                                 |
| 14 NSEB | NIT Syntax Error On Channel B Becomes 1 when a syntax error is detected during NIT on channel B. Protocol related variable: vSS!SyntaxError for NIT on channel B 0b - No such event 1b - Syntax error detected                                                                                             |
| 13 STCB | Symbol Window Transmit Conflict On Channel B Becomes 1 if a transmission conflict occurs during the symbol window on channel B. Protocol related variable: vSS!TxConflict for symbol window on channel B 0b - No such event 1b - Transmission conflict detected                                            |
| 12 SBVB | Symbol Window Boundary Violation On Channel B Becomes 1 if some media activity occurs on the FlexRay bus channel B at the start or at the end of the symbol window. Protocol related variable: vSS!BViolation for symbol window on channel B 0b - No such event 1b - Media activity detected at boundaries |
| 11 SSEB | Symbol Window Syntax Error On Channel B Becomes 1 when a syntax error is detected during the symbol window on channel B. Protocol related variable: vSS!SyntaxError for symbol window on channel B 0b - No such event 1b - Syntax error detected                                                           |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                   |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 10 MTB  | MTS Received On Channel B Becomes 1 if MTS is received in the symbol window on channel B. Protocol related variable: vSS!ValidMTS for Symbol Window on channel B 0b - No such event 1b - MTS received                                                                                                      |
| 9 NBVA  | NIT Boundary Violation On Channel A Becomes 1 when some media activity occurs on the FlexRay bus channel A at the end of NIT. Protocol related variable: vSS!BViolation for NIT on channel A. 0b - No such event 1b - Media activity detected at boundaries                                                |
| 8 NSEA  | NIT Syntax Error On Channel A Becomes 1 when a syntax error is detected during NIT on channel A. Protocol related variable: vSS!SyntaxError for NIT on channel A 0b - No such event 1b - Syntax error detected                                                                                             |
| 7 STCA  | Symbol Window Transmit Conflict On Channel A Becomes 1 if transmission conflicts occur during the symbol window on channel A. Protocol related variable: vSS!TxConflict for symbol window on channel A 0b - No such event 1b - Transmission conflict detected                                              |
| 6 SBVA  | Symbol Window Boundary Violation On Channel A Becomes 1 if some media activity occurs on the FlexRay bus channel A at the start or at the end of the symbol window. Protocol related variable: vSS!BViolation for symbol window on channel A 0b - No such event 1b - Media activity detected at boundaries |
| 5 SSEA  | Symbol Window Syntax Error On Channel A Becomes 1 when a syntax error is detected during the symbol window on channel A. Protocol related variable: vSS!SyntaxError for symbol window on channel A 0b - No such event 1b - Syntax error detected                                                           |
| 4       | MTS Received On Channel A                                                                                                                                                                                                                                                                                  |

Table continues on the next page...

Table continued from the previous page...

| Field         | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| MTA           | Becomes 1 if MTS is received in the symbol window on channel A. Protocol related variable: vSS!ValidMTS for symbol window on channel A 0b - No such event 1b - MTS received                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 3-0 CKCORFCNT | Clock Correction Failed Counter Provides the number of consecutive even/odd communication cycle pairs that have passed without clock synchronization having performed an offset or a rate correction because of lack of synchronization frames. This field does not increment when it reaches the value in either the max_without_clock_correction_fatal or max_without_clock_correction_passive fields in Protocol Configuration 8 (PCR8). CC resets this field: • After a hard reset condition • When the protocol enters the POC:normal active state • When both the rate and offset correction terms have been calculated successfully Protocol related variable: vClockCorrectionFailed |

## 56.7.24 Protocol Status 3 (PSR3)

## Offset

| Register   | Offset   |
|------------|----------|
| PSR3       | 2Eh      |

## Function

## Provides:

- Aggregated channel status information as an accrued status of channel activity for all communication slots, regardless of whether they are assigned for transmission or subscribed for reception
- Accrued information for:
- The symbol window
- NIT
- The wakeup status

## Diagram

<!-- image -->

| Bits   | 15   | 13   | 12   | 11   | 10      | 9    | 8    | 7   | 6   | 5   | 4    | 3    | 2    | 1    | 0    |
|--------|------|------|------|------|---------|------|------|-----|-----|-----|------|------|------|------|------|
| R      | 0    | WUB  | ABVB | AACB | ACEB    | ASEB | AVFB |     |     | WUA | ABVA | AACA | ACEA | ASEA | AVFA |
| W      |      | W1C  |      | W1C  | W1C W1C | W1C  | W1C  |     |     | W1C | W1C  | W1C  | W1C  | W1C  | W1C  |
| Reset  | 0    | 0    | 0    | 0    | 0       | 0    | 0    | 0   | 0   | 0   | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                                                |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-14 - | Reserved                                                                                                                                                                                                                                                                                                                |
| 13 WUB  | Wakeup Symbol Received On Channel B Becomes 1 when a wakeup symbol was received on channel B. 0b - Not received 1b - Received                                                                                                                                                                                           |
| 12 ABVB | Aggregated Boundary Violation On Channel B Becomes 1 when a boundary violation has been detected on channel B. Boundary violations are detected in the communication slots, the symbol window, and NIT. 0b - No violation detected 1b - Violation detected                                                              |
| 11 AACB | Aggregated Additional Communication On Channel B Becomes 1 when at least one valid frame is received on channel B in a slot that also contains an additional communication with syntax errors, content errors, or boundary violations. 0b - No additional communication detected 1b - Additional communication detected |
| 10 ACEB | Aggregated Content Error On Channel B Becomes 1 when a content error is detected on channel B. Content errors are detected in the communication slots, the symbol window, and NIT. 0b - No error detected 1b - Errors detected                                                                                          |
| 9 ASEB  | Aggregated Syntax Error On Channel B Becomes 1 when a syntax error is detected on channel B. Syntax errors are detected in the communication slots, the symbol window and NIT. 0b - No error detected 1b - Errors detected                                                                                              |
| 8       | Aggregated Valid Frame On Channel B                                                                                                                                                                                                                                                                                     |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                     |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AVFB    | Becomes 1 when a syntactically correct valid frame is received in any static or dynamic slot through channel B. 0b - No syntactically valid frames received 1b - At least one syntactically valid frame received                                                                                             |
| 7-6 -   | Reserved                                                                                                                                                                                                                                                                                                     |
| 5 WUA   | Wakeup Symbol Received On Channel A Becomes 1 when a wakeup symbol is received on channel A. 0b - Not received 1b - Received                                                                                                                                                                                 |
| 4 ABVA  | Aggregated Boundary Violation On Channel A Becomes 1 when a boundary violation is detected on channel A. Boundary violations are detected in the communication slots, the symbol window, and NIT. 0b - No violation detected 1b - Violation detected                                                         |
| 3 AACA  | Aggregated Additional Communication On Channel A Becomes 1 when a valid frame is received in a slot on channel A that also contains an additional communication with syntax errors, content errors, or boundary violations. 0b - No additional communication detected 1b - Additional communication detected |
| 2 ACEA  | Aggregated Content Error On Channel A Becomes 1 when a content error is detected on channel A. Content errors are detected in the communication slots, the symbol window, and NIT. 0b - No error detected 1b - Errors detected                                                                               |
| 1 ASEA  | Aggregated Syntax Error On Channel A Becomes 1 when a syntax error is detected on channel A. Syntax errors are detected in the communication slots, the symbol window, and NIT. 0b - No error detected 1b - Errors detected                                                                                  |
| 0 AVFA  | Aggregated Valid Frame On Channel A Becomes 1 when a syntactically correct valid frame is received in any static or dynamic slot through channel A.                                                                                                                                                          |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                         |
|---------|--------------------------------------------------------------------------------------------------|
|         | 0b - No syntactically valid frames received 1b - At least one syntactically valid frame received |

## 56.7.25 MT Counter (MTCTR)

## Offset

| Register   | Offset   |
|------------|----------|
| MTCTR      | 30h      |

## Function

Provides the MT count of the current communication cycle.

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 15-14 - | Reserved   |
| 13-0    | MT Counter |

## 56.7.26 Cycle Counter (CYCTR)

## Offset

| Register   | Offset   |
|------------|----------|
| CYCTR      | 32h      |

FlexRay Communication Controller (FlexRay)

## Function

Provides the number of the current communication cycle.

## Diagram

<!-- image -->

## Fields

| Field      | Function                                                                                                                                                                                                      |
|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-6 -     | Reserved                                                                                                                                                                                                      |
| 5-0 CYCCNT | Cycle Counter Provides the number of the current communication cycle. If the counter reaches the maximum value of 63, the counter wraps and starts from zero again. Protocol related variable: vCycleCounter. |

## 56.7.27 Slot Counter Channel A (SLTCTAR)

## Offset

| Register   | Offset   |
|------------|----------|
| SLTCTAR    | 34h      |

## Function

Provides the number of the current slot in the current communication cycle for channel A.

FlexRay Communication Controller (FlexRay)

## Diagram

<!-- image -->

## Fields

| Field    | Function                                                                                                                          |
|----------|-----------------------------------------------------------------------------------------------------------------------------------|
| 15-11    | Reserved                                                                                                                          |
| 10-0     | Slot Counter Value For Channel A                                                                                                  |
| SLOTCNTA | Provides the number of the current slot in the current communication cycle. Protocol related variable: vSlotCounter for channel A |

## 56.7.28 Slot Counter Channel B (SLTCTBR)

## Offset

| Register   | Offset   |
|------------|----------|
| SLTCTBR    | 36h      |

## Function

Provides the number of the current slot in the current communication cycle for channel B.

## Diagram

<!-- image -->

## Fields

| Field   | Function                         |
|---------|----------------------------------|
| 15-11   | Reserved                         |
| - 10-0  | Slot Counter Value For Channel B |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table continued from the previous page...

| Field    | Function                                                                                                                          |
|----------|-----------------------------------------------------------------------------------------------------------------------------------|
| SLOTCNTB | Provides the number of the current slot in the current communication cycle. Protocol related variable: vSlotCounter for channel B |

## 56.7.29 Rate Correction Value (RTCORVR)

## Offset

| Register   | Offset   |
|------------|----------|
| RTCORVR    | 38h      |

## Function

Provides the sign-extended rate correction value in µTs as the clock synchronization algorithm calculates it. CC updates this register during NIT of each odd-numbered communication cycle.

## Diagram

<!-- image -->

## Fields

| Field         | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-0 RATECORR | Rate Correction Value Provides the sign-extended rate correction value in µTs as the clock synchronization algorithm calculates it. The value is represented in twos-complement format. This value does not include the value limitation and the application of the external rate correction. If the magnitude of the internally calculated rate correction value exceeds the limit given by PCR14[rate_correction_out], CC changes PIFR0[CCL_IF] to 1. Protocol related variable: vRateCorrection (before value limitation and external rate correction). If CC cannot calculate a new rate correction term because of a lack of synchronization frames, the RATECORR value is not updated. NOTE |

FlexRay Communication Controller (FlexRay)

## 56.7.30 Offset Correction Value (OFCORVR)

## Offset

| Register   | Offset   |
|------------|----------|
| OFCORVR    | 3Ah      |

## Function

Provides the sign-extended offset correction value in µTs as the clock synchronization algorithm calculates it.

CC updates this register during NIT.

## Diagram

<!-- image -->

## Fields

| Field           | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-0 OFFSETCORR | Offset Correction Value Provides the sign-extended offset correction value in µTs as the the clock synchronization algorithm calculates it. The value is represented in twos-complement format. This value does not include the value limitation and the application of the external offset correction. If the magnitude of the internally-calculated rate correction value exceeds the limit set by PCR29[extern_offset_correction],CCchangesPIFR0[CCL_IF] to 1. Protocol related variable: vOffsetCorrection (before value limitation and external offset correction) If CC cannot calculate a new offset correction term because of a lack of synchronization frames, the OFFSETCORR value is not updated. NOTE |

## 56.7.31 Combined Interrupt Flag (CIFR)

## Offset

| Register   | Offset   |
|------------|----------|
| CIFR       | 3Ch      |

## Function

Provides five combined interrupt flags and a copy of three individual interrupt flags.

The combined interrupt flags are the result of a binary OR of the values of other interrupt flags regardless of the state of the interrupt enable fields. The generation scheme for the combined interrupt flags is described in Module interrupt.

## Diagram

<!-- image -->

## Fields

| Field    | Function                                                                                                                                                                                                                                                                                            |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-8 -   | Reserved                                                                                                                                                                                                                                                                                            |
| 7 MIF    | Module Interrupt Flag Becomes 1 if at least one interrupt source has its interrupt flag equal to 1. 0b - No interrupt source has its interrupt flag equal to 1. 1b - At least one interrupt source has its interrupt flag equal to 1.                                                               |
| 6 PRIF   | Protocol Interrupt Flag Becomes 1 if at least one of the individual protocol interrupt flags in Protocol Interrupt Flag 0 (PIFR0) or Protocol Interrupt Flag 1 (PIFR1) is 1. 0b - All individual protocol interrupt flags are 0. 1b - At least one of the individual protocol interrupt flags is 1. |
| 5 CHIF   | CHI Interrupt Flag Becomes 1 if at least one of the individual CHI error flags in CHI Error Flag (CHIERFR) is 1. 0b - All CHI error flags are 0. 1b - At least one CHI error flag is 1.                                                                                                             |
| 4 WUPIF  | Wakeup Interrupt Flag Provides the same value as GIFER[WUPIF].                                                                                                                                                                                                                                      |
| 3 FAFBIF | Receive FIFO Channel B Almost Full Interrupt Flag Provides the same value as GIFER[FAFBIF].                                                                                                                                                                                                         |
| 2        | Receive FIFO Channel A Almost Full Interrupt Flag                                                                                                                                                                                                                                                   |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

The individual interrupt flags WUPIF, FAFBIF, and FAFAIF are copies of corresponding flags in Global Interrupt Flag And Enable (GIFER) and are provided here to simplify the application interrupt flag check. To clear the individual interrupt flags, you must use Global Interrupt Flag And Enable (GIFER).

## NOTE

The meanings of the combined status fields MIF, PRIF, CHIF, RBIF, and TBIF are different from those mentioned in Global Interrupt Flag And Enable (GIFER).

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                             |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| FAFAIF  | Provides the same value as GIFER[FAFAIF].                                                                                                                                                                                                                            |
| 1 RBIF  | Receive MB Interrupt Flag Becomes 1 if for at least one of the individual receive MBs (MBCCSR n [MTD] = 0), the corresponding MBCCSR n [MBIF] = 1. 0b - None of the individual receive MBs have have MBIF = 1. 1b - At least one individual receive MB has MBIF = 1. |
| 0 TBIF  | Transmit MB Interrupt Flag Becomes 1 if for at least one of the individual transmit MBs (MBCCSR n [MTD] = 1), the corresponding MBCCSR n [MBIF] = 1. 0b - None of the individual transmit MBs have MBIF = 1. 1b - At least one individual transmit MB has MBIF = 1.  |

## 56.7.32 System Memory Access Timeout (SYMATOR)

## Offset

| Register   | Offset   |
|------------|----------|
| SYMATOR    | 3Eh      |

## Function

Controls when a system bus access timeout is detected.

For a detailed description, see Configure SYMATOR[TIMEOUT] and CHI clock frequency and System bus access timeout.

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 15-8    | Reserved   |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                              |
|---------|-------------------------------------------------------|
| 7-0     | System Memory Access Timeout                          |
| TIMEOUT | Defines when a system bus access timeout is detected. |

## 56.7.33 Sync Frame Counter (SFCNTR)

## Offset

| Register   | Offset   |
|------------|----------|
| SFCNTR     | 40h      |

## Function

Provides the number of synchronization frames that are used for clock synchronization in the last even and in the last odd numbered communication cycle.

This register is updated after the start of NIT and before 10 MT after offset correction start.

If you have locked the even synchronization table at the end of the static segment of an even communication cycle, CC does not update the SFEVB and SFEVA fields.

Similarly, if you have locked the odd synchronization table at the end of the static segment of an odd communication cycle, CC does not update the SFODB and SFODA fields.

## Diagram

| Bits   | 15 14   | 13 12 11   | 10 9 6   | 8 7   |
|--------|---------|------------|----------|-------|
| R      | SFEVB   | SFEVA      | SFODB    |       |
| W      |         |            |          |       |

## Fields

| Field   | Function                                                                                                                                                                                 |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-12   | Sync Frames Channel B, Even Cycle                                                                                                                                                        |
| SFEVB   | Provides the size of the internal list of frame IDs of received synchronization frames used for clock synchronization. Protocol related variable: size of (vsSyncIdListB for even cycle) |
| 11-8    | Sync Frames Channel A, Even Cycle                                                                                                                                                        |
| SFEVA   | Provides the size of the internal list of frame IDs of received synchronization frames used for clock synchronization. Protocol related variable: size of (vsSyncIdListA for even cycle) |

Table continues on the next page...

Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                 |
|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7-4       | Sync Frames Channel B, Odd cycle                                                                                                                                                                                         |
| SFODB     | Provides the size of the internal list of frame IDs of received synchronization frames used for clock synchronization. Protocol related variable: size of (vsSyncIdListB for odd cycle)                                  |
| 3-0 SFODA | Sync Frames Channel A, Odd Cycle Provides the size of the internal list of frame IDs of received synchronization frames used for clock synchronization. Protocol related variable: size of (vsSyncIdListA for odd cycle) |

## 56.7.34 Sync Frame Table Offset (SFTOR)

## Offset

| Register   | Offset   |
|------------|----------|
| SFTOR      | 42h      |

## Function

Defines the FlexRay memory area related offset for sync frame tables. For more details, see Sync FID and sync frame deviation tables.

## Diagram

<!-- image -->

## Fields

| Field           | Function                                                                                                                                                                |
|-----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-1 SFT_OFFSET | Sync Frame Table Offset Configures the offset of the sync frame tables in the FlexRay memory area. This offset must be 16-bit aligned. Thus, SFT_OFFSET[0] is always 0. |
| 0 -             | Reserved                                                                                                                                                                |

## 56.7.35 Sync Frame Table Configuration Control Status (SFTCCSR)

## Offset

| Register   | Offset   |
|------------|----------|
| SFTCCSR    | 44h      |

## Function

Provides configuration, control, and status information related to the generation and access of the clock sync ID tables and clock sync measurement tables. For a detailed description, see Sync FID and sync frame deviation tables.

## Diagram

<!-- image -->

## Fields

| Field       | Function                                                                                                                                                                          |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 ELKT     | Even Cycle Tables Lock/Unlock Trigger Locks and unlocks the even cycle tables. 0b - No effect 1b - Trigger lock and unlock                                                        |
| 14 OLKT     | Odd Cycle Tables Lock And Unlock Trigger Locks and unlocks the odd cycle tables. 0b - No effect 1b - Trigger lock and unlock                                                      |
| 13-8 CYCNUM | Cycle Number Provides the number of the cycle in which the currently locked table was recorded. If none or both tables are locked, this value is related to the even cycle table. |
| 7 ELKS      | Even Cycle Tables Lock Status Indicates whether the application has locked the even cycle tables. 0b - Not locked 1b - Locked                                                     |
| 6 OLKS      | Odd Cycle Tables Lock Status Indicates whether the application has locked the odd cycle tables.                                                                                   |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 5 EVAL  | 1b - Locked Even Cycle Tables Valid Indicates whether the sync frame ID and sync frame deviation tables for the even cycle are valid. CCwrites 0 to this field when CCstarts updating the tables, and keeps its value at 0 while the update occurs. CCthen writes 1 to this field when CC has finished the table update and the tables are consistent. 0b - Invalid                                                                                                                                            |
| 4 OVAL  | Odd Cycle Tables Valid Indicates whether the sync frame ID and sync frame deviation tables for the odd cycle are valid. CC writes 0 to this field when CCstarts updating the tables, and keeps its value at 0 while the update occurs. CCthen writes 1 to this field when CC has finished the table update and the tables are consistent. 0b - Invalid 1b - Valid                                                                                                                                              |
| 3 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 2 OPT   | One Pair Trigger Controls how CC writes pairs of sync frame tables into the FlexRay memory area. If OPT = 1 while SDVEN or SIDEN is 1, CC writes only one pair of the enabled sync frame tables corresponding to the next even-odd-cycle pair into the FlexRay memory area. In this case, CCimmediately changes SDVEN or SIDEN to 0. If OPT = 0 while SDVEN or SIDEN is 1, CC continuously writes the enabled sync frame tables into the FlexRay memory area. 0b - Write continuously 1b - Write only one pair |
| 1 SDVEN | Sync Frame Deviation Table Enable Controls the generation of the sync frame deviation tables. You must write 1 to this field to request CC to write the sync frame deviation tables into the FlexRay memory area. If SDVEN = 1, then you must also write 1 to SIDEN. NOTE 0b - Do not write sync frame deviation tables 1b - Write sync frame deviation tables                                                                                                                                                 |
| 0       | Sync Frame ID Table Enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| SIDEN   | Controls the generation of the sync frame ID tables. You must write 1 to this field to request CCto write the sync frame ID tables into the FlexRay memory area. 0b - Do not write sync frame ID tables 1b - Write sync frame ID tables |

## 56.7.36 Sync Frame ID Rejection Filter (SFIDRFR)

## Offset

| Register   | Offset   |
|------------|----------|
| SFIDRFR    | 46h      |

## Function

Defines the sync frame rejection filter ID. You must update this register outside of the static segment. If you update this register in the static segment, it can appear that CC accepts the sync frame in the current cycle.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                          |
|---------|-----------------------------------------------------------------------------------------------------------------------------------|
| 15-10   | Reserved                                                                                                                          |
| 9-0     | Sync Frame Rejection ID                                                                                                           |
| SYNFRID | Defines the frame ID of a frame that must not be used for clock synchronization. For details, see Sync frame rejection filtering. |

## 56.7.37 Sync Frame ID Acceptance Filter Value (SFIDAFVR)

## Offset

| Register   | Offset   |
|------------|----------|
| SFIDAFVR   | 48h      |

## Function

Defines the sync frame acceptance filter value. For details on filtering, see Sync frame filtering.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                   |
|---------|------------------------------------------------------------|
| 15-10   | Reserved                                                   |
| -       |                                                            |
| 9-0     | Filter Value                                               |
| FVAL    | Defines the value for the sync frame acceptance filtering. |

## 56.7.38 Sync Frame ID Acceptance Filter Mask (SFIDAFMR)

## Offset

| Register   | Offset   |
|------------|----------|
| SFIDAFMR   | 4Ah      |

## Function

Defines the sync frame acceptance filter mask. For details on filtering, see Sync frame acceptance filtering.

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 15-10   | Reserved   |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table continued from the previous page...

| Field   | Function                                                  |
|---------|-----------------------------------------------------------|
| 9-0     | Filter Mask                                               |
| FMSK    | Defines the mask for the sync frame acceptance filtering. |

## 56.7.39 NMV n (NMVR0 - NMVR5)

## Offset

| Register   | Offset   |
|------------|----------|
| NMVR0      | 4Ch      |
| NMVR1      | 4Eh      |
| NMVR2      | 50h      |
| NMVR3      | 52h      |
| NMVR4      | 54h      |
| NMVR5      | 56h      |

## Function

Each of these registers holds one NMV part. Network Management Vector Length Register (NMVLR) configures the NMV length. If Network Management Vector Length Register (NMVLR) is programmed with a value that is less than 12 bytes, the remaining bytes of the NMVRn registers, which are not used for the network management vector accumulating, remain 0.

The NMVR provides accrued information over all received NMVs in the last communication cycle. All NMVs received in one cycle are ORed into the NMVR. The NMVR is updated at the end of the communication cycle.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                          |
|---------|-----------------------------------------------------------------------------------------------------------------------------------|
| 15-0    | NMV Part                                                                                                                          |
| NMVP    | Contains part of the NMV. The following table shows the mapping between the NMVR n and the receive MB payload bytes in NMV[0:11]. |

| Field   | Function                                                       | Function                                                       |
|---------|----------------------------------------------------------------|----------------------------------------------------------------|
|         | Table 552. Mapping of NMVRn to the received payload bytes NMVn | Table 552. Mapping of NMVRn to the received payload bytes NMVn |
|         | Register, field, and bit position                              | NMVn received payload                                          |
|         | NMVR0[NMVP[15:8]]                                              | NMV0                                                           |
|         | NMVR0[NMVP[7:0]]                                               | NMV1                                                           |
|         | NMVR1[NMVP[15:8]]                                              | NMV2                                                           |
|         | NMVR1[NMVP[7:0]]                                               | NMV3                                                           |
|         | ...                                                            | ...                                                            |
|         | NMVR5[NMVP[15:8]]                                              | NMV10                                                          |
|         | NMVR5[NMVP[7:0]]                                               | NMV11                                                          |

## 56.7.40 Network Management Vector Length Register (NMVLR)

## Offset

| Register   | Offset   |
|------------|----------|
| NMVLR      | 58h      |

## Function

This register defines the length of the network management vector in bytes.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                               |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-4    | Reserved                                                                                                                                                               |
| 3-0     | Network Management Vector Length                                                                                                                                       |
| NMVL    | Protocol related variable: gNetworkManagementVectorLength. This field defines the length of the Network Management Vector in bytes. Legal values are between 0 and 12. |

## 56.7.41 Timer Configuration And Control (TICCR)

## Offset

| Register   | Offset   |
|------------|----------|
| TICCR      | 5Ah      |

## Function

Configures and controls the two timers T1 and T2. For timer details, see Timer support.

T1 is an absolute timer. T2 can be configured as an absolute or relative timer.

Both timers are deactivated immediately when the protocol enters a state different from POC:normal active or POC:normal passive.

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                                                            |
|-----------|---------------------------------------------------------------------------------------------------------------------|
| 15-14 -   | Reserved                                                                                                            |
| 13 T2_CFG | Timer T2 Configuration Configures the timebase mode (absolute or relative) of timer T2. 0b - Absolute 1b - Relative |
| 12 T2_REP | Timer T2 Repetitive Mode Configures the repetition mode of Timer T2. 0b - Non-repetitive 1b - Repetitive            |
| 11 -      | Reserved                                                                                                            |
| 10 T2SP   | Timer T2 Stop Stops timer T2.                                                                                       |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                 |
|----------|----------------------------------------------------------------------------------------------------------|
| 9 T2TR   | 1b - Stop Timer T2 Trigger Starts timer T2. 0b - No effect                                               |
| 8 T2ST   | Timer T2 State Provides the current state of timer T2. 0b - Idle 1b - Running                            |
| 7-5 -    | Reserved                                                                                                 |
| 4 T1_REP | Timer T1 Repetitive Mode Configures the repetition mode of timer T1. 0b - Non-repetitive 1b - Repetitive |
| 3 -      | Reserved                                                                                                 |
| 2 T1SP   | Timer T1 Stop Stops timer T1. 0b - No effect 1b - Stop                                                   |
| 1 T1TR   | Timer T1 Trigger Starts timer T1. 0b - No effect 1b - Start                                              |
| 0 T1ST   | Timer T1 State Provides the current state of timer T1. 0b - Idle 1b - Running                            |

## 56.7.42 Timer 1 Cycle Set (TI1CYSR)

## Offset

| Register   | Offset   |
|------------|----------|
| TI1CYSR    | 5Ch      |

## Function

Defines the cycle filter value and the cycle filter mask for timer T1. For a detailed description of timer T1, see T1 (absolute).

NOTE

If you modify the value in this register while the timer is running, the change becomes effective immediately and timer T1 expires according to the changed value.

## Diagram

<!-- image -->

## Fields

| Field           | Function                                                                 |
|-----------------|--------------------------------------------------------------------------|
| 15-14 -         | Reserved                                                                 |
| 13-8 T1_CYC_VAL | Timer T1 Cycle Filter Value Defines the cycle filter value for timer T1. |
| 7-6 -           | Reserved                                                                 |
| 5-0 T1_CYC_MSK  | Timer T1 Cycle Filter Mask Defines the cycle filter mask for timer T1.   |

## 56.7.43 Timer 1 MT Offset (TI1MTOR)

## Offset

| Register   | Offset   |
|------------|----------|
| TI1MTOR    | 5Eh      |

## Function

Holds the MT offset value for timer T1. For a detailed description of timer T1, see T1 (absolute).

## NOTE

If you modify the value in this register while the timer is running, the change becomes effective immediately and timer T1 expires according to the changed value.

<!-- image -->

## Fields

| Field   | Function          |
|---------|-------------------|
| 15-14   | Reserved          |
| 13-0    | Timer 1 MT Offset |

## 56.7.44 Timer 2 Configuration 0 (Absolute Timer Configuration) (TI2CR0\_ABS)

## Offset

| Register   | Offset   |
|------------|----------|
| TI2CR0_ABS | 60h      |

## Function

The content of this register depends on the value of TICCR[T2\_CFG]. For a detailed description of timer T2, see T2 as an absolute timer.

## NOTE

If you configure timer T2 as an absolute timer and modify the values in this register while the timer is running, the change becomes effective immediately and timer T2 expires according to the changed values.

FlexRay Communication Controller (FlexRay)

## Diagram

<!-- image -->

## Fields

| Field         | Function                                                                                  |
|---------------|-------------------------------------------------------------------------------------------|
| 15-14 -       | Reserved Do not change the value of these bits. Always use a read-modify-write operation. |
| 13-8 T2CYCVAL | Timer T2 Cycle Filter Mask                                                                |
| 7-6 -         | Reserved Do not change the value of these bits. Always use a read-modify-write operation. |
| 5-0 T2CYCMSK  | Timer T2 Cycle Filter Mask                                                                |

## 56.7.45 Timer 2 Configuration 0 (Relative Timer Configuration) (TI2CR0\_REL)

## Offset

| Register   | Offset   |
|------------|----------|
| TI2CR0_REL | 60h      |

## Function

The content of this register depends on the value of TICCR[T2\_CFG]. For a detailed description of timer T2, see T2 as a relative timer.

## NOTE

If you configure timer T2 as a relative timer and change the values in this register while the timer is running, the change becomes effective when the timer expires according to the old values.

FlexRay Communication Controller (FlexRay)

## Diagram

<!-- image -->

## Fields

| Field   | Function              |
|---------|-----------------------|
| 15-0    | Timer T2 MT High Word |
| T2MTCNT |                       |

## 56.7.46 Timer 2 Configuration 1 (Absolute Timer Configuration) (TI2CR1\_ABS)

## Offset

| Register   | Offset   |
|------------|----------|
| TI2CR1_ABS | 62h      |

## Function

The content of this register depends on the value of TICCR[T2\_CFG]. For a detailed description of timer T2, see T2 as an absolute timer.

NOTE

If you configure timer T2 as an absolute timer and modify the values in this register while the timer is running, the change becomes effective immediately and timer T2 expires according to the changed values.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                         |
|---------|----------------------------------------------------------------------------------|
| 15-14   | Reserved                                                                         |
| -       | Do not change the value of these bits. Always use a read-modify-write operation. |
| 13-0    | Timer T2 MT Offset                                                               |
| T2MOFF  |                                                                                  |

FlexRay Communication Controller (FlexRay)

FlexRay Communication Controller (FlexRay)

## 56.7.47 Timer 2 Configuration 1 (Relative Timer Configuration) (TI2CR1\_REL)

## Offset

| Register   | Offset   |
|------------|----------|
| TI2CR1_REL | 62h      |

## Function

The content of this register depends on the value of TICCR[T2\_CFG]. For a detailed description of timer T2, see T2 as a relative timer.

NOTE

<!-- image -->

## Fields

| Field   | Function                    |
|---------|-----------------------------|
| 15-0    | Timer T2 Macrotick Low Word |
| T2MTCNT |                             |

## 56.7.48 Slot Status Selection (SSSR)

## Offset

| Register   | Offset   |
|------------|----------|
| SSSR       | 64h      |

## Function

Used to access the four internal non-memory mapped slot status selection (SSSR0-SSSR3) registers. Each internal register selects a slot, symbol window, or NIT, whose status vector is saved in the corresponding slot status (SSR0-SSR7) registers according to Slot Status Selection (SSSR). For a detailed description of slot status monitoring, see Slot status monitoring.

Table 553. Mapping between SSSRn and SSRn

| Internal slot status selection register   | Write the slot status of the slot selected by SSSRn for each   | Write the slot status of the slot selected by SSSRn for each   | Write the slot status of the slot selected by SSSRn for each   | Write the slot status of the slot selected by SSSRn for each   |
|-------------------------------------------|----------------------------------------------------------------|----------------------------------------------------------------|----------------------------------------------------------------|----------------------------------------------------------------|
| Internal slot status selection register   | Even communication cycle                                       | Even communication cycle                                       | Odd communication cycle                                        | Odd communication cycle                                        |
| Internal slot status selection register   | For channel B to                                               | For channel A to                                               | For channel B to                                               | For channel A to                                               |
| SSSR0                                     | SSR0[15:8]                                                     | SSR0[7:0]                                                      | SSR1[15:8]                                                     | SSR1[7:0]                                                      |
| SSSR1                                     | SSR2[15:8]                                                     | SSR2[7:0]                                                      | SSR3[15:8]                                                     | SSR3[7:0]                                                      |
| SSSR2                                     | SSR4[15:8]                                                     | SSR4[7:0]                                                      | SSR5[15:8]                                                     | SSR5[7:0]                                                      |
| SSSR3                                     | SSR6[15:8]                                                     | SSR6[7:0]                                                      | SSR7[15:8]                                                     | SSR7[7:0]                                                      |

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                                                                                      |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------|
| 15 WMD    | Write Mode Defines whether a write access to this register modifies all fields or only the SEL field. 0b - All fields 1b - Only the SEL field |
| 14 -      | Reserved                                                                                                                                      |
| 13-12 SEL | Selector Selects one of the four internal slot status selection registers for access. 00b - SSSR0 01b - SSSR1 10b - SSSR2 11b - SSSR3         |
| 11 -      | Reserved                                                                                                                                      |

Table continues on the next page...

Table continued from the previous page...

| Field      | Function                                                                                                                                                                                                                                                                     |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 10-0       | Slot Number                                                                                                                                                                                                                                                                  |
| SLOTNUMBER | Specifies the number of the slot whose status is saved in the corresponding slot status registers. If SLOTNUMBER = 0, the related slot status register provides the status of the symbol window after the NIT start, and provides the NIT status after the cycle start. NOTE |

## 56.7.49 Slot Status Counter Condition (SSCCR)

## Offset

| Register   | Offset   |
|------------|----------|
| SSCCR      | 66h      |

## Function

Allows you to access and program the four internal non-memory mapped Slot Status Counter Condition (SSCCR0-SSCCR3) registers. Each of these registers define the mode and the conditions for incrementing the counter in the corresponding Slot Status Counter (SSCR0-SSCR3) registers. Table 554 shows the mapping. For a detailed description of slot status counters, see Slot status counter registers.

Table 554. Mapping between internal SSCCRn and SSCRn

| Condition register   | Condition defined for register   |
|----------------------|----------------------------------|
| SSCCR0               | SSCR0                            |
| SSCCR1               | SSCR1                            |
| SSCCR2               | SSCR2                            |
| SSCCR3               | SSCR3                            |

## Diagram

<!-- image -->

| Bits    | 15    |   14 | 13   |   12 | 11   | 10 9   | 8   | 7   | 6   | 5   | 4   | 3   | 2          | 1   | 0   |
|---------|-------|------|------|------|------|--------|-----|-----|-----|-----|-----|-----|------------|-----|-----|
| R       | 0     |    0 | SEL  |    0 |      | CNTCFG | MCY | VFR | SYF | NUF | SUF |     | STATUSMASK |     |     |
| W Reset | WMD 0 |    0 | 0 0  |    0 |      | 0 0    | 0   | 0   | 0   | 0   | 0   | 0   | 0          | 0   | 0   |

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                     |
|-------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 WMD      | Write Mode Defines whether a write access to this register modifies all fields or only the SEL field. 0b - All fields 1b - Only the SEL field                                                                                                                                                                                                                                                                                |
| 14 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 13-12 SEL   | Selector Selects one of the four internal slot counter condition registers for access. 00b - SSCCR0 01b - SSCCR1 10b - SSCCR2 11b - SSCCR3                                                                                                                                                                                                                                                                                   |
| 11 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 10-9 CNTCFG | Counter Configuration Controls the channel-related incrementing of the slot status counter. 00b - Increment by 1 if condition is fulfilled on channel A. 01b - Increment by 1 if condition is fulfilled on channel B. 10b - Increment by 1 if condition is fulfilled on at least one channel. 11b - Increment by 2 if condition is fulfilled on both channels; increment by 1 if condition is fulfilled on only one channel. |
| 8 MCY       | Multi Cycle Selection Defines whether the slot status counter accumulates over multiple communication cycles or provides information only for the previous communication cycle. 0b - Only for the previous communication cycle 1b - Over multiple communication cycles                                                                                                                                                       |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

## Table continued from the previous page...

| Field          | Function                                                                                                                                                   | Function                                                                                                                                                   |
|----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7 VFR          | Valid Frame Restriction This bit is used to restrict the counter only to valid received frames. 0b - Not restricted 1b - Restricted                        | Valid Frame Restriction This bit is used to restrict the counter only to valid received frames. 0b - Not restricted 1b - Restricted                        |
| 6 SYF          | Sync Frame Restriction Restricts the counter to received frames that have the sync frame indicator bit set to 1. 0b - Not restricted 1b - Restricted       | Sync Frame Restriction Restricts the counter to received frames that have the sync frame indicator bit set to 1. 0b - Not restricted 1b - Restricted       |
| 5 NUF          | Null Frame Restriction Restrict the counter to received frames that have the null frame indicator bit set to 0. 0b - Not restricted 1b - Restricted        | Null Frame Restriction Restrict the counter to received frames that have the null frame indicator bit set to 0. 0b - Not restricted 1b - Restricted        |
| 4 SUF          | Startup Frame Restriction Restricts the counter to received frames that have the startup frame indicator bit set to 1. 0b - Not restricted 1b - Restricted | Startup Frame Restriction Restricts the counter to received frames that have the startup frame indicator bit set to 1. 0b - Not restricted 1b - Restricted |
| 3-0 STATUSMASK | Slot Status Mask Enable the counter with respect to the four slot status error indicator bits.                                                             | Slot Status Mask Enable the counter with respect to the four slot status error indicator bits.                                                             |
| 3-0 STATUSMASK | Bit position in STATUSMASK                                                                                                                                 | Function                                                                                                                                                   |
| 3-0 STATUSMASK | 0                                                                                                                                                          | Enables the counting for slots with the transmission conflict indicator bit set to 1.                                                                      |
| 3-0 STATUSMASK | 1                                                                                                                                                          | Enables the counting for slots with the boundary violation indicator bit set to 1.                                                                         |
| 3-0 STATUSMASK | 2                                                                                                                                                          | Enables the counting for slots with the content error indicator bit set to 1.                                                                              |
| 3-0 STATUSMASK | 3                                                                                                                                                          | Enables the counting for slots with the syntax error indicator bit set to 1.                                                                               |

## 56.7.50 Slot Status (SSR0 - SSR7)

## Offset

For n = 0 to 7:

| Register   | Offset         |
|------------|----------------|
| SSRn       | 68h + (n × 2h) |

## Function

Holds the status vector of the slot specified in the corresponding internal slot status selection register, which can be programmed using Slot Status Selection (SSSR). Each register is updated after the end of the corresponding slot as shown in Slot status monitoring. The register fields directly relate to the protocol variables and described in more detail in Slot status monitoring.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                         |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 VFB  | Valid Frame On Channel B Protocol-related variable: vSS!ValidFrame channel B 0b - vSS!ValidFrame = 0 1b - vSS!ValidFrame = 1                                     |
| 14 SYB  | Sync Frame Indicator Channel B Protocol-related variable: vRF!Header!SyFIndicator channel B 0b - vRF!Header!SyFIndicator = 0 1b - vRF!Header!SyFIndicator = 1    |
| 13 NFB  | Null Frame Indicator Channel B Protocol-related variable: vRF!Header!NFIndicator channel B 0b - vRF!Header!NFIndicator = 0 1b - vRF!Header!NFIndicator = 1       |
| 12 SUB  | Startup Frame Indicator Channel B Protocol-related variable: vRF!Header!SuFIndicator channel B 0b - vRF!Header!SuFIndicator = 0 1b - vRF!Header!SuFIndicator = 1 |
| 11 SEB  | Syntax Error On Channel B Protocol-related variable: vSS!SyntaxError channel B 0b - vSS!SyntaxError = 0 1b - vSS!SyntaxError = 1                                 |
| 10 CEB  | Content Error On Channel B Protocol-related variable: vSS!ContentError channel B                                                                                 |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                         |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 9 BVB   | 1b - vSS!ContentError = 1 Boundary Violation On Channel B Protocol-related variable: vSS!BViolation channel B 0b - vSS!BViolation = 0                            |
| 8 TCB   | Transmission Conflict On Channel B Protocol-related variable: vSS!TxConflict channel B 0b - vSS!TxConflict = 0 1b - vSS!TxConflict = 1                           |
| 7 VFA   | Valid Frame On Channel A Protocol-related variable: vSS!ValidFrame channel A 0b - vSS!ValidFrame = 0 1b - vSS!ValidFrame = 1                                     |
| 6 SYA   | Sync Frame Indicator Channel A Protocol-related variable: vRF!Header!SyFIndicator channel A 0b - vRF!Header!SyFIndicator = 0 1b - vRF!Header!SyFIndicator = 1    |
| 5 NFA   | Null Frame Indicator Channel A Protocol-related variable: vRF!Header!NFIndicator channel A 0b - vRF!Header!NFIndicator = 0 1b - vRF!Header!NFIndicator = 1       |
| 4 SUA   | Startup Frame Indicator Channel A Protocol-related variable: vRF!Header!SuFIndicator channel A 0b - vRF!Header!SuFIndicator = 0 1b - vRF!Header!SuFIndicator = 1 |
| 3 SEA   | Syntax Error On Channel A Protocol-related variable: vSS!SyntaxError channel A 0b - vSS!SyntaxError = 0 1b - vSS!SyntaxError = 1                                 |
| 2       | Content Error On Channel A                                                                                                                                       |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                               |
|---------|----------------------------------------------------------------------------------------------------------------------------------------|
| CEA     | Protocol-related variable: vSS!ContentError channel A 0b - vSS!ContentError = 0 1b - vSS!ContentError = 1                              |
| 1 BVA   | Boundary Violation On Channel A Protocol-related variable: vSS!BViolation channel A 0b - vSS!BViolation = 0 1b - vSS!BViolation = 1    |
| 0 TCA   | Transmission Conflict On Channel A Protocol-related variable: vSS!TxConflict channel A 0b - vSS!TxConflict = 0 1b - vSS!TxConflict = 1 |

## 56.7.51 Slot Status Counter (SSCR0 - SSCR3)

## Offset

| Register   | Offset   |
|------------|----------|
| SSCR0      | 78h      |
| SSCR1      | 7Ah      |
| SSCR2      | 7Ch      |
| SSCR3      | 7Eh      |

## Function

Provides the slot status counter value for the previous communication cycle(s) and is updated at the cycle start. The provided value depends on the control fields in the related internal slot status counter condition registers SSCCRn, which you can program by using Slot Status Counter Condition (SSCCR). For more details, see Slot status counter registers.

## NOTE

If the counter has reached its maximum value FFFFh and is in Multicycle mode-that is, SSCCRn[MCY] = 1-the counter is not reset to 0h.You can reset the counter by writing 0 to SSCCRn[MCY] and waiting for the next cycle start, when CC clears the counter. Subsequently, the counter can be set into Multicycle mode again.

## Diagram

<!-- image -->

## Fields

| Field          | Function                                               |
|----------------|--------------------------------------------------------|
| 15-0           | Slot Status Counter                                    |
| SLOTSTATUS CNT | Provides the current value of the slot status counter. |

## 56.7.52 MTS A Configuration (MTSACFR)

## Offset

| Register   | Offset   |
|------------|----------|
| MTSACFR    | 80h      |

## Function

Controls the MTS transmission on channel A. For more details, see MTS generation.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                          |
|---------|---------------------------------------------------------------------------------------------------|
| 15      | MTS Transmission Enable                                                                           |
| MTE     | Enables and disables the MTS transmission in the selected set of cycles. 0b - Disable 1b - Enable |
| 14 -    | Reserved                                                                                          |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table continued from the previous page...

| Field     | Function                                                  |
|-----------|-----------------------------------------------------------|
| 13-8      | Cycle Counter Mask                                        |
| CYCCNTMSK | Provides the filter mask for the MTS cycle count filter.  |
| 7-6       | Reserved                                                  |
| -         |                                                           |
| 5-0       | Cycle Counter Value                                       |
| CYCCNTVAL | Provides the filter value for the MTS cycle count filter. |

## 56.7.53 MTS B Configuration (MTSBCFR)

## Offset

| Register   | Offset   |
|------------|----------|
| MTSBCFR    | 82h      |

## Function

Controls the MTS transmission on channel B. For more details, see MTS generation.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                             |
|---------|--------------------------------------------------------------------------------------|
| 15      | MTS Transmission Enable                                                              |
| MTE     | Enables and disable the MTS transmission in the selected set of cycles. 0b - Disable |
| 14      | Reserved                                                                             |
| - 13-8  | Cycle Counter Mask                                                                   |

Table continues on the next page...

Table continued from the previous page...

| Field     | Function                                                  |
|-----------|-----------------------------------------------------------|
| CYCCNTMSK | Provides the filter mask for the MTS cycle count filter.  |
| 7-6       | Reserved                                                  |
| -         |                                                           |
| 5-0       | Cycle Counter Value                                       |
| CYCCNTVAL | Provides the filter value for the MTS cycle count filter. |

## 56.7.54 Receive Shadow Buffer Index (RSBIR)

## Offset

| Register   | Offset   |
|------------|----------|
| RSBIR      | 84h      |

## Function

Provides and retrieves the indices of the MB header fields currently associated with the receive shadow buffers. For more details on the receive shadow buffer concept, see Receive shadow buffer concept.

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                                                                                   |
|-----------|--------------------------------------------------------------------------------------------------------------------------------------------|
| 15        | Write Mode                                                                                                                                 |
| WMD       | Controls the write mode for this register. 0b - Update SEL and RSBIDX field on register write 1b - Update only SEL field on register write |
| 14 -      | Reserved                                                                                                                                   |
| 13-12 SEL | Selector Selects the internal receive shadow buffer index register for access.                                                             |

Table continues on the next page...

## Table continued from the previous page...

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|            | 00b - RSBIR_A1-receive shadow buffer index register for channel A, segment 1 01b - RSBIR_A2-receive shadow buffer index register for channel A, segment 2 10b - RSBIR_B1-receive shadow buffer index register for channel B, segment 1 11b - RSBIR_B2-receive shadow buffer index register for channel B, segment 2                                                                                                                                                                                                                                                                                                       |
| 11-9 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 8-0 RSBIDX | RSBIDXA1/RSBIDXA2/RSBIDXB1/RSBIDXB2- Receive Shadow Buffer Index Contains the current index of the MB header field of the receive shadow MB selected by the SEL field. CC uses this index to determine the physical location of the shadow buffer header field in the FlexRay memory area. CC updates this field during receive operation. The application provides an initial MB header index value in the configuration phase. CC-Updates the MB header index after successful reception. Application-Provides initial MB header index. Legal values are 0 ≤ i ≤ 259. Illegal values are detected during the MB search. |

## 56.7.55 Receive FIFO Watermark And Selection (RFWMSR)

## Offset

| Register   | Offset   |
|------------|----------|
| RFWMSR     | 86h      |

## Function

## Used to:

- Select a receiver FIFO for subsequent programming access through the receiver FIFO configuration registers summarized in Receive FIFO Watermark And Selection (RFWMSR).
- Define the watermark for the selected FIFO.

## Table 555. SEL controlled receiver FIFO registers

| Register                                                             |
|----------------------------------------------------------------------|
| Receive FIFO Start Index Register (RFSIR)                            |
| Receive FIFO Depth and Size Register (RFDSR)                         |
| Receive FIFO Message ID Acceptance Filter Value Register (RFMIDAFVR) |
| Receive FIFO Message ID Acceptance Filter Mask Register (RFMIDAFMR)  |

Table continues on the next page...

## Table 555. SEL controlled receiver FIFO registers (continued)

| Register                                                          |
|-------------------------------------------------------------------|
| Receive FIFO Frame ID Rejection Filter Value Register (RFFIDRFVR) |
| Receive FIFO Frame ID Rejection Filter Mask Register (RFFIDRFMR)  |
| Receive FIFO Range Filter Configuration Register (RFRFCFR)        |
| Receive FIFO Range Filter Control Register (RFRFCTR)              |

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                |
|---------|-------------------------------------------------------------------------------------------------------------------------|
| 15-8 WM | WMA/WMB - Watermark Defines the watermark value for the selected FIFO. This value controls the generation of the almost |
| 7-1     | full interrupt flags.                                                                                                   |
| -       | Reserved                                                                                                                |
| 0 SEL   | Select Selects the receiver FIFO for subsequent programming. 0b - Channel A 1b - Channel B                              |

## 56.7.56 Receive FIFO Start Index (RFSIR)

## Offset

| Register   | Offset   |
|------------|----------|
| RFSIR      | 88h      |

## Function

Defines the MB header index of the first MB of the selected FIFO.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                         |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-10   | Reserved                                                                                                                                                                                         |
| 9-0     | SIDXA Or SIDXB Start Index                                                                                                                                                                       |
| SIDX    | Defines the number of the MB header field of the first MB of the selected FIFO. CC uses the value of this field to determine the physical location of the receiver FIFO's first MB header field. |

## 56.7.57 Receive FIFO Depth And Size (RFDSR)

## Offset

| Register   | Offset   |
|------------|----------|
| RFDSR      | 8Ah      |

## Function

Defines the structure-the number of entries and the size of each entry-of the selected FIFO. .

## Diagram

<!-- image -->

## Fields

| Field      | Function                                                               |
|------------|------------------------------------------------------------------------|
| 15-8       | FIFO_DEPTHA And FIFO_DEPTHB FIFO Depth                                 |
| FIFO_DEPTH | Defines the depth of the selected FIFO-that is, the number of entries. |

Table continues on the next page...

FlexRay Communication Controller (FlexRay)

Table continued from the previous page...

| Field      | Function                                                                                                                    |
|------------|-----------------------------------------------------------------------------------------------------------------------------|
|            | If you write 0 toFIFO_DEPTH,youmustalsowrite0toRFFIDRFMR[FIDRFMSK],toensure that no frames are received into the FIFO. NOTE |
| 7          | Reserved                                                                                                                    |
| -          |                                                                                                                             |
| 6-0        | ENTRY_SIZEA Or ENTRY_SIZEB Entry Size                                                                                       |
| ENTRY_SIZE | Defines the size of the frame data sections for the selected FIFO in 2-byte entities.                                       |

## 56.7.58 Receive FIFO A Read Index (RFARIR)

## Offset

| Register   | Offset   |
|------------|----------|
| RFARIR     | 8Ch      |

## Function

Provides the MB header index of the next available FIFO A entry that the application can read.

NOTE

If the FIFO is empty, the RDIDX field points to a physical MB with invalid content.

<!-- image -->

## Fields

| Field   | Function                                                                                  |
|---------|-------------------------------------------------------------------------------------------|
| 15-10   | Reserved                                                                                  |
| -       |                                                                                           |
| 9-0     | Read Index                                                                                |
| RDIDX   | Provides the MB header index of the next available FIFO MB that the application can read. |

FlexRay Communication Controller (FlexRay)