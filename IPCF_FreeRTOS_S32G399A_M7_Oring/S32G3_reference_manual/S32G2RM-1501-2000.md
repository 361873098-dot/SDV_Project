## Table continued from the previous page...

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|              | The SoC core may initiate a MR write operation in PDA or PBA mode only if pda_done = 0. Therefore, we recommended you write 0 to MRCTRL0[pda_en] after pda_done goes high to prepare for the next PDA operation. Programming Mode: Dynamic 0b - In progress or not yet started 1b - Completed                                                                                                                                                   |
| 7-1 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 0 mr_wr_busy | MR busy Indicates that a Mode Register (MR) operation is in progress. This signal goes high in the clock after the MC accepts the MR write or read request. It goes low when the MR write or read command is issued to the DRAM. The SoC core may initiate a MR write operation only if mr_wr_busy = 0. We recommended that you do not perform MR write or read commands when mr_wr_busy = 1. Programming Mode: Dynamic 0b - Not busy 1b - Busy |

## 36.15.7 Mode Register Read/Write Control 2 (MRCTRL2)

## Offset

| Register   | Offset   |
|------------|----------|
| MRCTRL2    | 1Ch      |

## Function

Selects the devices for Mode Register Set operation in PDA mode.

## Diagram

<!-- image -->

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24            | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|---------|------|------|------|------|------|------|------|---------------|------|------|------|------|------|------|------|------|
| R W     |      |      |      |      |      |      |      | mr_device_sel |      |      |      |      |      |      |      |      |
| Reset   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0             | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8             | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R       |      |      |      |      |      |      |      | mr_device_sel |      |      |      |      |      |      |      |      |
| W Reset | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0             | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field              | Function                                                                                                                                                                                                                                                                                                                                                                                                |
|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0 mr_device_sel | MRS device select Selects to which devices to apply a Mode Register Set (MRS) command in PDA mode. Each bit represents one device. For example, bit 0 corresponds to device 0, bit 1 corresponds to device 1, and so on. Programming Mode: Dynamic Here are the permitted values for each bit: 0000_0000_0000_0000_0000_0000_0000_0000b - Do not apply 0000_0000_0000_0000_0000_0000_0000_0001b - Apply |

## 36.15.8 Temperature derate enable (DERATEEN)

## Offset

| Register   | Offset   |
|------------|----------|
| DERATEEN   | 20h      |

## Function

Controls temperateure derating operation.

## Diagram

<!-- image -->

## Fields

| Field   | Function         |
|---------|------------------|
| 31-11   | Reserved         |
| 10-8    | tRC derate value |

Table continues on the next page...

## Table continued from the previous page...

| Field            | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                  | Specifies the derate value of tRC for LPDDR4DRAM.Determine the required cycles for derating by dividing 3.75 ns by the core_ddrc_core_clk period and rounding up to the next integer. Set this field to that value minus 1. This field is present only in systems that support LPDDR4 DRAM. NOTE Programming Mode: Quasi-dynamic Group 2, Group 4 000b - Derating uses +1 001b - Derating uses +2 010b - Derating uses +3 011b - Derating uses +4                          |
| 7-4 derate_byte  | Derate byte Selects which byte of the MR read data to use for derating. This field is present only in systems that support LPDDR2, LPDDR3, or LPDDR4 DRAM. NOTE Programming Mode: Static                                                                                                                                                                                                                                                                                   |
| 3 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 2-1 derate_value | Derate value Selects the derating value. This field is present only in systems that support LPDDR2, LPDDR3, or LPDDR4 DRAM. • For all LPDDR2speed grades: Set to 0 because the derating value of +1.875 ns is less than the core_ddrc_core_clk period. • For LPDDR3 and LPDDR4: If the core_ddrc_core_clk period is less than 1.875 ns, set to 1; otherwise, set to 0. NOTE Programming Mode: Quasi-dynamic Group 2, Group 4 00b - Derating uses +1 01b - Derating uses +2 |
| 0 derate_enable  | Derate enable Enables timing parameter derating using the value in MR4. This field is present only in systems that support LPDDR2, LPDDR3, or LPDDR4 DRAM. It must be 0 for any other DRAM types. NOTE                                                                                                                                                                                                                                                                     |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                           |
|---------|----------------------------------------------------|
|         | Programming Mode: Dynamic 0b - Disable 1b - Enable |

## 36.15.9 Temperature derate interval (DERATEINT)

## Offset

| Register   | Offset   |
|------------|----------|
| DERATEINT  | 24h      |

## Function

Specifies the internal between two MR4 read operations in DFI clock cycles. This interval derates the timing parameters.

## Diagram

<!-- image -->

## Fields

| Field                   | Function                                                                                                                                                                                                                                |
|-------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0 mr4_read_interv al | MR4 read interval The interval between two MR4 read operations in DFI clock cycles. • Do not set this field to zero. • This field is present only in systems that support LPDDR2, LPDDR3, or LPDDR4 DRAM. NOTE Programming Mode: Static |

## 36.15.10 Temperature derate control (DERATECTL)

## Offset

| Register   | Offset   |
|------------|----------|
| DERATECTL  | 2Ch      |

## Function

Specifies temperature derate behavior.

## Diagram

<!-- image -->

## Fields

| Field                           | Function                                                                                                                                                                                                                                                      |
|---------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-3 -                          | Reserved                                                                                                                                                                                                                                                      |
| 2 derate_temp_li mit_intr_force | Temperature derate limit interrupt clear Forces assertion of the temperature derate limit interrupt. To force interrupt assertion, write 1 to this field. At the end of the force operation, the MC automatically clears the field. Programming Mode: Dynamic |
| 1 derate_temp_li mit_intr_clr   | Temperature derate limit interrupt clear Clears the temperature derate limit interrupt. To clear the interrupt, write 1 to this field. At the end of the clear operation, the MC automatically clears the field. Programming Mode: Dynamic                    |
| 0 derate_temp_li mit_intr_en    | Temperature derate limit interrupt enable Enables the temperature derate limit interrupt. Programming Mode: Dynamic 0b - Disable 1b - Enable                                                                                                                  |

## 36.15.11 Low power control (PWRCTL)

## Offset

| Register   | Offset   |
|------------|----------|
| PWRCTL     | 30h      |

## Diagram

<!-- image -->

## Fields

| Field                    | Function                                                                                                                                                                                                                                                                                                                        |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-9 -                   | Reserved                                                                                                                                                                                                                                                                                                                        |
| 8 lpddr4_sr_allow ed     | LPDDR4 SRPD-SR transition Specifies if the transition from Self Refresh Power Down state to Self Refresh state and back is allowed. You cannot modify this field while selfref_sw == 1. NOTE Programming Mode: Dynamic 0b - Prohibit transition 1b - Allow transition                                                           |
| 7 dis_cam_drain_ selfref | Skip CAM draining Specifies whether the MC can put DRAM into the Self Refresh state without draining the content- addressable memory (CAM). • You cannot modify this field while selfref_sw == 1. • This release does not support dis_cam_drain_selfref = 1. dis_cam_drain_selfref must equal 0. NOTE Programming Mode: Dynamic |

Table continues on the next page...

## Table continued from the previous page...

| Field                      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 6 stay_in_selfref          | 1b - CAMs do not have to be drained (unsupported) Stay in self refresh Controls whether the MCcantransition DRAMout of the Self Refresh state. Self Refresh is an intermediate state when entering or exiting Self Refresh Power Down for LPDDR4 DRAM. Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 5 selfref_sw               | Software self refresh Triggers immediate entry into or exit from the Self Refresh state as long as the MC is not in any of these conditions: • initializing • in the Deep Power Down state • in maximum power saving mode Programming Mode: Dynamic 0b - Exit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 4 mpsm_en                  | Maximum power saving mode enable Enables the MC to put DRAM into maximum power saving mode (MPSM) when the transaction story is empty. To bring the MC out of MPSM, write 0 to this field. Applies only to systems that support DDR4 DRAM. For all other DRAM types, do not set this field to 1. Affects performance only. If the PHY DWC_AC_CS_USE parameter is disabled, the MCdoes not support MPSMbecause theMPSM exit sequence requires the chip-select signal to toggle. If the value of INIT0[skip_dram_init] is 2'b11, you must write 2'b01 to INIT0[skip_dram_init] by entering the self-refresh mode through PWRCTL[selfref_sw], the value of which is 1'b1. This needs to be done before writing 1 to PWRCTL[mpsm_en]. NOTE Programming Mode: Dynamic 0b - Disable 1b - Enable |
| 3 en_dfi_dram_clk _disable | Enable DFI DRAM clock disable Enables the MC to assert DFI DRAM Clock Disable (dfi_dram_clk_disable) if a clock is not required by the DRAM.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

Table continues on the next page...

## Table continued from the previous page...

| Field               | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                     | The MC can assert DFI DRAM Clock Disable under the following restrictions: • DDR2 or DDR3: can only be asserted in the Self Refresh state • DDR4: can be asserted in the following states: - Self Refresh - Maximum Power Saving • mDDR, LPDDR2, LPDDR3: can be asserted in the following states: - Self Refresh - Power Down - Deep Power Down - Normal operation (clock stop) • LPDDR4: can be asserted in the following states: - Self Refresh Power Down - Power Down - Deep Power Down - Normal operation (clock stop) Programming Mode: Dynamic 0b - Disable 1b - Enable |
| 2 deeppowerdow n_en | Deep power down enable Enables the MCtoput DRAMinto the Deep Power Downstate when the transaction store is empty. the MCout of Deep Power Down, write 0 to this field. The MCperforms automatic DRAMinitialization                                                                                                                                                                                                                                                                                                                                                             |
| 1                   | Power down enable Enables the MC to put DRAM into the Power Down state after a programmable number of cycles (PWRTMG[powerdown_to_x32]). Programming Mode: Dynamic 0b - Disable                                                                                                                                                                                                                                                                                                                                                                                                |
| powerdown_en        | 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

Table continues on the next page...

Table continued from the previous page...

| Field      | Function                                                                                                                                                                  |
|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| selfref_en | Enables the MC to put DRAM into the Self Refresh state after a programmable number of cycles (PWRTMG[selfref_to_x32]). Programming Mode: Dynamic 0b - Disable 1b - Enable |

## 36.15.12 Low Power Timing (PWRTMG)

## Offset

| Register   | Offset   |
|------------|----------|
| PWRTMG     | 34h      |

## Diagram

<!-- image -->

## Fields

<!-- image -->

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                      |
|----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                      |
| 23-16 selfref_to_x32 | Self-refresh idle period Specifies the interval, in multiples of 32 DFI clock cycles, of the MCcommandchannel being idle before the MCautomatically puts the DRAMinto the Self Refresh state. The MCcommand channel is considered idle when there are no outstanding HIF commands. This function must be enabled (PWRCTL[selfref_en]). Affects performance only. NOTE Programming Mode: Quasi-dynamic Group 4 |

Table continues on the next page...

## Table continued from the previous page...

| Field                 | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-8 t_dpd_x4096      | Minimum deep power down period Specifies the minimum amount of time, in multiples of 4096 DFI clock cycles, that DRAM stays in the Deep Power Down state after deassertion of PWRCTL[deeppowerdown_en]. • According to the JEDEC mDDR specification, mDDR exits from Deep Power Down state immediately after deassertion of PWRCTL[deeppowerdown_en]. • According to the JEDEC LPDDR2 and LPDDR3 specifications, the minimum time should be 500 μs. • Applies only to systems that support mDDR, LPDDR2, or LPDDR3 DRAM. • Affects performance only. NOTE Programming Mode: Quasi-dynamic Group 4 |
| 7-5 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 4-0 powerdown_to_ x32 | Power down idle period Specifies the interval, in multiples of 32 DFI clock cycles, of the MCcommandchannel being idle before the MCautomatically puts the DRAMinto the Power Down state. The MCcommand channel is considered idle when there are no outstanding HIF commands. This function must be enabled (PWRCTL[powerdown_en]). Affects performance only. NOTE Programming Mode: Quasi-dynamic Group 4                                                                                                                                                                                       |

## 36.15.13 Hardware low power control (HWLPCTL)

## Offset

| Register   | Offset   |
|------------|----------|
| HWLPCTL    | 38h      |

## Function

## Diagram

<!-- image -->

## Fields

| Field                 | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 27-16 hw_lp_idle_x32  | Hardware low power idle period Specifies the period, in multiples of 32 DFI clock cycles, of the MCcommand channel being idle before the MCautomatically puts the DRAMinto Hardware Low Power (cactive_ddrc = 0). The MCcommand channel is considered idle when there are no outstanding HIF commands. Do not write to this field while DRAMis intializing or is in the Deep Power Down or Maximum Power Saving Mode states. Affects performance only. NOTE Programming Mode: Static 0000_0000_0000b - Disable Hardware Low Power 0000_0000_0001b - Illegal value |
| 15-2 -                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 1 hw_lp_exit_idle_ en | Hardware low power exit enable Enables the MCto force exit, via cactive_in_ddrc, from the automatic clock stop, automatic Power Down or automatic Self Refresh states. Does not cause exit of Self Refresh caused by the Hardware Low Power Interface or software (PWRCTL[selfref_sw]). NOTE Programming Mode: Static                                                                                                                                                                                                                                             |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field    | Function                                                                                                   |
|----------|------------------------------------------------------------------------------------------------------------|
| 0        | Hardware low power interface enable                                                                        |
| hw_lp_en | Enables the Hardware Low Power Interface. Programming Mode: Quasi-dynamic Group 3 0b - Disable 1b - Enable |

## 36.15.14 Refresh Control 0 (RFSHCTL0)

## Offset

| Register   | Offset   |
|------------|----------|
| RFSHCTL0   | 50h      |

## Diagram

<!-- image -->

## Fields

| Field                | Function                                                                                                                                                                                                                                           |
|----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 -              | Reserved                                                                                                                                                                                                                                           |
| 23-20 refresh_margin | Refresh margin Specifies the time period, in multiples of 32 DFI clock cycles, before the critical refresh or page timer expires. You must issue a critical refresh before the end of this time. The recommended value is the default value of 2h. |

Table continues on the next page...

Table continued from the previous page...

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                          | • This value must always be less than the internal t_rfc_nom/32. If RFSHTMG[t_rfc_nom_x1_sel]is equal to 0, then t_rfc_nom is equal to (RFSHTMG[t_rfc_nom_x1_x32] * 32). If RFSHTMG[t_rfc_nom_x1_sel]is equal to 1 (for LPDDR2, LPDDR3, and LPDDR4 per-bank refresh only), then t_rfc_nom is equal to RFSHTMG[t_rfc_nom_x1_x32]. • For LPDDR2, LPDDR3, or LPDDR4, if derating is enabled (DERATEEN[derate_enable]), the internal t_rfc_nom may be divided by four. NOTE Programming Mode: Dynamic - Refresh Related                                                                                                |
| 19-17 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 16-12 refresh_to_x1_x 32 | Speculative refresh period Specifies the time of the DRAM bus being idle before the MC initiates a speculative refresh, if the refresh timer (tRFCnom, also known as tREFI) has expired at least once but not enough times to trigger a burst refresh (refresh_burst + 1). The specified value is in DFI clock cycles or multiples of 32 DFI clock cycles depending on RFSHTMG[t_rfc_nom_x1_sel]. Speculative refreshes continue successively until there are no pending refreshes or until the MC receives new read or write commands. Affects performance only. NOTE Programming Mode: Dynamic - Refresh Related |
| 11-10 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 9-4 refresh_burst        | Burst refresh Specifies the number refresh timeouts allowed to accumulate before the MC blocks traffic and forces the refreshs to execute. Closing pages to perform a refresh encurs a one-time penalty for each group of refreshes. Therefore, performing refreshes in a burst reduces the per-refresh penalty for page closings. A higher number for refresh_burst slightly increases utilization; a lower number decreases the worst-case latency associated with refreshes.                                                                                                                                    |

Table continues on the next page...

## Table continued from the previous page...

| Field               | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|---------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                     | • For information about burst refresh, see section 3.9 of the DDR2 JEDEC specification, JESD79-2F.pdf. • For DDR2 and DDR3, refresh is always per rank, not per bank. Rank refresh can be accumulated over (8 * tREFI) cycles using burst refresh. • For DDR4, in Fine Granularity Refresh state, you can postpone up to 8 refreshes in 1X mode, 16 refreshes in 2X mode, and 32 refreshes in 4X mode. If using PHY-initiated updates, you must ensure that tRFCmax is not violated due to a PHY-initiated update occurring shortly before a refresh burst is due. In this situation, the MC delays the refresh burst until the PHY-initiated update is complete. • ForLPDDR2,LPDDR3,andLPDDR4,inper-bankrefresh(per_bank_refresh==1)you postpone up to 64 refreshes. NOTE Programming Mode: Dynamic - Refresh Related 00_0000b - One-refresh burst 00_0001b - Two-refresh burst All other values - (Value + 1)-refresh burst |
| 3 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 2 per_bank_refres h | Per-bank refresh enable Enables per bank refresh, which allows traffic to flow to other banks while each bank refreshes. • This field is present only in systems that support LPDDR2, LPDDR3, or LPDDR4 DRAM. It must be 0 for any other DRAM types. • Per-bank refresh is not supported by all LPDDR2 devices but should be supported by all LPDDR3 and LPDDR4 devices. NOTE Programming Mode: Static 0b - All-bank refresh 1b - Per bank refresh                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 1-0 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

## 36.15.15 Refresh control 1 (RFSHCTL1)

## Offset

| Register   | Offset   |
|------------|----------|
| RFSHCTL1   | 54h      |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28   | 27                             | 26                             | 25                             | 24                             | 23                             | 22                             | 21                             | 20                             | 19                             | 18                             | 17                             | 16                             |
|--------|----------|----------|----------|------|--------------------------------|--------------------------------|--------------------------------|--------------------------------|--------------------------------|--------------------------------|--------------------------------|--------------------------------|--------------------------------|--------------------------------|--------------------------------|--------------------------------|
| R W    | Reserved | Reserved | Reserved |      | refresh_timer1_start_value_x32 | refresh_timer1_start_value_x32 | refresh_timer1_start_value_x32 | refresh_timer1_start_value_x32 | refresh_timer1_start_value_x32 | refresh_timer1_start_value_x32 | refresh_timer1_start_value_x32 | refresh_timer1_start_value_x32 | refresh_timer1_start_value_x32 | refresh_timer1_start_value_x32 | refresh_timer1_start_value_x32 | refresh_timer1_start_value_x32 |
| Reset  | 0        | 0        | 0        | 0    | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              |
| Bits   | 15       | 14       | 13       | 12   | 11                             | 10                             | 9                              | 8                              | 7                              | 6                              | 5                              | 4                              | 3                              | 2                              | 1                              | 0                              |
| R W    | Reserved | Reserved | Reserved |      | refresh_timer0_start_value_x32 | refresh_timer0_start_value_x32 | refresh_timer0_start_value_x32 | refresh_timer0_start_value_x32 | refresh_timer0_start_value_x32 | refresh_timer0_start_value_x32 | refresh_timer0_start_value_x32 | refresh_timer0_start_value_x32 | refresh_timer0_start_value_x32 | refresh_timer0_start_value_x32 | refresh_timer0_start_value_x32 | refresh_timer0_start_value_x32 |
| Reset  | 0        | 0        | 0        | 0    | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              | 0                              |

## Fields

| Field                                 | Function                                                                                                                                                                                                                                                                                                                                   |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -                               | Reserved                                                                                                                                                                                                                                                                                                                                   |
| 27-16 refresh_timer1_ start_value_x32 | Refresh timer start rank 1 Specifies the relative timing, in multiples of 32 DFI clock cycles, of the refresh of rank 0 (in a multi-rank system). Staggering refreshes to multiple ranks can increase traffic flow. For more information, see Refresh controls. Affects performance only. NOTE Programming Mode: Dynamic - Refresh Related |
| 15-12 -                               | Reserved                                                                                                                                                                                                                                                                                                                                   |
| 11-0 refresh_timer0_ start_value_x32  | Refresh timer start rank 0 Specifies the relative timing, in multiples of 32 DFI clock cycles, of the refresh of rank 0 (in a multi-rank system). Staggering refreshes to multiple ranks can increase traffic flow. For more information, see Refresh controls. Affects performance only. NOTE Programming Mode: Dynamic - Refresh Related |

## 36.15.16 Refresh Control 3 (RFSHCTL3)

## Offset

| Register   | Offset   |
|------------|----------|
| RFSHCTL3   | 60h      |

DDR Subsystem

## Diagram

<!-- image -->

## Fields

| Field                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-7 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 6-4 refresh_mode        | Fine granularity refresh mode Selects the Fine Granularity Refresh (FGR) mode of operation. • This field applies only to DDR4 DRAM (MSTR[ddr4]equal to 1). • You must set the FGR mode while the MC is in the Reset or Self Refresh states. Changing FGR mode during normal operation is not allowed. Making this a dynamic register will be supported in future version of the MC. • If auto-refresh is disabled (dis_auto_refresh == 1), only Fixed 1x mode is supported. • The on-the-fly modes are not supported in this version of the MC. NOTE Programming Mode: Quasi-dynamic Group 2 000b - Fixed 1x (normal mode) 001b - Fixed 2x 010b - Fixed 4x |
| 3-2 -                   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 1 refresh_update_ level | Refresh update level Specifies by toggling (from 0 to 1 or 1 to 0) that the refresh registers have been updated. The MC automatically updates the refresh registers when exiting reset. Do not toggle this field when the MC is in reset (core_ddrc_rstn == 0). NOTE                                                                                                                                                                                                                                                                                                                                                                                       |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field               | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|---------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                     | Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 0 dis_auto_refres h | Auto refresh disable Disables auto-refresh generated by the MC. When auto-refresh is disabled, the SoC core must generate refreshes using DBGCMD[rankn_refresh]. When dis_auto_refresh transitions from 0 to 1, the MC immediately schedules any pending refreshes. • You can change this field on the fly. • For DDR4: If Fine Granularity Refresh is enabled (RFSHCTL3[refresh_mode]), this field must be 0. NOTE Programming Mode: Dynamic - Refresh Related 0b - Enable 1b - Disable |

## 36.15.17 Refresh Timing (RFSHTMG)

## Offset

| Register   | Offset   |
|------------|----------|
| RFSHTMG    | 64h      |

## Diagram

<!-- image -->

## Fields

|   Field | Function      |
|---------|---------------|
|      31 | Refresh units |

Table continues on the next page...

## Table continued from the previous page...

| Field                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| t_rfc_nom_x1_s el       | Specifies whether the t_rfc_nom_x1_x32 and RFSHCTL0[refresh_to_x1_x32] values are in DFI clock cycles or multiples of 32 DFI clock cycles (x1 or x32). Programming Mode: Dynamic - Refresh Related                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 30-28 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 27-16 t_rfc_nom_x1_x 32 | Average refresh interval per rank Specifies the average time interval between refreshes per rank. The specified value is in DFI clock cycles or multiples of 32 DFI clock cycles depending on RFSHTMG[t_rfc_nom_x1_sel]. When the MC is operating at: • 1:1 frequency ratio, set t_rfc_nom_x1_x32 to RoundUp(tRFCI/tCK) • 1:2 frequency ratio, set t_rfc_nom_x1_x32 to RoundUp(RoundUp(tRFCI/tCK)/2) In both cases, if t_rfc_nom_x1_sel == 0, divide the result by 32 and round down. • For DDR2, DDR3, and DDR4: JEDEC specifies 7.8 μs. • For DDR4: The tREFI value depends on the refresh mode. You should program the appropriate value from the specification based on RFSHCTL3[refresh_mode]. • For mDDR, LPDDR2, LPDDR3, and LPDDR4: See the relevant JEDEC specification. • For LPDDR2, LPDDR3, and LPDDR4: - If using all-bank refreshes (RFSHCTL0[per_bank_refresh] equal to 0), use tREFIab in the above calculations. - If using per-bank refreshes (RFSHCTL0[per_bank_refresh] equal to 1), use tREFIpb in the above calculations. NOTE • t_rfc_nom_x1_x32 must be greater than 1. • If t_rfc_nom_x1_sel == 1, t_rfc_nom_x1_x32 must be greater than t_rfc_min. • If t_rfc_nom_x1_sel == 0, t_rfc_nom_x1_x32 * 32 must be greater than t_rfc_min. • For non-DDR4 or DDR4 in Fixed 1x mode: t_rfc_nom_x1_x32 must be less than or equal to 0xFFE. • For DDR4 in Fixed 2x mode: t_rfc_nom_x1_x32 must be less than or equal to 0x7FF. • For DDR4 in Fixed 4x mode: t_rfc_nom_x1_x32 must be less than or equal to 0x3FF. NOTE |
| 15 lpddr3_trefbw_e n    | Burst refresh window parameter enable Specifies whether to use the Burst Refresh Window (tREFBW) parameter.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

Table continues on the next page...

## Table continued from the previous page...

| Field         | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|               | This field applies only to certain LPDDR3 DRAM devices that comply with earlier versions of the JEDEC LPDDR3 specification. NOTE Programming Mode: Static 0b - tREFBW not used 1b - tREFBW used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 14-10 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 9-0 t_rfc_min | Refresh cycle time minimum Specifies the minimum time in DFI clock cycles from refresh to refresh or refresh to activate. When the MC is operating at: • 1:1 frequency ratio, set t_rfc_min to RoundUp(tRFCmin/tCK) • 1:2 frequency ratio, set t_rfc_min to RoundUp(RoundUp(tRFCmin/tCK)/2) • For LPDDR2, LPDDR3, and LPDDR4: - If using all-bank refreshes, the tRFCmin value in the above equations is equal to tRFCab. - If using per-bank refreshes, the tRFCmin value in the above equations is equal to tRFCpb. • For DDR4: The tRFCmin value in the above equations depends on the refresh mode (fixed 1X, 2X, or 4X) and the device density. NOTE Programming Mode: Dynamic - Refresh Related |

## 36.15.18 Refresh timing 1 (RFSHTMG1)

## Offset

| Register   | Offset   |
|------------|----------|
| RFSHTMG1   | 68h      |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23        | 22        | 21        | 20        | 19        | 18        | 17        | 16        |
|--------|----------|----------|----------|----------|----------|----------|----------|----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|
| R W    | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | t_pbr2pbr | t_pbr2pbr | t_pbr2pbr | t_pbr2pbr | t_pbr2pbr | t_pbr2pbr | t_pbr2pbr | t_pbr2pbr |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 1         | 0         | 0         | 0         | 1         | 1         | 0         | 0         |
| Bits   | 15       | 14       | 13       | 12       | 11       | 10       | 9        | 8        | 7         | 6         | 5         | 4         | 3         | 2         | 1         | 0         |
| R W    |          |          |          |          |          |          |          | Reserved |           |           |           |           |           |           |           |           |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         |

## Fields

| Field           | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 -         | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 23-16 t_pbr2pbr | Per-bank refresh to per-bank refresh different bank time Specifies the time interval between a per-bank refresh and a per-bank refresh of a different bank. When the MC is operating at: • 1:1 frequency ratio, set t_pbr2pbr to RoundUp(tpbR2pbR/tCK) • 1:2 frequency ratio, set t_pbr2pbr to RoundUp(RoundUp(tpbR2pbR/tCK)/2) • This field applies only to LPDDR DRAM in per-bank refresh (RFSHCTL0[per_bank_refresh]). • The tpbR2pbR value in the above equations depends on the device density. You should program the appropriate value from the JEDEC LPDDR4 spec. NOTE Programming Mode: Dynamic - Refresh Related |
| 15-0 -          | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

## 36.15.19 ECC Configuration 0 (ECCCFG0)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCCFG0    | 70h      |

DDR Subsystem

## Diagram

<!-- image -->

## Fields

| Field                            | Function                                                                                                                                                                                                                                                                                                                                                                                        |
|----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-30 ecc_region_ma p_granu      | Selectable protected region granularity Specifies the portion of memory space occupied by each selectable protected region in the ECC region map (ecc_region_map). Programming Mode: Static 00b - 1/8 of memory space 01b - 1/16 of memory space 10b - 1/32 of memory space 11b - 1/64 of memory space                                                                                          |
| 29-27 -                          | Reserved                                                                                                                                                                                                                                                                                                                                                                                        |
| 26-24 ecc_ap_err_thre shold      | Address parity error threshold Specifies the number of ECC errors (correctable or uncorrectable) that can occur within one burst before the MC indicates an ECC address parity error (ECCAPSTAT[ecc_ap_err]). The value must be less than the total number of ECC checks within one burst: (DRAM Data width) x (DRAM BL)/64 Programming Mode: Static                                            |
| 23-22 -                          | Reserved                                                                                                                                                                                                                                                                                                                                                                                        |
| 21-16 blk_channel_idl e_time_x32 | Block channel idle time Specifies the time interval, in multiples of 32 DFI clock cycles, of no access through the host interface (HIF) to protected regions that causes the MC to flush all block channels. To flush a block channel, the MC injects a write ECC command if there is any write in the block and then stops tracking the block address. Programming Mode: Quasi-dynamic Group 3 |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 14-8 ecc_region_ma p | Selectable protected region map Specifies which of the lowest seven memory regions (the selectable protected regions) are protected with ECC. Each bit corresponds to each of the lowest seven regions, with the lsb corresponding to the lowest address region. Unselected regions (corresponding bit == 0) are unprotected. This field interacts with ecc_region_map_granu, which specifies how many regions the total memory space is divided into: 8, 16, 32, or 64 regions. For example: To protect all of the memory space: • ecc_region_map = 0b1111111 • ecc_region_map_granu = 0 (eight total regions) To protect only the first 1/64 of the memory space: • ecc_region_map = 0b0000001 • ecc_region_map_granu = 3 (64 total regions) In this last example, the region map is: • Regions 63-56 are dedicated ECC. • Regions 55-7 are not protected (not in the selectable protected regions) • Regions 6-1 are not protected (corresponding bits = 0) • Region 0 is protected (corresponding bit = 1) • The highest 1/8 of the memory space is always an ECC region. • If inline ECC is enabled (ecc_mode == 1), 0b0000000 is an invalid value. You must specify at least one protected region. NOTE |
| 7 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 6 ecc_ap_en          | Address protection enable Enables address protection. This field applies only in inline ECC mode. Programming Mode: Static 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

Table continues on the next page...

## Table continued from the previous page...

| Field        | Function                                                                                                                                                                                                                                                                                                          |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 5 -          | Reserved                                                                                                                                                                                                                                                                                                          |
| 4 dis_scrub  | ECC scrubs disable Disables ECC scrubs. • This field applies only when ECCCFG0[ecc_mode] == 3'b100 or 3'b101 and MEMC_USE_RMW is defined. • In inline ECC mode, scrub is not supported and this field is ignored. NOTE Programming Mode: Static 0b - Enable 1b - Disable                                          |
| 3 -          | Reserved                                                                                                                                                                                                                                                                                                          |
| 2-0 ecc_mode | ECC mode Speifies the ECC mode. Programming Mode: Static DDRcontroller supportes Inline ECConly and does not supports AdvancedECCmode.So, below Advanced ECC mode can be ignored. NOTE 000b - ECC disabled 100b - ECC enabled - SEC/DED over 1 beat 101b - ECC enabled - Advanced ECC All other values - Reserved |

## 36.15.20 ECC Configuration 1 (ECCCFG1)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCCFG1    | 74h      |

## Diagram

<!-- image -->

## Fields

| Field                      | Function                                                                                                                                                                                                                                                                                                      |
|----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-12 -                    | Reserved                                                                                                                                                                                                                                                                                                      |
| 11-8 active_blk_chan nel   | Active block channels Specifies the number of active block channels. Use this value to limit the number of available channels. For example, set this value to 0 to have only one active channel, and therefore disable block interleaving. Programming Mode: Quasi-dynamic Group 3                            |
| 7 blk_channel_act ive_term | Block channel active terminate enable Enables termination of block channel on a full-block read or write (all addresses within the block are read or written). Programming Mode: Static 0b - Disable (use only for debug purposes) 1b - Enable (default for normal operation)                                 |
| 6 -                        | Reserved                                                                                                                                                                                                                                                                                                      |
| 5 ecc_region_was te_lock   | ECC waste region lock Locks the portion of the ECC region that is not either the ECC parity section or a designated selectable protected region. Whenlocked, anaccessof this region generates anerror.Whenunlocked,youcanaccess the region like any other non-ECC protected region. 0b - Unlocked 1b - Locked |
| 4 ecc_region_pari ty_lock  | ECC parity section lock                                                                                                                                                                                                                                                                                       |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field             | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|-------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                   | Locks the parity section of the ECC region, the highest 1/8 of memory address space. This region stores ECC parity data for the protected region. When locked, an access of this region generates an error. When unlocked, you can access the region like any other non-ECC protected region. Programming Mode: Quasi-dynamic Group 3 0b - Unlocked 1b - Locked                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 3-2 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 1 data_poison_bit | Data poison bits Selects one or two bits of data poisoning. Applies only if ECC data poisoning is enabled (data_poison_en). Programming Mode: Quasi-dynamic Group 3 Unlike in Sideband ECC mode, there is no dedicated hardware support for it in Inline ECC mode. NOTE 0b - Two bits (uncorrectable)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 0 data_poison_en  | ECC data poisoning enable Enables ECC data poisoning. When ECC data poisoning is enabled, the MCintroduces errors on writes to the address specified by and . Programming Mode: Quasi-dynamic Group 3 "ECC Data Poisoning is not supported with INLINE-ECC feature (you must write 0 to ECCCFG1[data_poison_en]). There is a software method to inject errors to ECCparity bits with inline ECC. Software method: Errors can be easily injected through the software by unlocking the ECC region through the ecc_region_parity_lock register and overriding certain ECC parity bits. When the corresponding addresses are read from a protected memory region, ECC errors are generated as correctable or uncorrectable, depending on the type of error introduced." Unlike in Sideband ECC mode, there is no dedicated hardware support for it in Inline ECC mode. NOTE |

## 36.15.21 SECDED ECC Status (ECCSTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCSTAT    | 78h      |

## Function

(Valid only in MEMC\_ECC\_SUPPORT==1 (SECDED ECC mode))

## Diagram

<!-- image -->

## Fields

| Field                   | Function                                                                                                                                              |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-17 -                 | Reserved                                                                                                                                              |
| 16 ecc_uncorrecte d_err | Double-bit error indicator Indicates an uncorrectable double-bit ECC error on any lane. Programming Mode: Dynamic 0b - No error 1b - Double-bit error |
| 15-9 -                  | Reserved                                                                                                                                              |
| 8 ecc_corrected_ err    | Single-bit error indicator Indicates a correctable single-bit ECC error on any lane. Programming Mode: Dynamic                                        |

Table continues on the next page...

## Table continued from the previous page...

| Field                      | Function                                                                                                         |
|----------------------------|------------------------------------------------------------------------------------------------------------------|
|                            | 0b - No error 1b - Single-bit error                                                                              |
| 7                          | Reserved                                                                                                         |
| 6-0 ecc_corrected_ bit_num | ECC corrected bit number Indicates the bit number corrected by a single-bit ECC error. Programming Mode: Dynamic |

## 36.15.22 ECC Control (ECCCTL)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCCTL     | 7Ch      |

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                                                                           |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-19   | Reserved                                                                                                                                                                                                                                           |
| 18      | ECC address protection error interrupt force Forces assertion of the ECCaddress protection error interrupt. There is no interaction between functionally triggering an interrupt and forcing an interrupt; the two actions are mutually exclusive. |

Table continues on the next page...

## Table continued from the previous page...

| Field                              | Function                                                                                                                                                                                                                                                                                                                                               |
|------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ecc_ap_err_intr _force             | The MC returns this bit to zero automatically. Programming Mode: Dynamic 0b - No effect 1b - Force the interrupt                                                                                                                                                                                                                                       |
| 17 ecc_uncorrecte d_err_intr_force | Uncorrected ECC error interrupt force Forces assertion of the uncorrected ECC error interrupt. There is no interaction between functionally triggering an interrupt and forcing an interrupt; the two actions are mutually exclusive. The MC returns this bit to zero automatically. Programming Mode: Dynamic 0b - No effect 1b - Force the interrupt |
| 16 ecc_corrected_ err_intr_force   | Corrected ECC error interrupt force Forces assertion of the corrected ECCerror interrupt. There is no interaction between functionally triggering an interrupt and forcing an interrupt; the two actions are mutually exclusive. The MC returns this bit to zero automatically. Programming Mode: Dynamic 0b - No effect 1b - Force the interrupt      |
| 15-11 -                            | Reserved                                                                                                                                                                                                                                                                                                                                               |
| 10 ecc_ap_err_intr _en             | ECC address protection error interrupt enable Enables the ECC address protection error interrupt. Programming Mode: Dynamic 0b - Disable 1b - Enable                                                                                                                                                                                                   |
| 9 ecc_uncorrecte d_err_intr_en     | Uncorrected ECC error interrupt enable Enables the uncorrected ECC error interrupt. Programming Mode: Dynamic 0b - Disable 1b - Enable                                                                                                                                                                                                                 |
| 8                                  | Corrected ECC error interrupt enable Enables the corrected ECC error interrupt.                                                                                                                                                                                                                                                                        |

Table continues on the next page...

## Table continued from the previous page...

| Field                      | Function                                                                                                                                                                                                                 |
|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ecc_corrected_ err_intr_en | Programming Mode: Dynamic 0b - Disable 1b - Enable                                                                                                                                                                       |
| 7-5 -                      | Reserved                                                                                                                                                                                                                 |
| 4 ecc_ap_err_intr _clr     | Clear ECC address protection error interrupt Clears ECCAPSTAT[ecc_ap_err]. The MC returns this bit to zero automatically. Programming Mode: Dynamic 0b - No effect 1b - Clear the ECC address protection error interrupt |
| 3 ecc_uncorr_err_ cnt_clr  | Clear uncorrected ECC error count Clears ECCERRCNT[ecc_uncorr_err_cnt]. The MC returns this bit to zero automatically. Programming Mode: Dynamic 0b - No effect 1b - Clear the uncorrected ECC error count               |
| 2 ecc_corr_err_cn t_clr    | Clear corrected ECC error count Clears ECCERRCNT[ecc_corr_err_cnt]. The MC returns this bit to zero automatically. Programming Mode: Dynamic 0b - No effect 1b - Clear the corrected ECC error count                     |
| 1 ecc_uncorrecte d_err_clr | Clear uncorrected ECC error Clears the following registers and fields: • ECCSTAT[ecc_uncorrected_err] • ECCUSYN0 • ECCUSYN1 • ECCUSYN2 The MC returns this bit to zero automatically. Programming Mode: Dynamic          |

Table continues on the next page...

## Table continued from the previous page...

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                         |
|--------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                          | 0b - No effect 1b - Clear the uncorrected ECC error                                                                                                                                                                                                                                                                                                              |
| 0 ecc_corrected_ err_clr | Clear corrected ECC error Clears the following registers and fields: • ECCSTAT[ecc_corrected_err] • ECCSTAT[ecc_corrected_bit_num] • ECCCADDR0 • ECCCADDR1 • ECCCSYN0 • ECCCSYN1 • ECCCSYN2 • ECCBITMASK0 • ECCBITMASK1 • ECCBITMASK2 The MC returns this bit to zero automatically. Programming Mode: Dynamic 0b - No effect 1b - Clear the corrected ECC error |

## 36.15.23 ECC Error Counter (ECCERRCNT)

## Offset

<!-- image -->

## Fields

| Field                     | Function                                                                                                                                                                                                                              |
|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 ecc_uncorr_err_ cnt | Uncorrectable ECC errors count Indicates the number of detected uncorrectable ECC errors. For inline ECC, this field saturates at FFFFh. For side-band ECC with SECDED ECC, it saturates at FFFCh or above. Programming Mode: Dynamic |
| 15-0 ecc_corr_err_cn t    | Correctable ECC errors count Indicates the number of detected correctable ECC errors. For inline ECC, this field saturates at FFFFh. For side-band ECC with SECDED ECC, it saturates at FFFCh or above. Programming Mode: Dynamic     |

## 36.15.24 ECC Corrected Error Address 0 (ECCCADDR0)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCCADDR0  | 84h      |

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-25   | Reserved   |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field             | Function                                                                                                              |
|-------------------|-----------------------------------------------------------------------------------------------------------------------|
| 24 ecc_corr_rank  | Rank number Indicates the rank number of a read resulting in a corrected ECC error. Programming Mode: Dynamic         |
| 23-18 -           | Reserved                                                                                                              |
| 17-0 ecc_corr_row | Page/row number Indicates the page/row number of a read resulting in a corrected ECC error. Programming Mode: Dynamic |

## 36.15.25 ECC Corrected Error Address 1 (ECCCADDR1)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCCADDR1  | 88h      |

## Diagram

<!-- image -->

## Fields

| Field       | Function                                                                      |
|-------------|-------------------------------------------------------------------------------|
| 31-26       | Reserved                                                                      |
| -           |                                                                               |
| 25-24       | Bank group                                                                    |
| ecc_corr_bg | Indicates the bank group number of a read resulting in a corrected ECC error. |

Table continues on the next page...

## Table continued from the previous page...

| Field               | Function                                                                                                                                   |
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
|                     | Programming Mode: Dynamic                                                                                                                  |
| 23-19 -             | Reserved                                                                                                                                   |
| 18-16 ecc_corr_bank | Bank number Indicates the bank number of a read resulting in a corrected ECC error. Programming Mode: Dynamic                              |
| 15-12 -             | Reserved                                                                                                                                   |
| 11-0 ecc_corr_col   | Block number Indicates the block number of a read resulting in a corrected ECC error. The lsb is not shown. NOTE Programming Mode: Dynamic |

## 36.15.26 ECC Corrected Syndrome 0 (ECCCSYN0)

## Offset

<!-- image -->

## Fields

| Field                    | Function                                                                                                                                                                  |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0                     | Corrected ECC error data pattern: bits 31-0                                                                                                                               |
| ecc_corr_syndr omes_31_0 | Indicates the least significant 32bits of adata pattern that resulted in acorrected ECCerror. 16-bitECCuses only the 16 least significant bits. Programming Mode: Dynamic |

## 36.15.27 ECC Corrected Syndrome 1 (ECCCSYN1)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCCSYN1   | 90h      |

<!-- image -->

## Fields

| Field                     | Function                                                                                                                                                                       |
|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0                      | Corrected ECC error data pattern: bits 63-31                                                                                                                                   |
| ecc_corr_syndr omes_63_32 | Indicates the most significant 32 bits of a 64-bit data pattern that resulted in a corrected ECC error. 16-bit and 32-bit ECC do not use this field. Programming Mode: Dynamic |

## 36.15.28 ECC Corrected Syndrome 2 (ECCCSYN2)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCCSYN2   | 94h      |

## Diagram

<!-- image -->

## Fields

| Field                         | Function                                                                                                                                                                                                                                                                                                  |
|-------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-8 -                        | Reserved                                                                                                                                                                                                                                                                                                  |
| 7-0 ecc_corr_syndr omes_71_64 | Corrected ECC error data pattern: ECC byte Indicates the ECC byte for an ECC lane that resulted in a corrected ECC error. This byte's position in the ECC lane depends on the ECC width: • For 64-bit ECC: bits 71-64 • For 32-bit ECC: bits 39-32 • For 16-bit ECC: bits 23-16 Programming Mode: Dynamic |

## 36.15.29 ECC Corrected Data Bit Mask 0 (ECCBITMASK0)

## Offset

| Register    | Offset   |
|-------------|----------|
| ECCBITMASK0 | 98h      |

DDR Subsystem

## Diagram

<!-- image -->

## Fields

| Field                        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0 ecc_corr_bit_ma sk_31_0 | Corrected data bit mask: bits 31-0 Indicates the corrected bits in the least signifcant 32 bits of the data portion of an ECClane: 1 indicates that the bit has been corrected; 0 indicates that the bit has not been corrected. 16-bit ECC uses only the least significant 16 bits. This field accumulates data over multiple ECC errors to give an overall indication of which bits are being corrected. To clear this field, write a 1 to ECCCTL[ecc_corrected_err_clr] Programming Mode: Dynamic |

## 36.15.30 ECC Corrected Data Bit Mask 1 (ECCBITMASK1)

## Offset

| Register    | Offset   |
|-------------|----------|
| ECCBITMASK1 | 9Ch      |

<!-- image -->

DDR Subsystem

## Fields

| Field                         | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|-------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0 ecc_corr_bit_ma sk_63_32 | Corrected data bit mask: bits 63-32 Indicates the corrected bits in the most signifcant 32 bits of the data portion of an ECClane: 1 indicates that the bit has been corrected; 0 indicates that the bit has not been corrected. 16-bit and 32-bit ECC does not use this field. This field accumulates data over multiple ECC errors to give an overall indication of which bits are being corrected. To clear this field, write a 1 to ECCCTL[ecc_corrected_err_clr] Programming Mode: Dynamic |

## 36.15.31 ECC Corrected Data Bit Mask 2 (ECCBITMASK2)

## Offset

| Register    | Offset   |
|-------------|----------|
| ECCBITMASK2 | A0h      |

## Diagram

<!-- image -->

## Fields

| Field                    | Function                                                                                                                                                                                                          |
|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-8 -                   | Reserved                                                                                                                                                                                                          |
| 7-0                      | Corrected data bit mask: ECC byte                                                                                                                                                                                 |
| ecc_corr_bit_ma sk_71_64 | Indicates the corrected bits in the ECC byte of an ECC lane: 1 indicates that the bit has been corrected; 0 indicates that the bit has not been corrected. This byte's position intheECClanedependsontheECCwidth: |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                               |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | • For 64-bit ECC: bits 71-64 • For 32-bit ECC: bits 39-32 • For 16-bit ECC: bits 23-16 This field accumulates data over multiple ECC errors to give an overall indication of which bits are being corrected. To clear this field, write a 1 to ECCCTL[ecc_corrected_err_clr] Programming Mode: Dynamic |

## 36.15.32 ECC Uncorrected Error Address 0 (ECCUADDR0)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCUADDR0  | A4h      |

## Diagram

<!-- image -->

## Fields

| Field            | Function                                                                                             |
|------------------|------------------------------------------------------------------------------------------------------|
| 31-25            | Reserved                                                                                             |
| 24               | Rank number                                                                                          |
| ecc_uncorr_ran k | Indicates the rank number of a read resulting in an uncorrected ECC error. Programming Mode: Dynamic |

Table continues on the next page...

Table continued from the previous page...

| Field               | Function                                                                                                                 |
|---------------------|--------------------------------------------------------------------------------------------------------------------------|
| 23-18 -             | Reserved                                                                                                                 |
| 17-0 ecc_uncorr_row | Page/row number Indicates the page/row number of a read resulting in an uncorrected ECC error. Programming Mode: Dynamic |

## 36.15.33 ECC Uncorrected Error Address 1 (ECCUADDR1)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCUADDR1  | A8h      |

## Diagram

<!-- image -->

## Fields

| Field               | Function                                                                                                              |
|---------------------|-----------------------------------------------------------------------------------------------------------------------|
| 31-26 -             | Reserved                                                                                                              |
| 25-24 ecc_uncorr_bg | Bank group Indicates the bank group number of a read resulting in an uncorrected ECC error. Programming Mode: Dynamic |
| 23-19 -             | Reserved                                                                                                              |

Table continues on the next page...

Table continued from the previous page...

| Field                  | Function                                                                                                                                      |
|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|
| 18-16 ecc_uncorr_ban k | Bank number Indicates the bank number of a read resulting in an uncorrected ECC error. Programming Mode: Dynamic                              |
| 15-12 -                | Reserved                                                                                                                                      |
| 11-0 ecc_uncorr_col    | Block number Indicates the block number of a read resulting in an uncorrected ECC error. The lsb is not shown. NOTE Programming Mode: Dynamic |

## 36.15.34 ECC Uncorrected Syndrome 0 (ECCUSYN0)

## Offset

<!-- image -->

## Fields

| Field   | Function                                      |
|---------|-----------------------------------------------|
| 31-0    | Uncorrected ECC error data pattern: bits 31-0 |

Table continues on the next page...

| Field                      | Function                                                                                                                                                                         |
|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ecc_uncorr_syn dromes_31_0 | Indicates the least significant 32 bits of a data pattern that resulted in an uncorrected ECCerror. 16-bitECC uses only the 16 least significant bits. Programming Mode: Dynamic |

## 36.15.35 ECC Uncorrected Syndrome 1 (ECCUSYN1)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCUSYN1   | B0h      |

<!-- image -->

## Fields

| Field                       | Function                                                                                                                                                                         |
|-----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0                        | Uncorrected ECC error data pattern: bits 63-31                                                                                                                                   |
| ecc_uncorr_syn dromes_63_32 | Indicates the most significant 32 bits of a 64-bit data pattern that resulted in an uncorrected ECCerror. 16-bit and 32-bit ECC do not use this field. Programming Mode: Dynamic |

## 36.15.36 ECC Uncorrected Syndrome 2 (ECCUSYN2)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCUSYN2   | B4h      |

## Diagram

<!-- image -->

## Fields

| Field                           | Function                                                                                                                                                                                                                                                                                                       |
|---------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-8 -                          | Reserved                                                                                                                                                                                                                                                                                                       |
| 7-0 ecc_uncorr_syn dromes_71_64 | Uncorrected ECC error data pattern: ECC byte Indicates the ECC byte for an ECC lane that resulted in an uncorrected ECC error. This byte's position in the ECC lane depends on the ECC width: • For 64-bit ECC: bits 71-64 • For 32-bit ECC: bits 39-32 • For 16-bit ECC: bits 23-16 Programming Mode: Dynamic |

## 36.15.37 DRAM Initialization 0 (INIT0)

## Offset

| Register   | Offset   |
|------------|----------|
| INIT0      | D0h      |

DDR Subsystem

## Diagram

<!-- image -->

| Bits   | 31             | 30             | 29       | 28       | 27            | 26            | 25             | 24             | 23             | 22             | 21             | 20             | 19             | 18             | 17             | 16             |
|--------|----------------|----------------|----------|----------|---------------|---------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|
| R W    | skip_dram_init | skip_dram_init | Reserved | Reserved | Reserved      | Reserved      | post_cke_x1024 | post_cke_x1024 | post_cke_x1024 | post_cke_x1024 | post_cke_x1024 | post_cke_x1024 | post_cke_x1024 | post_cke_x1024 | post_cke_x1024 | post_cke_x1024 |
| Reset  | 0              | 0              | 0        | 0        | 0             | 0             | 0              | 0              | 0              | 0              | 0              | 0              | 0              | 0              | 1              | 0              |
| Bits   | 15             | 14             | 13       | 12       | 11            | 10            | 9              | 8              | 7              | 6              | 5              | 4              | 3              | 2              | 1              | 0              |
| R W    | Reserved       | Reserved       | Reserved | Reserved | pre_cke_x1024 | pre_cke_x1024 | pre_cke_x1024  | pre_cke_x1024  | pre_cke_x1024  | pre_cke_x1024  | pre_cke_x1024  | pre_cke_x1024  | pre_cke_x1024  | pre_cke_x1024  | pre_cke_x1024  | pre_cke_x1024  |
| Reset  | 0              | 0              | 0        | 0        | 0             | 0             | 0              | 0              | 0              | 1              | 0              | 0              | 1              | 1              | 1              | 0              |

## Fields

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-30 skip_dram_init | Skip DRAM Initialization/Reset State Specifies whether to skip the DRAM initialization routine and what state the MC controller should be in on reset exit. Programming Mode: Quasi-dynamic Group 2 00b - Run DRAM initialization routine on power-up. 01b - Skip DRAM initialization routine on power-up and start up in normal mode. 10b - Reserved 11b - Skip DRAM initialization routine on power-up and start up in Self Refresh state.                                                                                                        |
| 29-26 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 25-16 post_cke_x1024 | Post-CKE Interval Specifies the time interval, in multiples of 1024 DFI clock cycles, to wait after driving CKE high to start the DRAM initialization sequence. When the MCis operating at 1:2 frequency ratio, set post_cke_x1024 to RoundUp(JEDEC specification/2). • For DDR2: Typically requires a post_CKE delay of 400 ns, requiring post_cke_x1024 = 2 at all clock speeds. • For LPDDR2 and LPDDR3: Typically requires a post-CKE delay of 200 μs. • For LPDDR4: Typically requires a post_CKE delay of 2 μs. NOTE Programming Mode: Static |
| 15-12 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 11-0                 | Pre-CKE Interval                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field         | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| pre_cke_x1024 | Specifies the time interval, in multiples of 1024 DFI clock cycles, to wait after reset before driving CKE high to start the DRAM initialization sequence. When the MC is operating at 1:2 frequency ratio, set pre_cke_x1024 to RoundUp(JEDEC specification/2). • For DDR2: Typically requires a pre-CKE delay greater than 200 μs. • For LPDDR2 and LPDDR3: tINIT1 of 100 ns (min). • For LPDDR4: tINIT3 of 2 ms (min). • For DDR3 and DDR4 RDIMMS: Include the time needed to satisfy tSTAB. NOTE Programming Mode: Static |

## 36.15.38 DRAM Initialization 1 (INIT1)

## Offset

| Register   | Offset   |
|------------|----------|
| INIT1      | D4h      |

<!-- image -->

## Fields

| Field   | Function                                                                                        |
|---------|-------------------------------------------------------------------------------------------------|
| 31-25   | Reserved                                                                                        |
| 24-16   | Reset Signal Assert Interval Specifies the time interval, in multiples initialization sequence. |

Table continues on the next page...

Table continued from the previous page...

| Field            | Function                                                                                                                                                                                                                              |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| dram_rstn_x102 4 | • This field applies only to DDR3, DDR4 or LPDDR4 systems. NOTE WhentheMCisoperating at 1:2 frequency ratio, set dram_rstn_x1024 to RoundUp(JEDECspecification/2). Programming Mode: Static 0_0000_0000b - Invalid value.             |
| 15-4 -           | Reserved                                                                                                                                                                                                                              |
| 3-0 pre_ocd_x32  | Pre-OCD Interval Specifies the time interval, in multiples of 32 DFI clock cycles, before driving the OCD complete command to DRAM. There is no known specific requirement for this; you may set it to zero. Programming Mode: Static |

## 36.15.39 DRAM Initialization 2 (INIT2)

## Offset

| Register   | Offset   |
|------------|----------|
| INIT2      | D8h      |

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-16   | Reserved   |

Table continues on the next page...

Table continued from the previous page...

| Field                      | Function                                                                                                                                                                                                                                                                                                                                                              |
|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-8 idle_after_reset _x32 | Idle time after the reset command, tINIT4. Present only in designs configured to support LPDDR2. When the controller is operating in 1:2 frequency ratio mode, program this to JEDEC spec value divided by 2, and round it up to the next integer value. Unit: Multiples of 32 DFI clock cycles. Programming Mode: Static                                             |
| 7-4 -                      | Reserved                                                                                                                                                                                                                                                                                                                                                              |
| 3-0 min_stable_cloc k_x1   | Time to wait after the first CKE high, tINIT2. Present only in designs configured to support LPDDR2/ LPDDR3. LPDDR2/LPDDR3 typically requires 5 x tCK delay. When the controller is operating in 1:2 frequency ratio mode, program this to JEDEC spec value divided by 2, and round it up to the next integer value. Unit: DFI clock cycles. Programming Mode: Static |

## 36.15.40 DRAM Initialization 3 (INIT3)

## Offset

| Register   | Offset   |
|------------|----------|
| INIT3      | DCh      |

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|---------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W     |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R       |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W Reset | 0    | 0    | 0    | 0    | 0    | 1    | 0    | 1    | 0    | 0    | 0    | 1    | 0    | 0    | 0    | 0    |

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                                                                                      |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16   | Mode Register Value                                                                                                                                                                                                                                           |
| mr      | Specifies the value to write to the relevant Mode Register, depending on the DRAM type: • For DDR2: Mode Register (MR). Bit 8 is for DLL and its value in this register is ignored; the MC sets it appropriately. • For DDR3 and DDR4: Mode Register 0 (MR0). |

Table continues on the next page...

Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|          | • For mDDR: MR • For LPDDR2, LPDDR3, and LPDDR4: MR1 Programming Mode: Quasi-dynamic Group 4                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 15-0 emr | Extended Mode Register Value Specifies the value to write to the relevant Mode Register, depending on the DRAM type: • For DDR2: Extended Mode Register (EMR). Bits 9-7 are for OCD and their value in this register is ignored; the MC sets them appropriately. • For DDR3 or DDR4: Mode Register 1 (MR1). Set bit 7 to 0. If PHY-evaluation mode training is enabled, the MC sets it appropriately during write leveling. • For mDDR: EMR • For LPDDR2, LPDDR3, and LPDDR4: MR2 Programming Mode: Quasi-dynamic Group 4 |

## 36.15.41 DRAM Initialization 4 (INIT4)

## Offset

| Register   | Offset   |
|------------|----------|
| INIT4      | E0h      |

## Diagram

<!-- image -->

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|---------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W     |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R       |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W Reset | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                |
|---------|-----------------------------------------------------------------------------------------|
| 31-16   | Extended Mode Register 2 Value                                                          |
|         | Specifies the value to write to the relevant Mode Register, depending on the DRAM type: |

Table continues on the next page...

Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                            |
|-----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| emr2      | • For DDR2: Extended Mode Register 2 (EMR2). • For DDR3 and DDR4: Mode Register 2 (MR2). • For LPDDR2, LPDDR3, and LPDDR4: MR3 • For mDDR: Not used Programming Mode: Quasi-dynamic Group 4                                                                                                                         |
| 15-0 emr3 | Extended Mode Register 3 Value Specifies the value to write to the relevant Mode Register, depending on the DRAM type: • For DDR2: Extended Mode Register 3 (EMR3). • For DDR3 and DDR4: Mode Register 3 (MR3). • For mDDR, LPDDR2, and LPDDR3: Not used • For LPDDR4: MR13 Programming Mode: Quasi-dynamic Group 4 |

## 36.15.42 DRAM Initialization 5 (INIT5)

## Offset

| Register   | Offset   |
|------------|----------|
| INIT5      | E4h      |

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-24   | Reserved   |

Table continues on the next page...

Table continued from the previous page...

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 23-16 dev_zqinit_x32     | ZQ initial calibration, tZQINIT. Present only in designs configured to support DDR3 or DDR4 or LPDDR2/ LPDDR3. DDR3 typically requires 512 DRAM clock cycles. DDR4 requires 1024 DRAM clock cycles. LPDDR2/LPDDR3 requires 1 us. When the controller is operating in 1:2 frequency ratio mode, program this to JEDEC spec value divided by 2, and round it up to the next integer value. Unit: Multiples of 32 DFI clock cycles. Programming Mode: Static |
| 15-10 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 9-0 max_auto_init_x 1024 | Maximum duration of the auto initialization, tINIT5. Present only in designs configured to support LPDDR2/LPDDR3. LPDDR2/LPDDR3 typically requires 10 us. Unit: Multiples of 1024 DFI clock cycles. Programming Mode: Static                                                                                                                                                                                                                              |

## 36.15.43 DRAM Initialization 6 (INIT6)

## Offset

| Register   | Offset   |
|------------|----------|
| INIT6      | E8h      |

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                  |
|---------|---------------------------------------------------------------------------------------------------------------------------|
| 31-16   | Mode Register 4 Value                                                                                                     |
| mr4     | Specifies the value to write to the relevant Mode Register, depending on the DRAM type: • For DDR4: Mode Register 4 (MR4) |

Table continues on the next page...

Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                         |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|          | • For LPDDR4: MR11 • For DDR2, DDR3, mDDR, LPPDDR2, and LPDDR3: Not used Programming Mode: Quasi-dynamic Group 4                                                                                                                                                 |
| 15-0 mr5 | Mode Register 5 Value Specifies the value to write to the relevant Mode Register, depending on the DRAM type: • For DDR4: Mode Register 5 (MR5) • For LPDDR4: MR12 • For DDR2, DDR3, mDDR, LPPDDR2, and LPDDR3: Not used Programming Mode: Quasi-dynamic Group 4 |

## 36.15.44 DRAM Initialization 7 (INIT7)

## Offset

| Register   | Offset   |
|------------|----------|
| INIT7      | ECh      |

## Diagram

<!-- image -->

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|---------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W     |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R       |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W Reset | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                      |
|---------|-------------------------------------------------------------------------------------------------------------------------------|
| 31-16   | Mode Register 22 Value                                                                                                        |
| mr22    | Specifies the value to write to the relevant Mode Register, depending on the DRAM type: • For LPDDR4: Mode Register 22 (MR22) |

Table continues on the next page...

Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                         |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|          | • For DDR2, DDR3, DDR4, mDDR, LPPDDR2, and LPDDR3: Not used Programming Mode: Quasi-dynamic Group 4                                                                                                                                                              |
| 15-0 mr6 | Mode Register 6 Value Specifies the value to write to the relevant Mode Register, depending on the DRAM type: • For DDR4: Mode Register 6 (MR6) • For LPDDR4: MR14 • For DDR2, DDR3, mDDR, LPPDDR2, and LPDDR3: Not used Programming Mode: Quasi-dynamic Group 4 |

## 36.15.45 Rank Control (RANKCTL)

## Offset

| Register   | Offset   |
|------------|----------|
| RANKCTL    | F4h      |

## Diagram

<!-- image -->

## Fields

| Field             | Function                                                                                                                                                                                    |
|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-12             | Reserved                                                                                                                                                                                    |
| 11-8              | Different rank write gap                                                                                                                                                                    |
| diff_rank_wr_ga p | Specifies the time gap in DFL clock cycles between data responses when performing consecutive writes to differnt ranks. Use this field to switch PHY delays to match the rank requirements. |

Table continues on the next page...

## Table continued from the previous page...

| Field                 | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                       | You should consider both the PHY and ODT requirements when specifying this value: • PHY requirement: - tphy_wrcsgap (see the PHY databook for this value) - If CRC is enabled, increase the gap value by 1. - If write preamble is set to 2tCK (DDR4 only), increase the gap value by 1. - If write postamble is set to 1.5tCK (LPDDR4 only), increase the gap value by 1. • ODT requirement: - The value in this register takes care of the ODT switch-off timing requirement when switching ranks during writes. - For LPDDR4: With DQ ODT enabled, the gap value must be a minimum of: ODTLoff - ODTLon - BL/2 + 1 When the MC is operating at: • 1:1 frequency ratio, diff_rank_wr_gap should be the larger of the PHY requirement or the ODT requirement. • 1:2 frequency ratio, diff_rank_wr_gap should be the larger value divided by two and rounded up to the next integer. • This field applies only to multi-rank configurations. • For DDR4-LRDIMM, refer to the TWRRD timing requirements in the JEDEC DDR4 Data Buffer (DDR4DB01) specification. • For other DRAM: the gap value must be a minimum of ODTCFG[wr_odt_hold] - BL/2. NOTE Programming Mode: Quasi-dynamic Group 2 |
| 7-4 diff_rank_rd_ga p | Different rank read gap Specifies the time gap in DFL clock cycles between data responses when performing consecutive reads to differnt ranks. Use this field to switch PHY delays to match the rank requirements.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

Table continues on the next page...

## Table continued from the previous page...

| Field           | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|-----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                 | • 1:1 frequency ratio, diff_rank_rd_gap should be the larger of the PHY requirement or the ODT requirement • 1:2 frequency ratio, diff_rank_rd_gap should be the larger value divided by two and rounded up to the next integer • This field applies only to multi-rank configurations. • For DDR4-LRDIMM, refer to the TRDRD timing requirements in the JEDEC DDR4 Data Buffer (DDR4DB01) specification. NOTE Programming Mode: Quasi-dynamic Group 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 3-0 max_rank_rd | Rank Maximum Reads Specifies the maximum number of reads that can be scheduled consecutively to the same rank. Reads to the same rank can be performed back-to-back. Reads to different ranks require additional gap, which you specify in diff_rank_rd_gap. This is to avoid possible data bus contention as well as to give PHY enough time to switch the delay when changing ranks. The MCarbitrates for bus access on a cycle-by-cycle basis; therefore, after a read is scheduled, there are only a few clock cycles (determined by the value in diff_rank_rd_gap) in which only reads from the same rank are eligible to be scheduled. This prevents reads from other ranks from having fair access to the data bus. After the numbers of consecutive reads specified in this field, the scheduler inserts a delay equal to diff_rank_rd_gap to allow all ranks a fair opportunity to be scheduled. Higher numbers increase bandwidth utilization, lower numbers increase fairness. You can disable this feature by setting this field to 0. When set to 0, the MC stays on the same rank as long as commands are available for it. The minimum programmable value is 0 (feature disabled) and the maximum is Fh. FOR PERFORMANCE ONLY. • Applies to multi-rank configurations. • Affects performance only. NOTE Programming Mode: Static |

## 36.15.46 DRAM Timing 0 (DRAMTMG0)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG0   | 100h     |

## Diagram

<!-- image -->

| Bits   | 31        | 30        | 29        | 28        | 27        | 26        | 25        | 24        | 23       | 22       | 21        | 20        | 19        | 18        | 17        | 16        |
|--------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|----------|----------|-----------|-----------|-----------|-----------|-----------|-----------|
| R W    | Reserv ed | wr2pre    | wr2pre    | wr2pre    | wr2pre    | wr2pre    | wr2pre    | wr2pre    | Reserved | Reserved | t_faw     | t_faw     | t_faw     | t_faw     | t_faw     | t_faw     |
| Reset  | 0         | 0         | 0         | 0         | 1         | 1         | 1         | 1         | 0        | 0        | 0         | 1         | 0         | 0         | 0         | 0         |
| Bits   | 15        | 14        | 13        | 12        | 11        | 10        | 9         | 8         | 7        | 6        | 5         | 4         | 3         | 2         | 1         | 0         |
| R W    | Reserv ed | t_ras_max | t_ras_max | t_ras_max | t_ras_max | t_ras_max | t_ras_max | t_ras_max | Reserved | Reserved | t_ras_min | t_ras_min | t_ras_min | t_ras_min | t_ras_min | t_ras_min |
| Reset  | 0         | 0         | 0         | 1         | 1         | 0         | 1         | 1         | 0        | 0        | 0         | 0         | 1         | 1         | 1         | 1         |

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 -         | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 30-24 wr2pre | Write to precharge minimum interval Specifies the minimum time interval, in DFI clock cycles, between write and precharge to the same bank. Use the following equation to determine the correct value: (WL + BL/2 + tWR) + 15 ns where: • WL is write latency. • BL is burst length. This must match the value in the BL field of the mode register to the DRAM.TheMC does not support BST (burst terminate) at this time. • tWR is write recovery time. This comes directly from the DRAM specification. The parenthetical portion of the equation equals approximately eight cycles. Therefore, at 400 MHz, wr2pre should be 14 clock cylces. The value is less at lower frequencies. For LPDDR2, LPDDR3, and LPDDR4, add one extra cycle. When the MC is operating at: • 1:2 frequency ratio and 1T command timing, divide the above value by 2 (no rounding up). • 1:2 frequency ratio and 2T command timing or LPDDR4, divide the above value by 2 and round up. For DDR4, LPDDR4, LPDDR3, using nWR(WR) instead of tWR to calculate the value of this parameter. DependingonthePHY,whenusingLRDIMMyoumayneedtoadjustwr2pretocompensate for the extra cycle of latency through the LRDIMM. NOTE Programming Mode: Quasi-dynamic Group 1, Group 2, Group 4 |
| 23-22 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field          | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 21-16 t_faw    | Four active window (tFAW) Specifies the sliding time window, in DFI clock cycles, in which a maximum of 4-bank activates are allowed in an 8-bank configuraiton. When the MC is operating in 1:2 frequency ratio, t_faw should be RoundUp(tFAW/2). In a 4-bank design, set t_faw to 1h independent of the frequency ratio. This field applies only when eight or more banks (or banks x bank groups) are present. NOTE Programming Mode: Quasi-dynamic Group 2, Group 4                                             |
| 15 -           | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 14-8 t_ras_max | Activate to precharge maximum interval Specifies the maximum time interval, in multiples of 1024 DFI clock cycles, between activate and precharge to the same bank: tRAS(max). This is the maximum time that a page can be kept open. When the MC is operating at: • 1:1 frequency ratio, t_ras_max should be RoundDown(tRAS(max)/tCK/1024). • 1:2 frequency ratio, t_ras_max should be RoundDown((RoundDown(tRAS(max)/tCK/1024) - 1)/2) Programming Mode: Quasi-dynamic Group 2, Group 4 000_0000b - Invalid value |
| 7-6 -          | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 5-0 t_ras_min  | Activate to precharge minimum interval Specifies the minimum time interval, in DFI clock cycles, between activate and precharge to the same bank: tRAS(min). When the MC is operating at: • 1:2 frequency ratio and 1T command timing, t_ras_min should be tRAS(min)/2 (no rounding up) • 1:2 frequency ratio and 2T command timing or LPDDR4 mode, t_ras_min should be RoundUp(tRAS(min)/2) Programming Mode: Quasi-dynamic Group 2, Group 4                                                                       |

## 36.15.47 DRAM Timing 1 (DRAMTMG1)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG1   | 104h     |

## Diagram

<!-- image -->

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-21 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 20-16 t_xp  | tXP Specifies the minimum time interval, in DFI clock cycles, before any operation after Power DownExit (PDX). Use the following guidelines to determine the correct value: • DDR3: If using slow power down exit (MR0[12]), set to tXPDLL • DDR4: If using C/A parity, set to (tXP + PL) • LPDDR4: If spec has the tCKELPD parameter, set to max(tXP, tCKELPD) When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4 |
| 15-14 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 13-8 rd2pre | Read to precharge minimum interval (tRTP) Specifies the minimum time interval, in DFI clock cycles, between read and precharge to the same bank. Use the following equations to determine the correct value: • DDR2: tAL + BL/2 + max(tRTP, 2) - 2 • DDR3: tAL + max(tRTP,4) • DDR4: Maximum of the following equations: - tAL + max(tRTP,4) - RL + BL/2 - tRP (When DDR4 DRAM and ST-MRAM are used simultaneously, use the DRAM tRP value for calculation.)                                                                         |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                           |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|          | - mDDR: BL/2 - LPDDR2-S2: BL/2 + tRTP - 1 - LPDDR2-S4: BL/2 + max(tRTP,2) - 2 - LPDDR3: BL/2 + max(tRTP,4) - 4 - LPDDR4: BL/2 + max(tRTP,8) - 8 When the MC is operating at: • 1:2 frequency ratio and 1T command timing, divide the above value by 2 (no rounding up). • 1:2 frequency ratio and 2T command timing or LPDDR4, divide the above value by 2 and round up. Programming Mode: Quasi-dynamic Group 1, Group 2, Group 4 |
| 7 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 6-0 t_rc | Same bank activate internal (tRC) Specifies the minimum time interval, in DFI clock cycles, between activates to the same bank. When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4                                                                                                                               |

## 36.15.48 DRAM Timing 2 (DRAMTMG2)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG2   | 108h     |

## Diagram

<!-- image -->

## Fields

| Field               | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|---------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-30 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 29-24 write_latency | Write latency Specifies the time interval, in DFI clock cycles, from a write command to write data on the DRAM interface. You must set this to WL (write latency). When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. • This field does not apply to DDR2 and DDR3 (unless MEMC_TRAINING is set), because the DFI read and write latencies defined in DFITMG0 and DFITMG1 are sufficient for those protocols. • For all protocols, you must also program DFITMG0 and DFITMG1 to control the read and write latencies. NOTE                                                       |
| 23-22 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 21-16 read_latency  | Read Latency Specifies the time interval, in DFI clock cycles, from a read command to read data on the DRAM interface. You must set this to RL (read latency). When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. • This field does not apply to DDR2 and DDR3 (unless MEMC_TRAINING is set), because the DFI read and write latencies defined in DFITMG0 and DFITMG1 are sufficient for those protocols. • For all protocols, you must also program DFITMG0 and DFITMG1 to control the read and write latencies. NOTE Programming Mode: Quasi-dynamic Group 1, Group 2, Group 4 |
| 15-14 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 13-8 rd2wr          | Read To Write Minimum Time Specifies the minimum time interval, in DFI clock cycles, from a read command to a write command. For DDR4, it's the minimum interval from a read command to a write command for the same bank. This interval includes the time for bus turnaround, and all per-bank, per-rank, and global constraints. Use the following equations to determine the correct value:                                                                                                                                                                                                                                                    |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           | • DDR2, DDR3, mDDR: RL + BL/2 + 2 - WL • DDR4: RL + BL/2 + 1 + WR_PREAMBLE - WL • LPDDR2, LPDDR3: RL + BL/2 + RU(tDQSCKmax/tCK) + 1 - WL • LPDDR4 (DQ ODT Disabled): RL + BL/2 + RU(tDQSCKmax/tCK) + WR_PREAMBLE + RD_POSTAMBLE - WL • LPDDR4 (DQ ODT Enabled): RL + BL/2 + RU(tDQSCKmax/tCK) + RD_POSTAMBLE - ODTLon - RU(tODTon(min)/tCK) + 1 Where: • WL is write latency • BL is burst length. Must match the value programmed in the BL bit of the DRAM Mode Register. • RL is read latency (CAS latency) • WR_PREAMBLE is 1 for 1tCK write preamble or 2 for 2tCK write preamble. Unique to DDR4 and LPDDR4. • RD_POSTAMBLE is 0.5 for 0.5tCK read postamble or 1.5 for 1.5tCK read postamble. This is unique to LPDDR4. For LPDDR2, LPDDR3, or LPDDR4, if derating is enabled (DERATEEN[derate_enable] is equal to 1), you should use derated tDQSCKmax. When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 1, Group 2, Group 4 |
| 7-6 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 5-0 wr2rd | Write To Read Minimum Time Specifies the minimum time interval, in DFI clock cycles, from a write command to a read command. For DDR4, it's the minimum interval from a write command to a read command for the same bank. This interval includes the time for bus turnaround, recovery times, and all per-bank, per-rank, and global constraints. Use the following equations to determine the correct value: • DDR4: CWL + PL + BL/2 + tWTR_L • LPDDR2, LPDDR3, LPDDR4: WL + BL/2 + tWTR + 1 • Others: CWL + BL/2 + tWTR Where: • CWL is CAS write latency • WL is write latency • PL is parity latency                                                                                                                                                                                                                                                                                                                                                                                                                                     |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | • BL is burst length. Must match the value programmed in the BL bit of the DRAM Mode Register. • tWTR_L is internal write to read command delay for same bank group (directly from the DRAM specification). For DDR4, if using 2tCK write preamble, increase by one. • tWTR is internal write to read command delay (directly from the DRAM specification). When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 1, Group 2, Group 4 |

## 36.15.49 DRAM Timing 3 (DRAMTMG3)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG3   | 10Ch     |

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-30 - | Reserved                                                                                                                                                                |
| 29-20   | tMRW Specifies the time interval, in DFI clock cycles, to wait after a Mode Register write (MRW) or Mode Register read (MRR) for LPDDR2, LPDDR3, or LPDDR4 DRAM.        |
| t_mrw   | For LPDDR2 DRAM, specifies the time interval from MRW or MRR to all other commands. For LPDDR3 DRAM, specifies the time internal from MRW or MRR to another MRW or MRR. |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           | Depending on the type of DRAM, follow these guidelines: • LPDDR2: typically requires a value of 5 • LPDDR3: typically requires a value of 10 • LPDDR4: Set to the larger of tMRW or TMRWCKEL When the MC is operating at 1:2 frequency ratio, divide value calculated above by 2 and round up to next integer. Programming Mode: Quasi-dynamic Group 2, Group 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 19-18 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 17-12     | tMRD                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| t_mrd     | Specifies the time interval, in DFI clock cycles, to wait after a MR write or read. Depending on the type of DRAM, tMRD is: • DDR2, mDDR: the time from MRS to any command • DDR3, DDR4: the time from MRS command to MRS command • LPDDR2: not used • LPDDR3, LPDDR4: the time from MRS command to non-MRS command Apply the following modifications to tMRD as necessary: • If CAL mode is enabled ( DFITMG1[dfi_t_cmd_lat] > 0): add tCAL • For DDR4: If using C/A parity, use tMRD_PAR(tMOD + PL) instead When the MC is operating at 1:2 frequency ratio, use RoundUp(tMRD/2). Programming Mode: Quasi-dynamic Group 2, Group 4 There could be functional impact in normal operation when MRD timing is less than DFI control delay. Because, the DFI PHY Master acknowledge assertion may occurs while command (MRW) may still be in flight inside PHYand has not yet reached the SDRAM. So, the recommendation is the t_mrd should be greater than the DFI control delay that is t_mrd >= dfi_t_ctrl_delay. NOTE |
| 11-10 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 9-0 t_mod | tMOD Specifies the time interval, in DFI clock cycles, between a load mode (MR) command and a following non-load mode command. This field applies only to DDR3 and DDR4. Apply the following modifications to tMOD as necessary:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | • If CAL mode is enabled ( DFITMG1[dfi_t_cmd_lat] > 0): add tCAL • For DDR4: - If using C/A parity, tMOD_PAR(tMOD + PL) - If using MPR writes, tMOD + AL - If using MPR writes and C/A parity, tMOD_PAR + AL When the MC is operating at 1:1 frequency ratio, use the value calculated above. When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4 |

## 36.15.50 DRAM Timing 4 (DRAMTMG4)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG4   | 110h     |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27    | 26    | 25    | 24    | 23       | 22       | 21       | 20       | 19    | 18    | 17    | 16    |
|--------|----------|----------|----------|----------|-------|-------|-------|-------|----------|----------|----------|----------|-------|-------|-------|-------|
| R W    | Reserved | Reserved | Reserved | t_rcd    | t_rcd | t_rcd | t_rcd | t_rcd | Reserved | Reserved | Reserved | Reserved | t_ccd | t_ccd | t_ccd | t_ccd |
| Reset  | 0        | 0        | 0        | 0        | 0     | 1     | 0     | 1     | 0        | 0        | 0        | 0        | 0     | 1     | 0     | 0     |
| Bits   | 15       | 14       | 13       | 12       | 11    | 10    | 9     | 8     | 7        | 6        | 5        | 4        | 3     | 2     | 1     | 0     |
| R W    | Reserved | Reserved | Reserved | Reserved | t_rrd | t_rrd | t_rrd | t_rrd | Reserved | Reserved | Reserved | t_rp     | t_rp  | t_rp  | t_rp  | t_rp  |
| Reset  | 0        | 0        | 0        | 0        | 0     | 1     | 0     | 0     | 0        | 0        | 0        | 0        | 0     | 1     | 0     | 1     |

## Fields

| Field   | Function                                                                                                           |
|---------|--------------------------------------------------------------------------------------------------------------------|
| 31-29   | Reserved                                                                                                           |
| -       |                                                                                                                    |
| 28-24   | tRCD - tAL                                                                                                         |
| t_rcd   | Specifies the minimum time interval, in DFI clock cycles, from activate to read or write command to the same bank. |

Table continues on the next page...

## Table continued from the previous page...

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|             | When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Theminimumallowedvalueis 1. Therefore, whentheMCisoperating at 1:2 frequency ratio, (tRCD - tAL) must be a minimum of 2. NOTE Programming Mode: Quasi-dynamic Group 1, Group 2, Group 4                                                                                                                       |
| 23-20 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 19-16 t_ccd | tCCD Specifies the minimum time interval, in DFI clock cycles, between two reads or two writes. For DDR4, use tCCD_L, the minimum time interval between two reads or two writes for the same bank group. When the MC is operating at 1:2 frequency ratio, divide the value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4                                                                |
| 15-12 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 11-8 t_rrd  | tRRD Specifies the minimum time interval, in DFI clock cycles, between activates from bank a to bank b. For DDR4, use tRRD_L, the minimum time interval between activates from bank a to bank b for the same bank group. When the MC is operating at 1:2 frequency ratio, divide the value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4                                                |
| 7-5 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 4-0 t_rp    | tRP Specifies the minimum time interval, in DFI clock cycles, from precharge to active on the same bank. When the MC is operating at 1:1 frequency ratio, set to RoundUp(tRP/tCK). When the MC is operating at 1:2 frequency ratio, set to RoundDown(RoundUp(tRP/tCK)/2) + 1. For LPDDR4, when the MC is operating at 1:2 frequency ratio, set to RoundDown(RoundUp(tRP/tCK)/2). Programming Mode: Quasi-dynamic Group 2, Group 4 |

## 36.15.51 DRAM Timing 5 (DRAMTMG5)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG5   | 114h     |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28      | 27      | 26      | 25      | 24      | 23       | 22       | 21       | 20       | 19      | 18      | 17      | 16      |
|--------|----------|----------|----------|---------|---------|---------|---------|---------|----------|----------|----------|----------|---------|---------|---------|---------|
| R W    | Reserved | Reserved | Reserved | t_cksrx | t_cksrx | t_cksrx | t_cksrx | t_cksrx | Reserved | Reserved | Reserved | Reserved | t_cksre | t_cksre | t_cksre | t_cksre |
| Reset  | 0        | 0        | 0        | 0       | 0       | 1       | 0       | 1       | 0        | 0        | 0        | 0        | 0       | 1       | 0       | 1       |
| Bits   | 15       | 14       | 13       | 12      | 11      | 10      | 9       | 8       | 7        | 6        | 5        | 4        | 3       | 2       | 1       | 0       |
| R W    | Reserved | Reserved | t_ckesr  | t_ckesr | t_ckesr | t_ckesr | t_ckesr | t_ckesr | Reserved | Reserved | Reserved | t_cke    | t_cke   | t_cke   | t_cke   | t_cke   |
| Reset  | 0        | 0        | 0        | 0       | 0       | 1       | 0       | 0       | 0        | 0        | 0        | 0        | 0       | 0       | 1       | 1       |

## Fields

| Field         | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 27-24 t_cksrx | tCKSRX Specifies the time interval, in DFI clock cycles, to maintain the clock before the Self Refresh Exit (SRX) command. This is the time that CK is maintained as a valid clock before exiting the Self Refresh state. Depending on the type of DRAM, follow these guidelines: • mDDR: 1 • LPDDR2, LPDDR3: 2 • LPDDR4: tCKCKEH • DDR2: 1 • DDR3, DDR4: tCKSRX When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4 |
| 23-20 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 19-16         | tCKSRE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| t_cksre   | Specifies the time interval, in DFI clock cycles, to delay clock disable after the Self Refresh Entry (SRE) command. This is the time that CK is maintained as a valid clock after entering the Self Refresh state. Depending on the type of DRAM, follow these guidelines: • mDDR: 0 • LPDDR2, LPDDR3: 2 • LPDDR4: tCKELCK • DDR2: 1 • DDR3, DDR4: max (10 ns, 5 tCK) • DDR4 if == 0: max (10 ns, 5 tCK) + PL (where PL is parity latency) When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4 |
| 15-14 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 13-8      | tCKESR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 7-5 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 4-0 t_cke | tCKE Specifies the minimum time interval, in DFI clock cycles, for CKE High/Low during power down and self refresh. Depending on the type of DRAM, follow these guidelines:                                                                                                                                                                                                                                                                                                                                                                                                                                      |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                             |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | • LPDDR2, LPDDR3: set to the larger of tCKE or tCKESR • LPDDR4: Set to the larger of tCKE or tSR • All other types: set to tCKE When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4 |

## 36.15.52 DRAM Timing 6 (DRAMTMG6)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG6   | 118h     |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
|--------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|
| R W    | Reserved | Reserved | Reserved | t_ckdpde | t_ckdpde | t_ckdpde | t_ckdpde | t_ckdpde | Reserved | Reserved | Reserved | Reserved | t_ckdpdx | t_ckdpdx | t_ckdpdx | t_ckdpdx |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 1        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 1        | 0        |
| Bits   | 15       | 14       | 13       | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R W    | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | t_ckcsx  | t_ckcsx  | t_ckcsx  | t_ckcsx  |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 1        | 0        | 1        |

## Fields

| Field    | Function                                                                                                                                                                                                                                                                           |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -  | Reserved                                                                                                                                                                                                                                                                           |
| 27-24    | tCKDPDE                                                                                                                                                                                                                                                                            |
| t_ckdpde | Specifies the time interval, in DFI clock cycles, to delay clock disable after the Deep Power Down Entry (DPDE) command. This is the time that CK is maintained as a valid clock after entering the Deep Power Down state. Depending on the type of DRAM, follow these guidelines: |

Table continues on the next page...

## Table continued from the previous page...

| Field          | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                | • mDDR: 0 • LPDDR2, LPDDR3: 2 • All other types: This field does not apply. When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4                                                                                                                                                                                                                                                                                  |
| 23-20 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 19-16 t_ckdpdx | Specifies the time interval, in DFI clock cycles, to maintain CKasavalid clock before the Deep PowerDown Exit (DPDX) command. This is the clock stable time before exiting the Deep Power Down state. Depending on the type of DRAM, follow these guidelines: • mDDR: 1 • LPDDR2, LPDDR3: 2 • All other types: This field does not apply. When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4                    |
| 15-4 -         | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 3-0 t_ckcsx    | tCKCSX Specifies the time interval, in DFI clock cycles, that CK is maintained as a valid clock before the Clock Stop Exit (CSX) command. This is the clock stable time before the next command after CSX. Depending on the type of DRAM, follow these guidelines: • mDDR: 1 • LPDDR2, LPDDR3, LPDDR4: tXP + 2 • All other types: This field does not apply. When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4 |

## 36.15.53 DRAM Timing 7 (DRAMTMG7)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG7   | 11Ch     |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27      | 26      | 25      | 24       | 23       | 22       | 21       | 20       | 19      | 18      | 17      | 16      |
|--------|----------|----------|----------|----------|---------|---------|---------|----------|----------|----------|----------|----------|---------|---------|---------|---------|
| R W    |          |          |          |          |         |         |         | Reserved |          |          |          |          |         |         |         |         |
| Reset  | 0        | 0        | 0        | 0        | 0       | 0       | 0       | 0        | 0        | 0        | 0        | 0        | 0       | 0       | 0       | 0       |
| Bits   | 15       | 14       | 13       | 12       | 11      | 10      | 9       | 8        | 7        | 6        | 5        | 4        | 3       | 2       | 1       | 0       |
| R W    | Reserved | Reserved | Reserved | Reserved | t_ckpde | t_ckpde | t_ckpde | t_ckpde  | Reserved | Reserved | Reserved | Reserved | t_ckpdx | t_ckpdx | t_ckpdx | t_ckpdx |
| Reset  | 0        | 0        | 0        | 0        | 0       | 0       | 1       | 0        | 0        | 0        | 0        | 0        | 0       | 0       | 1       | 0       |

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-12 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 11-8 t_ckpde | tCKPDEX Specifies the time interval, in DFI clock cycles, to maintain CKafter the Power DownEntry (PDE) command. This is the time before clock disable after entering the Power Down state. Depending on the type of DRAM, follow these guidelines: • mDDR: 0 • LPDDR2, LPDDR3: 2 • LPDDR4: tCKELCK • DDR2, DDR3, DDR4: set to same value as DRAMTMG5[t_cksre] When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4 |
| 7-4 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 3-0 t_ckpdx  | tCKPDX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | Specifies the time interval, in DFI clock cycles, to maintainCKbeforethePowerDownExit(PDX)command. This is the time that CK is maintained as a valid clock before exiting the Power Down state. Depending on the type of DRAM, follow these guidelines: • mDDR: 0 • LPDDR2, LPDDR3: 2 • LPDDR4: tCKCKEH • DDR2, DDR3, DDR4: set to same value as DRAMTMG5[t_cksrx] When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up to the next integer. Programming Mode: Quasi-dynamic Group 2, Group 4 |

## 36.15.54 DRAM Timing 8 (DRAMTMG8)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG8   | 120h     |

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                      |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31      | Reserved                                                                                                                                                                                      |
| 30-24   | tXS_FAST: Exit Self Refresh to ZQCL, ZQCS and MRS (only CL, WR, RTP and Geardown mode). When the controller is operating in 1:2 frequency ratio mode, program this to the above value divided |

Table continues on the next page...

## Table continued from the previous page...

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| t_xs_fast_x32        | by 2 and round up to next integer value. Note: This is applicable to only ZQCL/ZQCS commands. Note: Ensure this is less than or equal to t_xs_x32. Unit: Multiples of 32 DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4                                                                                                                                             |
| 23 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                |
| 22-16 t_xs_abort_x32 | tXS_ABORT: Exit Self Refresh to commands not requiring a locked DLL in Self Refresh Abort. When the controller is operating in 1:2 frequency ratio mode, program this to the above value divided by 2 and round up to next integer value. Note: Ensure this is less than or equal to t_xs_x32. Unit: Multiples of 32 DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4 |
| 15 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                |
| 14-8 t_xs_dll_x32    | tXSDLL: Exit Self Refresh to commands requiring a locked DLL. When the controller is operating in 1:2 frequency ratio mode, program this to the above value divided by 2 and round up to next integer value. Note: Used only for DDR2, DDR3 and DDR4 SDRAMs. Unit: Multiples of 32 DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4                                   |
| 7 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                |
| 6-0 t_xs_x32         | tXS: Exit Self Refresh to commands not requiring a locked DLL. When the controller is operating in 1:2 frequency ratio mode, program this to the above value divided by 2 and round up to next integer value. Note: Used only for DDR2, DDR3 and DDR4 SDRAMs. Unit: Multiples of 32 DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4                                  |

## 36.15.55 DRAM Timing 9 (DRAMTMG9)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG9   | 124h     |

## Diagram

<!-- image -->

## Fields

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 30 ddr4_wr_pream ble | DDR4 Write preamble mode - 0: 1tCK preamble - 1: 2tCK preamble Present only with MEMC_FREQ_RATIO=2 Programming Mode: Quasi-dynamic Group 2, Group 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 29-19 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 18-16 t_ccd_s        | tCCD_S: This is the minimum time between two reads or two writes for different bank group. For bank switching (from bank "a" to bank "b"), the minimum time is this value + 1. When the controller is operating in 1:2 frequency ratio mode, program this to (tCCD_S/2) and round it up to the next integer value. Present only in designs configured to support DDR4. Unit: DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4                                                                                                                                                                                                                                                                                                                                                                                                           |
| 15-12 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 11-8 t_rrd_s         | tRRD_S: Minimum time between activates from bank "a" to bank "b" for different bank group. When the controller is operating in 1:2 frequency ratio mode, program this to (tRRD_S/2) and round it up to the next integer value. Present only in designs configured to support DDR4. Unit: DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 7-6 -                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 5-0 wr2rd_s          | CWL + PL + BL/2 + tWTR_S Minimum time from write command to read command for different bank group. Includes time for bus turnaround, recovery times, and all per-bank, per-rank, and global constraints. Present only in designs configured to support DDR4. Where: - CWL = CAS write latency - PL = Parity latency - BL = burst length. This must match the value programmed in the BL bit of the mode register to the DRAM - tWTR_S = internal write to read command delay for different bank group. This comes directly from the DRAM specification. WTR_S should be increased by one if DDR4 2tCK write preamble is used. When the controller is operating in 1:2 mode, divide the value calculated using the above equation by 2, and round it up to next integer. Unit: DFI clock cycles. Programming Mode: Quasi-dynamic Group 1, Group 2, Group 4 |

## 36.15.56 DRAM Timing 10 (DRAMTMG10)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG10  | 128h     |

## Diagram

<!-- image -->

## Fields

| Field             | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-21 -           | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 20-16 t_sync_gear | Indicates the time between MRS command and the sync pulse time. This must be even number of clocks. For DDR4-2666 and DDR4-3200, this parameter is defined as tMOD(min)+4nCK tMOD(min) is greater of 24nCK or 15ns 15ns / .625ns = 24 Max value for this register is 24+4 = 28 When the controller is operating in 1:2 mode, program this to (tSYNC_GEAR/2) and round it up to the next integer value. Unit: DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4 |
| 15-13 -           | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 12-8 t_cmd_gear   | Sync pulse to first valid command. For DDR4-2666 and DDR4-3200, this parameter is defined as tMOD(min) tMOD(min) is greater of 24nCK or 15ns 15ns / .625ns = 24 Max value for this register is 24 When the controller is operating in 1:2 mode, program this to (tCMD_GEAR/2) and round it up to the next integer value. Unit: DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4                                                                               |
| 7-4 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 3-2 t_gear_setup  | Geardown setup time. Minimum value of this register is 1. Zero is invalid. For DDR4-2666 and DDR4-3200, this parameter is defined as 2 clks When the controller is operating in 1:2 frequency ratio mode, program this to (tGEAR_setup/2) and round it up to the next integer value. Unit: DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4                                                                                                                   |
| 1-0 t_gear_hold   | Geardown hold time. Minimum value of this register is 1. Zero is invalid. For DDR4-2666 and DDR4-3200, this parameter is defined as 2 clks When the controller is operating in 1:2 frequency ratio mode, program this to (tGEAR_hold/2) and round it up to the next integer value. Unit: DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4                                                                                                                     |

DDR Subsystem

## 36.15.57 DRAM Timing 11 (DRAMTMG11)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG11  | 12Ch     |

## Diagram

<!-- image -->

## Fields

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                     |
|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 -                     | Reserved                                                                                                                                                                                                                                                                                                                                                     |
| 30-24 post_mpsm_ga p_x32 | tXMPDLL: This is the minimum Exit MPSM to commands requiring a locked DLL. When the controller is operating in 1:2 frequency ratio mode, program this to (tXMPDLL/2) and round it up to the next integer value. Present only in designs configured to support DDR4. Unit: Multiples of 32 DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4 |
| 23-21 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                     |
| 20-16 t_mpx_lh           | tMPX_LH: This is the minimum CS_n Low hold time to CKE rising edge. When the controller is operating in 1:2 frequency ratio mode, program this to RoundUp(tMPX_LH/2)+1. Present only in designs configured to support DDR4. Unit: DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4                                                         |
| 15-10 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                     |
| 9-8 t_mpx_s              | tMPX_S: Minimum time CS setup time to CKE. When the controller is operating in 1:2 frequency ratio mode, program this to (tMPX_S/2) and round it up to the next integer value. Present only in designs configured to support DDR4. Unit: DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4                                                  |
| 7-5                      | Reserved                                                                                                                                                                                                                                                                                                                                                     |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field       | Function                                                                                                                                                                                                                                                                                                                                         |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -           |                                                                                                                                                                                                                                                                                                                                                  |
| 4-0 t_ckmpe | tCKMPE: Minimum valid clock requirement after MPSM entry. Present only in designs configured to support DDR4. When the controller is operating in 1:2 frequency ratio mode, divide the value calculated using the above equation by 2, and round it up to next integer. Unit: DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4 |

## 36.15.58 DRAM Timing 12 (DRAMTMG12)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG12  | 130h     |

<!-- image -->

## Fields

| Field          | Function                                                                                                                                                                                                                                                     |
|----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-18 -        | Reserved                                                                                                                                                                                                                                                     |
| 17-16 t_cmdcke | tCMDCKE Specifies the time interval, in DFI clock cycles, for the delay between a valid command and CKE input low. When the MC is operating at 1:2 frequency ratio, set to RoundUp(max(tESCKE, tCMDCKE)/2). Programming Mode: Quasi-dynamic Group 2, Group 4 |
| 15-5 -         | Reserved                                                                                                                                                                                                                                                     |

Table continues on the next page...

Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                              |
|-----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 4-0       | tMRD_PDA                                                                                                                                                                                                                              |
| t_mrd_pda | Specifies the time interval, in DFI clock cycles, for Mode Register Set command cycle time in PDA mode. When the MC is operating at 1:2 frequency ratio, set to RoundUp(tMRD_PDA/2). Programming Mode: Quasi-dynamic Group 2, Group 4 |

## 36.15.59 DRAM Timing 13 (DRAMTMG13)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG13  | 134h     |

## Function

This register applies only to LPDDR4 DRAM.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                             |
|---------|------------------------------------------------------------------------------------------------------|
| 31      | Reserved                                                                                             |
| -       |                                                                                                      |
| 30-24   | tODTLoff                                                                                             |
| odtloff | Specifies the time interval (latency), in DFI clock cycles, from CAS-2 command to tODToff reference. |
|         | When the MC is operating at 1:2 frequency ratio, set to RoundUp(tODTLoff/2).                         |
|         | Programming Mode: Quasi-dynamic Group 2, Group 4                                                     |

Table continues on the next page...

## Table continued from the previous page...

| Field          | Function                                                                                                                                                                                                                                                                   |
|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 23-22 -        | Reserved                                                                                                                                                                                                                                                                   |
| 21-16 t_ccd_mw | tCCDMW Specifies the minimum time interval, in DFI clock cycles, from write or masked write command to masked write command for the same bank. When the MC is operating at 1:2 frequency ratio, set to RoundUp(tCCDMW/2). Programming Mode: Quasi-dynamic Group 2, Group 4 |
| 15-3 -         | Reserved                                                                                                                                                                                                                                                                   |
| 2-0 t_ppd      | tPPD Specifies the minimum time interval, in DFI clock cycles, from precharge command to precharge command. When the MC is operating at 1:2 frequency ratio, set to RoundUp(tPPD/2). Programming Mode: Quasi-dynamic Group 2, Group 4                                      |

## 36.15.60 DRAM Timing 14 (DRAMTMG14)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG14  | 138h     |

## Function

This register applies only to mDDR, LPDDR2, LPDDR3, and LPDDR4 DRAM.

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27    | 26    | 25    | 24       | 23    | 22    | 21    | 20    | 19    | 18    | 17    | 16    |
|--------|----------|----------|----------|----------|-------|-------|-------|----------|-------|-------|-------|-------|-------|-------|-------|-------|
| R W    |          |          |          |          |       |       |       | Reserved |       |       |       |       |       |       |       |       |
| Reset  | 0        | 0        | 0        | 0        | 0     | 0     | 0     | 0        | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     |
| Bits   | 15       | 14       | 13       | 12       | 11    | 10    | 9     | 8        | 7     | 6     | 5     | 4     | 3     | 2     | 1     | 0     |
| R W    | Reserved | Reserved | Reserved | Reserved | t_xsr | t_xsr | t_xsr | t_xsr    | t_xsr | t_xsr | t_xsr | t_xsr | t_xsr | t_xsr | t_xsr | t_xsr |
| Reset  | 0        | 0        | 0        | 0        | 0     | 0     | 0     | 0        | 1     | 0     | 1     | 0     | 0     | 0     | 0     | 0     |

## Fields

| Field      | Function                                                                                                                                                                                                                                               |
|------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-12 -    | Reserved                                                                                                                                                                                                                                               |
| 11-0 t_xsr | tXSR Specifies the time interval, in DFI clock cycles, from exiting the Self Refresh state to any command. When the MC is operating at 1:2 frequency ratio, divide the calculated value and round up. Programming Mode: Quasi-dynamic Group 2, Group 4 |

## 36.15.61 DRAM Timing 15 (DRAMTMG15)

## Offset

| Register   | Offset   |
|------------|----------|
| DRAMTMG15  | 13Ch     |

<!-- image -->

## Fields

| Field               | Function                                                                                                                                                                                                                                                                                                        |
|---------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 en_dfi_lp_t_stab | - 1 - Enable using tSTAB when exiting DFI LP. Needs to be set when the PHY is stopping the clock during DFI LP to save maximum power. - 0 - Disable using tSTAB when exiting DFI LP Programming Mode: Quasi-dynamic Group 2, Group 4                                                                            |
| 30-8 -              | Reserved                                                                                                                                                                                                                                                                                                        |
| 7-0 t_stab_x32      | tSTAB: Stabilization time. It is required in the following two cases for DDR3/DDR4 RDIMM : - when exiting power saving mode, if the clock was stopped, after re-enabling it the clock must be stable for a time specified by tSTAB - in the case of input clock frequency change (DDR4) - after issuing control |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                               |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | words that refers to clock timing (Specification: 6us for DDR3, 5us for DDR4) When the controller is operating in 1:2 frequency ratio mode, program this to recommended value divided by two and round it up to next integer. Unit: Multiples of 32 DFI clock cycles. Programming Mode: Quasi-dynamic Group 2, Group 4 |

## 36.15.62 ZQ Control 0 (ZQCTL0)

## Offset

| Register   | Offset   |
|------------|----------|
| ZQCTL0     | 180h     |

## Function

This register applies only to DDR3, DDR4, LPDDR2, LPDDR3, and LPDDR4 DRAM.

## Diagram

<!-- image -->

## Fields

|   Field | Function                                   |
|---------|--------------------------------------------|
|      31 | Disable automatic ZQCS&#124;MPC            |
|      30 | Disable ZQCL&#124;MPC on SR&#124;SRPD exit |

Table continues on the next page...

## Table continued from the previous page...

| Field                  | Function                                                                                                                                                                                                                                                                                                                                                                                        |
|------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| dis_srx_zqcl           | Disables the issuing of the ZQ calibration (ZQCL&#124;MPC) command on exit from the Self Refresh or Self Refresh Power Down modes. Programming Mode: Quasi-dynamic Group 2, Group 4 0b - Enable 1b - Disable                                                                                                                                                                                    |
| 29 zq_resistor_sha red | Shared ZQ resistor Specifies whether to share the ZQ resistor between ranks. If the ZQ resistor is shared, then the MC sends ZQ calibration commands (ZQinit &#124; ZQCL &#124; ZQCS &#124; MPC) to one rank at a time with the necessary time interval (tZQinit &#124; tZQCL &#124; tZQCS &#124; tZQCAL &#124; tZQLAT) to prevent overlap. Programming Mode: Static 0b - No shared 1b - Shared |
| 28 dis_mpsmx_zqc l     | Disable ZQCL on MPSM exit Disables the issuing of the ZQ calibration long (ZQCL) command on exit from Maximum Power Saving Mode (MPSM). This field applies only to DDR4 DRAM. If Shared AC mode is enabled (UMCTL2_SHARED_AC == 1), write 1 to this field. Software can send ZQCS after exiting MPSM. NOTE Programming Mode: Static 0b - Enable                                                 |
| 27 -                   | Reserved                                                                                                                                                                                                                                                                                                                                                                                        |
| 26-16 t_zq_long_nop    | tZQoper (DDR3, DDR4) &#124; tZQCL (LPDDR2, LPDDR3) &#124; tZQCAL (LPDDR4) Specifies the time interval, in DFI clock cycles, of NOP required after issuing a ZQ calibration long (ZQCL) or ZQ start (MPC) command to the DRAM. When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up. Programming Mode: Static                                          |
| 15-10 -                | Reserved                                                                                                                                                                                                                                                                                                                                                                                        |
| 9-0 t_zq_short_nop     | tZQCS (DDR3, DDR4, LPDDR2, LPDDR3) &#124; tZQLAT (LPDDR4) Specifies the time interval, in DFI clock cycles, of NOPrequired after issuing a ZQ calibration short (ZQCS) or a ZQ Latch (MPC) command to the DRAM.                                                                                                                                                                                 |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                 |
|---------|--------------------------------------------------------------------------------------------------------------------------|
|         | When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up. Programming Mode: Static |

## 36.15.63 ZQ Control 1 (ZQCTL1)

## Offset

| Register   | Offset   |
|------------|----------|
| ZQCTL1     | 184h     |

<!-- image -->

## Fields

| Field                           | Function                                                                                                                                                                                                                                                                                                                       |
|---------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-30 -                         | Reserved                                                                                                                                                                                                                                                                                                                       |
| 29-20 t_zq_reset_nop            | ZQreset NOP Specifies the time interval, in DFI clock cycles, of NOPrequired after issuing aZQcalibration reset (ZQreset) command to DRAM. When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up. This field applies only to LPDDR2, LPDDR3, or LPDDR4 DRAM. Programming Mode: Static |
| 19-0 t_zq_short_inter val_x1024 | ZQ calibration short interval Specifies the average time interval, in multiples of 1024 DFI clock cycles, between automatic ZQ calibration (ZQCS &#124; MPC) commands. This field is ignored if automatic ZQ calibration is disabled (ZQCTL0[dis_auto_zq] == 1).                                                               |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                        |
|---------|-------------------------------------------------------------------------------------------------|
|         | This field applies only to DDR3, DDR4, LPDDR2, LPDDR3, or LPDDR4 DRAM. Programming Mode: Static |

## 36.15.64 ZQ Control 2 (ZQCTL2)

## Offset

| Register   | Offset   |
|------------|----------|
| ZQCTL2     | 188h     |

<!-- image -->

## Fields

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-1       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 0 zq_reset | Setting this register bit to 1 triggers a ZQ Reset operation. When the ZQ Reset operation is complete, the uMCTL2 automatically clears this bit. It is recommended NOT to set this register bit if in Init, in Self-Refresh(except LPDDR4) or SR-Powerdown(LPDDR4) or Deep power-down operating modes. For Self-Refresh(except LPDDR4) or SR-Powerdown(LPDDR4) it will be scheduled after SR(except LPDDR4) or SPRD(LPDDR4) has been exited. For Deep power down, it will not be scheduled, although ZQSTAT.zq_reset_busy will be de-asserted. This is only present for designs supporting LPDDR2/ LPDDR3/LPDDR4 devices. Programming Mode: Dynamic |

## 36.15.65 ZQ Status (ZQSTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| ZQSTAT     | 18Ch     |

## Diagram

<!-- image -->

## Fields

| Field           | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-1 -          | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 0 zq_reset_busy | SoC core may initiate a ZQ Reset operation only if this signal is low. This signal goes high in the clock after the uMCTL2 accepts the ZQ Reset request. It goes low when the ZQ Reset command is issued to the DRAM and the associated NOP period is over. It is recommended not to perform ZQ Reset commands when this signal is high. - 0 - Indicates that the SoC core can initiate a ZQ Reset operation - 1 - Indicates that ZQ Reset operation is in progress Programming Mode: Dynamic |

## 36.15.66 DFI Timing 0 (DFITMG0)

## Offset

| Register   | Offset   |
|------------|----------|
| DFITMG0    | 190h     |

DDR Subsystem

## Diagram

<!-- image -->

## Fields

| Field                          | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|--------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-29 -                        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 28-24 dfi_t_ctrl_delay         | DFI control delay Specifies the time interval, in DFI clock cycles, between assertion or deassertion of the DFI control signals and the reflection of those control signals at the PHY-DRAMinterface. If the DFI clock and the memoryclock are not phase-aligned, round this timing parameter up to the next integer. Programming Mode: Quasi-dynamic Group 4 If using RDIMM or LRDIMM, you must increment this value for an extra cycle of latency. NOTE |
| 23 dfi_rddata_use_ dfi_phy_clk | DFI or DFI PHY clock for read control Selects whether dfi_t_rddata_en represents DFI clock (HDR) or DFI PHY clock (SDR) cycles. Determines whether the MC generates the dfi_rddata_en, dfi_rddata, and dfi_rddata_valid signals based on the DFI clock (HDR) or the DFI PHY clock (SDR). Refer to the PHY specification for the correct value. Programming Mode: Static 0b - DFI clock (HDR) 1b - DFI PHY clock (SDR)                                     |
| 22-16 dfi_t_rddata_en          | Time to read data enable Specifies the time interval, in DFI or DFI PHY clock cycles ( DFITMG0[dfi_wrdata_use_dfi_phy_clk]), from the assertion of a read commandontheDFIinterface to the assertion of the dfi_rddata_en signal. This value corresponds to the trddata_en DFI parameter. Refer to the PHY specification for the correct value. Programming Mode: Quasi-dynamic Group 1, Group 4                                                           |
| 15                             | DFI or DFI PHY clock for write control                                                                                                                                                                                                                                                                                                                                                                                                                    |

Table continues on the next page...

## Table continued from the previous page...

| Field                       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|-----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| dfi_wrdata_use_ dfi_phy_clk | Selects whether dfi_tphy_wrlat and dfi_tphy_wrdata represent DFI clock (HDR) or DFI PHY clock (SDR) cycles. Determines whether the MCgenerates the dfi_wrdata_en, dfi_wrdata, and dfi_wrdata_mask signals based on the DFI clock (HDR) or the DFI PHY clock (SDR). Refer to the PHY specification for the correct value. Programming Mode: Static 0b - DFI clock (HDR) 1b - DFI PHY clock (SDR)                                                                                                                                                                                                                                                                                                                     |
| 14 -                        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 13-8 dfi_tphy_wrdata        | Write data driven Specifies the time interval, in DFI or DFI PHY clock cycles ( DFITMG0[dfi_wrdata_use_dfi_phy_clk]), between assertion of dfi_wrdata_en to the driving of the associated write data on the dfi_wrdata_en signal. This value corresponds to the tphy_wrdata DFI timing parameter. See the PHY specification for the correct value. The maximum supported value is 8. NOTE Updating DFITMG0[dfi_tphy_wrlat] or DFITMG0[dfi_wrdata_use_dfi_phy_clk] as part of a frequency change procedure may cause metastability and/or glitches in the dfi_phyupd_ack and dfi_ctrlupd_req signals. To avoid these problems, do this: 1. Write 1b to DFIUPD0[dis_auto_ctrlupd]. 2. Disable the PHY-Update request. |
| 7-6 -                       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 5-0 dfi_tphy_wrlat          | Write latency Specifies the time interval, in DFI or DFI PHYclock cycles DFITMG0[dfi_wrdata_use_dfi_phy_clk], from the write command to write data enable (dfi_wrdata_en). This value corresponds to the tphy_wrlat DFI timing parameter. See the PHY specification for the correct value. LPDDR4 does not support values greater than 60. NOTE Updating DFITMG0[dfi_tphy_wrlat] or DFITMG0[dfi_wrdata_use_dfi_phy_clk] as part of a frequency change procedure may cause metastability and/or glitches in the dfi_phyupd_ack and dfi_ctrlupd_req signals. To avoid these problems, do this: 1. Write 1'b1 to DFIUPD0[dis_auto_ctrlupd].                                                                            |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                            |
|---------|-------------------------------------------------------------------------------------|
|         | 2. Disable the PHY-Update request. Programming mode: Quasi-dynamic Group 1, Group 4 |

## 36.15.67 DFI Timing 1 (DFITMG1)

## Offset

| Register   | Offset   |
|------------|----------|
| DFITMG1    | 194h     |

## Diagram

<!-- image -->

## Fields

| Field                 | Function                                                                                                                                                                                                                                                                                                                                                                                             |
|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 dfi_t_cmd_lat   | Command latency Specifies the time interval (latency), in DFI PHY clock cycles, between assertion of the dfi_cs signal and driving of the associated command in CAL mode. The valid range for this value is 0 to 8. This value corresponds to the tCAL parameter. If using PHY CAL mode, set this field to 0. This field applies only to DDR4 DRAM. Programming Mode: Quasi-dynamic Group 2, Group 4 |
| 27-26 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                             |
| 25-24 dfi_t_parin_lat | Parity in latency                                                                                                                                                                                                                                                                                                                                                                                    |

Table continues on the next page...

## Table continued from the previous page...

| Field                        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                              | Specifies the time interval, in DFI PHYclock cycles, between assertion of the dfi_cs signal and driving of the associated dfi_parity_in signal. Programming Mode: Quasi-dynamic Group 4                                                                                                                                                                                                                                                                                                                                              |
| 23-21 -                      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 20-16 dfi_t_wrdata_del ay    | Write delay Specifies the time interval, in DFI clock cycles, between assertion of dfi_wrdata_en and completion of the corresponding write data transfer on the DRAM bus. This value corresponds to the twrdata_delay DFI timing parameter. Refer to the PHY specification for the correct value. When the MC is operating at 1:2 frequency ratio, divide the calculated value by 2 and round up. • If using the DFI PHYclock(DFITMG0[dfi_wrdata_use_dfi_phy_clk]), add 1 to the value. NOTE Programming Mode: Quasi-dynamic Group 4 |
| 15-13 -                      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 12-8 dfi_t_dram_clk_ disable | DRAM clock disable latency Specifies the time interval (latency), in DFI clock cycles, from assertion of the dfi_dram_clk_disable signal on the DFI until the clock to the DRAMmemorydevicesatthePHY-DRAMinterfacemaintainsalowvalue.If the DFI clock and the memory clock are not phase-aligned, round this timing parameter up to the next integer. Programming Mode: Quasi-dynamic Group 4                                                                                                                                        |
| 7-5 -                        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 4-0 dfi_t_dram_clk_ enable   | DRAM clock enable latency Specifies the time interval (latency), in DFI clock cycles, from deassertion of the dfi_dram_clk_disable signal on the DFI until the first valid rising edge of the clock to the DRAM memory devices at the PHY-DRAM interface. If the DFI clock and the memory clock are not phase-aligned, round this timing parameter up to the next integer. Programming Mode: Quasi-dynamic Group 4                                                                                                                   |

## 36.15.68 DFI Low Power Configuration 0 (DFILPCFG0)

## Offset

| Register   | Offset   |
|------------|----------|
| DFILPCFG0  | 198h     |

## Diagram

<!-- image -->

## Fields

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|--------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-29 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 28-24 dfi_tlp_resp       | Setting in DFI clock cycles for DFI's tlp_resp time. Same value is used for both Power Down, Self Refresh, Deep Power Down and Maximum Power Saving modes. DFI 2.1 specification onwards, recommends using a fixed value of 7 always. Unit: DFI clock cycles. Programming Mode: Static                                                                                                                                                                                                                                                                                                         |
| 23-20 dfi_lp_wakeup_ dpd | Value in DFI clock cycles to drive on dfi_lp_wakeup signal when Deep Power Down mode is entered. Determines the DFI's tlp_wakeup time: - 0x0 - 16 cycles - 0x1 - 32 cycles - 0x2 - 64 cycles - 0x3 - 128 cycles - 0x4 - 256 cycles - 0x5 - 512 cycles - 0x6 - 1024 cycles - 0x7 - 2048 cycles - 0x8 - 4096 cycles - 0x9 - 8192 cycles - 0xA - 16384 cycles - 0xB - 32768 cycles - 0xC - 65536 cycles - 0xD - 131072 cycles - 0xE - 262144 cycles - 0xF - Unlimited This is only present for designs supporting mDDR or LPDDR2/LPDDR3 devices. Unit: DFI clock cycles. Programming Mode: Static |
| 19-17 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 16 dfi_lp_en_dpd         | Enables DFI Low Power interface handshaking during Deep Power Down Entry/Exit. - 0 - Disabled - 1 - Enabled This is only present for designs supporting mDDR or LPDDR2/LPDDR3 devices. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                |
| 15-12 dfi_lp_wakeup_ sr  | Value in DFI clock cycles to drive on dfi_lp_wakeup signal when Self Refresh mode is entered. Determines the DFI's tlp_wakeup time: - 0x0 - 16 cycles - 0x1 - 32 cycles - 0x2 - 64 cycles - 0x3 - 128 cycles - 0x4 - 256 cycles - 0x5 - 512 cycles - 0x6 - 1024 cycles - 0x7 - 2048 cycles - 0x8 - 4096 cycles - 0x9 - 8192 cycles - 0xA - 16384 cycles - 0xB - 32768 cycles - 0xC - 65536 cycles - 0xD - 131072 cycles - 0xE - 262144 cycles - 0xF - Unlimited Unit: DFI clock cycles. Programming Mode: Static                                                                               |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field                 | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 11-9 -                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 8 dfi_lp_en_sr        | Enables DFI Low Power interface handshaking during Self Refresh Entry/Exit. - 0 - Disabled - 1 - Enabled Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                              |
| 7-4 dfi_lp_wakeup_ pd | Value in DFI clock cycles to drive on dfi_lp_wakeup signal when Power Down mode is entered. Determines the DFI's tlp_wakeup time: - 0x0 - 16 cycles - 0x1 - 32 cycles - 0x2 - 64 cycles - 0x3 - 128 cycles - 0x4 - 256 cycles - 0x5 - 512 cycles - 0x6 - 1024 cycles - 0x7 - 2048 cycles - 0x8 - 4096 cycles - 0x9 - 8192 cycles - 0xA - 16384 cycles - 0xB - 32768 cycles - 0xC - 65536 cycles - 0xD - 131072 cycles - 0xE - 262144 cycles - 0xF - Unlimited Unit: DFI clock cycles. Programming Mode: Static |
| 3-1 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 0 dfi_lp_en_pd        | Enables DFI Low Power interface handshaking during Power Down Entry/Exit. - 0 - Disabled - 1 - Enabled Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                |

## 36.15.69 DFI Low Power Configuration 1 (DFILPCFG1)

## Offset

| Register   | Offset   |
|------------|----------|
| DFILPCFG1  | 19Ch     |

## Diagram

<!-- image -->

## Fields

| Field                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-8 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 7-4 dfi_lp_wakeup_ mpsm | Value in DFI clock cycles to drive on dfi_lp_wakeup signal when Maximum Power Saving Mode is entered. Determines the DFI's tlp_wakeup time: - 0x0 - 16 cycles - 0x1 - 32 cycles - 0x2 - 64 cycles - 0x3 - 128 cycles - 0x4 - 256 cycles - 0x5 - 512 cycles - 0x6 - 1024 cycles - 0x7 - 2048 cycles - 0x8 - 4096 cycles - 0x9 - 8192 cycles - 0xA - 16384 cycles - 0xB - 32768 cycles - 0xC - 65536 cycles - 0xD - 131072 cycles - 0xE - 262144 cycles - 0xF - Unlimited This is only present for designs supporting DDR4 devices. Unit: DFI clock cycles. Programming Mode: Static |
| 3-1 -                   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 0 dfi_lp_en_mpsm        | Enables DFI Low Power interface handshaking during Maximum Power Saving Mode Entry/Exit. - 0 - Disabled - 1 - Enabled This is only present for designs supporting DDR4 devices. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                           |

## 36.15.70 DFI Update 0 (DFIUPD0)

## Offset

| Register   | Offset   |
|------------|----------|
| DFIUPD0    | 1A0h     |

## Diagram

<!-- image -->

## Fields

| Field            | Function                         |
|------------------|----------------------------------|
| 31               | Disable automatic update request |
| dis_auto_ctrlupd |                                  |

Table continues on the next page...

## Table continued from the previous page...

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                   |
|--------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 30 dis_auto_ctrlupd _srx | Disables automatic MC generation of the update request. When disabled, the core must issue the update request (DBGCMD[ctrlupd]). Programming Mode: Quasi-dynamic Group 2 0b - Enable 1b - Disable Disable automatic update request on SRX Disables automatic MC generation of the update request on exit from Self Refresh state. Programming Mode: Static |
| 29 ctrlupd_pre_srx       | Update request on SRX Specifies whether the MC sends an update request before or after existing the Self Refresh state. If automatic update on Self Refresh exit is disabled (dis_auto_ctrlupd_srx == 1), this field has no effect. Programming Mode: Static 0b - After 1b - After                                                                         |
| 28-26 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                   |
| 25-16 dfi_t_ctrlup_max   | Maximum update request time Specifies the maximumtimeinterval, in DFI clock cycles, that the MCcontroller can assert the udate request (dfi_ctrlupd_req) signal.                                                                                                                                                                                           |
| 15-10                    | Programming Mode: Static Reserved                                                                                                                                                                                                                                                                                                                          |
| -                        |                                                                                                                                                                                                                                                                                                                                                            |

## 36.15.71 DFI Update 1 (DFIUPD1)

## Offset

| Register   | Offset   |
|------------|----------|
| DFIUPD1    | 1A4h     |

## Diagram

<!-- image -->

## Fields

| Field                                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 -                                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 23-16 dfi_t_ctrlupd_int erval_min_x102 4 | Minimum update interval Specifies the minimum time interval, in multiples of 1024 DFI clock cycles, between MC-initiated DFI update requests (generated when the MC is idle). This timer resets with each update request; when the timer expires, the MC sends an update request (dfi_ctrlupd_req) and blocks traffic until it receives the update acknowledgement (dfi_ctrlupd_ackx). Set this value higher to reduce the frequency of update requests, which can have a small impact on the latency of the first read request when the MC is idle. The minimum allowed value is 1. The value must be less than the value in dfi_t_ctrlupd_interval_max_x1024. NOTE Programming Mode: Static |
| 15-8 -                                   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 7-0                                      | Maximum update interval                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

Table continues on the next page...

Table continued from the previous page...

| Field                              | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| dfi_t_ctrlupd_int erval_max_x102 4 | Specifies the maximumtimeinterval, in multiples of 1024 DFI clock cycles, between MC-initiated DFI update requests (generated when the MC is idle). This timer resets with each update request; when the timer expires, the MC sends an update request (dfi_ctrlupd_req) and blocks traffic until it receives the update acknowledgement (dfi_ctrlupd_ackx). PHYcanusethis idle time to recalibrate the delay lines to the DLLs. It can also use the time to resetthePHY FIFO counters in the event of data capture errors. Updates are needed to maintain calibration over PVT, but frequent updates may impact performance. The minimum allowed value is 1. The value must be greater than the value in dfi_t_ctrlupd_interval_min_x1024. NOTE Programming Mode: Static |

## 36.15.72 DFI Update 2 (DFIUPD2)

## Offset

| Register   | Offset   |
|------------|----------|
| DFIUPD2    | 1A8h     |

## Diagram

<!-- image -->

## Fields

| Field         | Function                                                              |
|---------------|-----------------------------------------------------------------------|
| 31            | PHY update acknowledge enable                                         |
| dfi_phyupd_en | Enables support for acknowledgement of PHY-initiated udpate requests. |
|               | Programming Mode: Static                                              |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                 |
|---------|--------------------------|
|         | 0b - Disable 1b - Enable |
| 30-0 -  | Reserved                 |

## 36.15.73 DFI Miscellaneous Control (DFIMISC)

## Offset

| Register   | Offset   |
|------------|----------|
| DFIMISC    | 1B0h     |

<!-- image -->

## Fields

| Field              | Function                                                                                                                                                                                                               |
|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-13 -            | Reserved                                                                                                                                                                                                               |
| 12-8 dfi_frequency | Operating frequency Specifies the operating frequency of the system. The PHYdefines the number of supported frequencies and the mapping of signal values to clock frequencies. Programming Mode: Quasi-dynamic Group 1 |
| 7 -                | Reserved                                                                                                                                                                                                               |

Table continues on the next page...

## Table continued from the previous page...

| Field                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 6 dis_dyn_adr_tri       | Disable Dynamic Tristating Disables PHY-specific Dynamic Tristating. If Dynamic Tristating is enabled, the MCissues a special IDLE command on the DFI while dfi_cs is inactive. If the PHY detects the special IDLE command, it makes the command/address bus high impedance (Hi-Z). Dynamic Tristating works only if the MC is operating at 1:2 frequency ratio, regardless of MSTR[en_2t_timing_mode]. Therefore, it does not work if either of the following conditions is true: • MEMC_FREQ_RATIO == 1 • MEMC_PROG_FREQ_RATIO == 1 AND MSTR[frequency_ratio] == 1 The special IDLE command means the following codes with the case where all the dfi_cs is 1: • (phase 0 and 1) dfi_ras_n=1 • (phase 0 and 1) dfi_cas_n= 1 • (phase 0 and 1) dfi_we_n= 1 • (phase 0 and 1) dfi_bank [0]= 0 • (phase 0 and 1) dfi_act_n= 1 Programming Mode: Quasi-dynamic Group 3 0b - Enable |
| 5 dfi_init_start        | PHY init start Triggers the PHY init start request. if " DFIMISC[dfi_init_start] is triggered ,while dfi_phymstr_req (PHY request control of DFI interface) is active, it can result in the PHY Master request being acknowledged(dfi_phymstr_ack=1) while dfi_init_start is active. This simultaneously occurring of both these signals is illegal for the Synopsys PHYs. This can lead to unexpected behavior / protocol violation. Therefore, before writing 1 to "DFIMISC[dfi_init_start]" ,write 0 to DFIPHYMSTR[dfi_phymstr_en] to disable the PHY Master. Programming Mode: Quasi-dynamic Group 3                                                                                                                                                                                                                                                                          |
| 4-3 -                   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 2 dfi_data_cs_pol arity | Chip select polarity Specifies the polarity of the dfi_wrdata_cs and dfi_rddata_cs signals. Programming Mode: Static 0b - Active low 1b - Active high                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 1                       | DBI mode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

Table continues on the next page...

Table continued from the previous page...

| Field                   | Function                                                                                                                                                                                        |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| phy_dbi_mode            | Specifies whether data bus inversion (DBI) is implemented in the MC or PHY. This field applies only to DDR4 and LPDDR4 DRAM. Programming Mode: Static 0b - MC 1b - PHY                          |
| 0 dfi_init_complet e_en | PHY initialization complete enable Enables the triggering of DRAM initialization on assertion of the dfi_init_complete signal. Programming Mode: Quasi-dynamic Group 3 0b - Disable 1b - Enable |

## 36.15.74 DFI Timing 2 (DFITMG2)

## Offset

| Register   | Offset   |
|------------|----------|
| DFITMG2    | 1B4h     |

<!-- image -->

## Fields

| Field   | Function                        |
|---------|---------------------------------|
| 31-15   | Reserved                        |
| 14-8    | DFI read to chip select latency |

Table continues on the next page...

Table continued from the previous page...

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                    |
|----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| dfi_tphy_rdcslat     | Specifies the time interval, in DFI PHY clock cycles, between sending a read command on the DFI control interface and assertion of the dfi_rddata_cs signal. This value corresponds to the tphy_rdcslat DFI timing parameter. Programming Mode: Quasi-dynamic Group 2, Group 4                                                                                                              |
| 7-6 -                | Reserved                                                                                                                                                                                                                                                                                                                                                                                    |
| 5-0 dfi_tphy_wrcslat | DFI write to chip select latency Specifies the time interval (latency), in DFI PHY clock cycles, between sending a write command on the DFI control interface and assertion of the associated dfi_wrdata_cs signal. This value corresponds to the tphy_wrcslat DFI timing parameter. Refer to the PHY specification for the correct value. Programming Mode: Quasi-dynamic Group 2, Group 4 |

## 36.15.75 DFI Timing 3 (DFITMG3)

## Offset

| Register   | Offset   |
|------------|----------|
| DFITMG3    | 1B8h     |

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-5    | Reserved   |
| -       |            |

Table continues on the next page...

Table continued from the previous page...

| Field                     | Function                                                                                                                                                                                                                                                                                                                                     |
|---------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 4-0 dfi_t_geardown_ delay | The delay from dfi_geardown_en assertion to the time of the PHY being ready to receive commands. Refer to PHY specification for correct value. When the controller is operating in 1:2 frequency ratio mode, program this to (tgeardown_delay/2) and round it up to the next integer value. Unit: DFI clock cycles. Programming Mode: Static |

## 36.15.76 DFI Status (DFISTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| DFISTAT    | 1BCh     |

## Diagram

<!-- image -->

## Fields

| Field                | Function                                                                                                                                                                                                                                                  |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-2 -               | Reserved                                                                                                                                                                                                                                                  |
| 1 dfi_lp_ack         | Stores the value of the dfi_lp_ack input to the controller. Programming Mode: Dynamic                                                                                                                                                                     |
| 0 dfi_init_complet e | The status flag register which announces when the DFI initialization has been completed. The DFI INIT triggered by dfi_init_start signal and then the dfi_init_complete flag is polled to know when the initialization is done. Programming Mode: Dynamic |

## 36.15.77 DM/DBI Control (DBICTL)

## Offset

| Register   | Offset   |
|------------|----------|
| DBICTL     | 1C0h     |

## Diagram

<!-- image -->

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                               |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-3 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                               |
| 2 rd_dbi_en | Read DBI enable Enables read data bus inversion (DBI) in the MC. Depending on the type of DRAM, follow these guidelines to set this value to the corresponding DRAM Mode Register: • DDR4: Set to the same value as MR5[A12]. When using x4 devices, set this signal to 0. • LPDDR4: Set to the same value as MR3[6]. Programming Mode: Quasi-dynamic Group 1 0b - Disable 1b - Enable |
| 1 wr_dbi_en | Write DBI enable Enables write data bus inversion (DBI) in the MC. Depending on the type of DRAM, follow these guidelines to set this value to the corresponding DRAM Mode Register: • DDR4: Set to the same value as MR5[A11]. When using x4 devices, set this signal to 0. • LPDDR4: Set to the same value as MR3[7].                                                                |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                        |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | Programming Mode: Quasi-dynamic Group 1 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                |
| 0 dm_en | Data mask enable Enables data mask. Depending on the type of DRAM, follow these guidelines to set this value to the corresponding DRAM Mode Register: • DDR4: Set to the same value as MR5[A10]. When using x4 devices, set this signal to 0. • LPDDR4: Set to the inverted value of MR13[5], which has the opposite polarity of this signal. Programming Mode: Static 0b - Disable 1b - Enable |

## 36.15.78 DFI PHY Master (DFIPHYMSTR)

## Offset

| Register   | Offset   |
|------------|----------|
| DFIPHYMSTR | 1C4h     |

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-1    | Reserved   |

Table continues on the next page...

Table continued from the previous page...

| Field            | Function                                                                            |
|------------------|-------------------------------------------------------------------------------------|
| -                |                                                                                     |
| 0 dfi_phymstr_en | Enables the PHY Master Interface. Programming Mode: Static 0b - Disable 1b - Enable |

## 36.15.79 Address Map 0 (ADDRMAP0)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP0   | 200h     |

<!-- image -->

## Fields

| Field                | Function                                                                                                                                                                                                                                                                                                                                                  |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-5 -               | Reserved                                                                                                                                                                                                                                                                                                                                                  |
| 4-0 addrmap_cs_bit 0 | Rank address bit 0 Selects the host interface (HIF) address bit to use as the rank address bit 0. The valid range is 0 to 29, and 31. The internal base is 6. The selected HIF address bit is determined by adding the internal base to the value of this field. If you set this to 31, then the rank address bit 0 is set to 0. Programming Mode: Static |

## 36.15.80 Address Map 1 (ADDRMAP1)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP1   | 204h     |

## Diagram

<!-- image -->

## Fields

| Field                  | Function                                                                                                                                                                                                                                                                                                                                                  |
|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-22 -                | Reserved                                                                                                                                                                                                                                                                                                                                                  |
| 21-16 addrmap_bank_ b2 | Bank address bit 2 Selects the host interface (HIF) address bit to use as the bank address bit 2. The valid range is 0 to 32, and 63. The internal base is 4. The selected HIF address bit is determined by adding the internal base to the value of this field. If you set this to 63, then the bank address bit 2 is set to 0.                          |
| 15-14 -                | Reserved                                                                                                                                                                                                                                                                                                                                                  |
| 13-8 addrmap_bank_ b1  | Bank address bit 1 Selects the host interface (HIF) address bit to use as the bank address bit 1. The valid range is 0 to 32, and 63. The internal base is 3. The selected HIF address bit is determined by adding the internal base to the value of this field. If you set this to 63, then the bank address bit 1 is set to 0. Programming Mode: Static |
| 7-6                    | Reserved                                                                                                                                                                                                                                                                                                                                                  |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field                | Function                                                                                                                                                                                                                                                                                                                                                  |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -                    |                                                                                                                                                                                                                                                                                                                                                           |
| 5-0 addrmap_bank_ b0 | Bank address bit 0 Selects the host interface (HIF) address bit to use as the bank address bit 0. The valid range is 0 to 32, and 63. The internal base is 2. The selected HIF address bit is determined by adding the internal base to the value of this field. If you set this to 63, then the bank address bit 0 is set to 0. Programming Mode: Static |

## 36.15.81 Address Map 2 (ADDRMAP2)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP2   | 208h     |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28             | 27             | 26             | 25             | 24             | 23       | 22       | 21       | 20       | 19             | 18             | 17             | 16             |
|--------|----------|----------|----------|----------------|----------------|----------------|----------------|----------------|----------|----------|----------|----------|----------------|----------------|----------------|----------------|
| R W    | Reserved | Reserved | Reserved | addrmap_col_b5 | addrmap_col_b5 | addrmap_col_b5 | addrmap_col_b5 | addrmap_col_b5 | Reserved | Reserved | Reserved | Reserved | addrmap_col_b4 | addrmap_col_b4 | addrmap_col_b4 | addrmap_col_b4 |
| Reset  | 0        | 0        | 0        | 0              | 0              | 0              | 0              | 0              | 0        | 0        | 0        | 0        | 0              | 0              | 0              | 0              |
| Bits   | 15       | 14       | 13       | 12             | 11             | 10             | 9              | 8              | 7        | 6        | 5        | 4        | 3              | 2              | 1              | 0              |
| R W    | Reserved | Reserved | Reserved | addrmap_col_b3 | addrmap_col_b3 | addrmap_col_b3 | addrmap_col_b3 | addrmap_col_b3 | Reserved | Reserved | Reserved | Reserved | addrmap_col_b2 | addrmap_col_b2 | addrmap_col_b2 | addrmap_col_b2 |
| Reset  | 0        | 0        | 0        | 0              | 0              | 0              | 0              | 0              | 0        | 0        | 0        | 0        | 0              | 0              | 0              | 0              |

## Fields

| Field   | Function             |
|---------|----------------------|
| 31-28   | Reserved             |
| 27-24   | Column address bit 5 |

Table continues on the next page...

## Table continued from the previous page...

| Field                 | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                       | address bit is determined by adding the internal base to the value of this field. If unused, set to 15 and then this column address bit is set to 0. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 23-20 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 19-16 addrmap_col_b 4 | Column address bit 4 - Full bus width mode: Selects the HIF address bit used as column address bit 4. - Half bus width mode: Selects the HIF address bit used as column address bit 5. - Quarter bus width mode: Selects the HIF address bit used as column address bit 6. Valid Range: 0 to 7, and 15 Internal Base: 4 The selected HIF address bit is determined by adding the internal base to the value of this field. If unused, set to 15 and then this column address bit is set to 0. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 15-13 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 12-8 addrmap_col_b 3  | Column address bit 3 - Full bus width mode: Selects the HIF address bit used as column address bit 3. - Half bus width mode: Selects the HIF address bit used as column address bit 4. - Quarter bus width mode: Selects the HIF address bit used as column address bit 5. Valid Range: 0 to 7, x. x indicate a valid value in inline ECC configuration. Internal Base: 3 The selected HIF address bit is determined by adding the internal base to the value of this field. Note, if UMCTL2_INCL_ARB=1, MEMC_BURST_LENGTH=16, Full bus width (MSTR.data_bus_width=00) and BL16 (MSTR.burst_rdwr=1000), it is recommended to program this to 0. In Inline ECC configuration (MEMC_INLINE_ECC=1) and ECC is enabled (ECCCFG0.ecc_mode>0), if MEMC_BURST_LENGTH is 16, number of column address is 10 and work on half bus width mode, column bit 8, column bit 7 and column bit 3 must map to the highest 3 valid HIF address bits. This register need be set to x. (x = the highest valid HIF address bit - internal base - 2) Programming Mode: Static |
| 7-4 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 3-0 addrmap_col_b 2   | Column address bit 2 Depending on the bus width mode, selects the host interface (HIF) address bit to use as: • Full bus width: column address bit 2 • Half bus width: column address bit 3 • Quarter bus width: column address bit 4 The valid range is 0 to 7. The internal base is 2. The selected HIF address bit is determined by adding the internal base to the value of this field. If the MC includes a multi-port arbiter (UMCTL2_INCL_ARB == 1) and the burst length is 8 (MEMC_BURST_LENGTH == 8), you must set this field to 0 unless: • Half or Quarter bus width (MSTR[data_bus_width] != 00) AND • Burst length expansion mode enabled (PCCFG[bl_exp_mode] == 1) AND                                                                                                                                                                                                                                                                                                                                                                    |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | • Either: - DDR4: ADDRMAP8[addrmap_bg_b0] == 0 - LPDDR4: ADDRMAP1[addrmap_bank_b0] == 0 If the MC includes a multi-port arbiter (UMCTL2_INCL_ARB == 1) and the burst length (BL) is 16 (MEMC_BURST_LENGTH == 16), you must set this field to 0 unless: • Half or Quarter bus width (MSTR[data_bus_width] != 00) AND • BL expansion mode enabled (PCCFG[bl_exp_mode] == 1) AND • DDR4: ADDRMAP8[addrmap_bg_b0] == 0 Otherwise, follow these recommendations: • If using Full bus width (MSTR[data_bus_width] == 00) AND BL is 8 (MEMC_BURST_LENGTH == 8), set to 0 so HIF[2] maps to column address bit 2. • If using Full bus width (MSTR[data_bus_width] == 00) AND BL is 16 (MEMC_BURST_LENGTH == 16), set to 0 so HIF[2] maps to column address bit 2. • If using Half bus width (MSTR[data_bus_width] == 01) AND BL is 16 (MEMC_BURST_LENGTH == 16), set to 0 so HIF[2] maps to column address bit 3. Programming Mode: Static |

## 36.15.82 Address Map 3 (ADDRMAP3)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP3   | 20Ch     |

## Diagram

<!-- image -->

## Fields

| Field                 | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|-----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-29 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 28-24 addrmap_col_b 9 | Column address bit 9 Depending on the bus width mode, selects the host interface (HIF) address bit to use as: • Full bus width: column address bit 9 • Half bus width: column address bit 11 (for LPDDR2 and LPDDR3: bit 10) • Quarter bus width: column address bit 13 (for LPDDR2 and LPDDR3: bit 11) The valid values are 0 to 7, 31, and x, where x is a valid value in the inline ECC configuration. The internal base is 9. The MC determines the selected HIF address bit by adding the internal base to the value of this field. If not used, write 31 (11111b) to this field. In this case, the HIF address bit to use is 0. If the following conditions apply, the highest three column address bits must map to the highest three valid HIF address bits: • Inline ECC configuration (MEMC_INLINE_ECC == 1) • ECC enabled (ECCCFG0[ecc_mode]>0) If column bit 9 is the highest column address bit, you must set this value to the highest valid HIF address bit minus the internal base (highest HIF bit - 9) If column bit 9 is the second highest column address bit, you must set this value to the second highest valid HIF address bit minus the internal base minus one (highest HIF bit - 9 - 1) If column bit 9 is the third highest column address bit, you must set this value to the highest valid HIF address bit minus the internal base minus two (highest HIF bit - 9 - 2) For DDR2, DDR3, and mDDR (per the JEDEC specifications), column address bit 10 is reserved for indicating auto-precharge, and therefore no source address bit can be mapped to column address bit 10. LPDDR2 and LPDDR3 have a dedicated bit in the CA bus for auto-precharge, so these DRAM types use column address bit 10. NOTE |
| 23-21 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 20-16 addrmap_col_b 8 | Column address bit 8 Depending on the bus width mode, selects the host interface (HIF) address bit to use as: • Full bus width: column address bit 8 • Half bus width: column address bit 9 • Quarter bus width: column address bit 11 (for LPDDR2 and LPDDR3: bit 10)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

Table continues on the next page...

## Table continued from the previous page...

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                      | The valid values are 0 to 7, 31, and x, where x is a valid value in the inline ECC configuration. The internal base is 8. The MC determines the selected HIF address bit by adding the internal base to the value of this field. If not used, write 31 (11111b) to this field. In this case, the HIF address bit to use is 0. If the following conditions apply, the highest three column address bits must map to the highest three valid HIF address bits: • Inline ECC configuration (MEMC_INLINE_ECC == 1) • ECC enabled (ECCCFG0[ecc_mode]>0) If column bit 8 is the second highest column address bit, you must set this value to the second highest valid HIF address bit minus the internal base minus one (highest HIF bit - 8 - 1) If column bit 8 is the third highest column address bit, you must set this value to the highest valid HIF address bit minus the internal base minus two (highest HIF bit - 8 - 2) For DDR2, DDR3, and mDDR (per the JEDEC specifications), column address bit 10 is reserved for indicating auto-precharge, and therefore no source address bit can be mapped to column address bit 10. LPDDR2 and LPDDR3 have a dedicated bit in the CA bus for auto-precharge, so these DRAM types use column address bit 10. NOTE Programming Mode: Static |
| 15-13 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 12-8 addrmap_col_b 7 | Column address bit 7 Depending on the bus width mode, selects the host interface (HIF) address bit to use as: • Full bus width: column address bit 7 • Half bus width: column address bit 8 • Quarter bus width: column address bit 9 The valid values are 0 to 7, 31, and x, where x is a valid value in the inline ECC configuration. The internal base is 7. The MC determines the selected HIF address bit by adding the internal base to the value of this field. If not used, write 31 (11111b) to this field. In this case, the HIF address bit to use is 0. If the following conditions apply, the highest three column address bits must map to the highest three valid HIF address bits: • Inline ECC configuration (MEMC_INLINE_ECC == 1) • ECC enabled (ECCCFG0[ecc_mode]>0) If column bit 7 is the third highest column address bit, you must set this value to the highest valid HIF address bit minus the internal base minus two (highest HIF bit - 7 - 2) Programming Mode: Static                                                                                                                                                                                                                                                                                        |

Table continues on the next page...

## Table continued from the previous page...

| Field               | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|---------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7-5 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 4-0 addrmap_col_b 6 | Column address bit 6 Depending on the bus width mode, selects the host interface (HIF) address bit to use as: • Full bus width: column address bit 6 • Half bus width: column address bit 7 • Quarter bus width: column address bit 8 The valid values are 0 to 7, 31, and x, where x is a valid value in the inline ECC configuration. The internal base is 6. The MC determines the selected HIF address bit by adding the internal base to the value of this field. If not used, write 31 (11111b) to this field. In this case, the HIF address bit to use is 0. If all of the following conditions apply, column bits 8, 7, and 6 must maptothehighest three valid HIF address bits. Therefore, you must set this value to the highest valid HIF address bit minus the internal base minus two (highest HIF bit - 6 - 2): • Inline ECC configuration (MEMC_INLINE_ECC == 1) • ECC enabled (ECCCFG0[ecc_mode]>0) • Number of column address bits == 10 • Half bus width Programming Mode: Static |

## 36.15.83 Address Map 4 (ADDRMAP4)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP4   | 210h     |

<!-- image -->

## Fields

| Field                 | Function                                                                                                                          |
|-----------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| 31 col_addr_shift     | Column address shift 2 Shifts the column address 2 bits to the left (a lower HIF address) in specific cases as required by inline |
| 30-13 -               | Reserved                                                                                                                          |
| 12-8 addrmap_col_b 11 | Column address bit 11 Depending on the bus width mode, selects the host interface (HIF) address bit to use as:                    |

Table continues on the next page...

## Table continued from the previous page...

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7-5 -                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 4-0 addrmap_col_b 10 | Column address bit 10 Depending on the bus width mode, selects the host interface (HIF) address bit to use as: • Full bus width: column address bit 11 (for LPDDR2 and LPDDR3: bit 10) • Half bus width: column address bit 13 (for LPDDR2 and LPDDR3: bit 11) • Quarter bus width: Not used (see instruction below for "If not used") The valid values are 0 to 7, 31, and x, where x is a valid value in the inline ECC configuration. The internal base is 10. The MC determines the selected HIF address bit by adding the internal base to the value of this field. If not used, write 31 (11111b) to this field. In this case, the HIF address bit to use is 0. If the following conditions apply, the highest three column address bits must map to the highest three valid HIF address bits: • Inline ECC configuration (MEMC_INLINE_ECC == 1) • ECC enabled (ECCCFG0[ecc_mode]>0) If column bit 10 is the highest column address bit, you must set this value to the highest valid HIF address bit minus the internal base (highest HIF bit - 10) If column bit 10 is the second highest column address bit, you must set this value to the second highest valid HIF address bit minus the internal base minus one (highest HIF bit - 10 - 1) If column bit 10 is the third highest column address bit, you must set this value to the highest valid HIF address bit minus the internal base minus two (highest HIF bit - 10 - 2) For DDR2, DDR3, and mDDR (per the JEDEC specifications), column address bit 10 is reserved for indicating auto-precharge, and therefore no source address bit can be mapped to column address bit 10. LPDDR2 and LPDDR3 have a dedicated bit in the CA bus for auto-precharge, so these DRAM types use column address bit 10. NOTE |

## 36.15.84 Address Map 5 (ADDRMAP5)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP5   | 214h     |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28              | 27              | 26              | 25              | 24              | 23       | 22       | 21       | 20       | 19                | 18                | 17                | 16                |
|--------|----------|----------|----------|-----------------|-----------------|-----------------|-----------------|-----------------|----------|----------|----------|----------|-------------------|-------------------|-------------------|-------------------|
| R W    | Reserved | Reserved | Reserved | addrmap_row_b11 | addrmap_row_b11 | addrmap_row_b11 | addrmap_row_b11 | addrmap_row_b11 | Reserved | Reserved | Reserved | Reserved | addrmap_row_b2_10 | addrmap_row_b2_10 | addrmap_row_b2_10 | addrmap_row_b2_10 |
| Reset  | 0        | 0        | 0        | 0               | 0               | 0               | 0               | 0               | 0        | 0        | 0        | 0        | 0                 | 0                 | 0                 | 0                 |
| Bits   | 15       | 14       | 13       | 12              | 11              | 10              | 9               | 8               | 7        | 6        | 5        | 4        | 3                 | 2                 | 1                 | 0                 |
| R W    | Reserved | Reserved | Reserved | Reserved        | addrmap_row_b1  | addrmap_row_b1  | addrmap_row_b1  | addrmap_row_b1  | Reserved | Reserved | Reserved | Reserved | addrmap_row_b0    | addrmap_row_b0    | addrmap_row_b0    | addrmap_row_b0    |
| Reset  | 0        | 0        | 0        | 0               | 0               | 0               | 0               | 0               | 0        | 0        | 0        | 0        | 0                 | 0                 | 0                 | 0                 |

## Fields

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 27-24 addrmap_row_b 11   | Row address bit 11 Selects the HIF address bits to use as row address bit 11. The valid values are 0 to 11, and 15. The internal base is 17. The MCdetermines the selected HIF address bit by adding the internal base to the value of this field. If not used, write 15 (1111b) to this field. In this case, the HIF address bit to use is 0. Programming Mode: Static                                                                                                                           |
| 23-20 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 19-16 addrmap_row_b 2_10 | Row address bits 2 to 10 Selects the HIF address bits to use as row address bits 2 to 10. The valid values are 0 to 11, and 15. The internal base is (address bit + 6). For example, the base for bit 2 is (2 + 6 = 8. For bit 10, the base is (10 + 6 = 16. The MC determines the selected HIF address bit by adding the internal base to the value of this field. When set to 15, the MC obtains the row address bits 2 to 10 from ADDRMAP9, ADDRMAP10, and ADDRMAP11. Programming Mode: Static |
| 15-12 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 11-8 addrmap_row_b 1     | Row address bit 1 Selects the HIF address bits to use as row address bit 1.                                                                                                                                                                                                                                                                                                                                                                                                                       |

Table continues on the next page...

Table continued from the previous page...

| Field               | Function                                                                                                                                                                                                                                                          |
|---------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                     | The valid values are 0 to 11. The internal base is 7. The MC determines the selected HIF address bit by adding the internal base to the value of this field. Programming Mode: Static                                                                             |
| 7-4 -               | Reserved                                                                                                                                                                                                                                                          |
| 3-0 addrmap_row_b 0 | Row address bit 0 Selects the HIF address bits to use as row address bit 0. The valid values are 0 to 11. The internal base is 6. The MC determines the selected HIF address bit by adding the internal base to the value of this field. Programming Mode: Static |

## 36.15.85 Address Map 6 (ADDRMAP6)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP6   | 218h     |

## Diagram

<!-- image -->

## Fields

| Field            | Function                                                         |
|------------------|------------------------------------------------------------------|
| 31               | Indicates that a 6 GB or 12 GB LPDDR3 DRAM device is being used. |
| lpddr3_6gb_12g b | This field applies only to LPDDR3 DRAM. Programming Mode: Static |

Table continues on the next page...

## Table continued from the previous page...

| Field                       | Function                                                                                                                                                                                                                                                                                                                                       |
|-----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 30-29 lpddr4_6gb_12g b_24gb | 1b - 6 GB or 12 GB LPDDR3 DRAM is present. Every address with row[14:13] == 11b is invalid LPDDR4 type Specifies the type of LPDDR4 DRAM being used. This field applies only to LPDDR4 DRAM. Programming Mode: Static                                                                                                                          |
| 28 -                        | Reserved                                                                                                                                                                                                                                                                                                                                       |
| 27-24 addrmap_row_b 15      | Row address bit 15 Selects the HIF address bits to use as row address bit 15. The valid values are 0 to 11, and 15. The internal base is 21. The MCdetermines the selected HIF address bit by adding the internal base to the value of this field. If not used, write 15 (1111b) to this field. In this case, the HIF address bit to use is 0. |
| 23-20 -                     | Reserved                                                                                                                                                                                                                                                                                                                                       |
| 19-16 addrmap_row_b 14      | Row address bit 14 Selects the HIF address bits to use as row address bit 14. The valid values are 0 to 11, and 15. The internal base is 20. The MCdetermines the selected HIF address bit by adding the internal base to the value of this field.                                                                                             |
| 15-12 -                     | Reserved                                                                                                                                                                                                                                                                                                                                       |
| 11-8 addrmap_row_b 13       | Row address bit 13 Selects the HIF address bits to use as row address bit 13. The valid values are 0 to 11, and 15. The internal base is 19. The MCdetermines the selected HIF address bit by adding the internal base to the value of this field.                                                                                             |

Table continues on the next page...

## Table continued from the previous page...

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                |
|----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                      | If not used, write 15 (1111b) to this field. In this case, the HIF address bit to use is 0. Programming Mode: Static                                                                                                                                                                                                                                                    |
| 7-4 -                | Reserved                                                                                                                                                                                                                                                                                                                                                                |
| 3-0 addrmap_row_b 12 | Row address bit 12 Selects the HIF address bits to use as row address bit 12. The valid values are 0 to 11, and 15. The internal base is 18. The MCdetermines the selected HIF address bit by adding the internal base to the value of this field. If not used, write 15 (1111b) to this field. In this case, the HIF address bit to use is 0. Programming Mode: Static |

## 36.15.86 Address Map 7 (ADDRMAP7)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP7   | 21Ch     |

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-12   | Reserved   |

Table continues on the next page...

Table continued from the previous page...

| Field                 | Function                                                                                                                                                                                                                                                                                         |
|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 11-8 addrmap_row_b 17 | Selects the HIF address bit used as row address bit 17. Valid Range: 0 to 11, and 15 Internal Base: 23 The selected HIF address bit is determined by adding the internal base to the value of this field. If unused, set to 15 and then row address bit 17 is set to 0. Programming Mode: Static |
| 7-4 -                 | Reserved                                                                                                                                                                                                                                                                                         |
| 3-0 addrmap_row_b 16  | Selects the HIF address bit used as row address bit 16. Valid Range: 0 to 11, and 15 Internal Base: 22 The selected HIF address bit is determined by adding the internal base to the value of this field. If unused, set to 15 and then row address bit 16 is set to 0. Programming Mode: Static |

## 36.15.87 Address Map 8 (ADDRMAP8)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP8   | 220h     |

<!-- image -->

## Fields

| Field              | Function                                                                                                                                                                                                                                                                                                                                             |
|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-14              | Reserved                                                                                                                                                                                                                                                                                                                                             |
| 13-8 addrmap_bg_b1 | Selects the HIF address bits used as bank group address bit 1. Valid Range: 0 to 32, and 63 Internal Base: 3 The selected HIF address bit for each of the bank group address bits is determined by adding the internal base to the value of this field. If unused, set to 63 and then bank group address bit 1 is set to 0. Programming Mode: Static |

Table continues on the next page...

Table continued from the previous page...

| Field             | Function                                                                                                                                                                                                                                                                                                                                             |
|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7-6               | Reserved                                                                                                                                                                                                                                                                                                                                             |
| 5-0 addrmap_bg_b0 | Selects the HIF address bits used as bank group address bit 0. Valid Range: 0 to 32, and 63 Internal Base: 2 The selected HIF address bit for each of the bank group address bits is determined by adding the internal base to the value of this field. If unused, set to 63 and then bank group address bit 0 is set to 0. Programming Mode: Static |

## 36.15.88 Address Map 9 (ADDRMAP9)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP9   | 224h     |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28             | 27             | 26             | 25             | 24             | 23       | 22       | 21       | 20       | 19             | 18             | 17             | 16             |
|--------|----------|----------|----------|----------------|----------------|----------------|----------------|----------------|----------|----------|----------|----------|----------------|----------------|----------------|----------------|
| R W    | Reserved | Reserved | Reserved | addrmap_row_b5 | addrmap_row_b5 | addrmap_row_b5 | addrmap_row_b5 | addrmap_row_b5 | Reserved | Reserved | Reserved | Reserved | addrmap_row_b4 | addrmap_row_b4 | addrmap_row_b4 | addrmap_row_b4 |
| Reset  | 0        | 0        | 0        | 0              | 0              | 0              | 0              | 0              | 0        | 0        | 0        | 0        | 0              | 0              | 0              | 0              |
| Bits   | 15       | 14       | 13       | 12             | 11             | 10             | 9              | 8              | 7        | 6        | 5        | 4        | 3              | 2              | 1              | 0              |
| R W    | Reserved | Reserved | Reserved | Reserved       | addrmap_row_b3 | addrmap_row_b3 | addrmap_row_b3 | addrmap_row_b3 | Reserved | Reserved | Reserved | Reserved | addrmap_row_b2 | addrmap_row_b2 | addrmap_row_b2 | addrmap_row_b2 |
| Reset  | 0        | 0        | 0        | 0              | 0              | 0              | 0              | 0              | 0        | 0        | 0        | 0        | 0              | 0              | 0              | 0              |

## Fields

| Field                 | Function                                                                                                                                                                                                                                                                                                                                         |
|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -               | Reserved                                                                                                                                                                                                                                                                                                                                         |
| 27-24 addrmap_row_b 5 | Selects the HIF address bits used as row address bit 5. Valid Range: 0 to 11 Internal Base: 11 The selected HIF address bit for each of the row address bits is determined by adding the internal base to the value of this field. This register field is used only when ADDRMAP5.addrmap_row_b2_10 is set to value 15. Programming Mode: Static |
| 23-20 -               | Reserved                                                                                                                                                                                                                                                                                                                                         |

Table continues on the next page...

## Table continued from the previous page...

| Field                 | Function                                                                                                                                                                                                                                                                                                                                         |
|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 19-16 addrmap_row_b 4 | Selects the HIF address bits used as row address bit 4. Valid Range: 0 to 11 Internal Base: 10 The selected HIF address bit for each of the row address bits is determined by adding the internal base to the value of this field. This register field is used only when ADDRMAP5.addrmap_row_b2_10 is set to value 15. Programming Mode: Static |
| 15-12 -               | Reserved                                                                                                                                                                                                                                                                                                                                         |
| 11-8 addrmap_row_b 3  | Selects the HIF address bits used as row address bit 3. Valid Range: 0 to 11 Internal Base: 9 The selected HIF address bit for each of the row address bits is determined by adding the internal base to the value of this field. This register field is used only when ADDRMAP5.addrmap_row_b2_10 is set to value 15. Programming Mode: Static  |
| 7-4 -                 | Reserved                                                                                                                                                                                                                                                                                                                                         |
| 3-0 addrmap_row_b 2   | Selects the HIF address bits used as row address bit 2. Valid Range: 0 to 11 Internal Base: 8 The selected HIF address bit for each of the row address bits is determined by adding the internal base to the value of this field. This register field is used only when ADDRMAP5.addrmap_row_b2_10 is set to value 15. Programming Mode: Static  |

## 36.15.89 Address Map 10 (ADDRMAP10)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP10  | 228h     |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28             | 27             | 26             | 25             | 24             | 23       | 22       | 21       | 20       | 19             | 18             | 17             | 16             |
|--------|----------|----------|----------|----------------|----------------|----------------|----------------|----------------|----------|----------|----------|----------|----------------|----------------|----------------|----------------|
| R W    | Reserved | Reserved | Reserved | addrmap_row_b9 | addrmap_row_b9 | addrmap_row_b9 | addrmap_row_b9 | addrmap_row_b9 | Reserved | Reserved | Reserved | Reserved | addrmap_row_b8 | addrmap_row_b8 | addrmap_row_b8 | addrmap_row_b8 |
| Reset  | 0        | 0        | 0        | 0              | 0              | 0              | 0              | 0              | 0        | 0        | 0        | 0        | 0              | 0              | 0              | 0              |
| Bits   | 15       | 14       | 13       | 12             | 11             | 10             | 9              | 8              | 7        | 6        | 5        | 4        | 3              | 2              | 1              | 0              |
| R W    | Reserved | Reserved | Reserved | Reserved       | addrmap_row_b7 | addrmap_row_b7 | addrmap_row_b7 | addrmap_row_b7 | Reserved | Reserved | Reserved | Reserved | addrmap_row_b6 | addrmap_row_b6 | addrmap_row_b6 | addrmap_row_b6 |
| Reset  | 0        | 0        | 0        | 0              | 0              | 0              | 0              | 0              | 0        | 0        | 0        | 0        | 0              | 0              | 0              | 0              |

## Fields

| Field                 | Function                                                                                                                                                                                                                                                                                                                                         |
|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -               | Reserved                                                                                                                                                                                                                                                                                                                                         |
| 27-24 addrmap_row_b 9 | Selects the HIF address bits used as row address bit 9. Valid Range: 0 to 11 Internal Base: 15 The selected HIF address bit for each of the row address bits is determined by adding the internal base to the value of this field. This register field is used only when ADDRMAP5.addrmap_row_b2_10 is set to value 15. Programming Mode: Static |
| 23-20 -               | Reserved                                                                                                                                                                                                                                                                                                                                         |
| 19-16 addrmap_row_b 8 | Selects the HIF address bits used as row address bit 8. Valid Range: 0 to 11 Internal Base: 14 The selected HIF address bit for each of the row address bits is determined by adding the internal base to the value of this field. This register field is used only when ADDRMAP5.addrmap_row_b2_10 is set to value 15. Programming Mode: Static |
| 15-12 -               | Reserved                                                                                                                                                                                                                                                                                                                                         |
| 11-8 addrmap_row_b 7  | Selects the HIF address bits used as row address bit 7. Valid Range: 0 to 11 Internal Base: 13 The selected HIF address bit for each of the row address bits is determined by adding the internal base to the value of this field. This register field is used only when ADDRMAP5.addrmap_row_b2_10 is set to value 15. Programming Mode: Static |
| 7-4 -                 | Reserved                                                                                                                                                                                                                                                                                                                                         |
| 3-0 addrmap_row_b 6   | Selects the HIF address bits used as row address bit 6. Valid Range: 0 to 11 Internal Base: 12 The selected HIF address bit for each of the row address bits is determined by adding the internal base to the value of this field. This register field is used only when ADDRMAP5.addrmap_row_b2_10 is set to value 15. Programming Mode: Static |

## 36.15.90 Address Map 11 (ADDRMAP11)

## Offset

| Register   | Offset   |
|------------|----------|
| ADDRMAP11  | 22Ch     |

## Diagram

<!-- image -->

## Fields

| Field                | Function                                                                                                                                                                                                                                                                                                                                          |
|----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-4                 | Reserved                                                                                                                                                                                                                                                                                                                                          |
| 3-0 addrmap_row_b 10 | Selects the HIF address bits used as row address bit 10. Valid Range: 0 to 11 Internal Base: 16 The selected HIF address bit for each of the row address bits is determined by adding the internal base to the value of this field. This register field is used only when ADDRMAP5.addrmap_row_b2_10 is set to value 15. Programming Mode: Static |

## 36.15.91 ODT Configuration (ODTCFG)

## Offset

| Register   | Offset   |
|------------|----------|
| ODTCFG     | 240h     |

## Diagram

<!-- image -->

DDR Subsystem

## Fields

| Field              | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -            | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 27-24 wr_odt_hold  | DFI PHY clock cycles to hold ODT for a write command. The minimum supported value is 2. Recommended values: DDR2: - BL8: 0x5 (DDR2-400/533/667), 0x6 (DDR2-800), 0x7 (DDR2-1066) - BL4: 0x3 (DDR2-400/533/667), 0x4 (DDR2-800), 0x5 (DDR2-1066) DDR3: - BL8: 0x6 DDR4: - BL8: 5 + WR_PREAMBLE + CRC_MODE WR_PREAMBLE = 1 (1tCK write preamble), 2 (2tCK write preamble) CRC_MODE = 0 (not CRC mode), 1 (CRC mode) LPDDR3: - BL8: 7 + RU(tODTon(max)/tCK) Unit: DFI PHY clock cycles. Programming Mode: Quasi-dynamic Group 1, Group 4                                                                                                                                                                                                                                                                                                                 |
| 23-21 -            | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 20-16 wr_odt_delay | The delay, in DFI PHY clock cycles, from issuing a write command to setting ODT values associated with that command. ODT setting must remain constant for the entire time that DQS is driven by the uMCTL2. Recommended values: DDR2: - CWL + AL - 3 (DDR2-400/533/667), CWL + AL - 4 (DDR2-800), CWL + AL - 5 (DDR2-1066) If (CWL + AL - 3 < 0), uMCTL2 does not support ODT for write operation. DDR3: - 0x0 DDR4: - DFITMG1.dfi_t_cmd_lat (to adjust for CAL mode) LPDDR3: - WL - 1 - RU(tODTon(max)/ tCK)) Unit: DFI PHY clock cycles. Programming Mode: Quasi-dynamic Group 1, Group 4                                                                                                                                                                                                                                                           |
| 15-12 -            | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 11-8 rd_odt_hold   | DFI PHY clock cycles to hold ODT for a read command. The minimum supported value is 2. Recommended values: DDR2: - BL8: 0x6 (not DDR2-1066), 0x7 (DDR2-1066) - BL4: 0x4 (not DDR2-1066), 0x5 (DDR2-1066) DDR3: - BL8 - 0x6 DDR4: - BL8: 5 + RD_PREAMBLE RD_PREAMBLE = 1 (1tCK read preamble), 2 (2tCK read preamble) LPDDR3: - BL8: 5 + RU(tDQSCK(max)/tCK) - RD(tDQSCK(min)/tCK) + RU(tODTon(max)/tCK) Unit: DFI PHY clock cycles. Programming Mode: Quasi- dynamic Group 1, Group 4                                                                                                                                                                                                                                                                                                                                                                 |
| 7 -                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 6-2 rd_odt_delay   | The delay, in DFI PHY clock cycles, from issuing a read command to setting ODT values associated with that command. ODT setting must remain constant for the entire time that DQS is driven by the uMCTL2. Recommended values: DDR2: - CL + AL - 4 (not DDR2-1066), CL + AL - 5 (DDR2-1066) If (CL + AL - 4 < 0), uMCTL2 does not support ODT for read operation. DDR3: - CL - CWL DDR4: - CL - CWL - RD_PREAMBLE + WR_PREAMBLE + DFITMG1.dfi_t_cmd_lat (to adjust for CAL mode) WR_PREAMBLE = 1 (1tCK write preamble), 2 (2tCK write preamble) RD_PREAMBLE = 1 (1tCK read preamble), 2 (2tCK read preamble) If (CL - CWL - RD_PREAMBLE + WR_PREAMBLE) < 0, uMCTL2 does not support ODT for read operation. LPDDR3: - RL + RD(tDQSCK(min)/tCK) - 1 - RU(tODTon(max)/tCK) Unit: DFI PHY clock cycles. Programming Mode: Quasi-dynamic Group 1, Group 4 |
| 1-0 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

## 36.15.92 ODT/Rank Map (ODTMAP)

## Offset

| Register   | Offset   |
|------------|----------|
| ODTMAP     | 244h     |

## Diagram

<!-- image -->

## Fields

| Field              | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-14 -            | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 13-12 rank1_rd_odt | ODTs for read from rank 1 Turns on remote on-die terminations (ODTs) in the DRAM for a read from rank 1. Each rank has a remote ODT in the DRAM. Set a bit to 1 to turn on the ODT for the corresponding rank during a read from rank 1. Programming Mode: Static 00b - No ODTs during read from rank 1 01b - Rank 0 ODT on during read from rank 1 10b - Rank 1 ODT on during read from rank 1 11b - Both rank 0 and 1 ODTs on during read from rank 1 |
| 11-10 -            | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 9-8 rank1_wr_odt   | ODTs for write to rank 1 Turns on remote on-die terminations (ODTs) in the DRAMforawrite to rank 1. Each rank has a remoteODT in the DRAM. Set a bit to 1 to turn on the ODT for the corresponding rank during a write to rank 1. Programming Mode: Static                                                                                                                                                                                              |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field            | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                  | 00b - No ODTs during write to rank 1 01b - Rank 0 ODT on during write to rank 1 10b - Rank 1 ODT on during write to rank 1 11b - Both rank 0 and 1 ODTs on during write to rank 1                                                                                                                                                                                                                                                                       |
| 7-6 -            | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 5-4 rank0_rd_odt | ODTs for read from rank 0 Turns on remote on-die terminations (ODTs) in the DRAM for a read from rank 0. Each rank has a remote ODT in the DRAM. Set a bit to 1 to turn on the ODT for the corresponding rank during a read from rank 0. Programming Mode: Static 00b - No ODTs during read from rank 0 01b - Rank 0 ODT on during read from rank 0 10b - Rank 1 ODT on during read from rank 0 11b - Both rank 0 and 1 ODTs on during read from rank 0 |
| 3-2 -            | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 1-0 rank0_wr_odt | ODTs for write to rank 0 Turns on remote on-die terminations (ODTs) in the DRAMforawrite to rank 0. Each rank has a remoteODT in the DRAM. Set a bit to 1 to turn on the ODT for the corresponding rank during a write to rank 0. Programming Mode: Static 00b - No ODTs during write to rank 0 01b - Rank 0 ODT on during write to rank 0 10b - Rank 1 ODT on during write to rank 0 11b - Both rank 0 and 1 ODTs on during write to rank 0            |

## 36.15.93 Scheduler Control (SCHED)

## Offset

| Register   | Offset   |
|------------|----------|
| SCHED      | 250h     |

## Diagram

<!-- image -->

## Fields

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 30-24 rdwr_idle_gap  | Specifies the time interval, in DFI clock cycles, for the preferred transaction store to be empty before switching to the alternate transaction store, if the alternate store is not empty. The default preferred transaction store is the read (both low- and high-priority) transaction store. The alternative transaction store is the write transaction store. If prefer_write is set to 1, then the preferred and alternative stores are reversed: write is preferred and read is alternate. When this field is set to 0x00, transaction store switching happens immediately when the switching conditions become true. Affects performance only. NOTE Programming Mode: Static |
| 23-13 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 12-8 lpr_num_entries | Low-priority transaction store entries Specifies the number of entries in the low-priority transaction store minus 1. The number of entries available for the high-priority transaction store is (MEMC_NO_OF_ENTRY - (lpr_num_entries + 1)). Set to the maximum value to allocate all entries to the low-priority transaction store. Setting to 0 allocates one entry to the low-priority transaction store and the rest to the high-priority transaction store.                                                                                                                                                                                                                     |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field             | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                   | In ECC configurations, the numbers of Write credits and Low Priority Read credits issued are both one less than in non-ECC configurations. The MC reserves one entry each in the Write and Low Priority Read CAMS to store RMW requests resulting from single-bit error correction operation. NOTE Programming Mode: Static                                                                                                                                                                                                           |
| 7-3 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 2 pageclose       | Paging policy Specifies the paging policy for precharge operations. See Intelligent precharges for a complete explanation of the intertaction between pageclose and SCHED1[pageclose_timer]. Affects performance only. NOTE Programming Mode: Quasi-dynamic Group 3                                                                                                                                                                                                                                                                   |
| 1 prefer_write    | Prefer writes over reads Tells the bank selector to prefer writes over reads. For debug only. NOTE Programming Mode: Static 0b - No preference 1b - Prefer writes over reads                                                                                                                                                                                                                                                                                                                                                          |
| 0 force_low_pri_n | Force low priority Forces all incoming transactions to low priority. The MCtreats all High Priorority Read (HPR) and Variable Priority Read (VPR) commands as Low Priority Read (LPR) commands, and all Variable Priority Write (VPW) commands as Normal Priority Write (NPW) commands. This is an active low signal. Forcing incoming transactions to low priority implicitly turns off the Bypass path for read commands. Affects performance only. Programming Mode: Static 0b - Force low priority 1b - Do not force low priority |

## 36.15.94 Scheduler Control 1 (SCHED1)

## Offset

| Register   | Offset   |
|------------|----------|
| SCHED1     | 254h     |

## Diagram

<!-- image -->

## Fields

| Field                | Function                                                                                                                                                                                                                                                                                                                                |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-8 -               | Reserved                                                                                                                                                                                                                                                                                                                                |
| 7-0 pageclose_time r | Specifies the time interval, in DFI clock cycles, that a bank is kept open while there are page hit transactions in the CAM for that bank. See Intelligent precharges for a complete explanation of the intertaction between pageclose_timer and SCHED[pageclose]. Applies only if SCHED[pageclose] == 1. NOTE Programming Mode: Static |

## 36.15.95 High Priority Read CAM 1 (PERFHPR1)

## Offset

| Register   | Offset   |
|------------|----------|
| PERFHPR1   | 25Ch     |

DDR Subsystem

## Diagram

<!-- image -->

| Bits    | 31                  | 30                  | 29                  | 28                  | 27                  | 26                  | 25                  | 24                  | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
|---------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|----------|----------|----------|----------|----------|----------|----------|----------|
| R W     | hpr_xact_run_length | hpr_xact_run_length | hpr_xact_run_length | hpr_xact_run_length | hpr_xact_run_length | hpr_xact_run_length | hpr_xact_run_length | hpr_xact_run_length | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved |
| Reset   | 0                   | 0                   | 0                   | 0                   | 1                   | 1                   | 1                   | 1                   | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| Bits    | 15                  | 14                  | 13                  | 12                  | 11                  | 10                  | 9                   | 8                   | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R       |                     |                     |                     |                     |                     |                     |                     | hpr_max_starve      |          |          |          |          |          |          |          |          |
| W Reset | 0                   | 0                   | 0                   | 0                   | 0                   | 0                   | 0                   | 0                   | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 1        |

## Fields

| Field                      | Function                                                                                                                                                                                                                                                                                                                                                                                    |
|----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 hpr_xact_run_le ngth | HPR transactions after critical Specifies the number of transactions serviced after the HPR queue goes critical, as long as transactions are available. In other words, the number of transactions serviced after the HPR queue goes critical is the smaller of: • This value • The number of available transactions Affects performance only. NOTE Programming Mode: Quasi-dynamic Group 3 |
| 23-16 -                    | Reserved                                                                                                                                                                                                                                                                                                                                                                                    |
| 15-0 hpr_max_starve        | HPR maximimum starve interval Specifies the time interval, in DFI clock cycles, that the High Priority Read (HPR) queue can be starved before it goes critical. The minimum practical value for normal operation is 1h; a value of 0h disables the starvation function and results in excessive latencies. Affects performance only. NOTE Programming Mode: Quasi-dynamic Group 3           |

DDR Subsystem

## 36.15.96 Low Priority Read CAM 1 (PERFLPR1)

## Offset

| Register   | Offset   |
|------------|----------|
| PERFLPR1   | 264h     |

## Diagram

<!-- image -->

## Fields

| Field                      | Function                                                                                                                                                                                                                                                                                                                                                                                    |
|----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 lpr_xact_run_len gth | LPR transactions after critical Specifies the number of transactions serviced after the LPR queue goes critical, as long as transactions are available. In other words, the number of transactions serviced after the LPR queue goes critical is the smaller of: • This value • The number of available transactions Affects performance only. NOTE Programming Mode: Quasi-dynamic Group 3 |
| 23-16 -                    | Reserved                                                                                                                                                                                                                                                                                                                                                                                    |
| 15-0 lpr_max_starve        | LPR maximimum starve interval Specifies the time interval, in DFI clock cycles, that the LowPriorityRead(LPR)queuecanbestarvedbefore it goes critical. The minimum practical value for normal operation is 1h; a value of 0h disables the starvation function and results in excessive latencies.                                                                                           |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field   | Function                                |
|---------|-----------------------------------------|
|         | Programming Mode: Quasi-dynamic Group 3 |

## 36.15.97 Write CAM 1 (PERFWR1)

## Offset

| Register   | Offset   |
|------------|----------|
| PERFWR1    | 26Ch     |

<!-- image -->

## Fields

<!-- image -->

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                  |
|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 w_xact_run_len gth | WR transactions after critical Specifies the number of transactions serviced after the WR queue goes critical, as long as transactions are available. In other words, the number of transactions serviced after the LPR queue goes critical is the smaller of: • This value • The number of available transactions Affects performance only. NOTE Programming Mode: Quasi-dynamic Group 3 |
| 23-16                    | Reserved                                                                                                                                                                                                                                                                                                                                                                                  |

Table continues on the next page...

Table continued from the previous page...

| Field             | Function                                                                                                                                                                                                                                                                                                                                                           |
|-------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -                 |                                                                                                                                                                                                                                                                                                                                                                    |
| 15-0 w_max_starve | WR maximimum starve interval Specifies the time interval, in DFI clock cycles, that the Write (WR) queue can be starved before it goes critical. The minimum practical value for normal operation is 1h; a value of 0h disables the starvation function and results in excessive latencies. Affects performance only. NOTE Programming Mode: Quasi-dynamic Group 3 |

## 36.15.98 Debug 0 (DBG0)

## Offset

| Register   | Offset   |
|------------|----------|
| DBG0       | 300h     |

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                                      |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-5    | Reserved                                                                                                                                                                                                      |
| 4       | When this is set to '0', auto-precharge is disabled for the flushed command in a collision case. Collision cases are write followed by read to same address, read followed by write to same address, or write |

Table continues on the next page...

Table continued from the previous page...

| Field                   | Function                                                                                                                                                                                      |
|-------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| dis_collision_pa ge_opt | followed by write to same address with DBG0.dis_wc bit = 1 (where same address comparisons exclude the two address bits representing critical word). FOR DEBUG ONLY. Programming Mode: Static |
| 3-1                     | Reserved                                                                                                                                                                                      |
| 0 dis_wc                | When 1, disable write combine. FOR DEBUG ONLY Programming Mode: Static                                                                                                                        |

## 36.15.99 Debug 1 (DBG1)

## Offset

| Register   | Offset   |
|------------|----------|
| DBG1       | 304h     |

<!-- image -->

## Fields

| Field     | Function                                                                                                                                                                                                                                                                              |
|-----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-2 -    | Reserved                                                                                                                                                                                                                                                                              |
| 1 dis_hif | When 1, uMCTL2 asserts the HIF command signal hif_cmd_stall. uMCTL2 will ignore the hif_cmd_valid and all other associated request signals. This bit is intended to be switched on-the-fly. Programming Mode: Dynamic                                                                 |
| 0 dis_dq  | When 1, uMCTL2 will not de-queue any transactions from the CAM. Bypass is also disabled. All transactions are queued in the CAM. No reads or writes are issued to DRAM as long as this is asserted. This bit may be used to prevent reads or writes being issued by the uMCTL2, which |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | makes it safe to modify certain register fields associated with reads and writes (see User Guide for details). After setting this bit, it is strongly recommended to poll DBGCAM.wr_data_pipeline_empty and DBGCAM.rd_data_pipeline_empty, before making changes to any registers which affect reads and writes. This will ensure that the relevant logic in the MC is idle. This bit is intended to be switched on-the-fly. Programming Mode: Dynamic |

## 36.15.100 CAM Debug (DBGCAM)

## Offset

| Register   | Offset   |
|------------|----------|
| DBGCAM     | 308h     |

## Diagram

<!-- image -->

## Fields

| Field                      | Function                                                                                                                                                                                                                                             |
|----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-30 -                    | Reserved                                                                                                                                                                                                                                             |
| 29 wr_data_pipelin e_empty | This bit indicates that the write data pipeline on the DFI interface is empty. This register is intended to be polled at least twice after setting DBG1.dis_dq, to ensure that all remaining commands/data have completed. Programming Mode: Dynamic |
| 28 rd_data_pipelin e_empty | This bit indicates that the read data pipeline on the DFI interface is empty. This register is intended to be polled at least twice after setting DBG1.dis_dq, to ensure that all remaining commands/data have completed. Programming Mode: Dynamic  |
| 27                         | Reserved                                                                                                                                                                                                                                             |

Table continues on the next page...

## Table continued from the previous page...

| Field                 | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 26 dbg_wr_q_empt y    | This field is used for debug purposes. When its value is 1, all the write command queues and write data buffers inside the memory controller are empty. With the field's value as 1, if the controller enters Self-Refresh mode using the low-power entry sequence, it is expected to have executed all the commandsinits queues, with the write andreaddata drained. However, you can write 1 both to this field and the DBGCAM.[dbg_rd_q_empty] field only when there are no reads and writes in the DDRcontroller. Therefore, you need to monitor both these fields simultaneously to get the status of the pending transactions in uMCTL2. |
| 25 dbg_rd_q_empt y    | This field is used for debug purposes. When its value is 1, all the read command queues and read data buffers inside the memory controller are empty. With the field's value as 1, if the controller enters Self-Refresh mode using the low-power entry sequence, it is expected to have executed all the commandsinits queues, with the write andreaddata drained. However, you can write 1 both to this field and the DBGCAM.[dbg_wr_q_empty] field only when there are no reads and writes in the DDRcontroller. Therefore, you need to monitor both these fields simultaneously to get the status of the pending transactions in uMCTL2.   |
| 24 dbg_stall          | Stall FOR DEBUG ONLY Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 23-22 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 21-16 dbg_w_q_depth   | Write queue depth The last entry of WR queue is reserved for ECC SCRUB operation. This entry is not included in the calculation of the queue depth. FOR DEBUG ONLY Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 15-14 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 13-8 dbg_lpr_q_dept h | Low priority read queue depth The last entry of Lpr queue is reserved for ECC SCRUB operation. This entry is not included in the calculation of the queue depth. FOR DEBUG ONLY Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 7-6 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 5-0 dbg_hpr_q_dept h  | High priority read queue depth FOR DEBUG ONLY Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

## 36.15.101 Command Debug (DBGCMD)

## Offset

| Register   | Offset   |
|------------|----------|
| DBGCMD     | 30Ch     |

## Diagram

<!-- image -->

## Fields

| Field            | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-6 -           | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 5 ctrlupd        | Setting this register bit to 1 indicates to the uMCTL2 to issue a dfi_ctrlupd_req to the PHY. When this request is stored in the uMCTL2, the bit is automatically cleared. This operation must only be performed when DFIUPD0.dis_auto_ctrlupd=1. Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 4 zq_calib_short | Setting this register bit to 1 indicates to the uMCTL2 to issue a ZQCS (ZQ calibration short)/MPC(ZQ calibration) command to the DRAM. When this request is stored in the uMCTL2, the bit is automatically cleared. This operation can be performed only when ZQCTL0.dis_auto_zq=1. It is recommended NOT to set this register bit if in Init, in Self-Refresh(except LPDDR4) or SR-Powerdown(LPDDR4) or Deep power-down operating modes or Maximum Power Saving Mode. For Self-Refresh(except LPDDR4) or SR-Powerdown(LPDDR4) it will be scheduled after SR(except LPDDR4) or SPRD(LPDDR4) has been exited. For Deep power down and Maximum Power Saving Mode, it will not be scheduled, although DBGSTAT.zq_calib_short_busy will be de-asserted. Programming Mode: Dynamic |
| 3-2 -            | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 1 rank1_refresh  | Setting this register bit to 1 indicates to the uMCTL2 to issue a refresh to rank 1. Writing to this bit causes DBGSTAT.rank1_refresh_busy to be set. When DBGSTAT.rank1_refresh_busy is cleared, the command has been stored in uMCTL2. For 3DS configuration, refresh is sent to rank index 1. This operation can be performed only when RFSHCTL3.dis_auto_refresh=1. It is recommended NOT to set this register bit if in Init or Deep power-down operating modes or Maximum Power Saving Mode. Programming Mode: Dynamic                                                                                                                                                                                                                                                  |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field           | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|-----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 rank0_refresh | Setting this register bit to 1 indicates to the uMCTL2 to issue a refresh to rank 0. Writing to this bit causes DBGSTAT.rank0_refresh_busy to be set. When DBGSTAT.rank0_refresh_busy is cleared, the command has been stored in uMCTL2. For 3DS configuration, refresh is sent to rank index 0. This operation can be performed only when RFSHCTL3.dis_auto_refresh=1. It is recommended NOT to set this register bit if in Init or Deep power-down operating modes or Maximum Power Saving Mode. Programming Mode: Dynamic |

## 36.15.102 Status Debug (DBGSTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| DBGSTAT    | 310h     |

<!-- image -->

## Fields

| Field                  | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-6 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 5 ctrlupd_busy         | SoC core may initiate a ctrlupd operation only if this signal is low. This signal goes high in the clock after the uMCTL2 accepts the ctrlupd request. It goes low when the ctrlupd operation is initiated in the uMCTL2. It is recommended not to perform ctrlupd operations when this signal is high. - 0 - Indicates that the SoC core can initiate a ctrlupd operation - 1 - Indicates that ctrlupd operation has not been initiated yet in the uMCTL2 Programming Mode: Dynamic |
| 4 zq_calib_short_ busy | SoC core may initiate a ZQCS (ZQ calibration short) operation only if this signal is low. This signal goes high in the clock after the uMCTL2 accepts the ZQCS request. It goes low when the ZQCS operation is initiated in the uMCTL2. It is recommended not to perform ZQCS operations when this signal is high. - 0                                                                                                                                                               |

Table continues on the next page...

Table continued from the previous page...

| Field                 | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                       | - Indicates that the SoC core can initiate a ZQCS operation - 1 - Indicates that ZQCS operation has not been initiated yet in the uMCTL2 Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                     |
| 3-2 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 1 rank1_refresh_b usy | SoC core may initiate a rank1_refresh operation (refresh operation to rank 1) only if this signal is low. This signal goes high in the clock after DBGCMD.rank1_refresh is set to one. It goes low when the rank1_refresh operation is stored in the uMCTL2. It is recommended not to perform rank1_refresh operations when this signal is high. - 0 - Indicates that the SoC core can initiate a rank1_refresh operation - 1 - Indicates that rank1_refresh operation has not been stored yet in the uMCTL2 Programming Mode: Dynamic |
| 0 rank0_refresh_b usy | SoC core may initiate a rank0_refresh operation (refresh operation to rank 0) only if this signal is low. This signal goes high in the clock after DBGCMD.rank0_refresh is set to one. It goes low when the rank0_refresh operation is stored in the uMCTL2. It is recommended not to perform rank0_refresh operations when this signal is high. - 0 - Indicates that the SoC core can initiate a rank0_refresh operation - 1 - Indicates that rank0_refresh operation has not been stored yet in the uMCTL2 Programming Mode: Dynamic |

## 36.15.103 CAM Debug 1 (DBGCAM1)

## Offset

| Register   | Offset   |
|------------|----------|
| DBGCAM1    | 318h     |

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                       |
|---------|----------------------------------------------------------------|
| 31-6    | Reserved                                                       |
| 5-0     | Write ECC queue depth FOR DEBUG ONLY Programming Mode: Dynamic |

## 36.15.104 Software Register Programming Control Enable (SWCTL)

## Offset

| Register   | Offset   |
|------------|----------|
| SWCTL      | 320h     |

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                                                                                                                                        |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-1      | Reserved                                                                                                                                                                                        |
| 0 sw_done | Enable quasi-dynamic register programming outside reset. Program register to 0 to enable quasi- dynamic programming. Set back register to 1 once programming is done. Programming Mode: Dynamic |

DDR Subsystem

## 36.15.105 Software Register Programming Control Status (SWSTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| SWSTAT     | 324h     |

## Diagram

<!-- image -->

## Fields

| Field         | Function                                                                                                                                                                                                                                                                                 |
|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-1          | Reserved                                                                                                                                                                                                                                                                                 |
| 0 sw_done_ack | Register programming done. This register is the echo of SWCTL.sw_done. Wait for sw_done value 1 to propagate to sw_done_ack at the end of the programming sequence to ensure that the correct registers values are propagated to the destination clock domains. Programming Mode: Static |

## 36.15.106 On-Chip Parity Configuration 0 (OCPARCFG0)

## Offset

| Register   | Offset   |
|------------|----------|
| OCPARCFG0  | 330h     |

DDR Subsystem

## Diagram

<!-- image -->

## Fields

| Field                        | Function                                                                                                                                                                |
|------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-27 -                      | Reserved                                                                                                                                                                |
| 26 par_raddr_err_i ntr_force | Interrupt force bit for all par_raddr_err_intr. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                         |
| 25 par_waddr_err_i ntr_force | Interrupt force bit for all par_waddr_err_intr. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                         |
| 24 par_raddr_err_i ntr_clr   | Interrupt clear bit for all par_raddr_err_intr. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                         |
| 23 par_raddr_err_i ntr_en    | Enables interrupt generation, if set to 1, for all ports, on signal par_raddr_err_intr_n upon detection of parity error on the AXI interface. Programming Mode: Dynamic |
| 22 par_waddr_err_i ntr_clr   | Interrupt clear bit for all par_waddr_err_intr. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                         |
| 21 par_waddr_err_i ntr_en    | Enables interrupt generation, if set to 1, for all ports, on signal par_waddr_err_intr_n upon detection of parity error on the AXI interface. Programming Mode: Dynamic |
| 20                           | Enables SLVERR generation on read response or write response when address parity error is detected at the AXI interface. Programming Mode: Quasi-dynamic Group 3        |

Table continues on the next page...

## Table continued from the previous page...

| Field                        | Function                                                                                                                                                                |
|------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| par_addr_slverr _en          |                                                                                                                                                                         |
| 19-16 -                      | Reserved                                                                                                                                                                |
| 15 par_rdata_err_in tr_force | Interrupt force bit for all par_rdata_err_intr_n and par_rdata_in_err_ecc_intr (Inline-ECC only). uMCTL2 automatically clears this bit. Programming Mode: Dynamic       |
| 14 par_rdata_err_in tr_clr   | Interrupt clear bit for par_rdata_err_intr. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                             |
| 13 par_rdata_err_in tr_en    | Enables interrupt generation, if set to 1, for all ports, on signal par_rdata_err_intr_n upon detection of parity error at the AXI interface. Programming Mode: Dynamic |
| 12 par_rdata_slverr _en      | Enables SLVERR generation on read response when read data parity error is detected at the AXI interface. Programming Mode: Quasi-dynamic Group 3                        |
| 11-8 -                       | Reserved                                                                                                                                                                |
| 7 par_wdata_err_i ntr_force  | Interrupt force bit for par_wdata_err_intr. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                             |
| 6 par_wdata_err_i ntr_clr    | Interrupt clear bit for par_wdata_err_intr. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                             |
| 5 par_wdata_slver r_en       | Enables SLVERR generation on write response when write data parity error is detected at the AXI interface. Programming Mode: Quasi-dynamic Group 3                      |
| 4 par_wdata_err_i ntr_en     | Enables write data interrupt generation (par_wdata_err_intr) upon detection of parity error at the AXI or DFI interface. Programming Mode: Dynamic                      |
| 3-2 -                        | Reserved                                                                                                                                                                |

Table continues on the next page...

Table continued from the previous page...

| Field            | Function                                                                                                   |
|------------------|------------------------------------------------------------------------------------------------------------|
| 1 oc_parity_type | Parity type: - 0: Even parity - 1: Odd parity Programming Mode: Quasi-dynamic Group 3                      |
| 0 oc_parity_en   | Parity enable register. Enables On-Chip parity for all interfaces. Programming Mode: Quasi-dynamic Group 3 |

## 36.15.107 On-Chip Parity Configuration 1 (OCPARCFG1)

## Offset

<!-- image -->

## Fields

| Field                        | Function                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-12 -                      | Reserved                                                                                                                                                                                                                                                                                                                                                                                 |
| 11-8 par_poison_loc_ wr_port | Enables parity poisoning on write data at the AXI interface before the input parity check logic. The value specifies the binary encoded port number of the AXI interface to be injected with parity error. Programming Mode: Quasi-dynamic Group 3                                                                                                                                       |
| 7-4 par_poison_loc_ rd_port  | Enables parity poisoning on read data at the AXI interface after the parity check logic. The value specifies the binary encoded port number of the AXI interface to be injected with parity error. Error can be injected to one port at a time. An error injected here is not logged and does not trigger SLVERR or interrupt by the controller. Programming Mode: Quasi-dynamic Group 3 |

Table continues on the next page...

Table continued from the previous page...

| Field                          | Function                                                                                                                                                                                                                                                                                                                           |
|--------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 3 par_poison_loc_ rd_iecc_type | Selects which parity to poison at the DFI when inline ECC is enabled. If this register is set to 0, parity error is injected on the first read data going through the ECC path; if this register is set to 1, parity error is injected on the first read data going through the data path. Programming Mode: Quasi-dynamic Group 3 |
| 2 par_poison_loc_ rd_dfi       | Enables parity poisoning on read data at the DFI interface after the parity generation logic, and when MEMC_INLINE_ECC=1 enables poisoning of ECC word after the ECC encoder at the write data interface at the DFI. Programming Mode: Quasi-dynamic Group 3                                                                       |
| 1 -                            | Reserved                                                                                                                                                                                                                                                                                                                           |
| 0 par_poison_en                | Enables on-chip parity poisoning on the data interfaces. Programming Mode: Quasi-dynamic Group 3                                                                                                                                                                                                                                   |

## 36.15.108 On-Chip Parity Status 0 (OCPARSTAT0)

## Offset

| Register   | Offset   |
|------------|----------|
| OCPARSTAT0 | 338h     |

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-19   | Reserved   |

Table continues on the next page...

## Table continued from the previous page...

| Field                    | Function                                                                                                                                                                                                        |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 18 par_raddr_err_i ntr_2 | Read address parity error interrupt for port 2. This interrupt is asserted when an on-chip read address parity error occurred on the corresponding AXI port's read address channel. Programming Mode: Static    |
| 17 par_raddr_err_i ntr_1 | Read address parity error interrupt for port 1. This interrupt is asserted when an on-chip read address parity error occurred on the corresponding AXI port's read address channel. Programming Mode: Static    |
| 16 par_raddr_err_i ntr_0 | Read address parity error interrupt for port 0. This interrupt is asserted when an on-chip read address parity error occurred on the corresponding AXI port's read address channel. Programming Mode: Static    |
| 15-3 -                   | Reserved                                                                                                                                                                                                        |
| 2 par_waddr_err_i ntr_2  | Write address parity error interrupt for port 2. This interrupt is asserted when an on-chip write address parity error occurred on the corresponding AXI port's write address channel. Programming Mode: Static |
| 1 par_waddr_err_i ntr_1  | Write address parity error interrupt for port 1. This interrupt is asserted when an on-chip write address parity error occurred on the corresponding AXI port's write address channel. Programming Mode: Static |
| 0 par_waddr_err_i ntr_0  | Write address parity error interrupt for port 0. This interrupt is asserted when an on-chip write address parity error occurred on the corresponding AXI port's write address channel. Programming Mode: Static |

## 36.15.109 On-Chip Parity Status 1 (OCPARSTAT1)

## Offset

| Register   | Offset   |
|------------|----------|
| OCPARSTAT1 | 33Ch     |

## Diagram

<!-- image -->

## Fields

| Field                      | Function                                                                                                                                                                                                                                                                                            |
|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-19 -                    | Reserved                                                                                                                                                                                                                                                                                            |
| 18 par_rdata_err_in tr_2   | Read data parity error interrupt for port 2. This interrupt is asserted when an on-chip read data parity error occurred on the corresponding AXI port's read data channel. Bit 0 corresponds to Port 0, and so on. Cleared by register par_rdata_err_intr_clr. Programming Mode: Static             |
| 17 par_rdata_err_in tr_1   | Read data parity error interrupt for port 1. This interrupt is asserted when an on-chip read data parity error occurred on the corresponding AXI port's read data channel. Bit 0 corresponds to Port 0, and so on. Cleared by register par_rdata_err_intr_clr. Programming Mode: Static             |
| 16 par_rdata_err_in tr_0   | Read data parity error interrupt for port 0. This interrupt is asserted when an on-chip read data parity error occurred on the corresponding AXI port's read data channel. Bit 0 corresponds to Port 0, and so on. Cleared by register par_rdata_err_intr_clr. Programming Mode: Static             |
| 15-3 -                     | Reserved                                                                                                                                                                                                                                                                                            |
| 2 par_wdata_in_e rr_intr_2 | Write data parity error interrupt on input for port 2. This interrupt is asserted when an on-chip write data parity error occurred on the corresponding AXI port's write data channel. Bit 0 corresponds to Port 0, and so on. Cleared by register par_wdata_err_intr_clr. Programming Mode: Static |
| 1 par_wdata_in_e rr_intr_1 | Write data parity error interrupt on input for port 1. This interrupt is asserted when an on-chip write data parity error occurred on the corresponding AXI port's write data channel. Bit 0 corresponds to Port 0, and so on. Cleared by register par_wdata_err_intr_clr. Programming Mode: Static |
| 0 par_wdata_in_e rr_intr_0 | Write data parity error interrupt on input for port 0. This interrupt is asserted when an on-chip write data parity error occurred on the corresponding AXI port's write data channel. Bit 0 corresponds to Port 0, and so on. Cleared by register par_wdata_err_intr_clr. Programming Mode: Static |

DDR Subsystem

## 36.15.110 On-Chip Parity Status 2 (OCPARSTAT2)

## Offset

| Register   | Offset   |
|------------|----------|
| OCPARSTAT2 | 340h     |

## Diagram

<!-- image -->

## Fields

| Field                        | Function                                                                                                          |
|------------------------------|-------------------------------------------------------------------------------------------------------------------|
| 31-5 -                       | Reserved                                                                                                          |
| 4 par_rdata_in_err _ecc_intr | Interrupt on ECC data going into inline ECC decoder. Cleared by par_rdata_err_intr_clr. Programming Mode: Static  |
| 3-2 -                        | Reserved                                                                                                          |
| 1-0 par_wdata_out_ err_intr  | Write data parity error interrupt on output. Cleared by register par_wdata_err_intr_clr. Programming Mode: Static |

## 36.15.111 AXI Poison Configuration (POISONCFG)

## Offset

| Register   | Offset   |
|------------|----------|
| POISONCFG  | 36Ch     |

DDR Subsystem

## Function

Common for all AXI ports

## Diagram

<!-- image -->

## Fields

| Field                  | Function                                                                                                                                                                                                                                  |
|------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-25 -                | Reserved                                                                                                                                                                                                                                  |
| 24 rd_poison_intr_c lr | Read poison interrupt clear Clears read transaction poisoning interrupts. Allow two to three clock cycles for the core to clear the interrupts. The MC clears this bit automatically. Programming Mode: Dynamic 0b - No effect 1b - Clear |
| 23-21 -                | Reserved                                                                                                                                                                                                                                  |
| 20 rd_poison_intr_ en  | Read poison interrupt enable Enables interrupts for read transaction poisoning. Programming Mode: Dynamic 0b - Disable 1b - Enable                                                                                                        |
| 19-17 -                | Reserved                                                                                                                                                                                                                                  |
| 16                     | Read SLVERR enable Enables the AXI slave error (SLVERR) response for read transaction poisoning.                                                                                                                                          |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field                  | Function                                                                                                                                                                                                                                    |
|------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| rd_poison_slver r_en   | Programming Mode: Dynamic 0b - Disable 1b - Enable                                                                                                                                                                                          |
| 15-9 -                 | Reserved                                                                                                                                                                                                                                    |
| 8 wr_poison_intr_ clr  | Write poison interrupt clear Clears write transaction poisoning interrupts. Allow two to three clock cycles for the core to clear the interrupts. The MC clears this bit automatically. Programming Mode: Dynamic 0b - No effect 1b - Clear |
| 7-5 -                  | Reserved                                                                                                                                                                                                                                    |
| 4 wr_poison_intr_ en   | Write poison interrupt enable Enables interrupts for write transaction poisoning. Programming Mode: Dynamic 0b - Disable 1b - Enable                                                                                                        |
| 3-1 -                  | Reserved                                                                                                                                                                                                                                    |
| 0 wr_poison_slver r_en | Write SLVERR enable Enables the AXI slave error (SLVERR) response for write transaction poisoning. Programming Mode: Dynamic 0b - Disable 1b - Enable                                                                                       |

## 36.15.112 AXI Poison Status (POISONSTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| POISONSTAT | 370h     |

## Diagram

<!-- image -->

## Fields

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                            |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-19 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                            |
| 18 rd_poison_intr_ 2 | Read transaction poisoning error interrupt for port 2. This register is a APB clock copy (double register synchronizer) of the interrupt asserted when a transaction is poisoned on the corresponding AXI port's read address channel. Bit 0 corresponds to Port 0, and so on. Interrupt is cleared by register rd_poison_intr_clr, then value propagated to APB clock. Programming Mode: Dynamic   |
| 17 rd_poison_intr_ 1 | Read transaction poisoning error interrupt for port 1. This register is a APB clock copy (double register synchronizer) of the interrupt asserted when a transaction is poisoned on the corresponding AXI port's read address channel. Bit 0 corresponds to Port 0, and so on. Interrupt is cleared by register rd_poison_intr_clr, then value propagated to APB clock. Programming Mode: Dynamic   |
| 16 rd_poison_intr_ 0 | Read transaction poisoning error interrupt for port 0. This register is a APB clock copy (double register synchronizer) of the interrupt asserted when a transaction is poisoned on the corresponding AXI port's read address channel. Bit 0 corresponds to Port 0, and so on. Interrupt is cleared by register rd_poison_intr_clr, then value propagated to APB clock. Programming Mode: Dynamic   |
| 15-3 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                            |
| 2 wr_poison_intr_ 2  | Write transaction poisoning error interrupt for port 2. This register is a APB clock copy (double register synchronizer) of the interrupt asserted when a transaction is poisoned on the corresponding AXI port's write address channel. Bit 0 corresponds to Port 0, and so on. Interrupt is cleared by register wr_poison_intr_clr, then value propagated to APB clock. Programming Mode: Dynamic |
| 1 wr_poison_intr_ 1  | Write transaction poisoning error interrupt for port 1. This register is a APB clock copy (double register synchronizer) of the interrupt asserted when a transaction is poisoned on the corresponding AXI port's write address channel. Bit 0 corresponds to Port 0, and so on. Interrupt is cleared by register wr_poison_intr_clr, then value propagated to APB clock. Programming Mode: Dynamic |
| 0 wr_poison_intr_ 0  | Write transaction poisoning error interrupt for port 0. This register is a APB clock copy (double register synchronizer) of the interrupt asserted when a transaction is poisoned on the corresponding AXI port's write address channel. Bit 0 corresponds to Port 0, and so on. Interrupt is cleared by register wr_poison_intr_clr, then value propagated to APB clock. Programming Mode: Dynamic |

DDR Subsystem

## 36.15.113 Address protection within ECC Status (ECCAPSTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| ECCAPSTAT  | 388h     |

## Diagram

<!-- image -->

## Fields

| Field        | Function                                                                                                                                                         |
|--------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-1         | Reserved                                                                                                                                                         |
| 0 ecc_ap_err | Indicates the number of ECC errors (correctable/uncorrectable) within one burst exceeded the threshold. (ECCCFG0.ecc_ap_err_threshold) Programming Mode: Dynamic |

## 36.15.114 Register parity configuration (REGPARCFG)

## Offset

| Register   | Offset   |
|------------|----------|
| REGPARCFG  | 3C0h     |

## Function

(Note that all fields must be programmed with single write operation)

DDR Subsystem

## Diagram

<!-- image -->

## Fields

| Field                     | Function                                                                                                                                                                                                                                                                                                     |
|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-9 -                    | Reserved                                                                                                                                                                                                                                                                                                     |
| 8 reg_par_poison _en      | Enable register parity poisoning. Programming Mode: Dynamic, Quasi-Dynamic and static registers.                                                                                                                                                                                                             |
| 7-4 -                     | Reserved                                                                                                                                                                                                                                                                                                     |
| 3 reg_par_err_intr _force | Interrupt force bit for reg_par_err_intr, setting this register will cause the output interrupt to be asserted. uMCTL2 automatically clears this bit. There is no interaction between functionally triggering an interrupt and forcing an interrupt (they are mutually exclusive). Programming Mode: Dynamic |
| 2 reg_par_err_intr _clr   | Interupt clear bit for reg_par_err_intr. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                                                                                                                                                                     |
| 1 reg_par_err_intr _en    | Enables interrupt generation, if set to 1, on signal reg_par_err_intr upon detection of register parity error. Programming Mode: Dynamic                                                                                                                                                                     |
| 0 reg_par_en              | Register parity enable register. Programming Mode: Dynamic                                                                                                                                                                                                                                                   |

DDR Subsystem

## 36.15.115 Register parity status (REGPARSTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| REGPARSTAT | 3C4h     |

## Diagram

<!-- image -->

## Fields

| Field              | Function                                                                                                                                    |
|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| 31-1               | Reserved                                                                                                                                    |
| 0 reg_par_err_intr | Interrupt asserted when Register Parity error is detected. Cleared by setting REGPARCFG.reg_par_err_intr_clr to 1. Programming Mode: Static |

## 36.15.116 On-Chip command/Address Protection Configuration (OCCAPCFG)

## Offset

| Register   | Offset   |
|------------|----------|
| OCCAPCFG   | 3E0h     |

DDR Subsystem

## Diagram

<!-- image -->

## Fields

| Field                             | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|-----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -                           | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 27 occap_arb_raq_ poison_en       | Enables poisoning for the Read Address Queues (RAQ) inside each XPI. Poisoning inverts all parity bits generated by the parity generator. Error will be flagged as soon as the first RAQ is read. This register is not cleared automatically and must be reprogrammed to 0 at the end of the operation. Programming Mode: Dynamic                                                                                                                                                         |
| 26 occap_arb_cmp _poison_err_inj  | Enable error injection in the poisoning of OCCAP Arbiter logic Injects error into poisoning logic (either parallel or seq) such that XOR logic for one signal is not poisoned when expected. If set, it allows ability to corrupt the following register fields. - 1'b0: OCCAPSTAT.occap_arb_poison_parallel/seq_err=0 - 1'b1: OCCAPSTAT.occap_arb_poison_parallel/seq_err=1 Do not change value in same APB write as setting of occap_arb_poison_parallel/_seq Programming Mode: Dynamic |
| 25 occap_arb_cmp _poison_parallel | Enables full poisoning for compare logic inside XPI. Poisoning inverts all bits of all outputs coming from the duplicated modules before the XOR comparators together. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                                                                                                                                                                                                                    |
| 24 occap_arb_cmp _poison_seq      | Enables poisoning for compare logic inside XPI. Poisoning inverts all bits coming from the duplicated modules before the XOR comparators one output at the time per each comparator. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                                                                                                                                                                                                      |
| 23-19 -                           | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 18 occap_arb_intr_ force          | Interrupt force bit for occap_arb_err_intr, setting this register will cause the output interrupt to be asserted. uMCTL2 automatically clears this bit. There is no interaction between functionally triggering an interrupt and forcing an interrupt (they are mutually exclusive). Programming Mode: Dynamic                                                                                                                                                                            |
| 17 occap_arb_intr_ clr            | Interrupt clear bit for occap_arb_err_intr and occap_arb_cmp_poison_complete. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                             |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field                 | Function                                                                                                  |
|-----------------------|-----------------------------------------------------------------------------------------------------------|
| 16 occap_arb_intr_ en | Enables interrupt generation upon detection of OCCAP Arbiter errors. Programming Mode: Dynamic            |
| 15-1 -                | Reserved                                                                                                  |
| 0 occap_en            | On Chip Command/Address Path Protection (OCCAP) enable register. Programming Mode: Quasi- dynamic Group 3 |

## 36.15.117 On-Chip command/Address Protection Status (OCCAPSTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| OCCAPSTAT  | 3E4h     |

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                     |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-26   | Reserved                                                                                                                                                                                                                                                                                     |
| 25      | Error when occap_arb_cmp_poison_full_en was active due to incorrect no. of errors being occurring. Internal logic checks the number of errors detected while poisoning occurred for occap_arb_cmp_poison_full_en. It checks for error on all of the the corresponding XOR outputs. If multi- |

Table continues on the next page...

Table continued from the previous page...

| Field                               | Function                                                                                                                                                                                                                                                                                                                                                                    |
|-------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| occap_arb_cmp _poison_parallel _err | bit, checks also that all XOR bits are set. Register is valid when occap_arb_cmp_poison_complete=1. Programming Mode: Static                                                                                                                                                                                                                                                |
| 24 occap_arb_cmp _poison_seq_er r   | Error when occap_arb_cmp_poison_en was active due to incorrect no. of errors being occurring. Internal logic checks that the correct number of errors detected while poisoning one output at the time occurred for occap_arb_cmp_poison_en. It checks for error on one output at the time. Register is valid when occap_arb_cmp_poison_complete=1. Programming Mode: Static |
| 23-18 -                             | Reserved                                                                                                                                                                                                                                                                                                                                                                    |
| 17 occap_arb_cmp _poison_comple te  | OCCAP ARB comparator poisoning complete interrupt status. Register cleared by OCCAPCFG.occap_arb_intr_clr. Programming Mode: Static                                                                                                                                                                                                                                         |
| 16 occap_arb_err_i ntr              | OCCAP Arbiter error interrupt status. Register cleared by OCCAPCFG.occap_arb_intr_clr. Programming Mode: Static                                                                                                                                                                                                                                                             |
| 15-0 -                              | Reserved                                                                                                                                                                                                                                                                                                                                                                    |

## 36.15.118 On-Chip command/Address Protection Configuration 1 (OCCAPCFG1)

## Offset

| Register   | Offset   |
|------------|----------|
| OCCAPCFG1  | 3E8h     |

## Diagram

<!-- image -->

## Fields

| Field                               | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-27 -                             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 26 occap_ddrc_ctrl _poison_err_inj  | Enable error injection in the poisoning of OCCAP MC CTRL logic Injects error into poisoning logic (either parallel or seq) such that XOR logic for one signal is not poisoned when expected. If set, it allows ability to corrupt the following register fields. - 1'b0: OCCAPSTAT1.occap_ddrc_ctrl_poison_parallel/seq_err=0 - 1'b1: OCCAPSTAT1.occap_ddrc_ctrl_poison_parallel/seq_err=1 Do not change value in same APB write as setting of occap_ddrc_ctrl_poison_parallel/_seq Programming Mode: Dynamic                    |
| 25 occap_ddrc_ctrl _poison_parallel | Enables poisoning of OCCAP MC CTRL logic for all parts of comparison logic, in parallel. Poisons comparison logic for one core_ddrc_core_clk cycle by inverting a ddrc_ctrl[0]'s signal to XOR logic. ddrc_ctrl[1] related signals are never poisoned. All signals are poisoned in parallel and checks if all signals were poisoned correctly. If this is not the case, this is flagged by OCCAPSTAT1.occap_ddrc_ctrl_poison_parallel_err=1. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                     |
| 24 occap_ddrc_ctrl _poison_seq      | Enables poisoning of OCCAP MC CTRL logic for all parts of comparison logic, in sequence. Poisons comparison logic for one core_ddrc_core_clk cycle by inverting a ddrc_ctrl[0]'s signal to XOR logic. ddrc_ctrl[1] related signals are never poisoned. Each signal from ddrc_ctrl[0] is poisoned in series and checks in turn, that each signal was poisoned correctly. If this is not the case, this is flagged by OCCAPSTAT1.occap_ddrc_ctrl_poison_seq_err=1. uMCTL2 automatically clears this bit. Programming Mode: Dynamic |
| 23-19 -                             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 18 occap_ddrc_ctrl _intr_force      | Interrupt force bit for occap_ddrc_ctrl_err_intr, setting this register will cause the output interrupt to be asserted. uMCTL2 automatically clears this bit. There is no interaction between functionally triggering an interrupt and forcing an interrupt (they are mutually exclusive). Programming Mode: Dynamic                                                                                                                                                                                                             |
| 17 occap_ddrc_ctrl _intr_clr        | Interrupt clear bit for occap_ddrc_ctrl_err_intr. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                                                |
| 16 occap_ddrc_ctrl _intr_en         | Enables interrupt generation on signal occap_ddrc_ctrl_err_intr upon detection of OCCAP MC CTRL errors. Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                                |
| 15-11 -                             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 10 occap_ddrc_dat a_poison_err_inj  | Enable error injection in the poisoning of OCCAP MC DATA logic Injects error into poisoning logic (either parallel or seq) such that XOR logic for one signal is not poisoned when expected. If set, it allows ability to corrupt the following register fields. - 1'b0: OCCAPSTAT1.occap_ddrc_data_poison_parallel/seq_err=0 - 1'b1: OCCAPSTAT1.occap_ddrc_data_poison_parallel/seq_err=1 Do not change value in same APB write as setting of occap_ddrc_data_poison_parallel/_seq Programming Mode: Dynamic                    |

Table continues on the next page...

## Table continued from the previous page...

| Field                               | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 9 occap_ddrc_dat a_poison_parall el | Enables poisoning of OCCAP MC DATA logic for all parts of comparison logic, in parallel. Poisons comparison logic for one core_ddrc_core_clk cycle by inverting all bits of a signal to XOR logic. All signals of instance[0] of the duplicated modules are poisoned in parallel and checks if all signals were poisoned correctly. If this is not the case, this is flagged by OCCAPSTAT1.occap_ddrc_data_poison_parallel_err=1. uMCTL2 automatically clears this bit. Programming Mode: Dynamic |
| 8 occap_ddrc_dat a_poison_seq       | Enables poisoning of OCCAP MC DATA logic for all parts of comparison logic, in sequence. Poisons comparison logic for one core_ddrc_core_clk cycle by inverting all bits of a signal to XOR logic. All signals of instance[0] of the duplicated modules are poisoned in parallel and checks if all signals were poisoned correctly. If this is not the case, this is flagged by OCCAPSTAT1.occap_ddrc_data_poison_seq_err=1. uMCTL2 automatically clears this bit. Programming Mode: Dynamic      |
| 7-3 -                               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 2 occap_ddrc_dat a_intr_force       | Interrupt force bit for occap_ddrc_data_err_intr, setting this register will cause the output interrupt to be asserted. uMCTL2 automatically clears this bit. There is no interaction between functionally triggering an interrupt and forcing an interrupt (they are mutually exclusive). Programming Mode: Dynamic                                                                                                                                                                              |
| 1 occap_ddrc_dat a_intr_clr         | Interrupt clear bit for occap_ddrc_data_err_intr. uMCTL2 automatically clears this bit. Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                 |
| 0 occap_ddrc_dat a_intr_en          | Enables interrupt generation on signal occap_ddrc_data_err_intr upon detection of OCCAP MC DATA errors. Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                 |

## 36.15.119 On-Chip command/Address Protection Status 1 (OCCAPSTAT1)

## Offset

| Register   | Offset   |
|------------|----------|
| OCCAPSTAT1 | 3ECh     |

## Diagram

<!-- image -->

## Fields

| Field                                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-26 -                                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 25 occap_ddrc_ctrl _poison_parallel _err | Error when occap_ddrc_ctrl_poison_parallel was active due to incorrect no. of errors being occurring. Internal logic checks the number of errors detected while poisoning occurred for occap_ddrc_ctrl_poison_parallel. It checks for error on all of the the corresponding XOR outputs. If multi-bit, checks also that all XOR bits are set. It checks all XOR in parallel. Register is valid only when occap_ddrc_ctrl_cmp_poison_complete=1. Programming Mode: Static |
| 24 occap_ddrc_ctrl _poison_seq_er r      | Error when occap_ddrc_ctrl_poison_seq was active due to incorrect no. of errors being occurring. Internal logic checks the number of errors detected while poisoning occurred for occap_ddrc_ctrl_poison_seq. It checks for error on all of the corresponding XOR outputs. It checks each XOR sequentially. Register is valid only when occap_ddrc_ctrl_cmp_poison_complete=1. Programming Mode: Static                                                                  |
| 23-18 -                                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 17 occap_ddrc_ctrl _poison_comple te     | OCCAP MC CTRL poisoning complete interrupt status. Register cleared by OCCAPCFG1.occap_ddrc_ctrl_err_intr_clr. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                  |
| 16 occap_ddrc_ctrl _err_intr             | OCCAP MC CTRL error interrupt status. Register cleared by OCCAPCFG1.occap_ddrc_ctrl_err_intr_clr. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                               |
| 15-10 -                                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 9                                        | Error when occap_ddrc_data_poison_parallel was active due to incorrect no. of errors being occurring. Internal logic checks the number of errors detected while poisoning occurred for                                                                                                                                                                                                                                                                                   |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field                                 | Function                                                                                                                                                                                                                                                                                                                                                                                                 |
|---------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| occap_ddrc_dat a_poison_parall el_err | occap_ddrc_data_poison_parallel. It checks for error on all of the the corresponding XOR outputs. If multi-bit, checks also that all XOR bits are set. It checks all XOR in parallel. This is cleared when OCCAPCFG1.occap_ddrc_data_poison_parallel=0 occurs. Programming Mode: Static                                                                                                                  |
| 8 occap_ddrc_dat a_poison_seq_e rr    | Error when occap_ddrc_data_poison_seq was active due to incorrect no. of errors being occurring. Internal logic checks the number of errors detected while poisoning occurred for occap_ddrc_data_poison_seq. It checks for error on all of the corresponding XOR outputs. It checks each XOR sequentially. This is cleared when OCCAPCFG1.occap_ddrc_data_poison_seq=0 occurs. Programming Mode: Static |
| 7-2 -                                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                 |
| 1 occap_ddrc_dat a_poison_compl ete   | OCCAP MC DATA poisoning complete interrupt status. Register cleared by OCCAPCFG1.occap_ddrc_data_err_intr_clr. Programming Mode: Static                                                                                                                                                                                                                                                                  |
| 0 occap_ddrc_dat a_err_intr           | OCCAP MC DATA error interrupt status. Register cleared by OCCAPCFG1.occap_ddrc_data_err_intr_clr. Programming Mode: Static                                                                                                                                                                                                                                                                               |

## 36.15.120 Temperature Derate Status (DERATESTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| DERATESTAT | 3F0h     |

<!-- image -->

## Fields

| Field                     | Function                                                                                                                                                                                                                                                                   |
|---------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-1                      | Reserved                                                                                                                                                                                                                                                                   |
| 0 derate_temp_li mit_intr | Derate temperature interrupt indicating LPDDR2/3/4 DRAM temperature operating limit is exceeded. This register field is set to 1 when the value read from MR4[2:0] is 3'b000 or 3'b111. Cleared by register DERATECTL.derate_temp_limit_intr_clr. Programming Mode: Static |

## 36.16 UMCTL2\_MP register descriptions

## 36.16.1 UMCTL2\_MP memory map

This section and all its sub-sections are Synopsys Proprietary. Used with permission.

DDR MC Multi-Port Registers

UMCTL2\_MP base address: 403C\_03F8h

| Offset   | Register                                                |   Width (In bits) | Access   | Reset value   |
|----------|---------------------------------------------------------|-------------------|----------|---------------|
| 4h       | Port Status (PSTAT)                                     |                32 | R        | 0000_0000h    |
| 8h       | Port Common Configuration (PCCFG)                       |                32 | RW       | 0000_0000h    |
| Ch       | Port n Configuration Read (PCFGR_0)                     |                32 | RW       | 0000_0000h    |
| 10h      | Port n Configuration Write (PCFGW_0)                    |                32 | RW       | 0000_4000h    |
| 98h      | Port n Control (PCTRL_0)                                |                32 | RW       | 0000_0000h    |
| 9Ch      | Port n Read QoS Configuration Register 0 (PCFGQOS0_0)   |                32 | RW       | 0200_0E00h    |
| A0h      | Port n Read QoS Configuration Register 1 (PCFGQOS1_0)   |                32 | RW       | 0000_0000h    |
| A4h      | Port n Write QoS Configuration Register 0 (PCFGWQOS0_0) |                32 | RW       | 0000_0E00h    |
| A8h      | Port n Write QoS Configuration Register 1 (PCFGWQOS1_0) |                32 | RW       | 0000_0000h    |
| BCh      | Port n Configuration Read (PCFGR_1)                     |                32 | RW       | 0000_0000h    |
| C0h      | Port n Configuration Write (PCFGW_1)                    |                32 | RW       | 0000_4000h    |
| 148h     | Port n Control (PCTRL_1)                                |                32 | RW       | 0000_0000h    |
| 14Ch     | Port n Read QoS Configuration Register 0 (PCFGQOS0_1)   |                32 | RW       | 0200_0E00h    |
| 150h     | Port n Read QoS Configuration Register 1 (PCFGQOS1_1)   |                32 | RW       | 0000_0000h    |
| 154h     | Port n Write QoS Configuration Register 0 (PCFGWQOS0_1) |                32 | RW       | 0000_0E00h    |
| 158h     | Port n Write QoS Configuration Register 1 (PCFGWQOS1_1) |                32 | RW       | 0000_0000h    |
| 16Ch     | Port n Configuration Read (PCFGR_2)                     |                32 | RW       | 0000_0000h    |
| 170h     | Port n Configuration Write (PCFGW_2)                    |                32 | RW       | 0000_4000h    |

Table continues on the next page...

Table continued from the previous page...

| Offset   | Register                                                |   Width (In bits) | Access   | Reset value   |
|----------|---------------------------------------------------------|-------------------|----------|---------------|
| 1F8h     | Port n Control (PCTRL_2)                                |                32 | RW       | 0000_0000h    |
| 1FCh     | Port n Read QoS Configuration Register 0 (PCFGQOS0_2)   |                32 | RW       | 0200_0E00h    |
| 200h     | Port n Read QoS Configuration Register 1 (PCFGQOS1_2)   |                32 | RW       | 0000_0000h    |
| 204h     | Port n Write QoS Configuration Register 0 (PCFGWQOS0_2) |                32 | RW       | 0000_0E00h    |
| 208h     | Port n Write QoS Configuration Register 1 (PCFGWQOS1_2) |                32 | RW       | 0000_0000h    |
| B2Ch     | Scrubber Control (SBRCTL)                               |                32 | RW       | 0000_FF10h    |
| B30h     | Scrubber Status (SBRSTAT)                               |                32 | R        | 0000_0000h    |
| B34h     | Scrubber Write Data Pattern0 (SBRWDATA0)                |                32 | RW       | 0000_0000h    |

## 36.16.2 Port Status (PSTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| PSTAT      | 4h       |

## Diagram

<!-- image -->

## Fields

<!-- image -->

| Field   | Function   |
|---------|------------|
| 31-19   | Reserved   |

Table continues on the next page...

## Table continued from the previous page...

| Field             | Function                                                                            |
|-------------------|-------------------------------------------------------------------------------------|
| 18 wr_port_busy_2 | Indicates if there are outstanding writes for AXI port 2. Programming Mode: Dynamic |
| 17 wr_port_busy_1 | Indicates if there are outstanding writes for AXI port 1. Programming Mode: Dynamic |
| 16 wr_port_busy_0 | Indicates if there are outstanding writes for AXI port 0. Programming Mode: Dynamic |
| 15-3 -            | Reserved                                                                            |
| 2 rd_port_busy_2  | Indicates if there are outstanding reads for AXI port 2. Programming Mode: Dynamic  |
| 1 rd_port_busy_1  | Indicates if there are outstanding reads for AXI port 1. Programming Mode: Dynamic  |
| 0 rd_port_busy_0  | Indicates if there are outstanding reads for AXI port 0. Programming Mode: Dynamic  |

## 36.16.3 Port Common Configuration (PCCFG)

## Offset

| Register   | Offset   |
|------------|----------|
| PCCFG      | 8h       |

<!-- image -->

## Fields

| Field             | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-9 -            | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 8 bl_exp_mode     | Burst expansion mode Selects half of the memory burst length (BL) as the XPI burst expansion packet length. Applies to both read and write expansion. When using Partial Writes (UMCTL2_PARTIAL_WR == 1), half BL burst expansion avoids or minimizes the t_ccd_l penalty for DDR4 or the t_ccd_mw penalty for LPDDR4. Therefore, you should use it only for DDR4 or LPDDR4 DRAM. When not using data mask (DBICTL[dm_en] == 0), the MCdoes not support half BL burst expansion if any of these conditions are true: • Partial Writes disabled (UMCTL2_PARTIAL_WR == 0) • Partial Writes enabled (UMCTL2_PARTIAL_WR == 1) AND - For LPDDR4, all of these conditions are true: ◦ Half bus width (MSTR[data_bus_width] == 01) ◦ MC BL8 (MEMC_BURST_LENGTH == 8) ◦ DRAM BL16 (MSTR[burst_rdwr] == 1000) - For DDR4, all of these conditions are true: ◦ Half bus width (MSTR[data_bus_width] == 01) ◦ MC BL4 (MEMC_BURST_LENGTH == 4) ◦ DRAM BL8 (MSTR[burst_rdwr] == 0100) This field has no effect when using full data bus width (MSTR[data_bus_width] == 00) When using Data Channel Interleave, the MC does not support burst expansion. Programming Mode: Static 0b - Full BL |
| 7-5 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 4 pagematch_limit | Page match four limit If Page Match is enabled (PCFGR_0[rd_port_pagematch_en]), limits the number of consecutive same-page MC transactions granted by the Port Arbiter to four. Programming Mode: Static 0b - No limit 1b - Limit of four                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 3-1               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

Table continues on the next page...

Table continued from the previous page...

| Field            | Function                                                                                                                         |
|------------------|----------------------------------------------------------------------------------------------------------------------------------|
| -                |                                                                                                                                  |
| 0 go2critical_en | Go to critical enable Enables go-to-critical signaling to MC based on urgent input from the AXI master. Programming Mode: Static |

## 36.16.4 Port n Configuration Read (PCFGR\_0)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGR_0    | Ch       |

## Diagram

<!-- image -->

## Fields

| Field               | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-17 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 16 rdwr_ordered_e n | Ordered read/writes enable                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                     | Enables ordered read/writes. If enabled, the MC preserves the order of read and write transactions issued to the same address on a given port. In other words, the MC transports all same-address read and write commands from the application port interface to the DFI interface in the order of acceptance. This feature helps to maintain software coherency for masters that issue back-to-back read/write transactions without waiting for write/read responses. |

Table continues on the next page...

## Table continued from the previous page...

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                          | Programming Mode: Static> 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 15 -                     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 14 rd_port_pagema tch_en | Read Page Match enable Enables read Page Match. If enabled, when the port arbiter grants a requesting port, that port remains granted if the following immediate commands are to the same memory page (same bank and row). See PCCFG[pagematch_limit] for information about limiting the number of consecutive transactions under Page Match. Programming Mode: Static 0b - Disable                                                                                                                                                         |
| 13 rd_port_urgent_ en    | Read AXI urgent sideband enable Enables the AXI urgent sideband signal (arurgent). If enabled and the master asserts arurgent, that port becomes the highest priority port. Also, if enabled and go to critical is enabled (PCCFG[go2critical_en]), the MC asserts co_gs_go2critical_lpr or co_gs_go2critical_hpr to the MC. Themaster can assert arurgent any time and for as long as needed, independent of address handshaking. It is not associated with any particular command. NOTE Programming Mode: Static 0b - Disable 1b - Enable |
| 12 rd_port_aging_e n     | Read aging enable Enables the aging function for the port read channel. Programming Mode: Static 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 11-10 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 9-0 rd_port_priority     | Read aging counter value Specifies the initial value to be loaded into the read aging counters. The MC loads the counters with this value after reset or after each grant to the corresponding port. The aging counters count down every                                                                                                                                                                                                                                                                                                    |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | clock cycle that a port is requested but not granted. The five most significant bits (msb) of the counter sets the priority of the read channel for a particular port. That port's priority increases as the five msb decrease. When the aging counter reaches zero, the corresponding port channel has the highest priority (timeout condition - Priority0). For multi-port configurations, if using external dynamic priority inputs (arqos), you cannot use the aging counters to set port priorities (timeout is still applicable). For single-port configurations, the aging counters only matter to force read-write direction switching when they timeout (become 0). In this case, you can still use the external dynamic priority input (arqos), for reads only, to set the MC read priority: low priority read (LPR) or high priority read (HPR) on a command-by-command basis. The two least-significant bits (lsb) of this field are tied low (00b) internally. NOTE Programming Mode: Static |

## 36.16.5 Port n Configuration Write (PCFGW\_0)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGW_0    | 10h      |

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-15   | Reserved   |

Table continues on the next page...

## Table continued from the previous page...

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 14 wr_port_pagem atch_en | Write Page Match enable Enables write Page Match. If enabled, when the port arbiter grants a requesting port, that port remains granted if the following immediate commands are to the same memory page (same bank and row). See PCCFG[pagematch_limit] for information about limiting the number of consecutive transactions under Page Match. Programming Mode: Static 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                   |
| 13 wr_port_urgent_ en    | Write AXI urgent sideband enable Enables the AXI urgent sideband signal (awurgent). If enabled and the master asserts awurgent, that port becomes the highest priority port. Also, if enabled and go to critical is enabled (PCCFG[go2critical_en]), the MC asserts co_gs_go2critical_wr to the MC. The master can assert awurgent any time and for as long as needed, independent of address handshaking. It is not associated with any particular command. NOTE Programming Mode: Static 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                 |
| 12 wr_port_aging_ en     | Write aging enable Enables the aging function for the port write channel. Programming Mode: Static 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 11-10 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 9-0 wr_port_priority     | Write aging counter value Specifies the initial value to be loaded into the Write aging counters. The MC loads the counters with this value after reset or after each grant to the corresponding port. The aging counters count down every clock cycle that a port is requested but not granted. The five most significant bits (msb) of the counter sets the priority of the write channel for a particular port. That port's priority increases as the five msb decrease. When the aging counter reaches zero, the corresponding port channel has the highest priority (timeout condition - Priority0). For multi-port configurations, if using external dynamic priority inputs (awqos), you cannot use the aging counters to set port priorities (timeout is still applicable). |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | For single-port configurations, the aging counters only matter to force read-write direction switching when they timeout (become 0). In this case, you can still use the external dynamic priority input (arqos), for reads only, to set the MC read priority: low priority read (LPR) or high priority read (HPR) on a command-by-command basis. The two least-significant bits (lsb) of this field are tied low (00b) internally. NOTE Programming Mode: Static |

## 36.16.6 Port n Control (PCTRL\_0)

## Offset

| Register   | Offset   |
|------------|----------|
| PCTRL_0    | 98h      |

<!-- image -->

## Fields

| Field   | Function                                      |
|---------|-----------------------------------------------|
| 31-1    | Reserved                                      |
| 0       | Enables AXI port n. Programming Mode: Dynamic |
| port_en |                                               |

## 36.16.7 Port n Read QoS Configuration Register 0 (PCFGQOS0\_0)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGQOS0_0 | 9Ch      |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27              | 26              | 25                | 24                | 23       | 22       | 21                | 20                | 19              | 18              | 17                | 16                |
|--------|----------|----------|----------|----------|-----------------|-----------------|-------------------|-------------------|----------|----------|-------------------|-------------------|-----------------|-----------------|-------------------|-------------------|
| R W    | Reserved | Reserved | Reserved | Reserved | Reserved        | Reserved        | rqos_map_regio n2 | rqos_map_regio n2 | Reserved | Reserved | rqos_map_regio n1 | rqos_map_regio n1 | Reserved        | Reserved        | rqos_map_regio n0 | rqos_map_regio n0 |
| Reset  | 0        | 0        | 0        | 0        | 0               | 0               | 1                 | 0                 | 0        | 0        | 0                 | 0                 | 0               | 0               | 0                 | 0                 |
| Bits   | 15       | 14       | 13       | 12       | 11              | 10              | 9                 | 8                 | 7        | 6        | 5                 | 4                 | 3               | 2               | 1                 | 0                 |
| R W    | Reserved | Reserved | Reserved | Reserved | rqos_map_level2 | rqos_map_level2 | rqos_map_level2   | rqos_map_level2   | Reserved | Reserved | Reserved          | Reserved          | rqos_map_level1 | rqos_map_level1 | rqos_map_level1   | rqos_map_level1   |
| Reset  | 0        | 0        | 0        | 0        | 1               | 1               | 1                 | 0                 | 0        | 0        | 0                 | 0                 | 0               | 0               | 0                 | 0                 |

## Fields

| Field                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                     |
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-26 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 25-24 rqos_map_regio n2 | Region 2 traffic class Specifies the traffice class for region 2. For dual-address-queue configurations, region 1 maps to the red address queue. If VPR support is disabled (UMCTL2_VPR_EN == 0) and the region 2 traffic class is VPR, the MC aliases VPR traffic to LPR traffic. Programming Mode: Quasi-dynamic Group 3 00b - Invalid 01b - VPR 10b - HPR (not value for dual-address-queue configurations) 11b - Invalid |
| 23-22 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 21-20 rqos_map_regio n1 | Region 1 traffic class Specifies the traffice class for region 1. For dual-address-queue configurations, region 1 maps to the blue address queue.                                                                                                                                                                                                                                                                            |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                         | If VPR support is disabled (UMCTL2_VPR_EN == 0) and the region 1 traffic class is VPR, the MC aliases VPR traffic to LPR traffic. Programming Mode: Quasi-dynamic Group 3 00b - LPR 01b - VPR 10b - HPR (not valid for dual-address-queue configurations) 11b - Invalid                                                                                                                                                                            |
| 19-18 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 17-16 rqos_map_regio n0 | Read region 0 traffic class Specifies the traffice class for region 0. For dual-address-queue configurations, region 0 maps to the blue address queue. If VPR support is disabled (UMCTL2_VPR_EN == 0) and the region 0 traffic class is VPR, the MC aliases VPR traffic to LPR traffic. Programming Mode: Quasi-dynamic Group 3 00b - LPR 01b - VPR 10b - HPR (not valid for dual-address-queue configurations) 11b - Invalid                     |
| 15-12 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 11-8 rqos_map_level 2   | Read separation level 2 Specifies the separation level 2, which indicates the end of region1 mapping. Region2 starts from (level1 + 1) up to 15. Possible values are (level1 + 1) to 14, which corresponds to arqos. For PA, the MCuses arqos values directly as port priorities, where the higher the value, the higher the port priority. You must set all map_level* registers to distinct values. NOTE Programming Mode: Quasi-dynamic Group 3 |
| 7-4 -                   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 3-0                     | Read separation level 1 Specifies the separateion level 1, which indicates the end of region0 mapping. Region0 starts at zero.                                                                                                                                                                                                                                                                                                                     |

Table continues on the next page...

Table continued from the previous page...

| Field            | Function                                                                                                                                                                                                                                                                                                                      |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| rqos_map_level 1 | Possible values are 0 to 13 for dual RAQ or 0 to 14 for single RAQ, which corresponds to arqos. For PA, the MCuses arqos values directly as port priorities, where the higher the value, the higher the port priority. You must set all map_level* registers to distinct values. NOTE Programming Mode: Quasi-dynamic Group 3 |

## 36.16.8 Port n Read QoS Configuration Register 1 (PCFGQOS1\_0)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGQOS1_0 | A0h      |

## Diagram

<!-- image -->

## Fields

| Field                    | Function                                                                                                                                                         |
|--------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-27 -                  | Reserved                                                                                                                                                         |
| 26-16 rqos_map_time outr | Read red address queue timeout interval Specifies the timeout interval for transactions mapped to the red address queue. Programming Mode: Quasi-dynamic Group 3 |
| 15-11 -                  | Reserved                                                                                                                                                         |

Table continues on the next page...

Table continued from the previous page...

| Field              | Function                                                                                                                  |
|--------------------|---------------------------------------------------------------------------------------------------------------------------|
| 10-0               | Read blue address queue timeout interval                                                                                  |
| rqos_map_time outb | Specifies the timeout interval for transactions mapped to the blue address queue. Programming Mode: Quasi-dynamic Group 3 |

## 36.16.9 Port n Write QoS Configuration Register 0 (PCFGWQOS0\_0)

## Offset

| Register    | Offset   |
|-------------|----------|
| PCFGWQOS0_0 | A4h      |

## Diagram

<!-- image -->

## Fields

| Field                   | Function                                                                                                                                                                                                                                                                          |
|-------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-26 -                 | Reserved                                                                                                                                                                                                                                                                          |
| 25-24 wqos_map_regi on2 | Write region 2 traffic class Specifies the traffice class for region 2. If VPWsupport is disabled (UMCTL2_VPW_EN == 0) and the region 2 traffic class is VPW, the MCaliases VPW traffic to NPW traffic. Programming Mode: Quasi-dynamic Group 3 00b - LPR 01b - VPR 10b - Invalid |

Table continues on the next page...

## Table continued from the previous page...

| Field                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 23-22 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 21-20 wqos_map_regi on1 | Write region 1 traffic class Specifies the traffice class for region 1. If VPWsupport is disabled (UMCTL2_VPW_EN == 0) and the region 1 traffic class is VPW, the MCaliases VPW traffic to NPW traffic. Programming Mode: Quasi-dynamic Group 3 00b - LPR 01b - VPR 10b - Invalid 11b - Invalid                                                                                                                                                    |
| 19-18 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 17-16 wqos_map_regi on0 | Write region 0 traffic class Specifies the traffice class for region 0. If VPWsupport is disabled (UMCTL2_VPW_EN == 0) and the region 0 traffic class is VPW, the MCaliases VPW traffic to NPW traffic. Programming Mode: Quasi-dynamic Group 3 00b - LPR 01b - VPR 10b - Invalid 11b - Invalid                                                                                                                                                    |
| 15-12 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 11-8 wqos_map_leve l2   | Write separation level 2 Specifies the separation level 2, which indicates the end of region 1 mapping. Region2 starts from (level1 + 1) up to 15. Possible values are (level1 + 1) to 14, which corresponds to awqos. For PA, the MCusesawqosvalues directly as port priorities, where the higher the value, the higher the port priority. You must set all map_level* registers to distinct values. NOTE Programming Mode: Quasi-dynamic Group 3 |

Table continues on the next page...

## Table continued from the previous page...

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7-4 -                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 3-0 wqos_map_leve l1 | Write separation level 1 Specifies the separateion level 1, which indicates the end of region 0 mapping. Region 0 starts at zero. Possible values are 0 to 13 for dual RAQ or 0 to 14 for single RAQ, which corresponds to awqos. For PA, the MCusesawqosvalues directly as port priorities, where the higher the value, the higher the port priority. You must set all map_level* registers to distinct values. NOTE Programming Mode: Quasi-dynamic Group 3 |

## 36.16.10 Port n Write QoS Configuration Register 1 (PCFGWQOS1\_0)

## Offset

| Register    | Offset   |
|-------------|----------|
| PCFGWQOS1_0 | A8h      |

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27                | 26                | 25                | 24                | 23                | 22                | 21                | 20                | 19                | 18                | 17                | 16                |
|--------|----------|----------|----------|----------|-------------------|-------------------|-------------------|-------------------|-------------------|-------------------|-------------------|-------------------|-------------------|-------------------|-------------------|-------------------|
| R W    | Reserved | Reserved | Reserved | Reserved | wqos_map_timeout2 | wqos_map_timeout2 | wqos_map_timeout2 | wqos_map_timeout2 | wqos_map_timeout2 | wqos_map_timeout2 | wqos_map_timeout2 | wqos_map_timeout2 | wqos_map_timeout2 | wqos_map_timeout2 | wqos_map_timeout2 | wqos_map_timeout2 |
| Reset  | 0        | 0        | 0        | 0        | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 |
| Bits   | 15       | 14       | 13       | 12       | 11                | 10                | 9                 | 8                 | 7                 | 6                 | 5                 | 4                 | 3                 | 2                 | 1                 | 0                 |
| R W    | Reserved | Reserved | Reserved | Reserved | wqos_map_timeout1 | wqos_map_timeout1 | wqos_map_timeout1 | wqos_map_timeout1 | wqos_map_timeout1 | wqos_map_timeout1 | wqos_map_timeout1 | wqos_map_timeout1 | wqos_map_timeout1 | wqos_map_timeout1 | wqos_map_timeout1 | wqos_map_timeout1 |
| Reset  | 0        | 0        | 0        | 0        | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 | 0                 |

## Fields

| Field   | Function                                                           |
|---------|--------------------------------------------------------------------|
| 31-27   | Reserved                                                           |
| -       |                                                                    |
| 26-16   | Write region 2 timeout interval                                    |
|         | Specifies the timeout interval for write transactions in region 2. |

Table continues on the next page...

Table continued from the previous page...

| Field                   | Function                                                                                                                                                |
|-------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| wqos_map_time out2      | Programming Mode: Quasi-dynamic Group 3                                                                                                                 |
| 15-11 -                 | Reserved                                                                                                                                                |
| 10-0 wqos_map_time out1 | Write region 0 and 1 timeout interval Specifies the timeout interval for write transactions in regions 0 and 1. Programming Mode: Quasi-dynamic Group 3 |

## 36.16.11 Port n Configuration Read (PCFGR\_1)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGR_1    | BCh      |

## Diagram

<!-- image -->

## Fields

| Field               | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|---------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-17 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 16 rdwr_ordered_e n | Enable ordered read/writes. If set to 1, preserves the ordering between read transaction and write transaction issued to the same address, on a given port. In other words, the controller ensures that all same address read and write commands from the application port interface are transported to the DFI interface in the order of acceptance. This feature is useful in cases where software coherency is desired for masters issuing back-to-back read/write transactions without waiting for write/ |

Table continues on the next page...

## Table continued from the previous page...

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                          | read responses. Note that this register has an effect only if necessary logic is instantiated via the UMCTL2_RDWR_ORDERED_n parameter. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 15 -                     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 14 rd_port_pagema tch_en | If set to 1, enables the Page Match feature. If enabled, once a requesting port is granted, the port is continued to be granted if the following immediate commands are to the same memory page (same bank and same row). See also related PCCFG.pagematch_limit register. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 13 rd_port_urgent_ en    | If set to 1, enables the AXI urgent sideband signal (arurgent). When enabled and arurgent is asserted by the master, that port becomes the highest priority and co_gs_go2critical_lpr/co_gs_go2critical_hpr signal to MC is asserted if enabled in PCCFG.go2critical_en register. Note that arurgent signal can be asserted anytime and as long as required which is independent of address handshaking (it is not associated with any particular command). Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 12 rd_port_aging_e n     | If set to 1, enables aging function for the read channel of the port. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 11-10 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 9-0 rd_port_priority     | Determines the initial load value of read aging counters. These counters will be parallel loaded after reset, or after each grant to the corresponding port. The aging counters down-count every clock cycle where the port is requesting but not granted. The higher significant 5-bits of the read aging counter sets the priority of the read channel of a given port. Port's priority will increase as the higher significant 5-bits of the counter starts to decrease. When the aging counter becomes 0, the corresponding port channel will have the highest priority level (timeout condition - Priority0). For multi-port configurations, the aging counters cannot be used to set port priorities when external dynamic priority inputs (arqos) are enabled (timeout is still applicable). For single port configurations, the aging counters are only used when they timeout (become 0) to force read-write direction switching. In this case, external dynamic priority input, arqos (for reads only) can still be used to set the MC read priority (2 priority levels: low priority read - LPR, high priority read - HPR) on a command by command basis. Note: The two LSBs of this register field are tied internally to 2'b00. Programming Mode: Static |

## 36.16.12 Port n Configuration Write (PCFGW\_1)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGW_1    | C0h      |

## Diagram

<!-- image -->

| Bits   | 31        | 30          | 29          | 28          | 27       | 26       | 25               | 24               | 23               | 22               | 21               | 20               | 19               | 18               | 17               | 16               |
|--------|-----------|-------------|-------------|-------------|----------|----------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|
| R W    | Reserved  | Reserved    | Reserved    | Reserved    | Reserved | Reserved | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         |
| Reset  | 0         | 0           | 0           | 0           | 0        | 0        | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                |
| Bits   | 15        | 14          | 13          | 12          | 11       | 10       | 9                | 8                | 7                | 6                | 5                | 4                | 3                | 2                | 1                | 0                |
| R W    | Reserv ed | wr_por t... | wr_por t... | wr_por t... | Reserved | Reserved | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority |
| Reset  | 0         | 1           | 0           | 0           | 0        | 0        | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                |

## Fields

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|--------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-15 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 14 wr_port_pagem atch_en | If set to 1, enables the Page Match feature. If enabled, once a requesting port is granted, the port is continued to be granted if the following immediate commands are to the same memory page (same bank and same row). See also related PCCFG.pagematch_limit register. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 13 wr_port_urgent_ en    | If set to 1, enables the AXI urgent sideband signal (awurgent). When enabled and awurgent is asserted by the master, that port becomes the highest priority and co_gs_go2critical_wr signal to the MC is asserted if enabled in PCCFG.go2critical_en register. Note that awurgent signal can be asserted anytime and as long as required which is independent of address handshaking (it is not associated with any particular command). Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 12 wr_port_aging_ en     | If set to 1, enables aging function for the write channel of the port. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 11-10 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 9-0 wr_port_priority     | Determines the initial load value of write aging counters. These counters will be parallel loaded after reset, or after each grant to the corresponding port. The aging counters down-count every clock cycle where the port is requesting but not granted. The higher significant 5-bits of the write aging counter sets the initial priority of the write channel of a given port. Port's priority will increase as the higher significant 5-bits of the counter starts to decrease. When the aging counter becomes 0, the corresponding port channel will have the highest priority level. For multi-port configurations, the aging counters cannot be used to set port priorities when external dynamic priority inputs (awqos) are enabled (timeout is still applicable). For single port configurations, the aging counters are only used when they timeout (become 0) to force read-write direction switching. Note: The two LSBs of this register field are tied internally to 2'b00. Programming Mode: Static |

DDR Subsystem

## 36.16.13 Port n Control (PCTRL\_1)

## Offset

| Register   | Offset   |
|------------|----------|
| PCTRL_1    | 148h     |

## Diagram

<!-- image -->

## Fields

| Field   | Function                                      |
|---------|-----------------------------------------------|
| 31-1    | Reserved                                      |
| -       |                                               |
| 0       | Enables AXI port n. Programming Mode: Dynamic |
| port_en |                                               |

## 36.16.14 Port n Read QoS Configuration Register 0 (PCFGQOS0\_1)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGQOS0_1 | 14Ch     |

DDR Subsystem

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27              | 26              | 25                | 24                | 23       | 22       | 21                | 20                | 19              | 18              | 17                | 16                |
|--------|----------|----------|----------|----------|-----------------|-----------------|-------------------|-------------------|----------|----------|-------------------|-------------------|-----------------|-----------------|-------------------|-------------------|
| R W    | Reserved | Reserved | Reserved | Reserved | Reserved        | Reserved        | rqos_map_regio n2 | rqos_map_regio n2 | Reserved | Reserved | rqos_map_regio n1 | rqos_map_regio n1 | Reserved        | Reserved        | rqos_map_regio n0 | rqos_map_regio n0 |
| Reset  | 0        | 0        | 0        | 0        | 0               | 0               | 1                 | 0                 | 0        | 0        | 0                 | 0                 | 0               | 0               | 0                 | 0                 |
| Bits   | 15       | 14       | 13       | 12       | 11              | 10              | 9                 | 8                 | 7        | 6        | 5                 | 4                 | 3               | 2               | 1                 | 0                 |
| R W    | Reserved | Reserved | Reserved | Reserved | rqos_map_level2 | rqos_map_level2 | rqos_map_level2   | rqos_map_level2   | Reserved | Reserved | Reserved          | Reserved          | rqos_map_level1 | rqos_map_level1 | rqos_map_level1   | rqos_map_level1   |
| Reset  | 0        | 0        | 0        | 0        | 1               | 1               | 1                 | 0                 | 0        | 0        | 0                 | 0                 | 0               | 0               | 0                 | 0                 |

## Fields

| Field                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-26 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 25-24 rqos_map_regio n2 | This bitfield indicates the traffic class of region2. For dual address queue configurations, region2 maps to the red address queue. Valid values are 1: VPR and 2: HPR only. When VPR support is disabled (UMCTL2_VPR_EN = 0) and traffic class of region2 is set to 1 (VPR), VPR traffic is aliased to LPR traffic. Programming Mode: Quasi-dynamic Group 3                                                                                                     |
| 23-22 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 21-20 rqos_map_regio n1 | This bitfield indicates the traffic class of region 1. Valid values are: 0 : LPR, 1: VPR, 2: HPR. For dual address queue configurations, region1 maps to the blue address queue. In this case, valid values are 0: LPR and 1: VPR only. When VPR support is disabled (UMCTL2_VPR_EN = 0) and traffic class of region 1 is set to 1 (VPR), VPR traffic is aliased to LPR traffic. Programming Mode: Quasi-dynamic Group 3                                         |
| 19-18 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 17-16 rqos_map_regio n0 | This bitfield indicates the traffic class of region 0. Valid values are: 0: LPR, 1: VPR, 2: HPR. For dual address queue configurations, region 0 maps to the blue address queue. In this case, valid values are: 0: LPR and 1: VPR only. When VPR support is disabled (UMCTL2_VPR_EN = 0) and traffic class of region0 is set to 1 (VPR), VPR traffic is aliased to LPR traffic. Programming Mode: Quasi-dynamic Group 3                                         |
| 15-12 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 11-8 rqos_map_level 2   | Separation level2 indicating the end of region1 mapping; start of region1 is (level1 + 1). Possible values for level2 are (level1 + 1) to 14 which corresponds to arqos. Region2 starts from (level2 + 1) up to 15. Note that for PA, arqos values are used directly as port priorities, where the higher the value corresponds to higher port priority. All of the map_level* registers must be set to distinct values. Programming Mode: Quasi-dynamic Group 3 |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7-4 -                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 3-0 rqos_map_level 1 | Separation level1 indicating the end of region0 mapping; start of region0 is 0. Possible values for level1 are 0 to 13 (for dual RAQ) or 0 to 14 (for single RAQ) which corresponds to arqos. Note that for PA, arqos values are used directly as port priorities, where the higher the value corresponds to higher port priority. All of the map_level* registers must be set to distinct values. Programming Mode: Quasi-dynamic Group 3 |

## 36.16.15 Port n Read QoS Configuration Register 1 (PCFGQOS1\_1)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGQOS1_1 | 150h     |

<!-- image -->

## Fields

| Field                    | Function                                                                                                              |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------|
| 31-27 -                  | Reserved                                                                                                              |
| 26-16 rqos_map_time outr | Specifies the timeout value for transactions mapped to the red address queue. Programming Mode: Quasi-dynamic Group 3 |
| 15-11 -                  | Reserved                                                                                                              |

Table continues on the next page...

Table continued from the previous page...

| Field              | Function                                                                                                               |
|--------------------|------------------------------------------------------------------------------------------------------------------------|
| 10-0 rqos_map_time | Specifies the timeout value for transactions mapped to the blue address queue. Programming Mode: Quasi-dynamic Group 3 |

## 36.16.16 Port n Write QoS Configuration Register 0 (PCFGWQOS0\_1)

## Offset

| Register    | Offset   |
|-------------|----------|
| PCFGWQOS0_1 | 154h     |

## Diagram

<!-- image -->

## Fields

| Field                   | Function                                                                                                                                                                                                                                                                  |
|-------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-26 -                 | Reserved                                                                                                                                                                                                                                                                  |
| 25-24 wqos_map_regi on2 | This bitfield indicates the traffic class of region 2. Valid values are: 0: NPW, 1: VPW. When VPW support is disabled (UMCTL2_VPW_EN = 0) and traffic class of region 2 is set to 1 (VPW), VPW traffic is aliased to NPW traffic. Programming Mode: Quasi-dynamic Group 3 |
| 23-22 -                 | Reserved                                                                                                                                                                                                                                                                  |
| 21-20 wqos_map_regi on1 | This bitfield indicates the traffic class of region 1. Valid values are: 0: NPW, 1: VPW. When VPW support is disabled (UMCTL2_VPW_EN = 0) and traffic class of region 1 is set to 1 (VPW), VPW traffic is aliased to NPW traffic. Programming Mode: Quasi-dynamic Group 3 |

Table continues on the next page...

## Table continued from the previous page...

| Field                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 19-18 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 17-16 wqos_map_regi on0 | This bitfield indicates the traffic class of region 0. Valid values are: 0: NPW, 1: VPW. When VPW support is disabled (UMCTL2_VPW_EN = 0) and traffic class of region 0 is set to 1 (VPW), VPW traffic is aliased to NPW traffic. Programming Mode: Quasi-dynamic Group 3                                                                                                                                                                                        |
| 15-12 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 11-8 wqos_map_leve l2   | Separation level2 indicating the end of region1 mapping; start of region1 is (level1 + 1). Possible values for level2 are (level1 + 1) to 14 which corresponds to awqos. Region2 starts from (level2 + 1) up to 15. Note that for PA, awqos values are used directly as port priorities, where the higher the value corresponds to higher port priority. All of the map_level* registers must be set to distinct values. Programming Mode: Quasi-dynamic Group 3 |
| 7-4 -                   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 3-0 wqos_map_leve l1    | Separation level indicating the end of region0 mapping; start of region0 is 0. Possible values for level1 are 0 to 13 which corresponds to awqos. Note that for PA, awqos values are used directly as port priorities, where the higher the value corresponds to higher port priority. All of the map_level* registers must be set to distinct values. Programming Mode: Quasi-dynamic Group 3                                                                   |

## 36.16.17 Port n Write QoS Configuration Register 1 (PCFGWQOS1\_1)

## Offset

| Register    | Offset   |
|-------------|----------|
| PCFGWQOS1_1 | 158h     |

## Diagram

<!-- image -->

## Fields

| Field                    | Function                                                                                                      |
|--------------------------|---------------------------------------------------------------------------------------------------------------|
| 31-27 -                  | Reserved                                                                                                      |
| 26-16 wqos_map_time out2 | Specifies the timeout value for write transactions in region 2. Programming Mode: Quasi-dynamic Group 3       |
| 15-11 -                  | Reserved                                                                                                      |
| 10-0 wqos_map_time out1  | Specifies the timeout value for write transactions in region 0 and 1. Programming Mode: Quasi-dynamic Group 3 |

## 36.16.18 Port n Configuration Read (PCFGR\_2)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGR_2    | 16Ch     |

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-17   | Reserved   |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 16 rdwr_ordered_e n      | Enable ordered read/writes. If set to 1, preserves the ordering between read transaction and write transaction issued to the same address, on a given port. In other words, the controller ensures that all same address read and write commands from the application port interface are transported to the DFI interface in the order of acceptance. This feature is useful in cases where software coherency is desired for masters issuing back-to-back read/write transactions without waiting for write/ read responses. Note that this register has an effect only if necessary logic is instantiated via the UMCTL2_RDWR_ORDERED_n parameter. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 15 -                     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 14 rd_port_pagema tch_en | If set to 1, enables the Page Match feature. If enabled, once a requesting port is granted, the port is continued to be granted if the following immediate commands are to the same memory page (same bank and same row). See also related PCCFG.pagematch_limit register. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 13 rd_port_urgent_ en    | If set to 1, enables the AXI urgent sideband signal (arurgent). When enabled and arurgent is asserted by the master, that port becomes the highest priority and co_gs_go2critical_lpr/co_gs_go2critical_hpr signal to the MC is asserted if enabled in PCCFG.go2critical_en register. Note that arurgent signal can be asserted anytime and as long as required which is independent of address handshaking (it is not associated with any particular command). Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 12 rd_port_aging_e n     | If set to 1, enables aging function for the read channel of the port. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 11-10 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 9-0 rd_port_priority     | Determines the initial load value of read aging counters. These counters will be parallel loaded after reset, or after each grant to the corresponding port. The aging counters down-count every clock cycle where the port is requesting but not granted. The higher significant 5-bits of the read aging counter sets the priority of the read channel of a given port. Port's priority will increase as the higher significant 5-bits of the counter starts to decrease. When the aging counter becomes 0, the corresponding port channel will have the highest priority level (timeout condition - Priority0). For multi-port configurations, the aging counters cannot be used to set port priorities when external dynamic priority inputs (arqos) are enabled (timeout is still applicable). For single port configurations, the aging counters are only used when they timeout (become 0) to force read-write direction switching. In this case, external dynamic priority input, arqos (for reads only) can still be used to set the MC read priority (2 priority levels: low priority read - LPR, high priority read - HPR) on a command by command basis. Note: The two LSBs of this register field are tied internally to 2'b00. Programming Mode: Static |

## 36.16.19 Port n Configuration Write (PCFGW\_2)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGW_2    | 170h     |

## Diagram

<!-- image -->

| Bits   | 31        | 30          | 29          | 28          | 27       | 26       | 25               | 24               | 23               | 22               | 21               | 20               | 19               | 18               | 17               | 16               |
|--------|-----------|-------------|-------------|-------------|----------|----------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|
| R W    | Reserved  | Reserved    | Reserved    | Reserved    | Reserved | Reserved | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         | Reserved         |
| Reset  | 0         | 0           | 0           | 0           | 0        | 0        | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                |
| Bits   | 15        | 14          | 13          | 12          | 11       | 10       | 9                | 8                | 7                | 6                | 5                | 4                | 3                | 2                | 1                | 0                |
| R W    | Reserv ed | wr_por t... | wr_por t... | wr_por t... | Reserved | Reserved | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority | wr_port_priority |
| Reset  | 0         | 1           | 0           | 0           | 0        | 0        | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                | 0                |

## Fields

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|--------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-15 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 14 wr_port_pagem atch_en | If set to 1, enables the Page Match feature. If enabled, once a requesting port is granted, the port is continued to be granted if the following immediate commands are to the same memory page (same bank and same row). See also related PCCFG.pagematch_limit register. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 13 wr_port_urgent_ en    | If set to 1, enables the AXI urgent sideband signal (awurgent). When enabled and awurgent is asserted by the master, that port becomes the highest priority and co_gs_go2critical_wr signal to the MC is asserted if enabled in PCCFG.go2critical_en register. Note that awurgent signal can be asserted anytime and as long as required which is independent of address handshaking (it is not associated with any particular command). Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 12 wr_port_aging_ en     | If set to 1, enables aging function for the write channel of the port. Programming Mode: Static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 11-10 -                  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 9-0 wr_port_priority     | Determines the initial load value of write aging counters. These counters will be parallel loaded after reset, or after each grant to the corresponding port. The aging counters down-count every clock cycle where the port is requesting but not granted. The higher significant 5-bits of the write aging counter sets the initial priority of the write channel of a given port. Port's priority will increase as the higher significant 5-bits of the counter starts to decrease. When the aging counter becomes 0, the corresponding port channel will have the highest priority level. For multi-port configurations, the aging counters cannot be used to set port priorities when external dynamic priority inputs (awqos) are enabled (timeout is still applicable). For single port configurations, the aging counters are only used when they timeout (become 0) to force read-write direction switching. Note: The two LSBs of this register field are tied internally to 2'b00. Programming Mode: Static |

DDR Subsystem

## 36.16.20 Port n Control (PCTRL\_2)

## Offset

| Register   | Offset   |
|------------|----------|
| PCTRL_2    | 1F8h     |

## Diagram

<!-- image -->

## Fields

| Field   | Function                                      |
|---------|-----------------------------------------------|
| 31-1    | Reserved                                      |
| -       |                                               |
| 0       | Enables AXI port n. Programming Mode: Dynamic |
| port_en |                                               |

## 36.16.21 Port n Read QoS Configuration Register 0 (PCFGQOS0\_2)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGQOS0_2 | 1FCh     |

DDR Subsystem

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27              | 26              | 25                | 24                | 23       | 22       | 21                | 20                | 19              | 18              | 17                | 16                |
|--------|----------|----------|----------|----------|-----------------|-----------------|-------------------|-------------------|----------|----------|-------------------|-------------------|-----------------|-----------------|-------------------|-------------------|
| R W    | Reserved | Reserved | Reserved | Reserved | Reserved        | Reserved        | rqos_map_regio n2 | rqos_map_regio n2 | Reserved | Reserved | rqos_map_regio n1 | rqos_map_regio n1 | Reserved        | Reserved        | rqos_map_regio n0 | rqos_map_regio n0 |
| Reset  | 0        | 0        | 0        | 0        | 0               | 0               | 1                 | 0                 | 0        | 0        | 0                 | 0                 | 0               | 0               | 0                 | 0                 |
| Bits   | 15       | 14       | 13       | 12       | 11              | 10              | 9                 | 8                 | 7        | 6        | 5                 | 4                 | 3               | 2               | 1                 | 0                 |
| R W    | Reserved | Reserved | Reserved | Reserved | rqos_map_level2 | rqos_map_level2 | rqos_map_level2   | rqos_map_level2   | Reserved | Reserved | Reserved          | Reserved          | rqos_map_level1 | rqos_map_level1 | rqos_map_level1   | rqos_map_level1   |
| Reset  | 0        | 0        | 0        | 0        | 1               | 1               | 1                 | 0                 | 0        | 0        | 0                 | 0                 | 0               | 0               | 0                 | 0                 |

## Fields

| Field                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-26 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 25-24 rqos_map_regio n2 | This bitfield indicates the traffic class of region2. For dual address queue configurations, region2 maps to the red address queue. Valid values are 1: VPR and 2: HPR only. When VPR support is disabled (UMCTL2_VPR_EN = 0) and traffic class of region2 is set to 1 (VPR), VPR traffic is aliased to LPR traffic. Programming Mode: Quasi-dynamic Group 3                                                                                                     |
| 23-22 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 21-20 rqos_map_regio n1 | This bitfield indicates the traffic class of region 1. Valid values are: 0 : LPR, 1: VPR, 2: HPR. For dual address queue configurations, region1 maps to the blue address queue. In this case, valid values are 0: LPR and 1: VPR only. When VPR support is disabled (UMCTL2_VPR_EN = 0) and traffic class of region 1 is set to 1 (VPR), VPR traffic is aliased to LPR traffic. Programming Mode: Quasi-dynamic Group 3                                         |
| 19-18 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 17-16 rqos_map_regio n0 | This bitfield indicates the traffic class of region 0. Valid values are: 0: LPR, 1: VPR, 2: HPR. For dual address queue configurations, region 0 maps to the blue address queue. In this case, valid values are: 0: LPR and 1: VPR only. When VPR support is disabled (UMCTL2_VPR_EN = 0) and traffic class of region0 is set to 1 (VPR), VPR traffic is aliased to LPR traffic. Programming Mode: Quasi-dynamic Group 3                                         |
| 15-12 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 11-8 rqos_map_level 2   | Separation level2 indicating the end of region1 mapping; start of region1 is (level1 + 1). Possible values for level2 are (level1 + 1) to 14 which corresponds to arqos. Region2 starts from (level2 + 1) up to 15. Note that for PA, arqos values are used directly as port priorities, where the higher the value corresponds to higher port priority. All of the map_level* registers must be set to distinct values. Programming Mode: Quasi-dynamic Group 3 |

Table continues on the next page...

DDR Subsystem

Table continued from the previous page...

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7-4 -                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 3-0 rqos_map_level 1 | Separation level1 indicating the end of region0 mapping; start of region0 is 0. Possible values for level1 are 0 to 13 (for dual RAQ) or 0 to 14 (for single RAQ) which corresponds to arqos. Note that for PA, arqos values are used directly as port priorities, where the higher the value corresponds to higher port priority. All of the map_level* registers must be set to distinct values. Programming Mode: Quasi-dynamic Group 3 |

## 36.16.22 Port n Read QoS Configuration Register 1 (PCFGQOS1\_2)

## Offset

| Register   | Offset   |
|------------|----------|
| PCFGQOS1_2 | 200h     |

<!-- image -->

## Fields

| Field                    | Function                                                                                                              |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------|
| 31-27 -                  | Reserved                                                                                                              |
| 26-16 rqos_map_time outr | Specifies the timeout value for transactions mapped to the red address queue. Programming Mode: Quasi-dynamic Group 3 |
| 15-11 -                  | Reserved                                                                                                              |

Table continues on the next page...

Table continued from the previous page...

| Field              | Function                                                                                                               |
|--------------------|------------------------------------------------------------------------------------------------------------------------|
| 10-0 rqos_map_time | Specifies the timeout value for transactions mapped to the blue address queue. Programming Mode: Quasi-dynamic Group 3 |

## 36.16.23 Port n Write QoS Configuration Register 0 (PCFGWQOS0\_2)

## Offset

| Register    | Offset   |
|-------------|----------|
| PCFGWQOS0_2 | 204h     |

## Diagram

<!-- image -->

## Fields

| Field                   | Function                                                                                                                                                                                                                                                                  |
|-------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-26 -                 | Reserved                                                                                                                                                                                                                                                                  |
| 25-24 wqos_map_regi on2 | This bitfield indicates the traffic class of region 2. Valid values are: 0: NPW, 1: VPW. When VPW support is disabled (UMCTL2_VPW_EN = 0) and traffic class of region 2 is set to 1 (VPW), VPW traffic is aliased to NPW traffic. Programming Mode: Quasi-dynamic Group 3 |
| 23-22 -                 | Reserved                                                                                                                                                                                                                                                                  |
| 21-20 wqos_map_regi on1 | This bitfield indicates the traffic class of region 1. Valid values are: 0: NPW, 1: VPW. When VPW support is disabled (UMCTL2_VPW_EN = 0) and traffic class of region 1 is set to 1 (VPW), VPW traffic is aliased to NPW traffic. Programming Mode: Quasi-dynamic Group 3 |

Table continues on the next page...

## Table continued from the previous page...

| Field                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 19-18 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 17-16 wqos_map_regi on0 | This bitfield indicates the traffic class of region 0. Valid values are: 0: NPW, 1: VPW. When VPW support is disabled (UMCTL2_VPW_EN = 0) and traffic class of region 0 is set to 1 (VPW), VPW traffic is aliased to NPW traffic. Programming Mode: Quasi-dynamic Group 3                                                                                                                                                                                        |
| 15-12 -                 | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 11-8 wqos_map_leve l2   | Separation level2 indicating the end of region1 mapping; start of region1 is (level1 + 1). Possible values for level2 are (level1 + 1) to 14 which corresponds to awqos. Region2 starts from (level2 + 1) up to 15. Note that for PA, awqos values are used directly as port priorities, where the higher the value corresponds to higher port priority. All of the map_level* registers must be set to distinct values. Programming Mode: Quasi-dynamic Group 3 |
| 7-4 -                   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 3-0 wqos_map_leve l1    | Separation level indicating the end of region0 mapping; start of region0 is 0. Possible values for level1 are 0 to 13 which corresponds to awqos. Note that for PA, awqos values are used directly as port priorities, where the higher the value corresponds to higher port priority. All of the map_level* registers must be set to distinct values. Programming Mode: Quasi-dynamic Group 3                                                                   |

## 36.16.24 Port n Write QoS Configuration Register 1 (PCFGWQOS1\_2)

## Offset

| Register    | Offset   |
|-------------|----------|
| PCFGWQOS1_2 | 208h     |

## Diagram

<!-- image -->

## Fields

| Field                    | Function                                                                                                      |
|--------------------------|---------------------------------------------------------------------------------------------------------------|
| 31-27 -                  | Reserved                                                                                                      |
| 26-16 wqos_map_time out2 | Specifies the timeout value for write transactions in region 2. Programming Mode: Quasi-dynamic Group 3       |
| 15-11 -                  | Reserved                                                                                                      |
| 10-0 wqos_map_time out1  | Specifies the timeout value for write transactions in region 0 and 1. Programming Mode: Quasi-dynamic Group 3 |

## 36.16.25 Scrubber Control (SBRCTL)

## Offset

| Register   | Offset   |
|------------|----------|
| SBRCTL     | B2Ch     |

## Diagram

<!-- image -->

## Fields

<!-- image -->

| Field   | Function   |
|---------|------------|
| 31-21   | Reserved   |

Table continues on the next page...

DDR Subsystem

## Table continued from the previous page...

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 20-8 scrub_interval      | Scrub interval. (512 x scrub_interval) number of clock cycles between two scrub read commands. If set to 0, scrub commands are issued back-to-back. This mode of operation (scrub_interval=0) can typically be used for scrubbing the full range of memory at once before or after SW controlled low power operations. After completing the full range of scrub while scrub_interval=0, scrub_done register is set and sbr_done_intr interrupt signal is asserted. This mode can't be used with Inline ECC: If MEMC_INLINE_ECC is 1 and scrub_interval is programme to 0, then RMW logic inside scrubber is disabled. New programmed value will take effect only after scrubber is disabled by programming scrub_en to 0. Unit: Multiples of 512 sbr_clk cycles. Programming Mode: Dynamic |
| 7 -                      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 6-4 scrub_burst          | Scrub burst count. Determines the number of back-to-back scrub read commands that can be issued together when the controller is in one of the HW controlled low power modes, both normal operation mode and low-power mode with Inline ECC. During these modes, the period of the scrub burst becomes "scrub_burst*scrub_interval" cycles. (Inline ECC): 1: 8 reads, 2: 16 reads, 3: 32 reads. New programmed value will take effect only after scrubber is disabled by programming scrub_en to 0. Programming Mode: Dynamic                                                                                                                                                                                                                                                               |
| 3 -                      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 2 scrub_mode             | scrub_mode:0 ECC scrubber will perform reads scrub_mode:1 ECC scrubber will perform writes Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 1 scrub_during_lo wpower | Continue scrubbing during low power. If set to 1, burst of scrubs will be issued in HW controlled low power modes. There are two such modes: automatically initiated by idleness or initiated by Hardware low power interface. If set to 0, the scrubber will not attempt to send commands while the MC is in HW controlled low power modes. In this case, the scrubber will remember the last address issued and will automatically continue from there when the MC exits the LP mode. Programming Mode: Dynamic                                                                                                                                                                                                                                                                          |
| 0 scrub_en               | Enable ECC scrubber. If set to 1, enables the scrubber to generate background read commands after the memories are initialized. If set to 0, disables the scrubber, resets the address generator to 0 and clears the scrubber status. This bitfield must be accessed separately from the other bitfields in this register. Programming Mode: Dynamic                                                                                                                                                                                                                                                                                                                                                                                                                                       |

## 36.16.26 Scrubber Status (SBRSTAT)

## Offset

| Register   | Offset   |
|------------|----------|
| SBRSTAT    | B30h     |

## Diagram

<!-- image -->

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                           |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-2 -       | Reserved                                                                                                                                                                                                                                                                                                                                                           |
| 1 scrub_done | Scrubber done. Controller sets this bit to 1, after full range of addresses are scrubbed once while scrub_interval is set to 0. Cleared if scrub_en is set to 0 (scrubber disabled) or scrub_interval is set to a non-zero value for normal scrub operation. The interrupt signal, sbr_done_intr, is equivalent to this status bitfield. Programming Mode: Dynamic |
| 0 scrub_busy | Scrubber busy. Controller sets this bit to 1 when the scrubber logic has outstanding read commands being executed. Cleared when there are no active outstanding scrub reads in the system. Programming Mode: Dynamic                                                                                                                                               |

## 36.16.27 Scrubber Write Data Pattern0 (SBRWDATA0)

## Offset

| Register   | Offset   |
|------------|----------|
| SBRWDATA0  | B34h     |

<!-- image -->

DDR Subsystem

## Fields

| Field          | Function                                                                     |
|----------------|------------------------------------------------------------------------------|
| 31-0           | ECC Scrubber write data pattern for data bus[31:0] Programming Mode: Dynamic |
| scrub_pattern0 |                                                                              |

DDR Subsystem

## Chapter 37 DDR General Purpose Registers (DDR\_GPR)

## 37.1 Introduction

## DDR\_GPR:

- Drives the specific input ports of the DDR module, giving you further configurable options to use the module in different ways
- Helps in capturing some status outputs of the DDR module
- Supports the debugging of the DDR module
- Not writable in User mode and bus fault is expected if any write occurs in User mode

## 37.2 DDR\_GPR register descriptions

## 37.2.1 DDR\_GPR memory map

DDR\_GPR base address: 4007\_C600h

| Offset   | Register                                   |   Width (In bits) | Access   | Reset value   |
|----------|--------------------------------------------|-------------------|----------|---------------|
| 0h       | Configuration 0 (DDR_Config_0)             |                32 | RW       | 0000_0000h    |
| 4h       | Configuration 1 (DDR_Config_1)             |                32 | RW       | 0000_0000h    |
| 8h       | Configuration 2 (DDR_Config_2)             |                32 | RW       | 0000_0000h    |
| Ch       | Configuration 3 (DDR_Config_3)             |                32 | R        | 0000_0000h    |
| 10h      | Configuration 4 (DDR_Config_4)             |                32 | R        | 0000_0000h    |
| 14h      | Configuration 5 (DDR_Config_5)             |                32 | RW       | 0000_0000h    |
| 1Ch      | LP3 IO Retention Control (DDR_RET_CONTROL) |                32 | RW       | 0000_0001h    |

## 37.2.2 Configuration 0 (DDR\_Config\_0)

## Offset

| Register     | Offset   |
|--------------|----------|
| DDR_Config_0 | 0h       |

## Function

Reset type = Functional

## Diagram

<!-- image -->

| Bits   | 31          | 30                        | 29                        | 28                        | 27                        | 26                        | 25                        | 24                        | 23                        | 22                   | 21                   | 20                   | 19                   | 18                   | 17                   | 16                   |
|--------|-------------|---------------------------|---------------------------|---------------------------|---------------------------|---------------------------|---------------------------|---------------------------|---------------------------|----------------------|----------------------|----------------------|----------------------|----------------------|----------------------|----------------------|
| R W    | PERF_ CN... | sbrAddressRangeMask_35_32 | sbrAddressRangeMask_35_32 | sbrAddressRangeMask_35_32 | sbrAddressRangeMask_35_32 | sbrAddressStartMask_35_32 | sbrAddressStartMask_35_32 | sbrAddressStartMask_35_32 | sbrAddressStartMask_35_32 | WRECC_CREDIR_CNT     | WRECC_CREDIR_CNT     | WRECC_CREDIR_CNT     | WRECC_CREDIR_CNT     | WRECC_CREDIR_CNT     | WRECC_CREDIR_CNT     | WRECC_CREDIR_CNT     |
| Reset  | 0           | 0                         | 0                         | 0                         | 0                         | 0                         | 0                         | 0                         | 0                         | 0                    | 0                    | 0                    | 0                    | 0                    | 0                    | 0                    |
| Bits   | 15          | 14                        | 13                        | 12                        | 11                        | 10                        | 9                         | 8                         | 7                         | 6                    | 5                    | 4                    | 3                    | 2                    | 1                    | 0                    |
| R W    | Reserv ed   | memor y_... Reserved      | memor y_... Reserved      | memor y_... Reserved      | memor y_... Reserved      | memor y_... Reserved      | memor y_... Reserved      | memor y_... Reserved      | memor y_... Reserved      | memor y_... Reserved | memor y_... Reserved | memor y_... Reserved | memor y_... Reserved | memor y_... Reserved | memor y_... Reserved | memor y_... Reserved |
| Reset  | 0           | 0                         | 0                         | 0                         | 0                         | 0                         | 0                         | 0                         | 0                         | 0                    | 0                    | 0                    | 0                    | 0                    | 0                    | 0                    |

## Fields

| Field                            | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 PERF_CNT_FU LL_MASK           | Monitor Counter Full Interrupt Enables and disables the "monitor counter full" interrupt. 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 30-27 sbrAddressRan geMask_35_32 | Scrubber Address Range Mask Bits 35:32 Limits the address range that the ECC scrubber can generate. The full address range mask is 36 bits wide. sbrAddressRangeMask_35_32 contains bits 35:32 of the full mask. DDR_Config_2[sbrAddressRangeMask] contains the remaining bits. For normal scrubber operation, write a 0 to this field. Use other values only for debug purposes. Valid values are 2 n -1, where n =0-33. You must also ensure that the value does not exceed the memory capacity.                                                                                        |
| 26-23 sbrAddressStart Mask_35_32 | Scrubber Address Start Mask Bits 35:32 Specifies part of the starting address which the ECC scrubber generates. The full scrubber address start mask is 36 bits wide. sbrAddressStartMask_35_32 contains bits 35:32 of the full mask. DDR_Config_1[sbrAddressStartMask] contains the remaining bits. For normal scrubber operation, write a 0 to this field. Use other values only for debug purposes. Valid values are 2 n -1, where n =0-33. You must also ensure that the value: • Does not exceed the memory capacity • Is less than the value defined by the full address range mask |
| 22-16 WRECC_CRED IR_CNT          | WRECC Credit Provides the number of available slots (free positions) of write ECC WR content addressable memory (CAM). Each slot holds a DRAM burst synchronous to the DDR core clock (800 MHz). The value is decremented/incremented as commands flow in/out of the write ECC CAM.                                                                                                                                                                                                                                                                                                       |
| 15                               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

Table continues on the next page...

DDR General Purpose Registers (DDR\_GPR)

## Table continued from the previous page...

| Field         | Function                                                                                                                                                                                                                                                         |
|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -             |                                                                                                                                                                                                                                                                  |
| 14 memory_ret | Memory Data Retention Controls the retention of memory data in Standby mode. In Standby mode, address and data inputs are disabled. Data stored in the memory is retained, but the memory cannot be accessed for reads or writes. 0b - Do not retain 1b - Retain |
| 13-0 -        | Reserved                                                                                                                                                                                                                                                         |

## 37.2.3 Configuration 1 (DDR\_Config\_1)

## Offset

| Register     | Offset   |
|--------------|----------|
| DDR_Config_1 | 4h       |

## Function

Reset type = Functional

## Diagram

<!-- image -->

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24                  | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|---------|------|------|------|------|------|------|------|---------------------|------|------|------|------|------|------|------|------|
| R W     |      |      |      |      |      |      |      | sbrAddressStartMask |      |      |      |      |      |      |      |      |
| Reset   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0                   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8                   | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R       |      |      |      |      |      |      |      | sbrAddressStartMask |      |      |      |      |      |      |      |      |
| W Reset | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0                   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                       |
|---------|----------------------------------------------------------------------------------------------------------------|
| 31-0    | Scrubber Address Start Mask Bits 31:0 Specifies part of the starting address which the ECC scrubber generates. |

Table continues on the next page...

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| sbrAddressStart Mask | The full scrubber address start mask is 36 bits wide. sbrAddressStartMask contains bits 31:0 of the full mask. DDR_Config_0[sbrAddressStartMask_35_32] contains the remaining bits. This field must be programmed to the HIF start address before starting any scrubber operation. Here, HIF start address = AXI start address >>2. For normal scrubber operation, write a 0 to this field. Use other values only for debug purposes. Valid values are 2 n -1, where n =0-33. You must also ensure that the value: • Does not exceed the memory capacity • Is less than the value defined by the full address range mask |

## 37.2.4 Configuration 2 (DDR\_Config\_2)

## Offset

| Register     | Offset   |
|--------------|----------|
| DDR_Config_2 | 8h       |

<!-- image -->

## Fields

| Field                | Function                                                                                                                                                                                                                                |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0                 | Scrubber Address Range Mask Bits 31:0                                                                                                                                                                                                   |
| sbrAddressRan geMask | Limits the address range that the ECC scrubber can generate. The full address range mask is 36 bits wide. sbrAddressRangeMask contains bits 31:0 of the full mask. DDR_Config_0[sbrAddressRangeMask_35_32] contains the remaining bits. |

Table continues on the next page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                               |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | This field must be programmed to HIF end address before starting any scrubber operation. Here, HIF end address=AXI end address >>2. For normal scrubber operation, write a 0 to this field. Use other values only for debug purposes. Valid values are 2 n -1, where n =0-33. You must also ensure that the value does not exceed the memory capacity. |

## 37.2.5 Configuration 3 (DDR\_Config\_3)

## Offset

| Register     | Offset   |
|--------------|----------|
| DDR_Config_3 | Ch       |

## Function

Reset type = Functional

## Diagram

<!-- image -->

## Fields

| Field                             | Function                                                                                                 |
|-----------------------------------|----------------------------------------------------------------------------------------------------------|
| 31-23 -                           | Reserved                                                                                                 |
| 22-21 stat_ddrc_reg_s elfref_type | DDR Controller 0 Self Refresh Status And Type Mirrors the value of STAT[selfref_type] in the DDR module. |
| 20-17 raqb_wcount_2               | Port 2 Read Address Channel Shows the number of used positions in the blue read address FIFO.            |

Table continues on the next page...

## Table continued from the previous page...

| Field                     | Function                                                                                                                                                                                                      | Function                                                                                                                                                                                                      | Function                                                                                                                                                                                                      |
|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 16-13 raqb_wcount_1       | AXI Port 1 Read Address Channel Shows the number of used positions in the blue read address FIFO.                                                                                                             | AXI Port 1 Read Address Channel Shows the number of used positions in the blue read address FIFO.                                                                                                             | AXI Port 1 Read Address Channel Shows the number of used positions in the blue read address FIFO.                                                                                                             |
| 12-9 raqb_wcount_0        | AXI Port 0 Read Address Channel Shows the number of used positions in the blue read address FIFO.                                                                                                             | AXI Port 0 Read Address Channel Shows the number of used positions in the blue read address FIFO.                                                                                                             | AXI Port 0 Read Address Channel Shows the number of used positions in the blue read address FIFO.                                                                                                             |
| 8-3 hif_refresh_req_ bank | Refresh Bank Indicates the next bank to refresh. For multi-rank configurations, the bank number is reported independently for each rank and the information for all ranks is concatenated to form this field. | Refresh Bank Indicates the next bank to refresh. For multi-rank configurations, the bank number is reported independently for each rank and the information for all ranks is concatenated to form this field. | Refresh Bank Indicates the next bank to refresh. For multi-rank configurations, the bank number is reported independently for each rank and the information for all ranks is concatenated to form this field. |
| 2-0 dbg_dfi_ie_cmd _type  | Debug DFI Command Type Corresponds to the "Inline ECC Debug" signal of DDR Controller 0. Thevalue of this field is validwhentheDFIcommand/addressisRD/RDAorWR/WRA.Otherwise,thevalue is irrelevant.           | Debug DFI Command Type Corresponds to the "Inline ECC Debug" signal of DDR Controller 0. Thevalue of this field is validwhentheDFIcommand/addressisRD/RDAorWR/WRA.Otherwise,thevalue is irrelevant.           | Debug DFI Command Type Corresponds to the "Inline ECC Debug" signal of DDR Controller 0. Thevalue of this field is validwhentheDFIcommand/addressisRD/RDAorWR/WRA.Otherwise,thevalue is irrelevant.           |
| 2-0 dbg_dfi_ie_cmd _type  | Command                                                                                                                                                                                                       | dbg_dfi_ie_cmd_type value                                                                                                                                                                                     | Meaning                                                                                                                                                                                                       |
| 2-0 dbg_dfi_ie_cmd _type  | RD/RDA                                                                                                                                                                                                        | 000b                                                                                                                                                                                                          | RD_N (RD data for non-protected region)                                                                                                                                                                       |
| 2-0 dbg_dfi_ie_cmd _type  | RD/RDA                                                                                                                                                                                                        | 001b                                                                                                                                                                                                          | RD_E (RD data for protected region)                                                                                                                                                                           |
| 2-0 dbg_dfi_ie_cmd _type  | RD/RDA                                                                                                                                                                                                        | 010b                                                                                                                                                                                                          | RE_B (RD ECC in block read/write)                                                                                                                                                                             |
| 2-0 dbg_dfi_ie_cmd _type  | RD/RDA                                                                                                                                                                                                        | 111b                                                                                                                                                                                                          | MPR read (DDR4 only) with WR/WRA commands                                                                                                                                                                     |
| 2-0 dbg_dfi_ie_cmd _type  | WR/WRA                                                                                                                                                                                                        | 000b                                                                                                                                                                                                          | WD_N (WR data for non-protected region)                                                                                                                                                                       |
| 2-0 dbg_dfi_ie_cmd _type  | WR/WRA                                                                                                                                                                                                        | 001b                                                                                                                                                                                                          | WD_E (WR data for protected region)                                                                                                                                                                           |
| 2-0 dbg_dfi_ie_cmd _type  | WR/WRA                                                                                                                                                                                                        | 010b                                                                                                                                                                                                          | WE_BW (WR ECC in block write)                                                                                                                                                                                 |
| 2-0 dbg_dfi_ie_cmd _type  | WR/WRA                                                                                                                                                                                                        | 111b                                                                                                                                                                                                          | MPR write (DDR4 only)                                                                                                                                                                                         |

## 37.2.6 Configuration 4 (DDR\_Config\_4)

## Offset

| Register     | Offset   |
|--------------|----------|
| DDR_Config_4 | 10h      |

## Function

Reset type = Functional

## Diagram

<!-- image -->

| Bits   | 31           | 30           | 29           | 28           | 27            | 26            | 25            | 24            | 23            | 22            | 21            | 20            | 19            | 18            | 17            | 16            |
|--------|--------------|--------------|--------------|--------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|
| R W    | Reserv ed    | Reserved     | Reserved     | Reserved     | Reserved      | Reserved      | Reserved      | Reserved      | waq_wcount_2  | waq_wcount_2  | waq_wcount_2  | waq_wcount_2  | waq_wcount_1  | waq_wcount_1  | waq_wcount_1  | waq_wcount_1  |
| Reset  | 0            | 0            | 0            | 0            | 0             | 0             | 0             | 0             | 0             | 0             | 0             | 0             | 0             | 0             | 0             | 0             |
| Bits   | 15           | 14           | 13           | 12           | 11            | 10            | 9             | 8             | 7             | 6             | 5             | 4             | 3             | 2             | 1             | 0             |
| R      | waq_wcount_0 | waq_wcount_0 | waq_wcount_0 | waq_wcount_0 | raqr_wcount_2 | raqr_wcount_2 | raqr_wcount_2 | raqr_wcount_2 | raqr_wcount_1 | raqr_wcount_1 | raqr_wcount_1 | raqr_wcount_1 | raqr_wcount_0 | raqr_wcount_0 | raqr_wcount_0 | raqr_wcount_0 |
| W      |              |              |              |              |               |               |               |               |               |               |               |               |               |               |               |               |
| Reset  | 0            | 0            | 0            | 0            | 0             | 0             | 0             | 0             | 0             | 0             | 0             | 0             | 0             | 0             | 0             | 0             |

## Fields

| Field              | Function                                                                                         |
|--------------------|--------------------------------------------------------------------------------------------------|
| 31 -               | Reserved                                                                                         |
| 30-24 -            | Reserved                                                                                         |
| 23-20 waq_wcount_2 | AXI Port 2 Write Address Channel Shows the number of used positions in the write address FIFO.   |
| 19-16 waq_wcount_1 | AXI Port 1 Write Address Channel Shows the number of used positions in the write address FIFO.   |
| 15-12 waq_wcount_0 | AXI Port 0 Write Address Channel Shows the number of used positions in the write address FIFO.   |
| 11-8 raqr_wcount_2 | AXI Port 2 Read Address Channel Shows the number of used positions in the red read address FIFO. |
| 7-4 raqr_wcount_1  | AXI Port 1 Read Address Channel Shows the number of used positions in the red read address FIFO. |
| 3-0 raqr_wcount_0  | AXI Port 0 Read Address Channel Shows the number of used positions in the red read address FIFO. |

DDR General Purpose Registers (DDR\_GPR)

## 37.2.7 Configuration 5 (DDR\_Config\_5)

## Offset

| Register     | Offset   |
|--------------|----------|
| DDR_Config_5 | 14h      |

## Function

Contains the mapped safety logic (the RCCU set/clear logic) for AXI inside the DDR subsystem.

Each AXI instance has two RCCUs-main and dummy. Each RCCU compares two data sources (SRC\_A and SRC\_B) that enter and exit the AXI interface, and sends an alarm under the circumstances described in Figure 209.

<!-- image -->

Reset type = Functional

## Diagram

<!-- image -->

## Fields

| Field                   | Function                                                                                                                                                      |
|-------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-21 -                 | Reserved                                                                                                                                                      |
| 20 main_rccu_clr_a xi2  | Main RCCU Clear Alarm For AXI 2 Allows you to clear (override) an alarm that the main RCCU produced for AXI 2. See Figure 209. 0b - Do not clear 1b - Clear   |
| 19 dummy_rccu_clr _axi2 | Dummy RCCU Clear Alarm For AXI 2 Allows you to clear (override) an alarm that the dummy RCCU produced for AXI 2. See Figure 209. 0b - Do not clear 1b - Clear |
| 18 main_rccu_set_ axi2  | Main RCCU Set Alarm For AXI 2 Allows you to set (inject) a false alarm into the main RCCU for AXI 2. See Figure 209. 0b - Do not set 1b - Set                 |
| 17 dummy_rccu_se t_axi2 | Dummy RCCU Set Alarm For AXI 2 Allows you to set (inject) a false alarm into the dummy RCCU for AXI 2. See Figure 209. 0b - Do not set 1b - Set               |
| 16 main_rccu_clr_a xi1  | Main RCCU Clear Alarm For AXI 1 Allows you to clear (override) an alarm that the main RCCU produced for AXI 1. See Figure 209. 0b - Do not clear 1b - Clear   |
| 15 dummy_rccu_clr _axi1 | Dummy RCCU Clear Alarm For AXI 1 Allows you to clear (override) an alarm that the dummy RCCU produced for AXI 1. See Figure 209. 0b - Do not clear 1b - Clear |
| 14 main_rccu_set_ axi1  | Main RCCU Set Alarm For AXI 1 Allows you to set (inject) a false alarm into the main RCCU for AXI 1. See Figure 209. 0b - Do not set 1b - Set                 |
| 13                      | Dummy RCCU Set Alarm For AXI 1                                                                                                                                |

Table continues on the next page...

## Table continued from the previous page...

| Field                   | Function                                                                                                                                                      |
|-------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| dummy_rccu_se t_axi1    | Allows you to set (inject) a false alarm into the dummy RCCU for AXI 1. See Figure 209. 0b - Do not set 1b - Set                                              |
| 12 main_rccu_clr_a xi0  | Main RCCU Clear Alarm For AXI 0 Allows you to clear (override) an alarm that the main RCCU produced for AXI 0. See Figure 209. 0b - Do not clear 1b - Clear   |
| 11 dummy_rccu_clr _axi0 | Dummy RCCU Clear Alarm For AXI 0 Allows you to clear (override) an alarm that the dummy RCCU produced for AXI 0. See Figure 209. 0b - Do not clear 1b - Clear |
| 10 main_rccu_set_ axi0  | Main RCCU Set Alarm For AXI 0 Allows you to set (inject) a false alarm into the main RCCU for AXI 0. See Figure 209. 0b - Do not set 1b - Set                 |
| 9 dummy_rccu_se t_axi0  | Dummy RCCU Set Alarm For AXI 0 Allows you to set (inject) a false alarm into the dummy RCCU for AXI 0. See Figure 209. 0b - Do not set 1b - Set               |
| 8-0 -                   | Reserved                                                                                                                                                      |

## 37.2.8 LP3 IO Retention Control (DDR\_RET\_CONTROL)

## Offset

| Register        | Offset   |
|-----------------|----------|
| DDR_RET_CONTROL | 1Ch      |

## Function

Controls the DDR LP3 IO retention before asserting the software functional reset through MC\_ME.

Reset type = Functional

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16          |
|--------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|-------------|
| R W    | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved    |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0           |
| Bits   | 15       | 14       | 13       | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0           |
| R W    |          |          |          |          |          |          |          | Reserved |          |          |          |          |          |          |          | DDR_ RET... |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 1           |

## Fields

| Field              | Function                                                                                                                                                                                                                 |
|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-1 -             | Reserved                                                                                                                                                                                                                 |
| 0 DDR_RET_CO NTROL | DDR LP3 IO Retention Control Enables and disables DDR LP3 IO retention. Write a 0 to this field immediately before asserting software functional reset through MC_ME to enable the retention. 0b - Enabled 1b - Disabled |

DDR General Purpose Registers (DDR\_GPR)

## Chapter 38 Quad Serial Peripheral Interface (QuadSPI)

## 38.1 Chip-specific QuadSPI configuration

## 38.1.1 Overview

The QuadSPI module and associated PHY provide a common memory interface to single, dual, quad, and octal NOR flash memory, including Hyperflash memory. The primary use case of the QuadSPI is for interfacing with external flash memory and octal PSRAMs. The flash memory interface supports the following external NOR flash memories:

- 8-bit wide bus (x8) DDR NOR, OctaFlash ™ , XTRM, and HyperFlash ™  flash memories
- 4-bit wide bus (x4) SDR and DDR quad NOR flash memories
- Cypress QuadFlash memory
- Octal PSRAM memory

For QuadSPI pin-mapping, see the device 'Input Muxing' tab in the IOMUX spreadsheet attached to this document.

For the target frequencies, see the chip data sheet.

For Master ID information, see the table MDAC configuration in Chip-specific XRDC\_0 information and Chip-specific XRDC\_1 information sections.

## 38.1.2 Supported read modes

NOTE

Refer to the device data sheet QuadSPI configurations section for more information.

## 38.1.3 QuadSPI clocking

The ratio of bus clock period to flash clock period must not be less than 1:5. The ratio of bus clock period to internal reference clock must not be less than that derived from the formula below. For more details, see the chip data sheet.

The flash read timing must meet the following condition:

The total time period of the number of clock cycles required to fetch the next n bits of data (where n can be 64, 32, or 16) from flash memory must be greater than two bus clock periods.

Derive DDR octal writes using the following equation:

(3 x flash clock period) + (3 x bus clock period) &lt; (8 x flash clock period)

## 38.1.4 QuadSPI limitations

The implementation of QuadSPI in this chip has the following limitations:

- No support for DDR Center Aligned Read Strobe (DCARS) flash memory.
- This chip does not support WRAP* transactions for AHB read.
- Any speculative access of the QuadSPI memory mapped region 00000000h-20000000h before you configure QuadSPI might result in unexpected chip behavior. Therefore, in this situation, you must use core programming to disable speculative access of that region.
- You must reset or flush the QuadSPI AHB buffer and IPS domain before the first AHB read transaction, or before you reconfigure the QuadSPI AHB buffer and IPS domain.
- You must rely on the FCCU fault for ECC error handling by writing 0 to RSER[CRCBIE] and RSER[CRCAIE]. In cases where FCCU is not configured (for example, in the boot loader), you must write 1 to these fields.

Quad Serial Peripheral Interface (QuadSPI)

- When only the data-learning sampling mode is supported for a frequency, you must not read the flash memory device (even its status register) in the nondata learning mode at that frequency.

## 38.1.5 Chip-specific feature configuration

QuadSPI instance on this chip does not support Peripheral chip select (PCS). Disregard its references in this chapter.

QuadSPI instance on this chip supports Auto-learning feature at 66MHz only. For more details, see the chip Data Sheet.

## NOTE

Reset (flush) the QSPI AHB buffer and the IPS domain before the first AHB read transaction, or if you reconfigure them.

## 38.2 Introduction

The QuadSPI module acts as an interface to a single or two external SFM devices, each with up to eight bidirectional data lines.

## 38.2.1 Features

QuadSPI supports the following features:

- Flexible sequence engine to support various flash memory vendor devices. As there is no specific standard, the module supports various kinds of flash memories from different vendors. See Serial flash memory devices for example sequences.
- Single, dual, and quad modes of operation supported for Quad flash memories
- Octal and single IO modes of operation supported for Octal flash memories
- Double Data Rate (DDR)/Double Transfer Rate (DTR) mode in which the data is generated on every edge of the serial flash memory clock
- Flash memory data strobe signal to support data sampling in DDR and Single Data Rate (SDR) mode
- Support for HyperFlash memory
- Support for Macronix Octal Data integrity features such as ECC and R/W parity (CRC1)
- Support for parallel writes through register-mapped interface in single I/O mode
- Ability to connect two identical serial flash memory devices and access them simultaneously for data read operations, forming one (virtual) flash memory with doubled readout bandwidth
- AHB master to read RX buffer data through AMBA AHB (64-bit width interface) or IPS registers space (32-bit access) and fill TX buffer via IPS registers space (32-bit access) or using AHB (64-bit width interface)
- AHB master can be a DMA with a configurable inner loop size
- Multi-master accesses are allowed, but only a single master access is supported with On-the-fly AES decryption (OTFAD)
- Flexible and configurable buffer for each master-total available buffer size is 1024 bytes.
- All AHB accesses to flash/RAM memory devices are directly memory mapped to the chip system memory
- Programmable sequence engine to cater to future command/protocol changes and ability to support all existing vendor commands and operations. The software needs to select the corresponding sequence according to the connected flash memory device.
- Support for all types of addressing
- Support for interaction with OTFAD

## 38.2.2 RX buffer push event

To add the valid entries into the RX buffer

Quad Serial Peripheral Interface (QuadSPI)

By default, each buffer push event adds two entries to the RX buffer because the interface to the serial clock domain is 64 bits in width. Depending on the number of bytes read from the serial flash memory device, it is possible for the very last buffer push event that only one entry is added.

RBSR[RDBFL] is incremented by the number of entries added to the RX buffer.

## 38.2.3 RX buffer POP event

To remove valid entries from the RX buffer

Each buffer POP event removes (RBCT[WMRK] + 1) valid entries from the buffer. BSR[RDBFL] is decremented by the same number and RBSR[RDCTR] is incremented accordingly.

## 38.2.4 Block diagram

The following figure shows a block diagram of the QuadSPI module.

Quad Serial Peripheral Interface (QuadSPI)

<!-- image -->

## 38.2.5 QuadSPI modes of operation

QuadSPI supports the following modes of operation:

- Normal mode: You can use this mode for write or read accesses to an external serial flash memory device. See Normal mode for details.
- Serial flash memory write: You can program data into the flash memory through the IP interface only. See Flash memory programming for details.

Quad Serial Peripheral Interface (QuadSPI)

- Serial flash memory read: Read the contents of the serial flash memory device. Two separate read channels are available through the RX buffer and AHB buffer. See Flash memory read for details.
- Module Disable mode: You can use this mode for disabling serial flash memory clock and AHB command. The clock to the non-memory mapped logic in QuadSPI can be stopped in the Module Disable mode. The module enters the mode by setting MCR[MDIS].

## 38.3 External signal description

This section provides the external signal information for the QuadSPI module.

The following table lists the external signals belonging to the module in conjunction with the different modes of operation.

Table 213. Signal properties

| Signal name   | Function                               | Direction   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|---------------|----------------------------------------|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PCSFA1        | Peripheral Chip Select Flash Memory A1 | O           | This signal is the chip select for the serial flash memory device A1 that represents the first device in a dual-die package flash memory A or the first of the two flash memory devices that share IOFA. See Dual-die flash memories for details.                                                                                                                                                                                                                                                                             |
| PCSFA2        | Peripheral Chip Select Flash Memory A2 | O           | This signal is the chip select for the serial flash memory device A2 that represents the second device in a dual-die package flash memory A or the second of the two flash memorydevices that share IOFA. SeeDual-die flash memories for details.                                                                                                                                                                                                                                                                             |
| PCSFB1        | Peripheral Chip Select Flash memory B1 | O           | This signal is the chip select for the serial flash memory device B1 that represents the first device in a dual-die package flash memory B or the first of the two flash memory devices that share IOFB. See Dual-die flash memories for details.                                                                                                                                                                                                                                                                             |
| PCSFB2        | Peripheral Chip Select Flash Memory B2 | O           | This signal is the chip select for the serial flash memory device B2 that represents the second device in a dual-die package flash memory B or the second of the two flash memorydevices that share IOFB. SeeDual-die flash memories for details.                                                                                                                                                                                                                                                                             |
| SCKFA         | Serial Clock Flash Memory A            | O           | This signal is the serial clock output to the serial flash memory device A.                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| SCKFB         | Serial Clock Flash B                   | O           | This signal is the serial clock output to the serial flash memory device B.                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| IOFA[7:0]     | Serial I/O Flash memory A              | I/O         | These signals are the data I/O lines to/from the serial flash memory device A. See Driving external signals for details about the signal drive and timing behavior. Note that the signal pins of the serial flash memory device may change their function according to the SFM Command executed, leaving them as control inputs when single and dual instructions are executed. The module supports driving these inputs to dedicated values. In single I/O mode, QuadSPI drives data on IOFA[0] and expects data on IOFA[1]. |
| IOFB[7:0]     | Serial I/O Flash Memory B              | I/O         | These signals are the data I/O lines to/from the serial flash memory device B. See Driving external signals for details about the signal drive and timing behavior. Note that the signal pins of the serial flash memory device may change their function according to the SFM command executed, leaving                                                                                                                                                                                                                      |

Table continues on the next page...

Table 213. Signal properties (continued)

| Signal name   | Function                            | Direction   | Description                                                                                                                                                                                                          |
|---------------|-------------------------------------|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|               |                                     |             | them as control inputs when single and dual instructions are executed. The module supports driving these inputs to dedicated values. In single I/O mode, QuadSPI drives data on IOFB[0] and expects data on IOFB[1]. |
| DQSFA         | Data Strobe signal Flash Memory A   | I           | This is the data strobe signal for port A. Someflash memoryvendors provide the Data Read Strobe (DQS) signal to which the read data is aligned in DDR mode.                                                          |
| DQSFB         | Data Strobe signal Flash Memory B   | I           | This is the data strobe signal for port B. Some flash memory vendors provide the DQS signal to which the read data is aligned in DDR mode.                                                                           |
| INTA          | ECC error signal for Flash Memory A | I           | Flash Memory A drives this signal to active low value in case of an ECC error.                                                                                                                                       |
| INTB          | ECC error signal for Flash Memory B | I           | Flash Memory B drives this signal to active low value in case of an ECC error.                                                                                                                                       |

## NOTE

Please refer to chip specific information to check the configuration of QuadSPI block.

## 38.3.1 Driving external signals

Single/dual/quad/octal instructions

Depending on the serial flash memory device connected to the QuadSPI module, there are instructions using a different number of data lines:

- Single pad: Single line I/O with one data out and one data in line to/from the serial flash memory device
- Dual pad: Dual line I/O with two bidirectional I/O lines, driven alternatively by the serial flash memory device or the QuadSPI module
- Quad pad: Quad line I/O with four bidirectional I/O lines, driven alternatively by the serial flash memory device or the QuadSPImodule
- Octal pad: Octal line I/O with eight bidirectional I/O lines, driven alternatively by the serial flash memory device or the QuadSPI module

The different phases of the serial flash memory access scheme are shown in the following figure.

Quad Serial Peripheral Interface (QuadSPI)

<!-- image -->

Note1:The IOs are driven from QuadSPI as per the number of pads configured for ongoing phase.

Note:The lines status will change based on command mode in case of instruction, address and mode phases. It can be either 1,2 or 4 lines

Following are the different phases and the I/O driving characteristics of the QuadSPI module:

- Idle: Serial flash memory device not selected - no interaction with the serial flash memory device and the IOFx signals are driven.
- Instruction: Serial flash memory device selected - the instruction is sent to the serial device and all the IOFx signals are driven.
- Address: Serial flash memory address is sent to the device - all the IOFx signals are driven and this phase is not applicable for all SFM commands.
- Mode: Mode bytes are sent to the serial flash memory device - all the IOFx signals are driven and this phase is not applicable for all SFM commands.

Quad Serial Peripheral Interface (QuadSPI)

- Dummy: Dummy clocks are provided to the serial flash memory device. See Figure 211 for the IOFx signals driven. The actual data lines required for the SFM command executed are not driven for data read commands.

## NOTE

- This phase is not applicable for all the SFM commands.
- All read commands in Dual pad, Quad pad /or Octal pad modes must use a Dummy phase immediately before the Data phase. The Dummy phase pad configuration in the LUT must use the same number of pads as the subsequent Data phase. Note that this restriction is not applicable to Single-pad mode.
- Data: Serial flash memory data are sent to or received from the serial flash memory device. See the preceding figure for the IOFx signals driven. The actual data lines required for the SFM command executed are not driven for data read commands.

## NOTE

This phase is not applicable for all the SFM commands.

The PCSFx and SCKFx signals are driven permanently throughout all the phases. In the individual flash memory mode, this applies to the selected flash memory device. In the parallel flash memory mode, this applies to both the serial flash memory devices simultaneously.

Access to a single, individual serial flash memory device

See Serial flash memory access schemes for details.

Read access to two serial flash memory devices attached to the QuadSPI module in parallel. See Serial flash memory access schemes for details.

## 38.4 Memory map and register definition

This section provides the memory map and register definitions for the QuadSPI module.

## 38.4.1 Register write access

Following are the write access restriction terms that apply to all the registers:

- Register write access restriction

For each register field, the write access conditions are specified in the detailed register description.

The following table provides a description of the write access conditions. If, for a specific register bit or field, none of the given write access conditions is fulfilled, any write attempt to this register bit or field is ignored without any notification. The values of the bits or fields are not changed.

The condition term [A or B] indicates that the register or field can be written to if at least one of the conditions is fulfilled.

Table 214. Register write access restrictions

| Condition     | Description                                           |
|---------------|-------------------------------------------------------|
| Anytime       | No write access restriction                           |
| Disabled mode | Write access only if MCR[MDIS] = 1                    |
| Normal mode   | Write access only if the module is in the normal mode |

- Register write access requirements

You can access all registers using 8-bit, 16-bit, and 32-bit wide operations. For some of the registers, at least a 16-bit or 32-bit wide write access is required to ensure correct operation. This write access requirement is stated in the detailed register description for each affected register.

## 38.4.2 QuadSPI register descriptions

This section provides the memory map and register definitions for the QuadSPI module.

Access to the following addresses does not result in a transfer error:

- 24h
- 168h

## 38.4.2.1 QuadSPI memory map

QuadSPI base address: 4013\_4000h

| Offset   | Register                                                   |   Width (In bits) | Access   | Reset value   |
|----------|------------------------------------------------------------|-------------------|----------|---------------|
| 0h       | Module Configuration Register (MCR)                        |                32 | RW       | 000F_404Ch    |
| 8h       | IP Configuration Register (IPCR)                           |                32 | RW       | 0000_0000h    |
| Ch       | Flash Memory Configuration Register (FLSHCR)               |                32 | RW       | 0000_0303h    |
| 10h      | Buffer 0 Configuration Register (BUF0CR)                   |                32 | RW       | 0000_000Bh    |
| 14h      | Buffer 1 Configuration Register (BUF1CR)                   |                32 | RW       | 0000_0001h    |
| 18h      | Buffer 2 Configuration Register (BUF2CR)                   |                32 | RW       | 0000_0002h    |
| 1Ch      | Buffer 3 Configuration Register (BUF3CR)                   |                32 | RW       | 8000_0003h    |
| 20h      | Buffer Generic Configuration Register (BFGENCR)            |                32 | RW       | 0000_0000h    |
| 30h      | Buffer 0 Top Index Register (BUF0IND)                      |                32 | RW       | 0000_0000h    |
| 34h      | Buffer 1 Top Index Register (BUF1IND)                      |                32 | RW       | 0000_0000h    |
| 38h      | Buffer 2 Top Index Register (BUF2IND)                      |                32 | RW       | 0000_0000h    |
| 50h      | AHB Write Configuration Register (AWRCR)                   |                32 | RW       | 0000_0000h    |
| 60h      | DLL Flash Memory A Configuration Register (DLLCRA)         |                32 | RW       | 0120_0000h    |
| 64h      | DLL Flash Memory B Configuration Register (DLLCRB)         |                32 | RW       | 0120_0000h    |
| 6Ch      | Parity Configuration Register (PARITYCR)                   |                32 | RW       | 0000_0000h    |
| 100h     | Serial Flash Memory Address Register (SFAR)                |                32 | RW       | 0000_0000h    |
| 104h     | Serial Flash Memory Address Configuration Register (SFACR) |                32 | RW       | 0000_0800h    |
| 108h     | Sampling Register (SMPR)                                   |                32 | RW       | 0000_0000h    |
| 10Ch     | RX Buffer Status Register (RBSR)                           |                32 | R        | 0000_0000h    |
| 110h     | RX Buffer Control Register (RBCT)                          |                32 | RW       | 0000_0000h    |
| 120h     | AHB Write Status Register (AWRSR)                          |                32 | R        | 0000_0000h    |
| 12Ch     | DLL Status Register (DLLSR)                                |                32 | R        | 8000_8000h    |
| 130h     | Data Learning Configuration Register (DLCR)                |                32 | RW       | 40FF_40FFh    |
| 134h     | Data Learning Status Flash Memory A Register (DLSR_FA)     |                32 | R        | 0000_0000h    |

Table continues on the next page...

## Table continued from the previous page...

| Offset      | Register                                                    |   Width (In bits) | Access   | Reset value   |
|-------------|-------------------------------------------------------------|-------------------|----------|---------------|
| 138h        | Data Learning Status Flash Memory B Register (DLSR_FB)      |                32 | R        | 0000_0000h    |
| 150h        | TX Buffer Status Register (TBSR)                            |                32 | R        | 0000_0000h    |
| 154h        | TX Buffer Data Register (TBDR)                              |                32 | RW       | 0000_0000h    |
| 158h        | TX Buffer Control Register (TBCT)                           |                32 | RW       | 0000_0000h    |
| 15Ch        | Status Register (SR)                                        |                32 | R        | 0200_3800h    |
| 160h        | Flag Register (FR)                                          |                32 | RW       | 0800_0000h    |
| 164h        | Interrupt and DMA Request Select and Enable Register (RSER) |                32 | RW       | 0000_0000h    |
| 16Ch        | Sequence Pointer Clear Register (SPTRCLR)                   |                32 | RW       | 0000_0000h    |
| 180h        | Serial Flash Memory A1 Top Address Register (SFA1AD)        |                32 | RW       | 0000_0000h    |
| 184h        | Serial Flash Memory A2 Top Address Register (SFA2AD)        |                32 | RW       | 0000_0000h    |
| 188h        | Serial Flash Memory B1 Top Address Register (SFB1AD)        |                32 | RW       | 0000_0000h    |
| 18Ch        | Serial Flash Memory B2 Top Address Register (SFB2AD)        |                32 | RW       | 0000_0000h    |
| 190h        | Data Learn Pattern Register (DLPR)                          |                32 | RW       | AA55_3443h    |
| 194h        | Flash Memory A Failing Address Status Register (FAILA_ADDR) |                32 | R        | FFFF_FFFFh    |
| 198h        | flash Memory B Failing Address Status Register (FAILB_ADDR) |                32 | R        | FFFF_FFFFh    |
| 200h - 2FCh | RX Buffer Data Register (RBDR0 - RBDR63)                    |                32 | R        | 0000_0000h    |
| 300h        | LUT Key Register (LUTKEY)                                   |                32 | RW       | 5AF0_5AF0h    |
| 304h        | LUT Lock Configuration Register (LCKCR)                     |                32 | RW       | 0000_0002h    |
| 310h        | LUT Register (LUT0)                                         |                32 | RW       | 0818_0403h    |
| 314h        | LUT Register (LUT1)                                         |                32 | RW       | 2400_1C08h    |
| 318h - 44Ch | LUT Register (LUT2 - LUT79)                                 |                32 | RW       | 0000_0000h    |

## 38.4.2.2 Module Configuration Register (MCR)

## Offset

| Register   | Offset   |
|------------|----------|
| MCR        | 0h       |

## Function

This register holds configuration data associated with the QuadSPI operation.

## NOTE

When out of reset, after first initial MCR programming and exiting module disable mode (that is, when the value of MCR[MDIS] is 0), you must write 1 to MCR[SWRSTSD] and release it after six (three system and three flash memory) clock cycles.

Special write-access is permitted in different modes:

- CK2\_DCARS\_FB, CKN\_FB\_EN, DQS\_FB\_SEL, CK2\_DCARS\_FA, CKN\_FA\_EN, DQS\_FA\_SEL: Disabled mode
- ISD3FB, ISD2FB, ISD3FA, ISD2FA: Disabled mode
- All other fields: Anytime

## Diagram

<!-- image -->

| Bits   | 31          | 30          | 29         | 28         | 27          | 26          | 25         | 24         | 23        | 22        | 21          | 20        | 19       | 18      | 17       | 16       |
|--------|-------------|-------------|------------|------------|-------------|-------------|------------|------------|-----------|-----------|-------------|-----------|----------|---------|----------|----------|
| R W    | CK2_D CA... | CKN_F B_... | DQS_FB_SEL | DQS_FB_SEL | CK2_D CA... | CKN_F A_... | DQS_FA_SEL | DQS_FA_SEL | Reserv ed | Reserv ed | 0           | 0         | ISD3F B  | ISD2F B | ISD3F A  | ISD2F A  |
| Reset  | 0           | 0           | 0          | 0          | 0           | 0           | 0          | 0          | 0         | 0         | 0           | 0         | 1        | 1       | 1        | 1        |
| Bits   | 15          | 14          | 13         | 12         | 11          | 10          | 9          | 8          | 7         | 6         | 5           | 4         | 3        | 2       | 1        | 0        |
| R W    | Reserv ed   | MDIS        | Reserv ed  | DLPE N     | 0           | 0           | 0          | Reserv ed  | DDR_ EN   | DQS_ EN   | DQS_ LAT... | Reserv ed | Reserved |         | SWRS THD | SWRS TSD |
| R W    | Reserv ed   | MDIS        | Reserv ed  | DLPE N     | CLR_ TXF    | CLR_ RXF    | 0          | Reserv ed  | DDR_ EN   | DQS_ EN   | DQS_ LAT... | Reserv ed | Reserved |         | SWRS THD | SWRS TSD |
| Reset  | 0           | 1           | 0          | 0          | 0           | 0           | 0          | 0          | 0         | 1         | 0           | 0         | 1        | 1       | 0        | 0        |

## Fields

| Field            | Function                                                                                                                                                                                             |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 CK2_DCARS_F B | CK2 DDR center-aligned read strobe for flash memory B Write 1 to this field to enable CK2 output 90-degree phase shifted clock. Program this field as 0 in the following cases: NOTE                 |
| 30 CKN_FB_EN     | Enable clock on differential CKN pad of flash memory B Set this field to '1' to enable clock on differential CKN pad for flash memory B.                                                             |
| 29-28 DQS_FB_SEL | DQS clock for sampling read data at flash memory B Selects DQS clock for sampling read data at flash memory B QuadSPI port 00b - Reserved 01b - Dummy Pad loopback 10b - Reserved 11b - External DQS |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

## Table continued from the previous page...

| Field            | Function                                                                                                                                                                                                                                                                                                               |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 27 CK2_DCARS_F A | external DQS and vice-versa. CK2 DDR center-aligned read strobe for flash memory A CK2 is 90 degree phase shifted clock. NOTE Write 1 to this field to enable CK2 output 90-degree phase shifted clock. NOTE                                                                                                           |
| 26 CKN_FA_EN     | CKN pad for flash memory A Set 1 to enable clock on differential CKN pad for flash memory A.                                                                                                                                                                                                                           |
| 25-24 DQS_FA_SEL | DQS clock for sampling read data at flash memory A Selects DQS clock for sampling read data at flash memory A QuadSPI port 00b - Reserved 01b - Pad loopback 10b - Reserved 11b - External DQS In case of an padloopback selection to access port A, port B cannot be programmed for external DQS and vice-versa. NOTE |
| 23 -             | Reserved                                                                                                                                                                                                                                                                                                               |
| 22 -             | Reserved                                                                                                                                                                                                                                                                                                               |
| 21-20 -          | Reserved                                                                                                                                                                                                                                                                                                               |
| 19 ISD3FB        | Idle signal drive IOFB[3] flash memory B This field determines the logic level that the IOFB[3] output of the QuadSPImoduleis driven to in the inactive state. See Driving flash memory control signals in single and dual modes.                                                                                      |

Table continues on the next page...

## Table continued from the previous page...

| Field      | Function                                                                                                                                                                                                                                                                                                   |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 18 ISD2FB  | Idle signal drive IOFB[2] flash memory B This field determines the logic level that the IOFB[2] output of the QuadSPImoduleis driven to in the inactive state. See Driving flash memory control signals in single and dual modes. 0b - IOFB[2] is driven to logic L.                                       |
| 17 ISD3FA  | Idle signal drive IOFA[3] flash memory A Determines the logic level that the IOFA[3] output of the QuadSPI module is driven to in the inactive state. See Driving flash memory control signals in single and dual modes for details. 0b - IOFA[3] is driven to logic L 1b - IOFA[3] is driven to logic H   |
| 16 ISD2FA  | Idle signal drive IOFA[2] flash memory A Determines the logic level that the IOFA[2] output of the QuadSPI module is driven to in the inactive state. See Driving flash memory control signals in single and dual modes for details. 0b - IOFA[2] is driven to logic L. 1b - IOFA[2] is driven to logic H. |
| 15 -       | Reserved                                                                                                                                                                                                                                                                                                   |
| 14 MDIS    | Module disable Allows the clock to the non-memory mapped logic in the QuadSPI to be stopped. 0b - Enable QuadSPI clocks 1b - Allow external logic to disable QuadSPI clocks                                                                                                                                |
| 13 -       | Reserved                                                                                                                                                                                                                                                                                                   |
| 12 DLPEN   | Data learning pattern enable Write 1 to this field to enable data learning mechanism.                                                                                                                                                                                                                      |
| 11 CLR_TXF | Clear TX FIFO/buffer This is a self-clearing field that invalidates the TX buffer content. Software must wait for at least five system cycles and three flash cycles after writing '1' to this field. NOTE                                                                                                 |

Table continues on the next page...

## Table continued from the previous page...

| Field        | Function                                                                                                                                                                                                                                                                                                     |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|              | 0b - No action 1b - Read and write pointers of the TX buffer are reset to 0 and TBSR[TRCTR] is reset to 0.                                                                                                                                                                                                   |
| 10 CLR_RXF   | Clear RX FIFO This is a self-clearing field that invalidates the RX buffer content. 0b - No action 1b - Read and write pointers of the RX buffer are reset to 0 and RBSR[RDBFL] is reset to 0.                                                                                                               |
| 9 -          | Reserved                                                                                                                                                                                                                                                                                                     |
| 8 -          | Reserved                                                                                                                                                                                                                                                                                                     |
| 7 DDR_EN     | DDR mode enable Enables the DDR mode 0b - 2x clock disabled for SDR instructions only 1b - 2x clock enabled for DDR instructions. Note: 2x clock - This is twice the SCKF clock used to shift the TX data by 90 degree.                                                                                      |
| 6 DQS_EN     | DQS enable Is valid for both the SDR and DDR modes. For details, see DQS sampling method. 0b - Reserved. Do not program 0 to this field. 1b - DQS enabled. The incoming data is sampled on both the edges of the DQS input when the value of MCR[DDR_EN] is 1; else, on only one edge when MCR[DDR_EN] is 0. |
| 5 DQS_LAT_EN | DQS latency enable Is valid whenlatency is included between read accesses from flash memoryin DQSsampling. Valid for flash devices like HyperFlash. 0b - DQS latency is disabled. 1b - DQS feature with latency included is enabled.                                                                         |
| 4 -          | Reserved                                                                                                                                                                                                                                                                                                     |
| 3-2 -        | Reserved                                                                                                                                                                                                                                                                                                     |
| 1 SWRSTHD    | Software reset for AHB domain 0b - De-assert Software reset                                                                                                                                                                                                                                                  |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           | 1b - AHBdomainflops are reset. This field does not reset configuration registers. It is advisable to reset both the serial flash memory domain and AHB domain at the same time. Resetting only one domain might lead to side effects. The software resets need the clock to be running to propagate to the design. The value of MCR[MDIS] should be 0 when the software reset bits are asserted. Also, before they can be deasserted again (by setting MCR[SWRSTHD] to 0), it is recommended to set the value of MCR[MDIS] to 1. After the software resets have been deasserted, the normal operation can be started by setting MCR[MDIS] to 0. NOTE Software must wait for at least three system cycles and three flash cycles after changing the value of this field. NOTE                                                                                                                                          |
| 0 SWRSTSD | Software reset for serial flash memory domain 0b - De-assert Software reset 1b - Serial flash memory domain flops are reset. This field does not reset configuration registers. It is advisable to reset both the serial flash memory domain and AHB domain at the same time. Resetting only one domain might lead to side effects. The software resets need the clock to be running to propagate to the design. The value of MCR[MDIS] should therefore be 0 when the software reset bits are asserted. Also, before they can be deasserted again (by specifying 0 as the value for MCR[SWRSTSD]), it is recommended to specify 1 as the value for MCR[MDIS]. After the software resets are deasserted, the normal operation can be started by specifying 0 as the value for MCR[MDIS]. NOTE Software must wait for at least three system cycles and three flash cycles after changing the value of this field. NOTE |

## 38.4.2.3 IP Configuration Register (IPCR)

## Offset

| Register   | Offset   |
|------------|----------|
| IPCR       | 8h       |

## Function

This register provides all the configuration required for an IP-initiated command, which can be triggered by writing in the SEQID field of this register. If the SEQID field is written successfully, a new command to the external serial flash memory is initiated per the sequence pointed to by this field. See Normal mode for details on command triggering and command execution.

Special write-access is permitted if:

- SR[IP\_ACC]=0

## Diagram

<!-- image -->

## Fields

| Field       | Function                                                                                                                                                                                                                                                                            |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -     | Reserved                                                                                                                                                                                                                                                                            |
| 27-24 SEQID | Points to a sequence in the LUT This field contains the sequence index of the LUT. See LUT for details. Each sequence index can accommodate up to 10 instructions (2 instructions per register). A write to this field triggers a transaction on the serial flash memory interface. |
| 23 -        | Reserved                                                                                                                                                                                                                                                                            |
| 22 -        | Reserved                                                                                                                                                                                                                                                                            |
| 21-17 -     | Reserved                                                                                                                                                                                                                                                                            |
| 16 PAR_EN   | If the value of this field is 1, a transaction to two serial flash memorydevices is triggered in the parallel mode. See Parallel flash memory mode for details.                                                                                                                     |
| 15-0 IDATSZ | IP data transfer size This field defines the data transfer size, in bytes, of the IP command.                                                                                                                                                                                       |

Quad Serial Peripheral Interface (QuadSPI)

## 38.4.2.4 Flash Memory Configuration Register (FLSHCR)

## Offset

| Register   | Offset   |
|------------|----------|
| FLSHCR     | Ch       |

## Function

This register contains the timings that are specific to the flash memory device. The QuadSPI controller must meet these timings for the device to function correctly.

Special write-access is permitted if:

- SR[AHB\_ACC] = 0
- SR[IP\_ACC] = 0

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      | TDH  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    |      |      |      |      |      |      |      | 0    |      |      |      |      |      |      |      |
| W      |      |      |      |      | TCSH |      |      |      |      |      |      |      | TCSS |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 1    | 1    | 0    | 0    | 0    | 0    | 0    | 0    | 1    | 1    |

## Fields

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-18 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 17-16 TDH | Serial flash memory data in hold time This field helps in meeting the data in hold time requirement of a flash memory. It is valid only in the DDR mode. This field should be set to 0x00 in the SDR mode (MCR[DDR_EN]=0). NOTE See Data input hold requirement of flash memory for details. The valid TDH programming options are shown below and the other combinations are invalid. 00b - Data aligned with the posedge of internal reference clock of QuadSPI 01b - Data aligned with 2x serial flash memory half clock |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-12 -   | Reserved                                                                                                                                                                                                                |
| 11-8 TCSH | Serial flash memory CS hold time This hold time is in terms of serial flash memory clock cycles, and it must be greater than or equal to two flash memory clock cycles . Refer the chip datasheet for the exact value.  |
| 7-4 -     | Reserved                                                                                                                                                                                                                |
| 3-0 TCSS  | Serial flash memory CS setup time This setup time is in terms of serial flash memory clock cycles, and it must be greater than or equal to two flash memory clock cycles. Refer the chip Datasheet for the exact value. |

## 38.4.2.5 Buffer 0 Configuration Register (BUF0CR)

## Offset

| Register   | Offset   |
|------------|----------|
| BUF0CR     | 10h      |

## Function

This register provides the configuration for any read access routed to buffer0, which happens when the master ID of the incoming AHB request matches BUF0CR[MSTRID]. Any buffer "miss" leads to a serial flash memory transaction being triggered per the sequence pointed to by BFGENCR[SEQID].

Special write-access is permitted if:

- SR[AHB\_ACC] = 0

## Diagram

<!-- image -->

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|-------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 30-16 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 15-8 ADATSZ | AHB data transfer size Defines the read data transfer size in 8 bytes of an AHB triggered read access to serial flash memory. For example, a value of 0x2 sets transfer size to 16 bytes. When ADATSZ = 0, the data size mentioned in the sequence pointed to by the SEQID field overrides this value. The software should ensure that this transfer size is not greater than the size of the buffer. If OTFADisenabled, the QuadSPI module prefetches only that much data from flash memory such that the prefetch never crosses the 1 KB boundary. |
| 7-6 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 5-0 MSTRID  | Master ID ID of the AHB master associated with BUFFER 0 Any AHB read access with this master ID is routed to this buffer. You must ensure that the master IDs associated with all buffers are different. See the chip-specific QuadSPI information for details about master IDs and their corresponding components. NOTE                                                                                                                                                                                                                             |

## 38.4.2.6 Buffer 1 Configuration Register (BUF1CR)

## Offset

| Register   | Offset   |
|------------|----------|
| BUF1CR     | 14h      |

## Function

This register provides the configuration for any access routed to buffer 1, which happens when the master ID of the incoming AHB request matches the MSTRID field of this register. Any buffer "miss" leads to the buffer being flushed and a serial flash memory transaction being triggered per the sequence pointed to by BFGENCR[SEQID].

Special write-access is permitted if:

- SR[AHB\_ACC] = 0

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

| Bits   | 31     | 30     | 29     | 28     | 27     | 26     | 25     | 24     | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
|--------|--------|--------|--------|--------|--------|--------|--------|--------|----------|----------|----------|----------|----------|----------|----------|----------|
| R      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| W      |        |        |        |        |        |        |        |        |          |          |          |          |          |          |          |          |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| Bits   | 15     | 14     | 13     | 12     | 11     | 10     | 9      | 8      | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R      |        |        |        |        |        |        |        |        | 0 MSTRID | 0 MSTRID | 0 MSTRID | 0 MSTRID | 0 MSTRID | 0 MSTRID | 0 MSTRID | 0 MSTRID |
| W      | ADATSZ | ADATSZ | ADATSZ | ADATSZ | ADATSZ | ADATSZ | ADATSZ | ADATSZ |          |          |          |          |          |          |          |          |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 1        |

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 15-8 ADATSZ | AHB data transfer size This field defines the read data transfer size in 8 bytes of an AHB triggered read access to serial flash memory. For example, a value of 0x2 sets the transfer size to 16 bytes. When ADATSZ = 0, the data size mentioned in the sequence pointed to by the SEQID field overrides this value. Software should ensure that this transfer size is not greater than the size of this buffer. If OTFAD is enabled, the QuadSPI module prefetches only the required data from the flash memory so that the prefetch never crosses the 1 KB boundary. |
| 7-6 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 5-0 MSTRID  | Master ID ID of the AHB master associated with BUFFER 1 Any AHB read access with this master ID is routed to this buffer. You must ensure that the master IDs associated with all buffers are different. See the chip-specific QuadSPI information for details about master IDs and their corresponding components. NOTE                                                                                                                                                                                                                                                |

## 38.4.2.7 Buffer 2 Configuration Register (BUF2CR)

## Offset

| Register   | Offset   |
|------------|----------|
| BUF2CR     | 18h      |

Quad Serial Peripheral Interface (QuadSPI)

## Function

This register provides the configuration for any access routed to buffer 2, which happens when the master ID of the incoming AHB request matches the MSTRID field of this register. Any buffer "miss" leads to the buffer being flushed and a serial flash memory transaction being triggered per the sequence pointed to by BFGENCR[SEQID].

Special write-access is permitted if:

- SR[AHB\_ACC] = 0

## Diagram

<!-- image -->

| Bits   | 31     | 30     | 29     | 28     | 27     | 26     | 25     | 24     | 23     | 22     | 21     | 20     | 19     | 18     | 17     | 16     |
|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| R      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| W      |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| Bits   | 15     | 14     | 13     | 12     | 11     | 10     | 9      | 8      | 7      | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
| R      |        |        |        |        |        |        |        |        | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| W      | ADATSZ | ADATSZ | ADATSZ | ADATSZ | ADATSZ | ADATSZ | ADATSZ | ADATSZ | MSTRID | MSTRID | MSTRID | MSTRID | MSTRID | MSTRID | MSTRID | MSTRID |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 1      | 0      |

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 15-8 ADATSZ | AHB data transfer size This field defines the read data transfer size in 8 bytes of an AHB triggered read access to the serial flash memory. For example, a value of 0x2 sets transfer size to 16 bytes. When ADATSZ = 0, the data size mentioned in the sequence pointed to by the SEQID field overrides this value. The software should ensure that this transfer size is not greater than the size of this buffer. If OTFAD is enabled, the QuadSPI module prefetches only the required data from the flash memory such that the prefetch never crosses the 1 KB boundary. |
| 7-6 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 5-0 MSTRID  | Master ID The ID of the AHB master associated with BUFFER2. Any AHB read access with this master ID is routed to this buffer. It must be ensured that the master IDs associated with all buffers are different. See the chip-specific QuadSPI information for details about master IDs and their corresponding components. NOTE                                                                                                                                                                                                                                               |

Quad Serial Peripheral Interface (QuadSPI)

## 38.4.2.8 Buffer 3 Configuration Register (BUF3CR)

## Offset

| Register   | Offset   |
|------------|----------|
| BUF3CR     | 1Ch      |

## Function

This register provides the configuration for any access to buffer 3.

An access is routed to buffer 3 when the master ID of the incoming AHB request matches the MSTRID field of BUF3CR. Any buffer "miss" leads to the buffer being flushed and a serial flash memory transaction being triggered per the sequence pointed to by BFGENCR[SEQID].

In case the value of the ALLMST field is not 1, any such transaction (where master ID does not match any of the MSTRID fields) is returned with an ERROR response.

Special write-access is permitted if:

- SR[AHB\_ACC] = 0

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                                                                                                                                                                                        |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 ALLMST | All master enable When set, buffer3 acts as an all-master buffer. Any AHB access with a master ID not matching with the master ID of buffer0, buffer1, or buffer2 is routed to buffer3. When set, the MSTRID field of this register is ignored. |
| 30-18 -   | Reserved                                                                                                                                                                                                                                        |
| 17-16 -   | Reserved                                                                                                                                                                                                                                        |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

Table continued from the previous page...

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                       |
|-------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15-8 ADATSZ | AHB data transfer size Defines the read data transfer size in 8 bytes of an AHBtriggered read access to serial flash memory.When ADATSZ = 0, the data size mentioned in the sequence pointed to by the SEQID field overrides this value. If OTFAD is enabled, the QuadSPI module prefetches only the required data from the flash memory so that the prefetch never crosses the 1 KB boundary. |
| 7-6 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                       |
| 5-0 MSTRID  | Master ID ID of the AHBmaster associated with BUFFER 3. Any AHBread access with this master ID is routed to this buffer. You must ensure that the master IDs associated with all buffers are different. See the chip-specific QuadSPI information for details about master IDs and their corresponding components. NOTE                                                                        |

## 38.4.2.9 Buffer Generic Configuration Register (BFGENCR)

## Offset

| Register   | Offset   |
|------------|----------|
| BFGENCR    | 20h      |

## Function

This register provides generic configuration to any of the buffer accesses. Any buffer "miss" leads to the buffer being flushed and a serial flash memory transaction being triggered per the sequence pointed to by the SEQID field. If the value of the PAR\_EN field is 1, all the buffer accesses result in parallel accesses to the flash memories.

Special write-access is permitted if:

- SR[AHB\_ACC] = 0

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|-------|-------|-------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0     | 0     | 0     |      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | PAR_ |
| W      |       |       |       |      |      |      |      |      |      |      |      |      |      |      |      | EN   |
| Reset  | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15    | 14    | 13    | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      |       |       |       |      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      | SEQID | SEQID | SEQID |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0     | 0     | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field       | Function                                                                                                                                                                                                                                                  |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 -     | Reserved                                                                                                                                                                                                                                                  |
| 27-18 -     | Reserved                                                                                                                                                                                                                                                  |
| 17 -        | Reserved                                                                                                                                                                                                                                                  |
| 16 PAR_EN   | Parallel mode enable If the value of this field is 1, a transaction to two serial flash memory devices is triggered in parallel mode. See Parallel flash memory mode for details.                                                                         |
| 15-12 SEQID | Points to a sequence in the LUT. This field contains the sequence index of the LUT... See LUT. If the sequence pointer differs in the new and the previous sequences, you should reset it. See sequence pointer clear register for more information. NOTE |
| 11-0 -      | Reserved                                                                                                                                                                                                                                                  |

## 38.4.2.10 Buffer 0 Top Index Register (BUF0IND)

## Offset

| Register   | Offset   |
|------------|----------|
| BUF0IND    | 30h      |

## Function

This register specifies the top index for buffer 0, which defines its size. Note that the three LSBs of this register are set to 0. This ensures that the buffer is 64-bit aligned because each buffer entry is 64-bits long.

The register value should be set to the desired number of bytes. For example, setting BUF0IND[31:3] to 0 gives 0 bytes, setting the value to 1 gives 8 bytes, and so on.

The size of buffer 0 is the difference between BUF0IND and 0.

The software must ensure that the value of TPINDX0 is not greater than the size of buffer 0.

Special write-access is permitted if:

- SR[AHB\_ACC] = 0

## Diagram

<!-- image -->

| Bits   | 31        | 30        | 29        | 28        | 27        | 26        | 25        | 24        | 23        | 22        | 21        | 20        | 19        | 18   | 17   | 16   |
|--------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|------|------|------|
| R      | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | 0    | 0    |
| W      |           |           |           |           |           |           |           |           |           |           |           |           |           |      |      |      |
| Reset  | 0         | 0         | 0         | 0 0       |           | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | 0    | 0    |
| Bits   | 15        | 14        | 13        | 12        | 11        | 10        | 9         | 8         | 7         | 6         | 5         | 4         | 3         | 2    | 1    | 0    |
| R      | 0 TPINDX0 | 0 TPINDX0 | 0 TPINDX0 | 0 TPINDX0 | 0 TPINDX0 | 0 TPINDX0 | 0 TPINDX0 | 0 TPINDX0 | 0 TPINDX0 | 0 TPINDX0 | 0 TPINDX0 | 0 TPINDX0 | 0 TPINDX0 | 0    | 0    | 0    |
| W      |           |           |           |           |           |           |           |           |           |           |           |           |           |      |      |      |
| Reset  | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | 0    | 0    |

## Fields

| Field        | Function              |
|--------------|-----------------------|
| 31-11 -      | Reserved              |
| 10-3 TPINDX0 | Top index of buffer 0 |
| 2-0 -        | Reserved              |

## 38.4.2.11 Buffer 1 Top Index Register (BUF1IND)

## Offset

| Register   | Offset   |
|------------|----------|
| BUF1IND    | 34h      |

## Function

This register specifies the top index of buffer 1, which defines its size. Note that the three LSBs of this register are set to 0. This ensures that the buffer is 64-bit aligned because each buffer entry is 64-bits long.

The size of buffer 1 is the difference between BUF1IND and BUF0IND. The register value should be entered in bytes. For example, if BUF0IND = 0x100, then setting BUF1IND = 0x130 sets the size of buffer 1 to 0x30 bytes.

The software must ensure that the value of TPINDX1 is not greater than the size of buffer 1.

Special write-access is permitted if:

- SR[AHB\_ACC] = 0

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

| Bits   | 31        | 30        | 29        | 28        | 27        | 26        | 25        | 24        | 23        | 22        | 21        | 20        | 19        | 18   | 17   | 16   |
|--------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|------|------|------|
| R      | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | 0    | 0    |
| W      |           |           |           |           |           |           |           |           |           |           |           |           |           |      |      |      |
| Reset  | 0         | 0         | 0         | 0 0       |           | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | 0    | 0    |
| Bits   | 15        | 14        | 13        | 12        | 11        | 10        | 9         | 8         | 7         | 6         | 5         | 4         | 3         | 2    | 1    | 0    |
| R      | 0 TPINDX1 | 0 TPINDX1 | 0 TPINDX1 | 0 TPINDX1 | 0 TPINDX1 | 0 TPINDX1 | 0 TPINDX1 | 0 TPINDX1 | 0 TPINDX1 | 0 TPINDX1 | 0 TPINDX1 | 0 TPINDX1 | 0 TPINDX1 | 0    | 0    | 0    |
| W      |           |           |           |           |           |           |           |           |           |           |           |           |           |      |      |      |
| Reset  | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | 0    | 0    |

## Fields

| Field        | Function              |
|--------------|-----------------------|
| 31-11 -      | Reserved              |
| 10-3 TPINDX1 | Top index of buffer 1 |
| 2-0 -        | Reserved              |

## 38.4.2.12 Buffer 2 Top Index Register (BUF2IND)

## Offset

| Register   | Offset   |
|------------|----------|
| BUF2IND    | 38h      |

## Function

This register specifies the top index of buffer 2, which defines its size. Note that the three LSBs of this register are set to 0. This ensures that the buffer is 64-bit aligned because each buffer entry is 64-bits long.

The size of buffer 2 is the difference between BUF2IND and BUF1IND. The register value should be entered in bytes. For example, if BUF1IND = 0x130 then setting BUF2IND = 0x180 sets the size of buffer 2 to 0x50 bytes.

The software must ensure that the value of TPINDX2 is not greater than the size of buffer 2.

Special write-access is permitted if:

- SR[AHB\_ACC] = 0

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

| Bits   | 31        | 30        | 29        | 28        | 27        | 26        | 25        | 24        | 23        | 22        | 21        | 20        | 19        | 18   | 17   | 16   |
|--------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|------|------|------|
| R      | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | 0    | 0    |
| W      |           |           |           |           |           |           |           |           |           |           |           |           |           |      |      |      |
| Reset  | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | 0    | 0    |
| Bits   | 15        | 14        | 13        | 12        | 11        | 10        | 9         | 8         | 7         | 6         | 5         | 4         | 3         | 2    | 1    | 0    |
| R      | 0 TPINDX2 | 0 TPINDX2 | 0 TPINDX2 | 0 TPINDX2 | 0 TPINDX2 | 0 TPINDX2 | 0 TPINDX2 | 0 TPINDX2 | 0 TPINDX2 | 0 TPINDX2 | 0 TPINDX2 | 0 TPINDX2 | 0 TPINDX2 | 0    | 0    | 0    |
| W      |           |           |           |           |           |           |           |           |           |           |           |           |           |      |      |      |
| Reset  | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | 0    | 0    |

## Fields

| Field        | Function              |
|--------------|-----------------------|
| 31-11 -      | Reserved              |
| 10-3 TPINDX2 | Top index of buffer 2 |
| 2-0 -        | Reserved              |

## 38.4.2.13 AHB Write Configuration Register (AWRCR)

## Offset

| Register   | Offset   |
|------------|----------|
| AWRCR      | 50h      |

## Function

Special write-access is permitted if:

- SR[AWRACC] = 0

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

| Bits   | 31          | 30          | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18       | 17   | 16   |
|--------|-------------|-------------|------|------|------|------|------|------|------|------|------|------|------|----------|------|------|
| R      | 0           | 0           | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0        | 0    | 0    |
| W      |             |             |      |      |      |      |      |      |      |      |      |      |      |          |      |      |
| Reset  | 0           | 0           | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0        | 0    | 0    |
| Bits   | 15          | 14          | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2        | 1    | 0    |
| R W    | PPW_ WR_... | PPW_ RD_... | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |      | AWTRGLVL |      |      |
| Reset  | 0           | 0           | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0        | 0    | 0    |

## Fields

| Field         | Function                                                                                                                                                                                                                                                                                                   |
|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -       | Reserved                                                                                                                                                                                                                                                                                                   |
| 15 PPW_WR_DIS | Page program wait write disabled 0b - Enables subsequent writes 1b - Disables subsequent writes to the flash memory. After the first write transaction, AHB write is returned with an error response.                                                                                                      |
| 14 PPW_RD_DIS | Page program wait read disabled 0b - Enables subsequent reads 1b - Disables subsequent reads to the flash memory. After the first write transaction, AHB read is returned with an error response.                                                                                                          |
| 13-4 -        | Reserved                                                                                                                                                                                                                                                                                                   |
| 3-0 AWTRGLVL  | AHB write trigger level Defines a trigger level of TXFIFOin terms of a 4-byte entry. AHBwrite to the flash memoryis triggeredwhen either of the following happens: • TX FIFO crosses the level defined by this field • AHB transaction completes This is done to prevent an under run in the flash memory. |

Quad Serial Peripheral Interface (QuadSPI)

## 38.4.2.14 DLL Flash Memory A Configuration Register (DLLCRA)

## Offset

| Register   | Offset   |
|------------|----------|
| DLLCRA     | 60h      |

## Function

This register configures DLL and slave delay chain for flash memory A.

The value of the DLLEN field must be 1 after all reference (FREQEN, DLL\_REFCNTR, DLLRES, SLAVE\_AUTO\_UPDT) delay chain configurations are programmed.

See DLL and delay chain usage for the programming sequence.

<!-- image -->

| Bits                                  | 31                                    | 30                                    | 29                                    | 28                                    | 27                                    | 26                                    | 25                                    | 24                                    | 23                                    | 22                                    | 21                                    | 20                                    | 19                                    | 18                                    | 17                                    | 16                                    |
|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|---------------------------------------|
| R W                                   | DLLEN                                 | FREQ EN                               | FREQ EN                               | 0                                     | DLL_REFCNTR                           | DLL_REFCNTR                           | DLL_REFCNTR                           | DLL_REFCNTR                           | DLLRES                                | DLLRES                                | DLLRES                                |                                       |                                       |                                       | SLV_FINE_OFFSET                       |                                       |
| Reset                                 | 0                                     | 0                                     | 0 0                                   |                                       | 0                                     | 0                                     | 0                                     | 1                                     | 0                                     | 0                                     | 1                                     | 0                                     | 0                                     | 0                                     | 0                                     | 0                                     |
| Bits                                  | 15                                    | 14                                    | 13                                    | 12                                    | 11                                    | 10                                    | 9                                     | 8                                     | 7                                     | 6                                     | 5                                     | 4                                     | 3                                     | 2                                     | 1                                     | 0                                     |
| R W                                   | Reserv ed                             | SLV_DLY_OFFSET                        | SLV_DLY_OFFSET                        | SLV_DLY_OFFSET                        | SLV_DLY_COARSE                        | SLV_DLY_COARSE                        | SLV_DLY_COARSE                        | SLV_DLY_COARSE                        |                                       | Reserved                              |                                       | 0                                     | SLAVE _A...                           | SLV_ EN                               | SLV_D LL...                           | SLV_ UPD                              |
| Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 | Reset 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 |

## Fields

| Field     | Function                                                                                                                                                                                                                               |
|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 DLLEN  | DLL enable 0b - DLL reference logic remains in reset and should be 0 for at least three flash memory clock cycles for reset. 1b - Enables DLL logic. Set it to 1 after all the configuration for DLLCR reference settings is complete. |
| 30 FREQEN | Frequency enable 0b - Selects delay chain for low frequency of operation 1b - Selects delay chain for high frequency of operation                                                                                                      |

Table continues on the next page...

## Table continued from the previous page...

| Field                  | Function                                                                                                                                                                                                                                                                    |
|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 29-28 -                | Reserved                                                                                                                                                                                                                                                                    |
| 27-24 DLL_REFCNTR      | DLL reference counter Select the "n+1" interval of DLL phase detection and reference delay updating interval (minimum recommended value = 1).                                                                                                                               |
| 23-20 DLLRES           | DLL resolution Minimum resolution for DLL phase detector to remain locked/unlocked based on flash memory clock jitter. The minimum value is 2, and should be programmed to a more suitable value, such as 6.                                                                |
| 19-16 SLV_FINE_OFF SET | Fine offset delay elements in incoming DQS This field sets the number of fine offset delay elements up to 16 in incoming DQS, and the default must be 1 element.                                                                                                            |
| 15 -                   | Reserved                                                                                                                                                                                                                                                                    |
| 14-12 SLV_DLY_OFF SET  | T/16 offset delay elements in incoming DQS This field sets the number of T/16 offset delay elements in incoming DQS; default is 0.                                                                                                                                          |
| 11-8 SLV_DLY_COA RSE   | Delay elements in each delay tap This field sets the number of delay elements in each delay tap. The field is used to overwrite DLL- generated delay values and works when the value of SLV_DLL_BYPASS is 1. Note : Please refer to the QuadSPI datasheet for more details. |
| 7-5 -                  | Reserved                                                                                                                                                                                                                                                                    |
| 4 -                    | Reserved                                                                                                                                                                                                                                                                    |
| 3 SLAVE_AUTO_ UPDT     | Slave chain update This field automatically updates the slave chain as soon as DLL is locked. 0b - Auto-update feature is disabled. 1b - Auto-update feature is enabled.                                                                                                    |
| 2 SLV_EN               | Slave enable 0b - DLL slave logic remains in reset, and its value should be 0 for at least three flash memory clock cycles for reset. 1b - Enables DQS slave delay chain, and should be 1 before any slave configuration settings take place.                               |

Table continues on the next page...

## Diagram

<!-- image -->

| Bits   | 31        | 30   | 29   | 28   | 27             | 26             | 25             | 24             | 23                      | 22                      | 21                      | 20     | 19          | 18              | 17              | 16              |
|--------|-----------|------|------|------|----------------|----------------|----------------|----------------|-------------------------|-------------------------|-------------------------|--------|-------------|-----------------|-----------------|-----------------|
| R W    | DLLEN     | FREQ | 0    | 0    | EN             | EN             | DLL_REFCNTR    | EN             |                         | DLLRES                  | DLLRES                  | DLLRES |             | SLV_FINE_OFFSET | SLV_FINE_OFFSET | SLV_FINE_OFFSET |
| Reset  | 0         | 0    | 0    | 0    | 0              | 0              | 0              | 1              | 0                       | 0                       | 1                       | 0      | 0           | 0               | 0               | 0               |
| Bits   | 15        | 14   | 13   | 12   | 11             | 10             | 9              | 8              | 7                       | 6                       | 5                       | 4      | 3           | 2               | 1               | 0               |
| R W    | Reserv ed |      |      |      | SLV_DLY_OFFSET | SLV_DLY_OFFSET | SLV_DLY_OFFSET | SLV_DLY_OFFSET | SLV_DLY_COARSE Reserved | SLV_DLY_COARSE Reserved | SLV_DLY_COARSE Reserved | 0      | SLAVE _A... | SLV_ EN         | SLV_D LL...     | SLV_ UPD        |
| Reset  | 0         | 0    | 0    | 0    | 0              | 0              | 0              | 0              | 0                       | 0                       | 0                       | 0      | 0           | 0               | 0               | 0               |

## Table continued from the previous page...

| Field             | Function                                                                                                                                                                                                                                                                                                 |
|-------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 SLV_DLL_BYP ASS | Slave DLL bypass This field enables selection of the number of delays in each slave delay tap. 0b - Disables manual selection of coarse delays in the slave delay chain. 1b - Enables selection of number of delays in each slave delay tap, based on DLLCRA[SLV_DLY_COARSE].                            |
| 0 SLV_UPD         | Slave update You must program this field only after slave delay chain configuration takes place. 0b - Disables any further update on DQS slave delay chain. 1b - Updates the DQS slave delay chain with either ref-delay or bypass slave delay value, and should be set in the absence of the DQS clock. |

## 38.4.2.15 DLL Flash Memory B Configuration Register (DLLCRB)

## Offset

| Register   | Offset   |
|------------|----------|
| DLLCRB     | 64h      |

## Function

This register configures DLL and slave delay chain for flash memory B.

DLLEN must be set after all reference (FREQEN, DLL\_REFCNTR, DLLRES, SLAVE\_AUTO\_UPDT) delay chain configurations are programmed.

See DLL and delay chain usage for the programming sequence.

## NOTE

See the chip data sheet for programming the register fields.

## Fields

| Field                  | Function                                                                                                                                                                                                         |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 DLLEN               | DLL enable 0b - DLL reference logic remains in reset, keep in "0" for at least 3 flash memory clock cycles for reset. 1b - Enables DLL logic. Set it to "1" after all configuration of DLLCR reference settings. |
| 30 FREQEN              | Frequency enable 0b - Selects delay chain for low frequency of operation 1b - Selects delay chain for high frequency of operation                                                                                |
| 29-28 -                | Reserved                                                                                                                                                                                                         |
| 27-24 DLL_REFCNTR      | DLL reference counter Select the "n+1" interval of DLL phase detection and reference delay updating interval (minimum recommended value is 1).                                                                   |
| 23-20 DLLRES           | DLL resolution Minimumresolution for DLLphasedetector to remain locked or unlocked based on flash memoryclock jitter. Minimum value is 2, and you should program it to a more some suitable value, such as 6.    |
| 19-16 SLV_FINE_OFF SET | Number of delay elements in each delay tap This field sets the number of fine offset delay elements up to 16 in incoming DQS; default should be '1' element.                                                     |
| 15 -                   | Reserved                                                                                                                                                                                                         |
| 14-12 SLV_DLY_OFF SET  | Number of delay elements in each delay tap This field sets the number of T/16 offset delay elements in incoming DQS; the default is 0.                                                                           |
| 11-8 SLV_DLY_COA RSE   | Number of delay elements in each delay tap This field sets the number of delay elements in each delay tap. The field is used to overwrite the DLL generated delay values and works when SLV_DLL_BYPASS = 1.      |
| 7-5 -                  | Reserved                                                                                                                                                                                                         |
| 4 -                    | Reserved                                                                                                                                                                                                         |
| 3                      | Update slave chain This field automatically updates the slave chain as soon as DLL is locked.                                                                                                                    |

Table continues on the next page...

## Table continued from the previous page...

| Field             | Function                                                                                                                                                                                                                                                                           |
|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| SLAVE_AUTO_ UPDT  | 0b - Auto-update feature is disabled. 1b - Auto-update feature is enabled.                                                                                                                                                                                                         |
| 2 SLV_EN          | Slave enable 0b - DLL slave logic remains in reset. Keep it "0" for at least three flash memory clock cycles for reset. 1b - Enables DQS slave delay chain. Set to "1" before any slave configuration settings                                                                     |
| 1 SLV_DLL_BYP ASS | Slave DLL Bypass This field enables selection of the number of delay in each slave delay tap. 0b - Disables manual selection of coarse delays in slave delay chain. 1b - Enables selection of number of delay in each slave delay tap based on DLLCRB[SLV_DLY_COARSE]              |
| 0 SLV_UPD         | Slave update Program this field only after slave delay chain configuration. 0b - Disables any further update on DQS slave delay chain. 1b - Updates DQS slave delay chain with either the ref-delay or bypass slave delay value. The field should be set when there is no DQS clk. |

## 38.4.2.16 Parity Configuration Register (PARITYCR)

## Offset

| Register   | Offset   |
|------------|----------|
| PARITYCR   | 6Ch      |

## Function

This register replicates the parity related configuration programming performed on the flash memory configuration registers.

You must write 1 to PARITYCR[CRCEN\_FA] and PARITYCR[CRCEN\_FB] after all parity configuration bits are programmed. However, you can program PARITYCR[BYTE\_SIZE\_FA] and PARITYCR[BYTE\_SIZE\_FB] at any time.

## Diagram

<!-- image -->

| Bits   | 31          | 30          | 29          | 28           | 27          | 26          | 25   | 24          | 23        | 22          | 21          |   20 |   19 |   18 |   17 |   16 |
|--------|-------------|-------------|-------------|--------------|-------------|-------------|------|-------------|-----------|-------------|-------------|------|------|------|------|------|
| R W    | CRC_ WND... |             |             | CHUNKSIZE_FB |             |             |      | BYTE_ SI... | CRCE N_FB | CRCB EN_... | CRCBI N_... |    0 |    0 |    0 |    0 |    0 |
| Reset  | 0           | 0           | 0 0         |              | 0           | 0           | 0    | 0           | 0         | 0           | 0           |    0 |    0 |    0 |    0 |    0 |
| Bits   | 15          | 14          | 13          | 12           | 11          | 10          | 9    | 8           | 7         | 6           | 5           |    4 |    3 |    2 |    1 |    0 |
| R W    |             | CRC_ WND... | CRC_ WND... | CHUNKSIZE_FA | CRC_ WND... | CRC_ WND... |      | BYTE_ SI... | CRCE N_FA | CRCB EN_... | CRCBI N_... |    0 |    0 |    0 |    0 |    0 |
| Reset  | 0           | 0           | 0           | 0            | 0           | 0           | 0    | 0           | 0         | 0           | 0           |    0 |    0 |    0 |    0 |    0 |

## Fields

| Field               | Function                                                                                                                                                                                                                                                                                                                                                                          |
|---------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 CRC_WNDW_F B     | CRC address window configuration 0b - Calculates parity (CRC) over fixed address window within the denoted flash memory B chunk size boundary. 1b - Calculates parity (CRC) over incremental window of flash memory B chunk size irrespective of address.                                                                                                                         |
| 30-25 CHUNKSIZE_F B | Chunk size for flash memory B Defines the chunk size (in terms of 4 Bytes) after parity should be inserted and compared by the QuadSPI controller for flash memory B. Values 0x1, 0x2, .... implies 4 bytes, 8 bytes ... so on.                                                                                                                                                   |
| 24 BYTE_SIZE_FB     | Byte size for flash memory B It can be programmed anytime. Enables single byte read/write parity with FlashB configuration register. This field overrides chink-size used for Flash data array. You must write 1 to this field before any read/write operation on the flash memory internal registers. And you must write 0 to this field before reading flash memory data array. |
| 23 CRCEN_FB         | CRC parity checker logic 0b - Disables parity mechanism. In case of parity error, set to "0" to clear parity error. Only supported for DDR octal commands. 1b - Enables CRC parity checker logic for flash memory B read paths. Set this field after programming CHUNK_SIZEB, CRCBEN_FB and CRCBIN_FB.                                                                            |
| 22 CRCBEN_FB        | Adds CRC bar parity from flash memory B output to QuadSPI controller.                                                                                                                                                                                                                                                                                                             |
| 21 CRCBIN_FB        | Adds CRC bar parity to flash memory B input from QuadSPI controller                                                                                                                                                                                                                                                                                                               |
| 20-16 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                          |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

## Table continued from the previous page...

| Field              | Function                                                                                                                                                                                                                                                                                                                                                                                                         |
|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 CRC_WNDW_F A    | CRC address window configuration 0b - Calculates parity (CRC) over fixed address window within the denoted flash memory A chunk size boundary. 1b - Calculates parity (CRC) over incremental window of flash memory A chunk size, irrespective of address.                                                                                                                                                       |
| 14-9 CHUNKSIZE_F A | Chunk size for flash memory A Defines the chunk size (in terms of 4 bytes) after parity is inserted and compared by the QuadSPI controller for flash memory A. Values 0x1, 0x2, and so on indicate 4 bytes, 8 bytes, and so on.                                                                                                                                                                                  |
| 8 BYTE_SIZE_FA     | Byte size for flash memory A This field can be programmed any time. It enables single-byte, read/write parity with flash memory A configuration register. The field overrides the chunk size used for flash memory data array. You must write 1 to this field before any read/write operation on the flash memory internal registers. And you must write 0 to this field before reading flash memory data array. |
| 7 CRCEN_FA         | CRC parity checker logic 0b - Disables parity mechanism. In case of parity error, set it to 0 to clear parity error. Only supported for DDR Octal commands. 1b - CRC parity checker logic for flash memory A read paths. Configure this field after programming CHUNK_SIZEA, CRCBEN_FA and CRCBIN_FA.                                                                                                            |
| 6 CRCBEN_FA        | Adds CRC bar parity from flash memory A output to QuadSPI controller                                                                                                                                                                                                                                                                                                                                             |
| 5 CRCBIN_FA        | Adds CRC bar parity to flash memory A input from QuadSPI controller                                                                                                                                                                                                                                                                                                                                              |
| 4-0 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                         |

## 38.4.2.17 Serial Flash Memory Address Register (SFAR)

## Offset

| Register   | Offset   |
|------------|----------|
| SFAR       | 100h     |

## Function

The module automatically translates this address on the memory map to the address on the flash memory. When operating in a 24-bit mode, only bits 23-0 are sent to the flash memory. In the 32-bit mode, bits 27-0 are used with bits 31-28 driven to 0 when the value of SFACR[CAS] is 0. For example, if the value of SFACR[CAS] is 3, then bits 26-3 are sent to the flash memory as its page address in case flash memory is operating in a 24-bit mode. The total number of address bits requested by the flash memory, as

Quad Serial Peripheral Interface (QuadSPI)

its page and column address, must not be more than 32 bits. See Table 215 for the mapping between the access mode and the SFAR content and Normal mode for details on command triggering and command execution. The software must ensure that the serial flash memory address provided in the SFAR register lies in the valid flash memory address range, as defined in Table 215. Special write-access is permitted if:

- SR[IP\_ACC] = 0

## Diagram

<!-- image -->

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24    | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|---------|------|------|------|------|------|------|------|-------|------|------|------|------|------|------|------|------|
| R       |      |      |      |      |      |      |      | SFADR |      |      |      |      |      |      |      |      |
| Reset   | 0    | 0    | 0    | 0 0  |      | 0    | 0    | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8     | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R       |      |      |      |      |      |      |      | SFADR |      |      |      |      |      |      |      |      |
| W Reset | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                    |
|---------|-----------------------------|
| 31-0    | Serial flash memory address |
| SFADR   |                             |

## 38.4.2.18 Serial Flash Memory Address Configuration Register (SFACR)

## Offset

| Register   | Offset   |
|------------|----------|
| SFACR      | 104h     |

## Function

This register contains the address requirements that are specific to serial flash memory. These requirements must be configured according to the connected flash memory, for the controller to function properly. The module automatically translates the address of SFAR on the memory map or the incoming address on the AHB bus to the column address on the flash memory. For example, if a flash memory needs 3 bits as its column address, then only the lower three bits of the SFAR/AHB address are sent to the flash memory as its column address. The software should ensure that the serial flash memory address provided in SFAR or the incoming AHB address lies in the valid flash memory address range.

Special write-access is permitted if:

- SR[IP\_ACC] = 0
- SR[AHB\_ACC] = 0

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29     | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17          | 16   |
|--------|------|------|--------|------|------|------|------|------|------|------|------|------|------|------|-------------|------|
| R      | 0    |      |        |      |      |      |      |      |      |      |      | 0    | 0    |      | BYTE_ SW... | WA   |
| W      |      |      |        |      |      |      |      |      |      |      |      |      |      |      |             |      |
| Reset  | 0    | 0    | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0           | 0    |
| Bits   | 15   | 14   | 13     | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1           | 0    |
| R      | 0    |      | Reserv |      |      |      |      |      |      | 0    |      |      |      |      |             |      |
| W      |      |      | ed     | PPWB |      |      |      |      |      |      |      |      |      |      | CAS         |      |
| Reset  | 0    | 0    | 0      | 0    | 1    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0           | 0    |

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                    |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-21 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                    |
| 20 -         | Reserved                                                                                                                                                                                                                                                                                                                                                                    |
| 19-18 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                    |
| 17 BYTE_SWAP | Byte swapping In case of Octal DDR mode, this field controls whether a word unit composed of 2 bytes from posedge and negedge of a single DQS cycle needs to be swapped. 0b - One word of two bytes at [nth, n+1th] address 1b - One word of two bytes at [n+1th, nth] address                                                                                              |
| 16 WA        | Word addressable Defines whether the serial flash memory is a byte addressable flash memory or a word addressable flash memory. According to the configuration of this field, the address is remapped to the flash memory interface. See Address scheme for details. 0b - Byte addressable serial flash memory mode 1b - Word (2-byte) addressable serial flash memory mode |
| 15-14 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                    |
| 13 -         | Reserved                                                                                                                                                                                                                                                                                                                                                                    |
| 12-8         | Page program boundary                                                                                                                                                                                                                                                                                                                                                       |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                           |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PPWB    | Flash memory-specific page program boundary size should be programmed in Log2 (size in bytes) format. The default is 8 = log2(256) for a 256-byte page program size.                                                                               |
| 7-4     | Reserved                                                                                                                                                                                                                                           |
| 3-0     | Column address space                                                                                                                                                                                                                               |
| CAS     | Defines the width of the column address. If the column address is, for example, [2:0] of SFAR/AHBaddress, then CAS must be 3. If there is no column address separation in any serial flash memory, the value of this field must be specified as 0. |

## 38.4.2.19 Sampling Register (SMPR)

## Offset

| Register   | Offset   |
|------------|----------|
| SMPR       | 108h     |

## Function

This register allows configuration of how the incoming data from the external serial flash memory devices is sampled in the QuadSPI module.

<!-- image -->

Special write-access is permitted in the disabled mode.

## Diagram

<!-- image -->

| Bits   | 31        | 30        | 29        | 28        | 27        | 26        | 25        | 24        | 23   | 22    | 21   | 20   | 19   | 18       | 17       | 16       |
|--------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|------|-------|------|------|------|----------|----------|----------|
| R W    | Reserv ed | DLLFSMPFB | DLLFSMPFB | DLLFSMPFB | Reserv ed | DLLFSMPFA | DLLFSMPFA | DLLFSMPFA | 0    | 0     | 0    | 0    | 0    | Reserved | Reserved | Reserved |
| Reset  | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | 0     | 0    | 0    | 0    | 0        | 0        | 0        |
| Bits   | 15        | 14        | 13        | 12        | 11        | 10        | 9         | 8         | 7    | 6     | 5    | 4    | 3    | 2        | 1        | 0        |
| R      | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | FSDLY | FSPH | 0    | 0    | 0        | 0        | 0        |
| W      |           |           |           |           |           |           |           |           |      | FSDLY | S    |      |      |          |          |          |
| Reset  | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0         | 0    | 0     | 0    | 0    | 0    | 0        | 0        | 0        |

Quad Serial Peripheral Interface (QuadSPI)

## Fields

| Field           | Function                                                                                                                                                                                                           |
|-----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 -            | Reserved                                                                                                                                                                                                           |
| 30-28 DLLFSMPFB | Selects the nth tap provided by slave delay chain for flash memory B The value of n can vary from 0 to 7, with each tap delay based on the DLLCRB register.                                                        |
| 27 -            | Reserved                                                                                                                                                                                                           |
| 26-24 DLLFSMPFA | Selects the nth tap provided by slave delay chain for flash memory A The value of n can vary from 0 to 7, with each tap delay based on the DLLCRA register.                                                        |
| 23-19 -         | Reserved                                                                                                                                                                                                           |
| 18-16 -         | Reserved                                                                                                                                                                                                           |
| 15-7 -          | Reserved                                                                                                                                                                                                           |
| 6 FSDLY         | Full-speed delay selection for internal/pad loop back DQS sampling This field selects the delay in accordance with the reference edge for the valid sample point. 0b - Same DQS 1b - Half-cycle early DQS          |
| 5 FSPHS         | Full-speed phase selection for SDR instructions This field selects the edge of the sampling clock valid for full-speed commands. 0b - Select sampling at non-inverted clock 1b - Select sampling at inverted clock |
| 4-3 -           | Reserved                                                                                                                                                                                                           |
| 2-0 -           | Reserved                                                                                                                                                                                                           |

## 38.4.2.20 RX Buffer Status Register (RBSR)

## Offset

| Register   | Offset   |
|------------|----------|
| RBSR       | 10Ch     |

## Function

This register contains information related to the receive data buffer.

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28    | 27    | 26    | 25    | 24    | 23    | 22    | 21    | 20    | 19    | 18    | 17    | 16    |
|--------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| R      | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR | RDCTR |
| W      |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     |
| Bits   | 15    | 14    | 13    | 12    | 11    | 10    | 9     | 8     | 7     | 6     | 5     | 4     | 3     | 2     | 1     | 0     |
| R      | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | RDBFL | RDBFL | RDBFL | RDBFL | RDBFL | RDBFL | RDBFL | RDBFL |
| W      |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     |

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 RDCTR | Read counter Indicates the number of 4-byte entries removed from the RX buffer. For example, a value of 0x2 indicates that 8 bytes have been removed. It is incremented by the number (RBCT[WMRK] + 1) on RXbuffer POPevent. The RXbuffer can be popped using DMA or FR[RBDF]. The RSER[RBDDE] defines which pop should be pursued. For details, see AHB RXDataBuffer Register (ARDB0-ARDB127)andDataTransferfromtheQuadSPIModuleInternal Buffers. |
| 15-8 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 7-0 RDBFL   | RX buffer fill level Indicates the number of 4-byte entries available in the RX buffer. For example, a value of 0x2 indicates 8 bytes are available.                                                                                                                                                                                                                                                                                               |

Quad Serial Peripheral Interface (QuadSPI)

## 38.4.2.21 RX Buffer Control Register (RBCT)

## Offset

| Register   | Offset   |
|------------|----------|
| RBCT       | 110h     |

## Function

This register contains control data related to the receive data buffer.

Special write-access is permitted if:

- SR[IP\_ACC] = 0

## Diagram

<!-- image -->

## Fields

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-9 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 8 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 7 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 6-0 WMRK | RX buffer watermark This field determines whenthe readout action of the RXbuffer is triggered. Whenthenumberof valid entries in the RX buffer is equal to or greater than the number provided by (WMRK+1), the SR[RXWE] flag is asserted. The value should be entered as the number of 4-byte entries minus 1. For example, a value of 0x0 sets the watermark to 4 bytes, 1 to 8bytes, 2 to 12 bytes, and so on. For details, see DMA usage. |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

Table continued from the previous page...

| Field   | Function                                                                                                                                                                           |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | This field should never be programmed above 63 because there are only 64 memory mapped RBDR registers. If watermark is programmed above 63, data above 64 words will be lost. NOTE |

## 38.4.2.22 AHB Write Status Register (AWRSR)

## Offset

| Register   | Offset   |
|------------|----------|
| AWRSR      | 120h     |

## Function

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28    | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18          | 17   | 16   |
|--------|------|------|------|-------|------|------|------|------|------|------|------|------|------|-------------|------|------|
| R      | 0    | 0    | 0    | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0           | 0    | 0    |
| W      |      |      |      |       |      |      |      |      |      |      |      |      |      |             |      |      |
| Reset  | 0    | 0    | 0    | 0 0   |      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0           | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12 11 |      | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2           | 1    | 0    |
| R      |      |      |      |       |      |      | 0    |      |      |      |      |      |      | SEQA UJO... | 0    | 0    |
| W      |      |      |      |       |      |      |      |      |      |      |      |      |      |             |      |      |
| Reset  | 0    | 0    | 0    | 0 0   |      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0           | 0    | 0    |

## Fields

| Field       | Function                                                                                                                                                                                    |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-3        | Reserved                                                                                                                                                                                    |
| 2 SEQAUJOIN | Sequence auto join Asserted when the LUT sequences are automatically joined using the JMP_TO_SEQ command. This remains asserted as long as you do not encounter the STOP/JMP_ON_CS command. |
| 1 -         | Reserved                                                                                                                                                                                    |

Table continues on the next page...

Table continued from the previous page...

|   Field | Function   |
|---------|------------|
|       0 | Reserved   |

## 38.4.2.23 DLL Status Register (DLLSR)

## Offset

| Register   | Offset   |
|------------|----------|
| DLLSR      | 12Ch     |

## Function

## Diagram

| Bits   | 31          | 30          | 29          | 28          | 27   | 26   | 25   | 24   | 23                | 22                | 21                | 20                | 19                  | 18                  | 17                  | 16                  |
|--------|-------------|-------------|-------------|-------------|------|------|------|------|-------------------|-------------------|-------------------|-------------------|---------------------|---------------------|---------------------|---------------------|
| R      | DLLB_ LO... | SLVB_ LO... | DLLB_ RA... | DLLB_ FI... | 0    | 0    | 0    | 0    | DLLB_SLV_FINE_VAL | DLLB_SLV_FINE_VAL | DLLB_SLV_FINE_VAL | DLLB_SLV_FINE_VAL | DLLB_SLV_COARSE_VAL | DLLB_SLV_COARSE_VAL | DLLB_SLV_COARSE_VAL | DLLB_SLV_COARSE_VAL |
| W      |             |             |             |             |      |      |      |      |                   |                   |                   |                   |                     |                     |                     |                     |
| Reset  | 1           | 0           | 0           | 0           | 0    | 0    | 0    | 0    | 0                 | 0                 | 0                 | 0                 | 0                   | 0                   | 0                   | 0                   |
| Bits   | 15          | 14          | 13          | 12          | 11   | 10   | 9    | 8    | 7                 | 6                 | 5                 | 4                 | 3                   | 2                   | 1                   | 0                   |
| R      | DLLA_ LO... | SLVA_ LO... | DLLA_ RA... | DLLA_ FI... | 0    | 0    | 0    | 0    | DLLA_SLV_FINE_VAL | DLLA_SLV_FINE_VAL | DLLA_SLV_FINE_VAL | DLLA_SLV_FINE_VAL | DLLA_SLV_COARSE_VAL | DLLA_SLV_COARSE_VAL | DLLA_SLV_COARSE_VAL | DLLA_SLV_COARSE_VAL |
| W      |             |             |             |             |      |      |      |      |                   |                   |                   |                   |                     |                     |                     |                     |
| Reset  | 1           | 0           | 0           | 0           | 0    | 0    | 0    | 0    | 0                 | 0                 | 0                 | 0                 | 0                   | 0                   | 0                   | 0                   |

## Fields

| Field           | Function                                                                                                                                                                            |
|-----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31              | DLL B lock status                                                                                                                                                                   |
| DLLB_LOCK       |                                                                                                                                                                                     |
| 30              | High frequency slave delay chain locked                                                                                                                                             |
| SLVB_LOCK       | Sets when slave decoder is updated with DLLCRB[SLV_UPD] It gets reset after user programs SLV_UPD=0 after observing This field along with Lock status (in case of non-bypass) mode. |
| 29              | DLL master delay chain                                                                                                                                                              |
| DLLB_RANGE_ ERR | "1" indicates that DLL master delay chain is working out of delay range due to incorrect DLL configuration.                                                                         |

Table continues on the next page...

## Table continued from the previous page...

| Field                      | Function                                                                                                                                                                                      |
|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 28 DLLB_FINE_UN DERFLOW    | Fine delay chain underflow "1" indicates fine delay chain underflow has occurred.                                                                                                             |
| 27-24 -                    | Reserved                                                                                                                                                                                      |
| 23-20 DLLB_SLV_FIN E_VAL   | Fine delay cells in slave delay chain This value indicates total no of fine delay cells (1 delay unit) selected in slave delay chain.                                                         |
| 19-16 DLLB_SLV_CO ARSE_VAL | Coarse delay cells This value indicates total no of coarse delay cells (16 delay unit) selected in slave delay chain.                                                                         |
| 15 DLLA_LOCK               | DLL A lock status                                                                                                                                                                             |
| 14 SLVA_LOCK               | Slave high lock status High-frequency slave delay chain locked. The field is configured when the slave decoder is updated with DLLCRA[SLV_UPD] and is reset after you configure SLV_UPD to 0. |
| 13 DLLA_RANGE_ ERR         | DLL master delay chain The value 1 indicates that DLL master delay chain is working out of delay range because of incorrect DLL configuration.                                                |
| 12 DLLA_FINE_UN DERFLOW    | Fine delay chain underflow The value 1 indicates that fine delay chain underflow has occurred.                                                                                                |
| 11-8 -                     | Reserved                                                                                                                                                                                      |
| 7-4 DLLA_SLV_FIN E_VAL     | Fine delay cells in slave delay chain This value indicates the total number of fine delay cells (1 delay unit) selected in the slave delay chain.                                             |
| 3-0 DLLA_SLV_CO ARSE_VAL   | Coarse delay cells in slave delay chain This value indicates the total number of coarse delay cells (16 delay units) selected in the slave delay chain.                                       |

## 38.4.2.24 Data Learning Configuration Register (DLCR)

## Offset

| Register   | Offset   |
|------------|----------|
| DLCR       | 130h     |

## Function

This register is used for programming the data learning settings.

- A flash memory device that supports data learning but cannot provide more than 10 bits of data learn pattern must be considered as non-DLP Flash. For Non-DLP flash devices, you must read at least 16 bits data learn pattern from a known location.
- You must program different learning pattern on the two data pins-IO1 and IO3. This is required to accommodate pessimistic data skew between the different IO lines.

## Diagram

<!-- image -->

## Fields

| Field            | Function                                                                                                                                                                                                                                                                                                                                                                              |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-30 DLP_SEL_FB | Selects a pattern matching IO pads Special write-access is permitted in the disabled mode. 00b - Pattern matching is ignored. This is only for debugging purpose and should not be programmed. 01b - IO1 is used for matching. 10b - IO3 is used for matching. This is only for debugging purpose and should not be programmed. 11b - Both IO1 and IO3 are used for pattern matching. |
| 29-26 -          | Reserved                                                                                                                                                                                                                                                                                                                                                                              |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

## Table continued from the previous page...

| Field              | Function                                                                                                                                                                                                                                                                                                                  |
|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 25 -               | Reserved                                                                                                                                                                                                                                                                                                                  |
| 24 DL_NONDLP_F LSH | Data learning enabled for non-DLP flash memory Configure the value of this field as 1 to enable data learning for flash memories that do not provide a data learning pattern. For a non-DLP flash memory, execute a one-time data learning through the IPS to select a tap before an AHB read operation.                  |
| 23-16 -            | Reserved                                                                                                                                                                                                                                                                                                                  |
| 15-14 DLP_SEL_FA   | Selects pattern matching IO pads 00b - Pattern matching is ignored. This is only for debugging purpose and should not be programmed. 01b - IO1 is used for matching 10b - IO3 is used for matching. This is only for debugging purpose and should not be programmed. 11b - Both IO1 and IO3 are used for pattern matching |
| 13-8 -             | Reserved                                                                                                                                                                                                                                                                                                                  |
| 7-0 -              | Reserved                                                                                                                                                                                                                                                                                                                  |

## 38.4.2.25 Data Learning Status Flash Memory A Register (DLSR\_FA)

## Offset

| Register   | Offset   |
|------------|----------|
| DLSR_FA    | 134h     |

## Function

This register shows sampling point selected by data learning algorithm when the value of DLSR\_FA[DLPFFA] is 0. Otherwise, it shows the pattern matching outline.

## Diagram

<!-- image -->

## Fields

| Field         | Function                                                                                  |
|---------------|-------------------------------------------------------------------------------------------|
| 31 DLPFFA     | Data learning pattern fail This field asserts when data learning fails at flash memory A. |
| 30-16 -       | Reserved                                                                                  |
| 15-8 POS_EDGE | DLP positive edge match signature for flash memory A                                      |
| 7-0 NEG_EDGE  | DLP negative edge match signature for flash memory A                                      |

## 38.4.2.26 Data Learning Status Flash Memory B Register (DLSR\_FB)

## Offset

| Register   | Offset   |
|------------|----------|
| DLSR_FB    | 138h     |

## Function

This register shows sampling point selected by data learning algorithm when DLSR\_FB[DLPFFB] is '0'. Otherwise, it shows the pattern matching outline.

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

## Fields

| Field         | Function                                                                                 |
|---------------|------------------------------------------------------------------------------------------|
| 31 DLPFFB     | Data learning pattern fail This field asserts when data learning fails at flash memory B |
| 30-16 -       | Reserved                                                                                 |
| 15-8 POS_EDGE | DLP pos edge match signature for flash memory B                                          |
| 7-0 NEG_EDGE  | DLP neg edge match signature for flash memory B                                          |

## 38.4.2.27 TX Buffer Status Register (TBSR)

## Offset

| Register   | Offset   |
|------------|----------|
| TBSR       | 150h     |

## Function

This register contains information related to the transmit data buffer.

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28    | 27    | 26    | 25    | 24    | 23    | 22    | 21    | 20    | 19    | 18    | 17    | 16    |
|--------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| R      | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR | TRCTR |
| W      |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     |
| Bits   | 15    | 14    | 13    | 12    | 11    | 10    | 9     | 8     | 7     | 6     | 5     | 4     | 3     | 2     | 1     | 0     |
| R      | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL | TRBFL |
| W      |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     |

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                    |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 TRCTR | Transmit counter This field indicates how many entries of 4 bytes have been written into the TX buffer by host accesses. It is reset to 0 when a 1 is written to MCR[CLR_TXF]. It is incremented on each write access to the TBDR register when another word has been pushed onto the TX buffer. When it is not cleared, the TRCTR field wraps around to 0. See TX Buffer Data Register (TBDR) for details. |
| 15-9 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                    |
| 8-0 TRBFL   | TX buffer fill level This field contains the number of entries of 4 bytes each available in the TX buffer for the QuadSPI module to transmit to the serial flash memory device. The value of this field can reach maximum up to the total TX buffer size.                                                                                                                                                   |

## 38.4.2.28 TX Buffer Data Register (TBDR)

## Offset

| Register   | Offset   |
|------------|----------|
| TBDR       | 154h     |

## Function

This register provides access to the circular TX buffer of depth 256, so the total size is 256 * 4 bytes. This buffer provides the data written into it as write data for the page programming commands to the serial flash memory device. See Table 223 for the byte ordering scheme. A write transaction on the flash memory with data size of less than 32 bits leads to the removal of one data entry from the TX buffer. The valid bits are used and the rest of the bits are discarded.

Special write-access is permitted if:

- SR[TXFULL] = 0

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

Quad Serial Peripheral Interface (QuadSPI)

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24     | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|--------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      | TXDATA |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8      | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    |      |      |      |      |      |      |      | TXDATA |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | TX data                                                                                                                                                                                        |
| TXDATA  | On write access, the data is written to the next available entry of the TX buffer and TBSR[TRBFL] is updated accordingly. On a read access, the last data written to the register is returned. |

## 38.4.2.29 TX Buffer Control Register (TBCT)

## Offset

| Register   | Offset   |
|------------|----------|
| TBCT       | 158h     |

## Function

This register contains control information for transmit data buffer.

## Diagram

<!-- image -->

| Bits   | 31     | 30     | 29     | 28     | 27     | 26     | 25     | 24     | 23     | 22     | 21     | 20     | 19     | 18     | 17     | 16     |
|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| R      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| W      |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| Bits   | 15     | 14     | 13     | 12     | 11     | 10     | 9      | 8      | 7      | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
| R      | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK | 0 WMRK |
| W      |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |

## Fields

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                |
|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-8 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                |
| 7-0 WMRK | Watermark for TX buffer Determines the watermark for the TX buffer When the number of available space in the TX buffer is greater than or equal to the number provided by WMRK(number of 4-byte entries), SR[TXWA] is asserted. For example, a value of 0x1 sets the watermark to 4 bytes, 0x2 sets it to 8 bytes, 0x3 sets it to 12 bytes, and so on. For details, see DMA usage. WMRK = 0 is invalid. |

## 38.4.2.30 Status Register (SR)

## Offset

| Register   | Offset   |
|------------|----------|
| SR         | 15Ch     |

## Function

This register provides all the available status information about SFM command execution and arbitration, the RX buffer, TX buffer, and the AHB buffer.

## Diagram

<!-- image -->

| Bits   | 31   | 30       | 29       | 28       | 27       | 26      | 25      | 24      | 23      | 22      | 21        | 20      | 19        | 18       | 17      | 16   |
|--------|------|----------|----------|----------|----------|---------|---------|---------|---------|---------|-----------|---------|-----------|----------|---------|------|
| R      |      | 0        | 0        | TXFUL L  | TXDM A   |         | TXWA    | TXNE    | RXDM A  |         | 0         |         | RXFU LL   | 0        |         | RXWE |
| W      |      |          |          |          |          |         |         |         |         |         |           |         |           |          |         |      |
| Reset  | 0    | 0        | 0        | 0        | 0        | 0       | 1       | 0       | 0       | 0       | 0         | 0       | 0         | 0        | 0       | 0    |
| Bits   | 15   | 14       | 13       | 12       | 11       | 10      | 9       | 8       | 7       | 6       | 5         | 4       | 3         | 2        | 1       | 0    |
| R      | 0    | AHB3 FUL | AHB2 FUL | AHB1 FUL | AHB0 FUL | AHB3 NE | AHB2 NE | AHB1 NE | AHB0 NE | AHBT RN | Reserv ed | AWRA CC | Reserv ed | AHB_ ACC | IP_ ACC | BUSY |
| W      |      |          |          |          |          |         |         |         |         |         |           |         |           |          |         |      |
| Reset  | 0    | 0        | 1        | 1        | 1        | 0       | 0       | 0       | 0       | 0       | 0         | 0       | 0         | 0        | 0       | 0    |

## Fields

| Field   | Function   |
|---------|------------|
| 31-29   | Reserved   |

Table continues on the next page...

## Table continued from the previous page...

| Field      | Function                                                                                                                                                                                                                                                       |
|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -          |                                                                                                                                                                                                                                                                |
| 28 -       | Reserved                                                                                                                                                                                                                                                       |
| 27 TXFULL  | TX buffer full Asserted when the FIFO level reaches 263 (that is, TX buffer size of 256 + async FIFO size of 7)                                                                                                                                                |
| 26 TXDMA   | TX DMA Asserted when the TXFIFO fill via DMA is active and DMA is requested or running                                                                                                                                                                         |
| 25 TXWA    | TX buffer watermark available Asserted when the number of available spaces in the TXbuffer is greater than or equal to the value provided by TBCT[WMRK] Example: When TBCT[WMRK]=1, SR[TXWA] is de-asserted when TX FIFO has 256+7(size of async FIFO) entries |
| 24 TXNE    | TX buffer not empty Asserted when TX buffer contains data                                                                                                                                                                                                      |
| 23 RXDMA   | RX buffer DMA Asserted when RX buffer read out via DMA is active; that is, when DMA is requested or running                                                                                                                                                    |
| 22-20 -    | Reserved                                                                                                                                                                                                                                                       |
| 19 RXFULL  | RX buffer full Asserted when the RX buffer is full; that is, when RBSR[RDBFL] is equal to 128                                                                                                                                                                  |
| 18-17 -    | Reserved                                                                                                                                                                                                                                                       |
| 16 RXWE    | RX buffer watermark exceeded Asserted when the number of valid entries in the RX buffer exceeds the number provided in RBCT[WMRK]                                                                                                                              |
| 15 -       | Reserved                                                                                                                                                                                                                                                       |
| 14 AHB3FUL | AHB 3 buffer full Asserted when AHB 3 buffer is full                                                                                                                                                                                                           |
| 13 AHB2FUL | AHB 2 buffer full Asserted when AHB 2 buffer is full                                                                                                                                                                                                           |

Table continues on the next page...

## Table continued from the previous page...

| Field      | Function                                                                                                                        |
|------------|---------------------------------------------------------------------------------------------------------------------------------|
| 12 AHB1FUL | AHB 1 buffer full Asserted when the AHB 1 buffer is full                                                                        |
| 11 AHB0FUL | AHB 0 buffer full Asserted when the AHB 0 buffer is full                                                                        |
| 10 AHB3NE  | AHB 3 buffer not empty Asserted when the AHB 3 buffer contains data                                                             |
| 9 AHB2NE   | AHB 2 buffer not empty Asserted when the AHB 2 buffer contains data                                                             |
| 8 AHB1NE   | AHB 1 buffer not empty Asserted when the AHB 1 buffer contains data                                                             |
| 7 AHB0NE   | AHB 0 buffer not empty Asserted when the AHB 0 buffer contains data                                                             |
| 6 AHBTRN   | AHB access transaction pending Asserted when there is a pending request on the AHB interface. See Flash memory mapped AMBA bus. |
| 5 -        | Reserved                                                                                                                        |
| 4 AWRACC   | AHB write access Asserted when AHB write access is enabled                                                                      |
| 3 -        | Reserved                                                                                                                        |
| 2 AHB_ACC  | AHB read access Asserted when the currently executed transaction is initiated by the AHB bus                                    |
| 1 IP_ACC   | IP access Asserted when transaction currently executed is initiated by the IP bus                                               |
| 0 BUSY     | Module busy Asserted when module is currently busy handling a transaction to an external flash memory device                    |

## 38.4.2.31 Flag Register (FR)

## Offset

| Register   | Offset   |
|------------|----------|
| FR         | 160h     |

## Function

This register provides all available flags about SFM command execution and arbitration, which may serve as the source for the generation of interrupt service requests. Note that the error flags in this register do not relate directly to the execution of the transaction in the serial flash memory device itself but only to the behavior and conditions visible in the QuadSPI module.

Special write-access is permitted in the enabled mode.

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29        | 28       | 27   | 26      | 25      | 24        | 23     | 22    | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|-------|-------|-----------|----------|------|---------|---------|-----------|--------|-------|------|------|------|------|------|------|
| R      | DLPFF | 0     | Reserv ed | DLLAB RT | TBFF | TBUF    | 0       | DLLU NLCK | ILLINE |       | 0    | 0    | 0    |      | RBOF | RBDF |
| W      | W1C   |       |           | W1C      | W1C  | W1C     |         | W1C       | W1C    |       |      |      |      |      | W1C  | W1C  |
| Reset  | 0     | 0     | 0         | 0        | 1    | 0       | 0       | 0         | 0      | 0     | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15    | 14    | 13        | 12       | 11   | 10      | 9       | 8         | 7      | 6     | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | AAEF  | AITEF | AIBSE F   | ABOF     | IUEF | CRCA EF | CRCB EF | PPWF      | IPAEF  | IPIEF | 0    | 0    |      | 0    |      | TFF  |
| W      | W1C   | W1C   | W1C       | W1C      | W1C  | W1C     | W1C     | W1C       | W1C    | W1C   |      |      |      |      |      | W1C  |
| Reset  | 0     | 0     | 0         | 0        | 0    | 0       | 0       | 0         | 0      | 0     | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field      | Function                                                                                                                                                                         |
|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 DLPFF   | Data learning pattern failure flag This field is set when the DATA_LEARN instruction is encountered in a sequence, but no sampling point is found for the data learning pattern. |
| 30 -       | Reserved                                                                                                                                                                         |
| 29 -       | Reserved                                                                                                                                                                         |
| 28 DLLABRT | DLL abort 1b - This field is set whenever DLL is unlocked while reading data from the flash memory.                                                                              |
| 27         | TX buffer fill flag                                                                                                                                                              |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

## Table continued from the previous page...

| Field       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TBFF        | Before writing to the TX buffer, this field should be cleared. Then, it should be read back. If it is set, the TX buffer can include more data. If the field remains cleared, the TX buffer can be considered as full. See TX buffer operation for details.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 26 TBUF     | TX buffer underrun flag This field is set if the module tries to pull data when the TX buffer is empty. The IP command leading to the TX buffer underrun is continued (data sent to the serial flash memory device is undefined ). Here, a valid underrun means that it should have occurred during the transaction so that few bytes (that is, less than 4 bytes) are left in FIFO and the remaining are filled with "FFFFh". The software should initiate a TX transaction only when 128 bits are written in the TX buffer. This field does not set if transfer is less than 128 bits. The application must clear the TXbuffer in response to this event by writing a 1 to MCR[CLR_TXF]. The application must clear the TX buffer in response to this event by writing a 1 to MCR[CLR_TXF]. |
| 25 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 24 DLLUNLCK | DLL unlock 1b - This field is set whenever DLL unlock event occurs, irrespective of flash memory access.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 23 ILLINE   | Illegal instruction error flag This field is set when an illegal instruction is encountered by the controller in any of the sequences. As soon as the field is set, you must assert MCR[SWRSTSD] and MCR[SWRSTHD]. That is, reset the flash memory and AHB domain after reconfiguring the correct sequence instruction. See Table 221 for a list of legal instructions.                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 22-21 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 20 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 19-18 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 17 RBOF     | RX buffer overflow flag This field is set when no more data can be pushed into the RX buffer from the serial flash memory device. The IP command leading to this condition is continued until the number of bytes in IPCR[IDATSZ] are read from the serial flash memory device. The content of the RX buffer remains unchanged.                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 16 RBDF     | RX buffer drain flag This field is set if SR[RXWE] is asserted. Writing 1 to this field triggers one of the following actions:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           | • If the RX buffer has up to RBCT[WMRK] valid entries, then the flag is cleared. • If the RX buffer has more than RBCT[WMRK] valid entries and the RSER[RBDDE] field is not set (flag driven mode), an RX buffer POP event is triggered. The flag remains set if the RXbuffer contains more than RBCT[WMRK]valid entries after the RXbufferPOP event is complete. The flag is cleared if the RX buffer contains less than or equal to RBCT[WMRK] valid entries after the RX buffer POP event is complete. See the "Receive Buffer Drain Interrupt or DMA Request" section in Normal mode interrupt and DMA requests for details.         |
| 15 AAEF   | AHB abort error flag This flag can be set when AHB transaction in ongoing and any of the below conditions occur which may result in AHB error response (HRESP) generation: • When Software abort is asserted from SPTRCLT[ABRT_CLR] during AHB read. • During data learning pattern failure if any AHB transaction is ongoing. (FR[DLPFF]) • CRC or ECC error from flash memory during AHB transaction. (FR[CRCAEF],FR[CRCBEF]) • If AIBSEF flag is set during the AHB transfer. (FR[AIBSEF]) Software should clear this flag and other related flags in FR register (mentioned in points above) before initiating any new AHB transfer. |
| 14 AITEF  | AHB illegal transaction error flag This is set whenever there is no response generated from QuadSPI to AHB bus in case of an illegal transaction and the watchdog timer expires. The timer value is considered as a parameter.                                                                                                                                                                                                                                                                                                                                                                                                           |
| 13 AIBSEF | AHB illegal burst size error flag This is set whenever the total burst size (size x beat) of an AHB transaction is greater than the prefetch data size, which is defined by BUFxCR[ADATSZ] or data size mentioned in the sequence pointed to by the SEQID field in case ADATSZ = 0. See HBURST support with AHB read details on HBURST feature.                                                                                                                                                                                                                                                                                          |
| 12 ABOF   | AHB buffer overflow flag This is set when the size of the AHB access exceeds the size of the AHB buffer. This condition can occur only if BUFxCR[ADATSZ] is programmed incorrectly. The AHB command leading to this condition is continued until the number of entries according to BUFxCR[ADATSZ] have been read from the serial flash memory device. The content of the AHB buffer is not changed.                                                                                                                                                                                                                                     |
| 11 IUEF   | IP command usage error flag This is set when in parallel flash memory mode, the execution of an IP command is started with more than one pad enabled and the sequence pointed to by the sequence ID contains a WRITE or a WRITE_v2 command. See Table 221 for the related commands.                                                                                                                                                                                                                                                                                                                                                      |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                     |
|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           | Communication with the serial flash memory device is terminated before the execution of WRITE/ WRITE_v2 command by the QuadSPI module.                                                                                                                                                                                                                                       |
| 10 CRCAEF | Sets when there is CRC or ECC error for flash memory A 0b - CRCEF interrupt is not generated. 1b - CRCEF interrupt is generated.                                                                                                                                                                                                                                             |
| 9 CRCBEF  | Sets when there is CRC or ECC error for flash memory B 0b - CRCEF interrupt is not generated. 1b - CRCEF interrupt is generated.                                                                                                                                                                                                                                             |
| 8 PPWF    | Page-program wait flag after flash memory write flag This field indicates page-program wait flag after flash memory write.                                                                                                                                                                                                                                                   |
| 7 IPAEF   | IP command trigger during AHB access error flag This is set when the following condition occurs: • A write access occurs to IPCR[SEQID] and the SR[AHB_ACC] field is set. Any command leading to the assertion of the IPAEF field is ignored.                                                                                                                                |
| 6 IPIEF   | IP command trigger could not be executed error flag This is set when the SR[IP_ACC] and SR[AWRACC] fields are set (that is, an IP triggered command is currently executing) and any of the following conditions occurs: • Write access to the IPCR. Any command leading to the assertion of the IPIEF flag is ignored. • Write access to the SFAR • Write access to the RBCT |
| 5 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                     |
| 4 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                     |
| 3-1 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                     |
| 0 TFF     | IP command transaction finished flag This field is set after the QuadSPI module completes a running IP command. If an error occurs, and the related error flags are valid in the same clock cycle, the TFF flag is asserted.                                                                                                                                                 |

## 38.4.2.32 Interrupt and DMA Request Select and Enable Register (RSER)

## Offset

| Register   | Offset   |
|------------|----------|
| RSER       | 164h     |

## Function

This register provides enables and selectors for the interrupts in the QuadSPI module.

## NOTE

Each field of the FR enabled as source for an interrupt prevents the QuadSPI module from entering the Stop mode or Module Disable mode when this flag is set.

Special write-access is permitted in the "Anytime" mode.

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                                                                                               |
|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 DLPFIE | Data learning pattern failure interrupt enable Triggered by DLPFF flag in FR. 0b - No DLPFF interrupt is generated. 1b - DLPFF interrupt is generated. |
| 30-29 -   | Reserved                                                                                                                                               |
| 28 -      | Reserved                                                                                                                                               |
| 27        | TX buffer fill interrupt enable flag This field indicates the TX buffer fill interrupt enable flag.                                                    |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

## Table continued from the previous page...

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TBFIE      | 0b - No TBFF interrupt is generated. 1b - TBFF interrupt is generated.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 26 TBUIE   | TX buffer underrun interrupt enable flag This field indicates the TX buffer underrun interrupt enable flag. 0b - No TBUF interrupt is generated 1b - TBUF interrupt is generated                                                                                                                                                                                                                                                                                                                                                                  |
| 25 TBFDE   | TX buffer fill DMA enable Enables generation of DMA requests for TX buffer fill. When the value of this field is 1, DMA requests are generated as long as number of available spaces in the TX buffer is greater than or equal to the value provided by TBCT[WMRK]. After you write 1 to this field (to enable DMA transfers), writing 0 does not disable DMA transfers. You must perform a software reset for the AHB domain by using MCR[SWRSTHD] to disable DMA transfers. NOTE 0b - No DMA request is generated 1b - DMA request is generated |
| 24 DLLULIE | DLL unlock interrupt enable 1b - Write 1 to this to enable generation of interrupt on DLL unlock event.                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 23 ILLINIE | Illegal instruction error interrupt enable Triggered by the ILLINE flag in FR 0b - No ILLINE interrupt is generated. 1b - ILLINE interrupt is generated.                                                                                                                                                                                                                                                                                                                                                                                          |
| 22 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 21 RBDDE   | RX buffer drain DMA enable This field enables generation of DMArequests for RXbuffer drain. Whenthe value of this field is 1,theDMA requests are generated as long as SR[RXWE] is set. After you write 1 to this field (to enable DMA transfers), writing 0 does not disable DMA transfers. You must perform a software reset for the AHB domain by using MCR[SWRSTHD] to disable DMA transfers. NOTE 0b - No DMA request is generated. 1b - DMA request is generated.                                                                            |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                            |
|-----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 20 -      | Reserved                                                                                                                                                                                                                                                            |
| 19-18 -   | Reserved                                                                                                                                                                                                                                                            |
| 17 RBOIE  | RX buffer overflow interrupt enable This field indicates the RX buffer overflow interrupt enable flag. 0b - No RBOF interrupt is generated. 1b - RBOF interrupt is generated.                                                                                       |
| 16 RBDIE  | RX buffer drain interrupt enable This field enables generation of IRQ requests for RX buffer drain. When the value of this field is 1, the interrupt is asserted as long as SR[RBDF] is set. 0b - No RBDF interrupt is generated. 1b - RBDF Interrupt is generated. |
| 15 AAIE   | AHB abort error interrupt enable Triggered by AAEF flags in FR. 0b - No AAEF interrupt is generated 1b - AAEF interrupt is generated                                                                                                                                |
| 14 AITIE  | AHB illegal transaction interrupt enable flag This field indicates the AHB illegal transaction interrupt enable flag. 0b - No AITEF interrupt is generated. 1b - AITEF interrupt is generated.                                                                      |
| 13 AIBSIE | AHB illegal burst size interrupt enable flag This field indicates the AHB illegal burst size interrupt enable flag. 0b - No AIBSEF interrupt is generated. 1b - AIBSEF interrupt is generated.                                                                      |
| 12 ABOIE  | AHB buffer overflow interrupt enable flag This field indicates the AHB buffer overflow interrupt enable flag. 0b - No ABOF interrupt is generated. 1b - ABOF interrupt is generated.                                                                                |
| 11 IUEIE  | IP command usage error interrupt enable flag This field indicates the IP command usage error interrupt enable flag.                                                                                                                                                 |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                 |
|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           | 0b - No IUEF interrupt is generated 1b - IUEF interrupt is generated                                                                                                                                                                     |
| 10 CRCAIE | CRC and ECC interrupt enable for flash memory A 0b - CRCAEF interrupt is not generated. 1b - CRCAEF interrupt is generated.                                                                                                              |
| 9 CRCBIE  | Sets when there is CRC or ECC error for flash memory B 0b - CRCBEF interrupt is not generated. 1b - CRCBEF interrupt is generated.                                                                                                       |
| 8 PPWIE   | Page-program wait interrupt flag This field indicates page-program wait interrupt. 0b - No PPWIE interrupt is generated 1b - PPWIE interrupt is generated                                                                                |
| 7 IPAEIE  | IP command trigger during AHB read access error interrupt enable flag This field indicates IP command trigger during AHB read access error interrupt enable flag. 0b - No IPAEF interrupt is generated 1b - IPAEF interrupt is generated |
| 6 IPIEIE  | IP command trigger during IP access error interrupt enable flag This field indicates IP command trigger during IP access error interrupt enable flag. 0b - No IPIEF interrupt is generated 1b - IPIEF interrupt is generated             |
| 5 -       | Reserved                                                                                                                                                                                                                                 |
| 4 -       | Reserved                                                                                                                                                                                                                                 |
| 3-1 -     | Reserved                                                                                                                                                                                                                                 |
| 0 TFIE    | Transaction finished interrupt enable flag This field indicates the transaction finished interrupt enable flag. 0b - No TFF interrupt is generated. 1b - TFF interrupt is generated.                                                     |

## 38.4.2.33 Sequence Pointer Clear Register (SPTRCLR)

## Offset

| Register   | Offset   |
|------------|----------|
| SPTRCLR    | 16Ch     |

## Function

This register provides fields to reset the IP and buffer sequence pointers. The sequence pointer contains the index of instructions within the LUT entry that is to be executed next. For example, if the LUT entry ends on a JMP\_ON\_CS value of 2, the index is stored as 2.

The software should reset the sequence pointers defined by JMP\_ON\_CS operand whenever the sequence ID is required to be changed by updating the SEQID field in the IPCR or BFGENCR.

## Diagram

<!-- image -->

## Fields

| Field   | Function         |
|---------|------------------|
| 31-26 - | Reserved         |
| 25-24 - | Reserved         |
| 23-20 - | Reserved         |
| 19-18 - | Reserved         |
| 17      | Prefetch disable |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

## Table continued from the previous page...

| Field         | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PREFETCH_DI S | This field should be configured to disable the prefetch mechanism of receiver. It is not based on dynamic programming. Therefore, it should be programmed initially at once. When this field is set, then during an ongoing flash memory read, any subsequent AHB read is checked for buffer hit. However, after the end of flash memory read, as soon as chip select is deasserted, any subsequent AHB read results in flushing of the current AHBbuffer data and issues fresh flash memory transaction if the AHBbuffer data is not updated with the flash memory. |
| 16 ABRT_CLR   | Flash memory Abort/AHB buffer clear This is a dynamic field. Writing a 1 to it, irrespective of the prefetch disable, clears the AHB buffer pointers and also aborts any ongoing flash memory transaction (if any) and rejects any ongoing AHB read with an error response (if any). QuadSPI sets this field to 0 after clearing the AHB buffer pointers.                                                                                                                                                                                                            |
| 15-9 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 8 IPPTRC      | IP pointer clear This is a self-clearing field. 1b - Clears the sequence pointer for IP accesses as defined in IPCR.                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 7-1 -         | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 0 BFPTRC      | Buffer pointer clear This is a self-clearing field. 1b - Clears the sequence pointer for AHB read accesses as defined in BFGENCR.                                                                                                                                                                                                                                                                                                                                                                                                                                    |

## 38.4.2.34 Serial Flash Memory A1 Top Address Register (SFA1AD)

## Offset

| Register   | Offset   |
|------------|----------|
| SFA1AD     | 180h     |

## Function

This register provides the address mapping for serial flash memory A1. The difference between SFA1AD[TPADA1] and AMBA\_BASE defines the size of the memory map for serial flash memory A1.

Special write-access is permitted if:

- SR[IP\_ACC] = 0
- SR[AHB\_ACC] = 0

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                    |
|---------|-------------------------------------------------------------|
| 31-10   | Top address for serial flash memory A1                      |
| TPADA1  | In effect, TPADxx is the first location of the next memory. |
| 9-0     | Reserved                                                    |

## 38.4.2.35 Serial Flash Memory A2 Top Address Register (SFA2AD)

## Offset

| Register   | Offset   |
|------------|----------|
| SFA2AD     | 184h     |

## Function

This register provides the address mapping for serial flash memory A2. The difference between SFA2AD[TPADA2] and SFA1AD[TPADA1] defines the size of the memory map for serial flash memory A2.

Special write-access is permitted if:

- SR[IP\_ACC] = 0
- SR[AHB\_ACC] = 0

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                    |
|---------|-------------------------------------------------------------|
| 31-10   | Top address for serial flash memory A2                      |
| TPADA2  | In effect, TPxxAD is the first location of the next memory. |
| 9-0     | Reserved                                                    |

## 38.4.2.36 Serial Flash Memory B1 Top Address Register (SFB1AD)

## Offset

| Register   | Offset   |
|------------|----------|
| SFB1AD     | 188h     |

## Function

This register provides the address mapping for serial flash memory B1. The difference between SFB1AD[TPADB1] and SFA2AD[TPADA2] defines the size of the memory map for serial flash memory B1.

Special write-access is permitted if:

- SR[IP\_ACC] = 0
- SR[AHB\_ACC] = 0

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                    |
|---------|-------------------------------------------------------------|
| 31-10   | Top address for serial flash memory B1.                     |
| TPADB1  | In effect, TPxxAD is the first location of the next memory. |
| 9-0     | Reserved                                                    |

## 38.4.2.37 Serial Flash Memory B2 Top Address Register (SFB2AD)

## Offset

| Register   | Offset   |
|------------|----------|
| SFB2AD     | 18Ch     |

## Function

This register provides the address mapping for serial flash memory B2. The difference between SFB2AD[TPADB2] and SFB1AD[TPADB1] defines the size of the memory map for serial flash memory B2.

Special write-access is permitted if:

- SR[IP\_ACC] = 0
- SR[AHB\_ACC] = 0

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

| Bits   | 31     | 30     | 29     | 28     | 27     | 26     | 25     | 24     | 23     | 22     | 21     | 20     | 19     | 18     | 17     | 16     |
|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| R      |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |
| W      | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| Bits   | 15     | 14     | 13     | 12     | 11     | 10     | 9      | 8      | 7      | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
| R      |        |        |        |        |        |        | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| W      | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 | TPADB2 |        |        |        |        |        |        |        |        |        |        |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |

## Fields

| Field   | Function                                                    |
|---------|-------------------------------------------------------------|
| 31-10   | Top address for serial flash memory B2.                     |
| TPADB2  | In effect, TPxxAD is the first location of the next memory. |
| 9-0     | Reserved                                                    |

## 38.4.2.38 Data Learn Pattern Register (DLPR)

## Offset

| Register   | Offset   |
|------------|----------|
| DLPR       | 190h     |

## Function

This register contains the information of the data to be used for data learning.

Special write-access is permitted if:

- SR[IP\_ACC] = 0
- SR[AHB\_ACC] = 0

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 1    | 0    | 1    | 0    | 1    | 0    | 1    | 0    | 0    | 1    | 0    | 1    | 0    | 1    | 0    | 1    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 1    | 1    | 0    | 1    | 0    | 0    | 0    | 1    | 0    | 0    | 0    | 0    | 1    | 1    |

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                        |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Data learning pattern value                                                                                                                                                                                                                                                                                                                                                     |
| DLPV    | This value is used for data learning in SDR/DDR modes along with DATA_LEARN instruction. Different patterns can be matched at selected IOs. That is, IO1 and IO3 using DLCR[DLP_SEL_FA] and DLCR[DLP_SEL_FB], DLPR[31:16] for IO3, and DLPR[15:0] for IO1. DLP pattern for IO1 and IO3 should be stored, bit-wise, in the little endian format. For details, see Data learning. |

## 38.4.2.39 Flash Memory A Failing Address Status Register (FAILA\_ADDR)

## Offset

| Register   | Offset   |
|------------|----------|
| FAILA_ADDR | 194h     |

## Function

This register provides the flash memory address where data learning or parity error has occurred.

## Diagram

<!-- image -->

Quad Serial Peripheral Interface (QuadSPI)

## Fields

| Field   | Function                           |
|---------|------------------------------------|
| 31-0    | Failing address for flash memory A |
| ADDR    |                                    |

## 38.4.2.40 flash Memory B Failing Address Status Register (FAILB\_ADDR)

## Offset

| Register   | Offset   |
|------------|----------|
| FAILB_ADDR | 198h     |

## Function

This register provides the flash memory address where Data Learning or Parity error has occurred

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29    | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20 19   | 18   | 17   | 16   |
|--------|------|------|-------|------|------|------|------|------|------|------|------|---------|------|------|------|
| R      | ADDR | ADDR | ADDR  | ADDR | ADDR | ADDR | ADDR | ADDR | ADDR | ADDR | ADDR | ADDR    | ADDR | ADDR | ADDR |
| W      |      |      |       |      |      |      |      |      |      |      |      |         |      |      |      |
| Reset  | 1    | 1    | 1 1   | 1    | 1    |      | 1    | 1 1  | 1    | 1    | 1    | 1       | 1    | 1    | 1    |
| Bits   | 15   | 14   | 13 12 | 11   | 10   |      | 9    | 8 7  | 6    | 5    | 4    | 3       | 2    | 1    | 0    |
| R      | ADDR | ADDR | ADDR  | ADDR | ADDR | ADDR | ADDR | ADDR | ADDR | ADDR | ADDR | ADDR    | ADDR | ADDR | ADDR |
| W      |      |      |       |      |      |      |      |      |      |      |      |         |      |      |      |
| Reset  | 1    | 1    | 1 1   | 1    | 1    |      | 1    | 1 1  | 1    | 1    | 1    | 1       | 1    | 1    | 1    |

## Fields

| Field   | Function                           |
|---------|------------------------------------|
| 31-0    | Failing address for flash memory B |
| ADDR    |                                    |

## 38.4.2.41 RX Buffer Data Register (RBDR0 - RBDR63)

## Offset

For a = 0 to 63:

| Register   | Offset          |
|------------|-----------------|
| RBDRa      | 200h + (a × 4h) |

## Function

These registers provide access to individual entries in the RX buffer. See Table 223 for the byte ordering scheme.

RBDR0 corresponds to the actual position of the read pointer within the RX buffer. The number of valid entries available depends on the number of RX buffer entries implemented and on the number of valid buffer entries available in the RX buffer.

Example 1 - RX buffer filled completely with 128 words: In this case, the address range for valid read access extends from RBDR0 to RBDR63.

Example 2 - RX buffer filled with five valid words: RX buffer fill level of RBSR[RDBFL] is 5. In this case, access to RBDR4 provides the last valid entry.

Any access beyond the range of valid RX buffer entries provides undefined results.

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                         |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | RX data                                                                                                                                                          |
| RXDATA  | This field contains the data associated with the related RX buffer entry. For data format and byte ordering, see Byte ordering of serial flash memory read data. |

## 38.4.2.42 LUT Key Register (LUTKEY)

## Offset

| Register   | Offset   |
|------------|----------|
| LUTKEY     | 300h     |

## Function

This register contains the key to lock and unlock the LUT. See LUT for details.

Special write-access is permitted in the "Anytime" mode.

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 1    | 0    | 1    | 1    | 0    | 1    | 0    | 1    | 1    | 1    | 1    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 1    | 0    | 1    | 1    | 0    | 1    | 0    | 1    | 1    | 1    | 1    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                       |
|---------|----------------------------------------------------------------|
| 31-0    | Key to lock or unlock the LUT                                  |
| KEY     | The key is 0x5AF05AF0 and the read value is always 0x5AF05AF0. |

## 38.4.2.43 LUT Lock Configuration Register (LCKCR)

## Offset

| Register   | Offset   |
|------------|----------|
| LCKCR      | 304h     |

## Function

This register is used along with the LUTKEY register to lock or unlock the LUT. This register should be written immediately after the LUTKEY register for the lock or unlock operation to be successful. See LUT for details. Setting both the LOCK and UNLOCK bits as "00" or "11" is not allowed.

Special write access is permitted after writing the LUT key register.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | CK   | UNLO | LOCK |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      | CK   | UNLO | LOCK |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 1    | 0    |

Quad Serial Peripheral Interface (QuadSPI)

## Fields

| Field    | Function                                                                                                                                                                                               |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-2 -   | Reserved                                                                                                                                                                                               |
| 1 UNLOCK | Unlock LUT Unlocks the LUT when the following two conditions are met: • This register is written just after the LUT Key Register (LUTKEY). • The LUT key register was written with the 0x5AF05AF0 key. |
| 0 LOCK   | Lock LUT Locks the LUT when the following conditions are met: • This register is written just after the LUT Key Register (LUTKEY). • The LUT key register is written with the 0x5AF05AF0 key.          |

## 38.4.2.44 LUT Register (LUT0)

## Offset

| Register   | Offset   |
|------------|----------|
| LUT0       | 310h     |

## Function

A sequence of instruction-operand pairs may be pre-populated in the LUT according to the device connected on board. Each instruction-operand pair is of 16 bits (2 bytes) each. Every sequence preprogrammed by Program Sequence Engine in the LUT is referred to by its index. The LUT registers act as lookup tables for sequences of instructions. The programmable sequence engine executes the instructions in these sequences to generate a valid serial flash memory transaction. There are a total of 80 LUT registers. These 80 registers are divided into groups of 5 registers that make a valid sequence. Therefore, LUT[0], LUT[5], LUT[10] ..... LUT[75] are the starting registers of a valid sequence. Each of these sets of 5 registers can have a maximum of 10 instructions. Reset value of the register shown below is only applicable to LUT2 to LUT79. A maximum of 16 sequences can be defined at one time. See LUT that describes the LUT registers in detail.

Special write-access is permitted if the LUT is unlocked.

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

| Bits   | 31     | 30     | 29     | 28     | 27     | 26     | 25   | 24   | 23     | 22     | 21     | 20     | 19     | 18     | 17     | 16     |
|--------|--------|--------|--------|--------|--------|--------|------|------|--------|--------|--------|--------|--------|--------|--------|--------|
| R W    | INSTR1 | INSTR1 | INSTR1 | INSTR1 | INSTR1 | INSTR1 | PAD1 | PAD1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 |
| Reset  | 0      | 0      | 0      | 0      | 1      | 0      | 0    | 0    | 0      | 0      | 0      | 1      | 1      | 0      | 0      | 0      |
| Bits   | 15     | 14     | 13     | 12     | 11     | 10     | 9    | 8    | 7      | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
| R W    | INSTR0 | INSTR0 | INSTR0 | INSTR0 | INSTR0 | INSTR0 | PAD0 | PAD0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 |
| Reset  | 0      | 0      | 0      | 0      | 0      | 1      | 0    | 0    | 0      | 0      | 0      | 0      | 0      | 0      | 1      | 1      |

## Fields

| Field        | Function                                                                      |
|--------------|-------------------------------------------------------------------------------|
| 31-26 INSTR1 | Instruction 1                                                                 |
| 25-24 PAD1   | Pad information for INSTR1 00b - 1 Pad 01b - 2 Pads 10b - 4 Pads 11b - 8 Pads |
| 23-16 OPRND1 | Operand for INSTR1                                                            |
| 15-10 INSTR0 | Instruction 0                                                                 |
| 9-8 PAD0     | Pad information for INSTR0 00b - 1 Pad 01b - 2 Pads 10b - 4 Pads 11b - 8 Pads |
| 7-0 OPRND0   | Operand for INSTR0                                                            |

Quad Serial Peripheral Interface (QuadSPI)

## 38.4.2.45 LUT Register (LUT1)

## Offset

| Register   | Offset   |
|------------|----------|
| LUT1       | 314h     |

## Function

A sequence of instruction-operand pairs may be pre-populated in the LUT according to the device connected on board. Each instruction-operand pair is of 16 bits (2 bytes) each. Every sequence preprogrammed by Program Sequence Engine in the LUT is referred to by its index. The LUT registers act as lookup tables for sequences of instructions. The programmable sequence engine executes the instructions in these sequences to generate a valid serial flash memory transaction. There are a total of 80 LUT registers. These 80 registers are divided into groups of 5 registers that make a valid sequence. Therefore, LUT[0], LUT[5], LUT[10] ..... LUT[75] are the starting registers of a valid sequence. Each of these sets of 5 registers can have a maximum of 10 instructions. Reset value of the register shown below is only applicable to LUT2 to LUT79. A maximum of 16 sequences can be defined at one time. See LUT that describes the LUT registers in detail.

Special write-access is permitted if the LUT is unlocked.

## Diagram

<!-- image -->

| Bits   | 31     | 30     | 29     | 28     | 27     | 26     | 25   | 24   | 23     | 22     | 21     | 20     | 19     | 18     | 17     | 16     |
|--------|--------|--------|--------|--------|--------|--------|------|------|--------|--------|--------|--------|--------|--------|--------|--------|
| R W    | INSTR1 | INSTR1 | INSTR1 | INSTR1 | INSTR1 | INSTR1 | PAD1 | PAD1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 |
| Reset  | 0      | 0      | 1      | 0      | 0      | 1      | 0    | 0    | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| Bits   | 15     | 14     | 13     | 12     | 11     | 10     | 9    | 8    | 7      | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
| R W    | INSTR0 | INSTR0 | INSTR0 | INSTR0 | INSTR0 | INSTR0 | PAD0 | PAD0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 |
| Reset  | 0      | 0      | 0      | 1      | 1      | 1      | 0    | 0    | 0      | 0      | 0      | 0      | 1      | 0      | 0      | 0      |

## Fields

| Field        | Function                                                                      |
|--------------|-------------------------------------------------------------------------------|
| 31-26 INSTR1 | Instruction 1                                                                 |
| 25-24 PAD1   | Pad information for INSTR1 00b - 1 Pad 01b - 2 Pads 10b - 4 Pads 11b - 8 Pads |
| 23-16        | Operand for INSTR1                                                            |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

## Table continued from the previous page...

| Field        | Function                                                                      |
|--------------|-------------------------------------------------------------------------------|
| OPRND1       |                                                                               |
| 15-10 INSTR0 | Instruction 0                                                                 |
| 9-8 PAD0     | Pad information for INSTR0 00b - 1 Pad 01b - 2 Pads 10b - 4 Pads 11b - 8 Pads |
| 7-0 OPRND0   | Operand for INSTR0                                                            |

## 38.4.2.46 LUT Register (LUT2 - LUT79)

## Offset

For a = 2 to 79:

| Register   | Offset          |
|------------|-----------------|
| LUTa       | 310h + (a × 4h) |

## Function

A sequence of instruction-operand pairs may be pre-populated in the LUT according to the device connected on board. Each instruction-operand pair is of 16 bits (2 bytes) each. Every sequence preprogrammed by Program Sequence Engine in the LUT is referred to by its index. The LUT registers act as lookup tables for sequences of instructions. The programmable sequence engine executes the instructions in these sequences to generate a valid serial flash memory transaction. There are a total of 80 LUT registers. These 80 registers are divided into groups of 5 registers that make a valid sequence. Therefore, LUT[0], LUT[5], LUT[10] ..... LUT[75] are the starting registers of a valid sequence. Each of these sets of 5 registers can have a maximum of 10 instructions. Reset value of the register shown below is only applicable to LUT2 to LUT79. A maximum of 16 sequences can be defined at one time. See LUT that describes the LUT registers in detail.

Special write-access is permitted if the LUT is unlocked.

Quad Serial Peripheral Interface (QuadSPI)

## Diagram

<!-- image -->

| Bits   | 31     | 30     | 29     | 28     | 27     | 26     | 25   | 24   | 23     | 22     | 21     | 20     | 19     | 18     | 17     | 16     |
|--------|--------|--------|--------|--------|--------|--------|------|------|--------|--------|--------|--------|--------|--------|--------|--------|
| R W    | INSTR1 | INSTR1 | INSTR1 | INSTR1 | INSTR1 | INSTR1 | PAD1 | PAD1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 | OPRND1 |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0    | 0    | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| Bits   | 15     | 14     | 13     | 12     | 11     | 10     | 9    | 8    | 7      | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
| R W    | INSTR0 | INSTR0 | INSTR0 | INSTR0 | INSTR0 | INSTR0 | PAD0 | PAD0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 | OPRND0 |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0    | 0    | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |

## Fields

| Field        | Function                                                                      |
|--------------|-------------------------------------------------------------------------------|
| 31-26 INSTR1 | Instruction 1                                                                 |
| 25-24 PAD1   | Pad information for INSTR1 00b - 1 Pad 01b - 2 Pads 10b - 4 Pads 11b - 8 Pads |
| 23-16 OPRND1 | Operand for INSTR1                                                            |
| 15-10 INSTR0 | Instruction 0                                                                 |
| 9-8 PAD0     | Pad information for INSTR0 00b - 1 Pad 01b - 2 Pads 10b - 4 Pads 11b - 8 Pads |
| 7-0 OPRND0   | Operand for INSTR0                                                            |

## 38.4.3 Serial flash memory address assignment

The serial flash memory address assignment can be modified by writing into Serial Flash Memory A1 Top Address Register (SFA1AD) and Serial Flash Memory A2 Top Address Register (SFA2AD) for device A and into Serial Flash Memory B1 Top Address Register (SFB1AD) and Serial Flash Memory B2 Top Address Register (SFB2AD) for device B. The following table shows how different access modes are related to the address specified for the next SFM command. Note that this address assignment is valid for both IP and AHB commands.

Quad Serial Peripheral Interface (QuadSPI)

Table 215. Serial flash memory address assignment

| Parameter                              | Function                                                                                                                                                                                                                                                                                                                        | Access mode                                                                                                       |
|----------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|
| QuadSPI_AMBA_BAS E ((31:10) - 22 bits) | QuadSPI AHB base address First address of the serial flash memory device as presented to the QuadSPI controller. This might be the base of the serial flash memory in the system address map or it may be a remapping, for instance to 0h, performed by the system. (See the system address map file attached to this document) |                                                                                                                   |
| QuadSPI_ARDB_BAS E                     | First address of the QuadSPI Rx buffer on system memory map                                                                                                                                                                                                                                                                     |                                                                                                                   |
| TOP_ADDR_MEMA1(T PADA1)                | Top address for the external flash memory A1 (first device of the dual- die flash memory A, or the first of the two independent flash memories sharing the IOFA)                                                                                                                                                                | Any access to the address space between TOP_ADDR_MEMA1 and QuadSPI_AMBA_BASE is routed to serial flash memory A1. |
| TOP_ADDR_MEMA2(T PADA2)                | Top address for the external flash memory A2 (second device of the dual-die flash memory A, or the second of the two independent flash memories sharing the IOFA)                                                                                                                                                               | Any access to the address space between TOP_ADDR_MEMA2 and TOP_ADDR_MEMA1 is routed to serial flash memory A2.    |
| TOP_ADDR_MEMB1(T PADB1)                | Top address for the external flash memory B1 (first device of the dual- die flash memory B, or the first of the two independent flash memories sharing the IOFB)                                                                                                                                                                | Any access to the address space between TOP_ADDR_MEMB1 and TOP_ADDR_MEMA2 is routed to serial flash memory B1.    |
| TOP_ADDR_MEMB2(T PADB2) b              | Top address for the external flash memory B2 (second device of the dual-die flash memory B or the second of the two independent flash memories sharing the IOFB)                                                                                                                                                                | Any access to the address space between TOP_ADDR_MEMB2 and TOP_ADDR_MEMB1 is routed to serial flash memory A2.    |

## 38.5 Flash memory mapped AMBA bus

QuadSPI\_AMBA\_BASE defines the address to be used as the start address of the serial flash memory device, as defined by the system memory map. Note that this may be a remapping of the physical address of the serial flash memory in the system. See the system address map for details.

Table 216. QuadSPI AMBA bus memory map

| Address                                                        | Register name                                                                                                                                                        |
|----------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| QuadSPI_AMBA_BASE to (TOP_ADDR_MEMA2 - 1h)                     | • See Memory-mapped serial flash memory data-individual flash memory mode on flash memory A. • For information about byte ordering, see Table 223 and Table 228.     |
| TOP_ADDR_MEMA2 to (TOP_ADDR_MEMB2 - 1h)                        | • See Memory-mapped serial flash memory data-individual flash memory mode on flash memory B. • For information about the byte ordering, see Table 223 and Table 228. |
| QuadSPI_AMBA_BASE to (TOP_ADDR_MEMB2 - 1h)                     | • See Parallel flash memory mode. • For information about the byte ordering, see Table 227 and Table 228.                                                            |
| QuadSPI_ARDB_BASE to... (32 * 4 Byte) QuadSPI_ARDB_BASE + 1FFh | • See AHB RX Data Buffer Register (ARDB0 - ARDB127). • For information about the byte ordering, see Table 223 and Table 225.                                         |

## NOTE

Any read access to non-implemented addresses provides undefined results.

In case of single-die flash memory devices, TOP\_ADDR\_MEMA2 and TOP\_ADDR\_MEMB2 should be initialized/ programmed to TOP\_ADDR\_MEMA1 and TOP\_ADDR\_MEMB1, respectively (in effect, setting the size of these devices to 0). This ensures that the complete memory map is assigned to only one flash device.

The parallel flash memory mode is valid only for commands related to data read and data write in single I/O mode from serial flash memory. The first device of flash memory A needs to be paired with the first device of flash memory B and the second device of flash memory A has to be paired with the second device of flash memory B in parallel mode. This mode is selected via BFGENCR[PAR\_EN] for all masters in the AHB driven mode and through IPCR[PAR\_EN] in the IP-driven mode. In the parallel mode, the incoming address (SFAR address in case of IP-initiated transactions and the incoming AHB address in case of AHB-initiated transactions) is divided by 2 and sent to the two flash memories connected in parallel.

Any IP command other than data read and write (through one pad) in the parallel flash memory mode results in the assertion of FR[IUEF].

In individual flash memory modes, the 3/4 address bytes (as programmed in the instruction/operand in the sequence) available for the flash memory address are determined by SFADR[23:0] or SFADR[31:0] as provided in the table shown above.

In parallel flash memory mode, both flash memories are read with the same starting address of 3/4 (as programmed in the instruction/operand in the sequence) bytes in size. This address is derived from SFADR[24:1] or SFADR[31:1] as provided in the table above. The LSB of the SFADR field is used to select the appropriate bits of both the flash memory devices to combine the bytes corresponding to the selected address.

## 38.5.1 AHB bus access read considerations

Note that all logic in the QuadSPI module implementing the AHB bus access is designed to read the content of an external serial flash memory device. Therefore, the following restrictions apply to the QuadSPI module with respect to accesses to the AHB bus:

- AHB bus read access types-NONSEQ and BUSY-are fully supported.
- AHB read access type-SEQ-is treated in the same way as NONSEQ. See Flash memory mapped AMBA bus for details.

Quad Serial Peripheral Interface (QuadSPI)

- Early burst termination is not supported for AHB transactions.
- An AHB error response is provided on occurrence of:
- Parity error
- ECC error from flash memory
- Data learning failure

Also, interrupts (if enabled) are provided along with the AHB error response.

- An AHB error response occurs when FR[AITEF] bit is set
- An AHB bus stall alongwith error response occurs when FR[AAEF] bit is set

## 38.5.2 Memory-mapped serial flash memory data-individual flash memory mode on flash memory A

Starting with address QuadSPI\_AMBA\_BASE, the content of the first external serial flash memory device is mapped into the address space of the device containing the QuadSPI module. Serial flash memory byte address 0h corresponds to bus address, QuadSPI\_AMBA\_BASE, in an increasing order. Assuming that a dual-die flash memory is connected to the first set of external pads, the address space is divided into two parts, one for each device of the dual-die package. See the following table for the address mapping. The byte ordering for 32-bit access is provided in Table 223 and for 64-bit read access, the byte ordering is provided in Table 228.

Table 217. Memory-mapped individual flash memory mode-flash memory A address scheme

| Memory-mapped address 32- bit access   | Memory-mapped address 64- bit access   | Serial flash memory byte address                    | Flash memory device   |
|----------------------------------------|----------------------------------------|-----------------------------------------------------|-----------------------|
| QuadSPI_AMBA_BASE + 0h                 | QuadSPI_AMBA_BASE + 0h                 | 0h to 3h                                            | A1                    |
| QuadSPI_AMBA_BASE + 4h                 | QuadSPI_AMBA_BASE + 0h                 | 4h to 7h                                            | A1                    |
| ...                                    | ...                                    | ...                                                 | A1                    |
| TOP_ADDR_MEMA1 - 8h                    | TOP_ADDR_MEMA1 - 8h                    | (TOP_ADDR_MEMA1- 8h) to (TOP_ADDR_MEMA1 - 0h4 -0h1) | A1                    |
| TOP_ADDR_MEMA1 - 4h                    | TOP_ADDR_MEMA1 - 8h                    | (TOP_ADDR_MEMA1 - 4h) to (TOP_ADDR_MEMA1 - 0h1)     | A1                    |
| TOP_ADDR_MEMA1 + 4h                    | TOP_ADDR_MEMA1 + 0h                    | 0h to 3h                                            | A2                    |
| TOP_ADDR_MEMA1 + 0h4                   | TOP_ADDR_MEMA1 + 0h                    | 4h to 7h                                            | A2                    |
| ...                                    | ...                                    | ...                                                 | A2                    |
| TOP_ADDR_MEMA2 - 8h                    | TOP_ADDR_MEMA2 - 8h                    | (TOP_ADDR_MEMA2 - 8h) to (TOP_ADDR_MEMA2 - 4h - 1h) | A2                    |
| TOP_ADDR_MEMA2 - 4h                    | TOP_ADDR_MEMA2 - 8h                    | (TOP_ADDR_MEMA2 - 4h) to (TOP_ADDR_MEMA2 - 1h)      | A2                    |

The available address range depends on the size of the external serial flash memory device. Any access beyond the size of the external serial flash memory provides undefined results.

For details concerning the read process, see Flash memory read.

Quad Serial Peripheral Interface (QuadSPI)

Quad Serial Peripheral Interface (QuadSPI)

## 38.5.3 Memory-mapped serial flash memory data-individual flash memory mode on flash memory B

Starting with address TOP\_ADDR\_MEMA2, the content of the first external serial flash memory devices is mapped into the address space of the device containing the QuadSPI module. Serial flash memory address byte address 0h corresponds to bus address, TOP\_ADDR\_MEMA2, in an increasing order. Assuming that a dual-die flash memory is connected to the first set of external pads, the address space is divided into two parts, one for each device of the dual-die package. See the following table for address mapping. The byte ordering for 32-bit access is provided in Table 223 and for 64-bit read access, the byte ordering is provided in Table 228.

Table 218. Memory-mapped individual flash memory mode-flash memory B address scheme

| Memory-mapped address 32- bit access   | Memory-mapped address 64- bit access   | Serial flash memory byte address                                                        | Flash memory device   |
|----------------------------------------|----------------------------------------|-----------------------------------------------------------------------------------------|-----------------------|
| TOP_ADDR_MEMA2 + 0h                    | TOP_ADDR_MEMA2 + 0h                    | 0h to 3h                                                                                | B1                    |
| TOP_ADDR_MEMA2 + 0h4                   | TOP_ADDR_MEMA2 + 0h                    | 0h_0004 to 0h_0007                                                                      | B1                    |
| ...                                    | ...                                    | ...                                                                                     | B1                    |
| TOP_ADDR_MEMB1 - 0h8                   | TOP_ADDR_MEMB1 - 0h8                   | (TOP_ADDR_MEMB1- TOP_ADDR_MEMA2 - 0h8) to (TOP_ADDR_MEMB1 - TOP_ADDR_MEMA2 - 0h4 -0h1)  | B1                    |
| TOP_ADDR_MEMB1 - 0h4                   | TOP_ADDR_MEMB1 - 0h8                   | (TOP_ADDR_MEMB1- TOP_ADDR_MEMA2 - 0h4) to (TOP_ADDR_MEMB1- TOP_ADDR_MEMA2- 0h1)         | B1                    |
| TOP_ADDR_MEMB1 + 0h                    | TOP_ADDR_MEMB1 + 0h                    | 0 to 3h                                                                                 | B2                    |
| TOP_ADDR_MEMB1 + 0h4                   | TOP_ADDR_MEMB1 + 0h                    | 0h_0004 to 0h_0007                                                                      | B2                    |
| ...                                    | ...                                    | ...                                                                                     | B2                    |
| TOP_ADDR_MEMB2 - 0h8                   | TOP_ADDR_MEMA2 - 0h8                   | (TOP_ADDR_MEMB2 - TOP_ADDR_MEMB1- 0h8) to (TOP_ADDR_MEMB2 - TOP_ADDR_MEMB1 - 0h4 - 0h1) | B2                    |
| TOP_ADDR_MEMB2 - 0h4                   | TOP_ADDR_MEMA2 - 0h8                   | (TOP_ADDR_MEMB2- TOP_ADDR_MEMB1 - 0h4) to (TOP_ADDR_MEMB2 - TOP_ADDR_MEMB1 - 0h1)       | B2                    |

The available address range depends on the size of the external serial flash memory device. Any access beyond the size of the external serial flash memory provides undefined results.

For details concerning the read process, see Flash memory read.

## 38.5.4 Parallel flash memory mode

Any of the AHB flexible buffers can be configured to work in the parallel flash memory mode by programming the value for BFGENCR[PAR\_EN] to 1. When the parallel mode is set, flash memory A1 is paired with flash memory B1 and flash memory A2

Quad Serial Peripheral Interface (QuadSPI)

is paired with flash memory B2. In the parallel mode, the software should ensure that the size of flash memory A1(A2) is equal to the size of flash memory B1(B2).

Reads from any even AHB bus address provide bits [7:4] of both serial flash memory devices and reads from any odd AHB bus address provide bits [3:0] of both flash memory devices. See the following table for address mapping. The byte ordering for 32-bit access Table 225and 64-bit read access is provided in Table 228.

Table 219. Memory-mapped parallel flash memory mode address scheme

| Memory-mapped address 32- bit access   | Memory-mapped address 64- bit access                                               | Serial flash memory A byte address              | Serial flash memory B byte address              |
|----------------------------------------|------------------------------------------------------------------------------------|-------------------------------------------------|-------------------------------------------------|
| QuadSPI_AMBA_BASE + 0h                 | QuadSPI_AMBA_BASE + 0h For details, see Parallel mode and Dual-die flash memories. | 0h - 1h                                         | 0h - 1h                                         |
| QuadSPI_AMBA_BASE + 4h                 | QuadSPI_AMBA_BASE + 0h For details, see Parallel mode and Dual-die flash memories. | 2h - 3h                                         | 2h - 3h                                         |
| QuadSPI_AMBA_BASE + 8h                 | QuadSPI_AMBA_BASE + 8h                                                             | 4h - 5h                                         | 4h - 5h                                         |
| QuadSPI_AMBA_BASE + Ch                 | QuadSPI_AMBA_BASE + 8h                                                             | 6h - 7h                                         | 6h - 7h                                         |
| ...                                    | ...                                                                                | ...                                             | ...                                             |
| TOP_ADDR_MEMB2 - 8h                    | TOP_ADDR_MEMB2 - 8h                                                                | (TOP_ADDR_MEMB2 - QuadSPI_AMBA_BASE - 8h)/2     | (TOP_ADDR_MEMB2 -QuadSPI_AMBA_BAS E - 8h)/2     |
| TOP_ADDR_MEMB2 - 4h                    | TOP_ADDR_MEMB2 - 8h                                                                | (TOP_ADDR_MEMB2 - QuadSPI_AMBA_BASE - 4h)/2 +1h | (TOP_ADDR_MEMB2 -QuadSPI_AMBA_BAS E- 4h)/2 + 1h |

The available address range covers 27 address bits, corresponding to 128 MB per flash memory device. The usable space depends on the size of the external serial flash memory devices. Any access beyond the size of the external serial flash memory provides undefined results.

For details concerning the read process, see Flash memory read.

## 38.5.5 ARDB register descriptions

## NOTE

See the system memory map in this document for the base address of the QuadSPI AHB RX data buffer.

## 38.5.5.1 ARDB memory map

QuadSPI\_ARDB base address: 4100\_0000h

| Offset    | Register                                      |   Width (In bits) | Access   | Reset value   |
|-----------|-----------------------------------------------|-------------------|----------|---------------|
| 0h - 1FCh | AHB RX Data Buffer Register (ARDB0 - ARDB127) |                32 | R        | 0000_0000h    |

## 38.5.5.2 AHB RX Data Buffer Register (ARDB0 - ARDB127)

## Offset

For a = 0 to 127:

| Register   | Offset        |
|------------|---------------|
| ARDBa      | 0h + (a × 4h) |

## Function

This register is used to read the buffer content of the RX buffer from successive addresses. ARDB0 corresponds to the RX buffer register entry corresponding to the current value of the read pointer in an increasing order.

The increment of the read pointer depends on the access scheme (DMA or flag-driven). See Flash memory read, RX buffer, data read through register interface, and AHB read for the description of successive accesses to the RX buffer content. See Byte Ordering of Serial Flash Memory Read Data for the byte ordering scheme.

Valid address range accessible in the ARDBn range depends on the number of RX buffer entries implemented and on the number of valid buffer entries available in the RX buffer.

- Example 1 - RX buffer filled completely with 128 words: In this case, the address range for valid read access extends from ARDB0 to ARDB127.
- Example 2 - RX buffer filled with five valid words; RX buffer fill level RBSR[RDBFL] is 5. In this case, an access to ARDB4 provides the last valid entry.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD | ARXD |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                              |
|---------|-----------------------------------------------------------------------|
| 31-0    | ARDB provided RX buffer data                                          |
| ARXD    | Byte order (endianness) is identical to the RX buffer data registers. |

## 38.6 Functional description

This section provides a functional description of the QuadSPI module.

## 38.6.1 Serial flash memory access schemes

The following access schemes are possible, depending on the serial flash devices attached to the QuadSPI module.

Table 220. Access schemes for serial flash memory data access

| Access scheme                                                           | One flash memory device on port A   | One flash memory device on port B   | Two identical flash memory devices connected to port A and port B   |
|-------------------------------------------------------------------------|-------------------------------------|-------------------------------------|---------------------------------------------------------------------|
| Individual flash memory mode: access to flash memory A                  | Yes                                 | N/a                                 | Yes                                                                 |
| Individual flash memory mode: access to flash memory B                  | N/A                                 | Yes                                 | Yes                                                                 |
| Parallel flash memory mode: read from flash memory A and flash memory B | N/A                                 | N/A                                 | Yes                                                                 |

If two flash memory devices are accessed in the parallel flash memory mode, they are accessed with identical control signals. Special alignment on per-flash memory basis is not possible. The application needs to ensure that the identical signals are applicable to both the flash memory devices.

In the parallel flash memory mode, both the external serial flash memory devices appear as a single memory doubled in size with respect to one individual flash memory device.

If two different flash memory devices are attached, they can be operated only in the individual flash memory mode.

In the parallel flash memory mode, only data read commands and write command (in x1 mode) are supported. Any other IP command results in an error condition signaled by the assertion of FR[IUEF].

In the individual flash memory mode, all supported commands are available.

Unless explicitly noted, all the following descriptions relate to the individual flash memory mode.

## 38.6.2 Normal mode

This mode allows communication with an external serial flash memory device. Compared to the standard SPI protocol, this communication method uses up to eight bidirectional data lines operating at high-data rates. The communication to the external serial flash memory device consists of an instruction code and optional address, mode, dummy, and data transfers. The flexible programmable core engine described below is immune to a wide variety of command or protocol differences in the serial flash memory devices provided by various flash memory vendors.

## 38.6.2.1 Programmable sequence engine

The core of the QuadSPI module is a programmable sequence engine that works on "instruction-operand" pairs. The core controller executes each programmed instruction sequentially. The complete list of instructions and the corresponding operands are provided in the following table.

Table 221. Instruction set

| Instruction   | Instruction encoding   | Pins                                                                  | Operand                                                                                      | Action on serial flash memories                                                                                                                                                                                                                                                                                                                                                            |
|---------------|------------------------|-----------------------------------------------------------------------|----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CMD           | 1d                     | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d- Eight pads | 8-bit command value                                                                          | Provides the serial flash memory with the SFM command operand (Encoded) on the number of pads specified in STR mode.                                                                                                                                                                                                                                                                       |
| ADDR          | 2d                     | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d- Eight pads | Number of address bits to be sent (for example, 24d => 24 address bits required)             | Provide the serial flash memory with address cycles according to the operand on the number of pads specified The actual address to be provided is derived from the incoming address in case of AHB-initiated transactions and the value of SFAR in case of IPS-initiated transactions, if the value of SFACR[CAS] is set to 0. Otherwise, the actual address takes CAS into consideration. |
| DUMMY         | 3d                     | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d- Eight pads | Number of dummy clock cycles (should be <= 64 and > 2 cycles)                                | Provide the serial flash memory with dummy cycles according the operand ThePADinformation defines the numberofpadsininputmode. For example, one pad implies that pad 1 is not driven, rest all are driven. If DLL is enabled and N dummy cycles are needed, you must program two back- to-back DUMMY instructions: DUMMY: N-2 followed by DUMMY:2. NOTE                                    |
| MODE          | 4d                     | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d- Eight pads | 8-bit mode value                                                                             | Provide the serial flash memory with 8-bit operand on the number of pads specified                                                                                                                                                                                                                                                                                                         |
| MODE2         | 5d                     | N={0,1}d                                                              | 2-bit mode value                                                                             | Provide the serial flash memory with 2-bit operand on the number of pads 1 specified                                                                                                                                                                                                                                                                                                       |
| MODE4         | 6d                     | N={0,1,2}d                                                            | 4-bit mode value                                                                             | Provide the serial flash memory with 4-bit operand on the number of pads 2 specified                                                                                                                                                                                                                                                                                                       |
| READ          | 7d                     | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d- Eight pads | Read data size in bytes (for AHB transactions, your application should ensure that data size | Read data from flash memory on the number of pads specified The data size can be overwritten by writing to the ADATSZfield of the BUFxCR registers for AHB-initiated transactions and to the IDATSZ field of the IP Configuration Register (IPCR) for IPS-initiated transactions.                                                                                                          |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

Table 221. Instruction set (continued)

| Instruction   | Instruction encoding   | Pins                                                                   | Operand                                                                                                                | Action on serial flash memories                                                                                                                                                                                                                                                                                                                                                                                           |
|---------------|------------------------|------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|               |                        |                                                                        | is a multiple of 8 bytes)                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                           |
| WRITE         | 8                      |                                                                        | Write data size in bytes                                                                                               | Write data on the number of pads specified The data size can be overwritten by writing to the IDATSZ field of IP Configuration Register (IPCR).                                                                                                                                                                                                                                                                           |
| JMP_ON_CS 3   | 9d                     | NA                                                                     | Instruction number                                                                                                     | Every time the CSisdeasserted, jump to the instruction pointed to by the operand. This instruction allows the programmer to specify the behavior of the controller when a new read transaction is initiated following a CS deassertion. This instruction is not supported if DLL is enabled. NOTE                                                                                                                         |
| ADDR_DDR      | 10d                    | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d- Eight pads  | Number of address bits to be sent (for example, 24d => 24 address bits required)                                       | Provide the serial flash memory with address cycles according to the operand on the number of pads specified at each clock edge of serial flash memory clock. The actual address to be provided is derived from the incoming address in case of AHB-initiated transactions and the value of SFAR in case of IPS-initiated transactions if SFACR[CAS]issetto0. Otherwise, the actual address takes CAS into consideration. |
| MODE_DDR      | 11d                    | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d- Eight pads  | 8-bit mode value                                                                                                       | Provide the serial flash memory with 8-bit operand on the number of pads specified at each clock edge of serial flash memory                                                                                                                                                                                                                                                                                              |
| MODE2_DDR     | 12d                    | N={0}d                                                                 | 2-bit mode value                                                                                                       | Provide the serial flash memory with 2-bit operand on the number of pads specified at each clock edge of serial flash memory 4                                                                                                                                                                                                                                                                                            |
| MODE4_DDR     | 13d                    | N={0,1}d                                                               | 4-bit mode value                                                                                                       | Provide the serial flash memory with 4-bit operand on the number of pads specified at each clock edge of serial flash memory 5 .                                                                                                                                                                                                                                                                                          |
| READ_DDR      | 14d                    | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d - Eight pads | Read data size in bytes (for AHB transactions, the application should ensure that data size is in multiple of 8 bytes) | Read data from flash memory on the number of pads specified at each clock edge of serial flash memory. The data size might be overwritten by writing to the ADATSZ field of the BUFxCR registers for AHB-initiated transactions and IDATSZ field of IP Configuration Register (IPCR) for IP initiated transactions.                                                                                                       |

Table continues on the next page...

Table 221. Instruction set (continued)

| Instruction   | Instruction encoding   | Pins                                                                  | Operand                                                                                                                                                                                         | Action on serial flash memories                                                                                                                                                                                                                                                                                                                                                                                                                           |
|---------------|------------------------|-----------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| WRITE_DDR     | 15d                    |                                                                       | Write data size in bytes                                                                                                                                                                        | Write data on the number of pads specified at each clock edge of serial flash memory The data size can be overwritten by writing to the IDATSZ field of IP Configuration Register (IPCR).                                                                                                                                                                                                                                                                 |
| DATA_LEAR N   | 16d                    | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d- Eight pads | Operand[7]- • 1 - DDR mode • 0 - SDR mode Operand[6:0]- • Number of bits to be used for data learning. For example, if operand is 16 then a 16-bit data learning pattern is read and compare d. | Find the correct sampling point with the data learning pattern. When this instruction is encountered, the value of Sampling Register (SMPR) is ignored and the controller finds the correct sampling point on its own by sampling the data learning pattern. 6                                                                                                                                                                                            |
| CMD_DDR       | 17d                    | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d- Eight pads | 8-bit command value                                                                                                                                                                             | Provides the serial flash memory with the SFM command operand (Encoded) on the number of pads specified in DTR mode.                                                                                                                                                                                                                                                                                                                                      |
| CADDR         | 18d                    | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d- Eight pads | Number of column address bits to be sent (8d means 8 bits of column address is to be sent)                                                                                                      | Provide the serial flash memory with column address cycles according to the operand on the number of pads specified. The actual address to be provided to flash memory depends on the value of SFACR[CAS]. For example, if the value of SFACR[CAS] is 3, then the address to flash memory will be [2:0]ofincomingaddressincaseofAHBandthevalueofSFAR in case of IP. This is appended with 0 if SFACR[CAS] is less than number of pads for a flash memory. |
| CADDR_DDR     | 19d                    | N={0,1,2,3}d 0d - One pad 1d - Two pads 2d - Four pads 3d- Eight pads | Number of column address bits to be sent(8d means 8 bits                                                                                                                                        | Provide the serial flash memory with column address cycles according to the operand on the number of pads specified at each clock edge of the serial flash memory. The actual address to be provided to flash memory depends on the value of SFACR[CAS]. For example, if CAS is 3, then the address to                                                                                                                                                    |

Table continues on the next page...

Table 221. Instruction set (continued)

| Instruction   | Instruction encoding   | Pins   | Operand                          | Action on serial flash memories                                                                                                                                                                                                                                                                                                                                   |
|---------------|------------------------|--------|----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|               |                        |        | of column address is to be sent) | flash memory will be [2:0] of incoming address in case of AHB and the value of SFAR in case of IP. This is appended with 0 if CAS is less than the number of pads for a flash memory.                                                                                                                                                                             |
| JMP_TO_SE Q 3 | 20d                    | NA     | Sequence number                  | Every time CS is deasserted, jump to the LUT sequence is pointed to by the operand. This instruction allows the programmer to join two sequences and initiates the second flash memory transaction automatically. It can be used to join write-enables with flash memory write or data learn with read. This instruction is not supported if DLL is enabled. NOTE |
| STOP 3        | 0d                     | NA     | NA                               | Stop execution; deassert CS                                                                                                                                                                                                                                                                                                                                       |

1. For a one-pad instruction, MODE2 takes two serial flash memory clock cycles on the flash memory interface.
3. Sequence ending with this instruction must have all remaining bits as 0s after it.
2. For a one-pad instruction, MODE4 takes four serial flash memory clock cycles on the flash memory interface. For a four-pad instruction, MODE4 takes one serial flash memory clock cycle on the flash memory interface.
4. For a one-pad instruction, MODE2\_DDR takes one serial flash memory clock cycle on the flash memory interface.
6. It is not recommended to have 0h or FFh as the data learning pattern.
5. For a one-pad instruction, MODE4\_DDR takes two serial flash memory clock cycles on the flash memory interface. For a four-pad instruction MODE4\_DDR takes half a cycle on the serial flash memory interface.

The programmable sequence engine allows you to configure the QuadSPI module according to the serial flash memory connected on board. This flexible structure is compatible with new command or protocol changes from different vendors.

## 38.6.2.2 Flexible read xAHB buffers

To reduce the latency of the reads for AHB masters, the data read from serial flash memory is buffered in flexible AHB buffers. There are four such flexible buffers. The size of each of these buffers is configurable with the minimum size being 0 bytes and maximum size being the size of the complete buffer instantiated (1024 bytes). The size of buffer 0 ranges from 0 to BUF0IND. The size of buffer 1 ranges from BUF0IND to BUF1IND, buffer2 from BUF1IND to BUF2IND and, buffer 3 ranges from BUF2IND to the size of the complete buffer (1024 bytes).

Each flexible AHB buffer is associated with the following:

- An AHB master: Optionally, buffer3 may be configured as an "all master" buffer by writing 1 to BUF3CR[ALLMST]. When buffer3 is configured in such a way, any access from a master not associated with any other buffer is routed to buffer3.
- A datasize field representing the amount of data to be fetched from the flash memory on every missed access.

The master ID of every incoming request is checked and the data is returned or fetched into the corresponding associated buffer. See the chip-specific QuadSPI information for details about master IDs and their corresponding components. Every missed access to the buffer causes the controller to clear the buffer and fetch the BUFxCR[ADATSZ] amount of data from the serial flash memory. As such, you need not configure the buffer size to be greater than ADATSZ because the locations greater than ADATSZ are never used. For any AHB access, the sequence pointed to by BFGENCR[SEQID] is used for the initiated flash memory transaction. The data is returned to the master as soon as the requested amount is read from the serial flash memory. The controller; however, continues to prefetch the rest of the data in anticipation of a next consecutive request. See Figure 212 that shows flexible AHB buffers.

BFGENCR[SEQID] points to an index of the LUT. See LUT for details.

Quad Serial Peripheral Interface (QuadSPI)

Quad Serial Peripheral Interface (QuadSPI)

Figure 212. Flexible read AHB buffers

<!-- image -->

## 38.6.2.3 Abort mechanism during AHB read

Any ongoing read transaction is aborted if a request from the same master arrives for a location other than the location at which the transaction is going on. The abort can happen at any point of time.

## 38.6.2.4 HBURST support with AHB read

QuadSPI controller supports HBURST and HSIZE on the AHB read interface. HBURST indicates if the transfer forms part of a burst. Four, eight, and sixteen beat bursts are supported and the bursts might either be incrementing or wrapping. HSIZE indicates the size of the transfer, and supports 8-, 16-, 32-, and 64-bit data sizes. In case of WRAP accesses, QuadSPI generates aligned accesses to serial flash memory if there is no buffer hit for any incoming, non-sequential AHB read access. In case there is a buffer hit, the incoming address in the haddr line is latched as it is. If the total burst size is more than the data prefetch size, an error response is generated and the value of FR[AIBSEF] is configured as 1. The data prefetch size can be defined by BUFxCR[ADATSZ] or data size mentioned in the sequence pointed to by the SEQID field when ADATSZ is programmed as 0. In case of wrap burst, data prefetch size must be greater than or equal to the wrap burst size + 32 bytes. A few examples are shown in the figure below:

HADDR = 0x38 HBUST = WRAP4 HSIZE = 64 bits Flash xsaction start = 0x20

HADDR = 0x50 HBUST = WRAP8 HSIZE = 64 bits

Flash xsaction start = 0x40 Incoming AHB access= 0x50, 0x58, 0x60, 0x68, 0x70, 0x78, 0x40, 0x48

HADDR = 0x38 HBUST = INCR4 HSIZE = 64 bits Flash xsaction start = 0x38 Incoming AHB access= 0x38, 0x40, 0x48, 0x50

HADDR = 0xD0 HBUST = WRAP16 HSIZE = 64 bits

Flash xsaction start = 0x80

HADDR = 0xD4 HBUST = WRAP8 HSIZE = 32bits Flash xsaction start = 0xC0 Incoming AHB access= 0xD4, 0xD8, 0xDC, 0xC0, 0xC4, 0xC8,0xCC, 0xD0

HADDR = 0x54 HBUST = INCR8 HSIZE = 32bits

Flash xsaction start = 0x54

Incoming AHB access= 0x38, 0x20, 0x28, 0x30

Incoming AHB access= 0xD0, 0xD8, 0xE0, ...0xF8, 0x80, 0x88, ... 0xC8

Incoming AHB access= 0x54, 0x58, 0x5C, 0x60, 0x64, 0x68,0x6C, 0x70

Figure 213. QuadSPI HBURST support

## NOTE

The software must take care that the prefetch size should never be set less than the minimum data needed by any external interface to start processing.

## NOTE

Whenever a core accesses QuadSPI memory with cache enabled, the prefetch size must be configured as equal or more than the cache line size; otherwise, FR[AIBSEF] error appears.

## 38.6.2.5 LUT

The LUT consists of a number of pre-programmed sequences. Each sequence is basically a sequence of instruction-operand pairs, which when executed sequentially, generate a valid serial flash memory transaction. Each sequence can have a maximum of 10 instruction-operand pairs. The LUT can hold a maximum of 16 sequences. The figure below shows the basic structure of the sequence in the LUT.

Quad Serial Peripheral Interface (QuadSPI)

<!-- image -->

At reset, the index 0 of the LUT[0..4] is programmed with a basic read sequence as described in Reset sequence. After reset, the complete LUT may be reprogrammed according to the chip connected on board. To protect its contents, during a code runover, the LUT might be locked, after which a write to the LUT will not be successful until it has been unlocked again. The key for locking or unlocking the LUT is 5AF05AF0h, and the associated processes are as follows:

## Locking the LUT

1. Write the key 5AF05AF0h into the LUT Key Register (LUTKEY).
2. Write 0b01 to the LUT Lock Configuration Register (LCKCR). Note that this IPS transaction should immediately follow the above IPS transaction (no other IPS transaction can be issued). A successful write to this register locks the LUT.

## Unlocking the LUT

1. Write the key 5AF05AF0h into the LUT Key Register (LUTKEY).
2. Write 0b10 to the LUT Lock Configuration Register (LCKCR). Note that this IPS transaction should immediately follow the above IPS transaction (no other IPS transaction can be issued in between). A successful write to this register unlocks the LUT.

The lock status of the LUT can be read from the LCKCR[UNLOCK] and LCKCR[LOCK] fields.

Some example sequences are defined in Example sequences. After reset the instruction sequence 0 is populated with the default read sequence shown in the table below.

Table 222. Reset sequence

| Instruction   | Pad   | Operand   | Comment                               |
|---------------|-------|-----------|---------------------------------------|
| CMD           | 0h    | 3h        | Read data byte command on one pad     |
| ADDR          | 0h    | 18h       | 24 address bits to be sent on one pad |

Table continues on the next page...

## Table 222. Reset sequence (continued)

| Instruction   | Pad   | Operand   | Comment                     |
|---------------|-------|-----------|-----------------------------|
| READ          | 0h    | 8h        | Read 64 bits                |
| JMP_ON_CS     | 0h    | 0h        | Jump to instruction 0 (CMD) |

## NOTE

If DLL is disabled then JMP\_ON\_CS or STOP instruction can be used else only STOP instruction can be used.

## 38.6.2.6 Issuing SFM commands

Each access to the external device follows this sequence:

1. You must pre-populate the LUT with the serial flash memory command sequences that are required for the flash memory device being used.
2. The module executes the instructions in this sequence one by one. The transaction starts and the module configures the value of SR[BUSY].
3. Communication with the external serial flash memory device starts and the transaction executes.
4. After the transaction is complete (all transmit and receive operations with the external serial flash memory device are complete), the module resets SR[BUSY]. In case of an IP command, FR[TFF] is asserted.

For details, see Flash memory programming and Flash memory read.

You can trigger the processing of SFM commands in the QuadSPI module in one of the following ways:

## Using IP commands

For IP commands, the required components need to be written into the following registers and in this sequence:

1. Write the serial flash memory address to be used as provided in the Serial Flash Address Register (SFAR). For IP commands not related to specific addresses, the base address of the related flash memory needs to be programmed. For example, for an instruction which does not require an address (that is, write enable instruction), the SFAR should be programmed with the base address of the memory the command is to be sent to.
2. Write the sequence ID and data size details in the IP Configuration Register (IPCR).
3. Note that writing a value to IPCR[SEQID] must be the last step of the sequence. It is possible to combine all the fields of the IPCR into one single write. See IP Configuration Register (IPCR) for details.

## Using AHB commands

Any AHB memory-mapped access is routed to one of the buffers depending on the master ID of the request. If the access is a "miss," a new serial flash memory transaction is initiated. The transaction is based on the sequence pointed to by BFGENCR[SEQID] as described in Flexible read xAHB buffers.

An AHB access is considered memory mapped when the access is to the memory-mapped serial flash memories, as described in Memory Mapped Serial Flash Data - Individual Flash mode on Flash memory A and Memory Mapped Serial Flash Data - Individual Flash Memory mode on Flash memory B.

## 38.6.2.7 Flash memory programming

In all NOR Flash devices memory sector to be written needs to be erased first. The programming sequence is then initiated in the following way:

1. Check that SR[BUSY] is de-asserted or the value of the BUSY field is 0, also, check that the TX buffer is empty. If you need to discard the data present in the TX buffer (SR[TXNE]) then the TX buffer must be cleared by writing 1 to MCR[CLR\_TXF].

Quad Serial Peripheral Interface (QuadSPI)

2. Program the address related to the command in SFAR. If required, write the desired value to SFACR[CAS], otherwise write 0 to it. Also, write 1 to SFACR[WA] if the serial flash memory is a word addressable flash memory, or write 0 in case serial flash memory is byte addressable.
3. Provide initial data for the program command into the circular buffer through the TBDR. At least one words of data must be written into the TX buffer up to a maximum of 256 entries.
4. Program the IPCR to trigger the command. IPCR[SEQID] should point to an index of the LUT that has the flash memory program sequence pre-programmed. Write an appropriate value to IPCR[IDATSZ] to denote the size of the write in bytes.
5. Repeat step 3, depending on the amount of data required, until all of the required data is written to the TBDR. SR[TXFULL] can be used to check if the buffer is ready to receive more data. At any time, TBSR[TRCTR] can be read to check how many words have been written into the TX buffer.

After writing to IPCR[SEQID] (see step 4), the module starts executing the programmed sequence . The software ensures that the correct sequence is programmed into the LUT in accordance with the flash memory connected to the module. The data is fetched from the TX buffer. It consists of 256 entries of 32-bit sizes and is organized as a circular FIFO, the read pointer for which is incremented after each fetch. When all the data is transmitted, the QuadSPI module returns from the busy state to the idle state. However, this is not true for the external device because the internal programming is still ongoing. You may monitor the relevant status information available from the serial flash memory device and ensure that the programming is done appropriately.

## 38.6.2.8 Flash memory read

Host access to the data stored in the external serial flash memory device is performed in two steps. First, the data must be read into the internal buffers and in the second step, these internal buffers can be read by the host.

## Reading serial flash memory data into the QuadSPImodule internal buffers

A read access to the external serial flash memory device can be triggered in two different ways:

- IP command read: For reading flash memory data into the RX buffer, you must provide the correct sequence ID in IPCR[SEQID]. The sequence ID points to a sequence in the LUT. The software needs to ensure that a correct read sequence is programmed in the LUT in accordance with the serial flash memory device connected on board. You must program the SFAR , SFACR[CAS], and IPCRs. All available read commands supported by the external serial flash memory are possible.

Optionally, it is possible to clear the RX buffer pointer prior to triggering the IP command by writing a 1 to MCR[CLR\_RXF]. This will invalidate the data currently present in the RX buffer and any new read data will overwrite the old one.

Using these inputs, the complete transaction is built when IPCR[SEQID] is written to The transaction related to the read access starts and the requested number of bytes is fetched from the external serial flash memory device into the RX buffer. As the read access is triggered by an IP command, the value of both SR[IP\_ACC] and SR[BUSY] is set to 1.. A count of the number of entries currently in the Rx buffer can be obtained from RBSR[RDBFL].

Communication with the external serial flash memory stops if the specified number of bytes are read (on successful completion of the transaction).

## NOTE

In case of external DQS strobe based sampling, read data size (IDATSZ or LUT size) must be in multiples of 8 bytes.

- AHB command read: For reading flash memory data into the AHB buffer, you must:
- Set up a read access by a master to the address range in the system memory map, which the external serial flash memory devices are mapped to.
- Write a desired value to SFACR[CAS], if required, or write 0 to the field.
- Program the buffer registers corresponding to the AHB master initiating the request.
- Provide the correct sequence ID in the BFGENCR. The software ensures that a correct read sequence is programmed in the LUT in accordance with the serial flash memory device connected on board. Flash memory device selection and access mode are determined by the address accessed in the AHB address space associated with the QuadSPI module

Quad Serial Peripheral Interface (QuadSPI)

(see Memory-mapped serial flash memory data-individual flash memory mode on flash memory A , Memory-mapped serial flash memory data-individual flash memory mode on flash memory B and Parallel flash memory mode.)

On each AHB read access to the memory mapped area, the valid data in the AHB buffer is checked against the address requested in the actual read. When the AHB read request cannot be served from the content of the AHB buffer, the buffer is flushed and the controller executes the sequence pointed to by the sequence ID. The requested number of buffer entries defined in BUFxCR[ADATSZ] is then fetched from the external serial flash memory device into the internal AHB buffer. As the read access is triggered through the AHB bus, the value of SR[AHB\_ACC] is set, driving SR[BUSY] in turn, until the transaction is complete. Communication with the external serial flash memory stops when the specified number of entries is filled.

## Data transfer from the QuadSPI module internal buffers

The data read out from the external serial flash memory device by the QuadSPI module is stored in the internal buffers. The means of accessing the data from the buffer differs depending on which buffer the data is loaded to. See Block diagram for details on the two available buffers, the RX buffer and the AHB buffer, in this module. The buffer appears transparent to you and is non-memory mapped. See the "Flexible AHB Buffer" section for details.

<!-- image -->

The RX buffer is implemented as FIFO of depth entries of 4 bytes. Its content is accessible in two different address areas, both referring to identical data and the same physical memory:

Quad Serial Peripheral Interface (QuadSPI)

- In the IPS address space in the area associated with RX Buffer Data Register (RBDR0 - RBDR63).
- In the AHB address space in the area associated with AHB RX Data Buffer Register (ARDB0 - ARDB127).Two successive entries are accessed with one single 64-bit AHB read operation.

The RX buffer operation can be summarized as follows:

- RBCT[WMRK] determines at which fill level SR[RXWE] is asserted and how many entries are removed from the RX buffer on each buffer POP operation.
- SR[RXWE] indicates that the configured number of data entries is available in the RX buffer and RBSR[RDBFL] indicates how many valid entries are available in total.
- The first entry (RBDR0 or ARDB0) always corresponds to the first valid entry in the RX buffer.

For details, see RX Buffer Data Register (RBDR0 - RBDR63) and AHB RX Data Buffer Register (ARDB0 - ARDB127).

- Flag-based data read of the RX buffer is performed by polling SR[RXWE]. When it is asserted, the valid entries can be read either via the IPS address space (RBDRn) or the AHB address space (ARDBn). A buffer POP operation must be triggered by the application by writing a 1 to FR[RBDF]. This automatically updates the FIFO to point to the next entry as defined by RBCT[WMRK]. For example, if WMRK is set to 3, then the buffer discards 16 bytes of data.
- DMA-controlled data read of the RX buffer is performed by using the DMA module. The application must ensure that the DMA controller of the related chip is programmed appropriately, as described in DMA usage.
- DMA-controlled read out is triggered fully automatically by the assertion of SR[RXWE]. The related buffer POP operation is also handled completely inside the QuadSPI module. As in the case explained here, accessing the RX buffer content either on RBDRn or ARDBn related addresses is equivalent.
- AHB buffer data read via memory-mapped access: This kind of access is performed by reading one of the addresses assigned to the external serial flash memory device(s) within the range specified in Table 216. If this is not the case, a memory-mapped AHB command read is triggered as described above. If the requested data is already available in the AHB buffer, it is provided directly to the host.

When an AHB access is made to the flash memory mapped address, the data is fetched and returned to the AHB interface. The AHB interface is stalled until the data is fetched. As soon as the data from the requested address is read by the QuadSPI module, the AHB read access is served. Therefore, it is possible to run sequential reads from the AHB buffer at arbitrary speed without the need to monitor any information about the availability of the data. Nevertheless, this access scheme stalls the AHB bus for the time required to read the data from the serial flash memory device. If you know that the access is sequential, a better way is to have a prefetch enabled by programming the value of BUFxCR[ADATSZ] so that the data is fetched into the buffer before the next sequential AHB access.

As long as the host restricts its accesses to the data present in the buffer and to the data currently fetched from the serial flash memory, it is possible to run the host read from the AHB buffer simultaneously with the serial flash memory read into the AHB buffer.

## 38.6.2.9 AHB write

This module supports a single master AHB write with these burst types - INCR4, INCR8, INCR16, and INCR unspecified 4n bytes and single 4n bytes - and these burst types are supported with all Hsizes. An AHB write transaction size can be expressed in multiples of 4 bytes, and a single transaction must have a minimum of 4 bytes.

The following restrictions apply to the QuadSPI module with respect to AHB write transactions:

- AHB transactions of WRAP* types are not supported. For these unsupported access types, the controller returns an error response and does not initiate any flash memory transaction.
- Back to back, fixed address AHB write is not supported.
- Early burst termination is not supported for AHB transactions.

The QuadSPI controller queues back-to-back AHB writes with continuous address and sends them in a single flash memory transaction. However, in case the AHB address of a burst is not in continuous addressing sequence to previous write burst, a new flash memory transaction is initiated.

Following is the programming sequence for an AHB write:

1. Check that SR[BUSY] is deasserted or is 0 and check that the TX buffer is empty. If there is any residue data present in the TX buffer(SR[TXNE]), the buffer must be cleared by writing '1'1 to MCR[CLR\_TXF].
2. Based on the type of flash memory device that is used for page programming, AWRCR[PPW\_WR\_DIS] and AWRCR[PPW\_RD\_DIS] need to be programmed.

The default reset value for both the fields is 0 and allows writing to flash memory device assuming a very low T pp (page program wait time) period. This period is very high for most of the flash memory devices. After any write to a flash memory device, the module waits for the write to finish before proceeding further.

This is controlled by the AWRCR[PPW\_WR\_DIS] and AWRCR[PPW\_RD\_DIS] field configurations.

3. Program the BFGENCR[SEQID] to point to the LUT where flash memory write sequence is stored.
4. AHB write master can now enable the transactions to be written to the flash memory. The AHB master must ensure data throughout to avoid underflow.
5. When a flash memory write completes and flash memory CS is deasserted, the software must poll SR[BUSY] for the deasserted value, which is 0. This indicates that the AHB write is complete. In case an underflow has occurred, flash memory CS is deasserted with (SR[TXNE])to know that an AHB write is pending with some residue data in the TX buffer.
6. Whenever flash memory CS is deasserted after an AHB write sequence, FR[PPWF] is set if any of AWRCR[PPW\_RD/ WR\_DIS] is enabled. FR[PPWF] disables any further flash memory read/write based on AWRCR[PPW\_RD]/ AWRCR[WR\_DIS]. After FR[PPWF] is set, it returns every incoming AHB transaction with an error response.
7. The software must clear FR[PPWF] to resume AHB transactions after the expiry of T pp period of flash memory. It can also send IPS read command to the flash memory for checking if T pp is over.
8. The software must ensure that the correct read and write LUT sequences are selected corresponding to the AHB read and write transactions. QuadSPI would malfunction if flash memory read sequence is selected during AHB write or vice versa.

## NOTE

An AHB error response occurs in case of AHB write if flash is not able to consume data at the rate master is writing in TX FIFO and TX FIFO eventually becomes full

## 38.6.2.10 Byte ordering of serial flash memory read data

The basic scheme is that the first byte read out of the serial flash memory device, which is addressed by SFAR[SFADR], corresponds to RBDR0[31:24] for IP command read. Similarly, to send a single byte it should be positioned in TBDR[0:7]. In contrast to that for AHB command read, the bytes are always positioned according to the byte ordering of the AHB bus.

- Byte ordering in individual flash memory mode

The following table provides the byte ordering scheme of how the byte oriented data space of the serial flash memory device is mapped into one single 32-bit entry of the RX buffer or the AHB buffer. The table is valid within the following context:

- Flash memory A or Flash memory B in individual flash memory mode
- All AHB data read commands with 32-bit access size

## Table 223. Byte ordering in individual flash memory mode

| Serial flash memory byte numbering                   | 3       | 2       | 1      | 0     |
|------------------------------------------------------|---------|---------|--------|-------|
| Buffer entry bit position [31:0] (32-bit data width) | [31:24] | [23:16] | [15:8] | [7:0] |

## NOTE

For IP commands, the read size can be specified as number of bytes. If this number is not a multiple of four, then the last buffer entry is not completely filled with the missing higher numbered bytes at undefined values.

Quad Serial Peripheral Interface (QuadSPI)

Quad Serial Peripheral Interface (QuadSPI)

For AHB commands and reads, starting from an address not aligned to 32-bit boundaries, the requested bytes are given at the appropriate positions according to the AMBA AHB specification.

- Byte ordering in parallel flash memory mode

In the parallel flash memory mode, each byte is combined out of two- half bytes that are read or written in parallel from the two serial flash memory devices. The following tables show how the flash memory content is separated into the half-bytes and how the half-bytes are included with the RBDR0 register.

Table 224. Serial flash memory device half-byte ordering

| Serial flash memory device byte #   | Flash memory A bit position   | Flash memory A bit position   | Flash memory B bit position   | Flash memory B bit position   |
|-------------------------------------|-------------------------------|-------------------------------|-------------------------------|-------------------------------|
|                                     | [7:4]                         | [3:0]                         | [7:4]                         | [3:0]                         |
| 0                                   | fah0                          | fal0                          | fbh0                          | fbl0                          |
| 1                                   | fah1                          | fal1                          | fbh1                          | fbl1                          |
| 2                                   | fah2                          | fal2                          | fbh2                          | fbl2                          |
| 3                                   | fah3                          | fal3                          | fbh3                          | fbl3                          |
| 4                                   | fah4                          | fal4                          | fbh4                          | fbl4                          |
| 5                                   | fah5                          | fal5                          | fbh5                          | fbl5                          |
| 6                                   | fah6                          | fal6                          | fbh6                          | fbl6                          |
| 7                                   | fah7                          | fal7                          | fbh7                          | fbl7                          |
| 8                                   | fah8                          | fal8                          | fbh8                          | fbl8                          |

The table entry naming reflects the half-byte positioning in the serial flash memory devices:

- &lt;fa&gt; h0 means Flash memory A, &lt;fb&gt;h0 means Flash memory B.
- fa&lt;h&gt;0 means half byte in high position, fa&lt;l&gt;o means half-byte in low position.
- fah&lt;0&gt; means physical byte address 0 in the serial flash memory device and fal&lt;1&gt; means physical byte address 1 in the serial flash memory device.

Table 225. Byte ordering in parallel flash memory mode - RX buffer

| SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   |
|-------------------------|-------------------------|-------------------------|-------------------------|-------------------------|-------------------------|-------------------------|-------------------------|-------------------------|
| RBDR0                   | fal1                    | fbl1                    | fah1                    | fbh1                    | fal0                    | fbl0                    | fah0                    | fbh0                    |
| ARDB0                   |                         |                         |                         |                         |                         |                         |                         |                         |
| RBDR1                   | fal3                    | fbl3                    | fah3                    | fbh3                    | fal2                    | fbl2                    | fah2                    | fbh2                    |
| ARDB1                   |                         |                         |                         |                         |                         |                         |                         |                         |
| SFAR[SFADR] set to 1h   | SFAR[SFADR] set to 1h   | SFAR[SFADR] set to 1h   | SFAR[SFADR] set to 1h   | SFAR[SFADR] set to 1h   | SFAR[SFADR] set to 1h   | SFAR[SFADR] set to 1h   | SFAR[SFADR] set to 1h   | SFAR[SFADR] set to 1h   |
| RBDR0                   | fal2                    | fbl2                    | fah2                    | fbh2                    | fal1                    | fbl1                    | fah1                    | fbh1                    |

Table continues on the next page...

## Table 225. Byte ordering in parallel flash memory mode - RX buffer (continued)

| ARDB0   |      |      |      |      |      |      |      |      |
|---------|------|------|------|------|------|------|------|------|
| RBDR1   | fal4 | fbl4 | fah4 | fbh4 | fal3 | fbl3 | fah3 | fbh3 |
| ARDB1   |      |      |      |      |      |      |      |      |

## NOTE

For IP commands, the read size can be specified as number of bytes. If this number is not a multiple of four, the last buffer entry is not completely filled with the missing higher numbered bytes at undefined values.

## Table 226. Byte ordering in parallel flash memory mode - TX buffer *

| SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   | SFAR[SFADR] set to 0h   |
|-------------------------|-------------------------|-------------------------|-------------------------|-------------------------|-------------------------|-------------------------|-------------------------|-------------------------|
| TBDR0                   | fal1                    | fbl1                    | fah1                    | fbh1                    | fal0                    | fbl0                    | fah0                    | fbh0                    |
| TBDR1                   | fal3                    | fbl3                    | fah3                    | fbh3                    | fal2                    | fbl2                    | fah2                    | fbh2                    |

## Table 227. Byte ordering in parallel flash memory mode - AHB buffer

| AHB address (32-bit access)   | fal1   | fbl1   | fah1   | fbh1   | fal0   | fbl0   | fah0   | fbh0   |
|-------------------------------|--------|--------|--------|--------|--------|--------|--------|--------|
| AHB address 800_0004h         | fal3   | fbl3   | fah3   | fbh3   | fal2   | fbl2   | fah2   | fbh2   |

## NOTE

For an AHB command read starting from an address not aligned to 32-bit boundaries or an AHB access size smaller than 32-bit, the requested bytes are given at the appropriate positions according to the AMBA AHB specification.

- Buffer entry ordering for 64-bit read access

For read access via the AHB interface, a 64-bit access is possible. Each 64-bit access reads two 32-bit entries, simultaneously. The ordering of these 32-bit entries within the 64-bit word is provided in the following table.

## Table 228. 64-bit read access buffer entry ordering

| AHB read data bit position [63:0]   | [63:32]            | [31:0]              |
|-------------------------------------|--------------------|---------------------|
| Buffer entry #                      | Odd (1, 3, 5, ...) | Even (0, 2, 4, ...) |

## 38.6.2.11 Normal mode interrupt and DMA requests

The QuadSPI module has different flags that can only generate interrupt requests and one flag that can generate an interrupt as well as DMA requests. The following table lists the eight conditions. Note that the flags mentioned in the table are associated with the Flag Register (FR).

Table 229. Interrupt and DMA request conditions

| Condition                                      | Flag (FR)   | DMA   |
|------------------------------------------------|-------------|-------|
| Data learn pattern failure                     | DLPFF       | -     |
| TX buffer fill                                 | TBFF        | -     |
| TX buffer underrun                             | TBUF        | -     |
| Illegal instruction error                      | ILLINE      | -     |
| RX buffer drain                                | RBDF        | X     |
| RX buffer overflow                             | RBOF        | -     |
| AHB buffer overflow                            | ABOF        | -     |
| AHB sequence error                             | ABSEF       | -     |
| AHB illegal transaction error                  | AITEF       | -     |
| AHB illegal burst size error                   | AIBSEF      | -     |
| IP command usage error                         | IUEF        | -     |
| IP command trigger during AHB access error     | IPAEF       | -     |
| IP command trigger could not be executed error | IPIEF       | -     |
| IP command related transaction finished        | TFF         | -     |

Each condition has a corresponding field in Flag Register (FR) and a request enable field in DMA Request Select and Enable Register (RSER). FR[RBDF] has separate enable fields for generating IRQ and DMA requests. Note that not all the fields have an individual IRQ line. See the chip's Interrupt Vector table for details.

- Transmit buffer fill interrupt request

This indicates that the TX buffer can accept new data. The buffer is asserted if FR[TBFF] is asserted and if the value of the corresponding enable field, RSER[TBFIE], is 1. See TX buffer Operation for details on the assertion of FR[TBFF].

Apart from IRQ, it is possible to handle the TX buffer fill by using the DMA. If the value of RSER[TBFDE] is 1, a DMA request is triggered when the number of available space in the TX buffer is more than the TBCT[WMRK] valid entries and value of SR[TXWA] is set. The application must configure the environment appropriately (for example, the DMA controller) for the DMA transfer.

- Receive buffer drain interrupt or DMA request

This is derived from FR[RBDF], indicating that the RX buffer of the QuadSPI module has data available from the serial flash memory device to be read by the host. It remains set as long as RBSR[RXWE] is configured. Also, RSER[RBDIE] enables the related IRQ.

Apart from the IRQ, it is possible to handle the RX buffer drain by using the DMA. If the value of RSER[RBDDE] is 1, a DMA request is triggered when the RX buffer contains more than RBCT[WMRK] valid entries. The application must set the environment appropriately (for example, the DMA controller) for the DMA transfers.

- Buffer overflow/underrun interrupt request

This is a combination of the following fields (all located in the Flag Register (FR) with the related enable bits in the DMA Request Select and Enable Register (RSER)):

- TBUF - TX buffer underrun, enabled by TBUIE
- RBOF - RX buffer overflow, enabled by RBOIE

- ABOF - AHB buffer overflow, enabled by ABOIE
- The transmit buffer underrun indicates that an underrun condition in the TX buffer has occurred. It is generated when a write instruction is triggered whilst the TX buffer is empty and the the value of RSER[TBUIE] is 1.
- The receive buffer overflow indicates that an overflow condition in the RX buffer has occurred. It is generated when the RX buffer is full, an additional read transfer attempts to write into the RX buffer, and the value of RSER[RBOIE] is 1.
- The AHB buffer overflow indicates that an overflow condition in the AHB buffer has occurred. It is generated when the AHB buffer is full, an additional read transfer attempts to write into the AHB buffer and the value of RSER[ABOIE] is 1.
- The data from the transfers that generated the individual overflow conditions is ignored.
- Serial flash memory command error interrupt request

If the IPAEF, IPIEF, or IUEF fields in the FR are set, and the related interrupt enable bits in the RSER are also set, then an interrupt is requested.

- Transaction finished interrupt request

The IP command transaction finished IRQ indicates the completion of the current IP command. It is triggered by FR[TFF] and is masked by RSER[TFIE].

## 38.6.2.12 TX buffer operation

The TX buffer provides the data used for page programming. For proper operation, it is required to provide at least one entry in the TX buffer prior to starting the execution of the page programming command. The application must ensure that the required number of data bytes is written into the TX buffer fast enough as long as the command is executed without a TX buffer overflow or underrun.

The QuadSPI module sets the FR[TBFF] field as long as the TX buffer is not full and can accept more data. At the end of write through TX buffer, you must clear FR[TBFF] to avoid unnecessary last TX buffer fill interrupt. However, there would always be a pending request asserted from QuadSPI controller at the end of any DMA transfer. When external DMA finishes transfer iteration, this request from QuadSPI is kept asserted for the next iteration loop.

## NOTE

Even if the generation of DMA requests for filling the TX buffer is disabled by using RSER[TBFDE], the TX buffer still accepts a DMA transfer because of the last asserted pending request.

Disabling of DMA transfer should be controlled by an external DMA master.

When the QuadSPI module tries to pull data out of an empty TX buffer, FR[TBUB] signals the TX buffer underrun. The TX buffer underrun flag is also asserted when the TX buffer contains less than 32-bits of data and the QuadSPI module tries to pull out data from it. The current IP command leading to the underrun condition is continued until the specified number of bytes is sent to the serial flash memory device. Also, the data that is transferred is in the Fs format. This means, after the underrun flag is set under this condition, it returns Fs until the required number of bytes are not sent. This has been done to ensure that the software does not erase the whole sector after underrun and just reprogramming from failure point serves the purpose. When this sequence command is complete, FR[TBFF] is asserted, indicating that the TX buffer is ready to be written again.

The TX buffer overflow is not signaled explicitly, but TBSR[TRBFL] can monitor the TX buffer fill level.

For more information, see TX Buffer Status Register (TBSR) and Flag Register (FR).

## 38.6.2.13 Address scheme

Earlier, serial flash memories supported only a 24-bit address space, restricting the maximum memory size of the serial flash memory to 16 MB. The new memory specification supports two types of 32-bit addressing mode in addition to the legacy 24-bit address mode. It also supports segregation of address programmed into Row address and Column address of the flash memory, as per the requirement.

## Extended address mode

In this mode, the legacy 24-bit commands are converted to accept 32-bit address commands. The flash memory needs to be configured for the 32-bit address mode. Also, while programming the LUT sequence in QuadSPI for 32-bit mode, the ADDR and

Quad Serial Peripheral Interface (QuadSPI)

Quad Serial Peripheral Interface (QuadSPI)

ADDR\_DDR commands should be programmed with 32d as the operand value with SFACR[CAS] programmed to 0. If a flash memory needs some bits of the address as its column address, then it must be considered that a total of 12 bits are required by the flash memory; however, the number of bits should not exceed 32 because the maximum address supported by QuadSPI is 32 bits.. Each of the memory vendors have a different way of enabling this mode (see the memory specification from memory vendors). For example, the command B7h sent to the Macronix flash memory enables it for the 32-bit address mode.

## Extended address register

In this mode, the upper 8 bits of the 32-bit register are provided by the Extended address register in the memory, which provides a specific register that is updated according to the address to be accessed. This effectively converts the legacy 24-bit address command into 32-bit address commands. The memories greater in size than 16 MB consist of banks of 16 MB each. The 8 bits occupied in the extended address register effectively enable a bank. For example, in Spansion memory, when the extended address register is updated with a value of 1h, with the help of the 17h command, it opens Bank1 of the memory. The consequent 24-bit address commands lead to Bank1. The extended address register needs to be updated with the respective value for access to other banks. This effectively converts the legacy 24-bit address command into 32-bit address commands.

## Separation of address into rows and columns

This mode has been introduced for flash memories that need addresses segregated into rows and columns. The value in SFACR[CAS] defines the width of the column address required by a flash memory. The actual address to be provided is derived from the incoming address in case of AHB-initiated transactions and the value of SFAR in case of IPS-initiated transactions, if the value of SFACR[CAS] is 0. Otherwise, the actual address takes CAS into consideration. If the value of SFACR[CAS] is 3, then bits 26-3 of the programmed address are sent to the flash memory as its page address. This is in case the flash memory is operating in a 24-bit mode and bits 2-0 are sent as its column address. If a flash memory requirement for column address is less than the number of pads in which address has to be sent, then QuadSPI appends the remaining bits by 0. You must program the operand value in CADDR and CADDR\_DDR command accordingly. It must be ensured that the total number of address bits requested by flash memory as its page and column address must not be more than 32 bits.

## Word addressable mode for flash memory

This mode has been introduced for flash memories, which have a word-addressable memory. This means, each address of the flash memory contains one word (two bytes) of data. The value of SFACR [WA] is configured to 1 to enter this mode. QuadSPI internally divides the incoming address in the AHB bus or the address in the SFAR to map it to a valid flash memory location. For example, if the incoming address is 2004h, the controller re-maps this address to access the flash memory location 1002h. If not in this mode, the incoming address 2004h is mapped to flash memory location 2004h.

## 38.6.2.14 OTFAD support

If OTFAD is enabled in the system, any reads from the QuadSPI are first decrypted by the OTFAD engine and then returned to the AHB bus. If OTFAD is enabled, the prefetch never crosses the 1 KB boundary.

## 38.6.3 Module Disable mode

Module Disable mode is a block-specific mode that the QuadSPI can enter to disable serial flash memory clock and AHB command. This mode can be entered by:

- The host software: by writing a '1' to MCR[MDIS]

Below are the condition that must be fulfilled to enter the Module Disable mode:

- SR[BUSY] = 0
- SR[AHBTRN] = 0
- RBSR[RDBFL] = 0
- SR[RXDMA] = 0
- SR[TXDMA] = 0
- None of the flags in FR are enabled as interrupts is set

The conditions mentioned above ensures the following:

- There is no SFM command currently being executed.
- All the data read into the RX buffer from the serial flash memory have been fetched by the application.
- There is no current AHB access.
- There is no active DMA request.
- There is no enabled interrupt that is pending.

Certain read or write operations have a different effect when the QuadSPI is in the Module Disable mode. In the Module Disable mode, not all of the status and flag bits of the QuadSPI module are updated, and writing to them has no effect. Interrupt and DMA request signals cannot be cleared while in the Module Disable mode.

## NOTE

It is illegal to issue a new SFM command starting two clock cycles prior to raising the request of entering the Module Disable mode until the QuadSPI stays in this mode.

## 38.6.4 Leaving Module Disable mode

In the Module Disable mode, the serial flash memory clock and AHB command to the QuadSPI module are switched off.

After the QuadSPI has left this mode and has returned to Normal mode, the execution of the first SFM command is deferred until the clock to drive that part of the module related to the serial flash memory device is available. Depending upon the point in time when the first SFM command is triggered, the actual execution of the command starts with a delay, respective with the re-enabling of the flash memory clock signal.

## 38.7 Initialization/application information

This section provides the initialization and application information of the QuadSPI module.

## 38.7.1 Power up and reset

The serial flash memory devices connected to the QuadSPI module might require special voltage characteristics of their inputs during power up or reset. The application must ensure this.

## CAUTION

Erase or program commands should be completed before issuing a reset or power cycle to avoid corrupted flash pages. The application shall ensure there is a backup of critical data stored at a different location to enable recovery from corrupted flash pages.

## Example: Flash reset sequence

Use the following sequence to reset flash A:

1. Make sure that the flash supports a reset for the condition CS#=high and IOF[3]=low.
2. Set MCR[SWRSTSD] and MCR[SWRSTHD] fields and then clear them.
3. Set MCR[MDIS] field.
4. Reset MCR[ISD3FA] field for flash A.
5. Clear MCR[MDIS] field.
6. Set MCR[MDIS] field.
7. Set MCR[ISD3FA] field for flash A.
8. Clear MCR[MDIS] field.

Quad Serial Peripheral Interface (QuadSPI)

## 38.7.2 Available status/flag information

This section provides an overview of the different flags and statuses available, and their interdependencies for different use cases. The SR and FR are the related registers.

## 38.7.2.1 IP commands

See IP Configuration Register (IPCR) for additional details not explicitly covered in this paragraph.

- IP commands-normal operation

Writing to IPCR[SEQID] triggers the execution of a new IP command. Given that this is a legal command, SR[IPACC] and SR[BUSY] are asserted simultaneously, immediately after the execution starts.

After the instruction on the serial flash memory device is complete, these field deassert and FR[TFF] is configured.

- IP commands-error situations

See Overview\_of\_Error\_Flags for details.

## 38.7.2.2 AHB commands

See the "Reading serial flash memory data into the QuadSPI module internal buffers" topic in theFlash Memory Read section for details.

- AHB commands-normal operation

Memory-mapped read access to a serial flash memory address not contained in the AHB buffer triggers the execution of an AHB command. Given that this is a legal command, SR[AHB\_ACC] and SR[BUSY] are asserted simultaneously, immediately after the execution starts. After the instruction on the serial flash memory device is complete, these fields are deasserted.

- IP commands-error situations

See Overview of FR error flags for details.

## 38.7.2.3 SFM commands

An SFM command consists of an instruction code and all other parameters (for example, size or mode bytes) needed for that specific instruction code. Triggering a command either initiates a transaction on the external serial flash memory or results in an error. See Table 230 for details on errors.

## 38.7.2.4 Overview of error flags

The following table provides an overview of the different error flags in the FR and additional error-related details.

Table 230. Overview of FR error flags

| Error category   | Error flag in FR   | Command execution on serial flash memory device TFF behavior (in case of IP commands only)   | Description                                                                                                                                                         |
|------------------|--------------------|----------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AHB error flag   | ABOF               | Flash memory transaction continues until it finishes                                         | Set when the module tries to push data into the AHB buffer that exceeds the size of the AHB buffer. Occurs only because of the wrong programming of BUFxCR[ADATSZ]. |
| AHB error flag   | AIBSEF             | Flash memory transaction is aborted                                                          | Total burst size of the AHB transaction is greater than prefetch data size.                                                                                         |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

Table 230. Overview of FR error flags (continued)

| Error category            | Error flag in FR   | Command execution on serial flash memory device TFF behavior (in case of IP commands only)   | Description                                                                                                                                                                                      |
|---------------------------|--------------------|----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AHB error flag            | AITEF              | Flash memory transaction is aborted                                                          | No response is generated from QuadSPI to AHB bus in case of illegal transaction. Also, the watchdog timer expires.                                                                               |
| Miscellaneous error flag  | DLPFF              | Flash memory transaction continues until it finishes                                         | Set when the DATA_LEARN instruction is encountered in a sequence but no sampling point is found for the data learning pattern.                                                                   |
| Miscellaneous error flag  | ILLINE             | Flash memory transaction aborted                                                             | Illegal instruction error flag - set when an illegal instruction is encountered by the controller in any of the sequences.                                                                       |
| Command arbitration error | IPIEF              | TFF not asserted in conjunction with that command                                            | IP command error - caused when IP access is currently in progress (IP_ACC is set) and during: • Write attempt to IPCR register • Write attempt to SFAR register • Write attempt to RBCT register |
| Command arbitration error | IPAEF              | TFF not asserted in conjunction with that command                                            | • AHB command already running, another IP command could not be executed • AHB command already running, write attempt to IPCR[SEQID]                                                              |
| IP command error          | IUEF               | -                                                                                            | • IP command usage error                                                                                                                                                                         |
| Buffer-related error      | RBOF               | TFF is asserted on completion                                                                | • RX buffer overrun                                                                                                                                                                              |
| Buffer-related error      | TBUF               | TFF is asserted on completion                                                                | • TX buffer underrun                                                                                                                                                                             |

Note that only the buffer-related errors are associated with a transaction on the external serial flash memory. All the other errors do not trigger an actual transaction.

## 38.7.2.5 IP bus and AHB access command collisions

There are following flags related to this topic: FR[IPAEF] and FR[IPIEF]. See the "Reading serial flash memory data into the QuadSPI module internal buffers" topic of the Flash Memory read section for a description of the flags.

## 38.7.3 Flash memory device selection

Regardless of the SFM command (IP or AHB), the access mode is selected by specifying the 32-bit address value for the following SFM command.

Quad Serial Peripheral Interface (QuadSPI)

For IP commands, the access mode is selected with the address programmed into the SFAR register. See Serial Flash Address Register (SFAR) for details.

For AHB commands, the access mode is determined by the memory-mapped address. See AMBA Bus Register Memory Map for details.

## 38.7.4 DMA usage

For a complete description of the DMA module, see the related DMA Controller chapter. This section only provides QuadSPIspecific DMA usage details.

## 38.7.4.1 DMA usage in normal mode

## 38.7.4.1.1 Bandwidth considerations

Careful consideration of the throughput rate of the entire chain (serial flash memory -&gt; AHB bus / IP bus -&gt; DMA controller) involved in the read/write data process is essential for a proper operation. Such analysis must take into account not only the data rate provided by the serial flash memory but also the data rate of the AHB bus and the performance of the DMA controller in reading/writing data from/to the RX/TX buffer.

Two figures must match for a proper operation, which means that the data rate provided by the serial flash memory device must not exceed the average RX buffer readout data rate. Otherwise, the longer this state persists, it results into an RX buffer overflow. Similarly, the data consumed by the serial flash memory device must not exceed the average TX buffer fill rate. If this persists, it leads to an underrun.

## AHB bus side (data read)

The total number of bus cycles for each DMA minor loop completion is added from the following components:

The following table provides certain examples for typical use cases:

Case 1: DMA needs to read 4 bytes from SRAM and provide to QuadSPI. It costs total four bus clock cycles. Then, DMA handshake adds additional six bus clock cycles, resulting in a total of [6 + 4 * (32/4) = 38] bus clock cycles.

Table 231. Access duration examples for bus clock side

|   TBCT[WMRK] |   Number of bytes per DMA loop | Number of bus clock cycles for DMA minor loop   | Time duration of DMA minor loop for 60 MHz bus clock frequency   |
|--------------|--------------------------------|-------------------------------------------------|------------------------------------------------------------------|
|            3 |                             16 | 6+(16/4)*4 = 22                                 | ~366ns                                                           |
|            7 |                             32 | 6+(32/4)*4 = 38                                 | ~633ns                                                           |
|           11 |                             48 | 6+(48/4)*4 = 54                                 | ~900ns                                                           |
|           15 |                             64 | 6+(64/4)*4 = 70                                 | ~1166ns                                                          |

Case 2: DMA needs to read 32 bytes from SRAM and provide to QuadSPI. DMA handshake takes an additional six bus cycles, with 32 bytes DMA read from SRAM costs (8 + 3) core clock cycles. DMA writes 32 bytes to QuadSPI, takes 2 * (32/4) = 16 bus cycles with one additional CPU access to QuadSPI, costing two bus clock cycles. This results in a total 6 + (8+3)/2 + 2 * (32/4) +2 = 30 bus clock cycles.

Table 232. Access duration examples for bus clock side

|   TBCT[WMRK] |   Number of bytes per DMA loop > | Number of bus clock cycles for DMA minor loop   | Time duration of DMA minor loop for 80 MHz bus clock frequency   |
|--------------|----------------------------------|-------------------------------------------------|------------------------------------------------------------------|
|            3 |                               16 | 6 + (4+3) /2 + (16/4)*2 + 2 = 20                | ~333ns                                                           |
|            7 |                               32 | 6 + (8+3) /2 + (32/4)*2 + 2 = 30                | ~500ns                                                           |
|           11 |                               48 | 6 + (4+3)/2*3 + (48/4)*2 + 2 = 44               | ~733ns                                                           |
|           15 |                               64 | 6 + (8+3) + (64/4)*2 + 2 = 51                   | ~810ns                                                           |

## NOTE

This table figure represents an ideal scenario; actual performance depends on how the chip integrates DMA and QuadSPI modules.

## Serial flash memory device side (data read)

The number of serial flash memory cycles can be determined in the following way:

- Number of serial flash memory clock cycles is required to read 4 bytes, corresponding to one RX buffer entry (setup of command and address not considered): two cycles for quad DDR mode instructions in the parallel flash memory mode, two cycles for the Octal DDR mode in the individual flash memory mode, four cycles for quad (SDR) mode instruction in the parallel flash memory mode, or dual IO DDR mode instruction in the parallel flash memory mode, eight cycles for quad mode (SDR) instructions in individual flash memory mode, and so on.
- Overhead because of clock domain crossing: one cycle

The following table lists the number of clock cycles required to read the data from the serial flash memory corresponding to the different settings of RBCT[WMRK]:

Table 233. Access duration examples for serial flash memory side

| RBCT[WMRK ] setting   | Num bytes per DMA loop 1   | Num SCKFx for 80 MHz SCKFx   | Num SCKFx for 80 MHz SCKFx   | Num SCKFx for 80 MHz SCKFx    | Time duration of flash memorydata readout for 80 MHz SCKFx (~12.5ns period)   | Time duration of flash memorydata readout for 80 MHz SCKFx (~12.5ns period)   | Time duration of flash memorydata readout for 80 MHz SCKFx (~12.5ns period)   |
|-----------------------|----------------------------|------------------------------|------------------------------|-------------------------------|-------------------------------------------------------------------------------|-------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
|                       |                            | IFM 2 quad                   | IFM quad DDR                 | PFM 3 quad DDR/ IFM octal DDR | IFM quad                                                                      | IFM quad DDR                                                                  | PFM quad DDR                                                                  |
| 0                     | 4                          | 8                            | 4                            | 2                             | ~100ns                                                                        | ~50ns                                                                         | ~25ns                                                                         |
| 1                     | 8                          | 16                           | 8                            | 4                             | ~200ns                                                                        | ~100ns                                                                        | ~50ns                                                                         |
| 3                     | 16                         | 32                           | 16                           | 8                             | ~400ns                                                                        | ~200ns                                                                        | ~100ns                                                                        |
| 7                     | 32                         | 64                           | 32                           | 16                            | ~800ns                                                                        | ~400ns                                                                        | ~200ns                                                                        |

1. DMA loop refers to one minor loop completion that is equivalent to one major loop iteration.
3. Parallel flash memory mode
2. Individual flash memory mode

## NOTE

The table figure represents an ideal scenario; actual performance depends on how the chip integrates with DMA and QuadSPI modules.

Quad Serial Peripheral Interface (QuadSPI)

From the examples given in the two tables above, it can be seen that depending on the relationship between the bus clock and serial flash memory clock frequencies, you could perform certain settings where the serial flash memory provides the read data faster than the AHB bus can read out the RX buffer. In the tables provided above, it is the case of PFM quad DDR mode with watermark up to three and other cases. In these cases, the RX buffer data keeps accumulating over time and eventually overflows. To avoid RX buffer overflow, the data transaction size should be small enough.

A complementary example is when the watermark is set to be too high. In such a case, the time taken by the DMA to read out the RX buffer entries should be lesser than the time taken by the controller to push in the remaining entries in the buffer.

## IPS bus side (data write)

The total number of bus cycles for each DMA minor loop completion are added from the following components:

- Overhead for each minor loop, given by DMA controller: assume 10 cycles
- Overhead because to clock domain crossing: assume two cycles
- Number of bus clock cycles required for 16 bytes (128-bit write size): assume four cycles (read/write sequence of DMA controller)

Note that the size of the minor loop is determined by the size of TBCT[WMRK]; therefore, the overhead specified above distributes among (TBCT[WMRK]+1) write accesses of 32-bit each.

The following table provides some examples for typical use cases:

Table 234. Access duration examples for bus clock side

|   TBCT[WMRK] |   Number of bytes per DMA loop 1 | Number of bus clock cycles for DMA minor loop   | Time duration of DMA minor loop for 80 MHz bus clock frequency   |
|--------------|----------------------------------|-------------------------------------------------|------------------------------------------------------------------|
|            3 |                               16 | 12+4 = 16                                       | ~200ns                                                           |
|            7 |                               32 | 12+8 = 20                                       | ~250ns                                                           |

## NOTE

The table figure represents an ideal scenario; actual performance depends on how the chip integrates with DMA and QuadSPI modules.

## Serial flash memory device side (data write)

The number of serial flash memory cycles can be determined in the following way:

- Number of serial flash memory clock cycles required to write 16 bytes, corresponding to four TX buffer entry (setup of command and address not considered): Eight cycles for Octal DDR mode instructions in individual flash memory mode, 32 cycles for quad SDR writes in individual flash memory mode and 64 cycles in single IO SDR writes in parallel flash memory mode.
- Overhead due to clock domain crossing: one cycle

The following table lists the number of clock cycles required to read the data from the serial flash memory corresponding to the different settings of TBCT[WMRK]:

Table 235. Access duration examples for serial flash memory side

| TBCT[W MRK] setting   | Num bytes per DMA loop 1   | Num SCKFx   | Num SCKFx     | Num SCKFx            | Time duration for consuming data at flash memory interface 100 MHz SCKFx (10ns period) 2   | Time duration for consuming data at flash memory interface 100 MHz SCKFx (10ns period) 2   | Time duration for consuming data at flash memory interface 100 MHz SCKFx (10ns period) 2   | Time for fifo to get empty 3   | Time for fifo to get empty 3   | Time for fifo to get empty 3   |
|-----------------------|----------------------------|-------------|---------------|----------------------|--------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|--------------------------------|--------------------------------|--------------------------------|
|                       |                            | IFM 4 quad  | IFM octal DDR | 5 single IO SDR mode | IFM quad                                                                                   | IFM octal DDR                                                                              | PFM single IO SDR                                                                          | IFM quad                       | IFM octal DDR                  | PFM Single IO SDR              |
| 3                     | 16                         | 32          | 8             | 64                   | 320ns                                                                                      | 80ns                                                                                       | 640ns                                                                                      | 2240ns                         | 560ns                          | 4480ns                         |
| 7                     | 32                         | 64          | 16            | 128                  | 640ns                                                                                      | 160ns                                                                                      | 1280ns                                                                                     | 1920ns                         | 480ns                          | 3840ns                         |

1. DMA loop refers to one minor loop completion that is equivalent to one major loop iteration.
3. The assumption for these timings is that the TX Fifo is full when the transaction is initiated.
2. Not all flash memory devices support writes at 100 MHz. See the flash memory data sheet for the actual page program frequency supported.
4. Individual flash memory mode
5. Parallel flash memory mode

## NOTE

The tables mentioned above are only examples which must be correlated with the DMA in the system.

Considering the examples provided in the two tables above for TX FIFO, it is evident that depending on the relationship between the bus clock and serial flash memory clock frequencies, there are settings possible where the serial flash memory consumes data faster than the IPS bus can write data in TX buffer. In these cases, a TX buffer underrun situation occurs. To avoid TX buffer underrun, the data transaction size should be large enough.

## 38.7.5 Flash memory devices address mapping

You can configure QuadSPI in following modes for the supported flash memory ports A and B:

- Single mode
- Serial mode
- Parallel mode

The sizes of the flash memory devices are mapped with the system memory space based on the configurations of the following registers:

- SFA1AD
- SFA2AD
- SFB1AD
- SFB2AD

The total memory region for the flash memory devices is mapped between QuadSPI\_AMBA\_BASE and TOP\_ADDR\_MEMB2 such that the corresponding CS is asserted based on SFA1AD, SFA2AD and SFB1AD register configurations.

## 38.7.5.1 Single mode

For single mode configuration, you must write the same value to SFB1AD and SFB2AD registers that you write to the SFA2AD register.

For dual-die flash memories, the values you write to SFB1AD and SFB2AD registers corresponds to the mapped top addresses of each die.

For single-die flash memories, you must write the same value to SFA2AD register that you write to the SFA1AD register.

Following is a programming example for single mode single-die flash memory:

- QuadSPI\_AMBA\_BASE - 1000\_0000h
- SFA1AD[TPADA1] - 2000\_0000h
- SFA2AD[TPADA2] - 2000\_0000h
- SFB1AD[TPADB1] - 2000\_0000h
- SFB2AD[TPADB2] - 2000\_0000h

The following figure illustrates the memory mapping for single mode QuadSPI configuration.

<!-- image -->

## 38.7.5.2 Serial mode

For serial mode configuration, you must write the same value to SFB1AD and SFB2AD registers that you write to the SFA2AD register.

For dual-die flash memories, the values you write to SFA1AD and SFA2AD registers corresponds to the mapped top addresses of each die.

For single-die flash memories, you must write the same value to SFA2AD register that you write to the SFA1AD register.

Following is a programming example for serial mode single-die flash memory:

- QuadSPI\_AMBA\_BASE - 1000\_0000h
- SFA1AD[TPADA1] - 2000\_0000h
- SFA2AD[TPADA2] - 2000\_0000h
- SFB1AD[TPADB1] - 3000\_0000h
- SFB2AD[TPADB2] - 3000\_0000h

The following figure illustrates the memory mapping for serial mode QuadSPI configuration.

<!-- image -->

Quad Serial Peripheral Interface (QuadSPI)

## 38.7.5.3 Parallel mode

QuadSPI can access two flash memories in parallel. This increases the throughput of the QuadSPI by two times. Only read operations and x1 mode write are allowed in this mode. In case a write transaction is initiated with more than one pad in the Parallel mode, the value of FR[IUEF] is set. When dual-die flash memories are accessed in the Parallel mode, it is mandatory for flash memory A1 to be the same size as B1 and A2 to be the same size as B2. The following figure shows how QuadSPI maps the incoming addresses to the different flash memories connected on board.

<!-- image -->

Following is a programming example for parallel mode access (flash memory sizes are assumed to be 256 MB):

- QuadSPI\_AMBA\_BASE - 1h
- SFA1AD[TPADA1] - 2h
- SFA2AD[TPADA2] - 3h
- SFB1AD[TPADB1] - 4h
- SFB2AD[TPADB2] - 5h

To access the first location of the A1/B1 pair, the incoming address should be 1h. QuadSPI\_AMBA\_BASE is subtracted from this address and the result is divided by two. Therefore, addresses are provided to flash memories A1 and B1.

Flash memory address = memory mapped address - QuadSPI\_AMBA\_BASE/2

For memory-mapped address:

- 1000\_0000h, flash memory address: 0h (or, the first address of flash memories A1 and B1)
- 1000\_0004h, flash memory address: 2h
- 1000\_0008h, flash memory address: 4h, and so on.

Similarly, to access the first location of the A2/B2 pair, the incoming address should be 3h.

Flash memory address = memory mapped address - SFA2AD/2

For memory-mapped address:

- 0h, flash memory address: 0h (or, the first address of flash memories A2 and B2)
- 4h, flash memory address: 2h
- 8h, flash memory address: 4h, and so on.

Quad Serial Peripheral Interface (QuadSPI)

Quad Serial Peripheral Interface (QuadSPI)

<!-- image -->

The software must ensure that when multiple flash memories are used, accesses should never cross a boundary between separate flash memory devices. For example, in the figure provided above, for Serial mode, accesses must not cross the A1 to A2, A2 to B1, or B1 to B2 boundaries. For Parallel mode, accesses must not cross the A1+B1 to A2+B2 boundaries. The software can manage this using the following methods:

- Reduce the data fetch amount of the AHB buffers to 64 bit so that no prefetch occurs. This prevents any legal access from crossing the boundary.
- Reserve a memory region, if prefetch is enabled, to the maximum size of the prefetch, prior to the boundary. As long as no accesses are made to this region of the memory, no access crosses the boundary.
- Ensure that cache does not prefetch across the boundary.

## 38.8 Byte ordering - endianness

The following topics show the byte ordering in 64-bit LE configuration for AHB buffer and 32-bit LE for TX/RX buffer.

## 38.8.1 Programming flash memory data

CPU writes instructions to the TBDR register, such as:

- Write TBDR: 4\_03\_02\_01h
- Write TBDR: 8\_07\_06\_05h

The following table shows the content against each TX buffer entry.

Table 236. Example of QuadSPI TX buffer

|   TX buffer entry | Content     |
|-------------------|-------------|
|                 0 | 4_03_02_01h |
|                 1 | 8_07_06_05h |

Programming the TX buffer into the external serial flash memory device results in the following byte order to be sent to the serial flash memory:

- 01...02...03...04...05...06...07...08

## 38.8.2 Reading flash memory data into the RX buffer

Reading the content from the same address provides the following sequence of bytes, identical to the write case:

- 01...02...03...04...05...06...07...08

The following table shows the content against each TX buffer entry.

## Table 237. Resulting RX buffer content

|   RX buffer entry | Content     |
|-------------------|-------------|
|                 0 | 4_03_02_01h |
|                 1 | 8_07_06_05h |

## 38.8.2.1 Readout of the RX buffer through RBDRn

The RX buffer content appears at CPU read access through the peripheral bus interface in the following order:

- Read RBDR0: 4\_03\_02\_01h

- Read RBDR1: 8\_07\_06\_05h

## 38.8.2.2 Readout of the RX buffer through ARDBn

The RX buffer content appears at read access on the AMBA AHB interface at the QuadSPI module boundary:

- 32-bit access: Read ARDB0: 4\_03\_02\_01h

- 32-bit access: Read ARDB1: 8\_07\_06\_05h

- 64-bit access: Read ARDB0: 8\_07\_06\_05\_04\_03\_02\_01h

## 38.8.3 Reading flash memory data into the AHB buffer

Reading the content from the same address as it was written to provides the following sequence of bytes, identical to the write case:

- 01...02...03...04...05...06...07...08

The following table shows the content against each TX buffer entry.

## Table 238. Resulting AHB buffer content

|   AHB buffer entry | Content                 |
|--------------------|-------------------------|
|                  0 | 8_07_06_05_04_03_02_01h |

## 38.8.3.1 Readout of the AHB buffer through memory-mapped read

The AHB buffer content appears at read access on the AMBA AHB interface at the QuadSPI module boundary:

- 32-bit read access: 4\_03\_02\_01h

- 32-bit read access: 8\_07\_06\_05h

- 64-bit read access: 8\_07\_06\_05\_04\_03\_02\_01h

## 38.9 Driving flash memory control signals in single and dual modes

In single and dual modes, the serial flash memory devices that can connect to the QuadSPI module expect additional control signals on the inputs, which are connected to IOFA[3], IOFA[2], IOFB[3], and IOFB[2] in the quad mode. For easy interfacing, the outputs IOFA[3:2] for flash memory A and the IOFB[3:2] for flash memory B are driven to the logic state given by the configuration fields MCR[ISD3FA], MCR[ISD2FA], MCR[ISD3FB], and MCR[ISD2FB].

These outputs are driven all the time to the logic level programmed in the MCR except the time when quad commands of the serial flash memory are executed. See the specifications of the related serial flash memory device for details about the inactive level.

## 38.10 Serial flash memory devices

Several different vendors make flash memory devices with a QuadSPI interface. At present, there is no set standard for the QuadSPI instruction set. The most common commands currently have the same instruction code for all vendors; however, some commands are unique to specific vendors. Some of the example sequences are provided in the following sections.

## 38.10.1 Example sequences

This section provides the example sequences of the QuadSPI module.

Table 239. Exit 4 x I/O read enhance performance mode (XIP) (Macronix) and read status

| Instruction   | Pad   | Operand   | Description                            |
|---------------|-------|-----------|----------------------------------------|
| CMD           | 0h    | EBh       | 4xIO read command                      |
| ADDR          | 2h    | 18h       | 24-bit address to be sent on four pads |
| MODE          | 2h    | 0h        | 2 mode cycles (exit XIP)               |
| DUMMY         | 0h    | 4h        | 4 dummy cycles                         |
| READ          | 2h    | 8h        | Read 64 bits                           |
| CMD           | 0h    | 5h        | Read Status register                   |
| READ          | 0h    | 1h        | Status register data                   |
| STOP          | 0h    | 0h        | Stop, instruction over                 |

## 38.10.1.1 Read command (hyperflash memory)

This section provides the read command sequences (hyperflash memory) of the QuadSPI module.

Table 240. Read command (hyperflash memory)

| Instruction   | Pad   | Operand   | Comment                                                  |
|---------------|-------|-----------|----------------------------------------------------------|
| CMD_DDR       | 3h    | A0h       | Read command with continuous burst type                  |
| ADDR_DDR      | 3h    | 18h       | 24-bit row address                                       |
| CADDR_DDR     | 3h    | 10h       | 16-bit column address with lower 3 bits valid and rest 0 |
| Dummy         | 3h    | 0hF       | 15 dummy cycles                                          |
| READ_DDR      | 3h    | 4h        | 32-bit data read on 8 pads                               |
| STOP          | 3h    | 0h        | Stop, instruction over                                   |

Hyperflash memory is a word addressable flash memory. This means that each address accesses a word-wide (two-byte) data value. The software should ensure that when Hyperflash memory is connected to the controller, the value of SFACR[WA] must be 1. With this value, the controller remaps a byte addressable access to a word addressable access.

## 38.10.1.2 Read status register (hyperflash memory)

This section provides details related to the read status register of the QuadSPI module.

Quad Serial Peripheral Interface (QuadSPI)

Table 241. Read status register (hyperflash memory)

| Instruction   | Instruction sequence                           | Pad   | Operand   | Description                                                                        |
|---------------|------------------------------------------------|-------|-----------|------------------------------------------------------------------------------------|
| CMD_DDR       | Read Pre Command                               | 3h    | 0h        | Write command with wrapped burst type                                              |
| ADDR_DDR      | Read Pre Command                               | 3h    | 18h       | 24-bit row address (0000AAh)                                                       |
| CADDR_DDR     | Read Pre Command                               | 3h    | 10h       | 16-bit column address with lower 3 bits valid and rest 0(0005h) treated as command |
| CMD_DDR       | Read Pre Command                               | 3h    | 0h        | Write command with wrapped burst type                                              |
| CMD_DDR       | Read Pre Command                               | 3h    | 70h       | Write data to be sent to flash memory as pre- command                              |
| CMD_DDR       | Command phase (fourth/final chip select phase) | 3h    | A0h       | Read command with continuous burst type                                            |
| ADDR_DDR      | Command phase (fourth/final chip select phase) | 3h    | 18h       | 24-bit row address                                                                 |
| CADDR_DDR     | Command phase (fourth/final chip select phase) | 3h    | 10h       | 16-bit column address with lower 3 bits as valid and rest 0                        |
| DUMMY         | Command phase (fourth/final chip select phase) | 3h    | 0hF       | 15 dummy cycles                                                                    |
| READ_DDR      | Command phase (fourth/final chip select phase) | 3h    | 4h        | 32-bit data read on 8 pads                                                         |
| STOP          | Command phase (fourth/final chip select phase) | 3h    | 0h        | Stop, instruction over                                                             |

## 38.10.1.3 Word program (hyperflash memory)

This section provides the word program (hyperflash memory) of the QuadSPI module.

Table 242. Word program (hyperflash memory)

| Instruction   | Instruction sequence                        | Pad   | Operand   | Description                             |
|---------------|---------------------------------------------|-------|-----------|-----------------------------------------|
| CMD_DDR       | Unlock sequence 1 (first chip select phase) | 3h    | 0h        | Write command with wrapped burst type   |
| CMD_DDR       | Unlock sequence 1 (first chip select phase) | 3h    | 0h        | 8-bit address 00h treated as command    |
| CMD_DDR       | Unlock sequence 1 (first chip select phase) | 3h    | 0h        | 8-bit address 00h treated as command    |
| CMD_DDR       | Unlock sequence 1 (first chip select phase) | 3h    | AAh       | 8-bit address AAh treated as command    |
| CADDR_DDR     | Unlock sequence 1 (first chip select phase) | 3h    | 10h       | 16-bit column address with lower 3 bits |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

Table 242. Word program (hyperflash memory) (continued)

|           |                                               |    |     | valid and rest 0(0005h) treated as command                                         |
|-----------|-----------------------------------------------|----|-----|------------------------------------------------------------------------------------|
| CMD_DDR   |                                               | 3h | 0h  | Write command with wrapped burst type                                              |
| CMD_DDR   |                                               | 3h | AAh | Write data to be sent to flash memory as pre- command                              |
| CMD_DDR   | Unlock sequence 2 (second chip select phase)  | 3h | 0h  | Write command with wrapped burst type                                              |
| CMD_DDR   | Unlock sequence 2 (second chip select phase)  | 3h | 0h  | 8-bit address 00h treated as command                                               |
| CMD_DDR   | Unlock sequence 2 (second chip select phase)  | 3h | 0h  | 8-bit address 00h treated as command                                               |
| CMD_DDR   | Unlock sequence 2 (second chip select phase)  | 3h | 55h | 8-bit address 55h treated as command                                               |
| CADDR_DDR | Unlock sequence 2 (second chip select phase)  | 3h | 10h | 16-bit column address with lower 3-bits valid and rest 0(0002h) treated as command |
| CMD_DDR   | Unlock sequence 2 (second chip select phase)  | 3h | 0h  | Write command with wrapped burst type                                              |
| CMD_DDR   | Unlock sequence 2 (second chip select phase)  | 3h | 55h | Write data to be sent to flash memory as pre- command                              |
| CMD_DDR   | Program setup phase (third chip select phase) | 3h | 0h  | Write command with wrapped burst type                                              |
| CMD_DDR   | Program setup phase (third chip select phase) | 3h | 0h  | 8-bit address 00h treated as command                                               |
| CMD_DDR   | Program setup phase (third chip select phase) | 3h | 0h  | 8-bit address 00h treated as command                                               |
| CMD_DDR   | Program setup phase (third chip select phase) | 3h | AAh | 8-bit address AAh treated as command                                               |
| CADDR_DDR | Program setup phase (third chip select phase) | 3h | 10h | 16-bit column address with lower 3 bits valid and rest 0(0005h) treated as command |
| CMD_DDR   | Program setup phase (third chip select phase) | 3h | 0h  | Write command with wrapped burst type                                              |
| CMD_DDR   | Program setup phase (third chip select phase) | 3h | A0h | Write data to be sent to flash memory as pre- command                              |

Table continues on the next page...

Quad Serial Peripheral Interface (QuadSPI)

## Table 242. Word program (hyperflash memory) (continued)

| CMD_DDR   | Command phase (fourth/final chip select phase)   | 3h   | 0h   | Write command with wrapped burst type                          |
|-----------|--------------------------------------------------|------|------|----------------------------------------------------------------|
| ADDR_DDR  | Command phase (fourth/final chip select phase)   | 3h   | 18h  | 24-bit row address                                             |
| CADDR_DDR | Command phase (fourth/final chip select phase)   | 3h   | 10h  | 16-bit column address with lower 3 bits as valid and rest as 0 |
| WRITE_DDR | Command phase (fourth/final chip select phase)   | 3h   | 2h   | 2-byte data written on 8 pads (D1D2)                           |
| STOP      | Command phase (fourth/final chip select phase)   | 3h   | 0h   | Stop, instruction over                                         |

## 38.10.1.4 Fast read sequence (Macronix/Numonyx/Spansion/Winbond)

The following table shows the fast read sequence for Macronix/Numonyx/Spansion/Winbond flash memories.

## Table 243. Fast read sequence

| Instruction   | Pad   | Operand   | Description                           |
|---------------|-------|-----------|---------------------------------------|
| CMD           | 0h    | Bh        | Fast read command = 0Bh               |
| ADDR          | 0h    | 18h       | 24 address bits to be sent on one pad |
| DUMMY         | 0h    | 8h        | Eight dummy cycles                    |
| READ          | 0h    | 4h        | Read 32 bits on one pad               |
| JMP_ON_CS     | 0h    | 0h        | Jump to instruction 0 (CMD)           |

## NOTE

If DLL is disabled then JMP\_ON\_CS or STOP instruction can be used else only STOP instruction can be used.

## 38.10.1.5 Fast dual I/O DT read sequence (Macronix)

The following table shows the fast dual I/O DT read sequence for Macronix flash memories.

Table 244. Fast dual I/O DT read sequence

| Instruction   | Pad   | Operand   | Description                                                                                     |
|---------------|-------|-----------|-------------------------------------------------------------------------------------------------|
| CMD           | 0h    | BDh       | Fast dual I/O DT read command = BDh                                                             |
| ADDR_DDR      | 1h    | 18h       | 24 address bits to be sent on two pads in the DDR mode                                          |
| MODE4_DDR     | 1h    | 0h        | P2=P0 or P3=P1 is necessary. See the Macronix data sheet for details. One clock cycle for mode. |
| DUMMY         | 0h    | 6h        | Six dummy cycles                                                                                |
| READ_DDR      | 1h    | 4h        | Read 32 bits on two pads in the DDR mode                                                        |

Table continues on the next page...

## Table 244. Fast dual I/O DT read sequence (continued)

| Instruction   | Pad   | Operand   | Description                 |
|---------------|-------|-----------|-----------------------------|
| JMP_ON_CS     | 0h    | 0h        | Jump to instruction 0 (CMD) |

## NOTE

If DLL is disabled then JMP\_ON\_CS or STOP instruction can be used else only STOP instruction can be used.

## 38.10.1.6 Fast read quad output (Winbond)

The following table shows the fast read quad output sequence for Winbond memories

## Table 245. Fast read quad output sequence

| Instruction   | Pad   | Operand   | Description                           |
|---------------|-------|-----------|---------------------------------------|
| CMD           | 0h    | 6Bh       | Fast read quad output command = 6Bh   |
| ADDR          | 0h    | 18h       | 24 address bits to be sent on one pad |
| DUMMY         | 0h    | 8h        | Eight dummy cycles                    |
| READ          | 2h    | 4h        | Read 32 bits on four pads             |
| JMP_ON_CS     | 0h    | 0h        | Jump to instruction 0 (CMD)           |

## NOTE

If DLL is disabled then JMP\_ON\_CS or STOP instruction can be used else only STOP instruction can be used.

## 38.10.1.7 4 x I/O read enhance performance mode (XIP) (Macronix)

The following table shows the 4 x I/O read enhance performance mode for Macronix flash memories. The enhanced performance mode is also known as XIP mode.

Table 246. Fast read quad output sequence

| Instruction   | Pad   | Operand   | Description                             |
|---------------|-------|-----------|-----------------------------------------|
| CMD           | 0h    | EBh       | 4xI/O read command = EBh                |
| ADDR          | 2h    | 18h       | 24 address bits to be sent on four pads |
| MODE          | 2h    | A5h       | Two mode cycles                         |
| DUMMY         | 0h    | 4h        | Four dummy cycles                       |
| READ          | 2h    | 4h        | Read 32 bits on four pads               |
| JMP_ON_CS     | 0h    | 1h        | Jump to instruction 1 (ADDR)            |

When in XIP mode, the software must ensure that all the flash memories connected to the controller are in this mode. As a part of initializing the controller, all the flash memories might be enabled with XIP by carrying out dummy reads.

Quad Serial Peripheral Interface (QuadSPI)

## 38.10.1.8 Dual command page program (Numonyx)

The following table shows the dual command page program sequence for Numonyx flash memories.

Table 247. Dual command page program sequence

| Instruction   | Pad   | Operand   | Description                               |
|---------------|-------|-----------|-------------------------------------------|
| CMD           | 1h    | 2h        | Dual command page program = 02h on 2 pads |
| ADDR          | 1h    | 18h       | 24 address bits to be sent on two pads    |
| WRITE         | 1h    | 20h       | Write 32 bytes on two pads                |
| STOP          | 0h    | 0h        | Stop, instruction over                    |

## 38.10.1.9 Sector erase (Macronix/Numonyx/Spansion)

The following table shows the Sector erase sequence for the Macronix/Numonyx/Spansion flash memories.

Table 248. Sector erase sequence

| Instruction   | Pad   | Operand   | Description                           |
|---------------|-------|-----------|---------------------------------------|
| CMD           | 0h    | 20h       | Sector erase command = 20h            |
| ADDR          | 0h    | 18h       | 24 address bits to be sent on one pad |
| STOP          | 0h    | 0h        | Stop, instruction over                |

## 38.10.1.10 Read status register (Macronix/Numonyx/Spansion/Winbond)

The following table shows the read status register sequence for Macronix/Numonyx/Spansion/Winbond flash memories.

Table 249. Read status register sequence

| Instruction   | Pad   | Operand   | Description                        |
|---------------|-------|-----------|------------------------------------|
| CMD           | 0h    | 0h5       | Read status register command = 05h |
| READ          | 0h    | 0h1       | Read status register data          |
| STOP          | 0h    | 0h        | Stop, instruction over             |

## 38.10.1.11 Data learn instruction sequence

The following table shows the data learn sequence for 4 I/O flash memory.

Table 250. Data learn instruction sequence (4 I/O)

| Instruction   | Pad   | Operand   | Description                  |
|---------------|-------|-----------|------------------------------|
| CMD           | 0h    | 6Bh       | Fast read quad command = 6Bh |

Table continues on the next page...

Table 250. Data learn instruction sequence (4 I/O) (continued)

| Instruction   | Pad   | Operand   | Description                                             |
|---------------|-------|-----------|---------------------------------------------------------|
| ADDR_DDR      | 2h    | 18h       | 24 address bits in the DDR mode to be sent on four pads |
| DUMMY         | 2h    | 8h        | 8-cycle dummy                                           |
| DATA_LEARN    | 2h    | 1h        | 1-byte data learn                                       |
| READ_DDR      | 2h    | 6h        | Read 6 bytes in 4 pads 1                                |
| JMP_ON_CS     | 0h    | 0h        | Jump to Inst 0 (CMD)                                    |

1. Data learn instruction needs to be followed by a read DDR instruction of minimum 6 bytes in case of 4 I/O mode.

## NOTE

If DLL is disabled then JMP\_ON\_CS or STOP instruction can be used else only STOP instruction can be used.

The following table shows the data learn sequence for 8 I/O (hyperflash memory) flash memory.

Table 251. Data learn instruction sequence (8 I/O)

| Instruction   | Pad   | Operand   | Description                        |
|---------------|-------|-----------|------------------------------------|
| CMD_DDR       | 3h    | AOh       | Read command for hyperflash memory |
| ADDR_DDR      | 3h    | 18h       | 24-bit row address 1               |
| CADDR_DDR     | 3h    | 10h       | 16-bit column address              |
| DUMMY         | 3h    | Fh        | 15-cycle dummy                     |
| DATA_LEARN    | 3h    | 1h        | 1-byte data learn                  |
| READ_DDR      | 3h    | Ch        | Read 12 bytes in 8 pads 2          |
| STOP          | 3h    | 0h        | Stop, instruction over             |

1. The address needs to be aligned, which means, no latency should be there between the RWDS edges.

2. The data learn instruction needs to be followed by a read DDR instruction of minimum 12 bytes in case of 8 I/O mode.

The following table shows the data learn sequence for 4 I/O flash memory.

Table 252. Data learn instruction sequence (4 I/O)

| Instruction   | Pad   | Operand   | Description                                         |
|---------------|-------|-----------|-----------------------------------------------------|
| CMD           | 0h    | 6Bh       | Fast read quad command = 6Bh                        |
| ADDR_DDR      | 2h    | 18h       | 24 address bits in DDR mode to be sent on four pads |
| DUMMY         | 2h    | 8h        | 8 dummy cycles                                      |
| DATA_LEARN    | 2h    | 1h        | 1-byte data learn                                   |
| READ_DDR      | 2h    | 6h        | Read 6 bytes in 4 pads                              |
| JMP_ON_CS     | 0h    | 0h        | Jump to Inst 0 (CMD)                                |

Quad Serial Peripheral Interface (QuadSPI)

## NOTE

If DLL is disabled then JMP\_ON\_CS or STOP instruction can be used else only STOP instruction can be used.

The following table shows the data learn sequence for 8 I/O (Hyperflash) flash memory.

Table 253. Data learn instruction sequence (8 I/O)

| Instruction   | Pad   | Operand   | Description                        |
|---------------|-------|-----------|------------------------------------|
| CMD_DDR       | 3h    | AOh       | Read command for hyperflash memory |
| ADDR_DDR      | 3h    | 18h       | 24-bit row address 1               |
| CADDR_DDR     | 3h    | 10h       | 16-bit column address              |
| DUMMY         | 3h    | Fh        | 15-cycle dummy                     |
| DATA_LEARN    | 3h    | 1h        | 1-byte data learn                  |
| READ_DDR      | 3h    | 8h        | Read 8 bytes in 8 pads             |
| STOP          | 3h    | 0h        | Stop, instruction over             |

## NOTE

If DLL is disabled then JMP\_ON\_CS or STOP instruction can be used else only STOP instruction can be used.

## 38.10.2 Dual-die flash memories

Certain serial flash memory vendors provide dual-die packages that are essentially two devices (dies) stacked within the same package to increase the memory capacity of a single package. These two devices within a package share the same data and clock pins, but have individual chip selects. QuadSPI controller provides support for two dual-die packages to be connected simultaneously. The following figure shows the two dual-die packages and the naming conventions used in this document. For simplicity, the data pins are shown to be unidirectional.

Quad Serial Peripheral Interface (QuadSPI)

<!-- image -->

Because the two devices within a package share the same I/O pads, they cannot function in the parallel mode. The software should ensure that when QuadSPI is configured in the parallel mode, the two selected flash memory devices belong to different dual-die packages.

## 38.10.3 Boot initialization sequence

The following is the recommended sequence of steps for booting from QuadSPI:

## NOTE

Before you start, you must ensure that the system is out of reset and flash memory is available. Corresponding clocks and I/O pins must be configured.

1. Request is sent to QuadSPI for address 0h of flash memory.

The reset command sequence in QuadSPI has 3h (basic read command) that is applicable to the flash memories.

2. The first few bytes of data are read from the flash memory. These bytes contain the following information:
- The total sizes of all the flash memories connected on board
- Support of the DDR mode
- Frequency of the DDR operation
- Mode entry sequence
- 24-bit or 32-bit addressing (assuming 2- to 4-bit for the first accesses)
3. All the serial flash memories are configured:
- Quad mode is enabled
- Dummy reads to enter XIP
4. QuadSPI is configured:
- Parallel enable set

- LUT is configured for the highest performance reads
- DDR mode is enabled (if applicable)
- Buffers are configured
5. Serial flash memory clock frequency increases.
6. Boot reads happen in the parallel, DDR enabled, quad output mode.

## 38.11 Sampling of serial flash memory input data

## 38.11.1 Basic description

QuadSPI is used to read data from the serial flash memory device. Depending on the actual implementation, there is a delay between the internal clocking in the QuadSPI module and the external serial flash memory device. See the following figure for an overview of this scheme.

<!-- image -->

The rising edge of the internal reference clock is taken as timing reference for the data output of the serial flash memory. After a time of t total\_delay the data arrives at the internal sampling stage of the QuadSPI module. Considering the figure provided here, the following parts of the delay chain contribute to t total\_delay :

- Output delay of the serial flash memory clock output of the device containing the QuadSPI module
- Wire delay of application/PCB from the device containing the QuadSPI module to the external serial flash memory device
- Clock to data out delay of the external serial flash memory device, including input and output delays
- Wire delay of application/PCB from the external serial flash memory device to the device containing the QuadSPI module
- Device delay corresponding to the input data

## NOTE

The t total\_delay is specific to the characteristics of the actual implementation.

## 38.11.2 DQS sampling method

## 38.11.2.1 Basic description

In the DQS mode, the data strobe signal (DQS/RWDS) is used to sample the read data. Here, both DQS and the data sent by the flash memory move in the same direction; therefore, it is relatively easier to achieve at higher frequencies.

When using DQS for SDR reads, QuadSPI internally samples the incoming data on the rising edge of the strobe signal.

The next figure shows the sampling read data in the SDR mode using the DQS.

Quad Serial Peripheral Interface (QuadSPI)

Figure 222. Data strobe functionality in SDR mode for read operation.

<!-- image -->

## NOTE

Consider "Data Strobe Signal" as "Data Strobe Signal driven by memory" and "Data" as "Data from memory".

## NOTE

Refer to the Datasheet for specific timing waveforms of QuadSPI

When using the DQS for DDR reads, QuadSPI internally samples the incoming data on both the edges of the strobe signal. See the next figure for details.

Figure 223. Data strobe functionality in DDR mode for read operation.

<!-- image -->

## 38.11.2.2 External DQS

In serial flash memories supporting DQS, the data strobe signal is an output from the flash memory device that indicates when data is being transferred from the flash memory to the host controller. The data is then captured by the controller on:

- Only one edge (either rising or falling edge) of DQS signal in the SDR mode
- Both rising/falling edges of the DQS signal in the DDR mode

Some serial flash memories (for example, HyperFlash) provide the data strobe output (RWDS) with latency cycles included in between the ongoing read transactions. The data is sampled on both the edges of this signal taking into consideration that when no signal is provided by the flash memory between ongoing transactions, data is not sampled then, and at the end of the transaction, the required number of data to be fetched remains the same. See the next figure for details.

Some serial flash memories (for example, HyperFlash) provide the data strobe output (RWDS) with latency cycles included in between the ongoing read transactions. The data is sampled on both the edges of this signal taking into consideration that when no signal is provided by the flash memory between ongoing transactions, data is not sampled then, and at the end of the transaction, the required number of data to be fetched remains the same. See the next figure for details.

<!-- image -->

This can be enabled by programming MCR[DQS\_FA\_SEL] = "11" for flash memory A and MCR[DQS\_FB\_SEL] = "11" for flash memory B. This mode supports the following configuration:

- Both high/low frequency delay chain manual programming using DLLCRA[SLV\_DLY\_COARSE] and DLLCRA[SLV\_FLINE\_OFFSET]
- DLL-assisted sampling only using DLLCRA[DLLEN] and DLLCRB[DLLEN]
- DLL-assisted auto data learning using DLLCRA[DLLEN] and DLLCRB[DLLEN] along with MCR{DLPEN]
- MCR[CK2\_DCARS\_FB] and MCR[CK2\_DCARS\_FA] should be disabled as DLL is used

## NOTE

Consider "Data Strobe Signal" as "Data Strobe Signal driven by memory" and "Data" as "Data from memory".

## NOTE

For Specific details - Refer to the Data Sheet specification of QuadSPI module.

Quad Serial Peripheral Interface (QuadSPI)

## NOTE

This mode may not be available on the chip. See the "Supported read modes" section in the chip-specific QuadSPI information for the read modes that this chip supports.

## 38.11.2.3 Dummy Pad loopback

The internal clock is loop-backed from the dummy internal pad to compensate data pad delays. This can be enabled by configuring the value of MCR[DQS\_FA\_SEL] as "01" for flash memory A and the value of MCR[DQS\_FB\_SEL] as "01" for flash memory B. This mode can be used with the following configuration:

- High/low frequency delay chain manual programming in bypass mode using DLLCRA[SLV\_DLY\_COARSE] or DLLCRB[SLV\_DLY\_COARSE] and DLLCR[FREQEN].
- DLL-assisted sampling only using DLLCRA[DLLEN] and DLLCRB[DLLEN]

## NOTE

Refer to DS or "Chip-specific section" of QSPI for Fixed sampling Tap specific settings/details with out without DLL (in bypass mode)

- DLL-assisted auto data learning using DLLCRA[DLLEN] and QuadPI\_DLLCRB[DLLEN] and along with MCR[DLPEN]

## NOTE

Refer to Auto-DataLearning (4x Sampling method) section with DLL for further details

## NOTE

This mode may not be available on the chip. See the "Supported read modes" section in the chip-specific QuadSPI information for the read modes that this chip supports.

## 38.11.2.4 External center-aligned read strobe

QuadSPI supports serial flash memories using the CRS protocol. Using this protocol, in addition to the SCK, the host controller provides a 90 o  phase shifted SCK that allows the flash memory to generate valid data timed off SCK edges and a DQS signal output that is timed off the 90 o  phase shifted SCK edges that is centered within the valid read data window. This allows the host controller to easily capture read data from the flash memory by using the data read strobe transitions and thereby allows for a higher performance operation. As the flash memory is the originator of the center-aligned data read strobe as well as the read data, the temporal timing phase alignment between these signals is easier to guarantee across PVT (process, voltage, and temperature) corners.

The following figure shows data strobe functionality using CRS protocol.

## NOTE

This mode might not be available on the chip. See the "Supported read modes" section in the chip-specific QuadSPI information for the read modes that this chip supports.

Quad Serial Peripheral Interface (QuadSPI)

Quad Serial Peripheral Interface (QuadSPI)

<!-- image -->

note:Consider"Data Strobe Signal" as "Driven by Memory" and "Data" as "Memory to data".

## 38.12 Data learning

## 38.12.1 Basic description

Data learning is used to manage varying data valid windows from the flash memory as well as any variations in the chip based on PVT conditions in the DDR mode. QuadSPI provides this feature via the DATA\_LEARN instruction for all flash memories, irrespective of whether the flash memory supports it. The DATA\_LEARN instruction accepts an operand that defines the number of bits of the known pattern for which the data learning has to be done. The known pattern is provided in the DLPR register.

QuadSPI supports the following data learning:

- QuadSPI supports data learning with DLL enabled only

The following sections explain data learning in detail.

## 38.12.2 DQS sampling method

The semi-automatic data learning is supported in the DQS sampling method. To start data learning:

1. Configure a known pattern in the Data Learn register inside flash memories that support data learning. The pattern should be selected to have multiple low and high transitions in the data bus.

## NOTE

Certain flash memories provide data learning as a feature for DDR data reads.

2. Set up a QuadSPI DDR data read sequence, inserting a DATA\_LEARN instruction before the READ\_DDR instruction. The flash memory returns the data learning pattern in between dummy cycles in every read command. Each I/O gives the same DLP value for every clock edge.

## NOTE

For flash memories that do not support data learning, configure a known location in flash memory with a known pattern. The pattern should not have 0h or FFh included. The pattern should be selected to have multiple low and high transitions in the data bus. Set up a QuadSPI DDR data read sequence, inserting a DATA\_LEARN instruction. The address in the SFAR register should point to the known location within the pattern. Configure the known pattern in DLPR[DLPV]. See Programming the data learning pattern in flash memory for details on how the data has to be ordered in memory for correct operation.

3. Select a sampling point. See chip-specific QuadSPI information for selection of the sampling point.
4. Initiate the read via a peripheral transaction.
5. QuadSPI reads the data from the flash memory. It then encounters the DATA\_LEARN instruction and samples the incoming data on both edges (rising and falling) of the DQS.

## NOTE

If the data from the flash memory does not match the data learning pattern, the FR[DLPFF] flag is set. The QuadSPI module reports no sampling point automatically.

6. Repeat steps 2-7 with varying VT conditions for a particular process until FR[DLPFF] is set. The sampling points where no FR[DLPFF] is set signify a valid setting.

In the case of multiple valid settings, the software should select the middle point. The sampling point should be fixed within the above selected point for the next READ transactions.

## NOTE

Ensure that QuadSPI is not accessed during calibration.

This feature might be used to auto-calibrate the sampling point for DDR reads, and auto-calibration might be triggered at fixed intervals, or depending on a change in PVT conditions.In case the sampling point needs to be changed based on initiating options (such as, DLL lock status, time period, or software forced interrupt), data learn instruction has to be re-initiated.

The following figure shows data learning in DQS mode.

Quad Serial Peripheral Interface (QuadSPI)

Quad Serial Peripheral Interface (QuadSPI)

<!-- image -->

## NOTE

This mode might not be available on the chip. See the chip-specific QuadSPI information for the read modes that this chip supports.

## 38.12.3 Programming the data learning pattern in flash memory

Example scenario: If the value of DLPR[DLPV] is 43h, QuadSPI controller tries to match the sequence of bits sent on selected data lines with the pattern in DLPR[DLPV]. The following table shows the data programmed in flash memory with endianness taken into consideration.

Table 254. Programming the data learning pattern in flash memory

|                  | Single Pad   | Double Pad   | Quad Pad              | Octal Pad                                   |
|------------------|--------------|--------------|-----------------------|---------------------------------------------|
| DLPR IO1 pattern | 0x349A       | 0x349A       | 0x3514                | 0x349A                                      |
| DLPR IO3 pattern | NA           | NA           | 0x349A                | 0x3514                                      |
| Flash Pattern    | 0x2C59       | 0xF04CC226   | 0x0DF02D0D 0x00FFF020 | 0xF708f700 0xF70000FF 0x00FF0008 0x0000FFFF |

## 38.13 DLL and delay chain usage

The DLL is a general-purpose, dynamically adaptive clock delay module. It provides the ability to select a quantized delay (in fractions of the clock period) regardless of on-chip variations such as process, voltage, and temperature (PVT). The DLL is suitable for applications where accurate delay adjustment is required, such as in case of DDR interfaces.

## DLL working concept

The DLL control loop consists of a counter, reference delay line, and phase detector which operate on the ref\_clock reference clock input. The reference clock (clk\_ref) is fed into the reference delay line. After reset, a single delay tap is selected. A phase detector is used to detect the condition where a half shift has occurred. In addition to this, signals are generated to either increment or decrement the counter, which controls the delay line (if the half-phase detect condition is not met). Any changes in the delay of the individual elements of the delay chain (because of PVT) automatically cause the phase detector logic to determine if a change in the counter value is required. After the half-phase shift is detected, an internal lock signal is generated, and after a lock event occurs, the slave delay chain is ready to be updated based on a triggering event.

## Slave delay chain programming sequence-

Following is the programming sequence for DLL bypass mode.

1. Program DLLCRA[SLV\_EN]=1, DLLCRA[SLV\_DLL\_BYPASS]=1, and DLLCRA[SLAVE\_AUTO\_UPDT]=0.
2. Program the following fields to provide the desired DQS delay for sampling: DLLCRA[SLV\_FINE\_OFFSET], DLLCRA[SLV\_DLY\_COARSE], and DLLCR[FREQEN]. See the chip-specific QuadSPI information for the supported programming settings.
3. Program DLLCRA[SLV\_UPD]=1 to load these values in the slave delay chain.
4. Check the slave delay chain update status by polling DLLSR[SLVA\_LOCK]=1 and clear DLLCRA[SLV\_UPD] after confirming the update state.

## NOTE

This programming sequence corresponds to flash memory A. Similar steps apply for flash memory B.

Following is the programming sequence for DLL auto update mode.

1. Program DLLCRA[SLV\_EN]=1, DLLCRA[SLV\_DLL\_BYPASS]=0, and DLLCRA[SLAVE\_AUTO\_UPDT]=1.
2. Program the DLL configuration by using DLLCRA[DLL\_REFCNTR] and DLLCRA[DLLRES]. See the chip-specific QuadSPI information for the supported DLL configuration settings.
3. Program the slave settings to delay DQS by using these fields: DLLCRA[SLV\_FINE\_OFFSET], DLLCRA[SLV\_DLY\_OFFSET], and DLLCR[FREQEN]. See the chip-specific QuadSPI information for the supported settings.
4. If offset delay needs to be updated on the slave chain, program DLLCRA[SLV\_UPD]=1.
5. Enable DLL by programming DLLCRA[DLLEN]=1 and reset DLLCRA[SLV\_UPD]=0. Slave delay chain is updated automatically and can be checked by polling DLLSR[SLVA\_LOCK]==1

## NOTE

This programming sequence corresponds to flash memory A. Similar steps apply for the flash memory B.

## 38.14 Data input hold requirement of flash memory

In the DDR mode, the data is valid only for half clock cycle. It is difficult to meet the data input hold time requirement for flash memory. QuadSPI internally delays the data sent to flash memory so that it becomes easy to meet the hold requirement. The FLSHCR[TDH] is used for this purpose. If FLSHCR[TDH] is configured to 0, then the data sent to flash memory is aligned with the internal reference clock of QuadSPI. If it is 1, then the data is aligned to 2x internal reference half clock.

Quad Serial Peripheral Interface (QuadSPI)

Quad Serial Peripheral Interface (QuadSPI)

<!-- image -->

## 38.15 Glossary

AHB

Advanced high-performance bus, a version of AMBA

AMBA

Advanced microcontroller bus architecture

APB

Advanced peripheral bus

BE

Big endian byte ordering

CRS

Center aligned read strobe

CS

Chip select

FRAD

Flash region access descriptor

I/O

Input output, I/O lines are also referred to as pads in this chapter

IFM

Individual flash memory mode

LE

Little endian

MDAD

Master domain access descriptors

MGID

Master-Group identifier

PFM

Parallel flash memory mode

PCS

Peripheral chip select

SCK

Serial communications clock

SFM

Serial flash memory

## Chapter 39 Ultra Secured Digital Host Controller (uSDHC)

## 39.1 Chip-specific uSDHC information

## 39.1.1 HS400 frequency

HS400 operation is constrained to 133 MHz - 200 MHz on this chip, including adherence in step 12 in section "Switch to HS400 mode" and step 10 in section "Switch to HS400 enhanced mode" in this chapter.

## 39.2 Overview

uSDHC provides the interface between the host system and the eMMC, SD card, and SDIO as shown in Figure 229. The module acts as a bridge, passing host bus transactions to the eMMC, SD card, and SDIO by sending commands and performing data accesses to/from the cards. It handles the SD card/SDIO/eMMC protocols at the transmission level.

## 39.2.1 Block diagram

The following figure illustrates the block diagram for uSDHC. Dual port SRAM is FIFO for write/read. For more information, see Data buffer.

<!-- image -->

The figure below shows the System connection of uSDHC:

Ultra Secured Digital Host Controller (uSDHC)

<!-- image -->

The following are brief descriptions of the cards supported by uSDHC:

- The Embedded MultiMediaCard (eMMC) is a universal low-cost data storage and communication media designed to cover a wide array of applications including mobile video and gaming. Previous eMMC were based on a 7-pin serial bus with a single data pin, while the new high speed eMMC communication is based on an advanced 11-pin serial bus designed to operate in the low-voltage range.
- The Secure Digital Card (SD) is an evolution of the old eMMC technology. It is specifically designed to meet the security, capacity, performance, and environmental requirements inherent in newly emerging audio and video consumer electronic devices. The physical form factor, pin assignment, and data transfer protocol are backward compatible with the old eMMC (with some additions).
- Under the SD protocol, system connection can be categorized into memory card, I/O card, and combo card, which have both memory and I/O functions. The memory card invokes a copyright protection mechanism that complies with the security of the SDMI (Secure Digital Music Initiative) standard. The I/O card, which is also known as SDIO, provides high-speed data I/O with low-power consumption for mobile electronic devices.

## 39.2.2 Features

The list given below shows the features of the uSDHC module:

- Conforms to the SD Host Controller Standard Specification version 2.0/3.0
- Compatible with the eMMC System Specification version 4.2/4.3/4.4/4.41/4.5/5.0/5.1
- Compatible with the SD Memory Card Specification version 3.0 and supports the Extended Capacity SD Memory Card
- Compatible with the SDIO Specification version 2.0/3.0
- Designed to work with SD Memory, miniSD Memory, SDIO, miniSDIO, SD Combo, eMMC, MMC plus, and MMC RS cards
- For card bus clock frequency: See the product Data Sheet for the clock frequency of each supported mode.
- Supports 1-bit/4-bit SD and SDIO modes, and 1-bit/4-bit/8-bit eMMC modes
- Up to 832 Mbps of data transfer for SDIO using four parallel data lines in the Single Data Rate (SDR) mode
- Up to 400 Mbps of data transfer for SDIO using four parallel data lines in the Dual Data Rate (DDR) mode
- Up to 832 Mbps of data transfer for SDXC cards using four parallel data lines in the Single Data Rate (SDR) mode
- Up to 400 Mbps of data transfer for SDXC card using four parallel data lines in the Dual Data Rate (DDR) mode
- Up to 1600 Mbps of data transfer for eMMC using eight parallel data lines in the Single Data Rate (SDR) mode
- Up to 3200 Mbps of data transfer for eMMC using eight parallel data lines in the Dual Data Rate (DDR) mode
- Supports single block/multi-block read and write
- Supports block sizes of 1 ~ 4096 bytes

- Supports the write protection switch for write operations
- Supports both synchronous and asynchronous abort
- Supports pause during the data transfer at block gap
- Supports SDIO Read Wait and Suspend Resume operations
- Supports Auto CMD12 for multi-block transfer
- Host can initiate non-data transfer command while data transfer is in progress
- Allows cards to interrupt the host in 1-bit and 4-bit SDIO modes; also supports interrupt period
- Embodies two fully configurable 256x32-bit FIFO for read/write data
- Supports internal DMA capabilities
- Supports voltage selection by configuring vendor-specific register bit
- Supports Advanced DMA to perform linked memory access
- Supports Command Queue mechanism

## NOTE

This block can support all the above-listed speed mode and maximum data throughput. However, these may be specific to the device. See the corresponding chip-specific information or the device data sheet for accurate details.

## 39.3 Functional description

The following sections provide a brief functional description of the major system blocks, including the data buffer, DMA AXI interface, register bank as well as IP Bus interface, dual-port memory wrapper, data/command controller, clock and reset manager, and clock generator.

## 39.3.1 Modes and operations

## 39.3.1.1 Data transfer modes

The uSDHC module can select the following modes for data transfer:

- SD 1-bit
- SD 4-bit
- eMMC 1-bit
- eMMC 4-bit
- eMMC 8-bit
- Identification mode (up to 400 kHz)
- eMMC full-speed mode (up to 26 MHz)
- eMMC high-speed mode (up to 52 MHz)
- eMMC HS200 mode (up to 200 MHz)
- eMMC HS400 mode (200 MHz both edges)
- eMMC DDR mode (52 MHz both edges)
- SD card or SDIO full-speed mode (up to 25 MHz)
- SD card or SDIO high-speed mode (up to 50 MHz)
- SD card or SDIO UHS-I mode (up to 208 or 100 MHz in SDR mode, up to 50 MHz in the DDR mode)

Ultra Secured Digital Host Controller (uSDHC)

## NOTE

This block can support all the above listed speed mode and maximum clock frequency. However, these may be specific to the device. See the corresponding chip-specific information or the device data sheet for accurate details.

## 39.3.2 Data buffer

The uSDHC module uses one configurable data buffer to transfer data between the system bus (IP bus or advanced extensible interface (AXI) bus) and the SD card in an optimized manner, maximizing throughput between the two clock domains (IP peripheral clock and the master clock). The buffer is used as a temporary storage for transferring data between the host system and the card. The watermark levels for read and write are both configurable and can range between 1 to 128 words. When using internal DMA mode, The watermark level for read should be configured to 16 and watermark level for write should be configured to integral multiple of 16 to get max AXI bus throughput. The next figure provides the uSDHC buffer scheme as buffer control and buffer RAM wrapper.

<!-- image -->

Here are 2 transfer modes to access the data buffer:

- CPU polling mode:
- For a host-read operation, when the number of words received in the buffer meets or exceeds the RD\_WML watermark value, by polling the BRR bit, the host driver can read the Buffer Data Port register to fetch the amount of words set in the RD\_WML register from the buffer. The write operation is similar. For more information on the process of writing operation, see Write operation sequence.
- Internal DMA mode (includes simple and advanced DMA accesses):
- The internal DMA access, either by simple or advanced DMA, is over the AXI bus.

For a read operation, when there are more words in the buffer than the amount set in WTMK\_LVL[RD\_WML], the internal DMA starts fetching data over the AXI bus.

The Write operation functions in a similar manner-sequential and contiguous access is necessary to ensure that the pointer address value is correct. Random or skipped access is not possible. The byte order, by reset, is little endian mode. The actual byte order is swapped inside the buffer, according to the endian mode configured by software (see the following figures). For a host write operation, the byte order is swapped after the data is fetched from the buffer and ready to send to the SD Bus. For a host read operation, the byte order is swapped before the data is stored in the buffer.

Ultra Secured Digital Host Controller (uSDHC)

Ultra Secured Digital Host Controller (uSDHC)

<!-- image -->

## 39.3.2.1 Write operation sequence

There are 2 ways to write data into the buffer when the user transfers data to the card:

- Processor core polling through the BWR bit in the Interrupt Status register (interrupt or polling)
- Internal DMA

When the internal DMA is not used, the DMAEN bit in the Transfer Type register is not set when the command is sent, uSDHC asserts a DMA request when the amount of buffer space exceeds the value set in WTMK\_LVL[WR\_WML] and is ready for receiving new data. At the same time, uSDHC sets the BWR bit. The buffer write ready interrupt is generated if it is enabled by software.

When internal DMA is used, uSDHC does not inform the system before all the required number of bytes are transferred (if no error is encountered). When an error occurs during the data transfer, uSDHC aborts the data transfer and abandons the current block. The host driver should read the contents of the DMA System Address register to obtain the starting address of the abandoned data block. If the current data transfer is in multi-block mode, uSDHC does not automatically send CMD12, even though the AC12EN bit in the Transfer Type register is set. The host driver sends CMD12 in this scenario and restarts the write operation from that address. It is recommended that a software reset for Data be applied before the transfer is restarted.

The uSDHC module does not start data transmission until the buffer has been filled with the number of words set in the WR\_WML register. If the buffer is empty and the host system does not write data in time, uSDHC stops the CLK to avoid the data buffer underrun situation.

## 39.3.2.2 Read operation sequence

There are 2 ways to read data from the buffer when the data is received from the card:

- Processor core polling through the BRR bit in the Interrupt Status register (interrupt or polling)
- Internal DMA

When internal DMA is not used (DMAEN bit in Transfer Type register is not set when the command is sent), uSDHC asserts a DMA request when the amount of data exceeds the value set in the RD\_WML register, which is available and ready for system fetching data. At the same time, uSDHC sets the BRR bit. The buffer read ready interrupt is generated if it is enabled by the software.

When internal DMA is used, uSDHC does not inform the system before all the required number of bytes are transferred (if no error is encountered). When an error occurs during the data transfer, uSDHC aborts the data transfer and abandons the current block. The host driver should read the content of the DMA System Address register to get the starting address of the abandoned data block. If the current data transfer is in multi-block mode, uSDHC does not automatically send CMD12, even though the AC12EN bit in the Transfer Type register is set. The host driver sends CMD12 in this scenario and restarts the read operation from that address. It is recommended that a software reset (in register RSTD) for data be applied before the transfer is restarted.

Ultra Secured Digital Host Controller (uSDHC)

For any read transfer mode, uSDHC does not start data transmission until the number of words set in the RD\_WML register are in buffer. If the buffer is full and the host system does not read data in time, uSDHC stops the CLK to avoid the data buffer overrun situation.

## 39.3.2.3 Data buffer and block size

In the uSDHC module, the data buffer can hold up to 256 words (32-bit) and the watermark levels for write and read can be configured accordingly. The user needs to know the buffer size for the buffer operation during a data transfer to utilize it in the most optimized way. The host driver may configure the value according to the system and requirement.

During a multi-block data transfer, the block length can be set to any value between 1 and 4096 bytes, satisfying the requirements of the external card. The only restriction is from the external card, which can be limited in size or support of a partial block access (which is not the integer times of 512 bytes). That means, the largest block size is 512 bytes.

As uSDHC treats each block individually, for block sizes which are not multiples of four (not word-aligned), stuffed bytes are required at the end of each block. For example, if the block size is 7 bytes and there are 12 blocks to write, the software side must write twice for each block. For each block, the ending byte is abandoned by uSDHC because it only sends 7 bytes to the card and picks data from the following system write, resulting in 24 beats of write access in total.

## 39.3.2.4 Dividing large data transfer

This SDIO command CMD53 definition limits the maximum data size of data transfers according to the following formula:

Max data size = Block size x Block count

The length of a multiple block transfer needs to be in multiples of block size. If the total data length cannot be divided evenly into a multiple of the block size, then there are two options to transfer the data. These two options depend on the function and the card design. Option 1 is for the host driver to split the transaction. The remainder of the block size data is then transferred by using a single block command at the end. Option 2 is to add dummy data in the last block to fill the block size. For option 2, the card must manage the removal of the dummy data. Only for write, uSDHC sends data to the card.

See Figure 233 for an example showing the division of large data transfers, assuming a kind of WLAN SDIO that only supports a block size of up to 64 bytes. Although uSDHC supports a block size of up to 4096 bytes, SDIO can only accept a block size of less than 64 bytes, so the data must be divided (see the example below).

Ultra Secured Digital Host Controller (uSDHC)

<!-- image -->

## 39.3.3 DMA AXI interface

The internal DMA implements a DMA engine and the AXI master. When the internal DMA is enabled, but the BWR and BRR bits are set if the BWRSEN and BRRSEN bits have been set in the Interrupt Status Enable register. See Figure 234 for an illustration of the DMA AXI interface block.

<!-- image -->

## 39.3.3.1 Internal DMA request

If the watermark level requirement is met in data transfer or if the last data of current block is ready in the data buffer, and the Internal DMA is enabled, the data buffer block sends a DMA request to AXI interface.

Ultra Secured Digital Host Controller (uSDHC)

The delay in response from the internal DMA engine depends on the system AXI bus loading and the priority assigned to uSDHC. The DMA engine does not respond to the request during its burst transfer, but is ready to serve as soon as the burst is over. The data buffer de-asserts the request if the data buffer space (for write) or bytes in data buffer is smaller than the watermark level. Upon access to the buffer by internal DMA, the data buffer updates its internal buffer pointer, and when the watermark level is satisfied or the last data of the current block is ready in the data buffer, another DMA request is sent.

The data transfer is in the block unit, and the subsequent watermark level is always automatically set as the remaining number of words. For instance, for a multi block data read with each block size of 31 bytes, and the watermark level set to six words (24 bytes). After the first burst transfer, if there are greater than or equal to two words in the buffer, which might contain some data of the next block), another DMA request is sent. This is because the remaining number of words to transfer for the current block is ceiling((31 - 6 * 4) / 4) = 2. The uSDHC module reads two words out of the buffer, with seven valid bytes and one stuffed byte.

## 39.3.3.2 AXI master interface

It is possible that the internal AXI DMA engine could fail during the data transfer. Upon detection of an AXI bus error during DMA transfer, the DMA engine stops the transfer and goes to the idle state. At that point, the internal data buffer stops receiving incoming data and sending out data. The DMAE bit in the Interrupt Status register is generated to host CPU to report a bus error condition.

After the DMAE interrupt is received, the software sends a CMD12 to abort the current transfer and read the DS\_ADDR bits of the DMA System Address register to get the starting address of the corrupted block. After the DMA error is fixed, the software should apply a data reset and restart the transfer from this address to recover the corrupted block.

## 39.3.3.3 ADMA engine

In the SD host controller standard, a new DMA transfer algorithm called the Advanced DMA (ADMA) is defined. For simple DMA, after the page boundary is reached, a DMA interrupt is generated and the new system address is programmed by the host driver. The ADMA defines the programmable descriptor table in the system memory. The host driver can calculate the system address at the page boundary and program the descriptor table before executing ADMA. It reduces the frequency of interrupts to the host system. Therefore, higher speed DMA transfers could be realized because the host MCU intervention is not be needed during long DMA-based data transfers.

There are two types of ADMA in host controller: ADMA1 and ADMA2. ADMA1 can support data transfer of 4KB aligned data in system memory, and ADMA2 eliminates the restriction so that the data of any location and any size can be transferred in system memory. Their formats of Descriptor Table are different.

ADMA can recognize all kinds of descriptors defined in SD host controller Standard, and if the "End" flag is detected in the descriptor, ADMA stops after this descriptor is processed.

## 39.3.3.3.1 ADMA concept and descriptor format

ADMA1 includes the following descriptors:

- Valid/invalid descriptor
- Nop descriptor
- Set data length descriptor
- Set data address descriptor
- Link descriptor
- Interrupt flag and end flag in descriptor

ADMA2 includes the following descriptors:

- Valid/invalid descriptor
- Nop descriptor
- Rsv descriptor (new in ADMA2)
- Set data length and address descriptor

- Link descriptor
- Interrupt flag and end flag in descriptor

ADMA starts read/write operation after it reaches the tran state, using the data length and data address analyzed from most recent descriptor(s).

For ADMA1, the valid data length descriptor is the last set type descriptor before the tran type descriptor. Every tran type descriptor triggers a transfer, and the transfer data length is extracted from the most recent set type descriptor. If there is no set type descriptor after the previous Trans descriptor, the data length is the value for previous transfer, or 0 if no set descriptor is ever met.

For ADMA2, the tran type descriptor contains both data length and transfer data address, so the tran type descriptor itself can start a data transfer.

See Figure 235 for the format of the descriptor table for ADMA1.

<!-- image -->

| Address/ Page Field    | Address/ Page Field                                                                                                 |                                                                                                                     |                                                                                                                     | Attribute Field                                                                                                     | Attribute Field                                                                                                     | Attribute Field                                                                                                     | Attribute Field                                                                                                     | Attribute Field                                                                                                     | Attribute Field                                                                                                     |
|------------------------|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|
|                        |                                                                                                                     | 31                                                                                                                  |                                                                                                                     | 5 6                                                                                                                 | 4                                                                                                                   | 3                                                                                                                   | 2                                                                                                                   | 1                                                                                                                   | 0                                                                                                                   |
| Address or Data Length | Address or Data Length                                                                                              |                                                                                                                     |                                                                                                                     | Act 2                                                                                                               | Act 1                                                                                                               | 0                                                                                                                   | Int                                                                                                                 | End                                                                                                                 | Valid                                                                                                               |
| Act 2                  |                                                                                                                     |                                                                                                                     | Symbol                                                                                                              | Comment                                                                                                             | Comment                                                                                                             | 31- 28                                                                                                              | 31- 28                                                                                                              | 27- 12                                                                                                              | 27- 12                                                                                                              |
| 0                      | 0                                                                                                                   | 0                                                                                                                   | Nop                                                                                                                 | No Operation                                                                                                        | No Operation                                                                                                        | Don't Care                                                                                                          | Don't Care                                                                                                          | Don't Care                                                                                                          | Don't Care                                                                                                          |
| 0                      | 1                                                                                                                   | 1                                                                                                                   | Set                                                                                                                 | Set Data Length                                                                                                     | Set Data Length                                                                                                     | 0000                                                                                                                | 0000                                                                                                                | Data Length                                                                                                         | Data Length                                                                                                         |
| 1                      | 0                                                                                                                   | 0                                                                                                                   | Tran                                                                                                                | Transfer Data                                                                                                       | Transfer Data                                                                                                       | Data Address                                                                                                        | Data Address                                                                                                        | Data Address                                                                                                        | Data Address                                                                                                        |
| 1                      | 1                                                                                                                   | 1                                                                                                                   | Link                                                                                                                | Link Descriptor                                                                                                     | Link Descriptor                                                                                                     | Descriptor Address                                                                                                  | Descriptor Address                                                                                                  | Descriptor Address                                                                                                  | Descriptor Address                                                                                                  |
| Valid                  | Valid = 1 indicates this line of descriptor is effective. If Valid = 0 generate ADMA Error Interrupt and stop ADMA. | Valid = 1 indicates this line of descriptor is effective. If Valid = 0 generate ADMA Error Interrupt and stop ADMA. | Valid = 1 indicates this line of descriptor is effective. If Valid = 0 generate ADMA Error Interrupt and stop ADMA. | Valid = 1 indicates this line of descriptor is effective. If Valid = 0 generate ADMA Error Interrupt and stop ADMA. | Valid = 1 indicates this line of descriptor is effective. If Valid = 0 generate ADMA Error Interrupt and stop ADMA. | Valid = 1 indicates this line of descriptor is effective. If Valid = 0 generate ADMA Error Interrupt and stop ADMA. | Valid = 1 indicates this line of descriptor is effective. If Valid = 0 generate ADMA Error Interrupt and stop ADMA. | Valid = 1 indicates this line of descriptor is effective. If Valid = 0 generate ADMA Error Interrupt and stop ADMA. | Valid = 1 indicates this line of descriptor is effective. If Valid = 0 generate ADMA Error Interrupt and stop ADMA. |
| End                    | End = 1 indicates current descriptor is the ending one.                                                             | End = 1 indicates current descriptor is the ending one.                                                             | End = 1 indicates current descriptor is the ending one.                                                             | End = 1 indicates current descriptor is the ending one.                                                             | End = 1 indicates current descriptor is the ending one.                                                             | End = 1 indicates current descriptor is the ending one.                                                             | End = 1 indicates current descriptor is the ending one.                                                             | End = 1 indicates current descriptor is the ending one.                                                             | End = 1 indicates current descriptor is the ending one.                                                             |
| Int                    | Int = 1 generates DMA Interrupt when this descriptor is processed.                                                  | Int = 1 generates DMA Interrupt when this descriptor is processed.                                                  | Int = 1 generates DMA Interrupt when this descriptor is processed.                                                  | Int = 1 generates DMA Interrupt when this descriptor is processed.                                                  | Int = 1 generates DMA Interrupt when this descriptor is processed.                                                  | Int = 1 generates DMA Interrupt when this descriptor is processed.                                                  | Int = 1 generates DMA Interrupt when this descriptor is processed.                                                  | Int = 1 generates DMA Interrupt when this descriptor is processed.                                                  | Int = 1 generates DMA Interrupt when this descriptor is processed.                                                  |

See Figure 236 for the concept and access method of the descriptor table for ADMA1.

Ultra Secured Digital Host Controller (uSDHC)

Ultra Secured Digital Host Controller (uSDHC)

<!-- image -->

The figure below explains the ADMA2 format. ADMA2 deals with the lower 32-bit first, and then the higher 32-bit. If the 'Valid' flag of descriptor is 0, it ignores the higher 32-bit. The Address field should be set to word aligned (lower 2-bit is always set to 0). Data length is in byte unit.

63

Address Field

32-bit Address

Act 2

0

0

1

1

31

32

Act1

0

1

0

1

Reserved

16

15

0000000000

Symbol

Nop

Rsv

Tran

Link

04

05

Act 2

Act 1

Comment

No Operation

Reserved

Transfer Data

Link Descriptor

Ultra Secured Digital Host Controller (uSDHC)

Attribute Field

03

02

0

Int

01

End

Operation

Don't Care

Same as Nop. Read this line and go to next one

Transfer data with address and length set in this descriptor line

Link to another descriptor

Figure 237. Format of the ADMA2 descriptor table

| Valid   | Valid = 1 indicates this line of descriptor is effective. If Valid = 0 generate ADMA Error Interrupt and stop ADMA.   |
|---------|-----------------------------------------------------------------------------------------------------------------------|
| End     | End = 1 indicates current descriptor is the ending one.                                                               |
| Int     | Int = 1 generates DMA Interrupt when this descriptor is processed.                                                    |

See Figure 238 for the concept and access method of the descriptor table for ADMA2.

Length

16-bit length

06

00

Valid

Ultra Secured Digital Host Controller (uSDHC)

Figure 238. Concept and access method of the ADMA2 descriptor table

<!-- image -->

## 39.3.3.3.2 ADMA interrupt

If the interrupt flag descriptor is set, ADMA generates an interrupt according to various types of descriptors.

For ADMA1:

- Set type of descriptor: interrupt is generated when data length is set.
- Tran type descriptor: interrupt is generated when this transfer is complete.
- Link type of descriptor: interrupt is generated when new descriptor address is set.

- Nop type of descriptor: interrupt is generated just after this descriptor is fetched.

For ADMA2:

- Tran type of descriptor: interrupt is generated when this transfer is complete.
- Link type of descriptor: interrupt is generated when new descriptor address is set.
- Nop/Rsv type of descriptor: interrupt is generated just after this descriptor is fetched.

## 39.3.3.3.3 ADMA error

The ADMA stops whenever an error is encountered. These errors include:

- Fetching descriptor error
- AXI response error
- Data length mismatch error

An ADMA descriptor error is generated when it fails to detect a "valid" flag in the descriptor. If an ADMA descriptor error occurs, the interrupt is not generated even if the "Interrupt" flag of this descriptor is set.

When BLKCNTEN bit is set, data length set in register BLK\_ATT must be equal to the whole data length set in descriptor, otherwise data length mismatch error is generated.

When BLKCNTEN bit is not set, then the whole data length set in descriptor is a multiple of block lengths; otherwise, when data set in the descriptor nodes are not performed at block boundaries, then data mismatch errors occur.

## 39.3.4 Register bank with IP bus interface

Register accesses through the IP bus interface are on the register bank. See Figure 239 for the block diagram.

<!-- image -->

Only a 32-bit access is allowed, and no partial read/write is supported; therefore, all accesses are word aligned.

Ultra Secured Digital Host Controller (uSDHC)

Ultra Secured Digital Host Controller (uSDHC)

Access to an unimplemented address within the register memory map space does not generate a transfer error.

## 39.3.4.1 SD protocol unit

The SD protocol unit deals with all SD protocol affairs.

The SD protocol unit performs the following functions:

- Acts as the bridge between the internal buffer and the SD bus
- Sends the command data as well as its argument serially
- Stores the serial response bit stream into corresponding registers
- Detects the bus state on the CMD/DAT lines
- Monitors the interrupt from SDIO
- Asserts the read wait signal
- Gates off the SD clock when buffer is announcing danger status
- Detects the write protect state

The SD protocol unit consists of four sub-modules:

- SD control misc
- Command control
- Data control
- Clock control

## 39.3.4.2 SD control miscellaneous

In the SD control miscellaneous unit:

- The card detection (including CD\_B and DATA3 for card detection) and card interrupt are implemented.
- The module monitors the signal level on all the eight data lines and the command lines. It directly routes the level values into the register bank.
- The module also detects the Write Protect (WP) line. If WP is active, writes to memory and combo cards are ignored.

## 39.3.4.3 SD clock control

If the internal data buffer is near full (for read) or near empty (for write), the SD clock must be gated off to avoid buffer over/under-run. This module asserts the gate of the output SD clock to shut the clock off. After the buffer has space (for read) or has data (for write), the clock gate of this module opens, and the SD clock is active again.

## 39.3.4.4 Command control

The Command Control module deals with the transactions on the CMD line.

See Figure 240 for an illustration of the structure for the Command CRC shift register.

Ultra Secured Digital Host Controller (uSDHC)

<!-- image -->

The CRC polynomials for the CMD are as follows:

```
Generator polynomial: G(x) = x 7  + x 3  + 1 M(x) = (first bit) * x n  + (second bit) * x n-1  +...+ (last bit) * x 0 CRC[6:0] = Remainder [(M(x) * x 7 ) / G(x)]
```

## 39.3.4.5 Data control

The data agent deals with the transactions on the eight data lines. Moreover, this module also detects the busy state on the DATA0 line and generates the read wait state by the request from the transceiver.

The CRC polynomials for the data are as follows:

```
Generator polynomial: G(x) = x 16  + x 12  + x 5  +1 M(x) = (first bit) * x n  + (second bit) * x n-1  +...+ (last bit) * x 0 CRC[15:0] = Remainder [(M(x) * x 16 ) / G(x)]
```

## 39.3.5 Card insertion and removal detection

The uSDHC module uses either the DATA3 pin or the CD\_B pin to detect card insertion or removal. It is controlled by SoC pad or other logic. When there is no card on the eMMC/SD bus, the DATA3 is pulled to a low voltage level by default.

When any card is inserted to or removed from the socket, uSDHC detects the logic value changes on the DATA3 pin and generates an interrupt. When the DATA3 pin is not used for card detection (for example, it is implemented in GPIO), the CD\_B pin must be connected for card detection. Whether DATA3 is configured for card detection or not, the CD\_B pin is always a reference for card detection. Whether the DATA3 pin or the CD\_B pin is used to detect card insertion, uSDHC sends an interrupt (if enabled) to inform the Host system that a card is inserted.

## 39.3.6 Power management and wakeup events

When there is no operation between uSDHC and the card through the SD bus, the user can completely disable the peripheral clock and base clock in the chip-level clock control module to save power. When the user needs to use uSDHC to communicate with the card, it can enable the clock and start the operation.

In some circumstances, when the clocks to uSDHC are disabled, for instance, when the system is in low-power mode, there are some events for which the user needs to enable the clock and handle the event. These events are called wakeup interrupts. The uSDHC module can generate these interrupts even when there are no clocks enabled. The three interrupts that can be used as wakeup events are these:

- Card removal interrupt
- Card insertion interrupt
- Interrupt from SDIO (not available in multiple block data transfers)

These three wakeup events (or wakeup interrupts) can also be used to wakeup the system from low-power modes.

## NOTE

To make the interrupt a wakeup event, when all the clocks to uSDHC are disabled or when the entire system is in low power mode, the corresponding wakeup enabled bit needs to be set. Refer to Protocol Control (PROT\_CTRL) for more information on the uSDHC Protocol Control register.

## 39.3.6.1 Setting wakeup events

For uSDHC to respond to a wakeup event, the software must set the respective wakeup enable bit before the CPU enters the sleep mode. Before the software disables the host clock, it should ensure that all the following conditions have been met:

- No read or write transfer is active
- Data and command lines are not active
- No interrupts are pending
- Internal data buffer is empty

## 39.3.7 eMMC fast boot

The Embedded MultiMediaCard (eMMC4.3 or later) specification adds a fast boot feature that requires hardware support. There are two types of fast boot modes in the eMMC4.3 or later specification: boot operation and alternative boot operation. Each type also has with-acknowledge and without-acknowledge modes.

In the boot operation mode, the master (eMultiMediaCard host) can read boot data from the slave (eMMC device) by keeping CMD line low after power-on, or sending CMD0 with argument + 0xFFFFFFFA (optional for slave), before issuing CMD1.

## NOTE

For the eMMC4.3 setting, please see the eMMC4.3 specification.

## 39.3.7.1 Boot operation

If the CMD line is held low for 74 clock cycles and more after power-up before the first command is issued, the slave recognizes that boot mode is being initiated and starts preparing boot data internally.

Within one second after the CMD line goes low, the slave starts to send the first boot data to the master on the DATA line(s). The master must keep the CMD line low to read all of the boot data.

## NOTE

For the purposes of this documentation, fast boot is called "normal fast boot mode".

If boot acknowledge is enabled, the slave has to send acknowledge pattern '010' to the master within 50ms after the CMD line goes low. If boot acknowledge is disabled, the slave does not send out acknowledge pattern '010'.

The master can terminate the boot mode with the CMD line high.

The boot operation is terminated when all the contents of the enabled boot data are sent to the master. After the boot operation is executed, the slave gets ready for the CMD1 operation and the master needs to start a normal eMMC initialization sequence by sending CMD1.

Ultra Secured Digital Host Controller (uSDHC)

Ultra Secured Digital Host Controller (uSDHC)

Figure 241. Embedded MultiMediaCard state diagram (normal boot mode)

<!-- image -->

## 39.3.7.2 Alternative boot operation

This boot function is optional for the device. If bit 0 in the extended CSD byte[228] is set to '1', the device supports the alternative boot operation.

After power-up, if the host issues CMD0 with the argument of 0xFFFFFFFA after 74 clock cycles, before CMD1 is issued or the CMD line goes low, the slave recognizes that boot mode is being initiated and starts preparing boot data internally.

Within one second after CMD0 with the argument of 0xFFFFFFFA is issued, the slave starts to send the first boot data to the master on the DATA line(s).

If boot acknowledge is enabled, the slave must send the acknowledge pattern '010' to the master within 50ms after the CMD0 with the argument of 0xFFFFFFFA is received. If boot acknowledge is disabled, the slave does not send out acknowledge pattern '010'.

The master can terminate the boot mode by issuing CMD0 (Reset).

Boot operation is terminated when all the contents of the enabled boot data are sent to the master. After the boot operation is executed, the slave gets ready for the CMD1 operation and the master needs to start a normal eMMC initialization sequence by sending CMD1.

<!-- image -->

## 39.3.8 Commands for SD card, SDIO, and eMMC

A table containing the list of commands for the eMMC/SD card/SDIO is provided here.

Refer to the corresponding specifications for more details about the command information.

There are four kinds of commands defined to control the SD card, SDIO, and eMMC:

- Broadcast commands (bc), no response
- Broadcast commands with response (bcr), response from all cards simultaneously
- Addressed (point-to-point) commands (ac), no data transfer on the DATA
- Addressed (point-to-point) data transfer commands (adtc)

Response: A response is a token that is sent from the card to the host as an answer to a previously received command. A response is transferred serially on the CMD line.

Table 255. Commands for eMMC/SD card/SDIO

| CMD INDEX   | Type   | Argument                                                                                                                                                                                  | Response type   | Abbreviation             | Description                                                                                                                           |
|-------------|--------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------|
| CMD0        | bc     | [31:0] stuff bits                                                                                                                                                                         | -               | GO_IDLE_STATE            | Resets all eMMC and SD memory cards to idle state.                                                                                    |
| CMD1        | bcr    | [31:0] OCR without busy                                                                                                                                                                   | R3              | SEND_OP_COND             | Asks all eMMC and SD Memory cards in idle state to send their operation conditions register contents in the response on the CMD line. |
| CMD2        | bcr    | [31:0] stuff bits                                                                                                                                                                         | R2              | ALL_SEND_CID             | Asks all cards to send their CID numbers on the CMD line.                                                                             |
| CMD3 1      | ac     | [31:6] RCA [15:0] stuff bits                                                                                                                                                              | R1 R6 (SDIO)    | SET/ SEND_RELATIVE_AD DR | Assigns relative address to the card.                                                                                                 |
| CMD4        | bc     | [31:0] DSR [15:0] stuff bits                                                                                                                                                              | -               | SET_DSR                  | Programs the DSR of all cards.                                                                                                        |
| CMD5        | bc     | [31:0] OCR without busy                                                                                                                                                                   | R4              | IO_SEND_OP_COND          | Asks all SDIO in idle state to send them operation conditions register contents in the response on the CMD line.                      |
| CMD6 2      | adtc   | [31] Mode 0: Check function 1: Switch function [30:8] Reserved for function groups 6 ~ 3 (All 0 or 0xFFFF) [7:4] Function group1 for command system [3:0] Function group2 for access mode | R1              | SWITCH_FUNC              | Checks switch ability (mode 0) and switch card function (mode1). Refer to "SD Physical Specification V1.1" for more details.          |
| CMD6 3      | ac     | [31:26] Set to 0 [25:24] Access                                                                                                                                                           | R1b             | SWITCH                   | Switches the mode of operation of the selected card or modifies the EXT_CSD registers. Refer to "The                                  |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

Table 255. Commands for eMMC/SD card/SDIO (continued)

| CMD INDEX   | Type     | Argument                                                | Response type   | Abbreviation          | Description                                                                                                                                                                                                                                   |
|-------------|----------|---------------------------------------------------------|-----------------|-----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|             |          | [23:16] Index [15:8] Value [7:3] Set to 0 [2:0] Cmd Set |                 |                       | EmbeddedMultiMediaCard System Specification Version 4.0 Final draft 2" for more details.                                                                                                                                                      |
| CMD7        | ac       | [31:6] RCA [15:0] stuff bits                            | R1b             | SELECT/ DESELECT_CARD | Toggles a card between the stand- by and transfer states or between the programming and disconnect states. In both cases, the card is selected by its own relative address and gets deselected by any other address. Address 0 deselects all. |
| CMD8        | adtc     | [31:0] stuff bits                                       | R1              | SEND_EXT_CSD          | The card sends its EXT_CSD register as a block of data, with a block size of 512 bytes.                                                                                                                                                       |
| CMD9        | ac       | [31:6] RCA [15:0] stuff bits                            | R2              | SEND_CSD              | Addressed card sends its card- specific data (CSD) on the CMD line.                                                                                                                                                                           |
| CMD10       | ac       | [31:6] RCA [15:0] stuff bits                            | R2              | SEND_CID              | Addressed card sends its card- identification (CID) on the CMDline.                                                                                                                                                                           |
| CMD11       | adtc     | [31:0] data address                                     | R1              | READ_DAT_UNTIL_S TOP  | Reads data stream from the card, starting at the given address, until a STOP_TRANSMISSION follows.                                                                                                                                            |
| CMD12       | ac       | [31:0] stuff bits                                       | R1b             | STOP_TRANSMISSIO N    | Forces the card to stop transmission.                                                                                                                                                                                                         |
| CMD13       | ac       | [31:6] RCA [15:0] stuff bits                            | R1              | SEND_STATUS           | Addressed card sends its status register.                                                                                                                                                                                                     |
| CMD14       | Reserved | Reserved                                                | Reserved        | Reserved              | Reserved                                                                                                                                                                                                                                      |
| CMD15       | ac       | [31:6] RCA [15:0] stuff bits                            | -               | GO_INACTIVE_STAT E    | Sets the card to inactive state in order to protect the card stack against communication breakdowns.                                                                                                                                          |
| CMD16       | ac       | [31:0] block length                                     | R1              | SET_BLOCKLEN          | Sets the block length (in bytes) for all following block commands (read and write). Default block length is specified in the CSD.                                                                                                             |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

Table 255. Commands for eMMC/SD card/SDIO (continued)

| CMD INDEX   | Type     | Argument                                                             | Response type   | Abbreviation          | Description                                                                                                                                                                                                                           |
|-------------|----------|----------------------------------------------------------------------|-----------------|-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CMD17       | adtc     | [31:0] data address                                                  | R1              | READ_SINGLE_BLO CK    | Reads a block of the size selected by the SET_BLOCKLEN command.                                                                                                                                                                       |
| CMD18       | adtc     | [31:0] data address                                                  | R1              | READ_MULTIPLE_BL OCK  | Continuously transfers data blocks from card to host until interrupted by a stop command.                                                                                                                                             |
| CMD19       | adtc     | [31:0] reserved bits(all 0)                                          | R1              | SEND_TUNING_BLO CK    | 64 bytes tuning pattern is sent for SDR50 and SDR104.                                                                                                                                                                                 |
| CMD20       | adtc     | [31:0] data address                                                  | R1              | WRITE_DAT_UNTIL_ STOP | Writes data stream from the host, starting at the given address, until a STOP_TRANSMISION follows.                                                                                                                                    |
| CMD21       | adtc     | [31:0] stuff bits                                                    | R1              | SEND_TUNING_BLO CK    | 128 clocks of tuning pattern (64 byte in 4 bit mode or 128 byte in 8 bit mode) is sent for HS200 optimal sampling point detection.                                                                                                    |
| CMD22       | Reserved | Reserved                                                             | Reserved        | Reserved              | Reserved                                                                                                                                                                                                                              |
| CMD23       | ac       | [31] reliable write request [30:16] set to 0 [15:0] number of blocks | R1              | SET_BLOCK_COUNT       | Defines the number of blocks (read/write) and the reliable writer parameter (write) for a block read or write command.                                                                                                                |
| CMD24       | adtc     | [31:0] data address                                                  | R1              | WRITE_BLOCK           | Writes a block of the size selected by the SET_BLOCKLEN command.                                                                                                                                                                      |
| CMD25       | adtc     | [31:0] data address                                                  | R1              | WRITE_MULTIPLE_B LOCK | Continuously writes blocks of data until a STOP_TRANSMISSION follows.                                                                                                                                                                 |
| CMD26       | adtc     | [31:0] stuff bits                                                    | R1              | PROGRAM_CID           | Programming of the card identification register. This command is issued only once per card. The card contains hardware to prevent this operation after the first programming. Normally this command is reserved for the manufacturer. |
| CMD27       | adtc     | [31:0] stuff bits                                                    | R1              | PROGRAM_CSD           | Programming of the programmable bits of the CSD.                                                                                                                                                                                      |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

Table 255. Commands for eMMC/SD card/SDIO (continued)

| CMD INDEX   | Type     | Argument                            | Response type   | Abbreviation           | Description                                                                                                                                                                                         |
|-------------|----------|-------------------------------------|-----------------|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CMD28       | ac       | [31:0] data address                 | R1b             | SET_WRITE_PROT         | If the card has write protection features, this command sets the write protection bit of the addressed group. The properties of write protection are coded in the card specific data (WP_GRP_SIZE). |
| CMD29       | ac       | [31:0] data address                 | R1b             | CLR_WRITE_PROT         | If the card provides write protection features, this command clears the write protection bit of the addressed group.                                                                                |
| CMD30       | adtc     | [31:0] write protect data address   | R1              | SEND_WRITE_PROT        | If the card provides write protection features, this command asks the card to send the status of the write protection bits.                                                                         |
| CMD31       | Reserved | Reserved                            | Reserved        | Reserved               | Reserved                                                                                                                                                                                            |
| CMD32       | ac       | [31:0] data address                 | R1              | TAG_SECTOR_STAR T      | Sets the address of the first sector of the erase group.                                                                                                                                            |
| CMD33       | ac       | [31:0] data address                 | R1              | TAG_SECTOR_END         | Sets the address of the last sector in a continuous range within the selection of a single sector to be selected for erase.                                                                         |
| CMD34       | ac       | [31:0] data address                 | R1              | UNTAG_SECTOR           | Removes one previously selected sector from the erase selection.                                                                                                                                    |
| CMD35       | ac       | [31:0] data address                 | R1              | TAG_ERASE_GROUP _START | Sets the address of the first erase group within a range to be selected for erase.                                                                                                                  |
| CMD36       | ac       | [31:0] data address                 | R1              | TAG_ERASE_GROUP _END   | Sets the address of the last erase group within a continuous range to be selected for erase.                                                                                                        |
| CMD37       | ac       | [31:0] data address                 | R1              | UNTAG_ERASE_GR OUP     | Removes one previously selected erase group from the erase selection.                                                                                                                               |
| CMD38       | ac       | [31:0] stuff bits                   | R1b             | ERASE                  | Erase all previously selected sectors.                                                                                                                                                              |
| CMD39       | ac       | [31:0] RCA [15] register write flag | R4              | FAST_IO                | Used to write and read 8-bit (register) data fields. The command addresses a card, and a register,                                                                                                  |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

Table 255. Commands for eMMC/SD card/SDIO (continued)

| CMD INDEX   | Type     | Argument                                    | Response type   | Abbreviation          | Description                                                                                                                                                                                                               |
|-------------|----------|---------------------------------------------|-----------------|-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|             |          | [14:8] register address [7:0] register data |                 |                       | and provides the data for writing if the write flag is set. The R4 response contains data read from the address register.Thiscommand accesses application dependent registers which are not defined in the eMMC standard. |
| CMD40       | bcr      | [31:0] stuff bits                           | R5              | GO_IRQ_STATE          | Sets the system into interrupt mode.                                                                                                                                                                                      |
| CMD41       | Reserved | Reserved                                    | Reserved        | Reserved              | Reserved                                                                                                                                                                                                                  |
| CDM42       | adtc     | [31:0] stuff bits                           | R1b             | LOCK_UNLOCK           | Used to set/reset the password or lock/unlock the card. The size of the data block is set by the SET_BLOCK_LEN command.                                                                                                   |
| CMD43~51    | Reserved | Reserved                                    | Reserved        | Reserved              | Reserved                                                                                                                                                                                                                  |
| CMD52       | ac       | [31:0] stuff bits                           | R5              | IO_RW_DIRECT          | Access a single register within the total 128k of register space in any I/O function.                                                                                                                                     |
| CMD53       | ac       | [31:0] stuff bits                           | R5              | IO_RW_EXTENDED        | Accesses a multiple I/O register with a single command. Allows the reading or writing of a large number of I/O registers.                                                                                                 |
| CMD54       | Reserved | Reserved                                    | Reserved        | Reserved              | Reserved                                                                                                                                                                                                                  |
| CMD55       | ac       | [31:16] RCA [15:0] stuff bits               | R1              | APP_CMD               | Indicates to the card that the next command is an application specific command rather than a standard command.                                                                                                            |
| CMD56       | adtc     | [31:1] stuff bits [0]: RD/WR                | R1b             | GEN_CMD               | Used either to transfer a data block to the card or to get a data block from the card for general purpose / application specificcommands.The size of the data block is set by the SET_BLOCK_LEN command.                  |
| CMD57-59    | Reserved | Reserved                                    | Reserved        | Reserved              | Reserved                                                                                                                                                                                                                  |
| CMD60       | adtc     | [31] WR [30:24] stuff bits [23:16] address  | R1b             | RW_MULTIPLE_REGI STER | These registers are used to control the behavior of the device and to retrieve status information regarding the operation of the                                                                                          |

Table continues on the next page...

Table 255. Commands for eMMC/SD card/SDIO (continued)

| CMD INDEX   | Type     | Argument                                          | Response type   | Abbreviation            | Description                                                                                                                                   |
|-------------|----------|---------------------------------------------------|-----------------|-------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|
|             |          | [15:8] stuff bits [7:0] byte count                |                 |                         | device. All Status and Control registers are WORD (32-bit) in size and are WORD aligned. CMD60 is used to read and write these registers.     |
| CMD61       | adtc     | [31] WR [30:16] stuff bits [15:0] data unit count | R1b             | RW_MULTIPLE_BLO CK      | The host issues a RW_MULTIPLE_BLOCK (CMD61) to begin the data transfer.                                                                       |
| CMD62-63    | Reserved | Reserved                                          | Reserved        | Reserved                | Reserved                                                                                                                                      |
| ACMD6 4     | ac       | [31:2] stuff bits [1:0] bus width                 | R1              | SET_BUS_WIDTH           | Defines the data bus width ('00'=1bit or '10'=4bit bus) to be used for data transfer. The allowed data bus widths are given in SCR register.  |
| ACMD13 4    | adtc     | [31:0] stuff bits                                 | R1              | SD_STATUS               | Send the SD Memory Card status.                                                                                                               |
| ACMD22 4    | adtc     | [31:0] stuff bits                                 | R1              | SEND_NUM_WR_SE CTORS    | Send the number of the written sectors (without errors). Responds with 32-bit plus the CRCdata block.                                         |
| ACMD23 4    | ac       | [31:23] stuff bits [22:0] Number of blocks        | R1              | SET_WR_BLK_ERAS E_COUNT | Set the number of write blocks to be pre-erased before writing (to be used for fast Multiple Block WR command). "1"=default(one write block). |
| ACMD41 4    | bcr      | [31:0] OCR                                        | R3              | SD_APP_OP_COND          | Asks the accessed card to send its operating condition register (OCR) contents in the response on the CMD line.                               |
| ACMD42 4    | ac       | [31:1] stuff bits [0] set_cd                      | R1              | SET_CLR_CARD_DE TECT    | Connect(1)/Disconnect(0) the 50KOhm pull-up resistor on CD_B/ DATA3 of the card.                                                              |
| ACMD51 4    | adtc     | [31:0] stuff bits                                 | R1              | SEND_SCR                | Reads the SD Configuration Register (SCR).                                                                                                    |

1. CMD3 differs for eMMC and SD cards. For eMMC, it is referred to as SET\_RELATIVE\_ADDR, with a response type of R1. For SD cards, it is referred to as SEND\_RELATIVE\_ADDR, with a response type of R6 (with RCA inside).
3. Command SWITCH is for high speed eMMC. The Index field can contain any value from 0-255, but only values 0-191 are valid. If the Index value is in the 192-255 range the card does not perform any modification and the SWITCH\_ERROR status bit in the EXT\_CSD register is set. The Access Bits are shown in Table 256.
2. CMD6 differs completely between high speed eMMC and high-speed SD cards. Command SWITCH\_FUNC is for highspeed SD cards.

Ultra Secured Digital Host Controller (uSDHC)

Ultra Secured Digital Host Controller (uSDHC)

4. ACMDs is preceded with the APP\_CMD command. Commands listed are used for SD only, other SD commands not listed are not supported on this module.

The access bits for the EXT\_CSD access modes are listed in the following table.

## Table 256. EXT\_CSD access modes

|   Bits | Access name   | Operation                                                                                    |
|--------|---------------|----------------------------------------------------------------------------------------------|
|     00 | Command set   | The command set is changed according to the Cmd Set field of the argument.                   |
|     01 | Set bits      | The bits in the pointed byte are set, according to the bits set to 1 in the Value field.     |
|     10 | Clear bits    | The bits in the pointed byte are cleared, according to the bits set to 1 in the Value field. |
|     11 | Write byte    | The Value field is written into the pointed byte.                                            |

## 39.3.9 SDIO interrupt

Information on interrupts in 1-bit mode, interrupts in 4-bit mode, and card interrupt handling are detailed in the sections below.

## 39.3.9.1 Interrupts in 1-bit mode

In this case, the DATA1 pin provides the interrupt function. An interrupt is asserted by pulling the DATA1 low from SDIO, until the interrupt service is finished to clear the interrupt.

## 39.3.9.2 Interrupt in 4-bit mode

As the interrupt and data line 1 share pin 8 in a 4-bit mode, an interrupt is only sent by the card and recognized by the host during a specific time. This is known as the interrupt period. The uSDHC module only provides samples the level on pin 8 during the interrupt period. At all other times, the host treats it as the data signal. The definition of the interrupt period is different for operations with single block and multiple block data transfers.

In the case of normal single data block transmissions, the interrupt period becomes active two clock cycles after the completion of a data packet. This interrupt period lasts until after the card receives the end bit of the next command that has a data block transfer associated with it.

For multiple block data transfers in a 4-bit mode, there is only a limited period of time that the interrupt period can be active because of the limited period of data line availability between the multiple blocks of data. This requires stricter definition of the interrupt period. For this case, the interrupt period is limited to two clock cycles. This begins two clocks after the end bit of the previous data block. During this 2-clock cycle interrupt period, if an interrupt is pending, the DATA1 line holds low for one clock cycle, then pulls high for the next clock cycle . On completion of the interrupt period, the card releases the DATA1 line into the high Z state. The uSDHC module provides sample of the DATA1 during the interrupt period when the IABG bit in the Protocol Control register is set.

Refer to SDIO Specification v1.10 for further information about the SDIO interrupt.

## 39.3.9.3 Card interrupt handling

When the CINTIEN bit in the Interrupt Signal Enable Register is set to 0, uSDHC clears the interrupt request to the host system. The host driver should clear this bit before servicing the SDIO interrupt, and should set this bit again after all interrupt requests from the card are cleared to prevent inadvertent interrupts.

The SDIO Interrupt Status can be cleared by writing 1 to this bit. But as the interrupt source from SDIO does not clear, this bit is set again. To clear this bit, it is required to reset the interrupt source from the external card followed by writing 1 to this bit. In a 1-bit mode, uSDHC detects the SDIO interrupt with or without the SD clock (to support wakeup). In a 4-bit mode, the interrupt signal is sampled during the interrupt period, so there are some sample delays between the interrupt signal from SDIO and the interrupt to the Host System Interrupt Controller. When the SDIO status is set and the host driver needs to service this interrupt, the SDIO bit in the Interrupt Control Register of SDIO is cleared. This is required to clear the SDIO interrupt status latched in uSDHC and to stop driving the interrupt signal to the System Interrupt Controller. The host driver must issue a CMD52 to clear the card interrupt. After

Ultra Secured Digital Host Controller (uSDHC)

completion of the card interrupt service, the SDIO Interrupt Status Enable bit is set to 1 and uSDHC starts sampling the interrupt signal again.

See Figure 243 for an illustration of the SDIO interrupt scheme and for the sequences of software and hardware events that take place during a card interrupt handling procedure.

<!-- image -->

## 39.3.10 Speed mode selection

To switch to HS200 or HS400 from High Speed (26 MHz-52 MHz), see the procedure below.

## NOTE

While the actual timing change is done, the behavior of any command given (such as CMD13) cannot be guaranteed due to the asynchronous operation. Therefore, you must not use CMD13 to check the busy completion of the timing change indication. In case, CMD13 is used, the host must ignore CRC errors, if appear.

The max frequency for HS200 mode and HS400 mode could be slower than 200 MHz based on the chip implementation, you must set the target frequency for these two speed modes accordingly. Following sections describe the mode selections for HS200 mode and HS400 mode in detail.

## 39.3.10.1 HS200 mode selection

To switch to HS200, the Driver must perform the following steps:

Ultra Secured Digital Host Controller (uSDHC)

1. Select the chip (through sending CMD7) and make sure it is unlocked (through CMD42).
2. Read the DEVICE\_TYPE [196] field of the Extended CSD register to validate if the chip supports HS200 at the IO voltage appropriate for both host and chip (through CMD8).
3. Read the DRIVER\_STRENGTH [197] field of the Extended CSD register to find the supported chip Driver Strengths (through CMD8). The default setting is 50 Ohm. The Host Designer might simulate its specific system, using a device driver models. Host can select the optimal Driver Type that might drive the host system load at the required operating frequency with the minimal noise generated.

NOTE

This step can be skipped if changes of Driver strength is not needed.

4. Check the setting of PROT\_CTRL[DTW], make sure the data transfer width is set as expected.

Make sure the I/O pad voltage is 1.8V and corresponding drive strength is set to proper value.

Set HS200 bit and Driver Strength value in the HS\_TIMING [185] field of the Extended CSD register by issuing CMD6. If the host attempts to write an invalid value, the HS\_TIMING byte is not changed, the HS200 interface timing is not enabled, the Driver Strength is not changed, and the SWITCH\_ERROR field is set. After the chip responds with R1, it might assert Busy signal. Once the busy signal gets de-asserted, the host may send a SEND\_STATUS Command (CMD13) using the HS200 timing and after it receives a Trans State indication and No Error it means that the chip is set to HS200 timing and the Driver Strength is set to the selected settings.

5. At this point, the host can set the frequency to ≤ 200 MHz.
6. The host might invoke the HS200 standard tuning procedure, by sending CMD21 to the chip.

## NOTE

The host must switch to the required bus width before starting the tuning operation to allow the tuning sequence to be done using the proper bus operating conditions.

## 39.3.10.2 Standard tuning procedure

By default, lower frequency operation, a fixed sampling clock is used to receive signals on CMD and DAT[3:0]. Before using the HS200, HS400, SDR104, or SDR50 modes, the Host Driver executes the tuning procedure at the mode switch sequence.

1. Issue uSDHC SW reset, set SYS\_CTRL[RSTT] to 1.
2. Clear VEND\_SPEC[FRC\_SDCLK\_ON] to 0.
3. Clean the history status by following these steps:
- a. Clear AUTOCMD12\_ERR\_STATUS[EXECUTE\_TUNING] to 0.
- b. Read Auto CMD12 Error Status (AUTOCMD12\_ERR\_STATUS) until AUTOCMD12\_ERR\_STATUS[EXECUTE\_TUNING] reads 0.
- c. Write 1 to clear INT\_STATUS[BRR].
4. Set TUNING\_CTRL to 0x01312880 to enable the standard tuning and disable the CMD line check.
5. Start the tuning procedure by setting AUTOCMD12\_ERR\_STATUS[EXECUTE\_TUNING] to 1.
6. Issue CMD19(SD) / CMD21(eMMC) with the proper Command Transfer Type (CMD\_XFR\_TYP) and Mixer Control (MIX\_CTRL) settings.
7. Wait for uSDHC BRR (Buffer Read Ready) interrupt signal is 1.
8. Check AUTOCMD12\_ERR\_STATUS[EXECUTE\_TUNING]. If AUTOCMD12\_ERR\_STATUS[EXECUTE\_TUNING] = 1, write 1 to clear INT\_STATUS[BRR] and then repeat steps 6~7. If AUTOCMD12\_ERR\_STATUS[EXECUTE\_TUNING] = 0, standard tuning has completed, or the tuning has not completed within 40 attempts. The Host Driver might abort this loop if the number of loops exceeds 40 or 150 ms timeout occurs. In this case, a fixed sampling clock should be used (AUTOCMD12\_ERR\_STATUS[SMP\_CLK\_SEL] = 0).

Ultra Secured Digital Host Controller (uSDHC)

9. Sampling Clock Select (AUTOCMD12\_ERR\_STATUS[SMP\_CLK\_SEL]) is valid after AUTOCMD12\_ERR\_STATUS[EXECUTE\_TUNING] has changed from 1 to 0. AUTOCMD12\_ERR\_STATUS[SMP\_CLK\_SEL] = 1, indicates tuning procedure passed. AUTOCMD12\_ERR\_STATUS[SMP\_CLK\_SEL] = 0, indicates tuning procedure failed. The tuning result is applied to the delay chain, CLK Tuning Control and Status (CLK\_TUNE\_CTRL\_STATUS) [30:16], upon the successful tuning procedure completion.
10. Set MIX\_CTRL[AUTO\_TUNE\_EN] to 1.

While the tuning sequence is being performed, the Host Controller does not generate interrupts (including Command Complete), except Buffer Read Ready. CMD19 response errors are not indicated.

Writing AUTOCMD12\_ERR\_STATUS[SMP\_CLK\_SEL] to 0 forces the Host Controller to use a fixed sampling clock and resets the tuning circuit of the Host Controller.

## NOTE

- There could be slight difference on delay cell delay in each project, and this difference can lead to different loop number needed. TUNING\_CTRL[TUNING\_STEP] can be used to control how may taps are to be added for each step.
- Manual tuning might be required in cases where standard tuning is not able to close passing window with CMD19/21 transfer fail.

## 39.3.10.3 Manual tuning procedure

Manual tuning controls more details in the tuning procedure, and some corner cases. Manual tuning provides control to tuning start point, tuning steps, and delay chains. To start manual tuning:

1. Clear TUNING\_CTRL[STD\_TUNING\_EN] to 0.
2. Clear VEND\_SPEC[FRC\_SDCLK\_ON] and MIX\_CTRL[FBCLK\_SEL] to 0, set MIX\_CTRL[SMP\_CLK\_SEL] and MIX\_CTRL[EXE\_TUNE] to 1 to start tuning.
3. Set SYS\_CTRL[RSTA] to 1, and wait for self-clear.
4. Config delay chain, CLK\_TUNE\_CTRL\_STATUS[DLY\_CELL\_SET\_PRE] with the valueA.

## NOTE

The valueA must start from 0.

5. Set SYS\_CTRL[RST\_FIFO] to 1 and wait for self-clear.
6. Send CMD19/21 to card.
7. Poll for CC, CIE, CEBE, CCE and CTOE of Interrupt Status (INT\_STATUS) assertion.
8. Poll for TC, DEBE, DCE and DTOE of Interrupt Status (INT\_STATUS) assertion.
9. Check TP of Interrupt Status (INT\_STATUS); TP = 1 &amp; no command/data error indicates the current CMD19/21 transfer is passed; otherwise, indicates failed.
10. If TP = 0 or command/data error is observed, increase the valueA with the required tuning step(1 to 127) and repeat steps 3~9.
11. If TP = 1 &amp; no command/data error is met after a loop with TP=0 (or command/data error), save the current valueA as value\_start. Increase valueA with the required tuning step, and repeat steps 3~9 until TP = 0 (or command/data error) again. Save the current valueA as value\_end.
12. Clear MIX\_CTRL[EXE\_TUNE] to 0.
13. Set SYS\_CTRL[RSTA] to 1, and wait for self-clear.
14. Set MIX\_CTRL[SMP\_CLK\_SEL] to 1.

Ultra Secured Digital Host Controller (uSDHC)

15. Set bit[14:0] of CLK Tuning Control and Status (CLK\_TUNE\_CTRL\_STATUS) with the output of expression {[(((value\_start+value\_end)/2)&lt; &lt; 8)&amp; 0xffffff00] -0x300 } | 0x33.
16. Poll bit[30:16] of CLK Tuning Control and Status (CLK\_TUNE\_CTRL\_STATUS) until the value written in the previous step is read.
17. Set MIX\_CTRL[AUTO\_TUNE\_EN] to 1.

The manual tuning procedure defines a passing window, inside which the tuned clock can capture the correct data, and delay chain is to be configured as centered within the passing window.

It is not a fixed flow as the standard tuning. Any step can be changed based on the real case. In cases where passing window is not closed with a tuning fail, the center of the passing region must be applied for the delay chain setting. In cases where two passing windows separated by tuning fail(s) is observed, the center of the first passing window must be applied for the delay chain setting.

## NOTE

Both the standard tuning and manual tuning are only for tuning of SD\_CLK, cannot be used to tune STROBE clock of HS400 and HS400 enhanced mode.

## 39.3.10.4 Switch to HS400 mode

The valid IO voltage for HS400 is 1.8 V. The bus width is set to only DDR 8bit in HS400 mode. HS400 supports the same commands as DDR52. To switch to HS400 mode, the host must perform the following steps:

1. Initialize chip with 'Backward Compatible Timings", after power-on or software reset (CMD0), the interface timing of the chip is set as the default "Backward Compatible Timing".
2. Select the chip with CMD7.
3. Read the DEVICE\_TYPE [196] field of the Extended CSD register to validate whether the chip supports HS400 by sending CMD8.
4. Read the DRIVER\_STRENGTH [197] field of the Extended CSD register to find the supported chip's Driver Strengths by sending CMD8.
5. Set the "Selected Driver Strength" parameter in the HS\_TIMING [185] field of the Extended CSD register to the appropriate driver strength for HS400 operation and set the "Timing Interface" parameter to 0x2 to switch to HS200 mode with CMD6. Send CMD13 to make sure mode switch to HS200 mode has been successfully done.
6. Perform the tuning procedure (standard or manual) at the HS400 target operating frequency, save the tuning result (68h [30:16]) and clear std\_tuning\_en.

You may skip this step if changes of driver strength is not needed.

## NOTE

## NOTE

Tuning procedure in HS200 mode is required to synchronize the command response on the CMD line to CLK for HS400 operation.

7. Set the "Timing Interface" parameter in the HS\_TIMING [185] field of the Extended CSD register to 0x1 to switch to High Speed mode with CMD6 and then set the clock frequency to a value not greater than 52 MHz.
8. Set BUS\_WIDTH[183] to 0x06 to select the dual data rate x8 bus mode. Check the setting of PROT\_CTRL[DTW]. Make sure the data transfer width is set as expected.
9. Set the "Timing Interface" parameter in the HS\_TIMING [185] field of the Extended CSD register to 0x3 to switch to HS400 mode with CMD6. Set the MIX\_CTRL[DDR\_EN] and MIX\_CTRL[HS400\_MODE] to 1 to enable HS400 mode in controller.
10. Set bit[14:0] of CLK Tuning Control and Status (CLK\_TUNE\_CTRL\_STATUS) with saved tuning result value of 0x68 from standard tuning flow in step 6).

Ultra Secured Digital Host Controller (uSDHC)

11. Poll bit[30:16] of CLK Tuning Control and Status (CLK\_TUNE\_CTRL\_STATUS) until the value written in the step 10 is read.
12. Set MIX\_CTRL[SMP\_CLK\_SEL] to 1'b1 to apply the delay on capture clock of CMD channel, then set the clock frequency to ≤ 200 MHz.

Ensure that uSDHC function clock source is 2x HS400 mode target frequency, and both SDCLKFS and DVS are configured to 0.

13. Set Strobe DLL control (STROBE\_DLL\_CTRL) to 0x00400039 to have strobe clock automatically tuned to 1/4 cycle of input ipp\_strobe to capture data. Ensure that both STROBE\_DLL\_STATUS[STROBE\_DLL\_STS\_REF\_LOCK] and STROBE\_DLL\_STATUS[STROBE\_DLL\_STS\_SLV\_LOCK] are set before any transfer is started.

NOTE

For speed mode switch like from High Speed mode to HS200 mode or HS400(enhanced) mode, you must calibrate the right configuration of slew rate and drive strength for chip pad that are used for uSDHC.

## 39.3.10.5 Switch to HS400 enhanced mode

This selection flow describes how to initialize the eMMC device in HS400 mode while enabling enhanced strobe without the need for tuning procedure. To switch to HS400 mode with enhanced strobe, the host must perform the following steps:

1. Initialize device with "Backward Compatible Timings", after power-on or software reset (CMD0), the interface timing of the device is set as the default "Backward Compatible Timing".
2. Select the device with CMD7
3. Read the DEVICE\_TYPE [196] field of the Extended CSD register to validate whether the device supports HS400 with CMD8.
4. Read the STROBE\_SUPPORT[184] field of the Extended CSD register to validate whether the device supports enhanced strobe with CMD8.
5. Set the "Timing Interface" parameter in the HS\_TIMING [185] field of the Extended CSD register to 0x1 to switch to High Speed mode by sending CMD6 and then set the clock frequency to a value not greater than 52 MHz.
6. Set BUS\_WIDTH[183] to 0x86 to select the dual data rate x8 bus mode and enable enhanced strobe (this is active only after HS400 mode is selected) with CMD6. Check the setting of PROT\_CTRL[DTW]. Make sure the data transfer width is set as expected.
7. Read the DRIVER\_STRENGTH [197] field of the Extended CSD register to find the supported device Driver Strengths with CMD8.

NOTE

You may skip this step if changes of driver strength is not needed, if needed host may change the device Driver Strength.

8. Set the "Timing Interface" parameter in the HS\_TIMING [185] field of the Extended CSD register to 0x3 to switch to HS400 mode with CMD6.
9. Set the MIX\_CTRL[DDR\_EN], MIX\_CTRL[HS400\_MODE], and MIX\_CTRL[EN\_HS400\_MODE] bits to 1 to enable enhanced HS400 mode in controller.
10. Host may set the clock frequency to a value not greater than 200 MHz. Ensure uSDHC function clock source is 2x HS400 mode target frequency, and both SDCLKFS and DVS are configured to 0 .
11. Set Strobe DLL control (STROBE\_DLL\_CTRL) to 0x00400039 to have strobe clock automatically delayed 1/4 cycle of input ipp\_strobe to capture data. Make sure both STROBE\_DLL\_STATUS[STROBE\_DLL\_STS\_REF\_LOCK] and STROBE\_DLL\_STATUS[STROBE\_DLL\_STS\_SLV\_LOCK] are set before any transfer is started.

## NOTE

For speed mode switch like from high speed mode to HS200 mode or HS400(enhanced) mode, may must calibrate the right configuration of slew rate and drive strength for chip pad that are used for uSDHC.

## 39.3.11 Software restrictions

## 39.3.11.1 Initialization active

The driver cannot set INITA bit in System Control register when any of the command line or data lines are active, so the driver must ensure both CDIHB and CIHB bits are cleared.

## 39.3.11.2 Software polling procedure

For polling read or write, after the software begins a buffer read or write, it must access exactly the number of times as the values set in the Watermark Level Register; moreover, if the block size is not a multiple of the value in the Watermark Level Register (read and write respectively), the software must access exactly the remaining number of words at the end of each block. For example, for a read operation, if the RD\_WML is 4, indicating the watermark level is 16 bytes, block size is 40 bytes, and the block number is 2, then the access times for the burst sequence in the whole transfer process must be 4, 4, 2, 4, 4, 2.

## 39.3.11.3 Suspend operation

To suspend the data transfer, the software must inform uSDHC that the suspend command is successfully accepted. To achieve this, after the Suspend command is accepted by SDIO, software must send another normal command marked as suspend command (CMDTYP bits set as '01') to inform uSDHC that the transfer is suspended.

If software needs to resume the suspended transfer, it should read the value in BLKCNT register to save the remaining number of blocks before sending the normal command marked as suspend, otherwise on sending such a 'suspend' command, uSDHC treats the current transfer is aborted and change the BLKCNT register to its original value, instead of retaining the remaining number of blocks.

## 39.3.11.4 Data length setting

For either ADMA (ADMA1 or ADMA2) transfer, the data in the data buffer must be word aligned, so the data length set in the descriptor must be a multiple of 4.

ADMA1 is 4KB aligned.

## 39.3.11.5 (A)DMA address setting

To configure the ADMA1/ADMA2/DMA address register, when TC bit is set, the register always updates itself with the internal address value to support dynamic address synchronization, so the software must ensure that the TC bit is cleared prior to configuring the ADMA1/ADMA2/DMA address register.

## 39.3.11.6 Data port access

Data port does not support parallel access. For example, during an internal DMA access, it is not allowed to write any data to the data port by CPU; or during a CPU read operation, it is also prohibited to write any data to the data port, by either CPU or internal DMA. Otherwise the data is corrupted inside the uSDHC buffer.

## 39.3.11.7 Change clock frequency

The uSDHC module does not automatically gate off the card clock when the host driver changes the clock frequency. To prevent possible glitch on the card clock, clear the FRC\_SDCLK\_ON bit when changing the clock divisor value (SDCLKFS or DVS in System Control Register) or setting the RSTA bit.

Also, before changing the clock divisor value, the host driver should make sure that the SDSTB bit is high.

Ultra Secured Digital Host Controller (uSDHC)

## 39.3.11.8 Multi-block read

For pre-defined multi-block read operation, that is, the number of blocks to read has been defined by previous CMD23 for eMMC, or pre-defined number of blocks in CMD53 for SDIO/SDCombo, or whatever multi-block read without abort command at card side, an abort command, either automatic or manual CMD12/CMD52, is still required by uSDHC after the pre-defined number of blocks are done, to drive the internal state machine to idle mode. In this case, the card may not respond to this extra abort command and uSDHC gets response timeout. It is recommended to manually send an abort command with RSPTYP[1:0] both bits cleared.

## 39.3.12 Clocking

The table found here describes the clock sources for uSDHC. For more information on clocking, see the Clocking chapter.

Table 257. Clocks

| Clock name     | Description      |
|----------------|------------------|
| hclk           | Bus clock        |
| ipg_clk        | Peripheral clock |
| ipg_clk_perclk | Base clock       |
| ipg_clk_lp     | Low power clock  |

## 39.3.12.1 Clock and reset manager

This module controls all four kinds reset signals within uSDHC:

- Hardware reset
- Software reset for all logic
- Software reset for the data logic
- Software reset for the command logic

All these signals are fed into this module and stable signals are generated inside the module to reset all other modules. The module also gates off all the inside signals.

## 39.3.12.2 Clock generator

The clock generator generates the card CLK by peripheral source clock in two stages. The clock divisor can be configured through register SYS\_CTRL[SDCLKFS] for prescaler configuration while the [DVS] for divisor configuration. Details can be found in the register function description. See the following figure for the structure of the divider. The term "Base" represents the frequency of peripheral source clock (see ipg\_clk\_perclk in Table 257).

<!-- image -->

The first stage outputs an intermediate clock (DIV) that can be Base, Base/2, Base/3, ..., or Base/16.

The second stage is a prescaler and outputs the actual internal working clock (card\_clk). This clock is the driving clock for all the sub modules of the SD protocol unit, and helps in syncing FIFOs (see Figure 230) to synchronize with the data rate from the internal data buffer. The frequency of the clock output from this stage can be DIV, DIV/2, DIV/4,..., or DIV/256. Therefore, the highest frequency of the card\_clk is base, and the next highest is Base/2, while the lowest frequency is Base/4096. If the duty cycle of the base clock is 50%, the duty cycle of card\_clk is also 50%, even when the compound divisor is an odd value.

Ultra Secured Digital Host Controller (uSDHC)

## Equation 12. Equation for f card\_clk in SDR mode

For HS200 mode, if the source clock f Base = 400 MHz, and the target clock f CLK = 200 MHz, then configuring DVS to 'h00 and SDCLKFS to 'h01, the mapping value of SYS\_CTRL[DVS] is 1 and the mapping value of SYS\_CTRL[SDCLKFS] is 2.

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

- In the DDR mode, CLK is equal to card\_clk/2

## Equation 13. Equation for f card\_clk in DDR mode

For HS400 mode, if the source clock f Base = 400 MHz, and the target clock f CLK = 200 MHz, then configuring DVS to 'h00 and SDCLKFS to 'h00, the mapping value of SYS\_CTRL[DVS] is 1 and the mapping value of SYS\_CTRL[SDCLKFS] is 2.

<!-- formula-not-decoded -->

## 39.3.13 Command Queuing (CQE) operation

To facilitate command queuing in eMMC, the device manages an internal task queue that the host can queue data transfer tasks. Initially, the task queue is empty. Every task is issued by the host and initially queued as pending. The device controller works to prepare the pending tasks for execution. The software flow is described below:

1. Read CMDQ\_SUPPORT[308] and CMDQ\_DEPTH[307] of the extended CSD register (through CMD8) to verify eMMC chip support of command queue.
2. Set CMDQ\_MODE\_EN in CMD\_MODE\_EN[15] field of the extended CSD by issuing CMD6.
3. Send CMD13 to ensure a successful mode switch.
4. Define Task Descriptor List (TDL) comprised of task descriptor and transfer descriptor sets.
- a. 0x0010002b,0x00000000,0x20000023,0x34300000, //Write example
- b. 0x0010102b,0x00000000,0x20000023,0x34500000, //Read example
5. Set PROT\_CTRL[DMASEL] to 2 to select ADMA2. CMDQ descriptors are in ADMA2 format.

NOTE

CLK is different for the SDR and DDR modes.

- In the SDR mode, CLK is equal to the internal working clock (card\_clk).

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

Ultra Secured Digital Host Controller (uSDHC)

6. Set CQSSC2[SSC2] to RCA.
7. Set Command Queuing Task Descriptor List Base Address (CQTDLBA) and Command Queuing Task Descriptor List Base Address Upper 32 Bits (CQTDLBAU) to TDL start address.
8. Set CQCFG[CQUE] to 1 to enable the command queuing.
9. Set CQTDBR[TDBR] field(s) to trigger the required task(s).
10. Read CQTCN[TCN] field(s) to confirm the task completion(s).
11. Set CQTCN[TCN] field(s) to 1 to clear status.

## 39.4 External signals

The following table describes the uSDHC external signals:

## Table 258. uSDHC external signals

| Signal                                                                                                 | Description                                                                                                                            | Direction                                                                                              |
|--------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| CLK                                                                                                    | Is an Internally generated clock used to drive the eMMC, SD card, and SDIO.                                                            | O                                                                                                      |
| CMD                                                                                                    | Is used to send commands and receive responses to and from the card.                                                                   | I/O                                                                                                    |
| DAT7                                                                                                   | DAT7 line in the 8-bit mode- Not used in other modes                                                                                   | I/O                                                                                                    |
| DAT6                                                                                                   | DAT6 line in the 8-bit mode- Not used in other modes                                                                                   | I/O                                                                                                    |
| DAT5                                                                                                   | DAT5 line in the 8-bit mode- Not used in other modes                                                                                   | I/O                                                                                                    |
| DAT4                                                                                                   | DAT4 line in the 8-bit mode- Not used in other modes                                                                                   | I/O                                                                                                    |
| If uSDHC needs to support a 4-bit data transfer, DAT7~DAT4 can also be optional and tied to high. NOTE | If uSDHC needs to support a 4-bit data transfer, DAT7~DAT4 can also be optional and tied to high. NOTE                                 | If uSDHC needs to support a 4-bit data transfer, DAT7~DAT4 can also be optional and tied to high. NOTE |
| DAT3                                                                                                   | DAT3 line in the 4/8-bit mode or configured as card detection pin. The bit may be configured as card detection pin in the 1- bit mode. | I/O                                                                                                    |
| DAT2                                                                                                   | DAT2 line or Read Wait in the 4-bit mode Read Wait in 1-bit mode                                                                       | I/O                                                                                                    |
| DAT1                                                                                                   | DAT1 line in the 4/8-bit mode Also, used to detect interrupt in 1/4-bit mode                                                           | I/O                                                                                                    |
| DAT0                                                                                                   | DAT0 line in all the modes Also, used to detect busy state                                                                             | I/O                                                                                                    |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

Table 258. uSDHC external signals (continued)

| Signal   | Description                                                                                                                                                                                                          | Direction   |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| CD_B     | Card detection signal directly routed from the socket. Low value (0) indicates there is a card inserted. In the case the pin is not used (for the embedded memory), tie low. Optional for system implementation.     | I           |
| WP       | Write protection signals directly routed from the socket. Low value (0) indicates it is not write protected. In the case the pin is not used (for the embedded memory), tie low. Optional for system implementation. | I           |
| RESET_B  | Is used to reset the eMMC.                                                                                                                                                                                           | O           |
| VSELECT  | Is used to change the voltage of the external power supplier. Optional for system implementation.                                                                                                                    | O           |
| STROBE   | Input clock for eMMC HS400 mode. IftheuSDHCdoesnotsupporttheHS400 mode, STROBEcan also be optional and tied to low. NOTE                                                                                             | I           |

## 39.5 Application information

All communication between the system and cards are controlled by the host. The host sends commands of two types: broadcast and addressed (point-to-point).

Broadcast commands are intended for all cards, such as GO\_IDLE\_STATE, SEND\_OP\_COND, and ALL\_SEND\_CID. In the Broadcast mode, eMMC are in the open-drain mode to avoid bus contention. See Commands for SD card, SDIO, and eMMC for the commands of bc and bcr categories.

After the broadcast command CMD3 is issued, the cards enter the standby mode. Addressed type commands are used from this point. In this mode, for eMMC, the CMD/DATA I/O pads turns to the push-pull mode to have the driving capability for maximum frequency operation. See Commands for SD card, SDIO, and eMMC for the commands of ac and adtc categories.

A uSDHC FIFO control problem exists with a software reset for a single block read. See MIX\_CTRL[DTDSEL] for more information.

## 39.5.1 Command send and response receive basic operation

Assuming that the data type WORD is an unsigned 32-bit integer, the flow indicated below presents a guideline for sending a command to the card(s):

```
send_command(cmd_index, cmd_arg, other requirements) { WORD wCmd; // 32-bit integer to make up the data to write into Transfer Type register, it is recommended to implement in a bit-field manner wCmd = (<cmd_index> & 0x3f) << 24; // set the first 8 bits as '00'+<cmd_index>
```

Ultra Secured Digital Host Controller (uSDHC)

```
set CMDTYP, DPSEL, CICEN, CCCEN, RSTTYP, DTDSEL according to the command index; if (internal DMA is used) wCmd |= 0x1; if (multi-block transfer) { set MSBSEL bit; if (finite block number) { set BCEN bit; if (auto12 command is to use) set AC12EN bit; } } write_reg(CMDARG, <cmd_arg>); // configure the command argument write_reg(XFERTYP, wCmd); // set Transfer Type register as wCmd value to issue the command } wait_for_response(cmd_index) { while (CC bit in IRQ Status register is not set); // wait until Command Complete bit is set read IRQ Status register and check if any error bits about Command are set if (any error bits are set) report error; write 1 to clear CC bit and all Command Error bits; }
```

For the sake of simplicity, the function wait\_for\_response is implemented here by means of polling. For an effective and formal way, the response is usually checked after the Command Complete Interrupt is received. When doing this, make sure that the corresponding interrupt status bits are enabled.

For some scenarios, the response time-out is expected. For instance, after all cards respond to CMD3 and move to the Standby state no response to the Host when CMD2 is sent. The host driver deals with "fake" errors like this with caution.

## 39.5.2 Card identification mode

When a card is inserted to the socket or the card is reset by the host, the host needs to validate the operation voltage range, identify the cards, request the cards to publish the Relative Card Address (RCA) or to set the RCA for eMMC.

## 39.5.2.1 Card detect

See Figure 245 for a flow diagram showing the detection of SD card and SDIO using uSDHC.

Ultra Secured Digital Host Controller (uSDHC)

<!-- image -->

Here is the card detect sequence:

- Set the CINSIEN bit to enable card detection interrupt.
- When an interrupt from uSDHC is received, check the CINS bit in the Interrupt Status register to see if it was caused by card insertion.
- Clear the CINSIEN bit to disable the card detection interrupt and ignore all card insertion interrupts afterwards.

## 39.5.2.2 Reset

The host consists of three types of resets:

- Hardware reset (Card and Host) that is driven by Power On Reset (POR).
- Software reset (Host only) is initiated by the write operation on the RSTD, RSTC, or RSTA bits of the System Control register to reset the data part, command part, or all parts of the host controller, respectively.
- Card reset (Card only): The command, "Go\_Idle\_State" (CMD0), is the software reset command for all types of eMMC and SD memory cards. This command sets each card into the idle state regardless of the current card state. For an SDIO, CMD52 is used to write an I/O reset in CCCR. The cards are initialized with a default relative card address (RCA=0x0000) and with a default driver stage register setting (lowest speed, highest driving current capability).

After the card is reset, the host needs to validate the voltage range of the card. See the figure below for the software flow to reset both uSDHC and the card.

Ultra Secured Digital Host Controller (uSDHC)

<!-- image -->

```
software_reset() { set_bit(SYSCTRL, RSTA); // software reset the Host set DTOCV and SDCLKFS fields to get the CLK of //frequency around 400kHz //configure IO pad to set the power voltage of external card to around 3.0V //poll bits CIHB and CDIHB //bits of PRSSTAT to wait both fields are cleared set_bit(SYSCTRL, INTIA); // send 80 clock ticks for card to power up send_command(CMD_GO_IDLE_STATE, <other parameter>); // reset the card with CMD0 or send_command(CMD_IO_RW_DIRECT, <other parameter>); }
```

## 39.5.2.3 Voltage validation

All cards should be able to establish communication with the host using any operation voltage in the maximum allowed voltage range specified in the card specification. However, the supported minimum and maximum values for VDD are defined in the Operation Conditions Register (OCR) and may not cover the whole range. Cards that store the CID and CSD data in the preload memory are only able to communicate this information under data transfer VDD conditions. This means that if the host and card have non-common VDD ranges, the card is neither able to complete the identification cycle nor able to send CSD data.

Therefore, special commands Send\_Op\_Cont (CMD1 for eMMC), SD\_Send\_Op\_Cont (ACMD41 for SD Memory), and IO\_Send\_Op\_Cont (CMD5 for SD I/O) are used. The voltage validation procedure is designed to provide a mechanism to identify and reject cards that do not match the VDD range(s) desired by the host. This is accomplished when the host sends the desired VDD voltage window as the operand of this command. Cards that cannot perform the data transfer in the specified range must discard themselves from further bus operations and go into the Inactive state. By omitting the voltage range in the command, the host can query each card and determine the common voltage range before sending out-of-range cards into the Inactive state. This query should be used if the host is able to select a common voltage range or if a notification is sent to the system when a non-usable card in the stack is detected.

The following steps show how to perform voltage validation when a card is inserted:

```
voltage_validation(voltage_range_argument) { label the card as UNKNOWN; send_command(IO_SEND_OP_COND, 0x0, <other parameters are omitted>); // CMD5, check SDIO operation voltage, command argument is zero if (RESP_TIMEOUT != wait_for_response(IO_SEND_OP_COND)) { // SDIO command is accepted if (0 < number of IO functions) { label the card as SDIO; IORDY = 0;
```

Ultra Secured Digital Host Controller (uSDHC)

```
while (!(IORDY in IO OCR response)) { // set voltage range for each IO function send_command(IO_SEND_OP_COND, <voltage range>, <other parameter>); wait_for_response(IO_SEND_OP_COND); } // end of while ... } // end of if (0 < ... if (memory part is present inside SDIO) Label the card as SDCombo; //this is an SD-Combo card } // end of if (RESP_TIMEOUT ... if (the card is labeled as SDIO) return; // card type is identified and voltage range is set, so exit the function; send_command(APP_CMD, 0x0, <other parameter>); // CMD55, Application specific CMD prefix if (no error calling wait_for_response(APP_CMD, <...>) { // CMD55 is accepted send_command(SD_APP_OP_COND, <voltage range>, <...>); // ACMD41, to set voltage range for memory part or SD card wait_for_response(SD_APP_OP_COND); // voltage range is set if (card type is UNKNOWN) label the card as SD; return; // } // end of if (no error ... else if (errors other than time-out occur) { // command/response pair is corrupted deal with it by program specific manner; } // of else if (response time-out else { // CMD55 is refuse, it must be eMMC if (card is already labeled as SDCombo) { // change label re-label the card as SDIO; ignore the error or report it; return; // card is identified as SDIO } // end of if (card is ... send_command(SEND_OP_COND, <voltage range>, <...>); if(RESP_TIMEOUT == wait_for_response(SEND_OP_COND)) { // CMD1 is not accepted, either label the card as UNKNOWN; return; } // end of if (RESP_TIMEOUT ... } // end of else }
```

## 39.5.2.4 Card registry

This section briefly describes the registry flow. For details, please refer to the card specifications. Card registry for the eMMC and SD/SDIO/SD combo cards are different. For the SD card, the identification process starts at a clock rate lower than 400 kHz and the power voltage higher than 2.7 V (as defined by the card spec). Currently, the CMD line output drives are push-pull drivers instead of open-drain. After the bus is activated, the host requests the card to send their valid operation conditions. The response to ACMD41 is the operation condition register of the card. The same command is sent to all the new cards in the system. Incompatible cards are put into the Inactive state. The host then issues the command, All\_Send\_CID (CMD2), to each card to get its unique card identification (CID) number. Cards that are currently unidentified (in the Ready state), send their CID number as the response. After the CID is sent by the card, the card goes into the Identification state.

The host then issues Send\_Relative\_Addr (CMD3), requesting the card to publish a new relative card address (RCA) that is shorter than the CID. This RCA is used to address the card for future data transfer operations. After the RCA is received, the card changes its state to the Standby state. At this point, if the host wants the card to have an alternative RCA number, it may ask the card to publish a new number by sending another Send\_Relative\_Addr command to the card. The last published RCA is the actual RCA of the card.

The host repeats the identification process with CMD2 and CMD3 for each card in the system until the last CMD2 gets no response from any of the cards in the system.

For eMMC operation, the host starts the card identification process in the open-drain mode with the identification clock rate lower than 400 kHz and the power voltage higher than 2.7 V. The open drain driver stages on the CMD line to allow parallel card operation during card identification. After the bus is activated, the host requests the cards to send their valid operation conditions

Ultra Secured Digital Host Controller (uSDHC)

(CMD1). The response to CMD1 is the "wired AND " operation on the condition restrictions of all cards in the system. Incompatible cards are sent into the Inactive state. The host then issues the broadcast command All\_Send\_CID (CMD2), asking all cards for their unique card identification (CID) number. All unidentified cards (the cards in the Ready state) simultaneously start sending their CID numbers serially, while bit-wise monitoring their outgoing bit stream. Those cards, whose outgoing CID bits do not match the corresponding bits on the command line in any one of the bit periods, stop sending their CID immediately and must wait for the next identification cycle. As the CID is unique for each card, only one card can be successfully sent its full CID to the host. This card then goes into the Identification state. Thereafter, the host issues Set\_Relative\_Addr (CMD3) to assign a relative card address (RCA) to the card. After the RCA is received, the state of the card changes to standby, and the card does not react in further identification cycles. Also, its output driver switches from open-drain to push-pull. The host repeats the process, mainly CMD2 and CMD3, until the host receives a time-out condition to recognize the completion of the identification process.

The following steps show how to perform an operation using eMMC:

```
card_registry() { do { // decide RCA for each card until response time-out if(card is labelled as SDCombo or SDIO) { // for SDIO like device send_command(SET_RELATIVE_ADDR, 0x00, <...>); // ask SDIO to publish its RCA retrieve RCA from response; } // end if (card is labelled as SDCombo ... else if (card is labelled as SD) { // for SD card send_command(ALL_SEND_CID, <...>); if(RESP_TIMEOUT == wait_for_response(ALL_SEND_CID)) break; send_command(SET_RELATIVE_ADDR, <...>); retrieve RCA from response; } // else if (card is labelled as SD ... else if (card is labelled as eMMC) { send_command(ALL_SEND_CID, <...>); rca = 0x1; //arbitrarily set RCA, 1 here for example send_command(SET_RELATIVE_ADDR, 0x1 << 16, <...>); // send RCA at upper 16 bits } // end of else if (card is labelled as eMMC... } while (response is not time-out); }
```

## 39.5.3 Card access

Information about Block Write, Block Read, Suspense Resume, ADMA Usage, Transfer Error, and Card Interrupt are detailed in the sections below.

## 39.5.3.1 Block write

Information on Normal Write, DDR Write, and Write with Pause are detailed in the sections below.

## 39.5.3.1.1 Normal Write

During a block write (CMD24 - 27, CMD60, CMD61), one or more blocks of data are transferred from the host to the card with a CRC appended to the end of each block by the host. If the CRC fails, the card indicates that the failure on the DATA line. The transferred data is discarded and not written, and all further transmitted blocks (in multiple block write mode) are ignored.

If the host uses partial blocks whose accumulated length is not block aligned and block misalignment is not allowed (CSD parameter WRITE\_BLK\_MISALIGN is not set), the card detects the block misalignment error and aborts the programming before the beginning of the first misaligned block. The card sets the ADDRESS\_ERROR error bit in the status register, and while ignoring all further data transfer, waits in the Receive-data-State for a stop command. The write operation is also aborted if the host tries to write over a write-protected area.

For eMMC and SD cards, programming of the CID and CSD registers does not require a previous block length setting. The transferred data is also CRC protected. If a part of the CSD or CID register is stored in ROM, then this unchangeable part must match the corresponding part of the receive buffer. If this match fails, then the card reports an error and does not change any register contents.

Ultra Secured Digital Host Controller (uSDHC)

For all types of cards, some may require long and unpredictable periods of time to write a block of data. After receiving a block of data and completing the CRC check, the card begins writing and holds the DATA line low if its write buffer is full and unable to accept new data from a new WRITE\_BLOCK command. The host may poll the status of the card with a SEND\_STATUS command (CMD13) or other means for SDIO at any time, and the card responds with its status. The responded status indicates whether the card can accept new data or whether the write process is still in progress. The host may deselect the card by issuing a CMD7 (to select a different card) to place the card into the Standby state and release the DATA line without interrupting the write operation. When re-selecting the card, it reactivates the busy indication by pulling data to low if the programming is still in progress and the write buffer is unavailable.

The software flow to write to a card that incorporates the internal DMA and the write operation is a multi-block write with the Auto CMD12 enabled. For the other methods ( CPU polling status with different transfer methods, the internal DMA parts should be removed and the alternative steps should be straightforward.

The software flow to write to a card is described below:

1. Check the card status, wait until the card is ready for data.
2. Set the card block length/size:
- For eMMC and SD cards, use SET\_BLOCKLEN (CMD16).
- For SDIO cards or the I/O portion of SDCombo cards, use IO\_RW\_DIRECT (CMD52) to set the I/O Block Size bit field in the CCCR register (for function 0) or FBR register (for functions 1~7).
3. Set the uSDHC block length register to be the same as the block length set for the card in step 2.
4. Set the uSDHC number block register (NOB), where nob is 5, for instance.
5. Disable the buffer write ready interrupt, configure the DMA settings and enable the uSDHC DMA when sending the command with data transfer. The AC12EN bit should also be set.
6. Wait for the Transfer Complete interrupt.
7. Check the status bit to see if a write CRC error occurred, or another error that occurred during the auto12 command sending and response receiving.

## 39.5.3.1.2 DDR write

uSDHC supports the dual data rate mode.

The software flow to write to a card in the DDR mode is described as below:

1. Check the card status and wait until the card is ready for data.

## NOTE

For eMMC, block length only can be set to 512byte.

2. Set the uSDHC number block register (NOB), where nob is 5, for instance.
3. Set the eMMC, SD card, or SDIO to high-speed mode and use SWITCH(CMD6).
4. Set the eMMC bus or SD with 4-bit/8-bit DDR mode and use SWITCH(CMD6).
5. Disable the buffer write ready interrupt, configure the DMA settings and enable the uSDHC DMA when sending the command with data transfer. The DDR\_EN and AC12EN bits should be set.
6. Wait for the Transfer Complete interrupt.
7. Check the status bit to see if a write CRC error occurred or another error that occurred during the auto12 command sending and response receiving.

## 39.5.3.1.3 Write with Pause

The write operation can be paused during the transfer. Instead of stopping the CLK at any time to pause all the operations, which is also inaccessible to the host driver, the driver can set the Stop At Block Gap Request (SABGREQ) bit in the Protocol

Ultra Secured Digital Host Controller (uSDHC)

Control register to pause the transfer between the data blocks. As there is no time-out condition in a write operation during the data blocks, a write to all types of cards can be paused in this way, and if the DATA0 line is not required to de-assert to release the busy state, no suspend command is needed.

Similar to the flow described in Normal Write, the write with pause is shown with the same kind of write operation:

1. Check the card status and wait until the card is ready for data.
2. Set the card block length/size:
- For eMMC and SD cards, use SET\_BLOCKLEN (CMD16).
- For SDIO or the I/O portion of SDCombo cards, use IO\_RW\_DIRECT(CMD52) to set the I/O Block Size bit field in the CCCR register (for function 0) or FBR register (for functions 1~7).
3. Set the uSDHC block length register to be the same as the block length set for the card in step 2.
4. Set the uSDHC number block register (NOB), where nob is 5, for instance.
5. Disable the buffer write ready interrupt, configure the DMA settings and enable the uSDHC DMA when sending the command with data transfer. The AC12EN bit should also be set.
6. Set the SABGREQ bit.
7. Wait for the Transfer Complete interrupt.
8. Clear the SABGREQ bit.
9. Check the status bit to see if a write CRC error occurred.
10. Set the CREQ bit to continue the write operation.
11. Wait for the Transfer Complete interrupt.
12. Check the status bit to see if a write CRC error occurred or some another error that occurred during the auto12 command sending and response receiving.

The number of blocks left during the data transfer is accessible by reading the contents of the BLKCNT field in the Block Attribute register. As the data transfer and the setting of the SABGREQ bit are concurrent, and the delay of register read and the register setting, the actual number of blocks left may not be exactly the value read earlier. The host driver reads the value of BLKCNT after the transfer is paused and the Transfer Complete interrupt is received.

It is also possible that the last block has begun when the Stop At Block Gap Request is sent to the buffer. In this case, the next block gap is the end of the transfer. These types of requests are ignored, the driver should treat these as a non-pause transfer, and deal with it as a common write operation.

When the write operation is paused, the data transfer inside the host system is not stopped, and the transfer is active until the data buffer is full. Because of this, it is recommended to avoid using the Suspend command for SDIO. This is because when such a command is sent, uSDHC interprets the system that switches to another function on SDIO and flush the data buffer. uSDHC takes the Resume command as a normal command with data transfer, and it is left for the host driver to set all the relevant registers before the transfer is resumed. If there is only one block to send when the transfer is resumed, the MSBSEL and BCEN bits of the Transfer Type register are set as well as the AC12EN bit. However, the uSDHC module automatically sends a CMD12 to mark the end of the multi-block transfer.

## 39.5.3.2 Block read

Information about Normal read, DDR read, Read with Pause, and Delay Line (DLL) in Read Path are detailed in the sections below.

## 39.5.3.2.1 Normal read

For block reads, the basic unit of data transfer is a block whose maximum size is stored in areas defined by the corresponding card specification. A CRC is appended to the end of each block, ensuring data transfer integrity. The CMD17, CMD18, CMD53, CMD60, CMD61, and so on, can initiate a block read. After completing the transfer, the card returns to the Transfer state. For multi blocks read, data blocks are continuously transferred until a stop command is issued.

Ultra Secured Digital Host Controller (uSDHC)

The software flow to read from a card that incorporates the internal DMA and the read operation is a multi-block read with the Auto CMD12 enabled. For the other methods ( CPU polling status with different transfer methods, the internal DMA parts should be removed and the alternative steps should be straightforward.

The software flow to read from a card is described below:

1. Check the card status and wait until card is ready for data.
2. Set the card block length/size:
- For eMMC and SD cards, use SET\_BLOCKLEN (CMD16).
- For SDIO or the I/O portion of SDCombo cards, use IO\_RW\_DIRECT(CMD52) to set the I/O Block Size bit field in the CCCR register (for function 0) or FBR register (for functions 1~7).
3. Set the uSDHC block length register to be the same as the block length set for the card in step 2.
4. Set the uSDHC number block register (NOB), where nob is 5, for instance.
5. Disable the buffer read ready interrupt, configure the DMA settings, and enable the uSDHC DMA when sending the command with data transfer. The AC12EN bit should also be set.
6. Wait for the Transfer Complete interrupt.
7. Check the status bit to see if a read CRC error occurred, or another error occurred during the auto12 command sending and response receiving.

## 39.5.3.2.2 DDR read

The uSDHC module supports dual data rate mode.

The software flow to write to a card in the DDR mode is described below:

1. Check the card status and wait until the card is ready for data.

## NOTE

For eMMC, block length can be set to only 512 bytes.

2. Set the uSDHC number block register (NOB) where nob is 5, for instance.
3. Set the eMMC, SD card, or SDIO to high-speed mode and use SWITCH (CMD6).
4. Set the eMMC bus or SD with 4-bit /8-bit DDR mode and use SWITCH(CMD6).
5. Disable the buffer write ready interrupt, configure the DMA settings, and enable the uSDHC DMA when sending the command with data transfer. The DDR\_EN and AC12EN bits should be set.
6. Wait for the Transfer Complete interrupt.
7. Check the status bit to see if a write CRC error occurred, or another error that occurred during the auto12 command sending and response receiving.

## 39.5.3.2.3 Read with Pause

The read operation is not generally able to pause. Only SDIO (and SDCombo card working under I/O mode) supporting the Read Wait feature can pause during the read operation. If SDIO supports Read Wait (SRW bit in CCCR register is 1), the host driver can set the SABGREQ bit in the Protocol Control register to pause the transfer between the data blocks. Before setting the SABGREQ bit, ensure that the RWCTL bit in the Protocol Control register is set, otherwise uSDHC does not assert the Read Wait signal during the block gap and data corruption occurs. It is recommended to set the RWCTL bit after the Read Wait capability of SDIO is recognized.

Similar to the flow described in Normal read, the read with pause is shown with the same kind of read operation:

1. Check the SRW bit in the CCR register on SDIO to confirm that the card supports the Read Wait mode.
2. Set the RWCTL bit.

3. Check the card status and wait until the card is ready for data.
4. Set the card block length/size:
- For eMMC and SD cards, use SET\_BLOCKLEN (CMD16).
- For SDIO or the I/O portion of SDCombo cards, use IO\_RW\_DIRECT(CMD52) to set the I/O Block Size bit field in the CCCR register (for function 0) or FBR register (for functions 1~7).
5. Set the uSDHC block length register to be the same as the block length set for the card in step 2.
6. Set the uSDHC number block register (NOB), where nob is 5, for instance.
7. Disable the buffer read ready interrupt, configure the DMA setting, and enable the uSDHC DMA when sending the command with data transfer. The AC12EN bit should also be set.
8. Set the SABGREQ bit.
9. Wait for the Transfer Complete interrupt.
10. Clear the SABGREQ bit.
11. Check the status bit to see if read CRC error occurred.
12. Set the CREQ bit to continue the read operation.
13. Wait for the Transfer Complete interrupt.
14. Check the status bit to see if a read CRC error occurred, or another error occurred during the auto12 command sending and response receiving.

Similar to the Write operation, it is possible to meet the ending block of the transfer when paused. In this case, uSDHC ignores the Stop At Block Gap Request and treats it as a command read operation.

Unlike the write operation, there is no remaining data inside the buffer when the transfer is paused. All data received before the pause is transferred to the host system. No matter if the Suspend command is sent or not, the internal data buffer is not flushed.

If the Suspend command is sent and the transfer is later resumed by means of a Resume command, uSDHC takes the command as a normal one accompanied with data transfer. It is left for the host driver to set all the relevant registers before the transfer is resumed. If there is only one block to send when the transfer is resumed, the MSBSEL and BCEN bits of the Transfer Type register are set, as well as the AC12EN bit. However, the uSDHC automatically sends CMD12 to mark the end of multi-block transfer.

## 39.5.3.2.4 Delay Line (DLL) in read path

The DLL is newly added to assist in sampling read data. The DLL provides the ability to programmatically select a quantized delay (in fractions of the clock period) regardless of on-chip variations such as process, voltage, and temperature (PVT).

The reasons why DLL is needed for uSDHC are these:

- The path of read data traveling from card to host varies.
- In the eMMC and SD cards DDR mode, the minimum input setup and hold time are both at 2.5 ns.

The data sampling window is so small that the delay of loopback clock needs to be accurate and consistent regardless of PVT. The DLL takes the divided card\_clk as the reference clock and loopback clock as the input clock. It then generates a delayed version of the input clock according to the programmed target delay.

The DLL can be disabled or bypassed, and it can also be manually set for a fixed delay in the override mode. The override value set is the number of delay cells. In the override mode, there is no need to set the DLL\_enable. Another DLL mode is target value mode. In this mode, the DLL automatically adjusts the number of delay cells according to the target value set by the user and PVT changes. Be aware that the target value is in units of 1/32 of the clock reference period. If the card\_clk is 100Mhz, then the reference clock period is 10ns; setting target value of 16 means 5ns =(16/32)*10ns. The software can disable automatic update by the setting dll\_gate\_update bit.

As you might change the frequency of card\_clk from time to time by changing SDCLKFS[7:0]/DVS[3:0], the software must adjust the delay value to ensure it works correctly when the reference clock (card\_clk) is changed. If DLL is to be used, make sure SDCLKFS is used (at least be set to divided by 2) so that the REF\_CLK generated are the same frequency as card\_clk. There are

Ultra Secured Digital Host Controller (uSDHC)

## NOTE

The software should make sure that the DLL\_CTRL\_SLV\_FORCE\_UPD lasts for at least one card\_clk. So, the software may need to add some delay between step 6 and step 7.

<!-- image -->

## 39.5.3.3 Suspend Resume

The uSDHC module supports the Suspend Resume operations of SDIO, although slightly different than the suggested implementation of Suspend in the SDIO specification.

## 39.5.3.3.1 Suspend

After setting the SABGREQ bit, the host driver may send a Suspend command to switch to another function of SDIO. The uSDHC module does not monitor the content of the response, so it does not know if the Suspend command succeeded or not. Accordingly, it does not de-assert Read Wait for read pause. To solve this problem, the host driver does not mark the Suspend command as "Suspend", (that is, setting the CMDTYP bits to 01). Instead, the driver sends this command as if it were a normal command, and only when the command succeeds, and the BS bit is set in the response, can the Driver send another command marked as "Suspend" to inform uSDHC that the current transfer is suspended. Here is the sequence for the Suspend operation:

Ultra Secured Digital Host Controller (uSDHC)

two DLLs, PARTS DLL and STROBE DLL. PARTS DLL controls the SD\_CLK loop back delay for which DLL (Delay Line) Control (DLL\_CTRL) and DLL Status (DLL\_STATUS) are used. STROBE DLL controls the STROBE loop back delay for which Strobe DLL control (STROBE\_DLL\_CTRL) and Strobe DLL status (STROBE\_DLL\_STATUS) are used. For PARTS DLL, below flow can be taken as reference. For STROBE DLL, similar register field with prefix STROBE in Strobe DLL control (STROBE\_DLL\_CTRL) and Strobe DLL status (STROBE\_DLL\_STATUS) must be used.

Step 1: Set the DLL\_CTRL\_RESET and DLL\_CTRL\_ENABLE fields

Step 2: Configure the SDCLKFS[7:0] and DVS[3:0]

Step 3: Wait until SDSTB is asserted

Step 4: Clear the DLL\_CTRL\_RESET field

Step 5: Wait until both the DLL\_STS\_SLV\_LOCK and DLL\_STS\_REF\_LOCK are asserted

Step 6: Set the DLL\_CTRL\_SLV\_FORCE\_UPD

Step 7: Clear the DLL\_CTRL\_SLV\_FORCE\_UPD

1. Set the SABREQ bit to pause the current data transfer at block gap.
2. After the BGE bit is set, send the Suspend command to suspend the active function. The CMDTYP bit field must be 2'b00.
3. Check the BS bit of the CCCR in the response. If it is 1, repeat this step until the BS bit is cleared or abandon the suspend operation according to the Driver strategy.
4. Send another normal I/O command to the suspended function. The CMDTYP of this command must be 2'b01, so uSDHC can detect this special setting and be informed that the paused operation has successfully suspended. If the paused transfer is a read operation, uSDHC stops driving DATA2 and goes to the idle state.
5. Save the context registers in the system memory for later use, including the DMA System Address Register (for internal DMA operation), and the Block Attribute Register.
6. Begin operation for another function on SDIO.

## 39.5.3.3.2 Resume

To resume the data transfer, a Resume command is issued:

1. To resume the suspended function, restore the context register with the saved value in step #5 of the Suspend operation.
2. Send the Resume command: In the Transfer Type register, all the bit fields are set to the value as if this were another ordinary data transfer instead of a transfer resume (except the CMDTYP is set to 2'b10).
3. If the Resume command has responded, the data transfer is resumed.

## 39.5.3.4 ADMA usage

To use the ADMA in a data transfer, the host driver must prepare the correct descriptor chain prior to sending the read/write command. The steps to prepare the correct descriptor chain are these:

1. Create a descriptor to set the data length that the current descriptor group is about to transfer. The data length should be even numbers of the block size.
2. Create another descriptor to transfer the data from the address setting in this descriptor. The data address must be at a page boundary (4KB address aligned).
3. If necessary, create a Link descriptor containing the address of the next descriptor. The descriptor group is created in steps 1 ~ 3.
4. Repeat steps 1 ~ 3 until all descriptors are created.
5. In the last descriptor, set the End flag to 1 and make sure the total length of all descriptors matches the product of the block size and block number configured in the Block Attribute Register.
6. Set the ADMA System Address Register to the address of the first descriptor and set the DMAS field in the Protocol Control Register to 01 to select the ADMA.
7. Issue a write or read command with the DMAEN bit set to 1 in the Transfer Type Register.

Steps 1 ~ 5 are independent of step 6, so step 6 can finish before steps 1 ~ 5. Regarding the descriptor configuration, it is recommended not to use the Link descriptor as it requires extra system memory access.

## 39.5.3.5 Transfer error

Information about CRC, Internal DMA, Transfer ADMA, and Auto CMD12 errors are detailed in the sections below.

## 39.5.3.5.1 CRC error

It is possible at the end of a block transfer that a write CRC status error or read CRC error occurs. For this type of error, the latest block received is discarded. This is because the integrity of the data block is not guaranteed. It is recommended to discard the following data blocks and re-transfer the block from the corrupted one. For a multi-block transfer, the host driver

Ultra Secured Digital Host Controller (uSDHC)

Ultra Secured Digital Host Controller (uSDHC)

issues a CMD12 to abort the current process and start the transfer by a new data command. In this scenario, even when the AC12EN and BCEND bits are set, uSDHC does not automatically send a CMD12 because the last block is not transferred. On the other hand, if it is within the last block that the CRC error occurs, an Auto CMD12 is sent by uSDHC. In this case, the host driver re-sends or re-obtains the last block with a single block transfer.

## 39.5.3.5.2 Internal DMA error

During the data transfer with internal Simple DMA, if the DMA engine encounters an error on the AXI bus, the DMA operation is aborted, and the DMA error interrupt is sent to the host system. When acknowledged by such an interrupt, the host driver calculates the start address of data block in which the error occurs. The start address can be calculated by either:

- Reading the DMA System Address register: The error occurs during the previous burst. Considering the block size, and the start address of the next burst transfer, it is straight forward to obtain the start address of the corrupted block.
- Reading the BLKCNT field of the Block Attribute register: Considering the number of blocks left, the total number to transfer, the start address of transfer, and the size of each block, the start address of corrupted block can be determined.To use this method, MIX\_CTRL[BCEN] bit has to be set to enable Block Attribute register update.

When a DMA error occurs, it is recommended to abort the current transfer by means of a CMD12 (for multi block transfer), apply a reset for data, and restart the transfer from the corrupted block to recover from the error.

## 39.5.3.5.3 Transfer ADMA error

There are three kinds of possible ADMA errors: The AXI transfer, invalid descriptor, and data-length mismatch. Whenever these errors occur, the DMA transfer stops and the corresponding error status bit is set. For acknowledging the status, the host driver should recover the error as shown below and re-transfer from the place of interruption.

- AXI transfer error: Such errors may occur during data transfer or descriptor fetch. For either scenario, it is recommended to retrieve the transfer context, reset for the data part and re-transfer the block that was corrupted, or to the next block if no block is corrupted.
- Invalid descriptor error: For such errors, it is recommended to retrieve the transfer context, reset for the data part and recreate the descriptor chain from the invalid descriptor and issue a new transfer. As the data to transfer now may be less than the previous setting, the data length configured in the new descriptor chain should match the new value.
- Data-length mismatch error: It is similar to recover from this error. The Host Driver polls relating registers to retrieve the transfer context, apply a reset for the data part, configure a new descriptor chain and make another transfer if there is data left. Like the previous scenario of the invalid descriptor error, the data length must match the new transfer.

## 39.5.3.5.4 Auto CMD12 error

After the last block of the multi-block transfer is sent or received, and the AC12EN bit is set when the data transfer is initiated by the data command, uSDHC automatically sends a CMD12 to the card to stop the transfer. When errors with this command occur, it is recommended to the host driver to deal with the situations in the following manner:

- Auto CMD12 response time-out: It is not certain whether the command is accepted by the card or not. The host driver clears the auto CMD12 error status bits and re-send CMD12 until it is accepted by the card.
- Auto CMD12 response CRC error: As the card responds to CMD12, it aborts the transfer. The host driver may ignore the error and clear the error status bit.
- Auto CMD12 conflict error or not sent: The command is not sent; therefore, the host driver sends a CMD12 manually.

## 39.5.3.6 Card interrupt

The external cards can inform the host controller by means of some special signals. For SDIO, it can be the low-level on the DATA1 line during some special period. The uSDHC module only monitors the DATA1 line and supports the SDIO interrupt.

When the SDIO interrupt is captured by uSDHC, and the host system is informed by uSDHC asserting the uSDHC interrupt line, the interrupt service from the host driver is called.

Ultra Secured Digital Host Controller (uSDHC)

As the interrupt source is controlled by the external card, the interrupt from SDIO must be serviced before the CINT bit is cleared. Refer to Card interrupt handling for the card interrupt handling flow.

## 39.5.4 Switch function

A switch command is issued by the host driver to enable new features added to the eMMC and SD cards. The eMMC and SD cards can transfer data at bus widths other than 1-bit. Different speed modes are also defined. To enable these features, a switch command is issued by the host driver.

For SDIO, the high-speed mode /DDR50/SDR50/SDR104 are enabled by writing the EHS bit in the CCCR register after the SHS bit is confirmed as high. For SD cards, the high-speed mode/DDR50/SDR50/SDR104 are queried and enabled by a CMD6 (with the mnemonic symbol as SWITCH\_FUNC). For eMMC, the high-speed mode HS200 or HS400 is queried by a CMD8 and enabled by a CMD6 (with the mnemonic symbol as SWITCH).

The SDR4-bit, SDR8-bit, DDR4-bit, and DDR8-bit width of eMMC is also enabled by the SWITCH command, but with a different argument.

These new functions can also be disabled by a software reset. For SDIO, it can be done by setting the RES bit in the CCCR register. For other cards, it can be accomplished by issuing a CMD0. This method of restoring to the normal mode is not recommended because a complete identification process is needed before the card is ready for data transfer.

For the sake of simplicity, the following pseudo-code examples do not show current capability check, which is recommended in the function switch process.

## 39.5.4.1 Query, enable, and disable SDIO high-speed mode

```
enable_sdio_high_speed_mode(void) { send CMD52 to query bit SHS at address 0x13; if (SHS bit is '0') report SDIO does not support high speed mode and return; send CMD52 to set bit EHS at address 0x13 and read after write to confirm EHS bit is set; change clock divisor value or configure the system clock feeding into uSDHC to generate the card_clk of around 50MHz; (data transactions like normal peers) } disable_sdio_high_speed_mode(void) { send CMD52 to clear bit EHS at address 0x13 and read after write to confirm EHS bit is cleared; change clock divisor value or configure the system clock feeding into uSDHC to generate the card_clk of the desired value below 25MHz; (data transactions like normal peers) }
```

## 39.5.4.2 Query, enable, and disable SD high-speed mode/DDR50 /SDR50 /SDR104

```
enable_sd_speed_mode(void) { set BLKCNT field to 1 (block), set BLKSIZE field to 64 (bytes); send CMD6, with argument 0xFFFFFx and read 64 bytes of data accompanying the R1 response;(high speed mode,x=1; SDR50,x=2; SDR104,x=3; DDR50,x=4;) wait data transfer done bit is set; check if the bit x of received 512 bits is set; if (bit 401 is '0') report the SD card does not support high speed mode and return; if (bit 402 is '0') report the SD card does not support SDR50 mode and return; if (bit 403 is '0') report the SD card does not support SDR104 mode and return; if (bit 404 is '0') report the SD card does not support DDR50 mode and return; send CMD6, with argument 0x80FFFFFx and read 64 bytes of data accompanying the R1 response; (high speed mode,x=1; SDR50,x=2; SDR104,x=3; DDR50,x=4;) check if the bit field 379~376 is 0xF;
```

Ultra Secured Digital Host Controller (uSDHC)

```
if (the bit field is 0xF) report the function switch failed and return; change clock divisor value or configure the system clock feeding into uSDHC to generate the card_clk of around 50MHz for high speed mode, 100MHz for SDR50, 200MHz for SDR104, 50MHz for DDR50; (data transactions like normal peers) } disable_sd_speed_mode(void) { set BLKCNT field to 1 (block), set BLKSIZE field to 64 (bytes); send CMD6, with argument 0x80FFFFF0 and read 64 bytes of data accompanying the R1 response; check if the bit field 379~376 is 0xF; if (the bit field is 0xF) report the function switch failed and return; change clock divisor value or configure the system clock feeding into uSDHC to generate the card_clk of the desired value below 25MHz; (data transactions like normal peers) }
```

## 39.5.4.3 Query, enable, and disable eMMC high-speed mode

```
enable_mmc_high_speed_mode(void) { send CMD9 to get CSD value of eMMC; check if the value of SPEC_VER field is 4 or above; if (SPEC_VER value is less than 4) report the eMMC does not support high speed mode and return; set BLKCNT field to 1 (block), set BLKSIZE field to 512 (bytes); send CMD8 to get EXT_CSD value of eMMC; extract the value of CARD_TYPE field to check the 'high speed mode' in this eMMC is 26MHz or 52MHz; send CMD6 with argument 0x1B90100; send CMD13 to wait card ready (busy line released); send CMD8 to get EXT_CSD value of eMMC; check if HS_TIMING byte (byte number 185) is 1; if (HS_TIMING is not 1) report eMMC switching to high speed mode failed and return; change clock divisor value or configure the system clock feeding into uSDHC to generate the card_clk of around 26MHz or 52MHz according to the CARD_TYPE; (data transactions like normal peers) } disable_mmc_high_speed_mode(void) { send CMD6 with argument 0x2B90100; set BLKCNT field to 1 (block), set BLKSIZE field to 512 (bytes); send CMD8 to get EXT_CSD value of eMMC; check if HS_TIMING byte (byte number 185) is 0; if (HS_TIMING is not 0) report the function switch failed and return; change clock divisor value or configure the system clock feeding into uSDHC to generate the card_clk of the desired value below 20MHz; (data transactions like normal peers) }
```

## 39.5.4.4 Set eMMC bus width

```
change_mmc_bus_width(void) { send CMD9 to get CSD value of eMMC; check if the value of SPEC_VER field is 4 or above; if (SPEC_VER value is less than 4) report the eMMC does not support multiple bit width and return; send CMD6 with argument 0x3B70x00; (8-bit(dual data rate), x=6; 4-bit(dual data rate), x=5;8-bit, x=2; 4-bit, x=1; 1-bit, x=0) send CMD13 to wait card ready (busy line released);
```

```
(data transactions like normal peers)
```

```
}
```

## 39.5.5 ADMA operation

Here are the codes for the ADMA1 and ADMA2 operations.

## 39.5.5.1 ADMA1 operation

```
Set_adma1_descriptor { if (to start data transfer) { // Make sure the address is 4KB align. Set 'Set' type descriptor; { Set Act bits to 01; Set [31:12] bits data length (byte unit); } Set 'Tran' type descriptor; { Set Act bits to 10; Set [31:12] bits address (4KB align); } } else if (to fetch descriptor at non-continuous address) { Set Act bits to 11; Set [31:12] bits the next descriptor address (4KB aligned); } else { // other types of descriptor Set Act bits accordingly } if (this descriptor is the last one) { Set End bit to 1; } if (to generate interrupt for this descriptor) { Set Int bit to 1; } Set Valid bit to 1; }
```

## 39.5.5.2 ADMA2 operation

```
Set_adma2_descriptor { if (to start data transfer) { // Make sure the address is a 32-bit boundary (lower 2-bit are always '00'). Set higher 32-bit of descriptor for this data transfer initial address; Set [31:16] bits data length (byte unit); Set Act bits to '10'; } else if (to fetch descriptor at non-continuous address) { Set Act bits to '11'; // Make sure the address is 32-bit boundary (lower 2-bit are always set to '00'). Set higher 32-bit of descriptor for the next descriptor address; } else { // other types of descriptor Set Act bits accordingly }
```

Ultra Secured Digital Host Controller (uSDHC)

```
if (this descriptor is the last one) { Set 'End' bit '1'; } if (to generate interrupt for this descriptor) { Set 'Int' bit '1'; } Set the 'Valid' bit to '1'; }
```

## 39.5.6 Fast boot operation

## 39.5.6.1 Normal fast boot flow

Here are the steps for normal fast boot flow:

1. Software must configure the SYS\_CTRL[INITA] bit to make sure that 74 card clocks are finished.
2. Software must configure the eMMC Boot Register (offset 0xc4) bit 6 to 1 (enable boot), and bit 5 to 0 (normal fast boot), and bit 4 to select the ack mode. If the data is sent through the DMA mode, the software should configure bit 7 to enable the automatic stop at block gap feature, and configure bit 3-bit 0 to select the ack timeout value according to the SD CLK frequency.
3. Software then needs to configure the Block Attributes Register to set the block size and count. If in DDR fast boot mode, the block size only can be configured to 512 bytes.
4. Software must configure the Protocol control register to set Data Transfer Width (DTW). If in the DDR fast boot mode, DTW only can be configured to 4-bit/8-bit dataline mode.
5. Software needs to configure the Command Argument Register to set argument if needed (no need in normal fast boot).
6. Software must configure the Transfer Type Register to start the boot process. In normal boot mode, CMDINX, CMDTYP, RSPTYP, CICEN, CCCEN, AC12EN, BCEN and DMAEN retain the default value, where DPSEL bit is set to 1, DTDSEL is set to 1 and MSBSEL is set to 1.
7. DMAEN should be configured as 0 in the polling mode and if BCEN is configured as 1, it is recommended to configure the number of blocks in the Block Attributes Register to the maximum value. If in DDR fast boot mode, DDR\_EN needs to be set to 1.
8. When step 6 is configured, the boot process begins. The software needs to poll the data buffer ready status to read the data from the buffer in time. If a boot timeout happens (ack times out or the first data read times out), an interrupt is triggered, and the software must configure eMMC Boot Register to bit 6 to 0 to disable boot. This makes CMD high, then after at least 56 clocks, it is ready to begin a normal initialization process.
9. If there is no timeout, software needs to determine when the data read is finished and then configure eMMC Boot Register bit 6 to 0 to disable boot. This render CMD line high and command completed asserted. After at least 56 clocks, it is ready to begin the normal initialization process.
10. You must reset the host and begin the normal process.

## 39.5.6.2 Alternative fast boot flow

Here are the steps for alternative fast boot flow:

1. Software needs to configure SYS\_CTRL[INITA] to make sure 74 card clocks are finished.
2. Software needs to configure eMMC Boot Register (offset 0xc4) bit 6 to 1 (enable boot), and bit 5 to 1 (alternative boot), and bit 4 to select the ack mode or not. If data needs to be sent through the DMA mode, then configure bit 7 to enable the automatic stop at block gap feature. Software should also configure bit 3-bit 0 to select the ack timeout value according to the SD clock frequency.
3. Software then needs to configure the Block Attributes Register to set the block size and count. If in the DDR fast boot mode, the block size only can be configured to 512 bytes.

Ultra Secured Digital Host Controller (uSDHC)

Ultra Secured Digital Host Controller (uSDHC)

4. Software needs to configure the Protocol control register to set the data transfer width (DTW). If in the DDR fast boot mode, DTW only can be configured to 4-bit/8-bit dataline mode.
5. Software needs to configure Command Argument Register to set argument to 0xFFFFFFFA.
6. Software needs to configure the Transfer Type Register to start the boot process by CMD0 with the 0xFFFFFFFA argument. In alternative boot, CMDINX, CMDTYP, RSPTYP, CICEN, CCCEN, AC12EN, BCEN, and DMAEN retain the default value. DPSEL bit is set to 1, DTDSEL is set to 1, and MSBSEL is set to 1. Note DMAEN should be configured as 0 in the polling mode, and if BCEN is configured as 1 in polling mode, it is recommended to configure the block count in the Block Attributes Register to the maximum value. If in the DDR fast boot mode, DDR\_EN needs to be set to 1.
7. When step 6 is configured, the boot process begins. Software needs to poll the data buffer ready status to read the data from the buffer in time. If there is a boot timeout (ack data timeout in 50ms or data timeout in 1s), the host sends out the interrupt and the software needs to send CMD0 with reset and then configure the boot enable bit to 0 to stop this process.
8. If there is no time out, the software needs to decide when to stop the boot process, and send out the CMD0 with reset and then after the command is completed, configure the eMMC Boot Register bit 6 to stop the process. After 8 clocks from the command completion, the slave (card) is ready for the identification step.
9. You must reset the host and begin the normal process.

## 39.5.6.3 Fast boot application case (in DMA mode)

In the boot application case, because the image destination and the image size are contained in the beginning of the image, it is necessary to switch DMA parameters on the fly during eMMC fast boot.

In fast boot, the host can use Advanced DMA2 (ADMA2) with two destinations.

The detailed flow is described below:

1. The software needs to configure INIT\_ACTIVE bit (system control register bit 27) to make sure that 74 card clocks are finished.
2. The software needs to configure the eMMC Boot Register (offset 0xc4) bit 6 to 1 (enable boot); and bit 5 to 0 (normal fast boot) or 1 (alternative boot); and bit 4 to select the ack mode. In DMA mode, configure bit 7 to 1 to enable the automatic stop at block gap feature. Also configure bits[31-16] to set the (BLK\_CNT - VALUE1). Here VALUE1 is the value of the block count that needs to transfer the first time, so that the host stops at the block gap when the uSDHC controller gets VAULE1 blocks from the device. Also, configure bits[3-0] to select the ack timeout value according to the SD clock frequency.
3. The software then needs to configure the Block Attributes Register to set block size and count. If in DDR fast boot mode, the block size only can be configured to 512 bytes. In DMA mode, it is recommended to set the block count (BLK\_CNT) to the max value (16'hffff).
4. The software needs to configure Protocol Control Register to set DTW (data transfer width). If in DDR fast boot mode, the DTW only can be configured to 4-bit/8-bit dataline mode.
5. Software enable ADMA2 by configuring Protocol Control Register bits [9-8].
6. The software needs to set at least three pairs of ADMA2 descriptor in boot memory (that is, in IRAM, at least six words). The first pair descriptor defines the start address (that is, IRAM) and data length (that is,512byte*VALUE1) of the first part boot code. The software also needs to set the second pair descriptor, the second start address (any value that is writable), and data length is suggested to set 1~2word (record as VALUE2). Note that the second couple desc also transfers useful data even at lease 1 word, because our ADMA2 cannot support 0 data\_length data transfer descriptor.
7. The software needs to configure Command Argument Register to set argument to 0xFFFFFFFA in alternative fast boot and do not need to be set in normal fast boot.
8. The software needs to configure Transfer Type Register to start the boot process. CMDINX, CMDTYP, RSPTYP, CICEN, CCCEN, AC12EN, BCEN, and DMAEN retain the default value. DPSEL bit is set to 1, DTDSEL is set to 1, and MSBSEL is set to 1. DMAEN is configured as 1 in the DMA mode. And, if BCEN is configured as 1, then configure blk no in Bock Attributes Register to the max value. And, if in the DDR fast boot mode, DDR\_EN needs to be set to 1.

Ultra Secured Digital Host Controller (uSDHC)

9. When step 8 is configured, boot process begins, the first VALUE1 block number data gets transferred. The software needs to poll the TC bit (bit1 in Interrupt Status Register) to determine first transfer is ended. Also, the software needs to polling the BGE bit (bit2 in Interrupt Status Register) to determine if the first transfer stops at the block gap.
10. When TC and BGE bits are set to 1, the software can analyze the first code of VALUE1 block, initializes the new memory device, if required, and sets the third pair of descriptors to define the start address and length of the remaining part of the boot code (VALUE3, the remain boot code block). Remember to set the last descriptor with END.
11. The software needs to configure the eMMC Boot Register (offset 0xc4) again. Set bit 6 to 1 (enable boot); and bit 5 to 0 (normal fast boot), to 1 (alternative boot); and bit 4 to select the ack mode or not. In the DMA mode, configure bit 7 to 1 for enabling the automatically stop at block gap feature. Also, configure bit31-bit16 to set the (BLK\_CNT -(VALUE1+1+VALUE3)), that host stops at block gap when the uSDHC controller gets (VALUE1+1+VALUE3)) blocks from device totally include the blocks received in step 9. And need to configure bit 3-bit0 to select the ack timeout value according to the sd clk frequency. Note that the software does not need to configure the BLK\_CNT again, because it is counted down automatically by the uSDHC controller.
12. The software needs to clear the TC and BGE bits and the software needs to clear SABGREQ (bit 16 in the Protocol control register) and set CREQ (bit17 in the Protocol control register) to 1 to resume the data transfer. Host transfers the VALUE2 and VALUE3 data to the destination that is set by descriptor.
13. The software needs to do poll BGE bit to determine if the fast boot is over.

## Note:

- When ADMA boot flow starts, for uSDHC, it is like a normal ADMA read operation. So, set ADMA2 descriptor as the normal ADMA2 transfer.
- Need a few words length memory to keep descriptor.
- For the 1~2-word data in second descriptor setting, it is a useful data, so the software needs to deal the data because of the application case.

## 39.6 uSDHC memory map and register definition

## 39.6.1 uSDHC register descriptions

This section includes the module memory map and detailed descriptions of all registers.

See the table below for the register memory map of uSDHC. All these registers only support 32-bit accesses.

## NOTE

The uSDHC registers are 32-bit wide and only support 32-bit access.

## 39.6.1.1 uSDHC memory map

uSDHC base address: 402F\_0000h

| Offset   | Register                            |   Width (In bits) | Access   | Reset value   |
|----------|-------------------------------------|-------------------|----------|---------------|
| 0h       | DMA System Address (DS_ADDR)        |                32 | RW       | 0000_0000h    |
| 4h       | Block Attributes (BLK_ATT)          |                32 | RW       | 0001_0000h    |
| 8h       | Command Argument (CMD_ARG)          |                32 | RW       | 0000_0000h    |
| Ch       | Command Transfer Type (CMD_XFR_TYP) |                32 | RW       | 0000_0000h    |
| 10h      | Command Response0 (CMD_RSP0)        |                32 | R        | 0000_0000h    |

Table continues on the next page...

Table continued from the previous page...

| Offset   | Register                                             |   Width (In bits) | Access   | Reset value   |
|----------|------------------------------------------------------|-------------------|----------|---------------|
| 14h      | Command Response1 (CMD_RSP1)                         |                32 | R        | 0000_0000h    |
| 18h      | Command Response2 (CMD_RSP2)                         |                32 | R        | 0000_0000h    |
| 1Ch      | Command Response3 (CMD_RSP3)                         |                32 | R        | 0000_0000h    |
| 20h      | Data Buffer Access Port (DATA_BUFF_ACC_PORT)         |                32 | RW       | 0000_0000h    |
| 24h      | Present State (PRES_STATE)                           |                32 | R        | See section   |
| 28h      | Protocol Control (PROT_CTRL)                         |                32 | RW       | 0880_0020h    |
| 2Ch      | System Control (SYS_CTRL)                            |                32 | RW       | 0080_800Fh    |
| 30h      | Interrupt Status (INT_STATUS)                        |                32 | RW       | 0000_0000h    |
| 34h      | Interrupt Status Enable (INT_STATUS_EN)              |                32 | RW       | 0000_0000h    |
| 38h      | Interrupt Signal Enable (INT_SIGNAL_EN)              |                32 | RW       | 0000_0000h    |
| 3Ch      | Auto CMD12 Error Status (AUTOCMD12_ERR_STATUS)       |                32 | RW       | 0000_0000h    |
| 40h      | Host Controller Capabilities (HOST_CTRL_CAP)         |                32 | RW       | 07F3_B407h    |
| 44h      | Watermark Level (WTMK_LVL)                           |                32 | RW       | 0810_0810h    |
| 48h      | Mixer Control (MIX_CTRL)                             |                32 | RW       | 8000_0000h    |
| 50h      | Force Event (FORCE_EVENT)                            |                32 | RW       | 0000_0000h    |
| 54h      | ADMA Error Status (ADMA_ERR_STATUS)                  |                32 | R        | 0000_0000h    |
| 58h      | ADMA System Address (ADMA_SYS_ADDR)                  |                32 | RW       | 0000_0000h    |
| 60h      | DLL (Delay Line) Control (DLL_CTRL)                  |                32 | RW       | 0000_0000h    |
| 64h      | DLL Status (DLL_STATUS)                              |                32 | R        | 0000_0200h    |
| 68h      | CLK Tuning Control and Status (CLK_TUNE_CTRL_STATUS) |                32 | RW       | 0000_0000h    |
| 70h      | Strobe DLL control (STROBE_DLL_CTRL)                 |                32 | RW       | 0000_0000h    |
| 74h      | Strobe DLL status (STROBE_DLL_STATUS)                |                32 | R        | 0000_0200h    |
| C0h      | Vendor Specific Register (VEND_SPEC)                 |                32 | RW       | 3000_7809h    |
| C4h      | eMMC Boot (MMC_BOOT)                                 |                32 | RW       | 0000_0000h    |
| C8h      | Vendor Specific 2 Register (VEND_SPEC2)              |                32 | RW       | 0001_9006h    |
| CCh      | Tuning Control (TUNING_CTRL)                         |                32 | RW       | 0021_2800h    |
| 100h     | Command Queuing Version (CQVER)                      |                32 | R        | 0000_0510h    |
| 104h     | Command Queuing Capabilities (CQCAP)                 |                32 | RW       | 0000_310Ah    |
| 108h     | Command Queuing Configuration (CQCFG)                |                32 | RW       | 0000_0000h    |
| 10Ch     | Command Queuing Control (CQCTL)                      |                32 | RW       | 0000_0000h    |
| 110h     | Command Queuing Interrupt Status (CQIS)              |                32 | RW       | 0000_0000h    |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Offset   | Register                                                                   |   Width (In bits) | Access   | Reset value   |
|----------|----------------------------------------------------------------------------|-------------------|----------|---------------|
| 114h     | Command Queuing Interrupt Status Enable (CQISTE)                           |                32 | RW       | 0000_0000h    |
| 118h     | Command Queuing Interrupt Signal Enable (CQISGE)                           |                32 | RW       | 0000_0000h    |
| 11Ch     | Command Queuing Interrupt Coalescing (CQIC)                                |                32 | RW       | 0000_0000h    |
| 120h     | Command Queuing Task Descriptor List Base Address (CQTDLBA)                |                32 | RW       | 0000_0000h    |
| 124h     | Command Queuing Task Descriptor List Base Address Upper 32 Bits (CQTDLBAU) |                32 | RW       | 0000_0000h    |
| 128h     | Command Queuing Task Doorbell (CQTDBR)                                     |                32 | RW       | 0000_0000h    |
| 12Ch     | Command Queuing Task Completion Notification (CQTCN)                       |                32 | RW       | 0000_0000h    |
| 130h     | Command Queuing Device Queue Status (CQDQS)                                |                32 | R        | 0000_0000h    |
| 134h     | Command Queuing Device Pending Tasks (CQDPT)                               |                32 | R        | 0000_0000h    |
| 138h     | Command Queuing Task Clear (CQTCLR)                                        |                32 | RW       | 0000_0000h    |
| 140h     | Command Queuing Send Status Configuration 1 (CQSSC1)                       |                32 | RW       | 0001_1000h    |
| 144h     | Command Queuing Send Status Configuration 2 (CQSSC2)                       |                32 | RW       | 0000_0000h    |
| 148h     | Command Queuing Command Response for Direct-Command Task (CQCRDCT)         |                32 | R        | 0000_0000h    |
| 150h     | Command Queuing Response Mode Error Mask (CQRMEM)                          |                32 | RW       | FDF9_A080h    |
| 154h     | Command Queuing Task Error Information (CQTERRI)                           |                32 | R        | 0000_0000h    |
| 158h     | Command Queuing Command Response Index (CQCRI)                             |                32 | R        | 0000_0000h    |
| 15Ch     | Command Queuing Command Response Argument (CQCRA)                          |                32 | R        | 0000_0000h    |

## 39.6.1.2 DMA System Address (DS\_ADDR)

## Offset

| Register   | Offset   |
|------------|----------|
| DS_ADDR    | 0h       |

## Function

This register contains the physical system memory address used for DMA transfers.

Ultra Secured Digital Host Controller (uSDHC)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24      | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|---------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      | DS_ADDR |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0       | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8       | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      |      |      |      |      |      |      |      | DS_ADDR |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0       | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0 DS_ADDR | System address DMA system address / argument 2 When ACMD23_ARGU2_EN is set to 0, SDMA uses this register as system address and supports only 32-bit addressing mode. Auto CMD23 cannot be used with SDMA. When ACMD23_ARGU2_EN is set to 1, SDMA uses ADMA System Address register (05Fh - 058h) instead of this register to support both ADMA1 and ADMA2. This register is used only for Argument2 and SDMA may use Auto CMD23. 1. SDMA system address Because the address must be word (4 bytes) aligned, the least two bits are reserved and always set to 0. When uSDHC stops a DMA transfer, this register points out the system address of the next contiguous data position. It can be accessed only when no transaction is executing (that is, after a transaction has stopped). Read operation during transfers may return an invalid value. The host driver initializes this register before starting a DMA transaction. After DMA has stopped, the system address of the next contiguous data position can be read from this register. This register is protected during a data transfer. When data lines are active, write to this register is ignored. The host driver waits until the DLAfield in the Present State register is cleared, before writing to this register. The uSDHC internal DMA does not support a virtual memory system. It only supports continuous physical memory access. Because this register supports dynamic address reflecting, whenTCfield is set, it automatically alters the value of internal address counter, so the software cannot change this register when TC field is set. Such restriction is also listed in Software restrictions. 2. Argument 2 This register is used with the Auto CMD23 to set a 32-bit block count value to the argument of the CMD23 while executing Auto CMD23. If Auto CMD23 is used with ADMA, the full 32-bit block count value can be used. If Auto CMD23 is used without ADMA, the available block count value is limited by the Block Count register. 65535 blocks is the maximum value in this case. |

Ultra Secured Digital Host Controller (uSDHC)

## 39.6.1.3 Block Attributes (BLK\_ATT)

## Offset

| Register   | Offset   |
|------------|----------|
| BLK_ATT    | 4h       |

## Function

This register is used to configure the number of data blocks and the number of bytes in each block.

## Diagram

<!-- image -->

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|--------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 BLKCNT | Blocks count for current transfer This field is enabled when the Block Count Enable field in the Transfer Mode register is set to 1 and is valid only for multiple block transfers. For single block transfer, this field always reads as 1. The host driver sets this field to a value between 1 and the maximum block count. The uSDHC module decrements the block count after each block transfer and stops when the count reaches zero. Setting the block count to zero results in no data blocks being transferred. This field should be accessed only when no transaction is executing (that is, after transactions are stopped). During data transfer, read operations on this field mayreturn an invalid value and write operations are ignored. When saving transfer content because of a Suspend command, the number of blocks yet to be transferred can be determined by reading this field. The reading of this field should be applied after transfer is paused by stop at block gap operation and before sending the commandmarked as suspend. This is because when the Suspend command is sent out, uSDHC treats the current transfer as aborted and change the BLKCNT field back to its original value instead of keeping the dynamical indicator of the remaining block count. Whenrestoring transfer content prior to issuing a Resume command, the host driver restores the previously saved block count. |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|              | Although the BLKCNT field is 0 after reset, the read of reset value is 0x1. This is because when MSBSEL field is indicating a single block transfer, the read value of BLKCNT is always 1. NOTE 0000_0000_0000_0000b - Stop count 0000_0000_0000_0001b - 1 block 0000_0000_0000_0010b - 2 blocks 1111_1111_1111_1111b - 65535 blocks                                                                                                                                                                                                                                                                                                      |
| 15-13 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 12-0 BLKSIZE | Transfer block size This field specifies the block size for block data transfers. Values ranging from 1 byte up to the maximum buffer size can be set. It can be accessed only when no transaction is executing (that is, after a transaction has stopped). Read operations during transfers may return an invalid value, and write operations are ignored. 0_0000_0000_0000b - No data transfer 0_0000_0000_0001b - 1 byte 0_0000_0000_0010b - 2 bytes 0_0000_0000_0011b - 3 bytes 0_0000_0000_0100b - 4 bytes 0_0001_1111_1111b - 511 bytes 0_0010_0000_0000b - 512 bytes 0_1000_0000_0000b - 2048 bytes 1_0000_0000_0000b - 4096 bytes |

## 39.6.1.4 Command Argument (CMD\_ARG)

## Offset

| Register   | Offset   |
|------------|----------|
| CMD_ARG    | 8h       |

## Function

This register contains the SD/eMMC command argument.

Ultra Secured Digital Host Controller (uSDHC)

## Diagram

<!-- image -->

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24     | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|---------|------|------|------|------|------|------|------|--------|------|------|------|------|------|------|------|------|
| R W     |      |      |      |      |      |      |      | CMDARG |      |      |      |      |      |      |      |      |
| Reset   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8      | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R       |      |      |      |      |      |      |      | CMDARG |      |      |      |      |      |      |      |      |
| W Reset | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                                                                               |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Command argument                                                                                                                                                                                                       |
| CMDARG  | The SD/eMMC command argument is specified as bits 39-8 of the command format in the SD or eMMC specification. This field is write protected when the Command Inhibit (CMD) field in the Present State register is set. |

## 39.6.1.5 Command Transfer Type (CMD\_XFR\_TYP)

## Offset

| Register    | Offset   |
|-------------|----------|
| CMD_XFR_TYP | Ch       |

## Function

This register is used to control the operation of data transfers. The host driver sets this register before issuing a command followed by a data transfer or before issuing a Resume command. To prevent data loss, uSDHC prevents writing to the bits, which are involved in the data transfer of this register, when data transfer is active. These fields are DPSEL, MBSEL, DTDSEL, AC12EN, BCEN, and DMAEN.

The host driver checks the Command Inhibit DAT field (PRES\_STATE[CDIHB]) and the Command Inhibit CMD field (PRES\_STATE[CIHB]) in the Present State register before writing to this register. When the CDIHB field in the Present State register is set, any attempt to send a command with data by writing to this register is ignored; when the CIHB field is set, any write to this register is ignored.

On sending commands with data transfer involved, it is mandatory that the block size is non-zero. Block count must also be non-zero, or indicated as a single block transfer (bit 5 of this register is '0' when written), or block count is disabled (bit 1 of this register is '0' when written), otherwise uSDHC ignores the sending of this command and do nothing. For write command, with all above restrictions, it is also mandatory that the write protect switch is not active (PRES\_STATE[WPSPL] field of Present State register is '1'); otherwise, uSDHC also ignores the command.

If the commands with data transfer do not receive the response in 64 clock cycles, that is, if response time-out happens, uSDHC treats the external device, does not accept the command, and aborts the data transfer. In this scenario, the driver should issue the command again to retry the transfer. It is also possible that for some reason the card responds to the command but uSDHC

Ultra Secured Digital Host Controller (uSDHC)

Ultra Secured Digital Host Controller (uSDHC)

does not receive the response, and if it is internal DMA (either simple DMA or ADMA) read operation, the external system memory is over-written by the internal DMA with data sent back from the card.

The table below shows the summary of how register settings determine the type of data transfer.

Table 259. Transfer type register setting for various transfer types

|   Multi/single block select | Block count enable   | Block count     | Function          |
|-----------------------------|----------------------|-----------------|-------------------|
|                           0 | Do not care          | Do not care     | Single transfer   |
|                           1 | 0                    | Do not care     | Infinite transfer |
|                           1 | 1                    | Positive number | Multiple transfer |
|                           1 | 1                    | Zero            | No data transfer  |

The table below shows the relationship between the Command Index Check Enable and the Command CRC Check Enable, regarding the Response Type bits as well as the name of the response type.

Table 260. Relationship between parameters and the name of the response type

|   Response type |   Index check enable |   CRC check enable | Name of response type   |
|-----------------|----------------------|--------------------|-------------------------|
|              00 |                    0 |                  0 | No response             |
|              01 |                    0 |                  1 | R2                      |
|              10 |                    0 |                  0 | R3, R4                  |
|              10 |                    1 |                  1 | R1, R5, R6              |
|              11 |                    1 |                  1 | R1b,R5b                 |

- In the SDIO specification, response type notation for R5b is not defined. R5 includes R5b in the SDIO specification, but R5b is defined in this specification to specify that uSDHC checks the busy status after receiving a response. For example, usually CMD52 is used with R5, but the I/O abort command is used with R5b.
- The CRC fields for R3 and R4 are expected to be all 1 bits. The CRC check is disabled for these response types.

## Diagram

<!-- image -->

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-30 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 29-24 CMDINX | Command index These fields are set to the command number that is specified in bits 45-40 of the command-format in theSD Memory Card Physical Layer Specification and SDIO Specification.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 23-22 CMDTYP | Command type There are three types of special commands: Suspend, Resume, and Abort. These fields are set to 00b for all other commands. • Suspend command: If the Suspend command succeeds, uSDHC assumes that the card bus has been released and that it is possible to issue the next command that uses the DATA line. Because uSDHC does not monitor the content of command response, it does not know if the Suspend command succeeded or not. It is the host driver's responsibility to check the status of the Suspend command and send another command marked as Suspend to inform uSDHC that a Suspend command was successfully issued. See Suspend Resume for more details. After the end bit of command is sent, uSDHC deasserts Read Wait for read transactions and stops checking busy for write transactions. In a 4-bit mode, the interrupt cycle starts. If the Suspend command fails, uSDHC maintains its current state, and the host driver restarts the transfer by setting the Continue Request field in the Protocol Control register. • Resume command: The host driver re-starts the data transfer by restoring the registers saved before sending the Suspend command and then sends the Resume command. The uSDHC module checks for a pending busy state before starting write transfers. • Abort command: If this command is set when executing a read transfer, uSDHC stops reads to the buffer. If this command is set when executing a write transfer, uSDHC stops driving the DATA line. After issuing the Abort command, the host driver should issue a software reset (Abort Transaction). 00b - Normal other commands 01b - Suspend CMD52 for writing bus suspend in CCCR 10b - Resume CMD52 for writing function select in CCCR 11b - Abort CMD12, CMD52 for writing I/O Abort in CCCR |
| 21 DPSEL     | Data present select This field is set to 1 to indicate that data is present and is transferred using the DATA line. It is set to 0 for the following: • Commands using only the CMD line (for example, CMD52) • Commands with no data transfer, but using the busy signal on DATA0 line (R1b or R5b (for example, CMD38)) In resume command, this field is set, and other bits in this register is set the same as when the transfer was initially launched. When the write protect switch is on, (that is, the WPSPL field is active as '0'), any command with a write operation ignored. When this field is set, while the DTDSEL field is 0, writes to the register Transfer Type are ignored. NOTE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 20 CICEN     | Command index check enable If this field is set to 1, uSDHC checks the Index field in the response to see if it has the same value as the command index. If it is not, it is reported as a Command Index Error. If this field is set to 0, the Index field is not checked. 0b - Disable command index check                                                                                                                                         |
| 19 CCCEN     | Command CRC check enable If this field is set to 1, uSDHC checks the CRC field in the response. If an error is detected, it is reported as a Command CRC Error. If this field is set to 0, the CRC field is not checked. The number of bits checked by the CRC field value changes according to the length of the response. See RSPTYP[1:0] and Command Transfer Type (CMD_XFR_TYP). 0b - Disables command CRC check 1b - Enables command CRC check |
| 18 -         | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 17-16 RSPTYP | Response type select 00b - No response 01b - Response length 136 10b - Response length 48 11b - Response length 48, check busy after response                                                                                                                                                                                                                                                                                                       |
| 15-8 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 7 AC23EN     | AC23EN This field is read when VEND_SPEC[CMD_BYTE_EN] is enabled; otherwise, this field is tied to '0'. When this field is set to 1, the host controller issues a CMD23 automatically before issuing a command specified in the Command Register. 0b - Disable 1b - Enable                                                                                                                                                                          |
| 6 NIBBLE_POS | NIBBLE_POS This field indicates the nibble position in the DDR 4-bit mode. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is enabled; otherwise, this field is read-only. 0- the sequence is 'odd high nibble -> even high nibble -> odd low nibble -> even low nibble'; 1- the sequence is 'odd high nibble -> odd low nibble -> even high nibble -> even low nibble'.                                                                       |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|          | 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 5 MSBSEL | MSBSEL This field enables multiple block DATA line data transfers. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is enabled; otherwise, this field is read-only. For any other commands, this field can be set to 0. If this field is 0, it is not necessary to set the Block Count register. See Command Transfer Type (CMD_XFR_TYP). 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                             |
| 4 DTDSEL | DTDSEL This field defines the direction of DATA line data transfers. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is enabled; otherwise, this field is read-only. The field is set to 1 by the host driver to transfer data from the SD card to uSDHC and is set to 0 for all other commands. If a CMD with the response data size cannot be divided by 64 bytes, is given without a STOP CMD, and is followed by a software reset, then you must write a 0 to DTDSEL before inserting a software reset. This is necessary to avoid any issue during the SDcard reinitialization. Read multiple blocks will not be affected as it is required to have a STOP CMD. 0b - Disable 1b - Enable |
| 3 DDR_EN | DDR_EN Dual data rate mode selection. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is enabled; otherwise, this field is read-only. 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 2 AC12EN | AC12EN Multiple block transfers for memory require a CMD12 to stop the transaction. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is enabled; otherwise, this field is read-only. When this field is set to 1, uSDHCissues a CMD12automatically whenthe last block transfer has completed. The host driver is not set this field to issue commands that do not require CMD12 to stop a multiple block data transfer. In particular, secure commands defined in File Security Specification (see reference list) do not require CMD12. In single block transfer, uSDHC ignores this field no matter it is set or not. 0b - Disable                                                           |
| 1 BCEN   | BCEN This field is used to enable the Block Count register, which is only relevant for multiple block transfers. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is enabled; otherwise, this field is read-only. When this field is 0, the internal counter for block is disabled, which is useful in executing an infinite transfer.                                                                                                                                                                                                                                                                                                                                                         |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                               |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                               |
| 0       | DMAEN                                                                                                                                                                                                                                                                                                                                                                                                  |
| DMAEN   | This field enables DMA functionality. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is enabled; otherwise, this field is read-only. If this field is set to 1, a DMAoperation begins whenthe host driver sets the DPSEL field of this register. Whether the simple DMA or the advanced DMA is active depends on the DMA Select field of the Protocol Control register. 0b - Disable 1b - Enable |

## 39.6.1.6 Command Response0 (CMD\_RSP0)

## Offset

| Register   | Offset   |
|------------|----------|
| CMD_RSP0   | 10h      |

## Function

This register is used to store part 0 of the response bits from the card.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                    |
|---------|-----------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Command response 0                                                                                                          |
| CMDRSP0 | See Command Response3 (CMD_RSP3) for the mapping of command responses from the SD bus to this field for each response type. |

## 39.6.1.7 Command Response1 (CMD\_RSP1)

## Offset

| Register   | Offset   |
|------------|----------|
| CMD_RSP1   | 14h      |

## Function

This register is used to store part 1 of the response bits from the card.

## Diagram

<!-- image -->

| Bits   | 31      | 30      | 29      | 28      | 27      | 26      | 25      | 24      | 23      | 22      | 21      | 20      | 19      | 18      | 17      | 16      |
|--------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|
| R      | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 |
| W      |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |
| Reset  | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       |
| Bits   | 15      | 14      | 13      | 12      | 11      | 10      | 9       | 8       | 7       | 6       | 5       | 4       | 3       | 2       | 1       | 0       |
| R      | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 | CMDRSP1 |
| W      |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |
| Reset  | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       |

## Fields

| Field   | Function                                                                                                                    |
|---------|-----------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Command response 1                                                                                                          |
| CMDRSP1 | See Command Response3 (CMD_RSP3) for the mapping of command responses from the SD bus to this field for each response type. |

## 39.6.1.8 Command Response2 (CMD\_RSP2)

## Offset

| Register   | Offset   |
|------------|----------|
| CMD_RSP2   | 18h      |

## Function

This register is used to store part 2 of the response bits from the card.

Ultra Secured Digital Host Controller (uSDHC)

## Diagram

<!-- image -->

| Bits   | 31      | 30      | 29      | 28      | 27      | 26      | 25      | 24      | 23      | 22      | 21      | 20      | 19      | 18      | 17      | 16      |
|--------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|
| R      | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 |
| W      |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |
| Reset  | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       |
| Bits   | 15      | 14      | 13      | 12      | 11      | 10      | 9       | 8       | 7       | 6       | 5       | 4       | 3       | 2       | 1       | 0       |
| R      | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 | CMDRSP2 |
| W      |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |
| Reset  | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       |

## Fields

| Field   | Function                                                                                                                    |
|---------|-----------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Command response 2                                                                                                          |
| CMDRSP2 | See Command Response3 (CMD_RSP3) for the mapping of command responses from the SD bus to this field for each response type. |

## 39.6.1.9 Command Response3 (CMD\_RSP3)

## Offset

| Register   | Offset   |
|------------|----------|
| CMD_RSP3   | 1Ch      |

## Function

This register is used to store part 3 of the response bits from the card.

The table below describes the mapping of command responses from the SD bus to Command Response registers for each response type. In this table, R[ ] refers to a bit range within the response data as transmitted on the SD bus.

Table 261. Response bit definition for each response type

| Response type             | Meaning of response        | Response field   | Response register                          |
|---------------------------|----------------------------|------------------|--------------------------------------------|
| R1,R1b (normal response)  | Card status                | R[39:8]          | CMDRSP0                                    |
| R1b (auto CMD12 response) | Card status for auto CMD12 | R[39:8]          | CMDRSP3                                    |
| R2 (CID, CSD register)    | CID/CSD register [127:8]   | R[127:8]         | {CMDRSP3[23:0], CMDRSP2, CMDRSP1, CMDRSP0} |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

Table 261. Response bit definition for each response type (continued)

| Response type     | Meaning of response                            | Response field   | Response register   |
|-------------------|------------------------------------------------|------------------|---------------------|
| R3 (OCR register) | OCR register for memory                        | R[39:8]          | CMDRSP0             |
| R4 (OCR register) | OCR register for I/O etc.                      | R[39:8]          | CMDRSP0             |
| R5, R5b           | SDIO response                                  | R[39:8]          | CMDRSP0             |
| R6 (publish RCA)  | New published RCA[31:16] and card status[15:0] | R[39:9]          | CMDRSP0             |

This table shows that most responses with a length of 48 (R[47:0]) have 32-bits of the response data (R[39:8]) stored in the CMDRSP0 register. Responses of type R1b (Auto CMD12 responses) have response data bits (R[39:8]) stored in the CMDRSP3 register. Responses with length 136 (R[135:0]) have 120-bits of the response data (R[127:8]) stored in the CMDRSP0, 1, 2, and 3 registers.

To be able to read the response status efficiently, uSDHC only stores part of the response data in the Command Response registers. This enables the host driver to efficiently read 32-bits of response data in one read cycle on a 32-bit bus system. Parts of the response, the Index field and the CRC, are checked by uSDHC (as specified by the Command Index Check Enable and the Command CRC Check Enable bits in the Transfer Type register) and generate an error interrupt if any error is detected. The bit range for the CRC check depends on the response length. If the response length is 48, uSDHC checks R[47:1], and if the response length is 136 the uSDHC checks R[119:1].

Because uSDHC may have a multiple block data transfer executing concurrently with a CMD\_wo\_DAT command, uSDHC stores the Auto CMD12 response in the CMDRSP3 register. The CMD\_wo\_DAT response is stored in CMDRSP0. This allows uSDHC to avoid overwriting the Auto CMD12 response with the CMD\_wo\_DAT and vice versa. When uSDHC modifies part of the Command Response registers, as shown in the table above, it preserves the unmodified bits.

## Diagram

<!-- image -->

| Bits   | 31      | 30      | 29      | 28      | 27      | 26      | 25      | 24      | 23      | 22      | 21      | 20      | 19      | 18      | 17      | 16      |
|--------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|
| R      | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 |
| W      |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |
| Reset  | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       |
| Bits   | 15      | 14      | 13      | 12      | 11      | 10      | 9       | 8       | 7       | 6       | 5       | 4       | 3       | 2       | 1       | 0       |
| R      | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 | CMDRSP3 |
| W      |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |
| Reset  | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       | 0       |

## Fields

| Field   | Function                                                                                                                    |
|---------|-----------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Command response 3                                                                                                          |
| CMDRSP3 | See Command Response3 (CMD_RSP3) for the mapping of command responses from the SD bus to this field for each response type. |

## 39.6.1.10 Data Buffer Access Port (DATA\_BUFF\_ACC\_PORT)

## Offset

| Register            | Offset   |
|---------------------|----------|
| DATA_BUFF_ACC_POR T | 20h      |

## Function

The Buffer Data Port register is for 32-bit data access by the Arm platform. When the internal DMA is enabled, any write to this field is ignored, and any read from this field always yields 0s.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24      | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|---------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      | DATCONT |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0       | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8       | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      |      |      |      |      |      |      |      | DATCONT |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0       | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                          |
|---------|---------------------------------------------------|
| 31-0    | Data content                                      |
| DATCONT | This field is used to access the internal buffer. |

## 39.6.1.11 Present State (PRES\_STATE)

## Offset

| Register   | Offset   |
|------------|----------|
| PRES_STATE | 24h      |

## Function

The host driver can get status of uSDHC from this 32-bit read only register.

The host driver can issue CMD0, CMD12, CMD13 (for memory) and CMD52 (for SDIO) when the DATA lines are busy during a data transfer. These commands can be issued when Command Inhibit (CMD) is set to zero. Other commands are issued when Command Inhibit (DATA) is set to zero. Possible changes to the SD Physical Specification may add other commands to this list in the future.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22       | 21       | 20       | 19     | 18   | 17    | 16    |
|--------|------|------|------|------|------|------|------|------|------|----------|----------|----------|--------|------|-------|-------|
| R      | DLSL | DLSL | DLSL | DLSL | DLSL | DLSL | DLSL | DLSL | CLSL | 0        | 0        | 0        | WPSP L | CDPL | 0     | CINST |
| W      |      |      |      |      |      |      |      |      |      |          |          |          |        |      |       |       |
| Reset  | u    | u    | u    | u    | u    | u    | u    | u    | u    | 0        | 0        | 0        | u      | u    | 0     | u     |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6        | 5        | 4        | 3      | 2    | 1     | 0     |
| R      | TSCD | 0    | 0    | RTR  | BREN | BWEN | RTA  | WTA  |      | Reserved | Reserved | Reserved | SDST B | DLA  | CDIHB | CIHB  |
| W      |      |      |      |      |      |      |      |      |      |          |          |          |        |      |       |       |
| Reset  | 1    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 1    | 0        | 0        | 0        | u      | 0    | 0     | 0     |

## Fields

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 DLSL | DATA[7:0] line signal level This field is used to check the DATA line level to recover from errors, and for debugging. This is especially useful in detecting the busy signal level from DATA0. The reset value is affected by the external pull-up / pull-down resistors. By default, the read value of this field after reset is 8'b11110111, when DATA3 is pulled down and the other lines are pulled up. 0000_0000b - Data 0 line signal level 0000_0001b - Data 1 line signal level 0000_0010b - Data 2 line signal level 0000_0011b - Data 3 line signal level 0000_0100b - Data 4 line signal level 0000_0101b - Data 5 line signal level 0000_0110b - Data 6 line signal level 0000_0111b - Data 7 line signal level |
| 23 CLSL    | CMD line signal level This field is used to check the CMD line level to recover from errors, and for debugging. The reset value is affected by the external pull-up / pull-down resistor, by default, the read value of this field after reset is 1'b1, when the command line is pulled up.                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 22-20 -    | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 19         | Write protect switch pin level                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |

Table continues on the next page...

## NOTE

The reset value of Present State register depends on board connectivity.

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| WPSPL    | The Write Protect switch is supported for memory and combo cards. This field reflects the inverted value of the WPpin of the card socket. A software reset does not affect this field. The reset value is affected by the external write protect switch. If the WP pin is not used, it should be tied low, so that the reset value of this field is high and write is enabled. 0b - Write protected (WP = 1) 1b - Write enabled (WP = 0)                                                                                                                                                                                                                                                                        |
| 18 CDPL  | Card detect pin level This field reflects the inverse value of the CD_Bpin for the card socket. Debouncing is not performed on this field. This field may be valid, but is not guaranteed, because of propagation delay. Use of this field is limited to testing because it must be debounced by software. A software reset does not affect this field. A write to the Force Event Register does not affect this field. The reset value is affected by the external card detection pin. This field shows the value on the CD_B pin (that is, when a card is inserted in the socket, it is 0 on the CD_B input, and consequently, the CDPL reads 1. 0b - No card present (CD_B = 1) 1b - Card present (CD_B = 0) |
| 17 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 16 CINST | Card inserted This field indicates whether a card has been inserted. The uSDHC module debounces this signal so that the host driver does not need to wait for it to stabilize. Changing from a 0 to 1 generates a Card Insertion interrupt in the Interrupt Status register. Changing from a 1 to 0 generates a Card Removal interrupt in the Interrupt Status register. A write to the Force Event Register does not affect this field. The Software Reset For All in the System Control register does not affect this field. A software reset does not affect this field. 0b - Power on reset or no card 1b - Card inserted                                                                                   |
| 15 TSCD  | Tap select change done This field indicates the delay setting is effective after write CLK_TUNE_CTRL_STATUS register. 0b - Delay cell select change is not finished. 1b - Delay cell select change is finished.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 14-13 -  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 12 RTR   | Re-Tuning Request (only for SD3.0 SDR104 mode, and eMMC HS200 mode) Host controller may request host driver to execute re-tuning sequence by setting this field when the data window is shifted by temperature drift and a tuned sampling point does not have a good margin to receive correct data.                                                                                                                                                                                                                                                                                                                                                                                                            |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | This field is cleared when a command is issued with setting Execute Tuning field in MIX_CTRL register. Changing of this field from 0 to 1 generates Re-Tuning Event. See Interrupt status registers for more detail. This field isn't set to 1 if Sampling Clock Select in the MIX_CTRL register is set to 0 (using fixed sampling clock). 0b - Fixed or well tuned sampling clock 1b - Sampling clock needs re-tuning                                                                                                                                                                                                                                                                                                                                                                                                      |
| 11 BREN | Buffer read enable This status field is used for non-DMA read transfers. The uSDHC module implements an internal buffer to transfer data efficiently. This read only flag indicates that valid data exists in the host side buffer. If this field is high, valid data greater than the watermark level exist in the buffer. Achangeof this field from 1 to 0 occurs when some reads from the buffer (read DATPORT(Base + 0x20)) are made and the buffer hasn't valid data greater than the watermark level. A change of this field from 0 to1 occurs when there is enough valid data ready in the buffer and the Buffer Read Ready interrupt has been generated and enabled. 0b - Read disable 1b - Read enable                                                                                                             |
| 10 BWEN | Buffer write enable This status field is used for non-DMA write transfers. The uSDHC module implements an internal buffer to transfer data efficiently. This read only flag indicates if space is available for write data. If this field is 1, valid data greater than the watermark level can be written to the buffer. A change of this field from 1 to 0 occurs when some writes to the buffer (write DATPORT(Base + 0x20)) are made and the buffer hasn't valid space greater than the watermark level. A change of this field from 0 to 1 occurs when the buffer can hold valid data greater than the write watermark level and the Buffer Write Ready interrupt is generated and enabled. 0b - Write disable 1b - Write enable                                                                                       |
| 9 RTA   | Read transfer active This status field is used for detecting completion of a read transfer. This field is set for either of the following conditions: • After the end field of the read command • When writing a 1 to the Continue Request field in the Protocol Control register to restart a read transfer A transfer complete interrupt is generated when this field changes to 0. This field is cleared for either of the following conditions: • When the last data block as specified by block length is transferred to the System, that is, all data are read away from uSDHC internal buffer. • When all valid data blocks have been transferred from uSDHC internal buffer to the System and no current block transfers are being sent because of the Stop At Block Gap Request being set to 1. 0b - No valid data |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 8 WTA   | Write transfer active This status field indicates a write transfer is active. If this field is 0, it means no valid write data exists in uSDHC. This field is set in either of the following cases: • After the end field of the write command • When writing 1 to the Continue Request field in the Protocol Control register to restart a write transfer                                                                              |
| 7-4 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 3       |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| SDSTB   | SD clock stable This status field indicates that the internal card clock is stable. This field is for the host driver to poll clock status when changing the clock frequency. It is recommended to clear FRC_SDCLK_ON field in System Control register to remove glitches on the card clock when the frequency is changing. Before changing clock divisor value (SDCLKFS or DVS), host driver should make sure the SDSTB field is high. |
| 2 DLA   | Data line active This status field indicates whether one of the DATA lines on the SD bus is in use. In the case of read transactions: This status indicates if a read transfer is executing on the SDbus.Changesin this value from 1 to 0, between data blocks, generates a Block Gap Event interrupt in the Interrupt Status register. This field is set in either of the following cases:                                             |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | • When writing a 1 to the Continue Request field in the Protocol Control register to restart a read transfer This field is cleared in either of the following cases: • When the end field of the last data block is sent from the SD bus to uSDHC. • When the Read Wait state is stopped by a Suspend command and the DATA2 line is released. The uSDHC module waits at the next block gap by driving Read Wait at the start of the interrupt cycle. If the Read Wait signal is already driven (data buffer cannot receive data), uSDHC can wait for a current block gap by continuing to drive the Read Wait signal. It is necessary to support Read Wait to use the suspend / resume function. This field remains 1 during Read Wait. In the case of write transactions: This status indicates that a write transfer is executing on the SD bus. Changes in this value from 1 to 0 generate a Transfer Complete interrupt in the Interrupt Status register. This field is set in either of the following cases: • After the end field of the write command • When writing to 1 to the Continue Request field in the Protocol Control register to continue a write transfer This field is cleared in either of the following cases: • When the SD card releases Write Busy of the last data block, uSDHC also detects if the output is not busy. If the SD card does not drive the busy signal after the CRC status is received, uSDHC assumes the card drive "Not Busy". • When the SD card releases write busy, prior to waiting for write transfer, and because of a Stop At Block Gap Request. In the case of command with busy pending: This status indicates that a busy state follows the command and the data line is in use. This field is cleared when the DATA0 line is released. 0b - DATA line inactive |
| 1 CDIHB | 1b - DATA line active Command Inhibit Data (DATA) This status field is generated if either the DAT Line Active or the Read Transfer Active is set to 1. If this field is 0, it indicates that uSDHC can issue the next SD / eMMC Command. Commands with a busy signal belong to CommandInhibit (DATA)(for example. R1b, R5btype). Changing from 1to 0generates aTransfer Complete interrupt in the Interrupt Status register. The SDhost driver can save registers for a suspend transaction after this field has changed from 1 to 0. NOTE 0b - Can issue command that uses the DATA line 1b - Cannot issue command that uses the DATA line                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0       | Command inhibit (CMD)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| CIHB    | If this status bit is 0, it indicatesthattheCMDlineisnotinuseanduSDHCcanissueaSD/eMMCcommand using the CMD line. This field is set also immediately after the Transfer Type register is written. This field is cleared when the command response is received. Even if the Command Inhibit (DATA) is set to 1, commands using only the CMDline can be issued if this field is 0. Changing from 1 to 0 generates a Command Complete interrupt in the Interrupt Status register. If uSDHCcannotissue the commandbecauseof a commandconflict error (see CommandCRCError) or because of a CommandNotIssued By Auto CMD12Error, this field remains 1 and the Command Complete is not set. The Status of issuing an auto CMD12 does not show on this field. 0b - Can issue command using only CMD line 1b - Cannot issue command |

## 39.6.1.12 Protocol Control (PROT\_CTRL)

## Offset

| Register   | Offset   |
|------------|----------|
| PROT_CTRL  | 28h      |

## Function

This register controls three cases to restart the transfer after stop at the block gap. Which case is appropriate depends on whether uSDHC issues a Suspend command or the SD card accepts the Suspend command.

- If the host driver does not issue a Suspend command, the Continue request is used to restart the transfer.
- If the host driver issues a Suspend command and the SD card accepts it, a Resume command is used to restart the transfer.
- If the host driver issues a Suspend command and the SD card does not accept it, the Continue request is used to restart the transfer.

Any time stop at block gap request stops the data transfer, the host driver waits for a Transfer Complete (in the Interrupt Status register), before attempting to restart the transfer. When restarting the data transfer by Continue Request, the host driver clears the Stop At Block Gap Request before or simultaneously.

Ultra Secured Digital Host Controller (uSDHC)

## Diagram

<!-- image -->

| Bits   | 31        | 30                   | 29                   | 28                   | 27   | 26     | 25      | 24      | 23        | 22        | 21       | 20          | 19   | 18     | 17   | 16        |
|--------|-----------|----------------------|----------------------|----------------------|------|--------|---------|---------|-----------|-----------|----------|-------------|------|--------|------|-----------|
| R W    | Reserv ed | NON_ EXA... Reserved | NON_ EXA... Reserved | NON_ EXA... Reserved |      | WECR M | WECI NS | WECI NT | Reserved  | Reserved  | Reserved | RD_D ONE... | IABG | RWCT L | CREQ | SABG REQ  |
| Reset  | 0         | 0                    | 0 0                  | 1                    |      | 0      | 0       | 0       | 1         | 0         | 0        | 0           | 0    | 0      | 0    | 0         |
| Bits   | 15        | 14                   | 13                   | 12                   | 11   | 10     | 9       | 8       | 7         | 6         | 5        | 4           | 3    | 2      | 1    | 0         |
| R W    | 0         | 0                    | 0                    | 0                    | 0    | 0      | DMASEL  |         | Reserv ed | Reserv ed | EMODE    | EMODE       | D3CD | DTW    | DTW  | Reserv ed |
| Reset  | 0         | 0                    | 0                    | 0                    | 0    | 0      | 0       | 0       | 0         | 0         | 1        | 0           | 0    | 0      | 0    | 0         |

## Fields

| Field                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 -                 | Reserved Always write as 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 30 NON_EXACT_B LK_RD | Non-exact block read Current block read is non-exact block read. It is only used for SDIO. 0b - The block read is exact block read. Host driver does not need to issue abort command to terminate this multi-block read. 1b - The block read is non-exact block read. Host driver needs to issue abort command to terminate this multi-block read.                                                                                                                                                                                            |
| 29-27 -              | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 26 WECRM             | Wakeup event enable on SD card removal This field enables a wakeup event, via a card removal, in the Interrupt Status register. FN_WUS (Wakeup Support) in CIS does not affect this field. When this field is set, the Card Removal Status and uSDHC interrupt can be asserted without CLK toggling. When the wakeup feature is not enabled, the CLK must be active to assert the Card Removal Status and uSDHC interrupt. 0b - Disables wakeup event enable on SD card removal 1b - Enables wakeup event enable on SD card removal           |
| 25 WECINS            | Wakeup event enable on SD card insertion This field enables a wakeup event, via a card insertion, in the Interrupt Status register. FN_WUS (Wakeup Support) in CIS does not affect this field. When this field is set, the Card Insertion Status and uSDHC interrupt can be asserted without CLK toggling. When the wakeup feature is not enabled, the CLK must be active to assert the Card Insertion Status and uSDHC interrupt. 0b - Disable wakeup event enable on SD card insertion 1b - Enable wakeup event enable on SD card insertion |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field               | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 24 WECINT           | Wakeup event enable on card interrupt This field enables a wakeup event, via a card interrupt, in the Interrupt Status register. This field can be set to 1 if FN_WUS (Wakeup Support) in CIS is set to 1. When this field is set, the Card Interrupt Status and uSDHC interrupt can be asserted without CLK toggling. When the wakeup feature is not enabled, the CLK must be active to assert the Card Interrupt Status and uSDHC interrupt. 0b - Disables wakeup event enable on card interrupt 1b - Enables wakeup event enable on card interrupt                                                                                                                                                                                                                                                                                                                                                        |
| 23-21 -             | Reserved Always write as 3'b100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 20 RD_DONE_NO _8CLK | Read performed number 8 clock According to the SD/eMMC spec, for read data transaction, 8 clocks are needed after the end field of the last data block. So, by default(RD_DONE_NO_8CLK=0), eight clocks are active after the end field of the last read data transaction. However, these 8 clocks should not be active if user wants to use stop at block gap (include the auto stop at block gap in boot mode) feature for read and the RWCTL field (bit18) is not enabled. In this case, software should set RD_DONE_NO_8CLK to avoid these 8 clocks. Otherwise, the device might send extra data to uSDHC while uSDHC ignores these data. In a summary, this field should be set only if the use case needs to use stop at block gap feature while the device can't support the read wait feature.                                                                                                        |
| 19 IABG             | Interrupt at block gap This field is valid only in 4-bit mode, of SDIO, and selects a sample point in the interrupt cycle. Setting to 1 enables interrupt detection at the block gap for a multiple block transfer. Setting to 0 disables interrupt detection during a multiple block transfer. If SDIO cannot signal an interrupt during a multiple block transfer, this field should be set to 0 to avoid an inadvertent interrupt. Whenthe host driver detects an SDIOinsertion, it sets this field according to the CCCR of the card. 0b - Disables interrupt at block gap 1b - Enables interrupt at block gap                                                                                                                                                                                                                                                                                           |
| 18 RWCTL            | Read wait control The read wait function provided by this field is optional for SDIO. If the card supports read wait, set this field to enable use of the read wait protocol to stop read data using the DATA2 line. Otherwise, uSDHC has to stop the SDclock to hold read data, which restricts commands generation. When the host driver detects an SDIOinsertion, it sets this field according to the CCCRofthecard. If the card does not support read wait, this field should never be set to 1; otherwise, DATAline conflicts might occur. If this field is set to 0, stop at block gap during read operation is also supported, but uSDHC stops the SD clock to pause reading operation. 0b - Disables read wait control and stop SD clock at block gap when SABGREQ field is set 1b - Enables read wait control and assert read wait without stopping SD clock at block gap when SABGREQ field is set |
| 17                  | Continue request                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CREQ       | This field is used to restart a transaction which was stopped using the stop at block gap request. When a suspend operation is not accepted by the card, it is also by setting this field to restart the paused transfer. To cancel stop at the block gap, set stop at block gap request to 0 and set this field to 1 to restart the transfer. The uSDHC module automatically clears this field, therefore it is not necessary for the host driver to set this field to 0. If both stop at block gap request and this field are 1, the continue request is ignored. 0b - No effect 1b - Restart                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 16 SABGREQ | Stop at block gap request This field is used to stop executing a transaction at the next block gap for both DMAandnon-DMAtransfers. Until the transfer complete is set to 1, indicating a transfer completion, the host driver leaves this field set to 1. Clearing both the stop at block gap request and continue request does not cause the transaction to restart. Read Wait is used to stop the read transaction at the block gap. The uSDHC module supports the stop at block gap request for write transfers, but for read transfers it requires that SDIO support read wait. Therefore, the host driver does not set this field during read transfers unless SDIO supports Read Wait and has set the read wait control to 1; otherwise, uSDHC stops the SD bus clock to pause the read operation during block gap. In the case of write transfers in which the host driver writes data to the Data Port register, the host driver sets this field after all block data is written. If this field is set to 1, the host driver does not write data to the Data Port register after a block is sent. Once this field is set, the host driver does not clear this field before the Transfer Complete field in Interrupt Status register is set, otherwise uSDHC's behavior is undefined. This field effects read transfer active, write transfer active, DATA Line Active and Command Inhibit (DATA) in the Present State register. 0b - Transfer 1b - Stop |
| 15-10 -    | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 9-8 DMASEL | DMA select This field is valid while DMA (SDMA or ADMA) is enabled and selects the DMA operation. 00b - No DMA or simple DMA is selected. 01b - ADMA1 is selected. 10b - ADMA2 is selected. 11b - Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 7 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 6 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                  |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 5-4 EMODE | Endian mode This field supports all three endian modes in data transfer. See Data buffer for more details. 00b - Big endian mode 01b - Half word big endian mode 10b - Little endian mode 11b - Reserved                                                                                                                                                                                  |
| 3 D3CD    | DATA3 as card detection pin If this field is set, DATA3 should be pulled down to act as a card detection pin. Be cautious when using this feature, because DATA3 is also a chip-select for the SPI mode. A pull-down on this pin and CMD0 might set the card into the SPI mode, which uSDHC does not support. 0b - DATA3 does not monitor card insertion 1b - DATA3 as card detection pin |
| 2-1 DTW   | Data transfer width This field selects the data width of the SD bus for a data transfer. The host driver sets it to match the data width of the card. Possible data transfer width is 1-bit, 4-bits or 8-bits. 00b - 1-bit mode 01b - 4-bit mode 10b - 8-bit mode 11b - Reserved                                                                                                          |
| 0 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                  |

## 39.6.1.13 System Control (SYS\_CTRL)

## Offset

| Register   | Offset   |
|------------|----------|
| SYS_CTRL   | 2Ch      |

## Function

This register provides control of the system. See detail in the field description.

## Diagram

<!-- image -->

| Bits    | 31      | 30      | 29      | 28      | 27      | 26      | 25      | 24          | 23        | 22   | 21     | 20   | 19       | 18       | 17       | 16       |
|---------|---------|---------|---------|---------|---------|---------|---------|-------------|-----------|------|--------|------|----------|----------|----------|----------|
| R       |         | 0       | RSTT    | INITA   | RSTD    | RSTC    | RSTA    | IPP_R ST... | RST_ FIFO | ed   | Reserv | 0    |          | DTOCV    |          |          |
| W Reset | 0       | 0       | 0 0     | 0       | 0       |         | 0       | 0           | 1         | 0    | 0      | 0    | 0        | 0        | 0        | 0        |
| Bits    | 15      | 14      | 13 12   | 11      |         | 10      | 9       | 8           | 7         | 6    | 5      | 4    | 3        | 2        | 1        | 0        |
| R W     | SDCLKFS | SDCLKFS | SDCLKFS | SDCLKFS | SDCLKFS | SDCLKFS | SDCLKFS | SDCLKFS     | DVS       | DVS  | DVS    | DVS  | Reserved | Reserved | Reserved | Reserved |
| Reset   | 1       | 0       | 0 0     |         | 0       | 0       | 0       | 0           | 0         | 0    | 0      | 0    | 1        | 1        | 1        | 1        |

## Fields

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-29 -  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 28 RSTT  | Reset tuning When set this field to 1, it resets tuning circuit. After tuning circuits are reset, bit value is 0. Clearing execute_tuning field in AUTOCMD12_ERR_STATUS also sets this field to 1 to reset tuning circuit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 27 INITA | Initialization active Whenthis field is set, 80 SD-clocks are sent to the card. After the 80 clocks are sent, this field is self cleared. This field is very useful during the card power-up period when 74 SD-clocks are needed and the clock auto gating feature is enabled. Writing 1 to this bit when this field is already 1 has no effect. Writing 0 to this field at any time has no effect. When either of the CIHB and CDIHB fields in the Present State register are set, writing 1 to this field is ignored (that is, when command line or data lines are active, write to this field is not allowed). On the other-hand, when this field is set, that is, during initialization active period, it is allowed to issue command, and the command bit stream appears on the CMD pad after all 80 clock cycles are done. So, when this command ends, the driver can make sure the 80 clock cycles are sent out. This is very useful when the driver needs to send 80 cycles to the card and does not want to wait till this field is self cleared. |
| 26 RSTD  | Software reset for data line Only part of the data circuit is reset. DMA circuit is also reset. After this field is set, the software waits for self-clear. The following registers and bits are cleared by this field: • Data Port register - Buffer is cleared and initialized • Present State register - Buffer read enable - Buffer write enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | - Read transfer active - Write transfer active - DATA line active - Command Inhibit (DATA) • Protocol Control register - Continue request • Interrupt Status register - Buffer read ready - Buffer write ready - DMA interrupt - Block gap event - Transfer complete When reset, the software must make sure there is no incomplete data transferring. If there is data transfer going on, the software needs to wait TC or DCINT_STATUS register is set. NOTE 0b - No reset 1b - Reset                                                                                                                                                                                                                                                                |
| 25 RSTC | Software reset for CMD line Only part of the command circuit is reset. After this field is set, the software waits for self-clear. The following registers and bits are cleared by this field: • Present State Register - Command Inhibit (CMD) • Interrupt Status Register - Command Complete 0b - No reset 1b - Reset                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 24 RSTA | Software reset for all This reset affects the entire host controller except for the card detection circuit. RSTAresets all the registers that can be reset by RSTC/RSTD. During its initialization, the host driver is set this field to 1 to reset uSDHC. The uSDHC module resets this field to 0 when the capabilities registers are valid and the host driver can read them. Additional use of Software Reset For All does not affect the value of the capabilities registers. After this field is set, it is recommended that the host driver reset the external card and re-initialize it. After this field is set, the software should wait for self-clear. In tuning process, after every CMD19 is finished, this field is set to retest uSDHC. |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|              | When reset, the software must make sure there is no incomplete data transferring. If there is data transfer going on, the software needs to wait TC or DCINT_STATUS register is set. NOTE 0b - No reset 1b - Reset                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 23 IPP_RST_N | Hardware reset This field's value is output to card through pad directly to hardware reset pin of the card if the card supports this feature.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 22 RST_FIFO  | Reset the async FIFO Reset the async FIFO between card interface and the internal logic. After this field is set, the software waits for self-clear.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 21 -         | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 20 -         | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 19-16 DTOCV  | Data timeout counter value This value determines the interval by which DAT line timeouts are detected. See the Data Timeout Error field in the Interrupt Status register for information on factors that dictate time-out generation. Time-out clock frequency is generated by dividing the base clock SDCLK value by this value. The host driver can clear the Data Timeout Error Status Enable (in the Interrupt Status Enable register) to prevent inadvertent time-out events. 0000b - SDCLK x 2 32 0001b - SDCLK x 2 33 0010b - SDCLK x 2 18 0011b - SDCLK x 2 19 1101b - SDCLK x 2 29 , recommend to use for supported speed modes except HS200, HS400, SDR104 mode 1110b - SDCLK x 2 30 , recommend to use for HS200 and SDR104 mode 1111b - SDCLK x 2 31 , recommend to use for HS400 mode |
| 15-8 SDCLKFS | SDCLK frequency select This field is used to select the frequency of the SDCLK pin. The frequency is not programmed directly, rather this field holds the prescaler (of this register) and divisor (next register) of the Base Clock Frequency register. In Single Data Rate mode (DDR_EN field of MIXERCTRL is '0')                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | Only the following settings are allowed: 80h) Base clock divided by 256 40h) Base clock divided by 128 20h) Base clock divided by 64 10h) Base clock divided by 32 08h) Base clock divided by 16 04h) Base clock divided by 8 02h) Base clock divided by 4 01h) Base clock divided by 2 00h) Base clock divided by 1 While in Dual Data Rate mode (DDR_EN field of MIXERCTRL is '1') Only the following settings are allowed: 80h) Base clock divided by 512 40h) Base clock divided by 256 20h) Base clock divided by 128 10h) Base clock divided by 64 08h) Base clock divided by 32 04h) Base clock divided by 16 02h) Base clock divided by 8 01h) Base clock divided by 4 00h) Base clock divided by 2 When the software changes the DDR_EN field, SDCLKFS might need to be changed also. In Single Data Rate mode, setting 00h bypasses the frequency prescaler of the SD clock. Multiple bits must not be set, or the behavior of this prescaler is undefined. The two default divider values can be calculated by the frequency of ipg_perclk and the following Divisor bits. The frequency of SDCLK is set by the following formula: Clock Frequency = (Base Clock) / (prescaler x divisor) For example, in Single Data Rate mode, if the Base Clock Frequency is 96 MHz, and the target frequency is 25 MHz,then choosing the prescaler value of 01h and divisor value of 1h yields 24 MHz,which is the nearest frequency less than or equal to the target. Similarly, to approach a clock value of 400 kHz, the prescaler value of 08h and divisor value of eh yields the exact clock value of 400 kHz. The reset value of this field is 80h, so if the input Base Clock (ipg_perclk) is about 96 MHz, the default SD clock after reset is 375 kHz. Before changing clock divisor value (SDCLKFS or DVS), host driver should make sure the SDSTB field |

Table continues on the next page...

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | If setting SDCLKFS and DVS can generate the same clock frequency,(for example, in SDR mode, SDCLKFS = 01h is same as DVS = 01h.), SDCLKFS is highly recommended. For HS400 mode, SDCLKFS must be used so that REF_CLK, generated for STROBE DLL, is at the same frequency as STROBE clock. For HS200 mode, if DLL is to be used, make sure SDCLKFS is used so that REF_CLK, generated for PARTS DLL, is at the same frequency as SD_CLK. For SDR104 mode, if DLL is to be used, make sure SDCLKFS is used so that REF_CLK, generated for PARTS DLL, is at the same frequency as SD_CLK. |
| 7-4 DVS | Divisor This field is used to provide a more exact divisor to generate the desired SD clock frequency. Note the divider can even support odd divisors without deterioration of duty cycle. Before changing clock divisor value (SDCLKFS or DVS), Host driver should make sure the SDSTB field is high. The settings are as follows: 0000b - Divide-by-1 0001b - Divide-by-2 1110b - Divide-by-15 1111b - Divide-by-16                                                                                                                                                                   |
| 3-0 -   | Reserved Always write as 1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

## 39.6.1.14 Interrupt Status (INT\_STATUS)

## Offset

| Register   | Offset   |
|------------|----------|
| INT_STATUS | 30h      |

## Function

An interrupt is generated when the normal interrupt signal enable is enabled and at least one of the status fields is set to 1. For all fields, writing 1 to a bit clears it; writing to 0 keeps the bit unchanged. More than one status can be cleared with a single register write. For card interrupt, before writing 1 to clear, it is required that the card stops asserting the interrupt, meaning that when the card driver services the interrupt condition; otherwise, the CINT field is asserted again.

The table below shows the relationship between the command timeout error and the command complete.

Ultra Secured Digital Host Controller (uSDHC)

Ultra Secured Digital Host Controller (uSDHC)

Table 262. uSDHC status for command timeout error/command complete bit combinations

| Command complete   |   Command timeout error | Meaning of the status                        |
|--------------------|-------------------------|----------------------------------------------|
| 0                  |                       0 | X                                            |
| X                  |                       1 | Response not received within 64 SDCLK cycles |
| 1                  |                       0 | Response received                            |

The table below shows the relationship between the transfer complete and the data timeout error.

Table 263. uSDHC status for data timeout error/transfer complete bit combinations

|   Transfer complete | Data timeout error   | Meaning of the status            |
|---------------------|----------------------|----------------------------------|
|                   0 | 0                    | X                                |
|                   0 | 1                    | Timeout occurred during transfer |
|                   1 | X                    | Data transfer complete           |

The table below shows the relationship between the command CRC error and command timeout error.

Table 264. uSDHC status for command CRC error/command timeout error bit combinations

|   Command CRC error |   Command timeout error | Meaning of the status   |
|---------------------|-------------------------|-------------------------|
|                   0 |                       0 | No error                |
|                   0 |                       1 | Response timeout error  |
|                   1 |                       0 | Response CRC error      |
|                   1 |                       1 | CMD line conflict       |

## Diagram

<!-- image -->

| Bits   | 31          | 30   | 29   | 28   | 27   | 26   | 25   | 24    | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|-------------|------|------|------|------|------|------|-------|------|------|------|------|------|------|------|------|
| R      | 0           | 0    |      | DMAE | 0    | TNE  | 0    | AC12E | 0    | DEBE | DCE  | DTOE | CIE  | CEBE | CCE  | CTOE |
| W      |             |      |      | W1C  |      | W1C  |      | W1C   |      | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  |
| Reset  | 0           | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15          | 14   | 13   | 12   | 11   | 10   | 9    | 8     | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | ERR_I NT... | CQI  | TP   | RTE  | 0    |      | 0    | CINT  | CRM  | CINS | BRR  | BWR  | DINT | BGE  | TC   | CC   |
| W      |             | W1C  | W1C  | W1C  |      |      |      | W1C   | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  |
| Reset  | 0           | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 30-29 -  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 28 DMAE  | DMA error Occurs when an Internal DMA transfer has failed. This field is set to 1, when some error occurs in the data transfer. This error can be caused by either simple DMA or ADMA, depending on which DMA is in use. The value in DMA System Address register is the next fetch address where the error occurs. Because any error corrupts the whole data block, the host driver restarts the transfer from the corrupted block boundary. The address of the block boundary can be calculated either from the current DS_ADDR value or from the remaining number of blocks and the block size. 0b - No error 1b - Error |
| 27 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 26 TNE   | Tuning error: (only for SD3.0 SDR104 mode and eMMC HS200 mode) This field is set when an unrecoverable error is detected in a tuning circuit. By detecting Tuning Error, host driver needs to abort a commandexecuting and perform tuning. This field is relevant in combination with the bus error only and must be cleared prior to all the write and read transactions.                                                                                                                                                                                                                                                  |
| 25 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 24 AC12E | Auto CMD12 error Occurs when detecting that one of the fields in the Auto CMD12 Error Status register has changed from 0 to 1. This field is set to 1, not only when the errors in Auto CMD12 occur, but also, when the Auto CMD12 is not executed due to the previous command error. 0b - No error 1b - Error                                                                                                                                                                                                                                                                                                              |
| 23 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 22 DEBE  | Data end bit error Occurs either when detecting 0 at the end field position of read data that uses the DATA line, or at the end field position of the CRC. This field is not asserted in tuning process.                                                                                                                                                                                                                                                                                                                                                                                                                    |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | 0b - No error 1b - Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 21 DCE  | Data CRC error Occurs when detecting a CRCerror when transferring read data that uses the DATAline, or when detecting the Write CRC status having a value other than 010. This field is not asserted in tuning process. 0b - No error 1b - Error                                                                                                                                                                                                                                                                                                                                                   |
| 20 DTOE | Data timeout error Occurs when detecting one of following time-out conditions. • Busy time-out for R1b, R5b type • Busy time-out after Write CRC status • Read Data time-out. This field is not asserted in tuning process. 0b - No error                                                                                                                                                                                                                                                                                                                                                          |
| 19 CIE  | Command index error Occurs if a command index error occurs in the command response. This field is not asserted in tuning process. 0b - No error 1b - Error                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 18 CEBE | Command end bit error Occurs when detecting that the end field of a command response is 0. This field is not asserted in tuning process. 0b - No error 1b - End bit error generated                                                                                                                                                                                                                                                                                                                                                                                                                |
| 17 CCE  | Command CRC error Command CRC Error is generated in two cases. • If a response is returned and the Command Timeout Error is set to 0 (indicating no time-out), this field is set when detecting a CRC error in the command response. • The uSDHC module detects a CMD line conflict by monitoring the CMD line when a command is issued. If uSDHC drives the CMD line to 1, but detects 0 on the CMD line at the next SDCLK edge, then uSDHC aborts the command (Stop driving CMD line) and set this bit to 1. The Command Timeout Error should also be set to 1 to distinguish CMD line conflict. |

Table continues on the next page...

## Table continued from the previous page...

| Field              | Function                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                    | This field is not asserted in tuning process. 0b - No error 1b - CRC error generated                                                                                                                                                                                                                                                                                                                                                       |
| 16 CTOE            | Command timeout error Occurs only if no response is returned within 64 SDCLKcycles from the end field of the command. IfuSDHC detects a CMD line conflict, in which case a Command CRC Error is also be set (as shown in Interrupt Status (INT_STATUS)), this field is set without waiting for 64 SDCLK cycles. This is because the command is aborted by uSDHC. This field is not asserted in tuning process. 0b - No error 1b - Time out |
| 15 ERR_INT_STA TUS | Error Interrupt Status This bit is set when any of the error status bit DMAE, AC12E, DEBE, DCE, DTOE, CIE, CEBE, CCE and CTOE is set.                                                                                                                                                                                                                                                                                                      |
| 14 CQI             | Command queuing interrupt This interrupt is asserted when at least one of the bits in CQIS register is set. This interrupt is cleared only by clearing the source interrupt in CQIS register.                                                                                                                                                                                                                                              |
| 13 TP              | Tuning pass:(only for SD3.0 SDR104 mode and eMMC HS200 mode) Current CMD19 transfer is done successfully. That is, current sampling point is correct.                                                                                                                                                                                                                                                                                      |
| 12 RTE             | Re-tuning event: (only for SD3.0 SDR104 mode and eMMC HS200 mode) This status is set if Re-Tuning Request in the Present State register changes from 0 to 1. host controller requests host driver to perform re-tuning for next data transfer. Current data transfer (not large block count) can be completed without re-tuning. 0b - Re-tuning is not required. 1b - Re-tuning should be performed.                                       |
| 11 -               | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 10-9 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 8 CINT             | Card interrupt This status field is set when an interrupt signal is detected from the external card. In 1-bit mode, uSDHC                                                                                                                                                                                                                                                                                                                  |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | this field to 1 can clear this field, but as the interrupt source from SDIO does not clear, this field is set again. to clear this field, it is required to reset the interrupt source from the external card followed by a writing 1 to this field. When this status has been set, and the host driver needs to service this interrupt, the Card Interrupt Signal Enable in the Interrupt Signal Enable register should be 0 to stop driving the interrupt signal to the host system. After completion of the card interrupt service (It should reset the interrupt sources in SDIO and the interrupt signal might not be asserted), write 1 to clear this field, set the Card Interrupt Signal Enable to 1, and start sampling the interrupt signal again. 0b - No card interrupt 1b - Generate card interrupt |
| 7 CRM   | Card removal This status field is set if the Card Inserted field in the Present State register changes from 1 to 0. When the host driver writes this field to 1to clear this status, the status of the Card Inserted in the Present State register should beconfirmed. Becausethe card state might possibly bechangedwhenthehostdriver clears this field and the interrupt event might not be generated. Whenthis field is cleared, it is set again if no card is inserted. to leave it cleared, clear the Card Removal Status Enable field in Interrupt Status Enable register. 0b - Card state unstable or inserted 1b - Card removed                                                                                                                                                                          |
| 6 CINS  | Card insertion This status field is set if the Card Inserted field in the Present State register changes from 0 to 1. When the                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 5 BRR   | Buffer read ready This status field is set if the Buffer Read Enable field, in the Present State register, changes from 0 to 1. See the Buffer Read Enable field in the Present State register for additional information. This field indicates that cmd19 is finished in tuning process. 0b - Not ready to read buffer 1b - Ready to read buffer                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 4 BWR   | Buffer write ready This status field is set if the Buffer Write Enable field, in the Present State register, changes from 0 to 1. See the Buffer Write Enable field in the Present State register for additional information. 0b - Not ready to write buffer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 3 DINT  | DMA interrupt Occurs only when the internal DMA finishes the data transfer successfully. Whenever errors occur during data transfer, this field does not be set. Instead, the DMAEfield is set. Either Simple DMAorADMAfinishes data transferring, this field is set. 0b - No DMA interrupt 1b - DMA interrupt is generated.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 2 BGE   | Block gap event If the Stop At Block Gap Request field in the Protocol Control register is set, this field is set when a read or write transaction is stopped at a block gap. If Stop At Block Gap Request is not set to 1, this field is not set to 1. In the case of a Read Transaction: This field is set at the falling edge of the DATA Line Active Status (When the transaction is stopped at SD bus timing). The Read Wait must be supported to use this function. In the case of Write Transaction: This field is set at the falling edge of Write Transfer Active Status (After getting CRC status at SD Bus timing). 0b - No block gap event 1b - Transaction stopped at block gap                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 1 TC    | Transfer complete This field is set when a read or write transfer is completed. In the case of a Read Transaction: This field is set at the falling edge of the Read Transfer Active Status. There are two cases in which this interrupt is generated. The first is when a data transfer is completed as specified by the data length (after the last data has been read to the host system). The second is when data has stopped at the block gap and completed the data transfer by setting the Stop At Block GapRequest field in the Protocol Control register (after valid data has been read to the host system). In the case of a Write Transaction: This field is set at the falling edge of the DATA Line Active Status. There are two cases in which this interrupt is generated. The first is when the last data is written to the SD card as specified by the data length and the busy signal is released. The second is when data transfers are stopped at the block gap, by setting the Stop At Block GapRequest field in the Protocol Control register, and the data transfers are completed. (after valid data is written to the SD card and the busy signal released). In the case of a command with busy, this field is set when busy is deasserted. This field is not asserted in tuning process. 0b - Transfer does not complete 1b - Transfer complete |
| 0 CC    | Command complete This field is set when you receive the end field of the command response (except auto CMD12). See the Command Inhibit (CMD) in the Present State register. This field is not asserted in tuning process. 0b - Command not complete                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

Table continued from the previous page...

| Field   | Function              |
|---------|-----------------------|
|         | 1b - Command complete |

## 39.6.1.15 Interrupt Status Enable (INT\_STATUS\_EN)

## Offset

| Register      | Offset   |
|---------------|----------|
| INT_STATUS_EN | 34h      |

## Function

Setting any bit in this register to 1 enables the corresponding interrupt status be requested to the system. If any bit is set to 0, the corresponding interrupt request gets blocked.

- Depending on IABG field setting, uSDHC might be programmed to sample the card interrupt signal during the interrupt period and hold its value in the flip-flop. There are some delays on the Card Interrupt, asserted from the card, to the time the host system is informed.
- To detect a CMD line conflict, the host driver must set both Command Timeout Error Status Enable and Command CRC Error Status Enable to 1.

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31      | Reserved   |
| 30-29   | Reserved   |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field       | Function                                                     |
|-------------|--------------------------------------------------------------|
| 28 DMAESEN  | DMA error status enable 0b - Masked 1b - Enabled             |
| 27 -        | Reserved                                                     |
| 26 TNESEN   | Tuning error status enable 0b - Masked 1b - Enabled          |
| 25 -        | Reserved                                                     |
| 24 AC12ESEN | Auto CMD12 error status enable 0b - Masked 1b - Enabled      |
| 23 -        | Reserved                                                     |
| 22 DEBESEN  | Data end bit error status enable 0b - Masked 1b - Enabled    |
| 21 DCESEN   | Data CRC error status enable 0b - Masked 1b - Enabled        |
| 20 DTOESEN  | Data timeout error status enable 0b - Masked 1b - Enabled    |
| 19 CIESEN   | Command index error status enable 0b - Masked 1b - Enabled   |
| 18 CEBESEN  | Command end bit error status enable 0b - Masked 1b - Enabled |
| 17          | Command CRC error status enable                              |

Table continues on the next page...

## Table continued from the previous page...

| Field      | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CCESEN     | 0b - Masked 1b - Enabled                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 16 CTOESEN | Command timeout error status enable 0b - Masked 1b - Enabled                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 15 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 14 CQISEN  | Command queuing status enable 0b - Masked 1b - Enabled                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 13 TPSEN   | Tuning pass status enable 0b - Masked 1b - Enabled                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 12 RTESEN  | Re-tuning event status enable 0b - Masked 1b - Enabled                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 11 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 10-9 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 8 CINTSEN  | Card interrupt status enable If this field is set to 0, uSDHC clears the interrupt request to the system. The Card Interrupt detection is stopped when this field is cleared and restarted when this field is set to 1. The host driver should clear the Card Interrupt Status Enable before servicing the Card Interrupt and should set this field again after all interrupt requests from the card are cleared to prevent inadvertent interrupts. 0b - Masked 1b - Enabled |
| 7 CRMSEN   | Card removal status enable 0b - Masked 1b - Enabled                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 6 CINSSEN  | Card insertion status enable                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                  |
|-----------|-----------------------------------------------------------|
|           | 0b - Masked 1b - Enabled                                  |
| 5 BRRSEN  | Buffer read ready status enable 0b - Masked 1b - Enabled  |
| 4 BWRSEN  | Buffer write ready status enable 0b - Masked 1b - Enabled |
| 3 DINTSEN | DMA interrupt status enable 0b - Masked 1b - Enabled      |
| 2 BGESEN  | Block gap event status enable 0b - Masked 1b - Enabled    |
| 1 TCSEN   | Transfer complete status enable 0b - Masked 1b - Enabled  |
| 0 CCSEN   | Command complete status enable 0b - Masked 1b - Enabled   |

## 39.6.1.16 Interrupt Signal Enable (INT\_SIGNAL\_EN)

## Offset

| Register      | Offset   |
|---------------|----------|
| INT_SIGNAL_EN | 38h      |

## Function

This register is used to select which interrupt status is indicated to the host system as the interrupt. These status fields all share the same interrupt lines. Setting any of these fields to 1 enables interrupt generation. The corresponding Status register field generates an interrupt when the corresponding interrupt signal enable field is set.

Ultra Secured Digital Host Controller (uSDHC)

## Diagram

<!-- image -->

| Bits   | 31   | 30       | 29    | 28    | 27   | 26       | 25   | 24    | 23   | 22    | 21      | 20    | 19    | 18    | 17    | 16       |
|--------|------|----------|-------|-------|------|----------|------|-------|------|-------|---------|-------|-------|-------|-------|----------|
| R      | 0    | Reserved |       | DMAEI | 0    | TNEIE    | 0    | AC12E | 0    | DEBEI | DCEIE N | DTOEI | CIEIE | CEBEI | CCEIE | CTOEI EN |
| W      |      |          |       | EN    |      | N        |      | IEN   |      | EN    |         | EN    | N     | EN    | N     |          |
| Reset  | 0    | 0        | 0     | 0     | 0    | 0        | 0    | 0     | 0    | 0     | 0       | 0     | 0     | 0     | 0     | 0        |
| Bits   | 15   | 14       | 13    | 12    | 11   | 10       | 9    | 8     | 7    | 6     | 5       | 4     | 3     | 2     | 1     | 0        |
| R      | 0    | CQIIE    | TPIEN | RTEIE | 0    | Reserved |      | CINTI | CRMI | CINSI | BRRIE   | BWRI  | DINTI | BGEIE | TCIEN | CCIEN    |
| W      |      | N        |       | N     |      |          |      | EN    | EN   | EN    | N       | EN    | EN    | N     |       |          |
| Reset  | 0    | 0        | 0     | 0     | 0    | 0        | 0    | 0     | 0    | 0     | 0       | 0     | 0     | 0     | 0     | 0        |

## Fields

| Field       | Function                                                   |
|-------------|------------------------------------------------------------|
| 31 -        | Reserved                                                   |
| 30-29 -     | Reserved                                                   |
| 28 DMAEIEN  | DMA error interrupt enable 0b - Masked 1b - Enable         |
| 27 -        | Reserved                                                   |
| 26 TNEIEN   | Tuning error interrupt enable 0b - Masked 1b - Enabled     |
| 25 -        | Reserved                                                   |
| 24 AC12EIEN | Auto CMD12 error interrupt enable 0b - Masked 1b - Enabled |
| 23 -        | Reserved                                                   |
| 22 DEBEIEN  | Data end bit error interrupt enable 0b - Masked            |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field      | Function                                                        |
|------------|-----------------------------------------------------------------|
| 21 DCEIEN  | Data CRC error interrupt enable 0b - Masked 1b - Enabled        |
| 20 DTOEIEN | Data timeout error interrupt enable 0b - Masked 1b - Enabled    |
| 19 CIEIEN  | Command index error interrupt enable 0b - Masked 1b - Enabled   |
| 18 CEBEIEN | Command end bit error interrupt enable 0b - Masked 1b - Enabled |
| 17 CCEIEN  | Command CRC error interrupt enable 0b - Masked 1b - Enabled     |
| 16 CTOEIEN | Command timeout error interrupt enable 0b - Masked 1b - Enabled |
| 15 -       | Reserved                                                        |
| 14 CQIIEN  | Command queuing signal enable 0b - Masked 1b - Enabled          |
| 13 TPIEN   | Tuning pass interrupt enable 0b - Masked 1b - Enabled           |
| 12 RTEIEN  | Re-tuning event interrupt enable 0b - Masked 1b - Enabled       |
| 11         | Reserved                                                        |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                     |
|-----------|--------------------------------------------------------------|
| -         |                                                              |
| 10-9 -    | Reserved                                                     |
| 8 CINTIEN | Card interrupt enable 0b - Masked 1b - Enabled               |
| 7 CRMIEN  | Card removal interrupt enable 0b - Masked 1b - Enabled       |
| 6 CINSIEN | Card insertion interrupt enable 0b - Masked 1b - Enabled     |
| 5 BRRIEN  | Buffer read ready interrupt enable 0b - Masked 1b - Enabled  |
| 4 BWRIEN  | Buffer write ready interrupt enable 0b - Masked 1b - Enabled |
| 3 DINTIEN | DMA interrupt enable 0b - Masked 1b - Enabled                |
| 2 BGEIEN  | Block gap event interrupt enable 0b - Masked 1b - Enabled    |
| 1 TCIEN   | Transfer complete interrupt enable 0b - Masked 1b - Enabled  |
| 0 CCIEN   | Command complete interrupt enable 0b - Masked 1b - Enabled   |

Ultra Secured Digital Host Controller (uSDHC)

## 39.6.1.17 Auto CMD12 Error Status (AUTOCMD12\_ERR\_STATUS)

## Offset

| Register              | Offset   |
|-----------------------|----------|
| AUTOCMD12_ERR_STA TUS | 3Ch      |

## Function

When the Auto CMD12 Error Status field in the Status register is set, the host driver checks this register to identify what kind of error the Auto CMD12 / CMD 23 indicated. Auto CMD23 errors are indicated in field 04-01. This register is valid only when the Auto CMD12 Error status field is set.

The table below shows the relationship between the Auto CMGD12 CRC Error and the Auto CMD12 Command Timeout Error.

Table 265. Relationship between command CRC error and command timeout error for auto CMD12

|   Auto CMD12 CRC error |   Auto CMD12 timeout error | Type of error          |
|------------------------|----------------------------|------------------------|
|                      0 |                          0 | No error               |
|                      0 |                          1 | Response timeout error |
|                      1 |                          0 | Response CRC error     |
|                      1 |                          1 | CMD line conflict      |

Changes in Auto CMD12 Error Status register can be classified in three scenarios:

- When uSDHC is going to issue an Auto CMD12
- Set field 0 to 1 if the Auto CMD12 cannot be issued due to an error in the previous command
- Set field 0 to 0 if the Auto CMD12 is issued
- At the end field of an Auto CMD12 response
- Check errors correspond to fields 1-4
- Set fields 1-4 corresponding to detected errors
- Clear fields 1-4 corresponding to detected errors
- Before reading the Auto CMD12 Error Status field 7
- Set field 7 to 1 if there is a command that can't be issued
- Clear field 7 if there is no command to issue

The timing for generating the Auto CMD12 Error and writing to the Command register are asynchronous. After that, field 7 is sampled when the driver is not writing to the Command register. So, it is suggested to read this register only when the AC12E field in Interrupt Status register is set. An Auto CMD12 Error Interrupt is generated when one of the error fields (0-4) is set to 1. The Command Not Issued By Auto CMD12 Error does not generate an interrupt.

Ultra Secured Digital Host Controller (uSDHC)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23          | 22     | 21   | 20      | 19       | 18      | 17       | 16      |
|--------|------|------|------|------|------|------|------|------|-------------|--------|------|---------|----------|---------|----------|---------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | SMP_        | EXEC   | 0    | 0       | 0        | 0       | 0        | 0       |
| W      |      |      |      |      |      |      |      |      | CLK...      | UTE... |      |         |          |         |          |         |
| Reset  | 0    | 0    | 0    | 0 0  |      | 0    | 0    | 0    | 0           | 0      | 0    | 0       | 0        | 0       | 0        | 0       |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7           | 6      | 5    | 4       | 3        | 2       | 1        | 0       |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | CNIBA C1... | 0      |      | AC12I E | AC12E BE | AC12C E | AC12T OE | AC12N E |
| W      |      |      |      |      |      |      |      |      |             |        |      |         |          |         |          |         |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0           | 0      | 0    | 0       | 0        | 0       | 0        | 0       |

## Fields

| Field              | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-24 -            | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 23 SMP_CLK_SEL     | Sample clock select This field is used to select sampling clock to receive CMD and DATA. This field is functional only when TUNING_CTRL[STD_TUNING_EN] is set. Otherwise, this field is reserved. This field is controlled by re-tuning procedure and is valid after the tuning procedure is complete (AUTOCMD12_ERR_STATUS[EXECUTE_TUNING]=0). A value of '1' means that tuning has been completed successfully and a value of '0' implies the tuning has failed. Writing '1' to this field is meaningless and ignored when the tuning has failed. The tuning circuit is reset by writing '0' to this field. This field can be cleared by setting AUTOCMD12_ERR_STATUS[EXECUTE_TUNING]=1. Once the tuning circuit is reset, it takes time to complete tuning sequence. Therefore, host driver should keep this field as 1 to perform the re-tuning sequence in a short time. This field cannot be changed while the Host controller is receiving response or a read data block. 0b - Fixed clock is used to sample data 1b - Tuned clock is used to sample data |
| 22 EXECUTE_TU NING | Execute tuning This field is used to start the tuning procedure. This field is functional only when TUNING_CTRL[STD_TUNING_EN] is set. Otherwise, this field is reserved. This field is set to start tuning procedure and automatically cleared when tuning procedure is completed. The result of tuning is indicated to AUTOCMD12_ERR_STATUS[SMP_CLK_SEL]. 0b - Tuning procedure is aborted 1b - Start tuning procedure                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 21-8 -             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 7                  | Command not issued by Auto CMD12 error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                  |
|-----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CNIBAC12E | Setting this field to 1 means CMD_wo_DAT is not executed due to an Auto CMD12 error (D04-D01) in this register. 0b - No error 1b - Not issued                                                                                                                                                                                                                                                                             |
| 6-5 -     | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 4 AC12IE  | Auto CMD12 / 23 index error Occurs if the command index error occurs in response to a command. 0b - No error 1b - Error, the CMD index in response is not CMD12/23                                                                                                                                                                                                                                                        |
| 3 AC12EBE | Auto CMD12 / 23 end bit error Occurs when detecting that the end field of command response is 0 which should be 1. 0b - No error 1b - End bit error generated                                                                                                                                                                                                                                                             |
| 2 AC12CE  | Auto CMD12 / 23 CRC error Occurs when detecting a CRC error in the command response. 0b - No CRC error 1b - CRC error met in Auto CMD12/23 response                                                                                                                                                                                                                                                                       |
| 1 AC12TOE | Auto CMD12 / 23 timeout error Occurs if no response is returned within 64 SDCLK cycles from the end field of the command. If this field is set to1, the other error status fields (2-4) have no meaning. 0b - No error 1b - Time out                                                                                                                                                                                      |
| 0 AC12NE  | Auto CMD12 not executed If memorymultiple block data transfer is not started, due to a commanderror, this field is not set because it is not necessary to issue an Auto CMD12. Setting this field to 1 means uSDHC cannot issue the Auto CMD12 to stop a memorymultiple block data transfer due to someerror. If this field is set to 1, other error status fields (1-4) have no meaning. 0b - Executed 1b - Not executed |

## 39.6.1.18 Host Controller Capabilities (HOST\_CTRL\_CAP)

## Offset

| Register      | Offset   |
|---------------|----------|
| HOST_CTRL_CAP | 40h      |

## Function

This register provides the host driver with information specific to uSDHC implementation. The value in this register is the power-on-reset value and does not change with a software reset.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                           |
|---------|--------------------------------------------------------------------------------------------------------------------|
| 31-27 - | Reserved                                                                                                           |
| 26 VS18 | Voltage support 1.8 V This field depends on the host system ability. 0b - 1.8 V not supported 1b - 1.8 V supported |
| 25 VS30 | Voltage support 3.0 V This field depends on the host system ability. 0b - 3.0 V not supported 1b - 3.0 V supported |
| 24 VS33 | Voltage support 3.3 V This field depends on the host system ability.                                               |

Table continues on the next page...

## Table continued from the previous page...

| Field     | Function                                                                                                                                                                                                                                                                                           |
|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 23 SRS    | 1b - 3.3 V supported Suspend / resume support This field indicates whether uSDHC supports Suspend / Resume functionality. If this field is 0, the Suspend and Resume mechanism, as well as the read wait, are not supported, and the host driver does not issue either Suspend or Resume commands. |
| 22 DMAS   | DMA support This field indicates whether uSDHCcanusethe internal DMAtotransfer data between system memory and the data buffer directly. 0b - DMA not supported 1b - DMA supported                                                                                                                  |
| 21 HSS    | High speed support This field indicates whether uSDHCsupports High Speed mode and the host system can supply a SDclock frequency from 25 MHz to 50 MHz. 0b - High speed not supported 1b - High speed supported                                                                                    |
| 20 ADMAS  | ADMA support This field indicates whether uSDHC supports the ADMA feature. 0b - Advanced DMA not supported 1b - Advanced DMA supported                                                                                                                                                             |
| 19 -      | Reserved                                                                                                                                                                                                                                                                                           |
| 18-16 MBL | Max block length This field indicates the maximum block size that the host driver can read and write to the buffer in uSDHC. The buffer transfers block size without wait cycles. 000b - 512 bytes 001b - 1024 bytes 010b - 2048 bytes 011b - 4096 bytes                                           |
| 15-14     | Retuning Mode This field selects retuning method.                                                                                                                                                                                                                                                  |

Table continues on the next page...

## Table continued from the previous page...

| Field                     | Function                                                                                                                                              |
|---------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| RETUNING_M ODE            | 00b - Mode 1 01b - Mode 2 10b - Mode 3 11b - Reserved                                                                                                 |
| 13 USE_TUNING_ SDR50      | Use Tuning for SDR50 This field is used to enable tuning for SDR50 mode 0b - SDR50 does not support tuning 1b - SDR50 supports tuning                 |
| 12 -                      | Reserved                                                                                                                                              |
| 11-8 TIME_COUNT_ RETUNING | Time counter for retuning This field indicates an initial value of the Retuning Timer for Re-Tuning Mode1 and 3.Setting to 0 disables Retuning Timer. |
| 7-3 -                     | Reserved                                                                                                                                              |
| 2 DDR50_SUPP ORT          | DDR50 support This field indicates support of DDR50 mode.                                                                                             |
| 1 SDR104_SUPP ORT         | SDR104 support This field indicates support of SDR104 mode.                                                                                           |
| 0 SDR50_SUPPO RT          | SDR50 support This field indicates support of SDR50 mode.                                                                                             |

## 39.6.1.19 Watermark Level (WTMK\_LVL)

## Offset

| Register   | Offset   |
|------------|----------|
| WTMK_LVL   | 44h      |

## Function

This register indicates configurability of write and read watermark levels (FIFO threshold). Their value can range from 1 to 128 words.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
|--------|------|------|------|------|------|------|------|------|----------|----------|----------|----------|----------|----------|----------|----------|
| R      | 0    | 0    |      |      |      |      |      |      |          |          |          | WR_WML   |          |          |          |          |
| W      |      |      |      |      |      |      |      |      | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved |
| Reset  | 0    | 0    | 0    | 0    | 1    | 0    | 0    | 0    | 0        | 0        | 0        | 1        | 0        | 0        | 0        | 0        |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R      | 0    | 0    |      |      |      |      |      |      |          |          |          | RD_WML   |          |          |          |          |
| W      |      |      |      |      |      |      |      |      | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved |
| Reset  | 0    | 0    | 0    | 0    | 1    | 0    | 0    | 0    | 0        | 0        | 0        | 1        | 0        | 0        | 0        | 0        |

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                        |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-29 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 28-24 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 23-16 WR_WML | Write watermark level This field indicates the number of words used as the watermark level (FIFO threshold) in a DMA write operation. Also, the number of words as a sequence of write bursts in back-to-back mode. The maximum legal value for the write watermark level is 128.When using internal DMA, WR_WML can be set any value between 1 and 128. To get max AXI throughput, we recommend to use integer multiple of 16. |
| 15-13 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 12-8 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 7-0 RD_WML   | Read watermark level This field indicates the number of words used as the watermark level (FIFO threshold) in a DMA read operation. Also, the number of words as a sequence of read bursts in back-to-back mode. The maximum legal value for the read water mark level is 128.When using internal DMA mode, RD_WML must be set to the value less than 16. To get max AXI throughput, recommend to use 16.                       |

## 39.6.1.20 Mixer Control (MIX\_CTRL)

## Offset

| Register   | Offset   |
|------------|----------|
| MIX_CTRL   | 48h      |

Ultra Secured Digital Host Controller (uSDHC)

## Function

This register is used to DMA and data transfer. To prevent data loss, the software should check if data transfer is active before writing this register. These fields are DPSEL, MBSEL, DTDSEL, AC12EN, BCEN, and DMAEN.

Table 266. Transfer type register setting for various transfer types

|   Multi/single block select | Block count enable   | Block count     | Function          |
|-----------------------------|----------------------|-----------------|-------------------|
|                           0 | Do not care          | Do not care     | Single transfer   |
|                           1 | 0                    | Do not care     | Infinite transfer |
|                           1 | 1                    | Positive number | Multiple transfer |
|                           1 | 1                    | Zero            | No data transfer  |

## Diagram

<!-- image -->

## Fields

| Field             | Function                                       |
|-------------------|------------------------------------------------|
| 31 -              | Reserved Always write as 1.                    |
| 30                |                                                |
|                   | Reserved                                       |
| -                 | Always write as 0.                             |
| 29                | Reserved                                       |
| -                 | Always write as 0.                             |
| 28 -              | Reserved                                       |
| 27 EN_HS400_MO DE | Enable enhance HS400 mode Enhance HS400 enable |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field            | Function                                                                                                                                                                                                                                                                                                                                                                                       |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 26 HS400_MODE    | Enable HS400 mode HS400 Enable                                                                                                                                                                                                                                                                                                                                                                 |
| 25 FBCLK_SEL     | Feedback clock source selection (Only used for SD3.0, SDR104 mode and eMMC HS200 mode) 0b - Feedback clock comes from the loopback CLK 1b - Feedback clock comes from the ipp_card_clk_out                                                                                                                                                                                                     |
| 24 AUTO_TUNE_E N | Auto tuning enable (Only used for SD3.0, SDR104 mode and eMMC HS200 mode) 0b - Disable auto tuning 1b - Enable auto tuning                                                                                                                                                                                                                                                                     |
| 23 SMP_CLK_SEL   | Clock selection When TUNING_CTRL[STD_TUNING_EN] is 0, this field is used to select Tuned clock or Fixed clock to sample data / cmd (Only used for SD3.0, SDR104 mode and eMMC HS200 mode) 0b - Fixed clock is used to sample data / cmd 1b - Tuned clock is used to sample data / cmd                                                                                                          |
| 22 EXE_TUNE      | Execute tuning: (Only used for SD3.0, SDR104 mode and eMMC HS200 mode) When TUNING_CTRL[STD_TUNING_EN] is 0, this field is set to 1 to indicate the host driver is starting tuning procedure. Tuning procedure is aborted by writing 0. 0b - Not tuned or tuning completed 1b - Execute tuning                                                                                                 |
| 21-8 -           | Reserved                                                                                                                                                                                                                                                                                                                                                                                       |
| 7 AC23EN         | Auto CMD23 enable This field is read/write when VEND_SPEC[CMD_BYTE_EN] is disabled; otherwise, this field is read-only. When this field is set to 1, the host controller issues a CMD23 automatically before issuing a command specified in the Command Register.                                                                                                                              |
| 6 NIBBLE_POS     | Nibble position indication This field indicates the nibble position in the DDR 4-bit mode. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is disabled; otherwise, this field is read-only. 0- the sequence is 'odd high nibble -> even high nibble -> odd low nibble -> even low nibble'; 1- the sequence is 'odd high nibble -> odd low nibble -> even high nibble -> even low nibble'. |
| 5 MSBSEL         | Multi / Single block select This field enables multiple block DATA line data transfers. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is disabled; otherwise, this field is read-only. For any other commands, this field can be set to 0. If this field is 0, it is not necessary to set the Block Count register. See Command Transfer Type (CMD_XFR_TYP).                            |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|          | 0b - Single block 1b - Multiple blocks                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 4 DTDSEL | Data transfer direction select This field defines the direction of DATA line data transfers. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is disabled; otherwise, this field is read-only. The field is set to 1 by the host driver to transfer data from the SD card to uSDHC and is set to 0 for all other commands. If a CMD with the response data size cannot be divided by 64 bytes, is given without a STOP CMD, and is followed by a software reset, then you must write a 0 to DTDSEL before inserting a software reset. This is necessary to avoid any issue during the SDcard reinitialization. Read multiple blocks will not be affected as it is required to have a STOP CMD. 0b - Write (Host to card) 1b - Read (Card to host) |
| 3 DDR_EN | Dual data rate mode selection This field is read/write when VEND_SPEC[CMD_BYTE_EN] is disabled; otherwise, this field is read-only.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 2 AC12EN | Auto CMD12 enable Multiple block transfers for memory require a CMD12 to stop the transaction. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is disabled; otherwise, this field is read-only. When this field is set to 1, uSDHCissues a CMD12automatically whenthe last block transfer has completed. The host driver is not set this field to issue commands that do not require CMD12 to stop a multiple block data transfer. In particular, secure commands defined in File Security Specification (see reference list) do not require CMD12. In single block transfer, uSDHC ignores this field no matter it is set or not. 0b - Disable 1b - Enable                                                                                      |
| 1 BCEN   | Block count enable This field is used to enable the Block Count register, which is only relevant for multiple block transfers. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is disabled; otherwise, this field is read-only. When this field is 0, the internal counter for block is disabled, which is useful in executing an infinite transfer. 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                                                    |
| 0 DMAEN  | DMA enable This field enables DMA functionality. This field is read/write when VEND_SPEC[CMD_BYTE_EN] is disabled; otherwise, this field is read-only. If this field is set to 1, aDMAoperationbeginswhenthehostdriver sets the DPSEL field of this register. Whether the simple DMA or the advanced DMA is active depends on the DMA Select field of the Protocol Control register. 0b - Disable 1b - Enable                                                                                                                                                                                                                                                                                                                                         |

Ultra Secured Digital Host Controller (uSDHC)

## 39.6.1.21 Force Event (FORCE\_EVENT)

## Offset

| Register    | Offset   |
|-------------|----------|
| FORCE_EVENT | 50h      |

## Function

This register is not a physically implemented register. Rather, it is an address at which the Interrupt Status register can be written if the corresponding field of the Interrupt Status Enable Register is set. This register is a write only register and writing 0 to it has no effect. Writing 1 to this register sets the corresponding field of Interrupt Status register. A read from this register always results in 0's. to change the corresponding status fields in the Interrupt Status register, make sure to set IPGEN field in System Control Register so that peripheral clock is always active.

Forcing a card interrupt generates a short pulse on the DATA1 line, and the driver might treat this interrupt as a normal interrupt. The interrupt service routine might skip polling the card interrupt factor as the interrupt is self cleared.

## Diagram

<!-- image -->

| Bits   | 31        | 30   | 29   | 28        | 27   | 26       | 25   | 24          | 23          | 22        | 21       | 20          | 19          | 18          | 17          | 16          |
|--------|-----------|------|------|-----------|------|----------|------|-------------|-------------|-----------|----------|-------------|-------------|-------------|-------------|-------------|
| R      | 0         | 0    | 0    | 0         | 0    | 0        | 0    | 0           | 0           | 0         | 0        | 0           | 0           | 0           | 0           | 0           |
| W      | FEVT CINT |      |      | FEVT DMAE |      | FEVTT NE |      | FEVT AC1... |             | FEVT DEBE | FEVT DCE | FEVT DTOE   | FEVT CIE    | FEVT CEBE   | FEVT CCE    | FEVT CTOE   |
| Reset  | 0         | 0    | 0    | 0         | 0    | 0        | 0    | 0           | 0           | 0         | 0        | 0           | 0           | 0           | 0           | 0           |
| Bits   | 15        | 14   | 13   | 12        | 11   | 10       | 9    | 8           | 7           | 6         | 5        | 4           | 3           | 2           | 1           | 0           |
| R      | 0         | 0    | 0    | 0         | 0    | 0        | 0    | 0           | 0           | 0         | 0        | 0           | 0           | 0           | 0           | 0           |
| W      |           |      |      |           |      |          |      |             | FEVT CNI... |           |          | FEVTA C1... | FEVTA C1... | FEVTA C1... | FEVTA C1... | FEVTA C1... |
| Reset  | 0         | 0    | 0    | 0         | 0    | 0        | 0    | 0           | 0           | 0         | 0        | 0           | 0           | 0           | 0           | 0           |

## Fields

| Field       | Function                                                                                                                                                                                                                                                                                                                           |
|-------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 FEVTCINT | Force event card interrupt Writing 1 to this field generates a short low-level pulse on the internal DATA1 line, as if a self-clearing interrupt was received from the external card. If enabled, the CINT field is set and the interrupt service routine might treat this interrupt as a normal interrupt from the external card. |
| 30-29 -     | Reserved                                                                                                                                                                                                                                                                                                                           |
| 28 FEVTDMAE | Force event DMA error Forces the DMAE field of Interrupt Status register to be set                                                                                                                                                                                                                                                 |
| 27          | Reserved                                                                                                                                                                                                                                                                                                                           |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field            | Function                                                                                                                                   |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| -                |                                                                                                                                            |
| 26 FEVTTNE       | Force tuning error Forces the TNE field of Interrupt Status register to be set                                                             |
| 25 -             | Reserved                                                                                                                                   |
| 24 FEVTAC12E     | Force event Auto Command 12 error Forces the AC12E field of Interrupt Status register to be set                                            |
| 23 -             | Reserved                                                                                                                                   |
| 22 FEVTDEBE      | Force event data end bit error Forces the DEBE field of Interrupt Status register to be set                                                |
| 21 FEVTDCE       | Force event data CRC error Forces the DCE field of Interrupt Status register to be set                                                     |
| 20 FEVTDTOE      | Force event data time out error Force the DTOE field of Interrupt Status register to be set                                                |
| 19 FEVTCIE       | Force event command index error Forces the CCE field of Interrupt Status register to be set                                                |
| 18 FEVTCEBE      | Force event command end bit error Forces the CEBE field of Interrupt Status register to be set                                             |
| 17 FEVTCCE       | Force event command CRC error Forces the CCE field of Interrupt Status register to be set                                                  |
| 16 FEVTCTOE      | Force event command time out error Forces the CTOE field of Interrupt Status register to be set                                            |
| 15-8 -           | Reserved                                                                                                                                   |
| 7 FEVTCNIBAC1 2E | Force event command not executed by Auto Command 12 error Forces the CNIBAC12E field in the Auto Command12 Error Status register to be set |
| 6-5              | Reserved                                                                                                                                   |

Table continues on the next page...

## Table continued from the previous page...

| Field         | Function                                                                                                                  |
|---------------|---------------------------------------------------------------------------------------------------------------------------|
| -             |                                                                                                                           |
| 4 FEVTAC12IE  | Force event Auto Command 12 index error Forces the AC12IE field in the Auto Command12 Error Status register to be set     |
| 3 FEVTAC12EBE | Force event Auto Command 12 end bit error Forces the AC12EBE field in the Auto Command12 Error Status register to be set  |
| 2 FEVTAC12CE  | Force event auto command 12 CRC error Forces the AC12CE field in the Auto Command12 Error Status register to be set       |
| 1 FEVTAC12TOE | Force event auto command 12 time out error Forces the AC12TOE field in the Auto Command12 Error Status register to be set |
| 0 FEVTAC12NE  | Force event auto command 12 not executed Forces the AC12NE field in the Auto Command12 Error Status register to be set    |

## 39.6.1.22 ADMA Error Status (ADMA\_ERR\_STATUS)

## Offset

| Register        | Offset   |
|-----------------|----------|
| ADMA_ERR_STATUS | 54h      |

## Function

When an ADMA Error Interrupt has occurred, the ADMA error sates field in this register holds the ADMA state and the ADMA System Address register holds the address around the error descriptor.

For recovering from this error, the host driver requires the ADMA state to identify the error descriptor address as follows:

- ST\_STOP: Previous location set in the ADMA System Address register is the error descriptor address.
- ST\_FDS: Current location set in the ADMA System Address register is the error descriptor address.
- ST\_CADR: This state is never set because it only increments the descriptor pointer and does not generate an ADMA error.
- ST\_TFR: Previous location set in the ADMA System Address register is the error descriptor address.

In case of a write operation, the host driver should use the ACMD22 to get the number of the written block, rather than using this information, because unwritten data might exist in the host controller.

The host controller generates the ADMA Error Interrupt when it detects invalid descriptor data (Valid=0) in the ST\_FDS state. The host driver can distinguish this error by reading the Valid field of the error descriptor.

Ultra Secured Digital Host Controller (uSDHC)

Table 267. ADMA error state coding

|   D01-D00 | ADMA error state (when error has occurred)   | Contents of ADMA System Address register                    |
|-----------|----------------------------------------------|-------------------------------------------------------------|
|        00 | ST_STOP (Stop DMA)                           | Holds the address of the next executable descriptor command |
|        01 | ST_FDS (Fetch descriptor)                    | Holds the valid descriptor address                          |
|        10 | ST_CADR (Change address)                     | No ADMA error is generated                                  |
|        11 | ST_TFR (Transfer data)                       | Holds the address of the next executable descriptor command |

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19       | 18       | 17     | 16     |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|----------|----------|--------|--------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0        | 0        | 0      | 0      |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |          |          |        |        |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0        | 0        | 0      | 0      |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3        | 2        | 1      | 0      |
| R      |      |      |      |      |      |      |      |      |      |      |      |      | ADMA DCE | ADMA LME | ADMAES | ADMAES |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |          |          |        |        |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0        | 0        | 0      | 0      |

## Fields

| Field     | Function                                                                                                                                                                                                                                                                                                       |
|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-4 -    | Reserved                                                                                                                                                                                                                                                                                                       |
| 3 ADMADCE | ADMA descriptor error This error occurs when invalid descriptor fetched by ADMA. 0b - No error 1b - Error                                                                                                                                                                                                      |
| 2 ADMALME | ADMA length mismatch error This error occurs in the following two cases: • While the block count enable is being set, the total data length specified by the descriptor table is different from that specified by the block count and block length. • Total data length cannot be divided by the block length. |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                      |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | 0b - No error 1b - Error                                                                                                                                      |
| 1-0     | ADMA error state (when ADMA error is occurred)                                                                                                                |
| ADMAES  | This field indicates the state of the ADMA when an error has occurred during an ADMA data transfer. See ADMA Error Status (ADMA_ERR_STATUS) for more details. |

## 39.6.1.23 ADMA System Address (ADMA\_SYS\_ADDR)

## Offset

| Register      | Offset   |
|---------------|----------|
| ADMA_SYS_ADDR | 58h      |

## Function

This register holds the word address of the executing command in the Descriptor table. At the start of ADMA, the host driver sets the start address of the Descriptor table. The ADMA engine increments this register address whenever fetching a Descriptor command. When the ADMA is stopped at the Block Gap, this register indicates the address of the next executable Descriptor command. When the ADMA Error Interrupt is generated, this register holds the valid Descriptor address depending on the ADMA state. The lower 2 bits of this register is tied to '0' so the ADMA address is always word aligned.

Because this register supports dynamic address reflecting, when TC field is set, it automatically alters the value of internal address counter, so the software cannot change this register when TC field is set. Such restriction is also listed in Software restrictions.

## Diagram

<!-- image -->

## Fields

| Field   | Function            |
|---------|---------------------|
| 31-2    | ADMA system address |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

Table continued from the previous page...

| Field    | Function                                                                        |
|----------|---------------------------------------------------------------------------------|
| ADS_ADDR | This field contains the physical system memory address used for ADMA transfers. |
| 1-0 -    | Reserved                                                                        |

## 39.6.1.24 DLL (Delay Line) Control (DLL\_CTRL)

## Offset

| Register   | Offset   |
|------------|----------|
| DLL_CTRL   | 60h      |

## Function

This register contains control fields for DLL.

## Diagram

<!-- image -->

## Fields

| Field                           | Function                                                                                                                                                                                                                                                                                                                                                      |
|---------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 DLL_CTRL_RE F_UPDATE_IN T | DLL control loop update interval Theintervalcycleis(2+REF_UPDATE_INT)*REF_CLOCK.Bydefault,theDLLcontrolloopupdatesevery two REF_CLOCKcycles. It should be noted that increasing the reference delay-line update interval reduces the ability of the DLL to adjust to fast changes in conditions that might effect the delay (such as voltage and temperature) |
| 27-20                           | Slave delay line update interval If default 0 is used, it means 256 cycles of REF_CLOCK. Avalue of 0x0f results in 15 cycles and so on. Note that software can always cause an update of the slave-delay line using the SLV_FORCE_UPDATEregister.                                                                                                             |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field                            | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|----------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| DLL_CTRL_SL V_UPDATE_IN T        | Note that the slave delay line also updates automatically when the reference DLL transitions to a locked state (from an un-locked state).                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 19 -                             | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 18-16 DLL_CTRL_SL V_DLY_TARGE T1 | DLL slave delay target1 See DLL_CTRL_SLV_DLY_TARGET0 below.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 15-9 DLL_CTRL_SL V_OVERRIDE_ VAL | DLL slave override val When SLV_OVERRIDE = 1, this field is used to select 1 of 128 physical taps manually. A value of 0 selects tap 1, and a value of 0x7f selects tap 128.                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 8 DLL_CTRL_SL V_OVERRIDE         | DLL slave override Set this field to 1 to Enable manual override for slave delay chain using SLV_OVERRIDE_VAL; to set 0 to disable manual override. This feature does not require the DLL to be enabled using the ENABLE field. In fact to reduce power, if SLV_OVERRIDE is used, it is recommended to disable the DLL with ENABLE = 0                                                                                                                                                                                                                                                                               |
| 7 DLL_CTRL_GA TE_UPDATE          | DLL gate update Set this field to 1 to prevent the DLL from updating (because when clock_in exists, glitches might appear during DLL updates). This field might be used by software if such a condition occurs. Clear the bit to 0 to allow the DLL to update automatically.                                                                                                                                                                                                                                                                                                                                         |
| 6-3 DLL_CTRL_SL V_DLY_TARGE T0   | DLL slave delay target0 The delay target for uSDHC loopback read clock can be programmed in 1/16th increments of an ref_clock half-period. The delay is (({DLL_CTRL_SLV_DLY_TARGET1,DLL_CTRL_SLV_DLY_TARGET0} +1)* REF_CLOCK / 2) / 16 So the input read-clock can be delayed relative input data from (REF_CLOCK / 2) / 16 to REF_CLOCK * 4. For the restrictions of delay cell implementation, the delay target must be set between REF_CLOCK/16 and REF_CLOCK*2 when REF_CLOCK is running at 200 MHz. When REF_CLOCK frequency is slower than 100 MHz, the maximum delay target might not reach REF_CLOCK*2. NOTE |
| 2 DLL_CTRL_SL V_FORCE_UP D       | DLL slave delay line Setting this field to 1, forces the slave delay line to update to the DLLcalibrated value immediately. Theslave delay line updates automatically based on the SLV_UPDATE_INT interval or when a DLL lock condition is sensed. Subsequent forcing of the slave-line update can only occur if SLV_FORCE_UP is set back to 0 and then asserted again (edge triggered). Be sure to use it when uSDHC is idle. This function might not work when uSDHC is working on data / cmd / response.                                                                                                          |

Table continues on the next page...

Table continued from the previous page...

| Field              | Function                                                                                                                                                                                                                                                                                      |
|--------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 DLL_CTRL_RE SET  | DLL reset Setting this field to 1 force a reset on DLL. This causes the DLL to lose lock and re-calibrate to detect an REF_CLOCK half period phase shift. This signal is used by the DLL as edge-sensitive, so to create a subsequent reset, RESET must be taken low and then asserted again. |
| 0 DLL_CTRL_EN ABLE | DLL and delay chain Set this field to 1 to enable the DLLanddelay chain; otherwise; set to 0 to bypasses DLL. Note that using the slave delay line override feature with SLV_OVERRIDE and SLV_OVERRIDE VAL, the DLL does not need to be enabled.                                              |

## 39.6.1.25 DLL Status (DLL\_STATUS)

## Offset

| Register   | Offset   |
|------------|----------|
| DLL_STATUS | 64h      |

## Function

This register contains the DLL status information. All fields are read only and reads the same as the power-reset value.

## Diagram

<!-- image -->

## Fields

| Field   | Function                         |
|---------|----------------------------------|
| 31-16   | Reserved                         |
| 15-9    | Reference delay line select taps |

Table continues on the next page...

## Table continued from the previous page...

| Field                | Function                                                                                                                                                                                                                                              |
|----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| DLL_STS_REF _SEL     | This is encoded by 7 fields for 127 taps.                                                                                                                                                                                                             |
| 8-2 DLL_STS_SLV_ SEL | Slave delay line select status This is the instant value generated from reference chain. Because the reference chain can only be updated when REF_CLOCK is detected, this value should be the right value to be updated when the reference is locked. |
| 1 DLL_STS_REF _LOCK  | Reference DLL lock status This signifies that the DLL has detected and locked to a half-phase ref_clock shift, allowing the slave delay-line to perform programmed clock delays                                                                       |
| 0 DLL_STS_SLV_ LOCK  | Slave delay-line lock status This signifies that a valid calibration has been set to the slave-delay line and that the slave-delay line is implementing the programmed delay value                                                                    |

## 39.6.1.26 CLK Tuning Control and Status (CLK\_TUNE\_CTRL\_STATUS)

## Offset

| Register              | Offset   |
|-----------------------|----------|
| CLK_TUNE_CTRL_STA TUS | 68h      |

## Function

This register contains the Clock Tuning Control status information. This register is added to support SD3.0 UHS-I SDR104 mode and eMMC HS200 mode.

## Diagram

<!-- image -->

| Bits   | 31       | 30          | 29          | 28          | 27               | 26          | 25          | 24          | 23               | 22               | 21               | 20               | 19                | 18                | 17                | 16                |
|--------|----------|-------------|-------------|-------------|------------------|-------------|-------------|-------------|------------------|------------------|------------------|------------------|-------------------|-------------------|-------------------|-------------------|
| R      | PRE_ ERR | TAP_SEL_PRE | TAP_SEL_PRE | TAP_SEL_PRE | TAP_SEL_PRE      | TAP_SEL_PRE | TAP_SEL_PRE | TAP_SEL_PRE | TAP_SEL_OUT      | TAP_SEL_OUT      | TAP_SEL_OUT      | TAP_SEL_OUT      | TAP_SEL_POST      | TAP_SEL_POST      | TAP_SEL_POST      | TAP_SEL_POST      |
| W      |          |             |             |             |                  |             |             |             |                  |                  |                  |                  |                   |                   |                   |                   |
| Reset  | 0        | 0           | 0           | 0           | 0                | 0           | 0           | 0           | 0                | 0                | 0                | 0                | 0                 | 0                 | 0                 | 0                 |
| Bits   | 15       | 14          | 13          | 12          | 11               | 10          | 9           | 8           | 7                | 6                | 5                | 4                | 3                 | 2                 | 1                 | 0                 |
| R      | NXT_ ERR |             |             |             | DLY_CELL_SET_PRE |             |             |             | DLY_CELL_SET_OUT | DLY_CELL_SET_OUT | DLY_CELL_SET_OUT | DLY_CELL_SET_OUT | DLY_CELL_SET_POST | DLY_CELL_SET_POST | DLY_CELL_SET_POST | DLY_CELL_SET_POST |
| W      |          |             |             |             |                  |             |             |             |                  |                  |                  |                  |                   |                   |                   |                   |
| Reset  | 0        | 0           | 0           | 0           | 0                | 0           | 0           | 0           | 0                | 0                | 0                | 0                | 0                 | 0                 | 0                 | 0                 |

## Fields

| Field                  | Function                                                                                                                                                                                                                                                                                                                                                                                   |
|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 PRE_ERR             | PRE error PRE error which means the number of delay cells added on the feedback clock is too small. It is valid only when SMP_CLK_SEL of Mix control register (bit23 of 0x48) is enabled.                                                                                                                                                                                                  |
| 30-24 TAP_SEL_PRE      | TAP_SEL_PRE Reflects the number of delay cells added on the feedback clock between the feedback clock and CLK_PRE. When AUTO_TUNE_EN (bit24 of 0x48) is disabled, TAP_SEL_PRE is always equal to DLY_CELL_SET_PRE. When AUTO_TUNE_EN (bit24 of 0x48) is enabled, TAP_SEL_PRE is updated automatically according to the status of the auto tuning circuit to adjust the sample clock phase. |
| 23-20 TAP_SEL_OUT      | Delay cells added on the feedback clock between CLK_PRE and CLK_OUT Reflects the number of delay cells added on the feedback clock between CLK_PRE and CLK_OUT.                                                                                                                                                                                                                            |
| 19-16 TAP_SEL_POS T    | Delay cells added on the feedback clock between CLK_OUT and CLK_POST Reflects the number of delay cells added on the feedback clock between CLK_OUT and CLK_POST.                                                                                                                                                                                                                          |
| 15 NXT_ERR             | NXT error NXT error which means the number of delay cells added on the feedback clock is too large. It's valid only when SMP_CLK_SEL of Mix control register (bit23 of 0x48) is enabled.                                                                                                                                                                                                   |
| 14-8 DLY_CELL_SE T_PRE | delay cells on the feedback clock between the feedback clock and CLK_PRE Set the number of delay cells on the feedback clock between the feedback clock and CLK_PRE.                                                                                                                                                                                                                       |
| 7-4 DLY_CELL_SE T_OUT  | Delay cells on the feedback clock between CLK_PRE and CLK_OUT Set the number of delay cells on the feedback clock between CLK_PRE and CLK_OUT.                                                                                                                                                                                                                                             |
| 3-0 DLY_CELL_SE T_POST | Delay cells on the feedback clock between CLK_OUT and CLK_POST Set the number of delay cells on the feedback clock between CLK_OUT and CLK_POST.                                                                                                                                                                                                                                           |

## 39.6.1.27 Strobe DLL control (STROBE\_DLL\_CTRL)

## Offset

| Register        | Offset   |
|-----------------|----------|
| STROBE_DLL_CTRL | 70h      |

## Function

This register contains the strobe DLL control information.

## Diagram

<!-- image -->

## Fields

| Field                                   | Function                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-28 STROBE_DLL_ CTRL_REF_UP DATE_INT  | Strobe DLL control reference update interval The interval cycle is (2 + STROBE_REF_UPDATE_INT) * STROBE_REF_CLOCK. By default, the DLL control loop updates every two STROBE_REF_CLOCK cycles. Increasing the reference delay-line update interval reduces the ability of the DLL to adjust to fast changes in conditions that might effect the delay (such as voltage and temperature) NOTE                                       |
| 27-20 STROBE_DLL_ CTRL_SLV_UP DATE_INT  | Strobe DLL control slave update interval Slave delay line update interval. If default 0 is used, it means 256 cycles ofSTROBE_REF_CLOCK.Avalue of 0x0F results in 15 cycles and so on. software can always cause an update of the slave-delay line using the STROBE_SLV_FORCE_UPDATEregister. The slave delay line also updates automatically when the reference DLL transitions to a locked state (from an un-locked state). NOTE |
| 19-16 -                                 | This field is reserved. This read-only field is reserved and always has the value 0.                                                                                                                                                                                                                                                                                                                                               |
| 15-9 STROBE_DLL_ CTRL_SLV_OV ERRIDE_VAL | Strobe DLL control slave Override value WhenSTROBE_SLV_OVERRIDE=1,thisfield is used to manually select one of 128 physical taps. Avalue of 0 selects tap 1, and a value of 0x7F selects tap 128.                                                                                                                                                                                                                                   |
| 8 STROBE_DLL_ CTRL_SLV_OV ERRIDE        | Strobe DLL control slave override Set this field to 1 to Enable manual override for slave delay chain using STROBE_SLV_OVERRIDE_VAL; set this field to 0 to disable manual override. This feature does not require the DLL to be enabled using the ENABLE field. In fact to reduce power, if STROBE_SLV_OVERRIDE is used, it is recommended to disable the DLL with ENABLE = 0.                                                    |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field                                | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|--------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7 STROBE_DLL_ CTRL_GATE_U PDATE      | Strobe DLL control gate update Set this field to 1 to prevent the DLL from updating (because when STROBE_CLOCK_IN exists, glitches might appear during DLL updates). This field can be used by software if such a condition occurs. Clear the field to 0 to allow the DLL to update automatically.                                                                                                                                                                                                                                         |
| 6-3 STROBE_DLL_ CTRL_SLV_DL Y_TARGET | Strobe DLL Control Slave Delay Target The delay target for uSDHC loopback read clock can be programmed in 1/16th increments of an STROBE_REF_CLOCK half-period. The delay is ((STROBE_DLL_CTRL_SLV_DLY_TARGET + 1) * STROBE_REF_CLOCK / 2) / 16, So, the input read-clock can be delayed relative input data from (STROBE_REF_CLOCK / 2) / 16 to (STROBE_REF_CLOCK *8)/16. For the restrictions of delay cell implementation, the minimum delay target that can be set is REF_CLOCK/16. NOTE                                               |
| 2 STROBE_DLL_ CTRL_SLV_FO RCE_UPD    | Strobe DLL control slave force updated Setting this field to 1, forces the slave delay line to update to the DLL calibrated value immediately. The slave delay line should automatically update the STROBE_SLV_UPDATE_INT interval or when a DLL lock condition is sensed. Subsequent forcing of the slave-line update can only occur if STROBE_SLV_FORCE_UP is set back to 0 and then asserted again (edge triggered). Be sure to use it when uSDHC is idle. This function might not work when uSDHC is working on data / cmd / response. |
| 1 STROBE_DLL_ CTRL_RESET             | Strobe DLL control reset Setting this field to 1 to force a reset on DLL. This causes the DLL to lose lock and re-calibrate to detect an REF_CLOCK half period phase shift. This signal is used by the DLL as edge-sensitive, to create a subsequent reset, RESET must be taken low and then asserted again.                                                                                                                                                                                                                               |
| 0 STROBE_DLL_ CTRL_ENABLE            | Strobe DLL control enable Set this field to 1 to enable the DLL and delay chain; otherwise, set to 0 to bypasses DLL. Using the slave delay line override feature with STROBE_SLV_OVERRIDE and STROBE_SLV_OVERRIDE VAL, the DLL does not need to be enabled. NOTE                                                                                                                                                                                                                                                                          |

## 39.6.1.28 Strobe DLL status (STROBE\_DLL\_STATUS)

## Offset

| Register          | Offset   |
|-------------------|----------|
| STROBE_DLL_STATUS | 74h      |

## Function

This register contains the strobe DLL status information. All fields are read only and read the same as the power-reset value.

## Diagram

<!-- image -->

## Fields

| Field                        | Function                                                                                                                                                                                                                                                                                 |
|------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -                      | This field is reserved. This read-only field is reserved and always has the value 0.                                                                                                                                                                                                     |
| 15-9 STROBE_DLL_ STS_REF_SEL | Strobe DLL status reference select Reference delay line select taps. This is encoded by 7 fields for 127 taps.                                                                                                                                                                           |
| 8-2 STROBE_DLL_ STS_SLV_SEL  | Strobe DLL status slave select Slave delay line select status. This is the instant value generated from reference chain. Because the reference chain can only be updated when STROBE_REF_CLOCK is detected, this value can be updated with the right value when the reference is locked. |
| 1 STROBE_DLL_ STS_REF_LOC K  | Strobe DLL status reference lock This signifies that the DLL has detected and locked to a half-phase REF_CLOCK shift, it allows the slave delay-line to perform programmed clock delays.                                                                                                 |
| 0 STROBE_DLL_ STS_SLV_LOC K  | Strobe DLL status slave lock Slave delay-line lock status. This signifies that a valid calibration has been set to the slave-delay line, and the slave-delay line is implementing the programmed delay value.                                                                            |

## 39.6.1.29 Vendor Specific Register (VEND\_SPEC)

## Offset

| Register   | Offset   |
|------------|----------|
| VEND_SPEC  | C0h      |

Ultra Secured Digital Host Controller (uSDHC)

## Function

This register contains the vendor specific control/status register.

## Diagram

<!-- image -->

## Fields

| Field           | Function                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 CMD_BYTE_E N | Register byte access for CMD_XFR_TYP This field controls the register byte access for Command Transfer Type (CMD_XFR_TYP). If this field is enabled, the register can be configured through byte write enable. IPS_bus can write only one byte once for one write operation. 0b - Disable. MIX_CTRL[7:0] is read/write and CMD_XFR_TYP[7:0] is read-only. 1b - Enable. MIX_CTRL[7:0] is read-only and CMD_XFR_TYP[7:0] is read/write. |
| 30 -            | Reserved Always write as 0.                                                                                                                                                                                                                                                                                                                                                                                                           |
| 29 -            | Reserved Always write as 1                                                                                                                                                                                                                                                                                                                                                                                                            |
| 28 -            | Reserved Always write as 0.                                                                                                                                                                                                                                                                                                                                                                                                           |
| 27-24 -         | Reserved Always write as 4'b0000.                                                                                                                                                                                                                                                                                                                                                                                                     |
| 23-16 -         | Reserved Always write as 8'h00.                                                                                                                                                                                                                                                                                                                                                                                                       |
| 15 CRC_CHK_DIS  | CRC Check Disable 0b - Check CRC16 for every read data packet and check CRC fields for every write data packet                                                                                                                                                                                                                                                                                                                        |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field                 | Function                                                                                                                                                                                                                                                                                               |
|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 14-11 -               | 1b - Ignore CRC16 check for every read data packet and ignore CRC fields check for every write data packet Reserved Reserved                                                                                                                                                                           |
| 10 -                  | Reserved Always write as 0.                                                                                                                                                                                                                                                                            |
| 9 -                   | Reserved Always write as 0.                                                                                                                                                                                                                                                                            |
| 8 FRC_SDCLK_O N       | Force CLK Force CLK output active Do not set this bit to 1 unless it is necessary. Also, make sure that this bit is cleared when uSDHC's clock is about to be changed (frequency change, clock source change, or delay chain tuning). 0b - CLK active or inactive is fully controlled by the hardware. |
| 7 -                   | Reserved                                                                                                                                                                                                                                                                                               |
| 6 -                   | Reserved                                                                                                                                                                                                                                                                                               |
| 5 -                   | Reserved                                                                                                                                                                                                                                                                                               |
| 3 AC12_WR_CH KBUSY_EN | Check busy enable Check busy enable after auto CMD12 for write data packet 0b - Do not check busy after auto CMD12 for write data packet 1b - Check busy after auto CMD12 for write data packet                                                                                                        |
| 2 -                   | Reserved                                                                                                                                                                                                                                                                                               |
| 1 VSELECT             | Voltage selection Change the value of output signal VSELECT to control the voltage on pads for external card. There be a control circuit out of uSDHC to change the voltage on pads.                                                                                                                   |
|                       | must                                                                                                                                                                                                                                                                                                   |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

Table continued from the previous page...

| Field   | Function                                                                                                                |
|---------|-------------------------------------------------------------------------------------------------------------------------|
|         | 0b - Change the voltage to high voltage range, around 3.0 V 1b - Change the voltage to low voltage range , around 1.8 V |
| 0       | Reserved                                                                                                                |
| -       | Always write as 0.                                                                                                      |

## 39.6.1.30 eMMC Boot (MMC\_BOOT)

## Offset

| Register   | Offset   |
|------------|----------|
| MMC_BOOT   | C4h      |

## Function

This register contains the eMMC Fast Boot control register.

## Diagram

<!-- image -->

## Fields

| Field               | Function                                                                                                                                                              |
|---------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 BOOT_BLK_CN T | Stop At Block Gap value of automatic mode The value defines the Stop At Block Gap value of automatic mode. When received, card block cnt is equal                     |
| 15-9 -              | to (BLK_CNT - BOOT_BLK_CNT) and AUTO_SABG_EN is 1, then Stop At Block Gap. Here, BLK_CNT is defined in the Block Attributes Register, field 31 - 16 of 0x04. Reserved |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field               | Function                                                                                                                                                                                                                                                    |
|---------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 8 DISABLE_TIME _OUT | Time out When this field is set, there is no timeout check no matter whether BOOT_EN is set or not. NOTE 0b - Enable time out                                                                                                                               |
| 7 AUTO_SABG_E N     | Auto stop at block gap During boot, enable auto stop at block gap function. This function is triggered, and host stops at block gap when received card block cnt is equal to (BLK_CNT - BOOT_BLK_CNT).                                                      |
| 6 BOOT_EN           | Boot enable Boot mode enable 0b - Fast boot disable 1b - Fast boot enable                                                                                                                                                                                   |
| 5 BOOT_MODE         | Boot mode Boot mode select 0b - Normal boot 1b - Alternative boot                                                                                                                                                                                           |
| 4 BOOT_ACK          | BOOT ACK Boot ACK mode select 0b - No ack 1b - Ack                                                                                                                                                                                                          |
| 3-0 DTOCV_ACK       | DTOCV_ACK Boot ACK time out counter value 0000b - SDCLK x 2^32 0001b - SDCLK x 2^33 0010b - SDCLK x 2^18 0011b - SDCLK x 2^19 0100b - SDCLK x 2^20 0101b - SDCLK x 2^21 0110b - SDCLK x 2^22 0111b - SDCLK x 2^23 1110b - SDCLK x 2^30 1111b - SDCLK x 2^31 |

Ultra Secured Digital Host Controller (uSDHC)

## 39.6.1.31 Vendor Specific 2 Register (VEND\_SPEC2)

## Offset

| Register   | Offset   |
|------------|----------|
| VEND_SPEC2 | C8h      |

## Function

This register contains the vendor specific control 2 register.

## Diagram

<!-- image -->

## Fields

| Field                | Function                                                                                                                                                                                                                                            |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 FBCLK_TAP_S EL | Enable extra delay on internal feedback clock It is a hot code. The default value is 16'h0001 that means the length of feedback delay chain is 1. The value of 16'h8000 means the length of feedback delay chain is 16.                             |
| 15 EN_32K_CLK        | Select the clock source for host card detection. It can use low power clock for card detection, by setting this bit to 1. 0b - Use the peripheral clock (ipg_clk) for card detection. 1b - Use the low power clock (ipg_clk_lp) for card detection. |
| 14 -                 | Reserved                                                                                                                                                                                                                                            |
| 13 -                 | Reserved                                                                                                                                                                                                                                            |
| 12 ACMD23_ARG U2_EN  | Argument2 register enable for ACMD23 0b - Disable                                                                                                                                                                                                   |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field                    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                          | 1b - Argument2 register enable for ACMD23 sharing with SDMA system address register. Default is enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 11 HS400_RD_CL K_STOP_EN | HS400 read clock stop enable Only stop clock at read block gap.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 10 HS400_WR_CL K_STOP_EN | HS400 write clock stop enable Only stop clock at write block gap.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 9 -                      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 8-7 -                    | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 6 TUNING_CMD_ EN         | Tuning command enable Enable the auto tuning circuit to check the CMD line. 0b - Auto tuning circuit does not check the CMD line. 1b - Auto tuning circuit checks the CMD line.                                                                                                                                                                                                                                                                                                                                                                         |
| 5-4 TUNING_BIT_E N       | Tuning bit enable Enable the auto tuning circuit to check the DATA[7:0]. The value option is as the list below. In SDIO mode, auto-tuning only supports 1-bit (i.e. DATA[0]) tuning, and the 4-bit (i.e. DATA[3:0]) auto tuning is not supported for SDIO mode. SD mode supports 1-bit/4-bit (DATA[0] and DATA[3:0]) auto tuning. eMMC mode supports 1-bit/4-bit/8-bit (DATA[0], DATA[3:0] and DATA[7:0]) auto tuning. NOTE 00b - Enable Tuning circuit for DATA[3:0] 01b - Enable Tuning circuit for DATA[7:0] 10b - Enable Tuning circuit for DATA[0] |
| 3 CARD_INT_D3_ TEST      | Card interrupt detection test This field is used only for debugging. 0b - Check the card interrupt only when DATA3 is high. 1b - Check the card interrupt by ignoring the status of DATA3.                                                                                                                                                                                                                                                                                                                                                              |
| 2-0                      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

Table continued from the previous page...

| Field   | Function   |
|---------|------------|
| -       |            |

## 39.6.1.32 Tuning Control (TUNING\_CTRL)

## Offset

| Register    | Offset   |
|-------------|----------|
| TUNING_CTRL | CCh      |

## Function

The register contains configuration of tuning circuit.

## Diagram

<!-- image -->

## Fields

| Field             | Function                                                                                                         |
|-------------------|------------------------------------------------------------------------------------------------------------------|
| 31-25 -           | Reserved                                                                                                         |
| 24 STD_TUNING_ EN | Standard tuning circuit and procedure enable This field is used to enable standard tuning circuit and procedure. |
| 23 -              | Reserved                                                                                                         |
| 22-20             | Data window Select data window value for auto tuning                                                             |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field                          | Function                                                                                                                                                                                                                        |
|--------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TUNING_WIND OW                 |                                                                                                                                                                                                                                 |
| 19 -                           | Reserved                                                                                                                                                                                                                        |
| 18-16 TUNING_STEP              | TUNING_STEP The increasing delay cell steps in tuning procedure.                                                                                                                                                                |
| 15-8 TUNING_COU NTER           | Tuning counter The MAX repeat CMD19 times in tuning procedure.                                                                                                                                                                  |
| 7 DIS_CMD_CHK _FOR_STD_TU NING | Disable command check for standard tuning Writing 1 to this field disables command check (command CRC, CMD end bit error, and CMD index error or CMD timeout error) for standard tuning flow after each tuning command is sent. |
| 6-0 TUNING_STAR T_TAP          | Tuning start The start delay cell point when send first CMD19 in tuning procedure.                                                                                                                                              |

## 39.6.1.33 Command Queuing Version (CQVER)

## Offset

| Register   | Offset   |
|------------|----------|
| CQVER      | 100h     |

## Function

This register provides information about the version of the eMMC CQ standard that is implemented by CQE, in BCD format. The current version is 5.1.

Ultra Secured Digital Host Controller (uSDHC)

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19             | 18             | 17             | 16             |
|--------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------------|----------------|----------------|----------------|
| R      | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved       | Reserved       | Reserved       | Reserved       |
| W      |          |          |          |          |          |          |          |          |          |          |          |          |                |                |                |                |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0              | 0              | 0              | 0              |
| Bits   | 15       | 14       | 13       | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3              | 2              | 1              | 0              |
| R      | Reserved | Reserved | Reserved | Reserved | MAJOR_VN | MAJOR_VN | MAJOR_VN | MAJOR_VN | MINOR_VN | MINOR_VN | MINOR_VN | MINOR_VN | VERSION_SUFFIX | VERSION_SUFFIX | VERSION_SUFFIX | VERSION_SUFFIX |
| W      |          |          |          |          |          |          |          |          |          |          |          |          |                |                |                |                |
| Reset  | 0        | 0        | 0        | 0        | 0        | 1        | 0        | 1        | 0        | 0        | 0        | 1        | 0              | 0              | 0              | 0              |

## Fields

| Field               | Function                                                                   |
|---------------------|----------------------------------------------------------------------------|
| 31-12 -             | Reserved                                                                   |
| 11-8 MAJOR_VN       | eMMC major version number Digit right of decimal point, in BCD format      |
| 7-4 MINOR_VN        | eMMC minor version number Digit right of decimal point, in BCD format      |
| 3-0 VERSION_SUF FIX | eMMC version suffix The second digit right of decimal point, in BCD format |

## 39.6.1.34 Command Queuing Capabilities (CQCAP)

## Offset

| Register   | Offset   |
|------------|----------|
| CQCAP      | 104h     |

## Function

This register indicates hardware capabilities.

## NOTE

This register must not be configured and must be used as a read-only register. Writing to the read-write fields of this register does not affect any functionality. Reset values reflect the correct capability information.

Ultra Secured Digital Host Controller (uSDHC)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25              | 24              | 23              | 22              | 21              | 20              | 19              | 18              | 17              | 16              |
|--------|------|------|------|------|------|------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               |
| W      |      |      |      |      |      |      |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9               | 8               | 7               | 6               | 5               | 4               | 3               | 2               | 1               | 0               |
| R      |      |      |      |      | 0    | 0    |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |
| W      |      |      |      |      |      |      | ITCFMUL ITCFVAL | ITCFMUL ITCFVAL | ITCFMUL ITCFVAL | ITCFMUL ITCFVAL | ITCFMUL ITCFVAL | ITCFMUL ITCFVAL | ITCFMUL ITCFVAL | ITCFMUL ITCFVAL | ITCFMUL ITCFVAL | ITCFMUL ITCFVAL |
| Reset  | 0    | 0    | 1    | 1    | 0    | 0    | 0               | 1               | 0               | 0               | 0               | 0               | 1               | 0               | 1               | 0               |

## Fields

| Field         | Function                                                                                                                                                                                                                                                                                                                                                                                                    |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                    |
| 15-12 ITCFMUL | Internal timer clock frequency multiplier ITCFMUL and ITCFVAL indicate the frequency of the clock used for interrupt coalescing timer and for determining the SQS polling period. See ITCFVAL definition for details. 0001b - 0.001 MHz 0010b - 0.01 MHz 0011b - 0.1 MHz 0100b - 1 MHz 0101b - 10 MHz 0110b-1001b - Reserved                                                                                |
| 11-10 -       | Reserved                                                                                                                                                                                                                                                                                                                                                                                                    |
| 9-0 ITCFVAL   | Internal timer clock frequency value ITCFMUL and ITCFVAL indicate the frequency of the clock used for interrupt coalescing timer and for determining the polling period when using periodic SEND_QUEUE_ STATUS (CMD13) polling. The clock frequency is calculated as ITCFVAL* ITCFMUL. For example, to encode 19.2 MHz, ITCFVAL is C0h (= 192 decimal) and ITCFMUL is 3h (0.1 MHz): 192 0.1 MHz = 19.2 MHz. |

Ultra Secured Digital Host Controller (uSDHC)

## 39.6.1.35 Command Queuing Configuration (CQCFG)

## Offset

| Register   | Offset   |
|------------|----------|
| CQCFG      | 108h     |

## Function

This register controls CQE behavior affecting the general operation of command queuing module or operation of multiple tasks in the same time.

## Diagram

<!-- image -->

## Fields

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                       |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-13 -  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 12 DCMDE | Direct command (DCMD) enable This bit indicates to the hardware whether the Task Descriptor in slot #31 of the TDLis a Data Transfer Task Descriptor, or a Direct Command Task Descriptor. CQE uses this bit when a task is issued in slot #31, to determine how to decode the Task Descriptor. 0b - Task descriptor in slot #31 is a Data Transfer Task Descriptor 1b - Task descriptor in slot #31 is a DCMD Task Descriptor |
| 11-9 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 8 TDS    | Task descriptor size This bit indicates whether the task descriptor size is 128 bits or 64 bits as detailed in Data Structures section. This bit can only be configured when Command Queuing Enable bit is '0' (command queuing is disabled)                                                                                                                                                                                   |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

## Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                         |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | 0b - Task descriptor size is 64 bits 1b - Task descriptor size is 128 bits                                                                                                                                                                                                                                                                                                                                       |
| 7-1 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                         |
| 0 CQUE  | Command queuing enable Software shall write '1' this bit when in order to enable command queuing mode (for example, enable CQE). When this bit is 0, CQE is disabled and software controls the eMMC bus using the legacy eMMC host controller. Before software writes '1' to this bit, software shall verify that the eMMC host controller is in idle state and there are no commands or data transfers ongoing. |

## 39.6.1.36 Command Queuing Control (CQCTL)

## Offset

| Register   | Offset   |
|------------|----------|
| CQCTL      | 10Ch     |

## Function

This register controls CQE behavior affecting the general operation of command queuing module or operation of multiple tasks in the same time.

## Diagram

<!-- image -->

Ultra Secured Digital Host Controller (uSDHC)

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-9 -  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 8 CLEAR | Clear all tasks Software shall write '1' this bit when it wants to clear all the tasks sent to the chip. This bit can only be written when CQE is in halt state (for example, Halt bit is 1). When software writes 1, the value of the register is updated to '1', and CQE shall reset CQTDBR register and all other context information for all unfinished tasks. Then CQE will clear this bit. Software should poll on this bit until it is set to back 0 and may then resume normal operation, by clearing the Halt bit. CQE does not communicate to the chip that the tasks were cleared. It is software's responsibility to order the chip to discard the tasks in its queue using CMDQ_TASK_MGMT command. Writing '0' to this register shall have no effect. |
| 7-1 -   | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 0 HALT  | Halt Host software shall write '1' to the bit when it wants to acquire software control over the eMMC bus and disable CQE from issuing commands on the bus. For example, issuing a Discard Task command (CMDQ_TASK_MGMT) When software writes '1', CQE shall complete the ongoing task if such a task is in progress. Once the task is completed and CQEis in idle state, CQEshall not issue new commands and shall indicate so to software by setting this bit to 1. Software may poll on this bit until it is set to 1, and may only then send commands on the eMMC bus. In order to exit halt state (for example, resume CQE activity), software shall clear this bit (write '0'). Writing '0' when the value is already '0' shall have no effect.              |

## 39.6.1.37 Command Queuing Interrupt Status (CQIS)

## Offset

| Register   | Offset   |
|------------|----------|
| CQIS       | 110h     |

## Function

This register indicates pending interrupts that require service. Each bit in this registers is asserted in response a specific event, only if the respective bit is set in CQISTE register.

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
|--------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|
| R      | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved |
| W      |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| Bits   | 15       | 14       | 13       | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R      | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | TCL      | RED      | TCC      | HAC      |
| W      |          |          |          |          |          |          |          |          |          |          |          |          | W1C      | W1C      | W1C      | W1C      |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                                                                                 |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-4 -  | Reserved                                                                                                                                                                                                                                                                                                                                                 |
| 3 TCL   | Task cleared This status bit is asserted (if CQISTE[TCL_STE]=1) when a task clear operation is completed by CQE. The completed task clear operation is either an individual task clear (CQTCLR) or clearing of all tasks (CQCTL).                                                                                                                        |
| 2 RED   | Response error detected interrupt This status bit is asserted (if CQISTE[RED_STE]=1) when a response is received with an error bit set in the device status field. The contents of the device status field are listed in 6.13. Software uses CQRMEM register to configure which device status bit fields may trigger an interrupt, and which are masked. |
| 1 TCC   | Task complete interrupt This status bit is asserted (if CQISTE[TCC_STE]=1) when at least one of the following two conditions are met: • A task is completed and the INT bit is set in its Task Descriptor • Interrupt caused by Interrupt Coalescing logic (see 0)                                                                                       |
| 0 HAC   | Halt complete interrupt This status bit is asserted (if CQISTE[HAC_STE]=1) when halt bit in CQCTL register transitions from 0 to 1 indicating that host controller has completed its current ongoing task and has entered halt state.                                                                                                                    |

## 39.6.1.38 Command Queuing Interrupt Status Enable (CQISTE)

## Offset

| Register   | Offset   |
|------------|----------|
| CQISTE     | 114h     |

Ultra Secured Digital Host Controller (uSDHC)

## Function

This register enables and disables the reporting of the corresponding interrupt to host software in CQIS register. When a bit is set ('1') and the corresponding interrupt condition is active, then the bit is CQIS is asserted. Interrupt sources that are disabled ('0') are not indicated in the CQIS register. This register is bit-index matched to CQIS register.

## Diagram

<!-- image -->

## Fields

| Field     | Function                                                                                                                                          |
|-----------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-4 -    | Reserved                                                                                                                                          |
| 3 TCL_STE | Task cleared status enable Related to CQIS[TCL] 0b - CQIS[TCL] is disabled 1b - CQIS[TCL] is set when its interrupt condition is active           |
| 2 RED_STE | Response error detected status enable Related to CQIS[RED] 0b - CQIS[RED]is disabled 1b - CQIS[RED] is set when its interrupt condition is active |
| 1 TCC_STE | Task complete status enable Related to CQIS[TCC] 0b - CQIS[TCC] is disabled 1b - CQIS[TCC] is set when its interrupt condition is active          |
| 0 HAC_STE | Halt complete status enable Related to CQIS[HAC] 0b - CQIS[HAC] is disabled 1b - CQIS[HAC] is set when its interrupt condition is active          |

Ultra Secured Digital Host Controller (uSDHC)

## 39.6.1.39 Command Queuing Interrupt Signal Enable (CQISGE)

## Offset

| Register   | Offset   |
|------------|----------|
| CQISGE     | 118h     |

## Function

This register enables and disables the generation of interrupts to host software. When a bit is set ('1') and the corresponding bit in CQIS is set, then an interrupt is generated. Interrupt sources that are disabled ('0') are still indicated in the CQIS register. This register is bit-index matched to CQIS register.

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
|--------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|
| R      | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved |
| W      |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| Bits   | 15       | 14       | 13       | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R      | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | TCL_     | RED_     | TCC_     | HAC_     |
| W      |          |          |          |          |          |          |          |          |          |          |          |          | SGE      | SGE      | SGE      | SGE      |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |

## Fields

| Field     | Function                                                                                                  |
|-----------|-----------------------------------------------------------------------------------------------------------|
| 31-4 -    | Reserved                                                                                                  |
| 3 TCL_SGE | Task cleared signal enable When set and CQIS[TCL] is asserted, the CQE generates an interrupt.            |
| 2 RED_SGE | Response error detected signal enable When set and CQIS[RED] is asserted, the CQE generates an interrupt. |
| 1 TCC_SGE | Task complete signal enable When set and CQIS[TCC] is asserted, the CQE generates an interrupt.           |
| 0 HAC_SGE | Halt complete signal enable When set and CQIS[HAC] is asserted, the CQE generates an interrupt.           |

Ultra Secured Digital Host Controller (uSDHC)

## 39.6.1.40 Command Queuing Interrupt Coalescing (CQIC)

## Offset

| Register   | Offset   |
|------------|----------|
| CQIC       | 11Ch     |

## Function

This register controls the interrupt coalescing feature.

## Diagram

<!-- image -->

| Bits   | 31        | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23          | 22       | 21       | 20   | 19       | 18       | 17       | 16    |
|--------|-----------|----------|----------|----------|----------|----------|----------|----------|-------------|----------|----------|------|----------|----------|----------|-------|
| R      | ICEND     | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved    | Reserved | Reserved | ICSB | Reserved | Reserved | Reserved |       |
| W      | IS        |          |          |          |          |          |          |          |             |          |          |      |          |          |          | ICCTR |
| Reset  | 0         | 0        | 0 0      | 0        |          | 0        | 0        | 0        | 0           | 0        | 0        | 0    | 0        | 0        | 0        | 0     |
| Bits   | 15        | 14       | 13 12    | 11       |          | 10       | 9        | 8        | 7           | 6        | 5        | 4    | 3        | 2        | 1        | 0     |
| R      |           | Reserved | Reserved |          |          |          |          |          |             |          |          |      |          |          |          |       |
| W      | ICCTH WEN |          |          |          |          | ICCTH    |          |          | ICTOV AL... |          |          |      | ICTOVAL  |          |          |       |
| Reset  | 0         | 0        | 0 0      |          | 0        | 0        | 0        | 0        | 0           | 0        | 0        | 0    | 0        | 0        | 0        | 0     |

## Fields

| Field      | Function                                                                                                                                                                                                                                                                                                                                                       |
|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 ICENDIS | Interrupt coalescing enable/disable When host driver writes '1', the interrupt coalescing timer and counter are reset.                                                                                                                                                                                                                                         |
| 30-21 -    | Reserved                                                                                                                                                                                                                                                                                                                                                       |
| 20 ICSB    | Interrupt coalescing status This bit indicates to software whether any tasks (with INT=0) have completed and counted towards interrupt coalescing (for example, ICSB is set if and only if IC counter > 0). 0b - No task completions have occurred since last counter reset (IC counter =0) 1b - At least one task completion has been counted (IC counter >0) |
| 19-17 -    | Reserved                                                                                                                                                                                                                                                                                                                                                       |
| 16 ICCTR   | Counter and timer reset When host driver writes '1', the interrupt coalescing timer and counter are reset.                                                                                                                                                                                                                                                     |

Table continues on the next page...

## Table continued from the previous page...

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 15 ICCTHWEN  | Interrupt coalescing counter threshold write enable When software writes '1', the value ICCTH is updated with the contents written at the same cycle. When software writes '0', the value in ICCTH is not updated. Write operations to ICCTH are only allowed when the task queue is empty. NOTE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 14-13 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 12-8 ICCTH   | Interrupt coalescing counter threshold Software uses this field to configure the number of task completions (only tasks with INT=0 in the Task Descriptor) which are required in order to generate an interrupt. Counter Operation: As data transfer tasks with INT=0 complete, they are counted by CQE. The counter is reset by software during the interrupt service routine. The counter stops counting when it reaches the value configured in ICCTH. The maximum allowed value is 31. When ICCTH is 0, task completions are not counted, and counting-based interrupts are not generated. NOTE In order to write to this field, the ICCTHWEN field must be set at the same write operation.                                                                                                                                                                                                                                |
| 7 ICTOVALWEN | Interrupt coalescing timeout value write enable When software writes '1', the value ICTOVAL is updated with the contents written at the same cycle. When software writes '0', the value in ICTOVAL is not updated. Write operations to ICTOVAL are only allowed when the task queue is empty. NOTE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 6-0 ICTOVAL  | Interrupt coalescing timeout value Software uses this field to configure the maximum time allowed between the completion of a task on the bus and the generation of an interrupt. Timer Operation: The timer is reset by software during the interrupt service routine. It starts running whenadata transfer task with INT=0 is completed, after the timer was reset. Whenthetimer reaches the value configured in ICTOVAL field it generates an interrupt and stops. The timer's unit is equal to 1024 clock periods of the clock whose frequency is specified in the Internal Timer Clock Frequency field CQCAP register. The minimum value is 01h (1024 clock periods) and the maximum value is 7Fh (127*1024 clock periods). For example, a CQCAP field value of 0 indicates a 19.2 MHz clock frequency (period = 52.08 ns). If the setting in ICTOVAL is 10h, the calculated polling period is 16*1024*52.08 ns= 853.33 us |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                    |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | WhenICTOVAL is 0, the timer is not running, and timer-based interrupts are not generated. NOTE In order to write to this field, the ICTOVALWEN bit must be set at the same write operation. |

## 39.6.1.41 Command Queuing Task Descriptor List Base Address (CQTDLBA)

## Offset

| Register   | Offset   |
|------------|----------|
| CQTDLBA    | 120h     |

## Function

This register is used for configuring the lower 32 bits of the byte address of the head of the Task Descriptor List in the host memory.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24    | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|-------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      | TDLBA |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8     | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    |      |      |      |      |      |      |      | TDLBA |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0     | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                              |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Task descriptor list base address                                                                                                                                                                                                                                                                                                                                                                     |
| TDLBA   | This register stores the LSB bits (bits 31:0) of the byte address of the head of the Task Descriptor List in system memory. The size of the task descriptor list is 32 * (Task Descriptor size + Transfer Descriptor size) as configured by Host driver. This address shall be set on 1 KByte boundary: The lower 10 bits of this register shall be set to 0 by software and shall be ignored by CQE. |

Ultra Secured Digital Host Controller (uSDHC)

Ultra Secured Digital Host Controller (uSDHC)

## 39.6.1.42 Command Queuing Task Descriptor List Base Address Upper 32 Bits (CQTDLBAU)

## Offset

| Register   | Offset   |
|------------|----------|
| CQTDLBAU   | 124h     |

## Function

This register is used for configuring the upper 32 bits of the byte address of the head of the Task Descriptor List in the host memory.

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                                               |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Task descriptor list base address                                                                                                                                                                                                                                                                                      |
| TDLBAU  | This register stores the MSB bits (bits 63:32) of the byte address of the head of the Task Descriptor List in system memory. The size of the task descriptor list is 32 * (Task Descriptor size + Transfer Descriptor size) as configured by Host driver. This register is reserved when using 32-bit addressing mode. |

## 39.6.1.43 Command Queuing Task Doorbell (CQTDBR)

## Offset

| Register   | Offset   |
|------------|----------|
| CQTDBR     | 128h     |

## Function

Using this register, software triggers CQE to process a new task.

## Diagram

<!-- image -->

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|---------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W     |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R       |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W Reset | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0 TDBR | Task doorbell Software configures TDLBA and TDLBAU, and enable CQE in CQCFG before using this register. Writing 1 to bit n of this register triggers CQE to start processing the task encoded in slot n of the TDL. CQE always processes tasks in-order according to the order submitted to the list by CQTDBR write transactions. CQE processes Data Transfer tasks by reading the Task Descriptor and sending QUEUED_TASK_PARAMS(CMD44)andQUEUED_TASK_ADDRESS(CMD45)commandstothedevice. CQE processes DCMD tasks (in slot #31, when enabled) by reading the Task Descriptor, and generating the command encoded by its index and argument. The corresponding bit is cleared to '0' by CQE in one of the following events: 1. When a task execution is completed (with success or error) 2. The task is cleared using CQTCLR register 3. All tasks are cleared using CQCTL register 4. CQE is disabled using CQCFG register Software may initiate multiple tasks at the same time (batch submission) by writing 1 to multiple bits of this register in the same transaction. In the case of batch submission: CQE shall process the tasks in order of the task index, starting with the lowest index. If one or more tasks in the batch are marked with QBR, the ordering of execution will be based on said processing order. Writing 0 by software shall have no impact on the hardware, and will not change the value of the register bit. |

Ultra Secured Digital Host Controller (uSDHC)

## 39.6.1.44 Command Queuing Task Completion Notification (CQTCN)

## Offset

| Register   | Offset   |
|------------|----------|
| CQTCN      | 12Ch     |

## Function

This register is used by CQE to notify software about completed tasks.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  |
| W      | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  | TCN  |
| W      | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  | W1C  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                       |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Task complete notification                                                                                                                                                                                                                                                                                                                                                     |
| TCN     | CQE shall set bit n of this register (at the same time it clears bit n of CQTDBR) when a task execution is completed (with success or error). When receiving interrupt for task completion, software may read this register to know which tasks have finished. After reading this register, software may clear the relevant bit fields by writing 1 to the corresponding bits. |

## 39.6.1.45 Command Queuing Device Queue Status (CQDQS)

## Offset

| Register   | Offset   |
|------------|----------|
| CQDQS      | 130h     |

## Function

This register stores the most recent value of the device's queue status.

Ultra Secured Digital Host Controller (uSDHC)

## Diagram

Ultra Secured Digital Host Controller (uSDHC)

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  | DQS  |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                                               |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Device queue status                                                                                                                                                                    |
| DQS     | Every time the Host controller receives aqueuestatus register (QSR)fromthedevice, it updates this register with the response of status command (For example, the chip's queue status). |

## 39.6.1.46 Command Queuing Device Pending Tasks (CQDPT)

## Offset

| Register   | Offset   |
|------------|----------|
| CQDPT      | 134h     |

## Function

This register indicates to software which tasks are queued in the device, awaiting execution.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  | DPT  |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0 DPT | Device pending tasks Bit n of this register is set if and only if QUEUED_TASK_PARAMS (CMD44) and QUEUED_TASK_ADDRESS (CMD45) were sent for this specific task and if this task hasn't been executed yet. CQEshall set this bit after receiving a successful response for CMD45. CQEshall clear this bit after the task has completed execution. Software needs to read this register in the task-discard procedure, when the controller is halted, to determine if the task is queued in the device. If the task is queued, the driversendsaCMDQ_TASK_MGMT (CMD48) to the device ordering it to discard the task. Then software clears the task in the CQE. Only then the software orders CQE to resume its operation using CQCTL register. |

## 39.6.1.47 Command Queuing Task Clear (CQTCLR)

## Offset

| Register   | Offset   |
|------------|----------|
| CQTCLR     | 138h     |

## Function

This register is used for removing an outstanding task in the CQE. The register should be used only when CQE is in Halt state.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                                                             |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Task clear                                                                                                                                                                                           |
| TCLR    | Writing 1 to bit n of this register orders CQE to clear a task which software has previously issued. This bit can only be written when CQE is in Halt state as indicated in CQCFG register Halt bit. |

Table continues on the next page...

Ultra Secured Digital Host Controller (uSDHC)

| Field   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         | When software writes '1' to a bit in this register, CQE updates the value to '1', and starts clearing the data structures related to the task. CQEclears the bit fields (sets a value of 0) in CQTCLRand in CQTDBRonce clear operation is complete. Software should poll on the CQTCLR until it is cleared to verify clear operation was complete. Writing to this register only clears the task in the CQE and does not have impact on the device. In order to discard the task in the device, host software shall send CMDQ_TASK_MGMTwhileCQEisstillinHalt state. Host driver is not allowed to use this register to clear multiple tasks at the same time. Clearing multiple tasks can be done using CQCTL register. Writing 0 to a register bit shall have no impact. |

## 39.6.1.48 Command Queuing Send Status Configuration 1 (CQSSC1)

## Offset

| Register   | Offset   |
|------------|----------|
| CQSSC1     | 140h     |

## Function

The register controls the when SEND\_QUEUE\_STATUS commands are sent.

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19   | 18   | 17   | 16   |
|--------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|------|------|------|------|
| R      | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved |      |      |      |      |
| W      |          |          |          |          |          |          |          |          |          |          |          |          | CBC  | CBC  | CBC  | CBC  |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0    | 0    | 0    | 1    |
| Bits   | 15       | 14       | 13       | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3    | 2    | 1    | 0    |
| R      |          |          |          |          |          |          |          |          |          |          |          |          |      |      |      |      |
| W      | CIT      | CIT      | CIT      | CIT      | CIT      | CIT      | CIT      | CIT      | CIT      | CIT      | CIT      | CIT      | CIT  | CIT  | CIT  | CIT  |
| Reset  | 0        | 0        | 0        | 1        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                          |
|---------|-----------------------------------|
| 31-20   | Reserved                          |
| 19-16   | Send status command block counter |

Table continues on the next page...

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CBC      | This field indicates to CQEwhentosendSEND_QUEUE_STATUS(CMD13)commandtoinquirethestatus of the device's task queue. A value of n means CQE sends status command on the CMD line, during the transfer of data block BLOCK_CNT-n, on the data lines, where BLOCK_CNT is the number of blocks in the current transaction. A value of 0 means that SEND_QUEUE_STATUS (CMD13) command is not sent during the transaction. Instead it will be sent only when the data lines are idle. A value of 1 means that STATUS command is to be sent during the last block of the transaction.                                                                                                                                                                                                                                                                                                               |
| 15-0 CIT | Send status command idle timer This field indicates to CQE the polling period to use when using periodic SEND_QUEUE_STATUS (CMD13) polling. Periodic polling is used when tasks are pending in the device, but no data transfer is in progress. When a SEND_QUEUE_STATUS response indicating that no task is ready for execution, CQE counts the configured time until it issues the next SEND_QUEUE_STATUS. Timer units are clock periods of the clock whosefrequency is specified in the Internal Timer Clock Frequency field CQCAP register. The minimum value is 0001h (1 clock period) and the maximum value is FFFFh (65535 clock periods). Default interval is: 4096 clock periods. For example, a CQCAP field value of 0 indicates a 19.2 MHz clock frequency (period = 52.08 ns). If the setting in CQSSC1.CIT is 1000h, the calculated polling period is 4096*52.08 ns= 213.33 us |

## 39.6.1.49 Command Queuing Send Status Configuration 2 (CQSSC2)

## Offset

| Register   | Offset   |
|------------|----------|
| CQSSC2     | 144h     |

## Function

This register is used for configuring RCA field in SEND\_QUEUE\_STATUS command argument.

Ultra Secured Digital Host Controller (uSDHC)

## Diagram

<!-- image -->

| Bits    | 31       | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
|---------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|
| R       | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved |
| W       |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |
| Reset   | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| Bits    | 15       | 14       | 13       | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R       |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |
| W Reset | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |

## Fields

| Field   | Function                                                                                                                                                                                                                    |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 - | Reserved                                                                                                                                                                                                                    |
| 15-0    | Send queue status RCA                                                                                                                                                                                                       |
| SSC2    | This field provides CQE with the contents of the 16-bit RCA field in SEND_QUEUE_ STATUS (CMD13) command argument. CQE copies this field to bits 31:16 of the argument when transmitting SEND_ QUEUE_STATUS (CMD13) command. |

## 39.6.1.50 Command Queuing Command Response for Direct-Command Task (CQCRDCT)

## Offset

| Register   | Offset   |
|------------|----------|
| CQCRDCT    | 148h     |

## Function

This register is used for passing the response of a DCMD task to software.

Ultra Secured Digital Host Controller (uSDHC)

## Diagram

<!-- image -->

| Bits   | 31    | 30    | 29    | 28    | 27    | 26    | 25    | 24    | 23    | 22    | 21    | 20    | 19    | 18    | 17    | 16    |
|--------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| R      | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT |
| W      |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     |
| Bits   | 15    | 14    | 13    | 12    | 11    | 10    | 9     | 8     | 7     | 6     | 5     | 4     | 3     | 2     | 1     | 0     |
| R      | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT | CRDCT |
| W      |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |
| Reset  | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     |

## Fields

| Field   | Function                                                                                                                                                                                                                                                                               |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Direct command last response                                                                                                                                                                                                                                                           |
| CRDCT   | This register contains the response of the command generated by the last direct-command (DCMD) task which was sent. CQE updates this register when it receives the response for a DCMD task. This register is considered valid only after bit 31 of CQTDBR register is cleared by CQE. |

## 39.6.1.51 Command Queuing Response Mode Error Mask (CQRMEM)

## Offset

| Register   | Offset   |
|------------|----------|
| CQRMEM     | 150h     |

## Function

This register controls the generation of Response Error Detection (RED) interrupt.

## Diagram

<!-- image -->

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|---------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R       |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset   | 1    | 1    | 1    | 1    | 1    | 1    | 0    | 1    | 1    | 1    | 1    | 1    | 1    | 0    | 0    | 1    |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R       |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W Reset | 1    | 0    | 1    | 0    | 0    | 0    | 0    | 0    | 1    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

Ultra Secured Digital Host Controller (uSDHC)

## Fields

| Field     | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0 RMEM | Response mode error mask This bit is used as in interrupt mask on the device status filed which is received in R1/R1b responses. The reset value of this register is set to trigger an interrupt on all 'Error' type bits in the device status, as defined in 6.13. Responses to CMD13 (SQS) encode the QSR, so they are ignored by this logic. NOTE 0000_0000_0000_0000_0000_0000_0000_0000b - When a R1/R1b response is received, bit i in the device status is ignored 0000_0000_0000_0000_0000_0000_0000_0001b - When a R1/R1b response is received, with bit i in the device status set, a RED interrupt is generated |

## 39.6.1.52 Command Queuing Task Error Information (CQTERRI)

## Offset

| Register   | Offset   |
|------------|----------|
| CQTERRI    | 154h     |

## Function

This register is updated by CQE when an error occurs on data or command related to a task activity.

When such error is detected by CQE or indicated by the eMMC controller CQE stores in CQTERRI the task IDs and the command indices of the commands which were executed on the command line and data lines when the error occurred.

Software is expected to use this information in the error recovery procedure. See B.2.8 for more details.

## Diagram

<!-- image -->

| Bits   | 31     | 30       | 29       | 28     | 27     | 26     | 25     | 24     | 23       | 22       | 21    | 20    | 19    | 18    | 17    | 16    |
|--------|--------|----------|----------|--------|--------|--------|--------|--------|----------|----------|-------|-------|-------|-------|-------|-------|
| R      | DTEFV  | Reserved | Reserved | DTETID | DTETID | DTETID | DTETID | DTETID | Reserved | Reserved | DTECI | DTECI | DTECI | DTECI | DTECI | DTECI |
| W      |        |          |          |        |        |        |        |        |          |          |       |       |       |       |       |       |
| Reset  | 0      | 0        | 0        | 0      | 0      | 0      | 0      | 0      | 0        | 0        | 0     | 0     | 0     | 0     | 0     | 0     |
| Bits   | 15     | 14       | 13       | 12     | 11     | 10     | 9      | 8      | 7        | 6        | 5     | 4     | 3     | 2     | 1     | 0     |
| R      | RMEF V | Reserved | Reserved | RMETID | RMETID | RMETID | RMETID | RMETID | Reserved | Reserved | RMECI | RMECI | RMECI | RMECI | RMECI | RMECI |
| W      |        |          |          |        |        |        |        |        |          |          |       |       |       |       |       |       |
| Reset  | 0      | 0        | 0        | 0      | 0      | 0      | 0      | 0      | 0        | 0        | 0     | 0     | 0     | 0     | 0     | 0     |

Ultra Secured Digital Host Controller (uSDHC)

## Fields

| Field        | Function                                                                                                                                                                                                                                                                                                                                                                                 |
|--------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 DTEFV     | Data transfer error fields valid This bit is updated when an error is detected by CQE, or indicated by eMMC controller. If a data transfer is in progress when the error is detected/indicated, the bit is set to 1. If a no data transfer is in progress when the error is detected/indicated, the bit is cleared to 0.                                                                 |
| 30-29 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                 |
| 28-24 DTETID | Data transfer error task ID This field indicates the ID of the task which was executed on the data lines when an error occurred. The field is updated if a data transfer is in progress when an error is detected by CQE, or indicated by eMMC controller.                                                                                                                               |
| 23-22 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                 |
| 21-16 DTECI  | Data transfer error command index This field indicates the index of the commandwhich was executed on the data lines when an error occurred. The index shall be set to EXECUTE_READ_TASK (CMD46) or EXECUTE_WRITE_TASK (CMD47) according to the data direction. The field is updated if a data transfer is in progress when an error is detected by CQE, or indicated by eMMC controller. |
| 15 RMEFV     | Response mode error fields valid This bit is updated when an error is detected by CQE, or indicated by eMMC controller. If a command transaction is in progress when the error is detected/indicated, the bit is set to 1. If a no command transaction is in progress when the error is detected/indicated, the bit is cleared to 0.                                                     |
| 14-13 -      | Reserved                                                                                                                                                                                                                                                                                                                                                                                 |
| 12-8 RMETID  | Response mode error task ID This field indicates the index of the command which was executed on the command line when an error occurred. The field is updated if a command transaction is in progress when an error is detected by CQE, or indicated by eMMC controller.                                                                                                                 |
| 7-6 -        | Reserved                                                                                                                                                                                                                                                                                                                                                                                 |
| 5-0          | Response mode error command index                                                                                                                                                                                                                                                                                                                                                        |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                                                                                     |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| RMECI   | This field indicates the index of the command which was executed on the command line when an error occurred. The field is updated if a command transaction is in progress when an error is detected by CQE, or indicated by eMMC controller. |

## 39.6.1.53 Command Queuing Command Response Index (CQCRI)

## Offset

| Register   | Offset   |
|------------|----------|
| CQCRI      | 158h     |

## Function

This register stores the index of the last received command response.

## Diagram

<!-- image -->

| Bits   | 31       | 30       | 29       | 28       | 27       | 26       | 25       | 24       | 23       | 22       | 21       | 20       | 19       | 18       | 17       | 16       |
|--------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|
| R      | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved |
| W      |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |
| Bits   | 15       | 14       | 13       | 12       | 11       | 10       | 9        | 8        | 7        | 6        | 5        | 4        | 3        | 2        | 1        | 0        |
| R      | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | Reserved | LCMDRI   | LCMDRI   | LCMDRI   | LCMDRI   | LCMDRI   | LCMDRI   |
| W      |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |          |
| Reset  | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        | 0        |

## Fields

| Field   | Function                                                                                                                                  |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------|
| 31-6    | Reserved                                                                                                                                  |
| -       |                                                                                                                                           |
| 5-0     | Last command response index                                                                                                               |
| LCMDRI  | This field stores the index of the last received command response. CQE shall update the value every time a command response is received.. |

Ultra Secured Digital Host Controller (uSDHC)

## 39.6.1.54 Command Queuing Command Response Argument (CQCRA)

## Offset

| Register   | Offset   |
|------------|----------|
| CQCRA      | 15Ch     |

## Function

This register stores the argument of the last received command response.

## Diagram

<!-- image -->

| Bits   | 31     | 30     | 29     | 28     | 27     | 26     | 25     | 24     | 23     | 22     | 21     | 20     | 19     | 18     | 17     | 16     |
|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| R      | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA |
| W      |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |
| Bits   | 15     | 14     | 13     | 12     | 11     | 10     | 9      | 8      | 7      | 6      | 5      | 4      | 3      | 2      | 1      | 0      |
| R      | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA | LCMDRA |
| W      |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |
| Reset  | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      | 0      |

## Fields

| Field   | Function                                                                                                                           |
|---------|------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Last command response argument                                                                                                     |
| LCMDRA  | This field stores the argument of the last received command. CQE shall update the value every time a command response is received. |

Ultra Secured Digital Host Controller (uSDHC)

## Chapter 40 System Timer Module (STM)

## 40.1 Chip-specific STM information

## 40.1.1 STM instances

This chip implements:

- One STM (STM\_7) tied to timestamp
- Eight general purpose STMs as follows:
- STM\_0
- STM\_1
- STM\_2
- STM\_3
- STM\_4
- STM\_5
- STM\_6
- STM\_7
- STM\_TS

## 40.2 Overview

STM supports commonly required system and application software timing functions. STM includes a 32-bit count-up timer and four 32-bit compare channels with a separate interrupt source for each channel. The timer is driven by the STM module clock divided by an 8-bit prescale value (1 to 256).

## 40.2.1 Block diagram

<!-- image -->

## 40.2.2 Features

STM has the following features:

- One 32-bit count-up timer with an 8-bit prescaler
- Four 32-bit compare channels
- An independent interrupt source for each channel
- Ability to stop the timer in Debug mode

## 40.3 STM\_TS register descriptions

The STM programming model allows only 32-bit (word) accesses. An attempted reference using a different size or to a reserved address generates a bus error termination.

## 40.3.1 STM\_TS memory map

STM\_TS base address: 4400\_C000h

System Timer Module (STM)

| Offset   | Register                 |   Width (In bits) | Access   | Reset value   |
|----------|--------------------------|-------------------|----------|---------------|
| 0h       | Control (CR)             |                32 | RW       | 0000_0000h    |
| 4h       | Count (CNT)              |                32 | RW       | 0000_0000h    |
| 10h      | Channel Control (CCR0)   |                32 | RW       | 0000_0000h    |
| 14h      | Channel Interrupt (CIR0) |                32 | RW       | 0000_0000h    |
| 18h      | Channel Compare (CMP0)   |                32 | RW       | 0000_0000h    |
| 20h      | Channel Control (CCR1)   |                32 | RW       | 0000_0000h    |
| 24h      | Channel Interrupt (CIR1) |                32 | RW       | 0000_0000h    |
| 28h      | Channel Compare (CMP1)   |                32 | RW       | 0000_0000h    |
| 30h      | Channel Control (CCR2)   |                32 | RW       | 0000_0000h    |
| 34h      | Channel Interrupt (CIR2) |                32 | RW       | 0000_0000h    |
| 38h      | Channel Compare (CMP2)   |                32 | RW       | 0000_0000h    |
| 40h      | Channel Control (CCR3)   |                32 | RW       | 0000_0000h    |
| 44h      | Channel Interrupt (CIR3) |                32 | RW       | 0000_0000h    |
| 48h      | Channel Compare (CMP3)   |                32 | RW       | 0000_0000h    |

## 40.3.2 Control (CR)

## Offset

| Register   | Offset   |
|------------|----------|
| CR         | 0h       |

## Function

Contains fields for the prescale value, freeze control, and timer enable.

## Diagram

<!-- image -->

## Fields

| Field    | Function                                                                                                                                                                                                                               |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -  | Reserved                                                                                                                                                                                                                               |
| 15-8 CPS | Counter Prescaler Selects the module clock divide value for the prescaler (1-256). • 00h - Divide module clock by 1 • 01h - Divide module clock by 2 • ... • FFh - Divide module clock by 256                                          |
| 7-2 -    | Reserved                                                                                                                                                                                                                               |
| 1 FRZ    | Freeze Stops the timer when the chip enters Debug mode. Whenthe chip enters Debug mode, it notifies STM, which in turn uses this field to determine timer operation. NOTE 0b - Timer runs in Debug mode 1b - Timer stops in Debug mode |
| 0 TEN    | Timer Enable Enables the module timer. 0b - Disabled 1b - Enabled                                                                                                                                                                      |

## 40.3.3 Count (CNT)

## Offset

| Register   | Offset   |
|------------|----------|
| CNT        | 4h       |

## Function

Holds the timer count value.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                        |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Timer Count                                                                                                                                     |
| CNT     | The time base for all compare channels. When enabled, the timer count increments at the rate of the module clock divided by the prescale value. |

## 40.3.4 Channel Control (CCR0 - CCR3)

## Offset

| Register   | Offset   |
|------------|----------|
| CCR0       | 10h      |
| CCR1       | 20h      |
| CCR2       | 30h      |
| CCR3       | 40h      |

## Function

Enables channel n of the timer.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | CEN  |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      | CEN  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

System Timer Module (STM)

## Fields

| Field   | Function                                  |
|---------|-------------------------------------------|
| 31-1    | Reserved                                  |
| 0 CEN   | Channel Enable 0b - Disabled 1b - Enabled |

## 40.3.5 Channel Interrupt (CIR0 - CIR3)

## Offset

| Register   | Offset   |
|------------|----------|
| CIR0       | 14h      |
| CIR1       | 24h      |
| CIR2       | 34h      |
| CIR3       | 44h      |

## Function

Indicates and clears the interrupt flag for channel n of the timer.

## Diagram

<!-- image -->

## Fields

| Field   | Function   |
|---------|------------|
| 31-1    | Reserved   |

Table continues on the next page...

Table continued from the previous page...

| Field   | Function                                                                                                                                                                  |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0       | Channel Interrupt Flag                                                                                                                                                    |
| CIF     | Indicates the channel IRQ is asserted due to a match on the channel. 0b - Read: IRQ is not asserted. Write: No effect. 1b - Read: IRQ is asserted. Write: Clear the flag. |

## 40.3.6 Channel Compare (CMP0 - CMP3)

## Offset

| Register   | Offset   |
|------------|----------|
| CMP0       | 18h      |
| CMP1       | 28h      |
| CMP2       | 38h      |
| CMP3       | 48h      |

## Function

The compare value for channel n.

## Diagram

<!-- image -->

| Bits    | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|---------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W     |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits    | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R       |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| W Reset | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                               |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Channel Compare                                                                                                                                                        |
| CMP     | If the channel is enabled (CCR n [CEN]), when the timer count (CNT) matches this value, STM asserts the channel IRQ and sets the channel interrupt flag (CIR n [CIF]). |

## 40.4 STM register descriptions

The STM programming model allows only 32-bit (word) accesses. An attempted reference using a different size or to a reserved address generates a bus error termination.

## 40.4.1 STM memory map

STM\_0 base address: 4011\_C000h

STM\_1 base address: 4012\_0000h

STM\_2 base address: 4012\_4000h

STM\_3 base address: 4012\_8000h

STM\_4 base address: 4021\_C000h

STM\_5 base address: 4022\_0000h

STM\_6 base address: 4022\_4000h

STM\_7 base address: 4022\_8000h

| Offset   | Register                 |   Width (In bits) | Access   | Reset value   |
|----------|--------------------------|-------------------|----------|---------------|
| 0h       | Control (CR)             |                32 | RW       | 0000_0000h    |
| 4h       | Count (CNT)              |                32 | RW       | 0000_0000h    |
| 10h      | Channel Control (CCR0)   |                32 | RW       | 0000_0000h    |
| 14h      | Channel Interrupt (CIR0) |                32 | RW       | 0000_0000h    |
| 18h      | Channel Compare (CMP0)   |                32 | RW       | 0000_0000h    |
| 20h      | Channel Control (CCR1)   |                32 | RW       | 0000_0000h    |
| 24h      | Channel Interrupt (CIR1) |                32 | RW       | 0000_0000h    |
| 28h      | Channel Compare (CMP1)   |                32 | RW       | 0000_0000h    |
| 30h      | Channel Control (CCR2)   |                32 | RW       | 0000_0000h    |
| 34h      | Channel Interrupt (CIR2) |                32 | RW       | 0000_0000h    |
| 38h      | Channel Compare (CMP2)   |                32 | RW       | 0000_0000h    |
| 40h      | Channel Control (CCR3)   |                32 | RW       | 0000_0000h    |
| 44h      | Channel Interrupt (CIR3) |                32 | RW       | 0000_0000h    |
| 48h      | Channel Compare (CMP3)   |                32 | RW       | 0000_0000h    |

## 40.4.2 Control (CR)

## Offset

| Register   | Offset   |
|------------|----------|
| CR         | 0h       |

System Timer Module (STM)

## Function

Contains fields for the prescale value, freeze control, and timer enable.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      |      |      |      |      |      |      |      |      | 0    | 0    | 0    | 0    | 0    | 0    | FRZ  | TEN  |
| W      | CPS  | CPS  | CPS  | CPS  | CPS  | CPS  | CPS  | CPS  |      |      |      |      |      |      | FRZ  | TEN  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field    | Function                                                                                                                                                                                                                               |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-16 -  | Reserved                                                                                                                                                                                                                               |
| 15-8 CPS | Counter Prescaler Selects the module clock divide value for the prescaler (1-256). • 00h - Divide module clock by 1 • 01h - Divide module clock by 2 • ... • FFh - Divide module clock by 256                                          |
| 7-2 -    | Reserved                                                                                                                                                                                                                               |
| 1 FRZ    | Freeze Stops the timer when the chip enters Debug mode. Whenthe chip enters Debug mode, it notifies STM, which in turn uses this field to determine timer operation. NOTE 0b - Timer runs in Debug mode 1b - Timer stops in Debug mode |
| 0 TEN    | Timer Enable Enables the module timer.                                                                                                                                                                                                 |

Table continues on the next page...

System Timer Module (STM)

Table continued from the previous page...

| Field   | Function                   |
|---------|----------------------------|
|         | 0b - Disabled 1b - Enabled |

## 40.4.3 Count (CNT)

## Offset

| Register   | Offset   |
|------------|----------|
| CNT        | 4h       |

## Function

Holds the timer count value.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                        |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Timer Count                                                                                                                                     |
| CNT     | The time base for all compare channels. When enabled, the timer count increments at the rate of the module clock divided by the prescale value. |

## 40.4.4 Channel Control (CCR0 - CCR3)

## Offset

| Register   | Offset   |
|------------|----------|
| CCR0       | 10h      |

Table continues on the next page...

Table continued from the previous page...

| Register   | Offset   |
|------------|----------|
| CCR1       | 20h      |
| CCR2       | 30h      |
| CCR3       | 40h      |

## Function

Enables channel n of the timer.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | CEN  |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      | CEN  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                  |
|---------|-------------------------------------------|
| 31-1    | Reserved                                  |
| 0 CEN   | Channel Enable 0b - Disabled 1b - Enabled |

## 40.4.5 Channel Interrupt (CIR0 - CIR3)

## Offset

| Register   | Offset   |
|------------|----------|
| CIR0       | 14h      |
| CIR1       | 24h      |
| CIR2       | 34h      |
| CIR3       | 44h      |

## Function

Indicates and clears the interrupt flag for channel n of the timer.

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | CIF  |
| W      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      | W1C  |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                                                |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-1    | Reserved                                                                                                                                                                                |
| 0       | Channel Interrupt Flag Indicates the channel IRQ is asserted due to a match on the 0b - Read: IRQ is not asserted. Write: No effect. 1b - Read: IRQ is asserted. Write: Clear the flag. |
| CIF     | channel.                                                                                                                                                                                |

## 40.4.6 Channel Compare (CMP0 - CMP3)

## Offset

| Register   | Offset   |
|------------|----------|
| CMP0       | 18h      |
| CMP1       | 28h      |
| CMP2       | 38h      |
| CMP3       | 48h      |

## Function

The compare value for channel n.

System Timer Module (STM)

## Diagram

<!-- image -->

| Bits   | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| Bits   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| R W    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| Reset  | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |

## Fields

| Field   | Function                                                                                                                                                               |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31-0    | Channel Compare                                                                                                                                                        |
| CMP     | If the channel is enabled (CCR n [CEN]), when the timer count (CNT) matches this value, STM asserts the channel IRQ and sets the channel interrupt flag (CIR n [CIF]). |

## 40.5 Functional description

## 40.5.1 Count-up timer

STM has one 32-bit count-up timer that serves as the time base for four compare channels. When enabled, the counter increments at the module clock frequency divided by a prescaler value in the range from 1 to 256. When enabled in Normal mode, the timer increments continuously. The counter rolls over at FFFF\_FFFFh to 0000\_0000h with no restrictions at this boundary.

## 40.5.2 Compare channels

STM has four identical compare channels. Each channel includes a channel control register (CCRn), a channel interrupt register (CCRn), and a channel compare register (CMPn). When the channel is enabled and its channel compare value matches the timer count, STM sets the channel interrupt flag and generates an IRQ on that channel.

## 40.5.3 Behavior in different chip modes

STM supports the chip modes of operation as follows:

| Chip mode   | STM behavior                                                                                                               |
|-------------|----------------------------------------------------------------------------------------------------------------------------|
| Normal      | When the timer is enabled (CR[TEN] = 1), the timer counts up continuously.                                                 |
| Debug       | If CR[FRZ] = 1, STM stops the timer. Otherwise, when the timer is enabled (CR[TEN] = 1), the timer counts up continuously. |

## 40.5.4 Clocking

This module has no clocking considerations.

System Timer Module (STM)

## 40.5.5 Interrupts

STM can generate a channel interrupt. For information, see:

- Compare channels
- Respond to compare channel events
- Channel Interrupt (CIR0 - CIR3)

## 40.6 External signals

This module has no external signals.

## 40.7 Initialization

This module does not require initialization.

## 40.8 Application information

## 40.8.1 Configure the timer

1. Set the initial timer count (CNT[CNT]).
2. Specify STM behavior in chip Debug mode (CNT[FRZ]).
3. Set the counter prescaler (CR[CPS]).
4. Start the timer (CR[TEN]).

## 40.8.2 Configure the compare channels

For each compare channel:

1. Set the channel compare value (CMPn[CMP]).
2. Enable the compare channel (CCRn[CEN]).

## 40.8.3 Respond to compare channel events

For each compare channel:

1. Check the channel interrupt flag (CIRn[CIF]).
2. If the channel interrupt flag is set, respond to the interrupt request.
3. When the channel interrupt has been handled, clear the channel interrupt flag (CIRn[CIF]).

## 40.9 Glossary

IRQ

Interrupt request

System Timer Module (STM)

## Chapter 41 Software Watchdog Timer (SWT)

## 41.1 Chip-specific SWT information

## 41.1.1 SWT instances and supported cores

The following table describes this chip's SWT instances and supported cores. To perform an operation on an SWT instance, you must first enable the core that the instance supports.

- SWT\_0: Cortex-M7 core 0
- SWT\_1: Cortex-M7 core 1
- SWT\_2: Cortex-M7 core 2
- SWT\_3: Cortex-A53 core 0
- SWT\_4: Cortex-A53 core 1
- SWT\_5: Cortex-A53 core 2
- SWT\_6: Cortex-A53 core 3

## 41.1.2 References to Stop mode

In this chapter, references to Stop mode describe the Sleep or WFI mode of the core to which an SWT instance is connected.

## 41.1.3 Configure timeout events and reactions

For each SWT instance, use CR[ITR] to configure the outcomes of SWT timeout events as well as reactions to SWT reset and interrupt requests. See the related information in:

- The "Functional reset sources" section of the Reset chapter.
- The interrupt map file attached to this document.
- The fault map file attached to this document.

## 41.1.4 Resetting SWT instances when a timeout triggers a reset request

When a timeout triggers a reset request and a chip reset is not required, you can make only the related SWT instance reset itself rather than the entire system. This functionality is supported for the SWT\_1-SWT\_6 instances on this chip when the corresponding reset is configured as an interrupt in FCCU at the chip level. For the SWT\_0 instance, the functionality is not supported because this instance cannot be demoted to an interrupt in MC\_RGM.

## 41.2 Overview

The Software Watchdog Timer (SWT) is a 32-bit window watchdog timer that enables the system to recover from situations such as:

- Software trapped in a loop
- A bus transaction failing to terminate

In regular operation, SWT requires periodic execution of a watchdog servicing operation. The servicing operation resets the timer to a specified timeout period. If this servicing action does not occur before the timer expires, SWT generates an interrupt or a hardware reset request.

You can configure SWT to generate a reset request or an interrupt on the initial timeout. SWT always generates a reset request on a second consecutive timeout.

## 41.2.1 Block diagram

<!-- image -->

## 41.2.2 Features

SWT has the following features:

- 32-bit countdown timer
- Selection of regular or window servicing
- Selection of reset request or interrupt on an initial timeout
- Selection of fixed or keyed service sequence
- Master access protection
- Hard and soft configuration lock bits

## 41.3 SWT register descriptions

The SWT programming model allows only 32-bit (word) accesses.

Any of the following attempted accesses are invalid:

- Non-32-bit accesses
- Writes to read-only registers
- Writes of incorrect values to SR when SWT is enabled
- Accesses to reserved addresses
- Accesses by masters without permission

You control how SWT responds to an invalid access with CR[RIA].

Software Watchdog Timer (SWT)

## 41.3.1 SWT memory map

SWT\_0 base address: 4010\_0000h

SWT\_1 base address: 4010\_4000h

SWT\_2 base address: 4010\_8000h

SWT\_3 base address: 4010\_C000h

SWT\_4 base address: 4020\_0000h

SWT\_5 base address: 4020\_4000h

SWT\_6 base address: 4020\_8000h

| Offset   | Register            |   Width (In bits) | Access   | Reset value   |
|----------|---------------------|-------------------|----------|---------------|
| 0h       | Control (CR)        |                32 | RW       | FF00_010Ah    |
| 4h       | Interrupt (IR)      |                32 | RW       | 0000_0000h    |
| 8h       | Timeout (TO)        |                32 | RW       | 0073_FDE0h    |
| Ch       | Window (WN)         |                32 | RW       | 0000_0000h    |
| 10h      | Service (SR)        |                32 | RW       | 0000_0000h    |
| 14h      | Counter Output (CO) |                32 | R        | 0000_0000h    |
| 18h      | Service Key (SK)    |                32 | RW       | 0000_0000h    |
| 1Ch      | Event Request (RRR) |                32 | RW       | 0000_0000h    |

## 41.3.2 Control (CR)

## Offset

| Register   | Offset   |
|------------|----------|
| CR         | 0h       |

## Function

Contains fields for configuring and controlling SWT. The register is read-only if either hard lock or soft lock is enabled (either HLK or SLK is 1).

Software Watchdog Timer (SWT)

## Diagram

<!-- image -->

## Fields

| Field   | Function                                                                                                                                                                                                                                   |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31 MAP0 | Master Access Protection 0 The platform bus master assignments are chip-specific. The number of this field corresponds to the XRDC DIDs of the bus master. MAP0 corresponds to XRDC DIDs 0 and 8. 0b - Access disabled 1b - Access enabled |
| 30 MAP1 | Master Access Protection 1 See the description for MAP0. MAP1 corresponds to XRDC DIDs 1 and 9. 0b - Access disabled 1b - Access enabled                                                                                                   |
| 29 MAP2 | Master Access Protection 2 See the description for MAP0. MAP2 corresponds to XRDC DIDs 2 and 10. 0b - Access disabled 1b - Access enabled                                                                                                  |
| 28 MAP3 | Master Access Protection 3 See the description for MAP0. MAP3 corresponds to XRDC DIDs 3 and 11. 0b - Access disabled 1b - Access enabled                                                                                                  |
| 27 MAP4 | Master Access Protection 4 See the description for MAP0. MAP4 corresponds to XRDC DIDs 4 and 12. 0b - Access disabled 1b - Access enabled                                                                                                  |

Table continues on the next page...

Software Watchdog Timer (SWT)

## Table continued from the previous page...

| Field    | Function                                                                                                                                                                                                                                                                                                                                                                                                                     |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 26 MAP5  | Master Access Protection 5 See the description for MAP0. MAP5 corresponds to XRDC DIDs 5 and 13. 0b - Access disabled 1b - Access enabled                                                                                                                                                                                                                                                                                    |
| 25 MAP6  | Master Access Protection 6 See the description for MAP0. MAP6 corresponds to XRDC DIDs 6 and 14. 0b - Access disabled 1b - Access enabled                                                                                                                                                                                                                                                                                    |
| 24 MAP7  | Master Access Protection 7 See the description for MAP0. MAP7 corresponds to XRDC DIDs 7 and 15. 0b - Access disabled 1b - Access enabled                                                                                                                                                                                                                                                                                    |
| 23-11 -  | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 10-9 SMD | Service Mode 00b - Fixed Service Sequence. To service the watchdog, write the fixed sequence 0xA602, 0xB480 to SR. 01b - Keyed Service Sequence. To service the watchdog, write two pseudorandom key values to SR. 10b - Reserved. Do not use this value. Writing this value can cause the watchdog to not be serviced. 11b - Reserved. Do not use this value. Writing this value can cause the watchdog not to be serviced. |
| 8 RIA    | Reset on Invalid Access Controls how SWT responds to an invalid access. For a description of how this chip implements SWT reset requests resulting from SWT invalid accesses, see the chip-specific SWT information. NOTE 0b - Generate a bus error 1b - Generate a bus error and reset request. If SWT is enabled (WEN = 1), generate a bus error and a reset request; otherwise, generate a bus error.                     |
| 7 WND    | Window Mode Specify regular or window mode operation.                                                                                                                                                                                                                                                                                                                                                                        |

Table continues on the next page...